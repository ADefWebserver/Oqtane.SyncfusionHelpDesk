!function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="_content/Syncfusion.Blazor/scripts/",i(i.s="./bundles/diagrams.js")}({"./bundles/diagrams.js":function(e,t,i){"use strict";i.r(t);i("./modules/diagrams.js")},"./modules/diagrams.js":function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.sf=window.sf||{},window.sf.diagrams=function(e){"use strict";var t,i=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.isEmpty=function(){return 0===this.height&&0===this.width},e.prototype.clone=function(){return new e(this.width,this.height)},e}(),o=(t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,i)},function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),n=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.equals=function(e,t){return e===t||!(!e||!t)&&(!e||!t||e.x===t.x&&e.y===t.y)},t.isEmptyPoint=function(e){return!e.x||!e.y},t.transform=function(e,t,i){var r={x:0,y:0};return r.x=Math.round(100*(e.x+i*Math.cos(t*Math.PI/180)))/100,r.y=Math.round(100*(e.y+i*Math.sin(t*Math.PI/180)))/100,r},t.findLength=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},t.findAngle=function(e,t){var i=Math.atan2(t.y-e.y,t.x-e.x);return i=180*i/Math.PI,(i%=360)<0&&(i+=360),i},t.distancePoints=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.getLengthFromListOfPoints=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distancePoints(e[i],e[i+1]);return t},t.adjustPoint=function(e,t,i,r){var o,n=i?{x:e.x,y:e.y}:{x:t.x,y:t.y};return e.x===t.x?e.y<t.y&&i||e.y>t.y&&!i?n.y+=r:n.y-=r:e.y===t.y?e.x<t.x&&i||e.x>t.x&&!i?n.x+=r:n.x-=r:i?(o=this.findAngle(e,t),n=this.transform(e,o,r)):(o=this.findAngle(t,e),n=this.transform(t,o,r)),n},t.direction=function(e,t){return Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?e.x<t.x?"Right":"Left":e.y<t.y?"Bottom":"Top"},t.prototype.getClassName=function(){return"Point"},n([sf.base.Property(0)],t.prototype,"x",void 0),n([sf.base.Property(0)],t.prototype,"y",void 0),t}(sf.base.ChildProperty);function s(e){var t,i=[],r=h(e);if(r.length>0)for(var o=0;o<r.length;o++){var n=r[o],a="";switch((a=n[0]).toLowerCase()){case"m":for(t=1;t<n.length;t++)i.push({command:a,x:n[t],y:n[t+1]}),t+=1,"m"===a?a="l":"M"===a&&(a="L");break;case"l":case"t":for(t=1;t<n.length;t++)i.push({command:a,x:n[t],y:n[t+1]}),t+=1;break;case"h":for(t=1;t<n.length;t++)i.push({command:a,x:n[t]});break;case"v":for(t=1;t<n.length;t++)i.push({command:a,y:n[t]});break;case"z":i.push({command:a});break;case"c":for(t=1;t<n.length;t++)i.push({command:a,x1:n[t],y1:n[t+1],x2:n[t+2],y2:n[t+3],x:n[t+4],y:n[t+5]}),t+=5;break;case"s":for(t=1;t<n.length;t++)i.push({command:a,x2:n[t],y2:n[t+1],x:n[t+2],y:n[t+3]}),t+=3;break;case"q":for(t=1;t<n.length;t++)i.push({command:a,x1:n[t],y1:n[t+1],x:n[t+2],y:n[t+3]}),t+=3;break;case"a":for(t=1;t<n.length;t++)i.push({command:a,r1:n[t],r2:n[t+1],angle:n[t+2],largeArc:n[t+3],sweep:n[t+4],x:n[t+5],y:n[t+6]}),t+=6}}return i}function h(e){var t=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,i=[],r=[],o={};t.lastIndex=0;var n=!1;for(o=t.exec(e);o;)"e"===o[1]?n=!0:o[1]?("zm"===o[1].toLowerCase()?(i.length&&r.push(i),r.push(["Z"]),i=[o[1].substring(1,2)]):(i.length&&r.push(i),i=[o[1]]),n=!1):(i.length||(i=[]),n||i.push(Number(o[2])),n=!1),o=t.exec(e);return i.length&&r.push(i),r}function d(e,t,i){var r,o,n,a="",s=[{x:0+e,y:0},{x:0+i-e,y:0},{x:0+i,y:0+e},{x:0+i,y:0+t-e},{x:0+i-e,y:0+t},{x:0+e,y:0+t},{x:0,y:0+t-e},{x:0,y:0+e}],h=[{x:0+i,y:0},{x:0+i,y:0+t},{x:0,y:0+t},{x:0,y:0}],d=0;for(a="M"+s[0].x+" "+s[0].y,n=0;n<s.length;n+=2)a+="L"+(r=s[n+1]).x+" "+r.y,o=s[n+2]||s[0],a+="Q"+h[d].x+" "+h[d].y+" "+o.x+" "+o.y,d++;return a}function l(e){var t,i,r="";for(r="M"+e[0].x+" "+e[0].y,i=1;i<e.length;i++)r+="L"+(t=e[i]).x+" "+t.y;return r+="Z"}function c(e){var t,i,r,o,n,a,s,h,d,l,c=[];for(s=0,h=0,l=0,d=e.length;l<d;++l){var p,g=e[l];p=g.command,"y1"in g&&(o=g.y1),"y2"in g&&(a=g.y2),"x1"in g&&(r=g.x1),"x2"in g&&(n=g.x2),"x"in g&&(s=g.x),"y"in g&&(h=g.y);var u=c[c.length-1];switch(p){case"M":c.push({command:"M",x:s,y:h});break;case"L":c.push({command:"L",x0:t,y0:i,x:s,y:h});break;case"H":c.push({command:"L",x0:t,y0:i,x:s,y:i});break;case"V":c.push({command:"L",x0:t,y0:i,x:t,y:h});break;case"C":c.push({command:"C",x0:t,y0:i,x1:r,y1:o,x2:n,y2:a,x:s,y:h});break;case"S":if(u){var f=void 0,m={x:2*t-(f="C"===u.command||"S"===u.command?{x:u.x2,y:u.y2}:{x:t,y:i}).x,y:2*i-f.y};c.push({command:"C",x0:t,y0:i,x1:m.x,y1:m.y,x2:n,y2:a,x:s,y:h})}break;case"Q":c.push({command:"Q",x0:t,y0:i,x1:r,y1:o,x:s,y:h});break;case"T":if(u){f=void 0,m={x:2*t-(f="Q"===u.command?{x:u.x1,y:u.y1}:{x:t,y:i}).x,y:2*i-f.y};c.push({command:"Q",x0:t,y0:i,x1:m.x,y1:m.y,x:s,y:h})}break;case"A":var y=g;y.command="A",c.push(y);break;case"Z":case"z":c.push({command:"Z"}),s=t,h=i}t=s,i=h}return c}function p(e,t,i,r,o,n,a,s){var h,d,l,c,p,f,y,v,b;for(p=0,f=0,v=0,y=e.length;v<y;++v){var w=e[v],x=w.command;"x"in w&&(p=w.x),"y"in w&&(f=w.y),"y1"in w&&(d=w.y1),"y2"in w&&(c=w.y2),"x1"in w&&(h=w.x1),"x2"in w&&(l=w.x2),r?(void 0!==p&&(p=u(p,t,o,a)),void 0!==f&&(f=u(f,i,n,s)),void 0!==h&&(h=u(h,t,o,a)),void 0!==d&&(d=u(d,i,n,s)),void 0!==l&&(l=u(l,t,o,a)),void 0!==c&&(c=u(c,i,n,s))):(void 0!==p&&(p=Number((p+t).toFixed(2))),void 0!==f&&(f=Number((f+i).toFixed(2))),void 0!==h&&(h=Number((h+t).toFixed(2))),void 0!==d&&(d=Number((d+i).toFixed(2))),void 0!==l&&(l=Number((l+t).toFixed(2))),void 0!==c&&(c=Number((c+i).toFixed(2)))),(b=g(w,x,{x:p,y:f,x1:h,y1:d,x2:l,y2:c,r1:w.r1,r2:w.r2},r,t,i))&&(e[v]=b)}return m(e)}function g(e,t,i,r,o,n){switch(t){case"M":case"L":e.x=i.x,e.y=i.y;break;case"H":e.x=i.x;break;case"V":e.y=i.y;break;case"C":e.x=i.x,e.y=i.y,e.x1=i.x1,e.y1=i.y1,e.x2=i.x2,e.y2=i.y2;break;case"S":e.x=i.x,e.y=i.y,e.x2=i.x2,e.y2=i.y2;break;case"Q":e.x=i.x,e.y=i.y,e.x1=i.x1,e.y1=i.y1;break;case"T":e.x=i.x,e.y=i.y;break;case"A":var a=i.r1,s=i.r2;r&&(i.r1=a*=o,i.r2=s*=n),e.x=i.x,e.y=i.y,e.r1=i.r1,e.r2=i.r2;break;case"z":case"Z":e={command:"Z"}}return e}function u(e,t,i,r){return e!==i?e=r!==i?e*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(e)*t-(Number(i)*t-Number(i)):r!==i&&(e=r),Number(e.toFixed(2))}function f(e){var t,i,r,o,n,a,s,h,d,l;for(s=0,h=0,l=0,d=e.length;l<d;++l){var c=e[l],p=c.command;if(/[MLHVCSQTA]/.test(p))"x"in c&&(c.x=s=c.x),"y"in c&&(c.y=h=c.y);else{"x1"in c&&(c.x1=r=s+c.x1),"x2"in c&&(c.x2=n=s+c.x2),"y1"in c&&(c.y1=o=h+c.y1),"y2"in c&&(c.y2=a=h+c.y2),"x"in c&&(c.x=s+=c.x),"y"in c&&(c.y=h+=c.y);var g=void 0;switch(p){case"m":case"M":g={command:"M",x:s,y:h};break;case"l":case"L":g={command:"L",x:s,y:h};break;case"h":case"H":g={command:"H",x:s};break;case"v":case"V":g={command:"V",y:h};break;case"c":case"C":g={command:"C",x:s,y:h,x1:r,y1:o,x2:n,y2:a};break;case"s":case"S":g={command:"S",x:s,y:h,x2:n,y2:a};break;case"q":case"Q":g={command:"Q",x:s,y:h,x1:r,y1:o};break;case"t":case"T":g={command:"T",x:s,y:h};break;case"a":case"A":(g={command:"A",x:s,y:h}).r1=c.r1,g.r2=c.r2,g.angle=c.angle,g.largeArc=c.largeArc,g.sweep=c.sweep;break;case"z":case"Z":g={command:"Z"},s=t,h=i,g=e[l]}g&&(e[l]=g)}"M"!==p&&"m"!==p||(t=s,i=h)}return e}function m(e){var t,i="";for(t=0;t<e.length;t++)i+=0===t?y(e[t]):" "+y(e[t]);return i}function y(e){var t="";switch(e.command){case"Z":case"z":t=e.command;break;case"M":case"m":case"L":case"l":t=e.command+" "+e.x+" "+e.y;break;case"C":case"c":t=e.command+" "+e.x1+" "+e.y1+" "+e.x2+" "+e.y2+" "+e.x+" "+e.y;break;case"Q":case"q":t=e.command+" "+e.x1+" "+e.y1+" "+e.x+" "+e.y;break;case"A":case"a":var i=e.command,r=e.angle,o=e.largeArc?"1":"0",n=e.sweep?"1":"0";t=i+" "+e.r1+" "+e.r2+" "+r+" "+o+" "+n+" "+e.x+" "+e.y;break;case"H":case"h":t=e.command+" "+e.x;break;case"V":case"v":t=e.command+" "+e.y;break;case"S":case"s":t=e.command+" "+e.x2+" "+e.y2+" "+e.x+" "+e.y;break;case"T":case"t":t=e.command+" "+e.x+" "+e.y}return t}var v,b=function(){function e(e,t,i,r){this.x=Number.MAX_VALUE,this.y=Number.MAX_VALUE,this.width=0,this.height=0,void 0===e||void 0===t?(e=t=Number.MAX_VALUE,i=r=0):(void 0===i&&(i=0),void 0===r&&(r=0)),this.x=e,this.y=t,this.width=i,this.height=r}return Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return{x:this.left,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return{x:this.right,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return{x:this.left,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return{x:this.right,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"middleLeft",{get:function(){return{x:this.left,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"middleRight",{get:function(){return{x:this.right,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topCenter",{get:function(){return{x:this.x+this.width/2,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomCenter",{get:function(){return{x:this.x+this.width/2,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),e.prototype.equals=function(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},e.prototype.uniteRect=function(e){var t=Math.max(Number.NaN===this.right||this.x===Number.MAX_VALUE?e.right:this.right,e.right),i=Math.max(Number.NaN===this.bottom||this.y===Number.MAX_VALUE?e.bottom:this.bottom,e.bottom);return this.x=Math.min(this.left,e.left),this.y=Math.min(this.top,e.top),this.width=t-this.x,this.height=i-this.y,this},e.prototype.unitePoint=function(e){if(this.x===Number.MAX_VALUE)return this.x=e.x,void(this.y=e.y);var t=Math.min(this.left,e.x),i=Math.min(this.top,e.y),r=Math.max(this.right,e.x),o=Math.max(this.bottom,e.y);this.x=t,this.y=i,this.width=r-this.x,this.height=o-this.y},e.prototype.Inflate=function(e){return this.x-=e,this.y-=e,this.width+=2*e,this.height+=2*e,this},e.prototype.intersects=function(e){return!(this.right<e.left||this.left>e.right||this.top>e.bottom||this.bottom<e.top)},e.prototype.containsRect=function(e){return this.left<=e.left&&this.right>=e.right&&this.top<=e.top&&this.bottom>=e.bottom},e.prototype.containsPoint=function(e,t){return void 0===t&&(t=0),this.left-t<=e.x&&this.right+t>=e.x&&this.top-t<=e.y&&this.bottom+t>=e.y},e.toBounds=function(t){for(var i=new e,r=0,o=t;r<o.length;r++){var n=o[r];i.unitePoint(n)}return i},e.empty=new e(Number.MAX_VALUE,Number.MIN_VALUE,0,0),e}();(v=e.MatrixTypes||(e.MatrixTypes={}))[v.Identity=0]="Identity",v[v.Translation=1]="Translation",v[v.Scaling=2]="Scaling",v[v.Unknown=4]="Unknown";var w=function(e,t,i,r,o,n,a){this.m11=e,this.m12=t,this.m21=i,this.m22=r,this.offsetX=o,this.offsetY=n,this.type=a};function x(){return new w(1,0,0,1,0,0,e.MatrixTypes.Identity)}function C(t,i){var r=function(t,i,r){switch(t.type){case e.MatrixTypes.Identity:break;case e.MatrixTypes.Translation:i+=t.offsetX,r+=t.offsetY;break;case e.MatrixTypes.Scaling:i*=t.m11,r*=t.m22;break;case e.MatrixTypes.Translation|e.MatrixTypes.Scaling:i*=t.m11,i+=t.offsetX,r*=t.m22,r+=t.offsetY;break;default:var o=r*t.m21+t.offsetX,n=i*t.m12+t.offsetY;i*=t.m11,i+=o,r*=t.m22,r+=n}return{x:i,y:r}}(t,i.x,i.y);return{x:Math.round(100*r.x)/100,y:Math.round(100*r.y)/100}}function S(e,t){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push(C(e,n))}return i}function P(t,i,r,o){z(t,function(t,i,r){var o=x(),n=Math.sin(t),a=Math.cos(t),s=i*(1-a)+r*n,h=r*(1-a)-i*n;return o.type=e.MatrixTypes.Unknown,O(o,a,n,-n,a,s,h),o}(.017453292519943295*(i%=360),r||0,o||0))}function T(t,i,r,o,n){void 0===o&&(o=0),void 0===n&&(n=0),z(t,function(t,i,r,o){var n=x();return n.type=r||o?e.MatrixTypes.Scaling|e.MatrixTypes.Translation:e.MatrixTypes.Scaling,O(n,t,0,0,i,r-t*r,o-i*o),n}(i,r,o,n))}function A(t,i,r){return t.type&e.MatrixTypes.Identity?(t.type=e.MatrixTypes.Translation,void O(t,1,0,0,1,i,r)):t.type&e.MatrixTypes.Unknown?(t.offsetX+=i,void(t.offsetY+=r)):(t.offsetX+=i,t.offsetY+=r,void(t.type|=e.MatrixTypes.Translation))}function z(t,i){var r=t.type,o=i.type;if(o!==e.MatrixTypes.Identity){if(r===e.MatrixTypes.Identity)return I(t,i),void(t.type=i.type);if(o===e.MatrixTypes.Translation)return t.offsetX+=i.offsetX,t.offsetY+=i.offsetY,void(r!==e.MatrixTypes.Unknown&&(t.type|=e.MatrixTypes.Translation));if(r!==e.MatrixTypes.Translation){var n=r<<4|o;switch(n){case 34:return t.m11*=i.m11,void(t.m22*=i.m22);case 35:return t.m11*=i.m11,t.m22*=i.m22,t.offsetX=i.offsetX,t.offsetY=i.offsetY,void(t.type=e.MatrixTypes.Translation|e.MatrixTypes.Scaling);case 36:break;default:switch(n){case 50:return t.m11*=i.m11,t.m22*=i.m22,t.offsetX*=i.m11,void(t.offsetY*=i.m22);case 51:return t.m11*=i.m11,t.m22*=i.m22,t.offsetX=i.m11*t.offsetX+i.offsetX,void(t.offsetY=i.m22*t.offsetY+i.offsetY);case 52:break;default:switch(n){case 66:case 67:case 68:break;default:return}}}var a=x();return O(a,t.m11*i.m11+t.m12*i.m21,t.m11*i.m12+t.m12*i.m22,t.m21*i.m11+t.m22*i.m21,t.m21*i.m12+t.m22*i.m22,t.offsetX*i.m11+t.offsetY*i.m21+i.offsetX,t.offsetX*i.m12+t.offsetY*i.m22+i.offsetY),a.m21||a.m12?a.type=e.MatrixTypes.Unknown:((a.m11&&1!==a.m11||a.m22&&1!==a.m22)&&(a.type=e.MatrixTypes.Scaling),(a.offsetX||a.offsetY)&&(a.type|=e.MatrixTypes.Translation),(a.type&(e.MatrixTypes.Translation|e.MatrixTypes.Scaling))===e.MatrixTypes.Identity&&(a.type=e.MatrixTypes.Identity),a.type=e.MatrixTypes.Scaling|e.MatrixTypes.Translation),I(t,a),void(t.type=a.type)}var s=t.offsetX,h=t.offsetY;t.offsetX=s*i.m11+h*i.m21+i.offsetX,t.offsetY=s*i.m12+h*i.m22+i.offsetY,o!==e.MatrixTypes.Unknown?t.type=e.MatrixTypes.Translation|e.MatrixTypes.Scaling:t.type=e.MatrixTypes.Unknown}}function O(e,t,i,r,o,n,a){e.m11=t,e.m12=i,e.m21=r,e.m22=o,e.offsetX=n,e.offsetY=a}function I(e,t){e.m11=t.m11,e.m12=t.m12,e.m21=t.m21,e.m22=t.m22,e.offsetX=t.offsetX,e.offsetY=t.offsetY,e.type=t.type}var D,E,B,L,M,k,R,N,j,H,W,_,V,X,Y,U,G,F,Z,q,K,Q,J,$,ee,te=(D=function(e,t){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}D(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ie=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},re=function(e){if(e){if(sf.base.isBlazor())return de;switch(e.type){case"Linear":return le;case"Radial":return ce;default:return le}}return le},oe=function(e,t,i,r){this.left=e,this.right=t,this.top=i,this.bottom=r},ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property(0)],t.prototype,"left",void 0),ie([sf.base.Property(0)],t.prototype,"right",void 0),ie([sf.base.Property(0)],t.prototype,"top",void 0),ie([sf.base.Property(0)],t.prototype,"bottom",void 0),t}(sf.base.ChildProperty),ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property(45)],t.prototype,"angle",void 0),ie([sf.base.Property(5)],t.prototype,"distance",void 0),ie([sf.base.Property(.7)],t.prototype,"opacity",void 0),ie([sf.base.Property("lightgrey")],t.prototype,"color",void 0),t}(sf.base.ChildProperty),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),t.prototype.getClassName=function(){return"Stop"},ie([sf.base.Property("")],t.prototype,"color",void 0),ie([sf.base.Property(0)],t.prototype,"offset",void 0),ie([sf.base.Property(1)],t.prototype,"opacity",void 0),t}(sf.base.ChildProperty),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Collection([],se)],t.prototype,"stops",void 0),ie([sf.base.Property("None")],t.prototype,"type",void 0),ie([sf.base.Property("")],t.prototype,"id",void 0),t}(sf.base.ChildProperty),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property(0)],t.prototype,"x1",void 0),ie([sf.base.Property(0)],t.prototype,"x2",void 0),ie([sf.base.Property(0)],t.prototype,"y1",void 0),ie([sf.base.Property(0)],t.prototype,"y2",void 0),ie([sf.base.Property(0)],t.prototype,"cx",void 0),ie([sf.base.Property(0)],t.prototype,"cy",void 0),ie([sf.base.Property(0)],t.prototype,"fx",void 0),ie([sf.base.Property(0)],t.prototype,"fy",void 0),ie([sf.base.Property(50)],t.prototype,"r",void 0),t}(he),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property(0)],t.prototype,"x1",void 0),ie([sf.base.Property(0)],t.prototype,"x2",void 0),ie([sf.base.Property(0)],t.prototype,"y1",void 0),ie([sf.base.Property(0)],t.prototype,"y2",void 0),t}(he),ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property(0)],t.prototype,"cx",void 0),ie([sf.base.Property(0)],t.prototype,"cy",void 0),ie([sf.base.Property(0)],t.prototype,"fx",void 0),ie([sf.base.Property(0)],t.prototype,"fy",void 0),ie([sf.base.Property(50)],t.prototype,"r",void 0),t}(he),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property("white")],t.prototype,"fill",void 0),ie([sf.base.Property("black")],t.prototype,"strokeColor",void 0),ie([sf.base.Property("")],t.prototype,"strokeDashArray",void 0),ie([sf.base.Property(1)],t.prototype,"strokeWidth",void 0),ie([sf.base.Property(1)],t.prototype,"opacity",void 0),ie([sf.base.ComplexFactory(re)],t.prototype,"gradient",void 0),t}(sf.base.ChildProperty),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property("transparent")],t.prototype,"fill",void 0),t}(pe),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property("black")],t.prototype,"color",void 0),ie([sf.base.Property("Arial")],t.prototype,"fontFamily",void 0),ie([sf.base.Property(12)],t.prototype,"fontSize",void 0),ie([sf.base.Property(!1)],t.prototype,"italic",void 0),ie([sf.base.Property(!1)],t.prototype,"bold",void 0),ie([sf.base.Property("CollapseSpace")],t.prototype,"whiteSpace",void 0),ie([sf.base.Property("WrapWithOverflow")],t.prototype,"textWrapping",void 0),ie([sf.base.Property("Center")],t.prototype,"textAlign",void 0),ie([sf.base.Property("None")],t.prototype,"textDecoration",void 0),ie([sf.base.Property("Wrap")],t.prototype,"textOverflow",void 0),ie([sf.base.Property("transparent")],t.prototype,"fill",void 0),t}(pe),fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),ie([sf.base.Property("white")],t.prototype,"fill",void 0),ie([sf.base.Property("Wrap")],t.prototype,"textOverflow",void 0),ie([sf.base.Property(1)],t.prototype,"strokeWidth",void 0),ie([sf.base.ComplexFactory(re)],t.prototype,"gradient",void 0),ie([sf.base.Property(1)],t.prototype,"opacity",void 0),ie([sf.base.Property(!1)],t.prototype,"italic",void 0),ie([sf.base.Property("")],t.prototype,"strokeDashArray",void 0),ie([sf.base.Property("black")],t.prototype,"color",void 0),ie([sf.base.Property(12)],t.prototype,"fontSize",void 0),ie([sf.base.Property("Arial")],t.prototype,"fontFamily",void 0),ie([sf.base.Property("CollapseSpace")],t.prototype,"whiteSpace",void 0),ie([sf.base.Property("Center")],t.prototype,"textAlign",void 0),ie([sf.base.Property("None")],t.prototype,"textDecoration",void 0),ie([sf.base.Property(!1)],t.prototype,"bold",void 0),ie([sf.base.Property("black")],t.prototype,"strokeColor",void 0),ie([sf.base.Property("WrapWithOverflow")],t.prototype,"textWrapping",void 0),t}(sf.base.ChildProperty);(E=e.BlazorAction||(e.BlazorAction={}))[E.Default=0]="Default",E[E.expandNode=2]="expandNode",E[E.interaction=4]="interaction",E[E.GroupingInProgress=8]="GroupingInProgress",E[E.GroupClipboardInProcess=16]="GroupClipboardInProcess",E[E.ClearObject=32]="ClearObject",(B=e.PortVisibility||(e.PortVisibility={}))[B.Visible=1]="Visible",B[B.Hidden=2]="Hidden",B[B.Hover=4]="Hover",B[B.Connect=8]="Connect",(L=e.SnapConstraints||(e.SnapConstraints={}))[L.None=0]="None",L[L.ShowHorizontalLines=1]="ShowHorizontalLines",L[L.ShowVerticalLines=2]="ShowVerticalLines",L[L.ShowLines=3]="ShowLines",L[L.SnapToHorizontalLines=4]="SnapToHorizontalLines",L[L.SnapToVerticalLines=8]="SnapToVerticalLines",L[L.SnapToLines=12]="SnapToLines",L[L.SnapToObject=16]="SnapToObject",L[L.All=31]="All",(M=e.SelectorConstraints||(e.SelectorConstraints={}))[M.None=1]="None",M[M.ConnectorSourceThumb=2]="ConnectorSourceThumb",M[M.ConnectorTargetThumb=4]="ConnectorTargetThumb",M[M.ResizeSouthEast=8]="ResizeSouthEast",M[M.ResizeSouthWest=16]="ResizeSouthWest",M[M.ResizeNorthEast=32]="ResizeNorthEast",M[M.ResizeNorthWest=64]="ResizeNorthWest",M[M.ResizeEast=128]="ResizeEast",M[M.ResizeWest=256]="ResizeWest",M[M.ResizeSouth=512]="ResizeSouth",M[M.ResizeNorth=1024]="ResizeNorth",M[M.Rotate=2048]="Rotate",M[M.UserHandle=4096]="UserHandle",M[M.ToolTip=8192]="ToolTip",M[M.ResizeAll=2046]="ResizeAll",M[M.All=16382]="All",(k=e.ConnectionPointOrigin||(e.ConnectionPointOrigin={})).SamePoint="SamePoint",k.DifferentPoint="DifferentPoint",(R=e.ChildArrangement||(e.ChildArrangement={})).Linear="Linear",R.Nonlinear="Nonlinear",(N=e.ConnectorConstraints||(e.ConnectorConstraints={}))[N.None=1]="None",N[N.Select=2]="Select",N[N.Delete=4]="Delete",N[N.Drag=8]="Drag",N[N.DragSourceEnd=16]="DragSourceEnd",N[N.DragTargetEnd=32]="DragTargetEnd",N[N.DragSegmentThumb=64]="DragSegmentThumb",N[N.AllowDrop=128]="AllowDrop",N[N.Bridging=256]="Bridging",N[N.BridgeObstacle=512]="BridgeObstacle",N[N.InheritBridging=1024]="InheritBridging",N[N.PointerEvents=2048]="PointerEvents",N[N.Tooltip=4096]="Tooltip",N[N.InheritTooltip=8192]="InheritTooltip",N[N.Interaction=4218]="Interaction",N[N.ReadOnly=16384]="ReadOnly",N[N.LineRouting=32768]="LineRouting",N[N.InheritLineRouting=65536]="InheritLineRouting",N[N.ConnectToNearByNode=131072]="ConnectToNearByNode",N[N.ConnectToNearByPort=262144]="ConnectToNearByPort",N[N.ConnectToNearByElement=393216]="ConnectToNearByElement",N[N.Default=470590]="Default",(j=e.AnnotationConstraints||(e.AnnotationConstraints={}))[j.ReadOnly=2]="ReadOnly",j[j.InheritReadOnly=4]="InheritReadOnly",j[j.Select=8]="Select",j[j.Drag=16]="Drag",j[j.Resize=32]="Resize",j[j.Rotate=64]="Rotate",j[j.Interaction=120]="Interaction",j[j.None=0]="None",(H=e.NodeConstraints||(e.NodeConstraints={}))[H.None=0]="None",H[H.Select=2]="Select",H[H.Drag=4]="Drag",H[H.Rotate=8]="Rotate",H[H.Shadow=16]="Shadow",H[H.PointerEvents=32]="PointerEvents",H[H.Delete=64]="Delete",H[H.InConnect=128]="InConnect",H[H.OutConnect=256]="OutConnect",H[H.Individual=512]="Individual",H[H.Expandable=1024]="Expandable",H[H.AllowDrop=2048]="AllowDrop",H[H.Inherit=78]="Inherit",H[H.ResizeNorthEast=4096]="ResizeNorthEast",H[H.ResizeEast=8192]="ResizeEast",H[H.ResizeSouthEast=16384]="ResizeSouthEast",H[H.ResizeSouth=32768]="ResizeSouth",H[H.ResizeSouthWest=65536]="ResizeSouthWest",H[H.ResizeWest=131072]="ResizeWest",H[H.ResizeNorthWest=262144]="ResizeNorthWest",H[H.ResizeNorth=524288]="ResizeNorth",H[H.Resize=1044480]="Resize",H[H.AspectRatio=1048576]="AspectRatio",H[H.Tooltip=2097152]="Tooltip",H[H.InheritTooltip=4194304]="InheritTooltip",H[H.ReadOnly=8388608]="ReadOnly",H[H.HideThumbs=16777216]="HideThumbs",H[H.AllowMovingOutsideLane=33554432]="AllowMovingOutsideLane",H[H.Default=5240814]="Default",(W=e.ElementAction||(e.ElementAction={}))[W.None=0]="None",W[W.ElementIsPort=2]="ElementIsPort",W[W.ElementIsGroup=4]="ElementIsGroup",W[W.HorizontalLaneHeader=8]="HorizontalLaneHeader",(_=e.ThumbsConstraints||(e.ThumbsConstraints={}))[_.Rotate=2]="Rotate",_[_.ConnectorSource=4]="ConnectorSource",_[_.ConnectorTarget=8]="ConnectorTarget",_[_.ResizeNorthEast=16]="ResizeNorthEast",_[_.ResizeEast=32]="ResizeEast",_[_.ResizeSouthEast=64]="ResizeSouthEast",_[_.ResizeSouth=128]="ResizeSouth",_[_.ResizeSouthWest=256]="ResizeSouthWest",_[_.ResizeWest=512]="ResizeWest",_[_.ResizeNorthWest=1024]="ResizeNorthWest",_[_.ResizeNorth=2048]="ResizeNorth",_[_.Default=4094]="Default",(V=e.DiagramConstraints||(e.DiagramConstraints={}))[V.None=1]="None",V[V.Bridging=2]="Bridging",V[V.UndoRedo=4]="UndoRedo",V[V.Tooltip=8]="Tooltip",V[V.UserInteraction=16]="UserInteraction",V[V.ApiUpdate=32]="ApiUpdate",V[V.PageEditable=48]="PageEditable",V[V.Zoom=64]="Zoom",V[V.PanX=128]="PanX",V[V.PanY=256]="PanY",V[V.Pan=384]="Pan",V[V.ZoomTextEdit=512]="ZoomTextEdit",V[V.Virtualization=1024]="Virtualization",V[V.LineRouting=2048]="LineRouting",V[V.Default=500]="Default",(X=e.DiagramTools||(e.DiagramTools={}))[X.None=0]="None",X[X.SingleSelect=1]="SingleSelect",X[X.MultipleSelect=2]="MultipleSelect",X[X.ZoomPan=4]="ZoomPan",X[X.DrawOnce=8]="DrawOnce",X[X.ContinuousDraw=16]="ContinuousDraw",X[X.Default=3]="Default",(Y=e.Transform||(e.Transform={}))[Y.Self=1]="Self",Y[Y.Parent=2]="Parent",(U=e.RenderMode||(e.RenderMode={}))[U.Canvas=0]="Canvas",U[U.Svg=1]="Svg",(G=e.KeyModifiers||(e.KeyModifiers={}))[G.None=0]="None",G[G.Control=1]="Control",G[G.Meta=1]="Meta",G[G.Alt=2]="Alt",G[G.Shift=4]="Shift",(F=e.Keys||(e.Keys={}))[F.None=null]="None",F[F.Number0=0]="Number0",F[F.Number1=1]="Number1",F[F.Number2=2]="Number2",F[F.Number3=3]="Number3",F[F.Number4=4]="Number4",F[F.Number5=5]="Number5",F[F.Number6=6]="Number6",F[F.Number7=7]="Number7",F[F.Number8=8]="Number8",F[F.Number9=9]="Number9",F[F.A=65]="A",F[F.B=66]="B",F[F.C=67]="C",F[F.D=68]="D",F[F.E=69]="E",F[F.F=70]="F",F[F.G=71]="G",F[F.H=72]="H",F[F.I=73]="I",F[F.J=74]="J",F[F.K=75]="K",F[F.L=76]="L",F[F.M=77]="M",F[F.N=78]="N",F[F.O=79]="O",F[F.P=80]="P",F[F.Q=81]="Q",F[F.R=82]="R",F[F.S=83]="S",F[F.T=84]="T",F[F.U=85]="U",F[F.V=86]="V",F[F.W=87]="W",F[F.X=88]="X",F[F.Y=89]="Y",F[F.Z=90]="Z",F[F.Left=37]="Left",F[F.Up=38]="Up",F[F.Right=39]="Right",F[F.Down=40]="Down",F[F.Escape=27]="Escape",F[F.Space=32]="Space",F[F.PageUp=33]="PageUp",F[F.PageDown=34]="PageDown",F[F.End=35]="End",F[F.Home=36]="Home",F[F.Delete=46]="Delete",F[F.Tab=9]="Tab",F[F.Enter=13]="Enter",F[F.BackSpace=8]="BackSpace",F[F.F1=112]="F1",F[F.F2=113]="F2",F[F.F3=114]="F3",F[F.F4=115]="F4",F[F.F5=116]="F5",F[F.F6=117]="F6",F[F.F7=118]="F7",F[F.F8=119]="F8",F[F.F9=120]="F9",F[F.F10=121]="F10",F[F.F11=122]="F11",F[F.F12=123]="F12",F[F.Star=56]="Star",F[F.Plus=187]="Plus",F[F.Minus=189]="Minus",(Z=e.DiagramAction||(e.DiagramAction={}))[Z.Render=2]="Render",Z[Z.PublicMethod=4]="PublicMethod",Z[Z.ToolAction=8]="ToolAction",Z[Z.UndoRedo=16]="UndoRedo",Z[Z.TextEdit=32]="TextEdit",Z[Z.Group=64]="Group",Z[Z.Clear=128]="Clear",Z[Z.PreventClearSelection=256]="PreventClearSelection",Z[Z.Interactions=512]="Interactions",Z[Z.PreventHistory=1024]="PreventHistory",Z[Z.PreventIconsUpdate=2048]="PreventIconsUpdate",Z[Z.PreventCollectionChangeOnDragOver=4096]="PreventCollectionChangeOnDragOver",Z[Z.PreventZIndexOnDragging=8192]="PreventZIndexOnDragging",Z[Z.isGroupDragging=16384]="isGroupDragging",Z[Z.DragUsingMouse=32768]="DragUsingMouse",Z[Z.DecoratorPropertyChange=65536]="DecoratorPropertyChange",Z[Z.PreventLaneContainerUpdate=131072]="PreventLaneContainerUpdate",(q=e.RendererAction||(e.RendererAction={}))[q.None=2]="None",q[q.DrawSelectorBorder=4]="DrawSelectorBorder",q[q.PreventRenderSelector=8]="PreventRenderSelector",(K=e.RealAction||(e.RealAction={}))[K.None=0]="None",K[K.PreventDrag=2]="PreventDrag",K[K.PreventScale=4]="PreventScale",K[K.PreventDataInit=8]="PreventDataInit",K[K.hScrollbarMoved=16]="hScrollbarMoved",K[K.vScrollbarMoved=32]="vScrollbarMoved",K[K.AnimationClick=64]="AnimationClick",K[K.EnableGroupAction=128]="EnableGroupAction",K[K.PanInProgress=256]="PanInProgress",K[K.OverViewAction=512]="OverViewAction",(Q=e.ScrollActions||(e.ScrollActions={}))[Q.None=0]="None",Q[Q.PropertyChange=1024]="PropertyChange",Q[Q.Interaction=2048]="Interaction",(J=e.NoOfSegments||(e.NoOfSegments={}))[J.Zero=0]="Zero",J[J.One=1]="One",J[J.Two=2]="Two",J[J.Three=3]="Three",J[J.Four=4]="Four",J[J.Five=5]="Five",($=e.DiagramEvent||(e.DiagramEvent={}))[$.collectionChange=0]="collectionChange",$[$.rotateChange=1]="rotateChange",$[$.positionChange=2]="positionChange",$[$.propertyChange=3]="propertyChange",$[$.selectionChange=4]="selectionChange",$[$.sizeChange=5]="sizeChange",$[$.drop=6]="drop",$[$.sourcePointChange=7]="sourcePointChange",$[$.targetPointChange=8]="targetPointChange",$[$.connectionChange=9]="connectionChange",$[$.animationComplete=10]="animationComplete",$[$.click=11]="click",$[$.doubleClick=12]="doubleClick",$[$.scrollChange=13]="scrollChange",$[$.dragEnter=14]="dragEnter",$[$.dragLeave=15]="dragLeave",$[$.dragOver=16]="dragOver",$[$.textEdit=17]="textEdit",$[$.paletteSelectionChange=18]="paletteSelectionChange",$[$.historyChange=19]="historyChange",$[$.mouseEnter=20]="mouseEnter",$[$.mouseLeave=21]="mouseLeave",$[$.mouseOver=22]="mouseOver",$[$.expandStateChange=23]="expandStateChange",$[$.segmentCollectionChange=24]="segmentCollectionChange",$[$.commandExecute=25]="commandExecute",$[$.historyStateChange=26]="historyStateChange",$[$.onUserHandleMouseDown=27]="onUserHandleMouseDown",$[$.onUserHandleMouseUp=28]="onUserHandleMouseUp",$[$.onUserHandleMouseEnter=29]="onUserHandleMouseEnter",$[$.onUserHandleMouseLeave=30]="onUserHandleMouseLeave",$[$.onImageLoad=31]="onImageLoad",$[$.onDoBindingInit=32]="onDoBindingInit",$[$.keyUp=33]="keyUp",$[$.keyDown=34]="keyDown",$[$.fixedUserHandleClick=35]="fixedUserHandleClick",(ee=e.PortConstraints||(e.PortConstraints={}))[ee.None=1]="None",ee[ee.Drag=2]="Drag",ee[ee.Draw=4]="Draw",ee[ee.InConnect=8]="InConnect",ee[ee.OutConnect=16]="OutConnect",ee[ee.Default=24]="Default";var me,ye,ve,be=function(){function t(){this.pivot={x:.5,y:.5},this.isDirt=!0,this.isExport=!1,this.exportScaleValue={x:0,y:0},this.exportScaleOffset={x:0,y:0},this.canApplyStyle=!0,this.visible=!0,this.offsetX=0,this.offsetY=0,this.cornerRadius=0,this.minHeight=void 0,this.minWidth=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this.width=void 0,this.height=void 0,this.rotateAngle=0,this.margin={left:0,right:0,top:0,bottom:0},this.horizontalAlignment="Auto",this.verticalAlignment="Auto",this.flip="None",this.relativeMode="Point",this.transform=e.Transform.Self|e.Transform.Parent,this.style={fill:"white",strokeColor:"black",opacity:1,strokeWidth:1},this.desiredSize=new i,this.actualSize=new i,this.parentTransform=0,this.preventContainer=!1,this.isSvgRender=!1,this.bounds=new b(0,0,0,0),this.shadow=null,this.description="",this.staticSize=!1,this.isRectElement=!1,this.isCalculateDesiredSize=!0,this.flipOffset={x:0,y:0},this.elementActions=e.ElementAction.None,this.inversedAlignment=!0,this.position=void 0,this.unitMode=void 0,this.float=!1,this.floatingBounds=void 0}return t.prototype.setOffsetWithRespectToBounds=function(e,t,i){this.unitMode=i,this.position={x:e,y:t}},t.prototype.getAbsolutePosition=function(e){if(void 0!==this.position)return"Absolute"===this.unitMode?this.position:{x:this.position.x*e.width,y:this.position.y*e.height}},Object.defineProperty(t.prototype,"outerBounds",{get:function(){return this.floatingBounds||this.bounds},set:function(e){this.floatingBounds=e},enumerable:!0,configurable:!0}),t.prototype.measure=function(t,r,o){var n=void 0!==this.width?this.width:(t.width||0)-this.margin.left-this.margin.right,a=void 0!==this.height?this.height:(t.height||0)-this.margin.top-this.margin.bottom;return this.id&&0===a&&this.elementActions&e.ElementAction.HorizontalLaneHeader&&(a=this.actualSize.height),this.desiredSize=new i(n,a),this.isCalculateDesiredSize&&(this.desiredSize=this.validateDesiredSize(this.desiredSize,t)),this.desiredSize},t.prototype.arrange=function(e){return this.actualSize=e,this.updateBounds(),this.actualSize},t.prototype.updateBounds=function(){this.bounds=Th(this)},t.prototype.validateDesiredSize=function(e,t){return!this.isRectElement||this.width||this.minWidth||this.maxWidth||(e.width=50),!this.isRectElement||this.height||this.minHeight||this.maxHeight||(e.height=50),(void 0===e||void 0!==this.width&&void 0!==this.height)&&((e=e||new i).width=void 0===this.width?(t.width||0)-this.margin.left-this.margin.right:this.width,e.height=void 0===this.height?(t.height||0)-this.margin.top-this.margin.bottom:this.height),void 0!==this.minWidth&&(e.width=Math.max(e.width,this.minWidth)),void 0!==this.minHeight&&(e.height=Math.max(e.height,this.minHeight)),void 0!==this.maxWidth&&0!==this.maxWidth&&(e.width=Math.min(e.width,this.maxWidth)),void 0!==this.maxHeight&&0!==this.maxHeight&&(e.height=Math.min(e.height,this.maxHeight)),e},t}(),we=(me=function(e,t){return(me=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}me(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),xe=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.padding=new oe(0,0,0,0),e.desiredBounds=void 0,e.measureChildren=!0,e.prevRotateAngle=0,e}return we(r,t),r.prototype.hasChildren=function(){return void 0!==this.children&&this.children.length>0},r.prototype.measure=function(e,t,o){this.desiredBounds=void 0;var n,a,s=void 0;if(this.hasChildren()){for(var h=0;h<this.children.length;h++){"Stretch"!==(n=this.children[h]).horizontalAlignment||e.width||(e.width=n.bounds.width),"Stretch"!==n.verticalAlignment||e.height||(e.height=n.bounds.height);var d="Stretch"===n.horizontalAlignment||"Stretch"===n.verticalAlignment;(this.measureChildren||d||n instanceof r&&void 0!==n.measureChildren)&&n.measure(e,t,o),a=this.GetChildrenBounds(n),"Stretch"!==n.horizontalAlignment&&"Stretch"!==n.verticalAlignment?void 0===this.desiredBounds?this.desiredBounds=a:this.desiredBounds.uniteRect(a):!this.actualSize||this.actualSize.width||this.actualSize.height||n.preventContainer||"Stretch"!==n.horizontalAlignment||"Stretch"!==n.verticalAlignment||(void 0===this.desiredBounds?this.desiredBounds=n.bounds:this.desiredBounds.uniteRect(n.bounds))}if(void 0!==this.desiredBounds&&0!==this.rotateAngle){var l={x:this.desiredBounds.x+this.desiredBounds.width*this.pivot.x,y:this.desiredBounds.y+this.desiredBounds.height*this.pivot.y},c=jh(this.rotateAngle,void 0,void 0,l);this.desiredBounds.x=c.x-this.desiredBounds.width*this.pivot.x,this.desiredBounds.y=c.y-this.desiredBounds.height*this.pivot.y}this.desiredBounds&&(s=new i(this.desiredBounds.width,this.desiredBounds.height))}return s=this.validateDesiredSize(s,e),this.stretchChildren(s),this.desiredSize=s,s},r.prototype.arrange=function(t){var i,o=this.desiredBounds;if(o){this.offsetX,this.offsetY;if(this.offsetX=o.x+o.width*this.pivot.x,this.offsetY=o.y+o.height*this.pivot.y,this.hasChildren())for(var n=0;n<this.children.length;n++){var a=!1;"Stretch"===(i=this.children[n]).horizontalAlignment&&(i.offsetX=this.offsetX,i.parentTransform=this.parentTransform+this.rotateAngle,this.flip&&this.elementActions&e.ElementAction.ElementIsGroup&&(i.parentTransform="Horizontal"===this.flip||"Vertical"===this.flip?-i.parentTransform:i.parentTransform),a=!0),"Stretch"===i.verticalAlignment&&(i.offsetY=this.offsetY,i.parentTransform=this.parentTransform+this.rotateAngle,a=!0),(a||this.measureChildren||i instanceof r&&void 0!==i.measureChildren)&&i.arrange(i.desiredSize)}}return this.actualSize=t,this.updateBounds(),this.prevRotateAngle=this.rotateAngle,t},r.prototype.stretchChildren=function(e){if(this.hasChildren())for(var t=0,i=this.children;t<i.length;t++){var o=i[t];"Stretch"!==o.horizontalAlignment&&void 0!==o.desiredSize.width||(o.desiredSize.width=e.width-o.margin.left-o.margin.right),"Stretch"!==o.verticalAlignment&&void 0!==o.desiredSize.height||(o.desiredSize.height=e.height-o.margin.top-o.margin.bottom),o instanceof r&&o.stretchChildren(o.desiredSize)}},r.prototype.applyPadding=function(e){e.width+=this.padding.left+this.padding.right,e.height+=this.padding.top+this.padding.bottom},r.prototype.findChildOffsetFromCenter=function(e,t){var i=Hh({x:t.x-e.desiredSize.width/2,y:t.y-e.desiredSize.height/2},e);i=jh(e.rotateAngle,t.x,t.y,i),i=jh(this.rotateAngle+this.parentTransform,this.offsetX,this.offsetY,i),e.offsetX=i.x,e.offsetY=i.y},r.prototype.GetChildrenBounds=function(e){var t=e.desiredSize.clone(),i=(e.rotateAngle,this.rotateAngle,e.offsetX),r=e.offsetY,o=i-t.width*e.pivot.x,n=r-t.height*e.pivot.y,a=o+t.width,s=n+t.height,h={x:o,y:n},d={x:a,y:n},l={x:o,y:s},c={x:a,y:s};return h=jh(e.rotateAngle,e.offsetX,e.offsetY,h),d=jh(e.rotateAngle,e.offsetX,e.offsetY,d),l=jh(e.rotateAngle,e.offsetX,e.offsetY,l),c=jh(e.rotateAngle,e.offsetX,e.offsetY,c),0!==this.rotateAngle&&(h=jh(-this.rotateAngle,void 0,void 0,h),d=jh(-this.rotateAngle,void 0,void 0,d),l=jh(-this.rotateAngle,void 0,void 0,l),c=jh(-this.rotateAngle,void 0,void 0,c)),b.toBounds([h,d,l,c])},r}(be),Ce=(ye=function(e,t){return(ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ye(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Se=function(e){function t(){var t=e.call(this)||this;return t.textContent="",t.canMeasure=!0,t.isLaneOrientation=!1,t.canConsiderBounds=!0,t.hyperlink={color:"blue"},t.doWrap=!0,t.textNodes=[],t.style={color:"black",fill:"transparent",strokeColor:"black",strokeWidth:1,fontFamily:"Arial",fontSize:12,whiteSpace:"CollapseSpace",textWrapping:"WrapWithOverflow",textAlign:"Center",italic:!1,bold:!1,textDecoration:"None",strokeDashArray:"",opacity:5,gradient:null,textOverflow:"Wrap"},t.style.fill="transparent",t.style.strokeColor="transparent",t}return Ce(t,e),Object.defineProperty(t.prototype,"content",{get:function(){return this.textContent},set:function(e){this.textContent!==e&&(this.textContent=e,this.isDirt=!0,this.doWrap=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.textNodes},set:function(e){this.textNodes=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapBounds",{get:function(){return this.textWrapBounds},set:function(e){this.textWrapBounds=e},enumerable:!0,configurable:!0}),t.prototype.refreshTextElement=function(){this.isDirt=!0},t.prototype.measure=function(e){var t;return t=this.isDirt&&this.canMeasure?function(e,t,r,o,n){var a,s,h=new i(0,0),d=function(e,t){var i={fill:e.style.fill,stroke:e.style.strokeColor,angle:e.rotateAngle+e.parentTransform,pivotX:e.pivot.x,pivotY:e.pivot.y,strokeWidth:e.style.strokeWidth,dashArray:e.style.strokeDashArray,opacity:e.style.opacity,shadow:e.shadow,gradient:e.style.gradient,visible:e.visible,id:e.id,description:e.description,width:t||e.actualSize.width,height:e.actualSize.height,x:e.offsetX-e.actualSize.width*e.pivot.x+.5,y:e.offsetY-e.actualSize.height*e.pivot.y+.5};return i.fontSize=e.style.fontSize,i.fontFamily=e.style.fontFamily,i.textOverflow=e.style.textOverflow,i.textDecoration=e.style.textDecoration,i.doWrap=e.doWrap,i.whiteSpace=Rh(e.style.whiteSpace,e.style.textWrapping),i.content=e.content,i.textWrapping=e.style.textWrapping,i.breakWord=Bh(e.style.textWrapping),i.textAlign=Eh(e.style.textAlign),i.color=e.style.color,i.italic=e.style.italic,i.bold=e.style.bold,i.dashArray="",i.strokeWidth=0,i.fill="",i}(e,o);e.childNodes=a=function(e,t,i){var r,o,n=[],a=0,s=t||e.content;if("nowrap"!==e.whiteSpace&&"pre"!==e.whiteSpace)if("breakall"===e.breakWord)for(r="",r+=s[0],a=0;a<s.length;a++)if((o=Lh(r,e))>=e.width&&r.length>0)n[n.length]={text:r,x:0,dy:0,width:o},r="";else{(r+=s[a+1]||"").indexOf("\n")>-1&&(n[n.length]={text:r,x:0,dy:0,width:Lh(r,e)},r="");var h=Lh(r,e);Math.ceil(h)+2>=e.width&&r.length>0&&(n[n.length]={text:r,x:0,dy:0,width:h},r=""),a===s.length-1&&r.length>0&&(n[n.length]={text:r,x:0,dy:0,width:h},r="")}else n=function(e,t,i){var r,o,n,a,s=[],h="",d=0,l=0,c="nowrap"!==e.whiteSpace,p=(t||e.content).split("\n");for(d=0;d<p.length;d++)for(r="NoWrap"!==e.textWrapping?p[d].split(" "):"NoWrap"===e.textWrapping?[p[d]]:p,l=0;l<r.length;l++){h+=((0!==l||1===r.length)&&c&&h.length>0?" ":"")+r[l];var g=Lh(o=h+" "+(r[l+1]||""),e);Math.floor(g)>(i||e.width)-2&&h.length>0?(s[s.length]={text:h,x:0,dy:0,width:o===h?g:h===a?n:Lh(h,e)},h=""):l===r.length-1&&(s[s.length]={text:h,x:0,dy:0,width:g},h=""),a=o,n=g}return s}(e,t,i);else n[n.length]={text:s,x:0,dy:0,width:Lh(s,e)};return n}(d,n,e.isLaneOrientation?o:void 0),e.wrapBounds=s=function(e,t){var i,r,o={x:0,width:0},n=0;for(n=0;n<t.length;n++)i=t[n].width,r=i,i="left"===e.textAlign?0:"center"===e.textAlign?i>e.width&&("Ellipsis"===e.textOverflow||"Clip"===e.textOverflow)?0:-i/2:"right"===e.textAlign?-i:t.length>1?0:-i/2,t[n].dy=1.2*e.fontSize,t[n].x=i,o?(o.x=Math.min(o.x,i),o.width=Math.max(o.width,r)):o={x:i,width:r};return o}(d,a),h.width=s.width,e.wrapBounds.width>=o&&"Wrap"!==d.textOverflow&&(h.width=o);return h.height=a.length*e.style.fontSize*1.2,h}(this,this.style,this.content,this.isLaneOrientation?e.height:this.width||e.width):this.desiredSize,void 0===this.width||void 0===this.height?this.desiredSize=new i(t.width,t.height):this.desiredSize=new i(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,e),this.desiredSize},t.prototype.arrange=function(e){return(e.width!==this.actualSize.width||e.height!==this.actualSize.height||this.isDirt)&&(this.doWrap=!0),this.actualSize=e,this.updateBounds(),this.isDirt=!1,this.actualSize},t}(be),Pe=(ve=function(e,t){return(ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ve(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Te=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.measureChildren=void 0,e}return Pe(r,t),r.prototype.measure=function(e,r,o){var n=void 0,a=void 0;if(this.hasChildren()){for(var s=0,h=this.children;s<h.length;s++){var d=h[s];d instanceof Se?d.canMeasure&&(e.width=e.width||this.maxWidth||this.minWidth,d.measure(e)):d instanceof Se||d.measure(e,r,o);var l=d.desiredSize.clone();0!==d.rotateAngle&&(l=Nh(l,d.rotateAngle));var c=l.width+d.margin.right,p=l.height+d.margin.bottom,g=new b(d.margin.left,d.margin.top,c,p);if(d.float)if(void 0!==d.getAbsolutePosition(l))continue;d instanceof Se&&!(d instanceof Se&&d.canConsiderBounds)||(void 0===a?a=g:a.uniteRect(g))}if(a){var u,f;u=Math.max(a.left,0),f=Math.max(a.top,0),n=new i(a.width+u,a.height+f)}}return n=t.prototype.validateDesiredSize.call(this,n,e),t.prototype.stretchChildren.call(this,n),n.width+=this.padding.left+this.padding.right,n.height+=this.padding.top+this.padding.bottom,this.desiredSize=n,n},r.prototype.arrange=function(i,r){if(this.outerBounds=new b,this.hasChildren())for(var o=this.offsetY-i.height*this.pivot.y+this.padding.top,n=this.offsetX-i.width*this.pivot.x+this.padding.left,a=0,s=this.children;a<s.length;a++){var h=s[a];if(0!=(h.transform&e.Transform.Parent)){h.parentTransform=this.parentTransform+this.rotateAngle,("None"!==this.flip||this.elementActions&e.ElementAction.ElementIsGroup)&&(h.parentTransform="Horizontal"===this.flip||"Vertical"===this.flip?-h.parentTransform:h.parentTransform);var d,l=h.desiredSize.clone(),c=void 0,p=n,g=o;if("Point"===h.relativeMode){var u=h.getAbsolutePosition(i);void 0!==u&&(p+=u.x,g+=u.y)}d={x:(c="Object"===h.relativeMode?this.alignChildBasedOnParent(h,l,i,p,g):this.alignChildBasedOnaPoint(h,p,g)).x+l.width/2,y:c.y+l.height/2},t.prototype.findChildOffsetFromCenter.call(this,h,d)}!r||"Stretch"!==h.horizontalAlignment&&"Stretch"!==h.verticalAlignment?h instanceof Se&&h.canMeasure?(h.arrange(h.desiredSize),this.outerBounds.uniteRect(h.outerBounds)):h instanceof Se||(h.arrange(h.desiredSize),this.outerBounds.uniteRect(h.outerBounds)):h.arrange(i)}return this.actualSize=i,this.updateBounds(),this.outerBounds.uniteRect(this.bounds),i},r.prototype.alignChildBasedOnParent=function(e,t,i,r,o){switch(e.horizontalAlignment){case"Auto":case"Left":r+=e.margin.left;break;case"Right":r+=i.width-t.width-e.margin.right;break;case"Stretch":case"Center":r+=i.width/2-t.width/2}switch(e.verticalAlignment){case"Auto":case"Top":o+=e.margin.top;break;case"Bottom":o+=i.height-t.height-e.margin.bottom;break;case"Stretch":case"Center":o+=i.height/2-t.height/2}return{x:r,y:o}},r.prototype.alignChildBasedOnaPoint=function(e,t,i){switch(t+=e.margin.left-e.margin.right,i+=e.margin.top-e.margin.bottom,e.horizontalAlignment){case"Auto":case"Left":t=e.inversedAlignment?t:t-e.desiredSize.width;break;case"Stretch":case"Center":t-=e.desiredSize.width*e.pivot.x;break;case"Right":t=e.inversedAlignment?t-e.desiredSize.width:t}switch(e.verticalAlignment){case"Auto":case"Top":i=e.inversedAlignment?i:i-e.desiredSize.height;break;case"Stretch":case"Center":i-=e.desiredSize.height*e.pivot.y;break;case"Bottom":i=e.inversedAlignment?i-e.desiredSize.height:i}return{x:t,y:i}},r}(xe);function Ae(e){return Be[e.toString()]}var ze,Oe,Ie,De,Ee,Be={Rectangle:"M0,0 L50,0 L50,50 L0,50 z",Ellipse:"M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",Hexagon:"M30,0 L60,0 L90,30 L60,60 L30,60 L0,30 L30,0 z",Parallelogram:"M30,0 L60,0 L45,30 L15,30 z",Triangle:"M45,0 L90,45 L0,45 L45,0 z",Plus:"M696.6084,158.2656 L674.8074,158.2656 L674.8074,136.4656 L658.4084,136.4656 L658.4084,158.2656 L636.6084,158.2656L636.6084,174.6646 L658.4084,174.6646 L658.4084,196.4656 L674.8074,196.4656 L674.8074,174.6646 L696.6084,174.6646L696.6084,158.2656 z",Star:"M540.3643,137.9336 L546.7973,159.7016 L570.3633,159.7296 L550.7723,171.9366 L558.9053,194.9966 L540.3643,179.4996L521.8223,194.9966 L529.9553,171.9366 L510.3633,159.7296 L533.9313,159.7016 L540.3643,137.9336 z",Pentagon:"M30,0 L60,30 L50,70 L10,70 L0,30 L30,0 z",Heptagon:"M223.7783,195.7134 L207.1303,174.8364 L213.0713,148.8034 L237.1303,137.2174 L261.1883,148.8034 L267.1303,174.8364L250.4813,195.7134 L223.7783,195.7134 z",Octagon:"M98.7319,196.4653 L81.1579,178.8923 L81.1579,154.0393 L98.7319,136.4653 L123.5849,136.4653L141.1579,154.0393 L141.1579,178.8923 L123.5849,196.4653 L98.7319,196.4653 z",Trapezoid:"M127.2842,291.4492 L95.0322,291.4492 L81.1582,256.3152 L141.1582,256.3152 L127.2842,291.4492 z",Decagon:"M657.3379,302.4141 L642.3369,291.5161 L636.6089,273.8821 L642.3369,256.2481 L657.3379,245.3511 L675.8789,245.3511L690.8789,256.2481 L696.6089,273.8821L690.8789,291.5161 L675.8789,302.4141 L657.3379,302.4141 z",RightTriangle:"M836.293,292.9238 L776.293,292.9238 L776.293,254.8408 L836.293,292.9238 z",Cylinder:"M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016",Diamond:"M397.784,287.875 L369.5,316.159 L341.216,287.875 L369.5,259.591 L397.784,287.875 z"},Le=(ze=function(e,t){return(ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ze(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Me=function(e){function t(){var t=e.call(this)||this;return t.pathData="",t.transformPath=!0,t.absolutePath="",t.canMeasurePath=!1,t.absoluteBounds=new b,t}return Le(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.pathData},set:function(e){this.pathData!==e&&(this.pathData=e,this.isDirt=!0)},enumerable:!0,configurable:!0}),t.prototype.getPoints=function(){var e=this;return this.pointTimer||(this.pointTimer=setTimeout((function(){e.points=null,e.pointTimer=null}),200)),this.points=this.points||function(e){var t,i,r=[];window.measureElement.style.visibility="visible";var o=Us(window.measureElement.children[2])[0];o.setAttributeNS(null,"d",e.data);var n=e.absoluteBounds,a=Zs(e,n,e);o.setAttributeNS(null,"d",a);var s=o.getTotalLength();for(i=0;i<=s;i+=10)t=o.getPointAtLength(i),r.push({x:t.x,y:t.y});return window.measureElement.style.visibility="hidden",r}(this),function(e,t){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r],a={x:e.offsetX-e.actualSize.width*e.pivot.x+n.x,y:e.offsetY-e.actualSize.height*e.pivot.y+n.y},s=void 0,h=e.rotateAngle+e.parentTransform;h&&P(s=x(),h,e.offsetX,e.offsetY),s&&(a=C(s,a)),i.push(a)}return i}(this,this.points)},t.prototype.measure=function(e){return this.staticSize&&void 0!==this.width&&void 0!==this.height?this.absoluteBounds=new b(this.offsetX-this.width*this.pivot.x,this.offsetY-this.height*this.pivot.y,this.width,this.height):(!this.isDirt||!this.transformPath&&void 0!==this.width&&void 0!==this.height||this.absoluteBounds&&0!==this.absoluteBounds.height)&&!this.canMeasurePath||(this.absoluteBounds=Gs(this.data?this.data:"")),void 0===this.width?this.desiredSize=new i(this.absoluteBounds.width,this.height||this.absoluteBounds.height):void 0===this.height?this.desiredSize=new i(this.width||this.absoluteBounds.width,this.absoluteBounds.height):this.desiredSize=new i(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,e),this.canMeasurePath=!1,this.desiredSize},t.prototype.arrange=function(e){return(this.isDirt||this.actualSize.width!==e.width||this.actualSize.height!==e.height)&&(this.isDirt=!0,this.absolutePath=this.updatePath(this.data,this.absoluteBounds,e),this.staticSize||(this.points=null)),this.actualSize=this.desiredSize,this.updateBounds(),this.isDirt=!1,this.actualSize},t.prototype.updatePath=function(e,t,i){var r=!1,o="",n=-t.x,a=-t.y,h=[];return i.width===t.width&&i.height===t.height||(n=i.width/Number(t.width?t.width:1),a=i.height/Number(t.height?t.height:1),r=!0),h=f(h=s(e)),o=(r||this.isDirt)&&this.transformPath?p(h,n,a,r,t.x,t.y,0,0):m(h),r=!1,o},t}(be),ke=(Oe=function(e,t){return(Oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Oe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Re=function(e){function t(){var t=e.call(this)||this;return t.imageSource="",t.imageScale="None",t.imageAlign="None",t.stretch="Stretch",t}return ke(t,e),Object.defineProperty(t.prototype,"source",{get:function(){return this.imageSource},set:function(e){this.imageSource=e,this.isDirt=!0},enumerable:!0,configurable:!0}),t.prototype.measure=function(e,t,r){return this.isDirt&&("Stretch"!==this.stretch||void 0===this.width&&void 0===this.height)&&(this.contentSize=function(e,t,r,o){window.measureElement.style.visibility="visible";var n=window.measureElement.children[1];n.setAttribute("src",e);var a=n.getBoundingClientRect(),s=a.width,h=a.height;t=new i(s,h),window.measureElement.style.visibility="hidden";var d=document.createElement("img");return d.setAttribute("src",e),yh(d,{id:r+"sf-imageNode",style:"display: none;"}),document.body.appendChild(d),d.onload=function(e){var t=e.currentTarget;o&&o(r,{width:t.width,height:t.height})},t}(this.source,this.contentSize,t,r),this.isDirt=!1),void 0!==this.width&&void 0!==this.height?(this.desiredSize=new i(this.width,this.height),this.contentSize=this.desiredSize):this.desiredSize=this.contentSize,this.desiredSize=this.validateDesiredSize(this.desiredSize,e),this.desiredSize},t.prototype.arrange=function(e){return this.actualSize=new i(this.desiredSize.width,this.desiredSize.height),this.updateBounds(),this.actualSize},t}(be),Ne=(Ie=function(e,t){return(Ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ie(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),je=function(e){function t(t,i){var r=e.call(this)||this;return r.data="",r.nodeId="",r.diagramId="",r.scale="Stretch",r.diagramId=i,r.nodeId=t,r}return Ne(t,e),Object.defineProperty(t.prototype,"content",{get:function(){return this.data},set:function(e){this.data=e,this.canReset||(this.canReset=!0,this.template=uh(this,!1),this.canReset=!1,this.isDirt=!0)},enumerable:!0,configurable:!0}),t.prototype.measure=function(e){if(this.isDirt){var t=function(e){window.measureElement.style.visibility="visible";var t=window.measureElement.children[2];t.appendChild(e);var i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),o=i;return o.x=i.left-r.left,o.y=i.top-r.top,t.removeChild(e),window.measureElement.style.visibility="hidden",o}(this.template);this.contentSize=new i,this.contentSize.width=t.width,this.contentSize.height=t.height;var r=t.x,o=t.y;this.templatePosition={x:r,y:o},this.isDirt=!1}if(void 0===this.width||void 0===this.height){var n=function(e){window.measureElement.style.visibility="visible";var t=window.measureElement.children[2];t.appendChild(e);var i=t.getBoundingClientRect();return t.removeChild(e),window.measureElement.style.visibility="hidden",i}(this.template);this.desiredSize=new i(n.width,n.height)}else this.desiredSize=new i(this.width,this.height);return this.desiredSize=this.validateDesiredSize(this.desiredSize,e),this.desiredSize},t.prototype.arrange=function(e){return this.actualSize=new i(this.desiredSize.width,this.desiredSize.height),this.updateBounds(),this.actualSize},t}(be),He=(De=function(e,t){return(De=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}De(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),We=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},_e=function(t){function i(e,i,r,o){var n=t.call(this,e,i,r,o)||this;return n.inEdges=[],n.outEdges=[],n}return He(i,t),We([sf.base.Property("")],i.prototype,"id",void 0),We([sf.base.Property("Center")],i.prototype,"horizontalAlignment",void 0),We([sf.base.Property("Center")],i.prototype,"verticalAlignment",void 0),We([sf.base.Complex({},ne)],i.prototype,"margin",void 0),We([sf.base.Property(12)],i.prototype,"width",void 0),We([sf.base.Property(12)],i.prototype,"height",void 0),We([sf.base.Complex({},pe)],i.prototype,"style",void 0),We([sf.base.Property("Square")],i.prototype,"shape",void 0),We([sf.base.Property(e.PortVisibility.Connect)],i.prototype,"visibility",void 0),We([sf.base.Property("")],i.prototype,"pathData",void 0),We([sf.base.Property(e.PortConstraints.Default)],i.prototype,"constraints",void 0),We([sf.base.Property()],i.prototype,"addInfo",void 0),We([sf.base.Property()],i.prototype,"outEdges",void 0),We([sf.base.Property()],i.prototype,"inEdges",void 0),i}(sf.base.ChildProperty),Ve=function(e){function t(t,i,r,o){return e.call(this,t,i,r,o)||this}return He(t,e),t.prototype.getClassName=function(){return"PointPort"},We([sf.base.Complex({x:.5,y:.5},a)],t.prototype,"offset",void 0),t}(_e),Xe=(Ee=function(e,t){return(Ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ee(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ye=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Xe(t,e),Ye([sf.base.Property("blue")],t.prototype,"color",void 0),Ye([sf.base.Property("")],t.prototype,"content",void 0),Ye([sf.base.Property("")],t.prototype,"link",void 0),Ye([sf.base.Property("None")],t.prototype,"textDecoration",void 0),t}(sf.base.ChildProperty),Ge=function(t){function i(e,i,r,o){var n=t.call(this,e,i,r,o)||this;return r.id||(e.parentObj&&e.parentObj.propName&&"phases"===e.parentObj.propName?n.id=e.parentObj.id:n.id=xh()),n}return Xe(i,t),Ye([sf.base.Property("")],i.prototype,"content",void 0),Ye([sf.base.Property(void 0)],i.prototype,"template",void 0),Ye([sf.base.Property("String")],i.prototype,"annotationType",void 0),Ye([sf.base.Property(!0)],i.prototype,"visibility",void 0),Ye([sf.base.Property(e.AnnotationConstraints.InheritReadOnly)],i.prototype,"constraints",void 0),Ye([sf.base.Complex(void 0,Ue)],i.prototype,"hyperlink",void 0),Ye([sf.base.Property("")],i.prototype,"id",void 0),Ye([sf.base.Property()],i.prototype,"width",void 0),Ye([sf.base.Property()],i.prototype,"height",void 0),Ye([sf.base.Property(0)],i.prototype,"rotateAngle",void 0),Ye([sf.base.Complex({strokeWidth:0,strokeColor:"transparent",fill:"transparent"},ue)],i.prototype,"style",void 0),Ye([sf.base.Property("Center")],i.prototype,"horizontalAlignment",void 0),Ye([sf.base.Property("Center")],i.prototype,"verticalAlignment",void 0),Ye([sf.base.Complex({},ne)],i.prototype,"margin",void 0),Ye([sf.base.Complex({top:void 0,bottom:void 0,left:void 0,right:void 0},ne)],i.prototype,"dragLimit",void 0),Ye([sf.base.Property("Shape")],i.prototype,"type",void 0),Ye([sf.base.Property()],i.prototype,"addInfo",void 0),i}(sf.base.ChildProperty),Fe=function(e){function t(t,i,r,o){return e.call(this,t,i,r,o)||this}return Xe(t,e),t.prototype.getClassName=function(){return"ShapeAnnotation"},Ye([sf.base.Complex({x:.5,y:.5},a)],t.prototype,"offset",void 0),t}(Ge),Ze=function(e){function t(t,i,r,o){return e.call(this,t,i,r,o)||this}return Xe(t,e),t.prototype.getClassName=function(){return"PathAnnotation"},Ye([sf.base.Property(.5)],t.prototype,"offset",void 0),Ye([sf.base.Complex({x:0,y:0},a)],t.prototype,"displacement",void 0),Ye([sf.base.Property("Center")],t.prototype,"alignment",void 0),Ye([sf.base.Property(!1)],t.prototype,"segmentAngle",void 0),t}(Ge);function qe(e){return Je[e.toString()]}function Ke(e,t){return"Custom"===e?t.pathData:$e[e]}function Qe(e){var t;switch(e.shape){case"Minus":t="M0,50 L100,50";break;case"Plus":t="M0,-50 L0,50 M-50,0 L50,0";break;case"ArrowUp":t="M0,100 L50,0 L100,100 Z";break;case"ArrowDown":t="M0,0 L50,100 L100,0 Z";break;case"Path":t=e.pathData}return t}var Je={X:"M14,14 L106,106 M106,14 L14,106",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z",Square:"M0,0 L10,0 L10,10 L0,10 z"},$e={OpenArrow:"M15.9,23 L5,16 L15.9,9 L17,10.7 L8.7,16 L17,21.3Z",Square:"M0,0 L10,0 L10,10 L0,10 z",Fletch:"M14.8,10c0,0-3.5,6,0.2,12c0,0-2.5-6-10.9-6C4.1,16,11.3,16,14.8,10z",OpenFetch:"M6,17c-0.6,0-1-0.4-1-1s0.4-1,1-1c10.9,0,11-5,11-5c0-0.6,0.4-1,1-1s1,0.4,1,1C19,10.3,18.9,17,6,17C6,17,6,17,6,17z M18,23c-0.5,0-1-0.4-1-1c0-0.2-0.3-5-11-5c-0.6,0-1-0.5-1-1s0.4-1,1-1c0,0,0,0,0,0c12.9,0,13,6.7,13,7    C19,22.6,18.6,23,18,23z",IndentedArrow:"M17,10c0,0-4.5,5.5,0,12L5,16L17,10z",OutdentedArrow:"M14.6,10c0,0,5.4,6,0,12L5,16L14.6,10z",DoubleArrow:"M19,10 L19,22 L13,16Z M12,10 L12,22 L6,16Z",Arrow:"M15,10 L15,22 L5,16Z",Diamond:"M12,23l-7-7l7-7l6.9,7L12,23z",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z"};function et(e){return nt[e.toString()]}var tt,it,rt,ot,nt={Process:"M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z",Decision:"M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z",Document:"M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z",PreDefinedProcess:"M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.334,0 L 8.334,50 M 41.667,0 L 41.667,50",Terminator:"M 269.711,29.33C 269.71,44.061 257.77,56 243.04,56L 158.058,56C 143.33,56 131.39,44.061 131.39,29.33L 131.39,29.33C 131.391,14.6057 143.33,2.669 158.058,2.669L 243.044,2.669C 257.772,2.669 269.711,14.6057 269.711,29.333 Z",PaperTap:"M0.0009,17.2042 L0.0009,47.165 C0.001,47.165 14.403,53.5455 25.00,47.165 C35.599,40.7852 44.403,43.5087 50.00,47.165L50.001,17.2042 M50.001,32.7987 L50.001,2.8405 C50.001,2.8405 35.599,-3.5427 25.001,2.8405C14.403,9.2237 5.599,6.494 0.0009,2.8405 L0.0009,32.7987",DirectData:"M 132.62 0 L 17.38 0 C 7.78 0 0 13.43 0 30 C 0 46.57 7.78 60 17.38 60 L 132.62 60 M 132.62 0C 123.02 0 115.24 13.43 115.24 30 C 115.24 46.57 123.02 60 132.62 60 C 142.22 60 150 46.57 150 30 C 150 13.43 142.22 0 132.62 0 z ",SequentialData:"M0.0029,24.999 C0.0029,11.1922 10.433,0.0021 23.295,0.0021 C36.159,0.00216 46.585,11.1922 46.585,24.999C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.0029,38.8057 0.0029,24.999 z M23.294,49.999 L50.002,49.999",Sort:"M50.001,24.9971 L25.001,49.9971 L0.00097,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971",MultiDocument:"M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.143 C48.027,35.765 49.025,36.604 50.003,37.369 L50.003,0.002 L6.264,0.002 L6.264,4.744 M43.682,47.113 L43.682,10.765 L0.0025,10.7652 L0.0025,47.1132 C0.0025,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.792,43.393 43.6826,47.1132 z",Collate:"M50.001,0.0028 L25.001,25.0029 L0.00097,0.0028 L50.001,0.002 z M0.0009,50.002 L25.001,25.002L50.001,50.002 L0.0009,50.0029 z",SummingJunction:"M7.3252,42.6768 L42.6772,7.3247 M42.6768,42.6768 L7.3248,7.3247 M0.0009,25.001 C0.0009,11.193 11.197,0.0009 25.001,0.0009 C38.809,0.0009 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.00 0.0009,38.809 0.0009,25.00 z",Or:"M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z",InternalStorage:"M 0 3.81946A 2.5,3.81946 0 0,1 2.5,0L 47.5 0A 2.5,3.81946 0 0,1 50,3.81946L 50 45.836A 2.5,3.819446 0 0,1 47.5,49.652778L 2.5 49.652778A 2.5,3.819446 0 0,1 0,45.8336L 0 3.819446ZM 0 11.45834L 50 11.4583334M 12.5 0L 12.5 49.652778",Extract:"M0,35 L30,0 L60,35 Z",ManualOperation:"M46.4,28.8 L14.8,28.8 L0,0 L60,0 Z",Merge:"M60,0 L30,35 L0,0 Z",OffPageReference:"M60,33.3 L30.1,39 L0,33.3 L0,0 L60,0 Z",SequentialAccessStorage:"M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9C 55.5 48 60 39.5 60 30 Z",Annotation:"M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865",Annotation2:"M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029",Data:"M 10 0 L 40 0 L 30 40 L 0 40 Z",Card:"M275,60 L400,60 L400,110 L260,110 L260,75 Z",Delay:"M0,0 L12.029,0 C14.212999,0 16,1.7869979 16,3.9709952 C16,6.1549926 14.212999,7.9409904 12.029,7.9409904 L0,7.9409904 z",Preparation:"M 1048.17 572 C 1051.06 568.86 1055.17 567.05 1059.5 567 L 1094.51 567 C 1098.84 567.05 1102.95 568.86 1105.84 572 L 1126.43 595 C 1127.01 596.28 1127.01 597.72 1126.43 599 L 1105.84 622 C 1102.95 625.14 1098.84 626.95 1094.51 627 L 1059.5 627 C 1055.17 626.95 1051.06 625.14 1048.17 622 L 1027.58 599 C 1027 597.72 1027 596.28 1027.58 595 L 1048.17 572 Z",Display:"M47.8809,19.2914 L32.7968,-0.00594145 L11.3902,-0.00594145 C7.93166,-0.00594145 0.00124586,11.187 0.00124586,24.9968C0.00124586,38.8032 7.93166,49.9962 11.3902,49.9962 L32.7968,49.99 L47.615,31.038 C47.615,31.0388 52.798,24.9968 47.880,19.2914 z",ManualInput:"M 912 732 L 1006.85 707 C 1008.2 707 1009.5 707.53 1010.46 708.46 C 1011.41 709.4 1011.95 710.67 1011.95 712 L 1011.95 762C 1012 764.41 1010.28 766.52 1007.87 767 L 917.1 767 C 915.75 767 914.45 766.47 913.49 765.54 C 912.54 764.6 912 763.33 912 762 L 912 732 Z",LoopLimit:"M 8 9 L 27 9 L 33 15 L 33 26 C 33 27 33 27 32 27 L 4 27 C 3 27 2 27 2 26 L 2 15 L 8 9 Z",StoredData:"M 5.55 0L 50 0A 1.5,30 0 0,1 50,0A 5.555,25 0 0,0 50,50A 1.5,30 0 0,1 50,50L 5.555 50A 5.55,25 0 0,1 5.555,0Z"};function at(t,i,r){var o=function(t,i,r,o,n){var s,h,d=t.sourceWrapper,l=t.targetWrapper,c=t.sourcePortWrapper,p=t.targetPortWrapper,g=[],u={corners:void 0,point:i,direction:void 0,margin:{left:5,right:5,bottom:5,top:5}},f={corners:void 0,point:r,direction:void 0,margin:{left:5,right:5,bottom:5,top:5}};void 0!==d&&void 0!==l&&(s=Ph(d),h=Ph(l),u.corners=d.corners,f.corners=l.corners);if(void 0!==c){var m={x:c.offsetX,y:c.offsetY};u.direction=Ht(m,s,d.bounds,!1)}if(void 0!==p){var y={x:p.offsetX,y:p.offsetY};f.direction=Ht(y,h,l.bounds,!1)}if(void 0!==d&&void 0!==l)return void 0!==u.direction&&void 0!==f.direction||(o?function(e,t,i){"LeftToRight"===i?(e.direction=e.direction?e.direction:"Right",t.direction=t.direction?t.direction:"Left"):"RightToLeft"===i?(e.direction=e.direction?e.direction:"Left",t.direction=t.direction?t.direction:"Right"):"TopToBottom"===i?(e.direction=e.direction?e.direction:"Bottom",t.direction=t.direction?t.direction:"Top"):"BottomToTop"===i&&(e.direction=e.direction?e.direction:"Top",t.direction=t.direction?t.direction:"Bottom")}(u,f,o):u.corners.top>f.corners.bottom&&Math.abs(u.corners.top-f.corners.bottom)>u.margin.top+u.margin.bottom?(u.direction=u.direction?u.direction:"Top",f.direction=f.direction?f.direction:"Bottom"):u.corners.bottom<f.corners.top&&Math.abs(u.corners.bottom-f.corners.top)>u.margin.bottom+u.margin.top?(u.direction=u.direction?u.direction:"Bottom",f.direction=f.direction?f.direction:"Top"):u.corners.right<f.corners.left&&Math.abs(u.corners.right-f.corners.left)>u.margin.right+u.margin.left||u.corners.right+13<f.corners.left||f.corners.right>=u.corners.left-13&&u.corners.left>f.corners.left?(u.direction=u.direction?u.direction:"Right",f.direction=f.direction?f.direction:"Left"):u.corners.left>f.corners.right&&Math.abs(u.corners.left-f.corners.right)>u.margin.left+u.margin.right||f.corners.right+13<u.corners.left||u.corners.right>=f.corners.left-13&&u.corners.left<f.corners.left?(u.direction=u.direction?u.direction:"Left",f.direction=f.direction?f.direction:"Right"):d.id!==l.id&&!s.equals(s,h)&&h.containsPoint(s.topCenter,u.margin.top)?(u.direction=u.direction?u.direction:"Bottom",f.direction=f.direction?f.direction:"Top"):(u.direction=u.direction?u.direction:"Top",f.direction=f.direction?f.direction:"Bottom")),function(t,i,r,o,n,s){var h,d=t.sourceWrapper,l=t.targetWrapper,c=t.sourcePortWrapper,p=t.targetPortWrapper,g=[],u=d.corners,f=l.corners,m=(f.center,{corners:u,point:o,direction:i,margin:{left:5,right:5,bottom:5,top:5}}),y={corners:f,point:n,direction:r,margin:{left:5,right:5,bottom:5,top:5}},v=mt(d,u,t.sourceWrapper.bounds),b=mt(l,f,t.targetWrapper.bounds),w=!1;t.sourceWrapper&&t.targetWrapper&&(w=function(e,t,i){for(var r=ft(e,i.sourcePadding),o=ft(t,i.targetPadding),n=0;n<r.length-1;n++)for(var a=r[n],s=0;s<o.length-1;s++){var h=o[s];if(Rn(a,h).enabled)return!0}return!1}(t.sourceWrapper,t.targetWrapper,t));if(void 0!==c){switch(m.point={x:c.offsetX,y:c.offsetY},m.direction){case"Bottom":case"Top":m.point.y=m.point.y;break;case"Left":case"Right":m.point.x=m.point.x}t.sourcePadding&&!w&&(p&&(y.point={x:p.offsetX,y:p.offsetY}),m.point=ut(t,m,y,!1))}else"Orthogonal"===t.type?(t.segments&&t.segments.length>0&&t.segments[0].direction&&(m.direction=t.segments[0].direction),m.point=At(v,m.direction),h=At(v,_t(m.direction)),m.point=Ot(t,d,m.point,h,!1)):m.point=d.corners.center;if(void 0!==p){switch(y.point={x:p.offsetX,y:p.offsetY},y.direction){case"Bottom":case"Top":y.point.y=y.point.y;break;case"Left":case"Right":y.point.x=y.point.x}t.targetPadding&&!w&&(y.point=ut(t,m,y,!0))}else"Orthogonal"===t.type?(y.point=At(b,y.direction),h=At(b,_t(y.direction)),y.point=Ot(t,l,y.point,h,!0)):y.point=l.corners.center;if("Orthogonal"!==t.type){var x=void 0,C=void 0;if(bt(t),void 0===t.sourcePortWrapper){m.point=m.corners.center,t.segments&&t.segments.length>0&&(C=t.segments[0],x=a.isEmptyPoint(C.point)?void 0:C);var S=void 0!==x?x.point:y.point;if("Bezier"===t.type&&t.segments.length>0&&t.segments[0].vector1.angle&&t.segments[0].vector1.distance){var P=Math.max(m.corners.width,m.corners.height);S=a.transform(m.point,t.segments[0].vector1.angle,P/2)}m.point=w?t.sourceWrapper.bounds.center:Ot(t,d,m.point,S,!1)}if(void 0===t.targetPortWrapper){y.point=y.corners.center,t.segments&&t.segments.length>1&&(C=t.segments[t.segments.length-2],x=a.isEmptyPoint(C.point)?void 0:C);var T=x?x.point:m.point;if("Bezier"===t.type&&t.segments.length>0&&t.segments[t.segments.length-1].vector2.angle&&t.segments[t.segments.length-1].vector2.distance){P=Math.max(m.corners.width,m.corners.height);T=a.transform(y.point,t.segments[0].vector2.angle,P/2)}y.point=w?t.targetWrapper.bounds.center:Ot(t,l,T,y.point,!0)}g=yt(t,m,y)}else if("Orthogonal"===t.type&&t.segments&&t.segments.length>0&&null!==t.segments[0].direction)g=function(e,t,i,r,o,n,a){var s,h,d,l;bt(e);for(var c=0;c<e.segments.length;c++){if(h=e.segments[c],r&&t.direction===_t(h.direction)&&(h.direction=t.direction),c>0&&e.segments[c-1].direction===h.direction)c=wt(e,c,t);else if(h.direction)t.point=st(t,e.segments[c]);else{var p=e.segments[c-1];t.point=p.points[p.points.length-1]}if(c===e.segments.length-1)if(Ct(e,t),gt(s=void 0===o?xt(e,t,i):ct(e,t,i),e,t),h.points=[],s.length>=2)for(d=0;d<s.length;d++)h.points.push(s[d]);else l=c;if(void 0!==l&&(l===e.segments.length-1&&(e.segments[l-1].direction=null,e.segments[l-1].length=null),e.segments.splice(l,1)),r&&0===c){var g=pt(e,r,n);g&&(t.point=g)}}return St(e,[])}(t,m,y,c,p,d);else{if(!t.segments[0]){x=new hr(t,"segments",{type:"Orthogonal"},!0);t.segments.push(x)}t.segments[0].points=g=function(t,i,r,o,n){var a,s;(a=function(e,t){var i=!1;switch(e){case"Left":switch(t){case"Right":case"Bottom":i=!0}break;case"Top":switch(t){case"Left":case"Right":case"Bottom":i=!0}break;case"Bottom":switch(t){case"Right":i=!0}}return i}(i.direction,r.direction))&&jt(i,r);"Right"===i.direction&&"Left"===r.direction?s=function(t,i,r,o){var n,a=t.sourcePortWrapper,s=Math.round(Math.abs(i.point.y-r.point.y)),h={x:Math.max(i.point.x,i.corners.right),y:i.point.y},d={x:Math.min(r.point.x,r.corners.left),y:r.point.y},l=10;if(o){var c=d;d=h,h=c}i.corners.bottom+l<r.corners.top-l||i.corners.top-l>r.corners.bottom+l||(l=0);i.margin={left:l,right:l,top:l,bottom:l},r.margin={left:l,right:l,top:l,bottom:l},n=0===s&&(i.corners.right<r.corners.left||o&&i.corners.right<r.corners.left)?e.NoOfSegments.One:i.point.x+i.margin.right<r.point.x-r.margin.left||t.sourceWrapper!==t.targetWrapper&&(Ph(t.sourceWrapper).containsPoint(d)||Ph(t.targetWrapper).containsPoint(h))?e.NoOfSegments.Three:(i.corners.bottom<=r.corners.top||i.corners.top>=r.corners.top||void 0!==a&&a.offsetY<=r.corners.top||void 0===a&&i.corners.right<=r.corners.top||void 0!==a&&a.offsetY>=r.corners.bottom||void 0===a&&(i.corners.right,r.corners.bottom),e.NoOfSegments.Five);return n}(t,i,r,a):"Right"===i.direction&&"Right"===r.direction?s=function(t,i,r){var o,n=t.sourcePortWrapper,a=t.targetPortWrapper,s=i.point.x-r.point.x,h=i.point.y-r.point.y;r.margin={left:10,right:10,top:10,bottom:10},i.margin={left:10,right:10,top:10,bottom:10},o=i.corners.right>=r.corners.right?void 0!==n&&(n.offsetY<r.corners.top||n.offsetY>r.corners.bottom)||void 0===n&&i.corners.middleRight.y<r.corners.top||void 0!==n&&n.offsetY>r.corners.bottom+r.margin.bottom&&i.corners.top>r.corners.bottom||void 0===n&&i.corners.middleRight.y>r.corners.bottom||void 0!==n&&n.offsetY<r.corners.top&&i.corners.bottom>r.corners.top||void 0===n&&i.corners.middleRight.y>r.corners.bottom?e.NoOfSegments.Three:i.corners.right<r.corners.left||r.corners.right<i.corners.left?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three:void 0!==a&&i.corners.bottom<a.offsetY||void 0===a&&i.corners.bottom<r.corners.middleRight.y||void 0!==a&&i.corners.top>a.offsetY||void 0===a&&i.corners.top>r.corners.middleRight.y||void 0!==a&&(void 0!==n&&n.offsetX<r.corners.left&&n.offsetX!==a.offsetX&&n.offsetY!==a.offsetY&&Math.abs(i.corners.right-r.corners.left)<=20||void 0===n&&i.corners.right<r.corners.left&&i.corners.center.x!==r.corners.center.x&&i.corners.center.y!==r.corners.center.y)?e.NoOfSegments.Three:i.corners.right<r.corners.left?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three;return o}(t,i,r):"Right"===i.direction&&"Top"===r.direction?s=function(t,i,r,o){var n,a=t.targetPortWrapper,s=t.sourcePortWrapper,h={x:Math.max(i.point.x,i.corners.right),y:i.point.y},d={x:r.point.x,y:Math.min(r.point.y,r.corners.top)};if(r.margin={left:5,right:5,top:5,bottom:5},i.margin={top:5,bottom:5,left:5,right:5},o){var l=s;s=a,a=l}n=void 0!==s&&s.offsetY<r.corners.top-r.margin.top||void 0===s&&i.corners.bottom<r.corners.top-r.margin.top?i.corners.bottom<r.corners.top?void 0!==a&&i.corners.right+i.margin.right<a.offsetX||void 0===a&&i.corners.right+i.margin.right<r.corners.topCenter.x?e.NoOfSegments.Two:e.NoOfSegments.Four:void 0!==a&&i.corners.left>a.offsetX||void 0===a&&i.corners.left>r.corners.topCenter.x?e.NoOfSegments.Four:e.NoOfSegments.Two:void 0!==s&&Math.abs(i.corners.right-r.corners.left)<=25&&Math.abs(s.offsetY-r.corners.top)<=25||void 0!==a&&Math.abs(a.offsetX-i.corners.topCenter.x)>=25&&i.corners.middleRight.y<a.offsetY?e.NoOfSegments.Two:i.corners.right<r.corners.left?e.NoOfSegments.Four:t.sourceWrapper!==t.targetWrapper&&(Ph(t.sourceWrapper).containsPoint(d)||Ph(t.targetWrapper).containsPoint(h))?e.NoOfSegments.Two:e.NoOfSegments.Four;return n}(t,i,r,a):"Right"===i.direction&&"Bottom"===r.direction?s=function(t,i,r,o){var n;i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10};var a=t.sourcePortWrapper,s=t.targetPortWrapper;if(o){var h=a;a=s,s=h}n=void 0!==a&&a.offsetY>r.corners.bottom+r.margin.bottom||void 0===a&&i.corners.middleRight.y>r.corners.bottom+r.margin.bottom?i.corners.top>r.corners.bottom?void 0!==s&&i.corners.right+i.margin.right<s.offsetX||void 0===s&&i.corners.right+i.margin.right<r.corners.bottomCenter.x?e.NoOfSegments.Two:e.NoOfSegments.Four:void 0!==s&&i.corners.left>s.offsetX||void 0===s&&i.corners.left>r.corners.bottomCenter.x?e.NoOfSegments.Four:e.NoOfSegments.Two:void 0!==a&&Math.abs(i.corners.right-r.corners.left)<=25&&Math.abs(a.offsetY-r.corners.bottom)<=25?e.NoOfSegments.Two:(i.corners.right,r.corners.left,e.NoOfSegments.Four);return n}(t,i,r,a):"Bottom"===i.direction&&"Top"===r.direction?s=function(t,i){var r,o=t.point.x-i.point.x,n=10;t.corners.right+n<i.corners.left-n||t.corners.left-n>i.corners.right+n||(n=0);t.margin={left:n,right:n,top:n,bottom:n},i.margin={left:n,right:n,top:n,bottom:n},r=0===o&&t.corners.bottom<i.corners.top?e.NoOfSegments.One:t.corners.bottom+t.margin.bottom<i.corners.top-i.margin.top?e.NoOfSegments.Three:(t.corners.right+t.margin.right<i.corners.left-i.margin.left||(t.corners.left,t.margin.left,i.corners.right,i.margin.right),e.NoOfSegments.Five);return r}(i,r):"Bottom"===i.direction&&"Bottom"===r.direction?(i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10},s=function(t,i,r){var o,n=t.sourcePortWrapper,a=t.targetPortWrapper,s=Math.round(Math.abs(i.point.x-r.point.x)),h=Math.round(Math.abs(r.point.y-r.point.y));o=i.corners.bottom<r.corners.bottom?void 0!==n&&n.offsetX<r.corners.left-r.margin.left||void 0===n&&i.corners.bottomCenter.x<r.corners.left-r.margin.left||void 0!==n&&n.offsetX>r.corners.right+r.margin.right||void 0===n&&i.corners.bottomCenter.x>r.corners.right+r.margin.right?e.NoOfSegments.Three:i.corners.bottom<r.corners.top?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three:void 0!==a&&i.corners.left>a.offsetX||void 0===a&&i.corners.left>r.corners.left||void 0!==a&&i.corners.right<a.offsetX||void 0===a&&i.corners.right<r.corners.right?e.NoOfSegments.Three:i.corners.top>r.corners.bottom?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three;return o}(t,i,r)):"Bottom"===i.direction&&"Left"===r.direction?s=function(t,i,r,o){var n,a=t.sourcePortWrapper,s=t.targetPortWrapper;if(o){var h=a;a=s,s=h}n=void 0!==a&&a.offsetX<r.corners.left-r.margin.left||void 0===a&&i.corners.bottomCenter.x<r.corners.bottomLeft.x-r.margin.left?i.corners.right<r.corners.left?void 0!==s&&i.corners.bottom+i.margin.bottom<s.offsetY||void 0===s&&i.corners.bottom+i.margin.bottom<r.corners.middleLeft.y?e.NoOfSegments.Two:e.NoOfSegments.Four:void 0!==s&&i.corners.top>s.offsetY||void 0===s&&i.corners.top>r.corners.middleLeft.y?e.NoOfSegments.Four:e.NoOfSegments.Two:void 0!==s&&Math.abs(i.corners.right-r.corners.left)<=25&&Math.abs(s.offsetY-i.corners.bottom)<=25?e.NoOfSegments.Two:e.NoOfSegments.Four;return n}(t,i,r,a):"Left"===i.direction&&"Left"===r.direction?s=function(t,i,r){var o=t.sourcePortWrapper,n=t.targetPortWrapper;i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10};var a,s=Math.round(Math.abs(i.point.x-r.point.x)),h=Math.round(Math.abs(i.point.y-r.point.y));a=i.corners.left<r.corners.left?void 0!==n&&i.corners.bottom+i.margin.bottom<n.offsetY||void 0===n&&i.corners.bottom+i.margin.bottom<r.corners.middleLeft.y||void 0!==n&&i.corners.top-i.margin.top>n.offsetY||void 0===n&&i.corners.top-i.margin.top>r.corners.middleLeft.y?e.NoOfSegments.Three:i.corners.right<r.corners.left||r.corners.right<i.corners.left?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three:void 0!==o&&o.offsetY<r.corners.top-r.margin.top||void 0===o&&i.corners.middleLeft.y<r.corners.top||void 0!==o&&o.offsetY>r.corners.bottom+r.margin.bottom||void 0===o&&i.corners.middleLeft.y>r.corners.bottom+r.margin.bottom?e.NoOfSegments.Three:i.corners.left>r.corners.right?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three;return a}(t,i,r):"Left"===i.direction&&"Top"===r.direction?s=function(t,i,r,o){var n,a=t.sourcePortWrapper,s=t.targetPortWrapper,h={x:Math.min(i.point.x,i.corners.left),y:i.point.y},d={x:r.point.x,y:Math.min(r.point.y,r.corners.top)};if(o){var l=a;a=s,s=l}n=void 0!==a&&a.offsetY<r.corners.top-r.margin.top||void 0===a&&(i.corners.bottom<r.corners.top-r.margin.top||i.corners.middleLeft.y<r.corners.top-r.margin.top)?i.corners.bottom<r.corners.top?void 0!==s&&i.corners.left-i.margin.left>s.offsetX||void 0===s&&i.corners.left-i.margin.left>r.corners.topCenter.x?e.NoOfSegments.Two:e.NoOfSegments.Four:void 0!==s&&i.corners.right<s.offsetX||void 0===s&&i.corners.right<r.corners.topCenter.x?e.NoOfSegments.Four:e.NoOfSegments.Two:void 0!==a&&Math.abs(i.corners.left-r.corners.right)<=25&&Math.abs(a.offsetY-r.corners.top)<=25||t.sourceWrapper!==t.targetWrapper&&(Ph(t.sourceWrapper).containsPoint(d)||Ph(t.targetWrapper).containsPoint(h))?e.NoOfSegments.Two:(i.corners.left,r.corners.right,e.NoOfSegments.Four);return n}(t,i,r,a):"Top"===i.direction&&"Top"===r.direction&&(s=function(t,i,r){var o,n=t.sourcePortWrapper,a=t.targetPortWrapper,s=Math.round(Math.abs(i.point.x-r.point.x)),h=Math.round(Math.abs(i.point.y-r.point.y));i.margin={left:10,right:10,top:10,bottom:10},r.margin={left:10,right:10,top:10,bottom:10},o=i.corners.top<r.corners.top?void 0!==a&&i.corners.left>a.offsetX||void 0===a&&i.corners.left>r.corners.left||void 0!==a&&i.corners.right<a.offsetX||void 0===a&&i.corners.right<r.corners.right?e.NoOfSegments.Three:i.corners.bottom<r.corners.top?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three:void 0!==n&&n.offsetX>r.corners.right||void 0===n&&i.corners.left>r.corners.right||void 0!==n&&n.offsetX<r.corners.left||void 0===n&&i.corners.bottomRight.x<r.corners.left?e.NoOfSegments.Three:i.corners.top>r.corners.bottom?e.NoOfSegments.Five:0===s||0===h?e.NoOfSegments.One:e.NoOfSegments.Three;return o}(t,i,r));a&&jt(i,r);return function(t,i,r,o,n,a){var s,h,d=t.sourceWrapper,l=t.targetWrapper,c=d.corners,p=l.corners,g=20;if(!(r.direction===o.direction&&i!==e.NoOfSegments.Five||r.direction!==_t(o.direction)&&i!==e.NoOfSegments.Three))switch(r.direction){case"Left":c.middleLeft.x>p.middleRight.x&&(h=(c.middleLeft.x-p.middleRight.x)/2,g=a?h:Math.min(g,h));break;case"Right":c.middleRight.x<p.middleLeft.x&&(h=(p.middleLeft.x-c.middleRight.x)/2,g=a?h:Math.min(g,h));break;case"Top":c.topCenter.y>p.bottomCenter.y&&(h=(c.topCenter.y-p.bottomCenter.y)/2,g=a?h:Math.min(g,h));break;case"Bottom":c.bottomCenter.y<p.topCenter.y&&(h=(p.topCenter.y-c.bottomCenter.y)/2,g=a?h:Math.min(g,h))}g=Lt(c,r,g),n&&(g=Math.max(g,n));i===e.NoOfSegments.One&&(s=[r.point,o.point]);i===e.NoOfSegments.Two&&(s=Mt(r,o));i===e.NoOfSegments.Three&&(s=kt(t,r,o,g));if(i===e.NoOfSegments.Four){s=Rt(r,o,void 0,s,g)}i===e.NoOfSegments.Five&&(s=function(e,t,i){void 0===i&&(i=20);var r,o,n=i,a=e.corners.left-e.margin.left,s=e.corners.right+e.margin.right,h=e.corners.bottom+e.margin.bottom,d=e.corners.top-e.margin.top,l=t.corners.left-t.margin.left,c=t.corners.right+t.margin.right,p=t.corners.bottom+t.margin.bottom,g=t.corners.top-t.margin.top;switch(e.direction){case"Left":(d>g&&d<p||h<p&&h>g)&&a>l&&a<=c&&i>=20&&(n=e.point.x-t.corners.left+n),o=zt(e.point,n,180);break;case"Top":(a>l&&a<c||s<c&&s>l)&&d>g&&d<=p&&i>=20&&(n=e.point.y-t.corners.top+n),o=zt(e.point,n,270);break;case"Right":(d>g&&d<p||h<p&&h>g)&&s<c&&s>=l&&i>=20&&(n=t.corners.right-e.point.x+n),o=zt(e.point,n,0);break;case"Bottom":(a>l&&a<c||s<c&&s>l)&&h<p&&h>=g&&i>=20&&(n=t.corners.bottom-e.point.y+n),o=zt(e.point,n,90)}if(r=[e.point,o],"Top"===e.direction||"Bottom"===e.direction){var u=e.direction;e.direction=o.x>t.point.x?"Left":"Right",e.point=o,r=Rt(e,t,u,r)}else{u=e.direction;e.direction=o.y>t.point.y?"Top":"Bottom",e.point=o,r=Rt(e,t,u,r)}return r}(r,o,g));return s}(t,s,i,r,o,n)}(t,m,y,void 0,s)}return g}(t,u.direction,f.direction,u.point,f.point,n);bt(t),(t.sourceWrapper||t.targetWrapper)&&function(e,t,i){var r,o=e.sourcePortWrapper,n=e.targetPortWrapper,a=e.sourceWrapper,s=t.point,h={left:0,right:0,top:0,bottom:0},d={x:0,y:0},l="Top";a?(s=i.point,h=t.margin):(a=e.targetWrapper,h=i.margin);if("Orthogonal"===e.type)if(e.segments&&e.segments.length>0&&e.sourceWrapper&&e.segments[0].direction)t.direction=e.segments[0].direction,d=At(a.corners,t.direction),r=At(a.corners,_t(t.direction)),d=Ot(e,a,d,r,!1);else{var c={corners:null,direction:null,point:null,margin:null};Pt(a,{corners:null,direction:null,point:s,margin:h},c,e),d=c.point,l=c.direction}else{var p=void 0;e.segments&&e.segments.length>1&&(p=a===e.sourceWrapper?e.segments[0].point:e.segments[e.segments.length-2].point),d=Ot(e,a,a.bounds.center,e.segments&&e.segments.length>1?p:s,a===e.targetWrapper)}a===e.sourceWrapper?(t.direction=t.direction||l,t.point=d,e.sourcePortWrapper&&(t.point={x:o.offsetX,y:o.offsetY},e.sourcePadding&&(t.point=ut(e,t,i,!1)))):(i.direction=i.direction||l,i.point=d,e.targetPortWrapper&&(i.point={x:n.offsetX,y:n.offsetY},e.targetPadding&&(i.point=ut(e,t,i,!0))))}(t,u,f);if("Straight"===t.type||"Bezier"===t.type)g=yt(t,u,f);else if("Orthogonal"===t.type&&t.segments&&t.segments.length>0&&null!==t.segments[0].length&&null!==t.segments[0].direction)g=function(e,t,i,r,o,n,a){var s,h,d,l,c,p=[];if(bt(e),e.segments.length>0){for(var g=0;g<e.segments.length;g++){var u=e.segments[g];if(0===g&&void 0!==e.sourcePortWrapper&&(l={x:n.offsetX,y:n.offsetY},d=Ht(l,Ph(r),r.bounds,!1),u.direction===_t(d)&&(u.direction=d)),g>0&&e.segments[g-1].direction===u.direction)g=wt(e,g,t);else{var f=e.segments[g-1];t.point=u.direction?st(t,u):f.points[f.points.length-1]}if(g===e.segments.length-1&&(a||o?e.targetWrapper&&void 0===e.targetPortWrapper?(Ct(e,t),h=dt(e,t,i)):h=ct(e,t,i):h=ht(e,t,i),h))if(gt(h,e,t),u.points=[],h.length>=2)for(s=0;s<h.length;s++)u.points.push(h[s]);else c=g;if(n&&0===g){var m=pt(e,n,r);m&&(t.point=m)}}void 0!==c&&(c===e.segments.length-1&&(e.segments[c-1].direction=null,e.segments[c-1].length=null),e.segments.splice(c,1)),p=St(e,p)}return p}(t,u,f,d,l,c,p);else{var v=void 0;u.direction?v=Lt(d.bounds,u,20):u.direction=f.direction?void 0!==t.targetPortWrapper?f.direction:_t(f.direction):a.direction(u.point,f.point),t.segments[0].points=g=kt(t,u,f,v)}return g}(t,"Straight"!==t.type&&t.sourceWrapper?t.sourceWrapper.corners.center:function(e){var t;if(e.sourcePortWrapper){var i=e.sourcePortWrapper,r={x:i.offsetX,y:i.offsetY};t=r}else if(e.sourceID&&e.sourceWrapper)if(e.targetWrapper){var o=e.sourceWrapper.corners.center,n=e.targetWrapper.corners.center;t=Ot(e,e.sourceWrapper,o,n,!1)}else t=e.sourcePoint;else t=e.sourcePoint;return t}(t),t.targetPoint,i,r);return It(t,o[0],!1),It(t,o[o.length-1],!0),o}function st(e,t){e.direction=t.direction,t.points=[],t.points.push(e.point);var i="Left"===t.direction||"Top"===t.direction?-t.length:t.length,r="Left"===t.direction||"Right"===t.direction?0:90,o=zt(e.point,i,r);return t.points.push(o),o}function ht(e,t,i){var r,o,n,a;(t.corners=e.sourceWrapper?e.sourceWrapper.corners:void 0,e.sourcePortWrapper)&&(n=Ht({x:e.sourcePortWrapper.offsetX,y:e.sourcePortWrapper.offsetY},Ph(e.sourceWrapper),e.sourceWrapper.bounds,!1),!t.corners||"Bottom"!==t.direction&&"Top"!==t.direction?!t.corners||"Left"!==t.direction&&"Right"!==t.direction||i.point.y>t.corners.top&&i.point.y<t.corners.bottom&&(o=t.point.x>i.point.x?"Left":"Right"):i.point.x>t.corners.left&&i.point.x<t.corners.right&&(o=t.point.y>i.point.y?"Top":"Bottom"));e.sourcePortWrapper&&n===_t(o)?(("Left"===n||"Right"===n)&&t.point.y>=t.corners.top&&t.point.y<=t.corners.center.y&&i.point.y>=t.corners.top&&i.point.y<=t.corners.center.y?(t.direction="Top",a=t.point.y-t.corners.top+20):("Left"===n||"Right"===n)&&t.point.y>t.corners.center.y&&t.point.y<=t.corners.bottom&&i.point.y>t.corners.center.y&&i.point.y<=t.corners.bottom?(t.direction="Bottom",a=t.corners.bottom-t.point.y+20):("Top"===n||"Bottom"===n)&&t.point.x>=t.corners.left&&t.point.x<=t.corners.center.x&&i.point.x>=t.corners.left&&i.point.x<=t.corners.center.x?(t.direction="Left",a=t.point.x-t.corners.left+20):("Top"===n||"Bottom"===n)&&t.point.x<=t.corners.right&&t.point.x>t.corners.center.x&&i.point.x<=t.corners.right&&i.point.x<t.corners.center.x&&(t.direction="Right",a=t.corners.right-t.point.x+20),t.direction&&a&&(r=kt(e,t,i,a,!0))):(t.direction=o||vt(t.direction,t.point,i.point),r=Mt(t,i));return r}function dt(e,t,i){var r;i.corners=e.targetWrapper.corners,Pt(e.targetWrapper,t,i,e);var o=vt(i.direction,t.point,i.point);t.direction!==i.direction||"Left"!==t.direction&&"Right"!==t.direction?(t.direction=o,r=Mt(t,i)):(t.direction=o,r=kt(e,t,i,e.targetWrapper.width/2+20),t.point=r[1],Pt(e.targetWrapper,t,i,e),r=kt(e,t,i));return r}function lt(e,t,i){var r,o;i.corners=e.targetWrapper.corners,"Left"!==t.direction&&"Right"!==t.direction?i.corners.center.y!==t.point.y||i.corners.left<=t.point.x&&t.point.x<=i.corners.right?i.corners.center.y===t.point.y&&"Bottom"===e.segments[e.segments.length-2].direction||i.corners.center.y>t.point.y&&t.point.y>=i.corners.top?(r="Top",o=t.point.y-i.corners.top+20):i.corners.center.y===t.point.y&&"Top"===e.segments[e.segments.length-2].direction||i.corners.center.y<t.point.y&&t.point.y<=i.corners.bottom?(r="Bottom",o=i.corners.bottom-t.point.y+20):void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&t.corners.top<=t.point.y&&t.point.y<=t.corners.bottom&&(r=t.direction,o=t.point.y>i.point.y?t.point.y-t.corners.top+20:t.corners.bottom-t.point.y+20):(r="Top",o=i.corners.height/2+20):i.corners.center.x!==t.point.x||i.corners.top<t.point.y&&t.point.y<=i.corners.bottom?i.corners.center.x===t.point.x&&"Right"===e.segments[e.segments.length-2].direction||i.corners.center.x>t.point.x&&t.point.x>=i.corners.left?(r="Left",o=t.point.x-i.corners.left+20):i.corners.center.x===t.point.x&&"Left"===e.segments[e.segments.length-2].direction||i.corners.center.x<=t.point.x&&t.point.x<=i.corners.right?(r="Right",o=i.corners.right-t.point.x+20):void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&t.corners.left<=t.point.x&&t.point.x<=t.corners.right&&(r=t.direction,o=t.point.x>i.point.x?t.point.x-t.corners.left+20:t.corners.right-t.point.x+20):(r="Left",o=i.corners.width/2+20);var n="Left"===r||"Top"===r?-o:o,s="Left"===r||"Right"===r?0:90,h=t.point;t.point=zt(t.point,n,s),t.direction=a.direction(t.point,i.point),void 0===e.sourcePortWrapper||void 0===e.targetPortWrapper||t.corners.center.x!==i.corners.center.x&&t.corners.center.y!==i.corners.center.y||(t.direction=i.direction);var d=kt(e,t,i);return d.splice(0,0,h),d}function ct(e,t,i){var r,o;(i.corners=e.targetWrapper.corners,void 0!==e.sourcePortWrapper)&&(o=Ht({x:e.sourcePortWrapper.offsetX,y:e.sourcePortWrapper.offsetY},Ph(e.sourceWrapper),e.sourceWrapper.bounds,!1));var n=function(e,t,i,r){var o=!1;switch(i.direction){case"Left":void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&"Right"===r&&t.point.x>i.point.x&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom||("Bottom"===r&&t.point.y>i.point.y||"Top"===r&&t.point.y<i.point.y)&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right?(t.direction="Right"===r?t.point.y>i.point.y?"Top":"Bottom":t.point.x<i.point.x?"Right":"Left",o=!0):t.point.x>i.point.x&&(t.point.y>i.point.y||t.point.y<i.point.y)&&!(i.corners.top>t.point.y&&i.corners.bottom<t.point.y)?t.direction="Left":t.point.x<i.point.x&&t.point.y>i.point.y||t.point.x>i.point.x&&t.point.y<=i.point.y&&i.corners.top<t.point.y&&i.corners.center.y>=t.point.y?t.direction="Top":t.point.x<i.point.x&&t.point.y<i.point.y||t.point.x>i.point.x&&t.point.y>i.point.y&&i.corners.bottom<t.point.y&&i.corners.center.y>t.point.y?t.direction="Bottom":t.point.y===i.point.y&&t.point.x<i.point.x&&(t.direction="Right");break;case"Right":void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&("Bottom"===r&&t.point.y>i.point.y||"Top"===r&&t.point.y<i.point.y)&&t.point.x>i.point.x&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right?(t.direction=t.point.x>i.point.x?"Left":"Right",o=!0):void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&"Left"===r&&t.point.x<i.point.x&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom?(t.direction=t.point.y>i.point.y?"Top":"Bottom",o=!0):t.point.x<i.point.x&&i.corners.top<=t.point.y&&i.corners.bottom>=t.point.y&&t.point.y===i.point.y||t.point.y>i.point.y&&t.point.x>i.point.x?t.direction="Top":t.point.y<i.point.y&&t.point.x>i.point.x?t.direction="Bottom":t.point.x<i.point.x&&(t.point.y>i.point.y||t.point.y<i.point.y)?t.direction="Right":t.point.y===i.point.y&&t.point.x>i.point.x&&(t.direction="Left");break;case"Top":void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&"Bottom"===r&&t.point.y>i.point.y&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right||("Right"===r&&t.point.x>i.point.x||"Left"===r&&i.point.y>t.point.y&&i.point.x>t.point.x)&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom?(t.direction="Bottom"===r?t.point.x>i.point.x?"Left":"Right":t.point.y<i.point.y?"Bottom":"Top",o=!0):t.point.x===i.point.x&&t.point.y<i.point.y?t.direction="Bottom":t.point.y>i.point.y&&t.point.x>i.corners.left&&t.point.x<i.corners.right?t.direction="Left":t.point.y>=i.point.y?t.direction="Top":t.point.y<i.point.y&&t.point.x>i.point.x?t.direction="Left":t.point.y<i.point.y&&t.point.x<i.point.x&&(t.direction="Right");break;case"Bottom":void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&(("Right"===r||"Left"===r&&i.point.x>t.point.x)&&t.point.y>i.point.y&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom||"Top"===r&&t.point.y<i.point.y&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right)?(t.direction="Right"===r||"Left"===r?t.point.y>i.point.y?"Top":"Bottom":t.point.x>i.point.x?"Left":"Right",o=!0):t.point.y<i.point.y&&t.point.x>i.corners.left&&i.corners.right>t.point.x?t.point.y<i.point.y&&t.point.x>i.corners.left&&i.corners.center.x>=t.point.x?t.direction="Left":t.point.y<i.point.y&&t.point.x<i.corners.right&&i.corners.center.x<t.point.x&&(t.direction="Right"):t.point.y>i.point.y&&t.point.x>i.point.x?t.direction="Left":t.point.y>i.point.y&&t.point.x<i.point.x?t.direction="Right":t.point.y<=i.point.y&&(t.point.x>i.point.x||i.point.x>t.point.x)&&(t.direction="Bottom")}return o}(e,t,i,o);return void 0!==e.sourcePortWrapper&&void 0!==e.targetPortWrapper&&i.direction===_t(o)&&(("Left"===i.direction&&t.point.x>i.point.x||"Right"===i.direction&&t.point.x<i.point.x)&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom||"Bottom"===i.direction&&t.point.y<i.point.y&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right)?r=lt(e,t,i):t.direction===i.direction?r=kt(e,t,i):("Left"===i.direction&&t.point.x>i.point.x||"Right"===i.direction&&t.point.x<i.point.x)&&("Top"===t.direction||"Bottom"===t.direction)&&t.point.y<=i.point.y&&i.corners.top<=t.point.y&&i.corners.bottom>=t.point.y||"Top"===i.direction&&t.point.y>i.point.y||"Bottom"===i.direction&&t.point.y<i.point.y&&i.corners.left<=t.point.x&&i.corners.right>=t.point.x?r=lt(e,t,i):void 0!==e.sourceWrapper&&void 0!==e.targetWrapper&&void 0!==e.targetPortWrapper&&("Left"===t.direction||"Right"===t.direction)&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom&&("Top"===i.direction||"Bottom"===i.direction)&&i.corners.center.x===t.corners.center.x?(t.direction="Top"===i.direction?"Bottom":"Top",r=kt(e,t,i,"Top"===i.direction?t.corners.bottom-t.point.y+20:t.point.y-t.corners.top+20)):void 0!==e.sourceWrapper&&void 0!==e.targetWrapper&&void 0!==e.targetPortWrapper&&("Top"===t.direction||"Bottom"===t.direction)&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right&&("Left"===i.direction||"Right"===i.direction)&&i.corners.center.y===t.corners.center.y?(t.direction="Left"===i.direction?"Right":"Left",r=kt(e,t,i,"Left"===i.direction?t.corners.right-t.point.x+20:t.point.x-t.corners.left+20)):r=n?kt(e,t,i,"Left"===t.direction||"Right"===t.direction?"Left"===t.direction?t.point.x-t.corners.left+20:t.corners.right-t.point.x+20:"Top"===t.direction?t.point.y-t.corners.top+20:t.corners.bottom-t.point.y+20):Mt(t,i),r}function pt(e,t,i){var r,o={x:t.offsetX,y:t.offsetY},n=Ph(i),s=Ht(o,n,i.bounds,!1),h=e.segments[0];return h.direction!==s&&(!function(e,t,i,r,o,n){var a,s,h=[];h.push(r),r.y===o.y&&("Left"===t&&o.x<r.x||"Right"===t&&o.x>r.x)||r.x===o.x&&("Top"===t&&o.y<r.y||"Bottom"===t&&o.y>r.y)||("Top"===t||"Bottom"===t?"Top"===t&&o.y<r.y&&o.y>r.y-13||"Bottom"===t&&o.y>r.y&&o.y<r.y+13?(s="Top"===t?i.top-13:i.bottom+13,h.push({x:r.x,y:s}),h.push({x:r.x+(o.x-r.x)/2,y:s}),h.push({x:r.x+(o.x-r.x)/2,y:o.y})):Math.abs(r.x-o.x)>13&&("Top"===t&&o.y<r.y||"Bottom"===t&&o.y>r.y)?h.push({x:r.x,y:o.y}):(s="Top"===t?i.top-13:i.bottom+13,a=o.x<r.x?i.left-13:i.right+13,h.push({x:r.x,y:s}),h.push({x:o.x,y:s})):"Left"===t&&o.x<r.x&&o.x>r.x-13||"right"===t&&o.x>r.x&&o.x<r.x+13?(a="Left"===t?i.left-13:i.right+13,h.push({x:a,y:r.y}),h.push({x:a,y:r.y+(o.y-r.y)/2}),h.push({x:o.x,y:r.y+(o.y-r.y)/2})):Math.abs(r.y-o.y)>13&&("Left"===t&&o.x<r.x||"Right"===t&&o.x>r.x)?h.push({x:o.x,y:r.y}):(a="Left"===t?i.left-13:i.right+13,h.push({x:a,y:r.y}),h.push({x:a,y:o.y})),n&&(h.push(e.points[0]),h.reverse()),e.points=h)}(h,s,n,h.points[0],h.points[h.points.length-1],!1),r=h.points[h.points.length-1],h.direction=a.direction(h.points[h.points.length-2],h.points[h.points.length-1])),r}function gt(e,t,i){var r,o=t.segments[t.segments.length-2],n=o.points[o.points.length-1];("Top"!==o.direction&&"Bottom"!==o.direction||n.x!==e[1].x)&&("Left"!==o.direction&&"Right"!==o.direction||n.y!==e[1].y)||(o.points[o.points.length-1]=e[1],r=a.direction(o.points[0],o.points[o.points.length-1]),void 0!==t.sourceWrapper&&void 0===t.sourcePortWrapper&&r===_t(o.direction)&&("Left"===o.direction||"Right"===o.direction?o.points[0].x="Right"===o.direction?o.points[0].x-t.sourceWrapper.corners.width:o.points[0].x+t.sourceWrapper.corners.width:o.points[0].y="Bottom"===o.direction?o.points[0].y-t.sourceWrapper.corners.height:o.points[0].y+t.sourceWrapper.corners.height),o.direction=r,o.length=a.distancePoints(o.points[0],o.points[o.points.length-1]),e.splice(0,1))}function ut(e,t,i,r){var o=e.sourcePortWrapper,n=e.targetPortWrapper,a=r?e.targetPadding:e.sourcePadding,s=r?n:o,h=new b(s.bounds.x-a,s.bounds.y-a,s.actualSize.width+2*a,s.actualSize.height+2*a),d=[h.topLeft,h.topRight,h.bottomRight,h.bottomLeft];d[d.length]=d[0];var l={x1:t.point.x,y1:t.point.y,x2:i.point.x,y2:i.point.y},c=r?i.point:t.point;return Dt(l,d,!0,c)||c}function ft(e,t){var i,r,o=[],n=Hn(e,e.corners,t);n.push(n[0]);for(var a=0;a<n.length-1;a++)o.push((i=n[a],r=n[a+1],void 0,{x1:i.x,y1:i.y,x2:r.x,y2:r.y}));return o}function mt(e,t,i){var r,o=e.rotateAngle+e.parentTransform;if(o){if(o<45)return t;if(o<=135)r={width:t.width,height:t.height,topLeft:t.bottomLeft,topCenter:t.middleLeft,topRight:t.topLeft,middleLeft:t.bottomCenter,center:i.center,middleRight:t.topCenter,bottomLeft:t.bottomRight,bottomCenter:t.middleRight,bottomRight:t.topRight,left:i.left,right:i.right,top:i.top,bottom:i.bottom};else if(o<=225)r={width:t.width,height:t.height,topLeft:t.bottomLeft,topCenter:t.bottomCenter,topRight:t.bottomRight,middleLeft:t.middleRight,center:i.center,middleRight:t.middleLeft,bottomLeft:t.topLeft,bottomCenter:t.topCenter,bottomRight:t.topRight,left:i.left,right:i.right,top:i.top,bottom:i.bottom};else{if(!(o<=315))return t;r={width:t.width,height:t.height,topLeft:t.topRight,topCenter:t.middleRight,topRight:t.bottomRight,middleLeft:t.topCenter,center:i.center,middleRight:t.bottomCenter,bottomLeft:t.topLeft,bottomCenter:t.middleLeft,bottomRight:t.bottomLeft,left:i.left,right:i.right,top:i.top,bottom:i.bottom}}return r}return t}function yt(e,t,i){var r=[];if(e.segments&&e.segments.length>0){var o=void 0,n=[],s=t.point;for(o=0;o<e.segments.length;o++){var h=e.segments[o];if((n=[]).push(s),o!==e.segments.length-1?(n.push(h.point),s=h.point):n.push(i.point),e.segments[o].points=n,e.segments.length>1&&a.equals(h.points[0],h.points[1])&&e.segments.splice(o,1),h)for(var d=0;d<h.points.length;d++)(d>0||0===o)&&r.push(h.points[d])}}return r}function vt(e,t,i){return"Top"===e||"Bottom"===e?i.x>t.x?"Right":"Left":i.y>t.y?"Bottom":"Top"}function bt(e){if("Straight"===e.type||"Bezier"===e.type){if(0===e.segments.length||e.segments.length>0&&!a.isEmptyPoint(e.segments[e.segments.length-1].point)){var t="Bezier"===e.type?new sr(e,"segments",{type:"Bezier"},!0):new ar(e,"segments",{type:"Straight"},!0);e.segments.push(t)}}else if(0===e.segments.length||e.segments[e.segments.length-1].direction){t=new hr(e,"segments",{type:"Orthogonal"},!0);e.segments.push(t)}}function wt(e,t,i){var r=e.segments[t],o="Left"===r.direction||"Top"===r.direction?-r.length:r.length,n="Left"===r.direction||"Right"===r.direction?0:90,a=zt(i.point,o,n);return e.segments[t-1].length+=r.length,e.segments[t-1].points[1]=i.point=a,e.segments.splice(t,1),--t}function xt(e,t,i){var r,o;e.sourcePortWrapper&&(o=Ht({x:e.sourcePortWrapper.offsetX,y:e.sourcePortWrapper.offsetY},Ph(e.sourceWrapper),e.sourceWrapper.bounds,!1));Pt(e.targetWrapper,t,i,e);var n=vt(i.direction,t.point,i.point);if(void 0===e.sourcePortWrapper||t.direction!==i.direction||("Top"!==t.direction&&"Bottom"!==t.direction||t.corners.center.x!==i.corners.center.x)&&("Left"!==t.direction&&"Right"!==t.direction||t.corners.center.y!==i.corners.center.y))if(i.point.x>=t.corners.left&&i.point.x<=t.corners.right&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom){t.direction=i.point.y>t.point.y?"Bottom":"Top",r=kt(e,t,i,"Top"===t.direction?t.point.y-t.corners.top+20:t.corners.bottom-t.point.y+20)}else if(e.sourcePortWrapper&&o===_t(n)){var a;("Left"===o||"Right"===o)&&t.point.y>=t.corners.top&&t.point.y<=t.corners.bottom?(t.direction=i.point.y>t.point.y?"Bottom":"Top",a=t.corners.height/2+20):("Top"===o||"Bottom"===o)&&t.point.x>=t.corners.left&&t.point.x<=t.corners.right&&(t.direction=i.point.x>t.point.x?"Right":"Left",a=t.corners.width/2+20),t.direction&&a?r=kt(e,t,i,a,!0):(t.direction=n,r=Mt(t,i))}else if(!e.sourcePortWrapper||o!==i.direction||"Top"!==o&&"Bottom"!==o||t.corners.center.x!==i.corners.center.x)t.direction=n,r=Mt(t,i);else{t.direction=i.point.y>t.point.y?"Bottom":"Top",r=kt(e,t,i,"Bottom"===t.direction?t.corners.bottom-t.point.y+20:t.point.y-t.corners.top+20)}else t.direction=n,r=kt(e,t,i,"Top"===n||"Bottom"===n?e.sourceWrapper.height/2+20:e.sourceWrapper.width/2+20),t.point=r[1],"Left"===n||"Right"===n?(i.direction=n,i.point="Left"===n?i.corners.middleLeft:i.corners.middleRight):Pt(e.targetWrapper,t,i,e),r=kt(e,t,i);return r}function Ct(e,t){if(void 0!==e.targetWrapper&&void 0===e.targetPortWrapper){if(Ph(e.targetWrapper).containsPoint(t.point,1)){var i=e.targetWrapper,r=e.segments[e.segments.length-2],o=r.points[r.points.length-1],n=_t(r.direction);"Bottom"===n?o.y<i.corners.bottom+1&&(r.points[r.points.length-1].y=i.corners.bottom+20,r.length=a.distancePoints(r.points[0],r.points[r.points.length-1])):"Top"===n?o.y>i.corners.top-1&&(r.points[r.points.length-1].y=i.corners.top-20,r.length=a.distancePoints(r.points[0],r.points[r.points.length-1])):"Left"===n?o.x>i.corners.left-1&&(r.points[r.points.length-1].x=i.corners.left-20,r.length=a.distancePoints(r.points[0],r.points[r.points.length-1])):"Right"===n&&o.x<i.corners.right+1&&(r.points[r.points.length-1].x=i.corners.right+20,r.length=a.distancePoints(r.points[0],r.points[r.points.length-1])),t.point=r.points[r.points.length-1]}}}function St(e,t){for(var i=0;i<e.segments.length;i++)for(var r=e.segments[i],o=0;o<r.points.length;o++)(o>0||0===i)&&t.push(r.points[o]);return t}function Pt(e,t,i,r){var o,n={x:0,y:0},a=mt(e,e.corners,e.bounds),s=t.margin,h=t.point;if(a.bottomCenter.y+s.bottom<h.y)o="Bottom",n=a.bottomCenter;else if(a.topCenter.y-s.top>h.y)o="Top",n=a.topCenter;else if(a.middleLeft.x-s.left>h.x)o="Left",n=a.middleLeft;else if(a.middleRight.x+s.right<h.x)o="Right",n=a.middleRight;else{var d=Math.abs(h.y-a.topCenter.y),l=Math.abs(h.x-a.middleRight.x),c=Math.abs(h.y-a.bottomCenter.y),p=Math.abs(h.x-a.middleLeft.x),g=Number.MAX_VALUE;g=d,o="Top",n=a.topCenter,g>l&&(g=l,o="Right",n=a.middleRight),g>c&&(g=c,o="Bottom",n=a.bottomCenter),g>p&&(o="Left",n=a.middleLeft)}i.point=n,i.direction=o;var u=At(a,_t(i.direction));i.point=Ot(r,e,i.point,u,e===r.targetWrapper)}function Tt(e,t){var i={x:t.x,y:e.y},r=a.findLength(i,t),o=a.findLength(t,e),n=Math.asin(r/o);return n=180*n/Math.PI,e.x<t.x?e.y>t.y&&(n=360-n):n=e.y<t.y?180-n:180+n,n}function At(e,t){var i;switch(t){case"Left":i=e.middleLeft;break;case"Top":i=e.topCenter;break;case"Right":i=e.middleRight;break;case"Bottom":i=e.bottomCenter}return i}function zt(e,t,i){return a.transform(e,i,t)}function Ot(e,t,i,r,o){i={x:i.x,y:i.y},r={x:r.x,y:r.y};var n,s,h=o?e.targetWrapper:e.sourceWrapper,d=o?e.targetPadding:e.sourcePadding,l=o||"Orthogonal"===e.type?i:r,c=h,p=jh(-h.parentTransform,h.offsetX,h.offsetY,i),g=jh(-h.parentTransform,h.offsetX,h.offsetY,r);if("Orthogonal"===e.type){p.x===g.x&&(p.y<g.y?p.y-=5:p.y+=5),p.y===g.y&&(p.x<g.x?p.x-=5:p.x+=5),i=jh(h.parentTransform,h.offsetX,h.offsetY,p)}else if(o){var u=a.findAngle(i,r);r=a.transform({x:r.x,y:r.y},u,Math.max(h.actualSize.width,h.actualSize.height))}else{u=a.findAngle(r,i);i=a.transform({x:i.x,y:i.y},u,Math.max(h.actualSize.width,h.actualSize.height))}return(e.sourcePadding||e.targetPadding)&&(n=new b(h.bounds.x-d,h.bounds.y-d,h.actualSize.width+2*d,h.actualSize.height+2*d)),h instanceof Me&&h.data?(s=n?[n.topLeft,n.topRight,n.bottomRight,n.bottomLeft]:c.getPoints(),c.data.split("m").length-1+(c.data.split("M").length-1)==1&&(s[s.length]=s[0])):(s=n?[n.topLeft,n.topRight,n.bottomRight,n.bottomLeft]:Hn(h,h.corners))[s.length]=s[0],Dt({x1:i.x,y1:i.y,x2:r.x,y2:r.y},s,!0,l)||i}function It(e,t,i){return t.x=Math.round(100*t.x)/100,t.y=Math.round(100*t.y)/100,i?e.targetPoint=t:e.sourcePoint=t,t}function Dt(e,t,i,r){var o,n=t.length,s={x1:t[0].x,y1:t[0].y,x2:t[1].x,y2:t[1].y},h=Et(e,s);if(h&&(o=a.distancePoints(h,r)),isNaN(o)||o>0)for(var d=1;d<n-1;d++){var l=Et(e,s={x1:t[d].x,y1:t[d].y,x2:t[d+1].x,y2:t[d+1].y});if(l){var c=a.distancePoints(l,r);if((isNaN(o)||o>c)&&(o=c,h=l),o>=0&&o<=1)break}}return h}function Et(e,t){var i,r,o,n,a,s,h,d,l,c,p,g,u=e.x1,f=e.y1,m=e.x2,y=e.y2,v=t.x1,b=t.y1,w=t.x2,x=t.y2;if(c=(i=y-f)*w+(o=u-m)*x+(a=m*f-u*y),0!==(l=i*v+o*b+a)&&0!==c&&Bt(l,c))return null;if(d=(r=x-b)*m+(n=v-w)*y+(s=w*b-v*x),0!==(h=r*u+n*f+s)&&0!==d&&Bt(h,d))return null;var C=i*n-r*o;return 0===C?null:(p=C<0?-C/2:C/2,p=0,{x:(g=o*s-n*a)<0?(g-p)/C:(g+p)/C,y:(g=r*a-i*s)<0?(g-p)/C:(g+p)/C})}function Bt(e,t){return e*t>=0}function Lt(e,t,i){switch(t.direction){case"Left":t.point.x>e.left&&(i=t.point.x-e.left>i?t.point.x-e.left+i:i);break;case"Right":t.point.x<e.right&&(i=e.right-t.point.x>i?e.right-t.point.x+i:i);break;case"Top":t.point.y>e.top&&(i=t.point.y-e.top>i?t.point.y-e.top+i:i);break;case"Bottom":t.point.y<e.bottom&&(i=e.bottom-t.point.y>i?e.bottom-t.point.y+i:i)}return i}function Mt(e,t){var i;switch(e.direction){case"Left":case"Right":var r={x:t.point.x,y:e.point.y};i=a.equals(e.point,r)||a.equals(t.point,r)?[e.point,t.point]:[e.point,r,t.point];break;case"Top":case"Bottom":var o={x:e.point.x,y:t.point.y};i=a.equals(e.point,o)||a.equals(t.point,o)?[e.point,t.point]:[e.point,o,t.point]}return i}function kt(e,t,i,r,o){r||(r=20);var n,a,s,h=e.sourcePortWrapper,d=i.point.x-t.point.x,l=i.point.y-t.point.y;if(!o&&(Math.abs(d)<.001||Math.abs(l)<.001)&&void 0===i.direction)return[t.point,i.point];if(void 0===e.targetWrapper&&Math.abs(d)<=31&&Math.abs(l)<=31){if("Left"===t.direction||"Right"===t.direction?Math.abs(l)<12&&(t.direction=t.point.y>i.point.y?"Top":"Bottom"):Math.abs(d)<12&&(t.direction=t.point.x>i.point.x?"Left":"Right"),Math.abs(d)>12||Math.abs(l)>12)return Mt(t,i);r+=5}return"Left"===t.direction||"Right"===t.direction?("Right"===t.direction?(void 0!==i.direction&&"Right"===i.direction&&(r=Math.max(t.point.x,i.point.x)-t.point.x+r),t.point.x>i.point.x&&void 0===h&&(r=-r)):(void 0!==i.direction&&"Left"===i.direction&&(r=t.point.x-Math.min(t.point.x,i.point.x)+r),(t.point.x>i.point.x||void 0!==h||"Left"===t.direction)&&(r=-r)),s=i.point.y-t.point.y,n=zt(t.point,r,0),0!==(s=i.point.y-n.y)&&(a=zt(n,i.point.y-n.y,90))):"Top"!==t.direction&&"Bottom"!==t.direction||("Bottom"===t.direction?void 0!==i.direction&&"Bottom"===i.direction&&(r=Math.max(t.point.y,i.point.y)-t.point.y+r):(void 0!==i.direction&&"Top"===i.direction&&(r=t.point.y-Math.min(t.point.y,i.point.y)+r),(t.point.y>i.point.y||void 0!==h||"Top"===t.direction)&&(r=-r)),s=i.point.x-t.point.x,n=(t.direction,zt(t.point,r,90)),0!==(s=i.point.x-n.x)&&(a=zt(n,i.point.x-n.x,0))),0===s?[t.point,i.point]:[t.point,n,a,i.point]}function Rt(e,t,i,r,o){var n;switch(void 0===o&&(o=20),void 0===i?(e.margin={left:2,right:2,top:2,bottom:2},t.margin={left:0,right:5,top:0,bottom:5}):"Bottom"===e.direction?t.corners.top>e.corners.bottom&&t.corners.top-e.corners.bottom<20&&(o=(t.corners.top-e.corners.bottom)/2):"Top"===e.direction?t.corners.bottom<e.corners.top&&e.corners.top-t.corners.bottom<20&&(o=(e.corners.top-t.corners.bottom)/2):"Right"===e.direction?t.corners.left>e.corners.right&&t.corners.left-e.corners.right<20&&(o=(t.corners.left-e.corners.right)/2):"Left"===e.direction&&t.corners.right<e.corners.left&&e.corners.left-t.corners.right<20&&(o=(e.corners.left-t.corners.right)/2),e.direction){case"Left":o=function(e,t,i,r){e.corners.left-e.margin.left>t.corners.left-t.margin.left&&e.corners.left-e.margin.left<=t.corners.right+t.margin.right?(("Bottom"===t.direction&&e.point.y<t.point.y||"Top"===t.direction&&e.point.y>t.point.y)&&(r+=e.corners.left-t.corners.left),r+=e.point.x-e.corners.left):void 0!==i&&"Top"!==i&&"Bottom"===t.direction&&e.point.y<t.point.y||void 0!==i&&"Bottom"!==i&&"Top"===t.direction&&t.point.y<e.point.y?r+=Math.abs(e.point.x-t.corners.right):r+=e.point.x-e.corners.left;return r}(e,t,i,o),n=zt(e.point,o,180);break;case"Right":o=function(e,t,i,r){e.corners.right+e.margin.right<t.corners.right+t.margin.right&&e.corners.right+e.margin.right>=t.corners.left-t.margin.left?(("Bottom"===t.direction&&e.point.y<t.point.y||"Top"===t.direction&&e.point.y>t.point.y)&&(i+=t.corners.right-e.corners.right),i+=e.corners.right-e.point.x):void 0!==r&&"Top"!==r&&"Bottom"===t.direction&&e.point.y<t.point.y||void 0!==r&&"Bottom"!==r&&"Top"===t.direction&&t.point.y<e.point.y?i+=Math.abs(e.point.x-t.corners.right):i+=e.corners.right-e.point.x;return i}(e,t,o,i),n=zt(e.point,o,0);break;case"Top":o=function(e,t,i,r){e.corners.top-e.margin.top>t.corners.top+t.margin.top&&e.corners.top-e.margin.top<=t.corners.bottom+t.margin.bottom?(("Right"===t.direction&&e.point.x<t.point.x||"Left"===t.direction&&e.point.x>t.point.x)&&(r+=e.corners.top-t.corners.top),r+=e.point.y-e.corners.top):void 0!==i&&"Left"!==i&&"Right"===t.direction&&e.point.x<t.point.x||void 0!==i&&"Right"!==i&&"Left"===t.direction&&t.point.x<e.point.x?r+=Math.abs(e.point.y-t.corners.bottom):r+=e.point.y-e.corners.top;return r}(e,t,i,o),n=zt(e.point,o,270);break;case"Bottom":o=function(e,t,i,r){e.corners.bottom+e.margin.bottom<t.corners.bottom+t.margin.bottom&&e.corners.bottom+e.margin.bottom>=t.corners.top-t.margin.top?(("Right"===t.direction&&e.point.x<t.point.x||"Left"===t.direction&&e.point.x>t.point.x)&&(i+=t.corners.bottom-e.corners.bottom),i+=e.corners.bottom-e.point.y):void 0!==r&&"Left"!==r&&"Right"===t.direction&&e.point.x<t.point.x||void 0!==r&&"Right"!==r&&"Left"===t.direction&&t.point.x<e.point.x?i+=Math.abs(e.point.y-t.corners.bottom):i+=e.corners.bottom-e.point.y;return i}(e,t,o,i),n=zt(e.point,o,90)}return void 0!==r?r.push(n):r=[e.point,n],"Top"===e.direction||"Bottom"===e.direction?Nt(n,"horizontal",e,t,r):"Right"!==e.direction&&"Left"!==e.direction||Nt(n,"vertical",e,t,r),r}function Nt(e,t,i,r,o){var n,a,s;"horizontal"===t?(i.margin={left:0,right:10,top:0,bottom:10},r.margin={left:0,right:10,top:0,bottom:10}):"vertical"===t&&(i.margin={left:10,right:0,top:10,bottom:0},r.margin={left:10,right:0,top:10,bottom:0});var h=20;if("horizontal"===t){switch(r.direction){case"Left":if(i.corners.right+i.margin.right<r.corners.left-r.margin.left&&(r.corners.left-i.corners.right>h||i.corners.top-i.margin.top<=r.point.y&&i.corners.bottom+i.margin.bottom>=r.point.y)){var d=Math.min(Math.abs(r.corners.left-i.corners.right)/2,20);h=i.corners.right-e.x+d}else h="Top"===i.direction&&e.y>r.point.y||"Bottom"===i.direction&&e.y<r.point.y?Math.min(r.corners.left,e.x)-e.x-20:e.x>=i.corners.left-i.margin.left&&e.x<=i.corners.right+i.margin.right?Math.min(r.corners.left,i.corners.left)-e.x-20:r.corners.left-e.x-20;break;case"Right":if(i.corners.left-i.margin.left>r.corners.right+r.margin.right&&(i.corners.left-r.corners.right>h||i.corners.top-i.margin.top<=r.point.y&&i.corners.bottom+i.margin.bottom>=r.point.y)){d=Math.min(Math.abs(i.corners.left-r.corners.right)/2,20);h=i.corners.left-e.x-d}else h="Top"===i.direction&&e.y>r.point.y||"Bottom"===i.direction&&e.y<r.point.y?Math.max(r.corners.right,e.x)-e.x+20:e.x>=i.corners.left-i.margin.left&&e.x<=i.corners.right+i.margin.right?Math.max(r.corners.right,i.corners.right)-e.x+20:r.corners.right-e.x+20}n=zt(e,h,0),a=zt(n,r.point.y-e.y,90),s=r.point}else if("vertical"===t){switch(r.direction){case"Top":if(i.corners.bottom+i.margin.bottom<r.corners.top-r.margin.top&&(r.corners.top-i.corners.bottom>h||i.corners.left-i.margin.left<=r.point.x&&i.corners.right+i.margin.right>=r.point.x)){d=Math.min(Math.abs(r.corners.top-i.corners.bottom)/2,20);h=i.corners.bottom-e.y+d}else h="Left"===i.direction&&e.x>r.point.x||"Right"===i.direction&&e.x<r.point.x?Math.min(r.corners.top,e.y)-e.y-20:e.y>=i.corners.top-i.margin.top&&e.y<=i.corners.bottom+i.margin.bottom?Math.min(r.corners.top,i.corners.top)-e.y-20:r.corners.top-e.y-20;break;case"Bottom":if(i.corners.top-i.margin.top>r.corners.bottom+r.margin.bottom&&(i.corners.top-r.corners.bottom>h||i.corners.left-i.margin.left<=r.point.x&&i.corners.right+i.margin.right>=r.point.x)){d=Math.min(Math.abs(i.corners.top-r.corners.bottom)/2,20);h=i.corners.top-e.y-d}else h="Left"===i.direction&&e.x>r.point.x||"Right"===i.direction&&e.x<r.point.x?Math.max(r.corners.bottom,e.y)-e.y+20:e.y>=i.corners.top-i.margin.top&&e.y<=i.corners.bottom+i.margin.bottom?Math.max(r.corners.bottom,i.corners.bottom)-e.y+20:r.corners.bottom-e.y+20}n=zt(e,h,90),a=zt(n,r.point.x-e.x,0),s=r.point}o.push(n),o.push(a),o.push(s)}function jt(e,t){var i=e.direction;e.direction=t.direction,t.direction=i;var r=e.point;e.point=t.point,t.point=r;var o=e.corners;e.corners=t.corners,t.corners=o}function Ht(e,t,i,r){var o=void 0===t?i:t,n=o.topLeft,a=o.topRight,s=o.bottomRight,h=o.bottomLeft,d=o.center,l=Tt(d,e),c=Tt(d,s),p=Tt(d,h),g=Tt(d,n),u=Tt(d,a);return l>g&&l<u?"Top":l>=c&&l<p?"Bottom":l>=p&&l<=g?"Left":"Right"}function Wt(e){var t=e.wrapper.children[0].bounds;return"None"!==e.sourceDecorator.shape&&t.uniteRect(e.wrapper.children[1].bounds),"None"!==e.targetDecorator.shape&&t.uniteRect(e.wrapper.children[2].bounds),t}function _t(e){switch(e){case"Top":return"Bottom";case"Bottom":return"Top";case"Left":return"Right";case"Right":return"Left"}return"auto"}var Vt,Xt,Yt=!1;function Ut(e,t,i,r,o){if(it=i+t==="topright"?void 0:o,it=o,Yt=!!r,!e)return{left:0,top:0};t||(t="left"),i||(i="top"),ot=e.ownerDocument,rt=e;return function(e,t,i){switch(tt=rt.getBoundingClientRect(),t+e){case"topcenter":Gt(ti(),i),Ft(Jt(),i);break;case"topright":Gt(ei(),i),Ft(Jt(),i);break;case"centercenter":Gt(ti(),i),Ft(Qt(),i);break;case"centerright":Gt(ei(),i),Ft(Qt(),i);break;case"centerleft":Gt($t(),i),Ft(Qt(),i);break;case"bottomcenter":Gt(ti(),i),Ft(Kt(),i);break;case"bottomright":Gt(ei(),i),Ft(Kt(),i);break;case"bottomleft":Gt($t(),i),Ft(Kt(),i);break;default:case"topleft":Gt($t(),i),Ft(Jt(),i)}return i}(t.toLowerCase(),i.toLowerCase(),{left:0,top:0})}function Gt(e,t){t.left=e}function Ft(e,t){t.top=e}function Zt(){return ot.documentElement.scrollTop||ot.body.scrollTop}function qt(){return ot.documentElement.scrollLeft||ot.body.scrollLeft}function Kt(){return Yt?tt.bottom:tt.bottom+Zt()}function Qt(){return Jt()+tt.height/2}function Jt(){return Yt?tt.top:tt.top+Zt()}function $t(){return tt.left+qt()}function ei(){return tt.right+qt()-(it?it.width:0)}function ti(){return $t()+tt.width/2}function ii(e,t,i,r){void 0===t&&(t=null);var o=Ut(e,"left","top");i&&(o.left=i),r&&(o.top=r);var n=[];Xt=t,Vt=e.ownerDocument;var a=e.getBoundingClientRect(),s=o.top,h=o.left,d=o.left+a.width,l=function(e,t){var i=!1,r=!1;e-ci()<si()&&(i=!0);t>li()&&(r=!0);return{topSide:i,bottomSide:r}}(s,o.top+a.height),c=function(e,t){var i=!1,r=!1;e-pi()<hi()&&(i=!0);t>di()&&(r=!0);return{leftSide:i,rightSide:r}}(h,d);return l.topSide&&n.push("top"),c.rightSide&&n.push("right"),c.leftSide&&n.push("left"),l.bottomSide&&n.push("bottom"),n}function ri(){return Xt.getBoundingClientRect().width}function oi(){return Xt.getBoundingClientRect().height}function ni(){return Xt.getBoundingClientRect().left}function ai(){return Xt.getBoundingClientRect().top}function si(){return Xt?ai():0}function hi(){return Xt?ni():0}function di(){return Xt?pi()+ni()+ri():pi()+ui()}function li(){return Xt?ci()+ai()+oi():ci()+gi()}function ci(){return Vt.documentElement.scrollTop||Vt.body.scrollTop}function pi(){return Vt.documentElement.scrollLeft||Vt.body.scrollLeft}function gi(){return window.innerHeight}function ui(){var e=window.innerWidth;return e-(e-(sf.base.isNullOrUndefined(document.documentElement)?0:document.documentElement.offsetWidth))}var fi,mi,yi=(fi=function(e,t){return(fi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}fi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),vi=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},bi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yi(t,e),vi([sf.base.Property({effect:"FadeIn",duration:150,delay:0})],t.prototype,"open",void 0),vi([sf.base.Property({effect:"FadeOut",duration:150,delay:0})],t.prototype,"close",void 0),t}(sf.base.ChildProperty),wi="e-popup-open",xi="e-popup-close",Ci=function(){function e(e){this.isBlazorTooltip=!1,this.contentEvent=null,this.width="auto",this.height="auto",this.content="",this.target="",this.position="TopCenter",this.offsetX=0,this.offsetY=0,this.tipPointerPosition="Auto",this.openDelay=0,this.closeDelay=0,this.cssClass="",this.element=e,this.tipClass="e-tip-bottom",this.tooltipPositionX="Center",this.tooltipPositionY="Top",this.isHidden=!0,this.showTipPointer=!0}return e.prototype.open=function(e,t,i){sf.base.isNullOrUndefined(this.animation.open)&&(this.animation.open=this.element.tooltip&&this.element.tooltip.animation&&this.element.tooltip.animation.open),this.showTooltip(e,t)},e.prototype.updateTooltip=function(e){this.tooltipEle&&(this.addDescribedBy(e,this.ctrlId+"_content"),this.renderContent(e),this.reposition(e),this.adjustArrow(e,this.position,this.tooltipPositionX,this.tooltipPositionY))},e.prototype.formatPosition=function(){var e,t;0===this.position.indexOf("Top")||0===this.position.indexOf("Bottom")?(e=this.position.split(/(?=[A-Z])/),this.tooltipPositionY=e[0],this.tooltipPositionX=e[1]):(t=this.position.split(/(?=[A-Z])/),this.tooltipPositionX=t[0],this.tooltipPositionY=t[1])},e.prototype.destroy=function(){},e.prototype.close=function(){if(this.tooltipEle){sf.base.removeClass([this.tooltipEle],"e-popup-close"),sf.base.addClass([this.tooltipEle],"e-popup-open"),sf.base.Animation.stop(this.tooltipEle);var e=void 0,t=this;t.isHidden=!0,this.animation.close&&(e={name:this.animation.close.effect,duration:this.animation.close.duration||0,delay:this.animation.close.delay||0,timingFunction:"easeOut"}),sf.base.isNullOrUndefined(e)?(sf.base.removeClass([this.tooltipEle],wi),sf.base.addClass([this.tooltipEle],xi),sf.base.remove(this.tooltipEle),this.tooltipEle=null):(e.end=function(){t.isHidden&&(sf.base.remove(t.tooltipEle),t.tooltipEle=null)},new sf.base.Animation(e).animate(this.tooltipEle))}},e.prototype.showTooltip=function(e,t,i){var r=this;clearTimeout(this.showTimer),clearTimeout(this.hideTimer),this.tooltipEventArgs={type:i?i.type:null,cancel:!1,target:e,event:i||null,element:this.tooltipEle,isInteracted:!sf.base.isNullOrUndefined(i)};this.element.trigger("beforeRender",this.tooltipEventArgs,function(o){r.beforeRenderCallback(o,e,i,t)}.bind(this))},e.prototype.beforeRenderCallback=function(e,t,i,r){this.formatPosition(),e.cancel?this.isHidden=!0:(this.isHidden=!1,sf.base.isNullOrUndefined(this.tooltipEle)?(this.ctrlId=this.element.element.id,this.tooltipEle=sf.base.createElement("div",{className:"e-tooltip-wrap e-popup e-lib",attrs:{role:"tooltip","aria-hidden":"false",id:this.ctrlId+"_content"},styles:"width:"+sf.base.formatUnit(this.width)+";height:"+sf.base.formatUnit(this.height)+";position:absolute; pointer-events:none;"}),this.beforeRenderBlazor(t,this),sf.base.Animation.stop(this.tooltipEle),this.afterRenderBlazor(t,i,r,this)):t&&(this.addDescribedBy(t,this.ctrlId+"_content"),this.renderContent(t),sf.base.Animation.stop(this.tooltipEle),this.reposition(t),this.afterRenderBlazor(t,i,r,this),this.adjustArrow(t,this.position,this.tooltipPositionX,this.tooltipPositionY)))},e.prototype.afterRenderBlazor=function(e,t,i,r){var o=this;if(e){sf.base.removeClass([r.tooltipEle],"e-popup-open"),sf.base.addClass([r.tooltipEle],"e-popup-close"),r.tooltipEventArgs={type:t?t.type:null,cancel:!1,target:e,event:t||null,element:r.tooltipEle,isInteracted:!sf.base.isNullOrUndefined(t)};var n=void 0;this.animation.open&&(n={name:this.animation.open.effect,duration:this.animation.open.duration||0,delay:this.animation.open.delay||0,timingFunction:"easeIn"}),sf.base.isNullOrUndefined(n)?(sf.base.removeClass([r.tooltipEle],"e-popup-close"),sf.base.addClass([r.tooltipEle],"e-popup-open")):(n.begin=function(){sf.base.removeClass([r.tooltipEle],xi),sf.base.addClass([r.tooltipEle],wi)},n.end=function(){o.element.trigger("open")},new sf.base.Animation(n).animate(this.tooltipEle))}},e.prototype.setTipClass=function(e){0===e.indexOf("Right")?this.tipClass="e-tip-left":0===e.indexOf("Bottom")?this.tipClass="e-tip-top":0===e.indexOf("Left")?this.tipClass="e-tip-right":this.tipClass="e-tip-bottom"},e.prototype.renderArrow=function(){this.setTipClass(this.position);var e=sf.base.createElement("div",{className:"e-arrow-tip "+this.tipClass});e.appendChild(sf.base.createElement("div",{className:"e-arrow-tip-outer "+this.tipClass})),e.appendChild(sf.base.createElement("div",{className:"e-arrow-tip-inner "+this.tipClass})),this.tooltipEle.appendChild(e)},e.prototype.getTooltipPosition=function(e){this.tooltipEle.style.display="block";var t=Ut(e,this.tooltipPositionX,this.tooltipPositionY),i=this.calculateTooltipOffset(this.position),r=this.collisionFlipFit(e,t.left+i.left,t.top+i.top);return this.tooltipEle.style.display="",r},e.prototype.checkCollision=function(e,t,i){var r={left:t,top:i,position:this.position,horizontal:this.tooltipPositionX,vertical:this.tooltipPositionY},o=ii(this.tooltipEle,this.target?this.element.element:null,t,i);return o.length>0&&(r.horizontal=o.indexOf("left")>=0?"Right":o.indexOf("right")>=0?"Left":this.tooltipPositionX,r.vertical=o.indexOf("top")>=0?"Bottom":o.indexOf("bottom")>=0?"Top":this.tooltipPositionY),r},e.prototype.collisionFlipFit=function(e,t,i){var r=this.checkCollision(e,t,i),o=r.position;if(this.tooltipPositionY!==r.vertical&&(o=0===this.position.indexOf("Bottom")||0===this.position.indexOf("Top")?r.vertical+this.tooltipPositionX:this.tooltipPositionX+r.vertical),this.tooltipPositionX!==r.horizontal&&(0===o.indexOf("Left")&&(r.vertical="LeftTop"===o||"LeftCenter"===o?"Top":"Bottom",o=r.vertical+"Left"),0===o.indexOf("Right")&&(r.vertical="RightTop"===o||"RightCenter"===o?"Top":"Bottom",o=r.vertical+"Right"),r.horizontal=this.tooltipPositionX),this.tooltipEventArgs={type:null,cancel:!1,target:e,event:null,element:this.tooltipEle,collidedPosition:o},this.element.trigger("beforeCollision",this.tooltipEventArgs),r.position!==o){var n=Ut(e,r.horizontal,r.vertical);this.adjustArrow(e,o,r.horizontal,r.vertical);var a=this.calculateTooltipOffset(o);a.top-=-1!=="TopBottom".indexOf(this.position.split(/(?=[A-Z])/)[0])&&-1!=="TopBottom".indexOf(o.split(/(?=[A-Z])/)[0])?2*this.offsetY:0,a.left-=-1!=="RightLeft".indexOf(this.position.split(/(?=[A-Z])/)[0])&&-1!=="RightLeft".indexOf(o.split(/(?=[A-Z])/)[0])?2*this.offsetX:0,r.position=o,r.left=n.left+a.left,r.top=n.top+a.top}else this.adjustArrow(e,o,r.horizontal,r.vertical);var s={left:r.left,top:r.top},h=function(e,t,i,r){if(void 0===t&&(t=null),void 0===i&&(i={X:!1,Y:!1}),!i.Y&&!i.X)return{left:0,top:0};var o=e.getBoundingClientRect();if(Xt=t,Vt=e.ownerDocument,r||(r=Ut(e,"left","top")),i.X){var n=Xt?ri():ui(),a=hi(),s=di(),h=a-r.left,d=r.left+o.width-s;o.width>n?r.left=h>0&&d<=0?s-o.width:d>0&&h<=0?a:h>d?s-o.width:a:h>0?r.left+=h:d>0&&(r.left-=d)}if(i.Y){var l=Xt?oi():gi(),c=si(),p=li(),g=c-r.top,u=r.top+o.height-p;o.height>l?r.top=g>0&&u<=0?p-o.height:u>0&&g<=0?c:g>u?p-o.height:c:g>0?r.top+=g:u>0&&(r.top-=u)}return r}(this.tooltipEle,this.target?this.element.element:null,{X:!0,Y:!1},s).left;if(this.tooltipEle.style.display="block",this.showTipPointer&&(0===o.indexOf("Bottom")||0===o.indexOf("Top"))){var d=this.tooltipEle.querySelector(".e-arrow-tip"),l=parseInt(d.style.left,10)-(h-r.left);l<0?l=0:l+d.offsetWidth>this.tooltipEle.clientWidth&&(l=this.tooltipEle.clientWidth-d.offsetWidth),d.style.left=l.toString()+"px"}return this.tooltipEle.style.display="",s.left=h,s},e.prototype.calculateTooltipOffset=function(e){var t={top:0,left:0},i=this.tooltipEle.offsetWidth,r=this.tooltipEle.offsetHeight,o=this.tooltipEle.querySelector(".e-arrow-tip"),n=o?o.offsetWidth:0,a=o?o.offsetHeight:0,s=this.showTipPointer?0:8,h=a/2+2+(this.tooltipEle.offsetHeight-this.tooltipEle.clientHeight),d=n/2+2+(this.tooltipEle.offsetWidth-this.tooltipEle.clientWidth);switch(e){case"RightTop":t.left+=n+s,t.top-=r-h;break;case"RightCenter":t.left+=n+s,t.top-=r/2;break;case"RightBottom":t.left+=n+s,t.top-=h;break;case"BottomRight":t.top+=a+s,t.left-=d;break;case"BottomCenter":t.top+=a+s,t.left-=i/2;break;case"BottomLeft":t.top+=a+s,t.left-=i-d;break;case"LeftBottom":t.left-=n+i+s,t.top-=h;break;case"LeftCenter":t.left-=n+i+s,t.top-=r/2;break;case"LeftTop":t.left-=n+i+s,t.top-=r-h;break;case"TopLeft":t.top-=r+a+s,t.left-=i-d;break;case"TopRight":t.top-=r+a+s,t.left-=d;break;default:t.top-=r+a+s,t.left-=i/2}return t.left+=this.offsetX,t.top+=this.offsetY,t},e.prototype.reposition=function(e){var t=this.getTooltipPosition(e);this.tooltipEle.style.left=t.left+"px",this.tooltipEle.style.top=t.top+"px"},e.prototype.beforeRenderBlazor=function(e,t){if(e){sf.base.Browser.isDevice&&sf.base.addClass([t.tooltipEle],"e-bigger"),"auto"!==t.width&&(t.tooltipEle.style.maxWidth=sf.base.formatUnit(t.width)),t.tooltipEle.appendChild(sf.base.createElement("div",{className:"e-tip-content e-diagramTooltip-content"})),document.body.appendChild(t.tooltipEle),sf.base.addClass([t.tooltipEle],"e-popup-open"),sf.base.removeClass([t.tooltipEle],"e-hidden"),t.addDescribedBy(e,t.ctrlId+"_content"),t.renderContent(e),sf.base.addClass([t.tooltipEle],"e-popup-open"),this.showTipPointer&&t.renderArrow();var i=this.getTooltipPosition(e);this.tooltipEle.classList.remove("e-lib"),this.tooltipEle.style.left=i.left+"px",this.tooltipEle.style.top=i.top+"px",t.reposition(e),t.adjustArrow(e,t.position,t.tooltipPositionX,t.tooltipPositionY)}},e.prototype.addDescribedBy=function(e,t){var i=(e.getAttribute("aria-describedby")||"").split(/\s+/);i.indexOf(t)<0&&i.push(t),sf.base.attributes(e,{"aria-describedby":i.join(" ").trim(),"data-tooltip-id":t})},e.prototype.renderContent=function(e){var t=this.tooltipEle.querySelector(".e-tip-content");if(this.cssClass&&sf.base.addClass([this.tooltipEle],this.cssClass.split(" ")),e&&!sf.base.isNullOrUndefined(e.getAttribute("title"))&&(e.setAttribute("data-content",e.getAttribute("title")),e.removeAttribute("title")),sf.base.isNullOrUndefined(this.content))e&&!sf.base.isNullOrUndefined(e.getAttribute("data-content"))&&(t.innerHTML=e.getAttribute("data-content"));else if(this.isBlazorTooltip,t.innerHTML="",this.content instanceof HTMLElement)t.appendChild(this.content);else if("string"==typeof this.content&&this.content.indexOf("<div>Blazor")<0)t.innerHTML=this.content;else{var i=sf.base.compile(this.content);sf.base.append(i({},null,null,this.element.element.id+"content"),t),"string"==typeof this.content&&this.content.indexOf("<div>Blazor")>=0&&(this.isBlazorTemplate=!0,sf.base.updateBlazorTemplate(this.element.element.id+"content","Content",this))}},e.prototype.updateTipPosition=function(e){var t=this.tooltipEle.querySelectorAll(".e-arrow-tip,.e-arrow-tip-outer,.e-arrow-tip-inner"),i=["e-tip-bottom","e-tip-top","e-tip-left","e-tip-right"];sf.base.removeClass(t,i),this.setTipClass(e),sf.base.addClass(t,this.tipClass)},e.prototype.adjustArrow=function(e,t,i,r){if(this.showTipPointer){var o,n;this.updateTipPosition(t),this.tooltipEle.style.display="block";var a,s=this.tooltipEle.clientWidth,h=this.tooltipEle.clientHeight,d=this.tooltipEle.querySelector(".e-arrow-tip"),l=this.tooltipEle.querySelector(".e-arrow-tip-inner"),c=d.offsetWidth,p=d.offsetHeight;if(this.tooltipEle.style.display="","e-tip-bottom"===this.tipClass||"e-tip-top"===this.tipClass){if("e-tip-bottom"===this.tipClass?(n="99.9%",l.style.top="-"+(p-2)+"px"):(n=-(p-1)+"px",l.style.top="-"+(p-6)+"px"),e)o=(a="Center"!==i||s>e.offsetWidth)&&"Left"===i||!a&&"End"===this.tipPointerPosition?s-c-2+"px":a&&"Right"===i||!a&&"Start"===this.tipPointerPosition?"2px":s/2-c/2+"px"}else"e-tip-right"===this.tipClass?(o="99.9%",l.style.left="-"+(c-2)+"px"):(o=-(c-1)+"px",l.style.left=c-2-c+"px"),n=(a="Center"!==r||h>e.offsetHeight)&&"Top"===r||!a&&"End"===this.tipPointerPosition?h-p-2+"px":a&&"Bottom"===r||!a&&"Start"===this.tipPointerPosition?"2px":h/2-p/2+"px";d.style.top=n,d.style.left=o}},e.prototype.getModuleName=function(){return"BlazorTooltip"},e}(),Si=(mi=function(e,t){return(mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}mi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Pi=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ti=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Si(t,e),Pi([sf.base.Property("")],t.prototype,"content",void 0),Pi([sf.base.Property("TopLeft")],t.prototype,"position",void 0),Pi([sf.base.Property("Mouse")],t.prototype,"relativeMode",void 0),Pi([sf.base.Property(!0)],t.prototype,"showTipPointer",void 0),Pi([sf.base.Property("auto")],t.prototype,"width",void 0),Pi([sf.base.Property("auto")],t.prototype,"height",void 0),Pi([sf.base.Property("Auto")],t.prototype,"openOn",void 0),Pi([sf.base.Property()],t.prototype,"animation",void 0),t}(sf.base.ChildProperty);function Ai(e){var t;if(sf.base.isBlazor())t=new Ci(e),t=Di(e.tooltip,t);else{var i=new sf.popups.Tooltip;i=Di(e.tooltip,i),(t=new sf.popups.Tooltip(i)).beforeCollision=Oi,t.beforeOpen=zi,t.cssClass="e-diagram-tooltip",t.opensOn="custom",t.appendTo("#"+e.element.id),t.close()}return t}function zi(e){""!==this.content&&void 0!==this.content||(e.element.style.display="none")}function Oi(e){e.collidedPosition&&e.collidedPosition!==this.position&&(e.element.style.display="none")}function Ii(e,t){var i=e.tooltipObject;return Di(t?t.tooltip:e.tooltip,i),i}function Di(e,t){return e.content?(t.content=e.content,t.position=e.position,t.showTipPointer=e.showTipPointer,t.width=e.width,t.height=e.height,e.animation?t.animation=e.animation:t.animation={close:{effect:"None"}}):t.close(),t}var Ei,Bi,Li,Mi,ki,Ri=(Ei=function(e,t){return(Ei=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ei(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ni=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},ji=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ri(t,e),Ni([sf.base.Property()],t.prototype,"width",void 0),Ni([sf.base.Property()],t.prototype,"height",void 0),t}(sf.base.ChildProperty),Hi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ri(t,e),Ni([sf.base.Property()],t.prototype,"width",void 0),Ni([sf.base.Property()],t.prototype,"height",void 0),Ni([sf.base.Property()],t.prototype,"fit",void 0),Ni([sf.base.Property()],t.prototype,"description",void 0),Ni([sf.base.Property()],t.prototype,"template",void 0),Ni([sf.base.Property()],t.prototype,"tooltip",void 0),t}(sf.base.ChildProperty),Wi=(Bi=function(e,t){return(Bi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Bi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),_i=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Vi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wi(t,e),_i([sf.base.Property("")],t.prototype,"id",void 0),_i([sf.base.Property(-1)],t.prototype,"zIndex",void 0),_i([sf.base.Complex({},ne)],t.prototype,"margin",void 0),_i([sf.base.Property(!0)],t.prototype,"visible",void 0),_i([sf.base.Complex({},Ti)],t.prototype,"tooltip",void 0),_i([sf.base.Property(!1)],t.prototype,"excludeFromLayout",void 0),_i([sf.base.Property()],t.prototype,"addInfo",void 0),_i([sf.base.Property("None")],t.prototype,"flip",void 0),_i([sf.base.Complex({},Hi)],t.prototype,"symbolInfo",void 0),t}(sf.base.ChildProperty),Xi=(Li=function(e,t){return(Li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Li(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Yi=function(e){function t(t,i,r,o){var n=e.call(this)||this;return n.data="",n.nodeId="",n.annotationId="",n.diagramId="",n.diagramId=i,n.nodeId=t,n.annotationId=r,n.templateFn=Sh(o),n}return Xi(t,e),t.prototype.getNodeTemplate=function(){return this.templateFn},Object.defineProperty(t.prototype,"content",{get:function(){return this.data},set:function(e){this.data=e,this.canReset||(this.canReset=!0,this.isTemplate||(this.template=uh(this,!0)),this.canReset=!1,this.isDirt=!0)},enumerable:!0,configurable:!0}),t}(be),Ui=(Mi=function(e,t){return(Mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Mi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Gi=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Fi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ui(t,e),Gi([sf.base.Property("")],t.prototype,"id",void 0),Gi([sf.base.Property("transparent")],t.prototype,"fill",void 0),Gi([sf.base.Property("black")],t.prototype,"iconStrokeColor",void 0),Gi([sf.base.Property(0)],t.prototype,"iconStrokeWidth",void 0),Gi([sf.base.Property(!0)],t.prototype,"visibility",void 0),Gi([sf.base.Property(10)],t.prototype,"width",void 0),Gi([sf.base.Property(10)],t.prototype,"height",void 0),Gi([sf.base.Property("transparent")],t.prototype,"handleStrokeColor",void 0),Gi([sf.base.Property(1)],t.prototype,"handleStrokeWidth",void 0),Gi([sf.base.Property("")],t.prototype,"pathData",void 0),Gi([sf.base.Property(0)],t.prototype,"cornerRadius",void 0),Gi([sf.base.Complex({left:0,right:0,top:0,bottom:0},ne)],t.prototype,"padding",void 0),t}(sf.base.ChildProperty),Zi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ui(t,e),Gi([sf.base.Complex({x:0,y:0},a)],t.prototype,"offset",void 0),Gi([sf.base.Complex({},ne)],t.prototype,"margin",void 0),t}(Fi),qi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ui(t,e),Gi([sf.base.Property(.5)],t.prototype,"offset",void 0),Gi([sf.base.Property("Center")],t.prototype,"alignment",void 0),Gi([sf.base.Complex({x:0,y:0},a)],t.prototype,"displacement",void 0),t}(Fi),Ki=(ki=function(e,t){return(ki=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ki(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Qi=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ji=function(e){if(sf.base.isBlazor())return br;if(e)switch(e.type){case"Bpmn":return or;case"UmlActivity":return rr;case"UmlClassifier":return vr;default:return ir}return ir},$i=function(e){if(e){if(sf.base.isBlazor())return dr;switch(e.type){case"Straight":return ar;case"Bezier":return sr;case"Orthogonal":return hr;default:return ar}}},er=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property(10)],t.prototype,"width",void 0),Qi([sf.base.Property(10)],t.prototype,"height",void 0),Qi([sf.base.Property("Arrow")],t.prototype,"shape",void 0),Qi([sf.base.Complex({fill:"black",strokeColor:"black",strokeWidth:1},pe)],t.prototype,"style",void 0),Qi([sf.base.Complex({x:0,y:.5},a)],t.prototype,"pivot",void 0),Qi([sf.base.Property("")],t.prototype,"pathData",void 0),t}(sf.base.ChildProperty),tr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property(0)],t.prototype,"angle",void 0),Qi([sf.base.Property(0)],t.prototype,"distance",void 0),t}(sf.base.ChildProperty),ir=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property("None")],t.prototype,"type",void 0),t}(sf.base.ChildProperty),rr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property("Object")],t.prototype,"flow",void 0),Qi([sf.base.Property(30)],t.prototype,"exceptionFlowHeight",void 0),t}(ir),or=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property("Sequence")],t.prototype,"flow",void 0),Qi([sf.base.Property("Normal")],t.prototype,"sequence",void 0),Qi([sf.base.Property("Default")],t.prototype,"message",void 0),Qi([sf.base.Property("Default")],t.prototype,"association",void 0),t}(ir),nr=function(e){function t(t,i,r,o){var n=e.call(this,t,i,r,o)||this;return n.points=[],n}return Ki(t,e),Qi([sf.base.Property("Straight")],t.prototype,"type",void 0),Qi([sf.base.Property(!0)],t.prototype,"allowDrag",void 0),t}(sf.base.ChildProperty),ar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),t.prototype.getClassName=function(){return"StraightSegment"},Qi([sf.base.Complex({x:0,y:0},a)],t.prototype,"point",void 0),t}(nr),sr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),t.prototype.getClassName=function(){return"BezierSegment"},Qi([sf.base.Complex({x:0,y:0},a)],t.prototype,"point1",void 0),Qi([sf.base.Complex({x:0,y:0},a)],t.prototype,"point2",void 0),Qi([sf.base.Complex({angle:0,distance:0},tr)],t.prototype,"vector1",void 0),Qi([sf.base.Complex({angle:0,distance:0},tr)],t.prototype,"vector2",void 0),t}(ar),hr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),t.prototype.getClassName=function(){return"OrthogonalSegment"},Qi([sf.base.Property(null)],t.prototype,"length",void 0),Qi([sf.base.Property(null)],t.prototype,"direction",void 0),t}(nr),dr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),t.prototype.getClassName=function(){return"DiagramConnectorSegment"},Qi([sf.base.Property("Straight")],t.prototype,"type",void 0),Qi([sf.base.Property(!0)],t.prototype,"allowDrag",void 0),Qi([sf.base.Complex({x:0,y:0},a)],t.prototype,"point",void 0),Qi([sf.base.Complex({x:0,y:0},a)],t.prototype,"point1",void 0),Qi([sf.base.Complex({x:0,y:0},a)],t.prototype,"point2",void 0),Qi([sf.base.Complex({angle:0,distance:0},tr)],t.prototype,"vector1",void 0),Qi([sf.base.Complex({angle:0,distance:0},tr)],t.prototype,"vector2",void 0),Qi([sf.base.Property(null)],t.prototype,"length",void 0),Qi([sf.base.Property(null)],t.prototype,"direction",void 0),t}(sf.base.ChildProperty);function lr(e,t,i){var r=e.center,o=i?45:180/(2+2/(e.height/e.width)),n=o,a=180-o,s=a+2*o,h=360-o,d=Tt(t,r);return d>n&&d<a?"top":d>a&&d<s?"right":d>s&&d<h?"bottom":"left"}function cr(e){return!e.distance&&!e.angle}function pr(e,t,i){var r=60,o={x:0,y:0};switch(i||(i=Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?e.x<t.x?"right":"left":e.y<t.y?"bottom":"top"),i){case"bottom":case"top":r=Math.min(.45*Math.abs(e.y-t.y),r),o={x:e.x,y:e.y+("bottom"===i?r:-r)};break;case"right":case"left":r=Math.min(.45*Math.abs(e.x-t.x),r),o={x:e.x+("right"===i?r:-r),y:e.y}}return o}function gr(e,t,i,r,o){var n=0,a=0,s=0,h=0,d=Number((o.distance(t,e)+o.distance(i,t)+o.distance(r,i))/3);if(0!==d)for(var l=0;l<=d;l++){var c=l/d,p=(1-c)*(1-c)*(1-c)*e.x+3*c*(1-c)*(1-c)*t.x+3*c*c*(1-c)*i.x+c*c*c*r.x,g=(1-c)*(1-c)*(1-c)*e.y+3*c*(1-c)*(1-c)*t.y+3*c*c*(1-c)*i.y+c*c*c*r.y;0===l?(n=s=p,a=h=g):(n=Math.min(p,n),a=Math.min(g,a),s=Math.max(p,s),h=Math.max(g,h))}return{x:n,y:a,width:s-n,height:h-a,left:n,top:a,right:n+(s-n),bottom:a+(h-a),center:{x:(n+(s-n))/2,y:(a+(h-a))/2}}}function ur(e,t,i,r,o,n,a){var s={x:0,y:0},h=n/a,d=(1-h)*(1-h)*(1-h)*t.x+3*h*(1-h)*(1-h)*i.x+3*h*h*(1-h)*r.x+h*h*h*o.x;s.x=d;var l=(1-h)*(1-h)*(1-h)*t.y+3*h*(1-h)*(1-h)*i.y+3*h*h*(1-h)*r.y+h*h*h*o.y;return s.y=l,s}var fr,mr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property(!0)],t.prototype,"optional",void 0),Qi([sf.base.Property(void 0)],t.prototype,"lowerBounds",void 0),Qi([sf.base.Property(void 0)],t.prototype,"upperBounds",void 0),t}(sf.base.ChildProperty),yr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property("OneToOne")],t.prototype,"type",void 0),Qi([sf.base.Complex({},mr)],t.prototype,"target",void 0),Qi([sf.base.Complex({},mr)],t.prototype,"source",void 0),t}(sf.base.ChildProperty),vr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property("UmlClassifier")],t.prototype,"type",void 0),Qi([sf.base.Property("Aggregation")],t.prototype,"relationship",void 0),Qi([sf.base.Property("Directional")],t.prototype,"associationType",void 0),Qi([sf.base.Complex({},yr)],t.prototype,"multiplicity",void 0),t}(ir),br=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ki(t,e),Qi([sf.base.Property("None")],t.prototype,"type",void 0),Qi([sf.base.Property("Directional")],t.prototype,"associationType",void 0),Qi([sf.base.Property("Aggregation")],t.prototype,"relationship",void 0),Qi([sf.base.Complex({},yr)],t.prototype,"multiplicity",void 0),Qi([sf.base.Property("Sequence")],t.prototype,"bpmnFlow",void 0),Qi([sf.base.Property("Default")],t.prototype,"message",void 0),Qi([sf.base.Property("Normal")],t.prototype,"sequence",void 0),Qi([sf.base.Property("Default")],t.prototype,"association",void 0),Qi([sf.base.Property("Object")],t.prototype,"umlActivityFlow",void 0),Qi([sf.base.Property(30)],t.prototype,"exceptionFlowHeight",void 0),t}(sf.base.ChildProperty),wr=function(t){function r(e,i,r,o){var n=t.call(this,e,i,r,o)||this;return n.parentId="",n.bridges=[],n.status="None",n.shape&&"UmlActivity"===n.shape.type&&On(r,n),r&&r.shape&&"None"!==r.shape.type&&In(r,n),n}return Ki(r,t),r.prototype.setPortID=function(t,i){if(this.targetID&&this.sourceID)for(var r=t.nameTable[this.targetID],o=t.nameTable[this.sourceID],n=i?r&&r.ports:o&&o.ports,a=void 0,s=0;n&&s<n.length;s++)a=n[s],this.targetPortID===a.id&&i?!(a.constraints&e.PortConstraints.None)&&a.constraints&e.PortConstraints.InConnect||(this.targetPortID=""):this.sourcePortID!==a.id||i||!(a.constraints&e.PortConstraints.None)&&a.constraints&e.PortConstraints.OutConnect||(this.sourcePortID="")},r.prototype.init=function(e){var t;this.id||(this.id=xh()),this.sourcePortID&&this.setPortID(e),this.targetPortID&&this.setPortID(e,!0);var i=new Te,r=new Me;r.id=this.id+"_path";var o=new Me,n=new Me;r=this.getSegmentElement(this,r);var s=[];s=this.getConnectorPoints(this.type),s=this.clipDecorators(this,s);var h=b.toBounds(s);switch(i.width=h.width,i.height=h.height,i.offsetX=h.x+i.pivot.x*h.width,i.offsetY=h.y+i.pivot.y*h.height,this.shape.type){case"Bpmn":switch(sf.base.isBlazor()?this.shape.bpmnFlow:this.shape.flow){case"Sequence":t=this.getBpmnSequenceFlow();break;case"Association":(t=new Me).visible=!1,this.getBpmnAssociationFlow();break;case"Message":t=this.getBpmnMessageFlow(),r=this.getSegmentElement(this,r),this.updateShapePosition(this,t)}break;case"UmlActivity":switch(sf.base.isBlazor()?this.shape.umlActivityFlow:this.shape.flow){case"Object":this.getUMLObjectFlow();break;case"Exception":this.getUMLExceptionFlow(r)}break;case"UmlClassifier":this.getConnectorRelation()}var d=this.intermediatePoints;if("Bezier"===this.type){var l=this.segments[0],c=this.segments[this.segments.length-1];d=[a.isEmptyPoint(c.point2)?c.bezierPoint2:c.point2,a.isEmptyPoint(l.point1)?l.bezierPoint1:l.point1]}var p=e.getDescription;if(o=this.getDecoratorElement(s[0],d[1],this.sourceDecorator,!0,p),n=this.getDecoratorElement(s[s.length-1],d[d.length-2],this.targetDecorator,!1,p),o.id=this.id+"_srcDec",n.id=this.id+"_tarDec",r.style=this.style,r.style.fill="transparent",void 0!==p){var g=p(this,e);r.description=g||this.id}i.style.strokeColor="transparent",i.style.fill="transparent",i.style.strokeWidth=0,i.children=[r,o,n],i.id=this.id,void 0!==t&&i.children.push(t),i.offsetX=r.offsetX,i.offsetY=r.offsetY,i.width=r.width,i.height=r.height;for(var u=0;this.annotations,u<this.annotations.length;u++)i.children.push(this.getAnnotationElement(this.annotations[u],this.intermediatePoints,h,p,e.element.id,e.annotationTemplate));for(u=0;this.fixedUserHandles,u<this.fixedUserHandles.length;u++)i.children.push(this.getfixedUserHandle(this.fixedUserHandles[u],this.intermediatePoints,h));return this.wrapper=i,i},r.prototype.getConnectorRelation=function(){var e=this.shape;"Association"===e.relationship?(this.segments[0].type="Straight",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow"):"Inheritance"===e.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow"):"Composition"===e.relationship||"Aggregation"===e.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="Diamond",this.targetDecorator.shape="None"):"Dependency"===e.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="OpenArrow"):"Realization"===e.relationship&&(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow"),"BiDirectional"===e.associationType&&(this.sourceDecorator.shape="None",this.targetDecorator.shape="None");var t,i,r="",o="";e.multiplicity.source&&(e.multiplicity.source.lowerBounds=e.multiplicity.source.lowerBounds,e.multiplicity.source.upperBounds=e.multiplicity.source.upperBounds),e.multiplicity.target&&(e.multiplicity.target.lowerBounds=e.multiplicity.target.lowerBounds,e.multiplicity.target.upperBounds=e.multiplicity.target.upperBounds);var n=e.multiplicity.source,a=e.multiplicity.target;i=n.upperBounds?n.lowerBounds+"..."+n.upperBounds:n.lowerBounds,t=a.upperBounds?a.lowerBounds+"..."+a.upperBounds:a.lowerBounds,"ManyToOne"===e.multiplicity.type&&(e.multiplicity.target.optional=!1,r=i||"*",o="1"),"OneToMany"===e.multiplicity.type&&(e.multiplicity.source.optional=!1,o=t||"*",r="1"),"ManyToOne"===e.multiplicity.type&&(r=i||"*",o=t||"*"),"OneToOne"===e.multiplicity.type&&(e.multiplicity.target.optional=!1,e.multiplicity.source.optional=!1,r="1",o="1"),this.annotations=[{id:this.id+"sourcelabel",content:r,offset:0,alignment:"Before",margin:{right:5,bottom:5}},{id:this.id+"targetlabel",content:o,offset:1,alignment:"Before",margin:{right:5,bottom:5}}]},r.prototype.getBpmnSequenceFlow=function(){var e=new Me,t=new Me;if("Normal"===this.shape.sequence&&"Bezier"!==this.type&&(this.targetDecorator.shape="Arrow"),"Default"===this.shape.sequence){e=this.getSegmentElement(this,e);var i=this.intermediatePoints;t=Ra(i,this),this.targetDecorator.shape="Arrow"}return"Conditional"===this.shape.sequence&&(this.targetDecorator.shape="Arrow",this.sourceDecorator.shape="Diamond",t.id=this.id+this.shape.type),t},r.prototype.getUMLObjectFlow=function(){if(this.annotations)for(var e=0;e<this.annotations.length;e++)this.annotations[e].content="["+this.annotations[e].content+"]"},r.prototype.getUMLExceptionFlow=function(e){this.type="Straight";var t=this.shape.exceptionFlowHeight/2,i={x:(this.targetPoint.x+this.sourcePoint.x)/2,y:(this.targetPoint.y+this.sourcePoint.y)/2},r=i.x-this.sourcePoint.x,o=i.y-this.sourcePoint.y,n=t/Math.sqrt(r*r+o*o),a={x:i.x-r*n,y:i.y-o*n},s={x:i.x+r*n,y:i.y+o*n},h=x();P(h,315,i.x,i.y),this.segments=[];var d=new ar(this,"segments",{type:"Straight",point:C(h,s)},!0);this.segments.push(d),d=new ar(this,"segments",{type:"Straight",point:C(h,a)},!0),this.segments.push(d),e=this.getSegmentElement(this,e)},r.prototype.getBpmnAssociationFlow=function(){"Default"===this.shape.association&&(this.targetDecorator.shape="Arrow"),"Directional"===this.shape.association&&(this.targetDecorator.shape="Arrow"),"BiDirectional"===this.shape.association&&(this.targetDecorator.shape="Arrow",this.sourceDecorator.shape="Arrow")},r.prototype.getfixedUserHandle=function(e,t,i){var r=new Te;r.float=!0;e.id=e.id||xh(),r.id=this.id+"_"+e.id,r.children=[],r.visible=e.visibility,r.width=e.width,r.height=e.height,r.style.strokeWidth=e.handleStrokeWidth,r.style.fill=e.fill,r.style.strokeColor=e.handleStrokeColor,r.cornerRadius=e.cornerRadius,this.updateAnnotation(e,t,i,r);var o=Vn(e,r);return r.children.push(o),r.description=r.id,r},r.prototype.getBpmnMessageFlow=function(){var t=new Me;return this.targetDecorator.shape="Arrow",this.targetDecorator.width=5,this.targetDecorator.height=10,this.sourceDecorator.shape="Circle","InitiatingMessage"!==this.shape.message&&"NonInitiatingMessage"!==this.shape.message||(t.id=this.id+"_"+this.shape.message,t.width=25,t.height=15,t.data="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",t.horizontalAlignment="Center",t.verticalAlignment="Center",t.transform=e.Transform.Self,t.style.fill="NonInitiatingMessage"===this.shape.message?"lightgrey":"white"),t},r.prototype.distance=function(e,t){return Wa(e,t)},r.prototype.findPath=function(e,t){return ja(e,t)},r.prototype.getAnnotationElement=function(e,t,i,r,o,n){var a,s;e.id=e.id||xh(),sf.base.isBlazor()&&"Template"===e.annotationType&&(e.template=e.template?e.template:""),o&&(e.template||"Template"===e.annotationType||n&&""===e.content)?a=wh(a=new Yi(this.id,o,e.id,n),e,n):((a=new Se).content=e.content,a.style.textOverflow="Wrap"),a.constraints=e.constraints,a.visible=e.visibility,a.rotateAngle=e.rotateAngle,a.horizontalAlignment=e.horizontalAlignment,a.verticalAlignment=e.verticalAlignment,a.width=e.width,a.height=e.height,void 0===i.width||e.template||(a.width=(e.width||i.width)-e.margin.left-e.margin.right),a.margin=e.margin,a.id=this.id+"_"+e.id,0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth),a.style=e.style;var h=Wh(r);return h&&(s=h(e,this)),a.description=s||a.id,this.updateAnnotation(e,t,i,a),a},r.prototype.updateAnnotation=function(e,t,i,r,o){var n={x:0,y:0};r instanceof Yi||be||o||r.refreshTextElement(),r.width=e.width||i.width;var a=Yn(t,e,i),s=a.point;e instanceof Ze&&e.segmentAngle&&(r.rotateAngle=e.rotateAngle+a.angle,r.rotateAngle=(r.rotateAngle+360)%360),0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth);var h=(s.x-i.x)/i.width,d=(s.y-i.y)/i.height;n.x=i.width*h,n.y=i.height*d;var l,c,p=Fn(e,a.angle,t),g=p.hAlign,u=p.vAlign;"left"===g?(l="Left",n.x+=e.displacement.x):"right"===g?(l="Right",n.x-=e.displacement.x):"center"===g&&(l="Center"),"top"===u?(c="Top",n.y+=e.displacement.y):"bottom"===u?(c="Bottom",n.y-=e.displacement.y):"center"===u&&(c="Center"),r.horizontalAlignment=l,r.verticalAlignment=c,r.setOffsetWithRespectToBounds(n.x,n.y,"Absolute"),r.relativeMode="Point"},r.prototype.getConnectorPoints=function(e,t,i,r){var o=at(this,i,r).slice(0);return o&&o.length>0&&(this.sourcePoint=o[0],this.targetPoint=o[o.length-1]),o},r.prototype.clipDecorator=function(t,i,r,o){var n,s,h={x:0,y:0},d=i.length;n=r?i[0]:i[d-1],s=r?i[1]:i[d-2];var l=a.distancePoints(n,s);l=0===l?1:l;var c=1,p=r?t.sourceWrapper:t.targetWrapper;p&&(c=p.style.strokeWidth,o&&o&e.DiagramAction.DecoratorPropertyChange&&(c=1));var g=c-1;return h.x=Math.round(n.x+g*(s.x-n.x)/l),h.y=Math.round(n.y+g*(s.y-n.y)/l),(r&&"None"!==t.sourceDecorator.shape||!r&&"None"!==t.targetDecorator.shape)&&(h=a.adjustPoint(h,s,!0,o&e.DiagramAction.DecoratorPropertyChange?0:c/2)),h},r.prototype.clipDecorators=function(e,t,i){return"None"!==e.sourceDecorator.shape&&(t[0]=this.clipDecorator(e,t,!0,i)),"None"!==e.targetDecorator.shape&&(t[t.length-1]=this.clipDecorator(e,t,!1,i)),t},r.prototype.updateSegmentElement=function(e,t,i,r){var o=new b,n=this.getSegmentPath(e,t,r);if("Bezier"===e.type){if(this.segments.length>0)for(var s=0;s<this.segments.length;s++){var h=this.segments[s],d=e.segments[s],l=a.isEmptyPoint(h.point1)?d.bezierPoint1:d.point1,c=a.isEmptyPoint(h.point2)?d.bezierPoint2:d.point2;o.uniteRect(gr(h.points[0],l,c,h.points[1],e))}}else o=b.toBounds(t);return i.width=o.width,i.height=o.height,i.offsetX=o.x+i.width/2,i.offsetY=o.y+i.height/2,i.data=n,e.wrapper&&(e.wrapper.offsetX=i.offsetX,e.wrapper.offsetY=i.offsetY,e.wrapper.width=o.width,e.wrapper.height=o.height),i},r.prototype.getSegmentElement=function(e,t,i,r){var o;return Ba(e),o=this.getConnectorPoints(e.type,void 0,i),this.intermediatePoints=o,t.staticSize=!0,t=this.updateSegmentElement(e,o,t,r)},r.prototype.getDecoratorElement=function(t,i,r,o,n){var a=new Me;if(a.transform=e.Transform.Self,this.updateDecoratorElement(a,t,i,r),void 0!==n){var s=n(r,this);a.description=s||"source"}return a},r.prototype.bridgePath=function(e,t,i){var r=t;if(e.bridges.length>0)if("Straight"===e.type&&e.segments.length<2)for(var o=0;o<e.bridges.length;o++){(n=e.bridges[o]).rendered||(r+=" L"+n.startPoint.x+" "+n.startPoint.y,r+=n.path,n.rendered=!0)}else if("Orthogonal"===e.type||"Straight"===e.type&&e.segments.length>1)for(o=0;o<e.bridges.length;o++){var n;(n=e.bridges[o]).segmentPointIndex===i&&(n.rendered||n.segmentPointIndex===i&&(r+=" L"+n.startPoint.x+" "+n.startPoint.y,r+=n.path,n.rendered=!0))}return r},r.prototype.updateDecoratorElement=function(e,t,r,o){e.offsetX=t.x,e.offsetY=t.y;var n=a.findAngle(t,r),s=Ke(o.shape,o),h=new i(o.width,o.height);e.pivot.x=o.pivot.x,e.pivot.y=o.pivot.y,e.style=o.style,e.rotateAngle=n,e.data=s,e.canMeasurePath=!0,e.width=h.width,e.height=h.height},r.prototype.getSegmentPath=function(e,t,i){for(var r,o,n,s="",h=[],d=0;d<t.length;)h.push({x:t[d].x,y:t[d].y}),d++;for(var l=0;l<e.bridges.length;l++){e.bridges[l].rendered=!1}if(h=this.clipDecorators(e,h,i),this.cornerRadius>0&&"Bezier"!==this.type)for(var c=0;c<h.length-1;c++){r=h[c],0===c&&(s="M"+r.x+" "+r.y);var p=a.distancePoints(h[c],h[c+1]);p>0&&(o=c<h.length-2?p<2*this.cornerRadius?a.adjustPoint(h[c],h[c+1],!1,p/2):a.adjustPoint(h[c],h[c+1],!1,this.cornerRadius):h[c+1],c>0&&(p<2*this.cornerRadius?(n=a.adjustPoint(h[c],h[c+1],!0,p/2),c<h.length-2&&(o=null)):n=a.adjustPoint(h[c],h[c+1],!0,this.cornerRadius)),n&&(s+="Q"+r.x+" "+r.y+" "+n.x+" "+n.y),o&&(e.bridges.length>0&&(s=this.bridgePath(e,s,c),"Orthogonal"===e.type&&(s=this.bridgePath(e,s,c+1))),s+=" L"+o.x+" "+o.y))}else if("Bezier"===this.type){for(var g=void 0,u=this.segments,f=0;f<u.length;f++)h.length>2&&(u[f].bezierPoint1={x:0,y:0},u[f].bezierPoint2={x:0,y:0}),!a.isEmptyPoint(u[f].point1)||u[f].vector1.angle||u[f].vector1.distance?u[f].vector1.angle||u[f].vector1.distance?u[f].bezierPoint1=a.transform(h[f],u[f].vector1.angle,u[f].vector1.distance):u[f].bezierPoint1={x:u[f].point1.x||u[f].bezierPoint1.x,y:u[f].point1.y||u[f].bezierPoint1.y}:((e.sourceID||this.sourcePortID)&&this.sourceWrapper&&(g=lr(this.sourceWrapper.bounds,h[f],!0)),u[f].bezierPoint1=pr(h[f],h[f+1],g)),!a.isEmptyPoint(u[f].point2)||u[f].vector2.angle||u[f].vector2.distance?u[f].vector2.angle||u[f].vector2.distance?u[f].bezierPoint2=a.transform(h[f+1],u[f].vector2.angle,u[f].vector2.distance):u[f].bezierPoint2={x:u[f].point2.x||u[f].bezierPoint2.x,y:u[f].point2.y||u[f].bezierPoint2.y}:((e.targetID||this.targetPortID)&&this.targetWrapper&&(g=lr(this.targetWrapper.bounds,h[f+1],!0)),u[f].bezierPoint2=pr(h[f+1],h[f],g));h.splice(1,0,{x:u[0].bezierPoint1.x,y:u[0].bezierPoint1.y}),h.splice(h.length-1,0,{x:u[u.length-1].bezierPoint2.x,y:u[u.length-1].bezierPoint2.y}),h=this.clipDecorators(e,h,i);for(var m=0;m<u.length;m++){0===m&&(s="M"+h[0].x+" "+h[0].y);var y=m===u.length-1?h[h.length-1].x+" "+h[h.length-1].y:u[m].points[u[m].points.length-1].x+" "+u[m].points[u[m].points.length-1].y;s+="C"+u[m].bezierPoint1.x+" "+u[m].bezierPoint1.y+" "+u[m].bezierPoint2.x+" "+u[m].bezierPoint2.y+" "+y}}else for(var v=0;v<h.length;v++)r=h[v],0===v&&(s="M"+r.x+" "+r.y),v>0&&(s=this.bridgePath(e,s,v),s+=" L"+r.x+" "+r.y);return s},r.prototype.updateShapeElement=function(e){var t;switch(e.shape.type){case"Bpmn":e.wrapper.children[3]instanceof Me&&(t=e.wrapper.children[3]),("Message"===e.shape.flow||sf.base.isBlazor()&&"Message"===e.shape.bpmnFlow)&&this.updateShapePosition(e,t);break;case"UmlActivity":("Exception"===e.shape.flow||sf.base.isBlazor()&&"Exception"===e.shape.umlActivityFlow)&&this.getUMLExceptionFlow(e.wrapper.children[0])}},r.prototype.updateShapePosition=function(e,t){for(var i,r,o=0,n=this.intermediatePoints,s=0;s<n.length-1;s++){var h=.5*(o+=this.distance(n[s],n[s+1]));o>=h&&(i=Tt(n[s],n[s+1]),r=a.transform(n[s],i,h))}t.offsetX=r.x,t.offsetY=r.y},r.prototype.scale=function(e,t,i,r,o){var n=0,a=0;if(this.wrapper&&this.wrapper.outerBounds){var s=Wt(this),h=(this.wrapper.bounds.width||this.style.strokeWidth||1)-2,d=(this.wrapper.bounds.height||this.style.strokeWidth||1)-2;n=s.width-h,a=s.height-d,e=(i-Math.max(n,a))/h,t=(r-Math.max(n,a))/d,n=a=Math.min(n,a)}e=t=Math.min(e,t);var l=x();P(l,-(o=o||this.wrapper).rotateAngle,o.offsetX,o.offsetY),T(l,e,t,o.offsetX,o.offsetY),P(l,o.rotateAngle,o.offsetX,o.offsetY);var c=S(l,this.intermediatePoints);return this.sourcePoint=c[0],this.targetPoint=c[c.length-1],ga(this,c=this.intermediatePoints=at(this)),{x:n,y:a}},r.prototype.getClassName=function(){return"Connector"},Qi([sf.base.ComplexFactory(Ji)],r.prototype,"shape",void 0),Qi([sf.base.Property(e.ConnectorConstraints.Default)],r.prototype,"constraints",void 0),Qi([sf.base.Property(10)],r.prototype,"bridgeSpace",void 0),Qi([sf.base.Collection([],Ze)],r.prototype,"annotations",void 0),Qi([sf.base.Complex({},a)],r.prototype,"sourcePoint",void 0),Qi([sf.base.Complex({},a)],r.prototype,"targetPoint",void 0),Qi([sf.base.Collection([],qi)],r.prototype,"fixedUserHandles",void 0),Qi([sf.base.CollectionFactory($i)],r.prototype,"segments",void 0),Qi([sf.base.Property("")],r.prototype,"sourceID",void 0),Qi([sf.base.Property("")],r.prototype,"targetID",void 0),Qi([sf.base.Property(10)],r.prototype,"hitPadding",void 0),Qi([sf.base.Property(0)],r.prototype,"connectionPadding",void 0),Qi([sf.base.Property("Straight")],r.prototype,"type",void 0),Qi([sf.base.Property(0)],r.prototype,"cornerRadius",void 0),Qi([sf.base.Complex({shape:"None"},er)],r.prototype,"sourceDecorator",void 0),Qi([sf.base.Complex({shape:"Arrow"},er)],r.prototype,"targetDecorator",void 0),Qi([sf.base.Complex({},Ti)],r.prototype,"tooltip",void 0),Qi([sf.base.Property("")],r.prototype,"sourcePortID",void 0),Qi([sf.base.Property("")],r.prototype,"targetPortID",void 0),Qi([sf.base.Property(0)],r.prototype,"sourcePadding",void 0),Qi([sf.base.Complex({},ji)],r.prototype,"previewSize",void 0),Qi([sf.base.Complex({},ji)],r.prototype,"dragSize",void 0),Qi([sf.base.Property(0)],r.prototype,"targetPadding",void 0),Qi([sf.base.Complex({strokeWidth:1,strokeColor:"black"},ge)],r.prototype,"style",void 0),Qi([sf.base.Property(null)],r.prototype,"wrapper",void 0),r}(Vi),xr=(fr=function(e,t){return(fr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}fr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Cr=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Sr=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.offset=0,r.scale=1,r}return xr(t,e),t.prototype.preRender=function(){this.unWireEvents(),this.wireEvents()},t.prototype.render=function(){this.updateRulerGeometry(),this.renderComplete()},t.prototype.getModuleName=function(){return"Ruler"},t.prototype.destroy=function(){this.unWireEvents(),this.notify("destroy",{}),e.prototype.destroy.call(this),this.element.classList.remove("e-ruler")},t.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},t.prototype.onPropertyChanged=function(e,t){for(var i=0,r=Object.keys(e);i<r.length;i++){switch(r[i]){case"length":case"interval":case"segmentWidth":case"tickAlignment":case"markerColor":case"thickness":this.updateRuler()}}},t.prototype.updateRulerGeometry=function(){this.element.style.textAlign="left",this.renderRulerSpace(),this.updateRuler()},t.prototype.renderRulerSpace=function(){var e=this.getRulerGeometry(),t=document.getElementById(this.element.id+"_ruler_space");return t||(t=hh("div",{id:this.element.id+"_ruler_space",style:"height:"+e.height+"px;width:"+e.width+"px;cssFloat:left;"}),this.element.appendChild(t)),t},t.prototype.updateRuler=function(){var e=this.getRulerSize(),t=this.getRulerGeometry(),r=0,o=0,n=new i,a=this.getRulerSVG(t);if(a&&(r=this.length,n.height=e,o=this.offset,r&&r!==1/0)){var s=r+this.segmentWidth,h=o;this.updateSegments(h,s+Math.abs(h),a,e)}},t.prototype.updateSegments=function(e,t,i,r){for(var o=e,n={trans:0};o<t;){var a=this.getNewSegment(o,i);a&&(i.appendChild(a.segment),o=this.updateSegment(e,t,a,o,n,r))}},t.prototype.updateSegment=function(e,t,i,r,o,n){var a=this.updateSegmentWidth(this.scale);r===e?(this.startValue=Math.floor(e/a)*a/this.scale,this.startValue=this.startValue%1!=0?Number(this.startValue.toFixed(1)):this.startValue,i.label.textContent=this.startValue.toString(),this.defStartValue=r=this.startValue*this.scale,"Horizontal"===this.orientation?this.hRulerOffset=e-r:this.vRulerOffset=e-r):(this.startValue=r/this.scale,this.startValue=this.startValue%1!=0?Number(this.startValue.toFixed(1)):this.startValue,i.label.textContent=this.startValue.toString()),this.updateTickLabel(i,n);var s="Horizontal"===this.orientation?o.trans+.5+",0.5":"0.5,"+(o.trans+.5);return i.segment.setAttribute("transform","translate("+s+")"),o.trans+=a,r+=a},t.prototype.updateTickLabel=function(e,t){var i=e.segment.lastChild.getBBox(),r="Horizontal"===this.orientation,o="RightOrBottom"===this.tickAlignment,n=r?2:0,a=r?o?t/2+5.5-5.5:t/2+5.5:i.height,s=o?-(i.width+2)+","+(t/2-i.height):-(i.width+2)+","+(t/2-i.height/2),h=r?{x:n,y:a}:{x:n,y:a,transform:"rotate(270)translate("+s+")"};fh(e.segment.lastChild,h)},t.prototype.getNewSegment=function(e,t){var i=this.createNewTicks(e,t);return{segment:i,label:this.createTickLabel(t,i)}},t.prototype.createNewTicks=function(e,t){for(var i,r,o=this.updateSegmentWidth(this.scale),n=dh("g",{class:"e-ruler-segment"}),a=0;a<this.interval;a++)r=o/this.interval,i=this.createTick(t,r,a+1,e),n.appendChild(i);return n},t.prototype.getLinePoint=function(e,t,i){var r=this.updateSegmentWidth(this.scale),o=this.getRulerSize();return i=(t*=i-1)%r==0?o:.3*o},t.prototype.createTick=function(e,t,i,r){var o=this.getLinePoint(e,t,i),n=this.getRulerSize(),a="Horizontal"===this.orientation,s="RightOrBottom"===this.tickAlignment,h=Wh(this.arrangeTick),d={ruler:void 0,tickLength:o,tickInterval:this.segmentWidth/this.interval*(i-1)};h&&h(d),o=d.tickLength;var l=t*(i-1),c=dh("line",{x1:a?l:s?n:0,y1:a?s?n:n-(n-o):l,x2:a?l:s?n-o:n-(n-o),y2:a?s?n-o:0:l,"stroke-width":"1",stroke:"black"});return c.setAttribute("class","e-ruler-tick"),c},t.prototype.createTickLabel=function(e,t){var i;if(t){i=dh("text",{class:"e-ruler-tick-label"}),t.appendChild(i)}return i},t.prototype.updateSegmentWidth=function(e){if(100!==this.segmentWidth)return this.segmentWidth;var t,i=1;for(t=100,t=100/Math.pow(2,Math.round(Math.log(e)/Math.log(2)));t>100;)i/=10,t/=10;for(;t<25;)i*=10,t*=10;return t>=25&&t%25!=0&&(t=25*Math.round(t/25)),t*e/i},t.prototype.createMarkerLine=function(e,t,i){var r;return t&&((r=e.getElementById(t.id+"_marker"))&&r.parentNode.removeChild(r),r=dh("line",i)),r},t.prototype.drawRulerMarker=function(e,t,i){var r,o,n,a,s,h,d,l="Horizontal"===this.orientation,c=e.getElementsByTagName("svg");for(s=0;s<c.length;s++){c[s]&&(r=c[s]);break}if(r){o=this.getRulerSize(),h={id:e.id+"_marker",x1:0,y1:0,x2:l?0:o,y2:l?o:0,stroke:this.markerColor,"stroke-width":1.5,class:"e-d-ruler-marker"},d=this.createMarkerLine(r,e,h),n=this.scale,a=this.offset-this.defStartValue;var p=(l?t.x:t.y)*n+i+a;d.setAttribute("transform","translate("+(l?p+.5+" 0.5":"0.5 "+(p+.5))+")"),r.appendChild(d)}},t.prototype.getRulerGeometry=function(){return new i(this.element?this.element.getBoundingClientRect().width:0,this.element?this.element.getBoundingClientRect().height:0)},t.prototype.getRulerSize=function(){return this.thickness},t.prototype.getRulerSVG=function(e){var t,i,r=this.getRulerSize();if(this.element&&(t=document.getElementById(this.element.id+"_ruler_space"))){if(i=dh("svg",{id:this.element.id+"_Ruler_svg",width:"Horizontal"===this.orientation?e.width+200:r+"px",height:"Horizontal"===this.orientation?r:e.height+200+"px",style:"position:inherit;"}),t.childNodes.length>0)for(var o=t.childNodes.length-1;o>=0;o--)t.childNodes[o].parentNode.removeChild(t.childNodes[o]);t.appendChild(i)}return i},t.prototype.wireEvents=function(){},t.prototype.unWireEvents=function(){},Cr([sf.base.Property(5)],t.prototype,"interval",void 0),Cr([sf.base.Property(100)],t.prototype,"segmentWidth",void 0),Cr([sf.base.Property("Horizontal")],t.prototype,"orientation",void 0),Cr([sf.base.Property("RightOrBottom")],t.prototype,"tickAlignment",void 0),Cr([sf.base.Property("red")],t.prototype,"markerColor",void 0),Cr([sf.base.Property(25)],t.prototype,"thickness",void 0),Cr([sf.base.Property(null)],t.prototype,"arrangeTick",void 0),Cr([sf.base.Property(400)],t.prototype,"length",void 0),t}(sf.base.Component);function Pr(e,t){var i=document.getElementById(e.element.id+(t?"_hRuler":"_vRuler")),r=zr(e),o=Or(e),n=t?"margin-left:"+r.width+"px;":"margin-top:"+r.height+"px;";if(!i){var a="height:"+(t?r.height:o.height+100)+"px;overflow:hidden;width:"+(t?o.width+100:r.width)+"px;position:absolute;font-size:11px;"+n;i=hh("div",{id:e.element.id+(t?"_hRuler":"_vRuler"),style:a})}e.element.insertBefore(i,e.element.firstChild);var s=t?e.rulerSettings.horizontalRuler:e.rulerSettings.verticalRuler,h=new Sr(s);h.orientation=t?"Horizontal":"Vertical",h.length=(t?o.width:o.height)+s.segmentWidth,h.appendTo("#"+e.element.id+(t?"_hRuler":"_vRuler")),t?e.hRuler=h:e.vRuler=h;var d=document.getElementById(e.element.id+(t?"_hRuler":"_vRuler"));t?e.hRuler.element=d:e.vRuler.element=d}function Tr(e){var t=-e.scroller.horizontalOffset,i=-e.scroller.verticalOffset;e&&e.rulerSettings.showRulers?(e.hRuler.length=0,e.vRuler.length=0,void 0!==t&&e.hRuler.element&&Ir(e,e.hRuler,t,!0),void 0!==i&&e.vRuler.element&&Ir(e,e.vRuler,i,!1)):Ar(e)}function Ar(e){gh(e.element.id+"_hRuler"),gh(e.element.id+"_vRuler"),gh(e.element.id+"_overlapRuler")}function zr(e){var t=0,r=0;return e.rulerSettings.showRulers&&(t=e.rulerSettings.horizontalRuler.thickness,r=e.rulerSettings.verticalRuler.thickness),new i(r,t)}function Or(e){var t=zr(e),r=e.scroller.viewPortHeight,o=e.scroller.viewPortWidth;return o<e.element.clientWidth-t.width&&(o=e.element.clientWidth-t.width),r<e.element.clientHeight-t.height&&(r=e.element.clientHeight-t.height),e.hRuler&&e.hRuler.length&&(o=e.hRuler.length),e.vRuler&&e.vRuler.length&&(r=e.vRuler.length),new i(o,r)}function Ir(e,t,i,r){var o=zr(e),n=Or(e),a=r?e.rulerSettings.horizontalRuler:e.rulerSettings.verticalRuler;!function(e,t,i){var r=document.getElementById(e.element.id+(i?"_hRuler":"_vRuler")),o=i?e.hRuler:e.vRuler;r&&e&&t&&(r.style.width=(i?t.width+o.segmentWidth:o.thickness)+"px",r.style.height=(i?o.thickness:t.height+o.segmentWidth)+"px",(r=document.getElementById(e.element.id+"_overlapRuler"))&&(i?r.style.height=o.thickness+"px":r.style.width=o.thickness+"px"))}(e,n,r),function(e,t,i){var r=document.getElementById(e.element.id+(i?"_hRuler_ruler_space":"_vRuler_ruler_space")),o=i?e.hRuler:e.vRuler;r&&e&&t&&(r.style.width=(i?t.width+2*o.segmentWidth:o.thickness)+"px",r.style.height=(i?o.thickness:t.height+2*o.segmentWidth)+"px")}(e,n,r),t.offset=i,t.scale=e.scroller.currentZoom,t.length=(r?n.width:n.height)+100,t.arrangeTick=Wh(a.arrangeTick),t.dataBind();var s=r?e.hRuler.element:e.vRuler.element;r?s.style.marginLeft=o.width-t.hRulerOffset+"px":s.style.marginTop=o.height-t.vRulerOffset+"px"}function Dr(t){if(t){return t instanceof Fe||t instanceof Ze?t.constraints&e.AnnotationConstraints.Select:t instanceof wr?t.constraints&e.ConnectorConstraints.Select:t.constraints&e.NodeConstraints.Select}return 1}function Er(t){if(t){return t instanceof Fe||t instanceof Ze?t.constraints&e.AnnotationConstraints.Drag:t instanceof wr?t.constraints&e.ConnectorConstraints.Drag:t instanceof Ys?1:t.constraints&e.NodeConstraints.Drag}return 1}function Br(t){return t instanceof wr?t.constraints&e.ConnectorConstraints.Delete:t.constraints&e.NodeConstraints.Delete}function Lr(t){return t.constraints&e.ConnectorConstraints.DragSourceEnd}function Mr(t){return t.constraints&e.ConnectorConstraints.DragTargetEnd}function kr(t){return t.constraints&e.ConnectorConstraints.DragSegmentThumb}function Rr(t){return t instanceof Fe||t instanceof Ze?t.constraints&e.AnnotationConstraints.Rotate:t.constraints&e.NodeConstraints.Rotate}function Nr(t){return t.constraints&e.NodeConstraints.Shadow}function jr(t){return t instanceof js&&t.constraints&e.NodeConstraints.InConnect?t.constraints&e.NodeConstraints.InConnect:0}function Hr(t){return t&&t.constraints&&!(t.constraints&e.PortConstraints.None)&&t.constraints&e.PortConstraints.InConnect?t.constraints&e.PortConstraints.InConnect:0}function Wr(t){return t instanceof js&&t.constraints&e.NodeConstraints.OutConnect?t.constraints&e.NodeConstraints.OutConnect:0}function _r(t){return t&&t.constraints&&!(t.constraints&e.PortConstraints.None)&&t.constraints&e.PortConstraints.OutConnect?t.constraints&e.PortConstraints.OutConnect:0}function Vr(t,i){var r=0;return t instanceof Fe||t instanceof Ze?r=t.constraints&e.AnnotationConstraints.Resize:t&&("SouthEast"===i?r=t.constraints&e.NodeConstraints.ResizeSouthEast:"East"===i?r=t.constraints&e.NodeConstraints.ResizeEast:"NorthEast"===i?r=t.constraints&e.NodeConstraints.ResizeNorthEast:"South"===i?r=t.constraints&e.NodeConstraints.ResizeSouth:"North"===i?r=t.constraints&e.NodeConstraints.ResizeNorth:"SouthWest"===i?r=t.constraints&e.NodeConstraints.ResizeSouthWest:"West"===i?r=t.constraints&e.NodeConstraints.ResizeWest:"NorthWest"===i&&(r=t.constraints&e.NodeConstraints.ResizeNorthWest)),r}function Xr(t){return t instanceof wr?t.constraints&e.ConnectorConstraints.AllowDrop:t.constraints&e.NodeConstraints.AllowDrop}function Yr(t){return t.constraints&e.DiagramConstraints.Virtualization}function Ur(t){return t.tool&e.DiagramTools.SingleSelect}function Gr(t){return t.tool&e.DiagramTools.MultipleSelect}function Fr(t){return t.tool&e.DiagramTools.ZoomPan}function Zr(t){return t.tool&e.DiagramTools.ContinuousDraw}function qr(t){return t.tool&e.DiagramTools.DrawOnce}function Kr(t){return t.tool&e.DiagramTools.SingleSelect||t.tool&e.DiagramTools.MultipleSelect}function Qr(t){return t.constraints&e.DiagramConstraints.UserInteraction}function Jr(t){return t.constraints&e.DiagramConstraints.ZoomTextEdit}function $r(t){return function(t){return t.constraints&e.DiagramConstraints.ApiUpdate}(t)||t.diagramActions&e.DiagramAction.ToolAction}function eo(t,i){return t.constraints&e.PortConstraints.Draw}function to(t,i){return t.constraints&e.PortConstraints.Drag}function io(t){return!(t&e.RendererAction.DrawSelectorBorder)}function ro(t){return!!(t&e.RendererAction.PreventRenderSelector)}var oo,no=(oo=function(e,t){return(oo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}oo(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ao=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},so=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return no(t,e),t.prototype.getClassName=function(){return"UserHandle"},ao([sf.base.Property("")],t.prototype,"name",void 0),ao([sf.base.Property("")],t.prototype,"pathData",void 0),ao([sf.base.Property("")],t.prototype,"content",void 0),ao([sf.base.Property("")],t.prototype,"source",void 0),ao([sf.base.Property("#000000")],t.prototype,"backgroundColor",void 0),ao([sf.base.Property("Top")],t.prototype,"side",void 0),ao([sf.base.Property("")],t.prototype,"borderColor",void 0),ao([sf.base.Property(.5)],t.prototype,"borderWidth",void 0),ao([sf.base.Property(25)],t.prototype,"size",void 0),ao([sf.base.Property("white")],t.prototype,"pathColor",void 0),ao([sf.base.Property(10)],t.prototype,"displacement",void 0),ao([sf.base.Property(!0)],t.prototype,"visible",void 0),ao([sf.base.Property(0)],t.prototype,"offset",void 0),ao([sf.base.Complex({},ne)],t.prototype,"margin",void 0),ao([sf.base.Property("Center")],t.prototype,"horizontalAlignment",void 0),ao([sf.base.Property("Center")],t.prototype,"verticalAlignment",void 0),ao([sf.base.Property(!1)],t.prototype,"disableNodes",void 0),ao([sf.base.Property(!1)],t.prototype,"disableConnectors",void 0),ao([sf.base.Property("")],t.prototype,"template",void 0),t}(sf.base.ChildProperty);function ho(e){return po[e.toString()]}var lo,co,po={Action:"M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z",Decision:"M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z",MergeNode:"M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z",InitialNode:"M10,19.5c-5.238,0-9.5-4.262-9.5-9.5S4.762,0.5,10,0.5s9.5,4.262,9.5,9.5S15.238,19.5,10,19.5z",ForkNode:"m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",JoinNode:"m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",TimeEvent:"M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z",AcceptingEvent:"M17.8336 32.164 L29.64 24 L17.32 16 L48.1664 16 L48.5 32 Z",SendSignal:"M48.164 31.8336 L56 23.832 L47.836 16 L16.168 16 L16.1668 31.8336 Z",ReceiveSignal:"M48.1664 31.8336 L39.836 24 L47.836 16 L16.168 16 L16.168 31.836 Z",StructuredNode:"M0,0 L50,0 L50,50 L0,50 z",Note:"M20 12 L4 12 L4 22 L22 22 L22 14 L20 14 L20 12 L22 14 Z"},go=(lo=function(e,t){return(lo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}lo(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),uo=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return go(t,e),uo([sf.base.Property()],t.prototype,"key",void 0),uo([sf.base.Property()],t.prototype,"keyModifiers",void 0),t}(sf.base.ChildProperty),mo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return go(t,e),t.prototype.getClassName=function(){return"Command"},uo([sf.base.Property("")],t.prototype,"name",void 0),uo([sf.base.Property()],t.prototype,"canExecute",void 0),uo([sf.base.Property()],t.prototype,"execute",void 0),uo([sf.base.Complex({},fo)],t.prototype,"gesture",void 0),uo([sf.base.Property("")],t.prototype,"parameter",void 0),t}(sf.base.ChildProperty),yo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return go(t,e),uo([sf.base.Collection([],mo)],t.prototype,"commands",void 0),t}(sf.base.ChildProperty),vo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return go(t,e),uo([sf.base.Property()],t.prototype,"show",void 0),uo([sf.base.Property()],t.prototype,"showCustomMenuOnly",void 0),uo([sf.base.Property()],t.prototype,"items",void 0),t}(sf.base.ChildProperty),bo=(co=function(e,t){return(co=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}co(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),wo=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.childTable=[],t.cellStyle={},t.desiredRowHeight=[],t.desiredCellWidth=[],t}return bo(t,e),t.prototype.rowDefinitions=function(){return this.rowDefns},t.prototype.columnDefinitions=function(){return this.colDefns},t.prototype.addObject=function(e,t,i,r,o){if(this.rows.length>=t){var n=this.rows[t];if(n.cells.length>i){o=o||1,r=r||1;var a=n.cells[i];a.columnSpan=Math.max(o,a.columnSpan),a.rowSpan=Math.max(r,a.rowSpan);var s=new To;(s=e).rowId=t,s.columnId=i,s.columnSpan=o,this.childTable[s.id]=s,this.addObjectToCell(s,a)}}},t.prototype.addObjectToCell=function(e,t){t.children||(t.children=[]),e.style.strokeColor="black",e.style.strokeWidth=1,e.style.fill="white",t.children.push(e)},t.prototype.updateProperties=function(e,t,i,r){this.offsetX=e,this.offsetY=t,this.width=i,this.height=r},t.prototype.setDefinitions=function(e,t){this.rowDefns=e,this.colDefns=t,this.children=[],this.rows=this.rows||[];for(var i=0;i<e.length;i++){var r=e[i],o=new So;o.cells=[];var n=new Co;n.width=this.width;var a=this.colDefns;(void 0===a||a.length<1)&&(a=[n]),this.addCellInRow(a,r,o),this.rows.push(o)}},t.prototype.addCellInRow=function(e,t,i){for(var r=0;r<e.length;r++){var o=e[r],n=new Po;n.children=[],this.cellStyle.fill="none",this.cellStyle.strokeColor="none",n.id=xh(),n.style=this.cellStyle,n.desiredCellWidth=n.minWidth=o.width,n.desiredCellHeight=n.minHeight=t.height,i.cells.push(n),this.children.push(n)}},t.prototype.calculateSize=function(){for(var e=this.rows||[],t=0,i=0,r=0;r<e.length;r++){var o=this.rows[r];i=0;for(var n=0;n<o.cells.length;n++)if(i+=o.cells[n].desiredCellWidth,n===o.cells.length-1&&(this.width&&this.width!==i&&(o.cells[n].desiredCellWidth+=this.width-i,o.cells[n].minWidth=o.cells[n].desiredCellWidth,o.cells[n].children&&o.cells[n].children.length&&(o.cells[n].children[0].width=o.cells[n].desiredCellWidth),this.colDefns[n].width=o.cells[n].desiredCellWidth),t+=o.cells[n].desiredCellHeight,r===e.length-1&&this.height&&this.height!==t)){var a=this.height-t;if(a>0){for(var s=0;s<o.cells.length;s++)o.cells[s].desiredCellHeight+=a,o.cells[s].minHeight=o.cells[s].desiredCellHeight=o.cells[s].desiredCellHeight,o.cells[s].children&&o.cells[s].children.length&&(o.cells[s].children[0].height=o.cells[s].desiredCellHeight);this.rowDefns[r].height+=a}}}},t.prototype.updateRowHeight=function(e,t,r,o){var n=this.rows[e];this.rowDefns[e].height=t,void 0!==this.height&&(this.height+=t-n.cells[0].desiredCellHeight);for(var a=0;a<n.cells.length;a++)n.cells[a].desiredCellHeight=n.cells[a].minHeight=t,n.cells[a].children&&n.cells[a].children.length&&(n.cells[a].children[0].height=t,this.setTextRefresh(n.cells[a].children[0]));if(this.desiredRowHeight[e]=t,this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize),r){var s=void 0!==o?this.calculateCellHeightBasedOnChildren(e,o):this.calculateCellHeight(e);s>t&&this.updateRowHeight(e,s,!1)}},t.prototype.setTextRefresh=function(e){if(e.children&&e.children.length)for(var t=e.children,i=0;i<t.length;i++)t[i]instanceof Se&&t[i].refreshTextElement(),t[i]instanceof Te&&this.setTextRefresh(t[i])},t.prototype.updateColumnWidth=function(e,t,r,o){this.colDefns[e].width=t,void 0!==this.width&&(this.width+=t-this.rows[this.rows.length-1].cells[e].desiredCellWidth);for(var n=0;n<this.rows.length;n++)this.setTextRefresh(this.rows[n].cells[0]),this.rows[n].cells[e].desiredCellWidth=this.rows[n].cells[e].minWidth=t,this.rows[n].cells[e].children&&this.rows[n].cells[e].children.length&&(this.rows[n].cells[e].children[0].width=t);if(this.desiredCellWidth[e]=t,this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize),r){var a=void 0!==o?this.calculateCellWidthBasedOnChildren(e,o):this.calculateCellWidth(e);a>t&&this.updateColumnWidth(e,a,!1)}},t.prototype.calculateCellWidth=function(e){for(var t,i,r,o=0;o<this.rows.length;o++)1===(r=this.rows[o].cells[e]).columnSpan&&(i=r.outerBounds.width>r.bounds.width&&(0===r.children.length||void 0===r.children[0].maxWidth)?r.outerBounds.width:r.bounds.width,t=t?t<i?i:t:i);return t},t.prototype.calculateCellHeight=function(e){for(var t,i,r,o=this.rows[e],n=0;n<o.cells.length;n++)i=(r=o.cells[n]).outerBounds.height>r.bounds.height?r.outerBounds.height:r.bounds.height,t=t?t<i?i:t:i;return t},t.prototype.calculateCellSizeBasedOnChildren=function(e,t,i,r){var o,n=e&&e.children.length>0?e.children[0]:void 0;if(n&&1===e.columnSpan){o="Width"===t?n.bounds.right:n.bounds.bottom,r||(r="Width"===t?n.bounds.width:n.bounds.height);for(var a=0;a<n.children.length;a++){var s=n.children[a];if(s instanceof Te&&-1===s.id.indexOf("header")){var h=("Width"===t?s.bounds.right:s.bounds.bottom)+i;if(h>o){var d=h-o+("Width"===t?n.bounds.width:n.bounds.height);r&&(r=r<d?d:r)}}}}return r},t.prototype.calculateCellWidthBasedOnChildren=function(e,t){for(var i,r,o=0;o<this.rows.length;o++)r=this.rows[o].cells[e],i=this.calculateCellSizeBasedOnChildren(r,"Width",t,i);return i},t.prototype.calculateCellHeightBasedOnChildren=function(e,t){for(var i,r,o=this.rows[e],n=0;n<o.cells.length;n++)r=o.cells[n],i=this.calculateCellSizeBasedOnChildren(r,"Height",t,i);return i},t.prototype.addRow=function(e,t,r){this.rowDefns.length>0?this.rowDefns.splice(e,0,t):this.rowDefns.push(t);var o=new So;o.cells=[],(new Co).width=this.width;var n=this.colDefns;this.addCellInRow(n,t,o),e>this.rows.length-1?this.rows.push(o):this.rows.splice(e,0,o),r&&(this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize))},t.prototype.addColumn=function(e,t,r){var o,n,a,s,h=this.rows;this.colDefns.length>0?this.colDefns.splice(e,0,t):this.colDefns.push(t),void 0!==this.width&&(this.width+=t.width);for(var d=0;d<h.length;d++)o=h[d],n=this.rowDefns[d],a=t,(s=new Po).style=this.cellStyle,s.desiredCellWidth=s.minWidth=a.width,s.desiredCellHeight=s.minHeight=n.height,s.children=[],e>o.cells.length-1?o.cells.push(s):o.cells.splice(e,0,s),this.children.push(s);r&&(this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize))},t.prototype.removeRow=function(e){var t,r,o=this.rows[e];this.height-=this.rowDefns[e].height;for(var n=0;n<o.cells.length;n++)t=o.cells[n],this.children.splice(this.children.indexOf(t),1),(r=document.getElementById(t.id+"_groupElement"))&&r.parentElement&&r.parentElement.removeChild(r);this.rows.splice(e,1),this.rowDefns.splice(e,1),this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize)},t.prototype.removeColumn=function(e){var t,r,o=this.rows;this.width-=this.colDefns[e].width;for(var n=0;n<o.length;n++)t=o[n].cells[e],this.children.splice(this.children.indexOf(t),1),(r=document.getElementById(t.id+"_groupElement"))&&r.parentElement&&r.parentElement.removeChild(r),o[n].cells.splice(e,1);this.colDefns.splice(e,1),this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize)},t.prototype.updateRowIndex=function(e,t){var r=this.rows[e];this.rows.splice(e,1),this.rows.splice(t,0,r);var o=this.rowDefns[e];this.rowDefns.splice(e,1),this.rowDefns.splice(t,0,o),this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize)},t.prototype.updateColumnIndex=function(e,t,r){for(var o,n,a=e;a<this.rows.length;a++)o=this.rows[a],n=this.rows[a].cells[t],o.cells.splice(t,1),o.cells.splice(r,0,n);var s=this.colDefns[t];this.colDefns.splice(t,1),this.colDefns.splice(r,0,s);var h=this.desiredCellWidth[t];this.desiredCellWidth.splice(t,1),this.desiredCellWidth.splice(r,0,h),this.measure(new i(this.width,this.height)),this.arrange(this.desiredSize)},t.prototype.measure=function(t){var r=void 0;if(void 0!==this.rows&&this.rows.length>0){var o=0,n=0;r=new i(0,0),this.calculateSize();for(var a=0,s=this.rows;a<s.length;a++){n=0;for(var h=0,d=(u=s[a]).cells;h<d.length;h++){var l=(v=d[h]).measure(new i(v.desiredCellWidth,v.desiredCellHeight));1===v.rowSpan&&(0===n||void 0===this.desiredRowHeight[o]?this.desiredRowHeight[o]=l.height:this.desiredRowHeight[o]=Math.max(l.height,this.desiredRowHeight[o])),1===v.columnSpan&&(0===o||void 0===this.desiredCellWidth[n]?this.desiredCellWidth[n]=l.width:this.desiredCellWidth[n]=Math.max(l.width,this.desiredCellWidth[n]),o===this.rows.length-1&&(r.width+=this.desiredCellWidth[n])),n++}r.height+=this.desiredRowHeight[o],o++}o=n=0;for(var c=0,p=0,g=this.rows;p<g.length;p++){var u;n=0;for(var f=0,m=0,y=(u=g[p]).cells;m<y.length;m++){var v;if(1!==(v=y[m]).columnSpan){v.desiredSize.width=0;for(var b=0;b<v.columnSpan;b++)b+n<u.cells.length&&(v.desiredSize.width+=this.desiredCellWidth[b+n],v.minWidth=v.desiredSize.width,v.measure(v.desiredSize));n++}else v.desiredSize.width=this.desiredCellWidth[f],v.measure(v.desiredSize);if(1!==v.rowSpan){v.desiredSize.height=0;for(b=0;b<v.rowSpan;b++)b+c<this.rows.length&&(v.desiredSize.height+=this.desiredRowHeight[b+c],v.minHeight=v.desiredSize.height,v.measure(v.desiredSize))}else v.desiredSize.height=this.desiredRowHeight[c],v.measure(v.desiredSize);o++,f++}c++}}return void 0===r&&(r=e.prototype.validateDesiredSize.call(this,r,t)),e.prototype.stretchChildren.call(this,r),this.desiredSize=r,r},t.prototype.arrange=function(e,t){var r=0,o=0;if(void 0!==this.rows&&this.rows.length>0){for(var n=this.offsetX-e.width*this.pivot.x,a=this.offsetY-e.height*this.pivot.y,s=n,h=0,d=this.rows;h<d.length;h++){s=n,r=0;for(var l=0,c=(f=d[h]).cells;l<c.length;l++){var p=c[l],g=Math.max(this.desiredCellWidth[r],p.desiredSize.width),u=Math.max(this.desiredRowHeight[o],p.desiredSize.height);p.offsetX=s+g*p.pivot.x,p.offsetY=a+u*p.pivot.y,s+=this.desiredCellWidth[r],p.arrange(new i(g,u)),r++}a+=this.desiredRowHeight[o],o++}if(t){p=void 0;var f=void 0,m=void 0,y=void 0,v=void 0;for(o=0;o<this.rows.length;o++)for(f=this.rows[o],r=0;r<f.cells.length;r++)if((p=f.cells[r]).columnSpan>1&&this.children.splice(this.children.indexOf(p)+1,p.columnSpan-1),p.rowSpan>1)for(m=o,y=0;m+p.rowSpan-1<this.rows.length&&y<p.rowSpan-1;m++,y++)v=this.rows[m+1].cells[r],this.children.splice(this.children.indexOf(v),1)}}return this.actualSize=e,this.updateBounds(),e},t}(xe),xo=function(){this.height=void 0},Co=function(){this.width=void 0},So=function(){this.cells=null},Po=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.columnSpan=1,t.rowSpan=1,t}return bo(t,e),t}(Te),To=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rowId=0,t.columnId=0,t.rowSpan=1,t.columnSpan=1,t}return bo(t,e),t}(be);function Ao(e,t,i,r){var o,n=!1;if(Eo(e,t,!0)){e.protectPropertyChange(!0);var a=(o=e.nameTable[t.parentId]).wrapper;if(o&&"Canvas"===o.container.type){if(r||a.bounds.x<=i.x&&a.bounds.right>=i.x&&a.bounds.y<=i.y&&a.bounds.bottom>=i.y){var s=void 0,h=a.bounds.y,d=a.bounds.x,l=e.nameTable[o.parentId]||o;if("SwimLane"===l.shape.type)n=Ro(o,l,t,e,!0);else{var c=e.nameTable[o.parentId]||o,p=c.shape;s=c.wrapper,a.actualSize.width<a.outerBounds.width&&!(a.bounds.x>a.outerBounds.x)&&(void 0!==o.rowIndex?(s.updateColumnWidth(o.columnIndex,a.outerBounds.width,!0),"Horizontal"===p.orientation&&p.phaseSize&&on(c,e,a,o.columnIndex),nn(e,c),e.drag(c,d-a.bounds.x,h-a.bounds.y)):e.scale(o,1+(a.outerBounds.width-a.actualSize.width)/a.actualSize.width,1,a.outerBounds.x<a.bounds.x?{x:1,y:.5}:{x:0,y:.5})),a.actualSize.height<a.outerBounds.height&&!(a.bounds.y>a.outerBounds.y)&&(void 0!==o.rowIndex?(s.updateRowHeight(o.rowIndex,a.outerBounds.height,!0),e.drag(c,d-a.bounds.x,h-a.bounds.y)):e.scale(o,1,1+(a.outerBounds.height-a.actualSize.height)/a.actualSize.height,a.outerBounds.y<a.bounds.y?{x:.5,y:1}:{x:.5,y:0}))}}e.select([t]),Jo([],e)}e.protectPropertyChange(!1)}return n}function zo(t,i,r,o){var n;if(Eo(t,i,!0)){var a=t.isProtectedOnChange;t.protectPropertyChange(!0);var s=(n=t.nameTable[i.parentId]).wrapper;if(n&&"Canvas"===n.container.type&&!(o||s.bounds.x<=r.x&&s.bounds.right>=r.x&&s.bounds.y<=r.y&&s.bounds.bottom>=r.y||i.constraints&e.NodeConstraints.AllowMovingOutsideLane)){var h=Ah(i);t.clearSelection(),Lo(t,i),i.parentId="";var d={type:"ChildCollectionChanged",category:"Internal",undoObject:h,redoObject:Ah(i)};t.addHistoryEntry(d),t.commandHandler.isContainer&&(t.commandHandler.isContainer=!1,t.endGroupAction()),ko(i,t)}t.protectPropertyChange(a)}}function Oo(e,t,i){for(var r=new b,o="SwimLane"===e.shape.type?e.wrapper.children[0].rows:e.wrapper.rows,n=i?1:0;n<o.length;n++)r.uniteRect(o[n].cells[t].bounds);return r}function Io(e,t){for(var i,r={},o=0,n=Object.keys(t);o<n.length;o++){var a=n[o];r[a]=t[a]}return Ea(t)===js&&((i=new js(e,"nodes",r,!0)).id=t.id,e.initObject(i)),e.updateDiagramObject(i),i}function Do(t,i){var r,o,n;if(t.enableServerDataBinding(!1),!sf.base.isBlazor()||sf.base.isBlazor()&&t.diagramActions&e.DiagramAction.ToolAction)if(t.selectedObject.helperObject)n=t.selectedObject.helperObject;else if(t.selectedItems.nodes.length>0||t.selectedItems.connectors.length>0){if(i instanceof Ys&&i.nodes.length+i.connectors.length===1?(r=i.nodes.length>0?i.nodes[0]:i.connectors[0],o=t.selectedItems.wrapper.children[0]):(r=i,o=sf.base.isBlazor()?i===t.selectedItems.nodes[0]?t.selectedItems.wrapper:i.wrapper:t.selectedItems.wrapper),t.selectedObject.actualObject=r,!t.currentSymbol&&(r.isLane&&wn(r,t)&&Eo(t,r)||!r.isLane&&Eo(t,r)||t.constraints&e.DiagramConstraints.LineRouting&&t.selectedItems.nodes.length>0))n=Io(t,{id:"helper",rotateAngle:o.rotateAngle,offsetX:o.offsetX,offsetY:o.offsetY,minWidth:o.minWidth,minHeight:o.minHeight,maxWidth:o.maxWidth,maxHeight:o.maxHeight,width:o.actualSize.width,height:o.actualSize.height,style:{strokeDashArray:"2 2",fill:"transparent",strokeColor:"#7D7D7D",strokeWidth:2}}),t.selectedObject.helperObject=n}return t.enableServerDataBinding(!0),n}function Eo(e,t,i){var r=i?e.nameTable[t.parentId]:e.nameTable[t.parentId]||t;return!(!r||!r.container)}function Bo(e,t){var r=e.nameTable[t.parentId];"Canvas"===r.container.type&&(t.margin.left=t.offsetX-r.wrapper.bounds.x-t.width/2,t.margin.top=t.offsetY-r.wrapper.bounds.y-t.height/2),e.nodePropertyChange(t,{},{width:t.width,height:t.height,offsetX:t.offsetX,offsetY:t.offsetY,margin:{left:t.margin.left,right:t.margin.right,top:t.margin.top,bottom:t.margin.bottom},rotateAngle:t.rotateAngle}),r.isLane||(r.wrapper.measure(new i),r.wrapper.arrange(r.wrapper.desiredSize))}function Lo(e,t){if(t.parentId&&""!==t.parentId){var i=e.nameTable[t.parentId];if(i.isLane&&i.parentId)for(var r=e.nameTable[i.parentId],o=i.id.slice(r.id.length),n=o.substring(0,o.length-1),a=r.shape.lanes,s=void 0,h=0;h<a.length;h++)if(n===(s=a[h]).id)for(var d=0;d<s.children.length;d++)s.children[d].id===t.id&&(s.children.splice(d,1),d--);e.deleteChild(t)}}function Mo(t,i,r,o,n){if(!t.currentSymbol){t.protectPropertyChange(!0);var a=t.nameTable[i.parentId];r=t.getObject(r.id)||r;var s=-1!==t.nodes.indexOf(r)?r.id:r;if("Canvas"!==i.container.type||n){if(a){var h=a.wrapper.bounds,d=i.wrapper.bounds;if("Horizontal"===a.shape.orientation)r.margin.left-=d.x-h.x;else{var l=i.parentId+a.shape.lanes[0].id+"_0_header";r.margin.top-=d.y-h.y-t.nameTable[l].wrapper.bounds.height}}}else{var c=r.wrapper.offsetX-r.wrapper.actualSize.width/2-(i.wrapper.offsetX-i.wrapper.actualSize.width/2),p=r.wrapper.offsetY-r.wrapper.actualSize.height/2-(i.wrapper.offsetY-i.wrapper.actualSize.height/2);r.margin.left=c,r.margin.top=p}var g=t.nameTable[i.id];if(g.children||(g.children=[]),-1===g.children.indexOf(r.id)){Lo(t,r),t.getObject(r.id)&&t.removeElements(r);var u=Ah(r);if(t.addChild(g,s),r=t.getObject(r.id),g.isLane&&g.parentId)for(var f=(a=t.nameTable[g.parentId]).shape.lanes,m=g.id.slice(a.id.length),y=m.substring(0,m.length-1),v=0;v<f.length;v++)g.isLane&&y===f[v].id&&(r.parentObj instanceof El||(r.parentObj=f[v]),f[v].children.push(r));if(t.updateDiagramObject(r),ko(r,t),g.parentId?o||Ro(g,a,r,t):t.updateDiagramObject(g),!(t.diagramActions&e.DiagramAction.UndoRedo)){var b={type:"ChildCollectionChanged",category:"Internal",undoObject:u,redoObject:Ah(r),historyAction:n?"AddNodeToLane":void 0};t.addHistoryEntry(b)}}t.protectPropertyChange(!1)}}function ko(e,t){var i=Ks(e.id+"_groupElement",t.element.id),r=Ks(e.parentId?e.parentId+"_groupElement":t.element.id+"_diagramLayer",t.element.id);i&&r&&r.appendChild(i)}function Ro(t,r,o,n,a){var s,h=Ah(t),d=!1,l=r.shape.padding,c=t.wrapper.bounds,p=t.wrapper.outerBounds,g=o.wrapper.bounds;if(r&&"SwimLane"===r.shape.type&&(c.right<g.right+l||c.bottom<g.bottom+l)){var u=r.wrapper.children[0],f=u.bounds.x,m=u.bounds.y,y=void 0;if(c.right<g.right+l&&p.x<=c.x&&(y=g.right-c.right,s=!1,u.updateColumnWidth(t.columnIndex,c.width+y,!0,l)),c.bottom<g.bottom+l&&p.y<=c.y&&(y=g.bottom-c.bottom,s=!0,u.updateRowHeight(t.rowIndex,c.height+y,!0,l)),!(n.diagramActions&e.DiagramAction.UndoRedo)&&(a&&(n.startGroupAction(),d=!0),void 0!==s)){var v={category:"Internal",type:s?"RowHeightChanged":"ColumnWidthChanged",undoObject:h,redoObject:Ah(t)};n.addHistoryEntry(v)}r.width=r.wrapper.width=u.width,r.height=r.wrapper.height=u.height,Go(r),"Horizontal"===r.shape.orientation&&on(r,n,t.wrapper,t.columnIndex),nn(n,r),n.drag(r,f-u.bounds.x,m-u.bounds.y),Qo(r,n),Ko(r)}return function(e,t,r){var o=e.nameTable[t.parentId];if(o&&o.isLane){var n=e.nameTable[o.parentId],a=n.wrapper.children[0];a.updateColumnWidth(o.columnIndex,a.columnDefinitions()[o.columnIndex].width,!0,r),a.updateRowHeight(o.rowIndex,a.rowDefinitions()[o.rowIndex].height,!0,r);var s=o.wrapper,h=void 0;t.margin.left<r&&(t.margin.left=r),t.margin.top<r&&(t.margin.top=r);for(var d=0;d<s.children.length;d++){var l=s.children[d];if(l instanceof Te){var c=e.nameTable[l.id];if(c.isLane){h=c.wrapper;break}}}h&&("Horizontal"===n.shape.orientation?t.margin.left<r+h.actualSize.width&&(t.margin.left=r+h.actualSize.width):t.margin.top<r+h.actualSize.height&&(t.margin.top=r+h.actualSize.height)),n.wrapper.measure(new i(n.width,n.height)),n.wrapper.arrange(n.wrapper.desiredSize),t.offsetX=t.wrapper.offsetX,t.offsetY=t.wrapper.offsetY,e.nodePropertyChange(t,{},{margin:{left:t.margin.left,top:t.margin.top}}),a.measure(new i(a.width,a.height)),a.arrange(a.desiredSize),n.width=n.wrapper.width=n.wrapper.children[0].actualSize.width,n.height=n.wrapper.height=n.wrapper.children[0].actualSize.height}}(n,o,l),n.updateDiagramElementQuad(),d}function No(e,t,i,r,o,n){var a=Js(r.element.id);r.diagramRenderer.renderStackHighlighter(e,a,r.scroller.transform,t,i,o,n)}function jo(e,t,i,r){var o=e,n=i.nameTable[o.parentId],a=i.nameTable[o.parentId];if(t&&a&&a.container&&"Stack"===a.container.type&&t.container&&"Stack"===t.container.type&&a.id!==t.parentId){var s=a.wrapper.children.indexOf(o.wrapper);s>-1&&(i.nameTable[o.id].parentId=t.id,a.wrapper.children.splice(s,1))}if(t&&t.parentId&&o.parentId&&"Drag"===r&&a.container&&"Stack"===a.container.type){var h=n.wrapper.children.indexOf(t.wrapper),d=n.wrapper.children.indexOf(o.wrapper),l={targetIndex:h,target:t,sourceIndex:d,source:e};n.wrapper.children.splice(d,1),n.wrapper.children.splice(h,0,o.wrapper);var c={type:"StackChildPositionChanged",redoObject:{targetIndex:d,target:t,sourceIndex:h,source:e},undoObject:l,category:"Internal"};i.commandHandler.addHistoryEntry(c)}}function Ho(t,i,r){r.width||0!==r.shape.phases.length||(r.width=100);var o=[],n=[],a=0,s=r.shape,h="Horizontal"===s.orientation;if(s.header&&s.hasHeader&&Xo(o,s.header.height),function(e,t,i){var r,o=0,n=i.shape;if(e.length>0)for(var a=0;a<e.length;a++)o+=e[a].height;if(t){if(n.phases.length>0&&n.phaseSize&&(o+=n.phaseSize,Xo(e,n.phaseSize)),n.lanes.length>0)for(a=0;a<n.lanes.length;a++)r=n.lanes[a].height,o+=r,a===n.lanes.length-1&&o<i.height&&(r+=i.height-o),Xo(e,r)}else if(n.phases.length>0){var s=0;for(a=0;a<n.phases.length;a++){var h=n.phases[a].offset;s+=0===a?h:h-=s,o+=r=h,a===n.phases.length-1&&o<i.height&&(r+=i.height-o),Xo(e,r)}}else Xo(e,i.height)}(o,h,r),function(e,t,i){var r,o,n,a,s=0,h=i.shape;if(h.phases.length>0&&"Horizontal"===h.orientation)for(a=0;a<h.phases.length;a++)r=h.phases[a].offset,s+=0===a?r:r-=s,o=Yo(r),a===h.phases.length-1&&s<i.width&&(o.width+=i.width-s),e.push(o);else if(t)o=Yo(i.width),e.push(o);else{for(h.phaseSize&&h.phases.length>0?h.lanes.length+1:h.lanes.length,h.phaseSize&&h.phases.length>0&&(s+=h.phaseSize,o=Yo(h.phaseSize),e.push(o)),n=0;n<h.lanes.length;n++)s+=h.lanes[n].width,o=Yo(h.lanes[n].width),n===h.lanes.length-1&&s<i.width&&(o.width+=i.width-s),e.push(o);0===h.phases.length&&0===h.lanes.length&&(o=Yo(i.width),e.push(o))}}(n,h,r),t.setDefinitions(o,n),s.header&&s.hasHeader&&(!function(t,i,r){for(var o=0,n=t.columnDefinitions(),a=r.shape,s=0;s<n.length;s++)o+=n[s].width;a.header.id=a.header.id||xh();var h={id:r.id+a.header.id,annotations:[Ah(a.header.annotation)],style:a.header.style?a.header.style:void 0,offsetX:r.offsetX,offsetY:r.offsetY,rowIndex:0,columnIndex:0,maxWidth:o,container:{type:"Canvas",orientation:"Horizontal"}};Dr(r)||(h.constraints&=~e.NodeConstraints.Select);var d=Wo(i,t,r,h,!0);t.addObject(d,0,0,1,t.columnDefinitions().length)}(t,i,r),a++),s.phases.length>0&&s.phaseSize){for(var d=0;d<s.phases.length;d++)""===s.phases[d].id&&(s.phases[d].id=xh()),_o(t,i,r,a,h,d);a++}if(s.lanes.length>0)for(d=0;d<s.lanes.length;d++)""===s.lanes[d].id&&(s.lanes[d].id=xh()),Vo(t,i,r,a,d,h),a++}function Wo(t,r,o,n,a,s,h,d){var l=new js(t,"nodes",n,!0);if(l.parentId=o.id,l.isHeader=!!a,l.isPhase=!!s,l.isLane=!!h,d&&(l[s?"PhaseHeaderParent":"LaneHeaderParent"]=d),l.constraints&=~(e.NodeConstraints.InConnect|e.NodeConstraints.OutConnect),l.constraints|=e.NodeConstraints.HideThumbs,t.initObject(l),t.nodes.push(l),l.wrapper.children.length>0){for(var c=0;c<l.wrapper.children.length;c++){var p=l.wrapper.children[c];p instanceof be&&(p.isCalculateDesiredSize=!1),p instanceof Se&&(p.canConsiderBounds=!1,(!a&&"Vertical"===o.shape.orientation&&s||"Vertical"!==o.shape.orientation&&h)&&(p.isLaneOrientation=!0,p.refreshTextElement()))}l.wrapper.measure(new i(void 0,void 0)),l.wrapper.arrange(l.wrapper.desiredSize)}return l.wrapper}function _o(t,i,r,o,n,a){var s,h=0,d=0,l=r.shape;n?(d=a,h=o,s=t.columnDefinitions()[a].width):h=l.header&&l.hasHeader?a+1:a;var c={annotations:[Ah(l.phases[a].header.annotation)],maxWidth:s,id:r.id+l.phases[a].id+"_header",offsetX:r.offsetX,offsetY:r.offsetY,style:l.phases[a].style,rowIndex:h,columnIndex:d,container:{type:"Canvas",orientation:n?"Horizontal":"Vertical"}};c.annotations[0].rotateAngle=n?0:270,Dr(r)||(c.constraints&=~e.NodeConstraints.Select),l.phases[a].header.id=c.id;var p=Wo(i,0,r,c,!1,!0,!1,l.phases[a].id);t.addObject(p,h,d)}function Vo(t,i,r,o,n,a){for(var s,h,d,l,c,p=r.shape,g=p.phases.length||1,u=p.header&&p.hasHeader?1:0,f=a?o:u,m=p.phaseSize&&p.phases.length>0?1:0,y=0;y<g;y++){var v=a?y:n+m;d=t.rows[f].cells[v],l={id:r.id+p.lanes[n].id+y,rowIndex:f,columnIndex:v,width:d.minWidth,height:d.minHeight,offsetX:r.offsetX,offsetY:r.offsetY,style:p.lanes[n].style,constraints:e.NodeConstraints.Default|e.NodeConstraints.ReadOnly|e.NodeConstraints.AllowDrop,container:{type:"Canvas",orientation:a?"Horizontal":"Vertical"}},Dr(r)||(l.constraints&=~e.NodeConstraints.Select),(h=Wo(i,0,r,l,!1,!1,!0)).children[0].isCalculateDesiredSize=!1,0===y&&((s={id:r.id+p.lanes[n].id+"_"+y+"_header",style:p.lanes[n].header.style,annotations:[Ah(p.lanes[n].header.annotation)],offsetX:r.offsetX,offsetY:r.offsetY,rowIndex:f,columnIndex:v,container:{type:"Canvas",orientation:a?"Horizontal":"Vertical"}}).annotations[0].rotateAngle=a?270:0,p.lanes[n].header.id=s.id,a?s.width=p.lanes[n].header.width:s.height=p.lanes[n].header.height,Dr(r)||(s.constraints&=~e.NodeConstraints.Select),c=Wo(i,0,r,s,!1,!1,!0,p.lanes[n].id),a&&(c.children[0].elementActions=c.children[0].elementActions|e.ElementAction.HorizontalLaneHeader),h.children.push(c)),t.addObject(h,f,v),a||f++,v=a?y:n+1}}function Xo(e,t){var i=new xo;i.height=t,e.push(i)}function Yo(e){var t=new Co;return t.width=e,t}function Uo(e,t,i,r){for(var o,n,a,s,h,d,l,c=[],p=0,g=t.rowDefinitions().length,u=0;u<g;u++)for(d=t.rows[u],s=0;s<d.cells.length;s++)if((h=d.cells[s].children[0])&&h.children&&h.children.length)for(a=1;a<h.children.length;a++)if(o=h.children[a],(n=e.getObject(o.id))&&(n.inEdges.length>0||n.outEdges.length>0))for(l=n.inEdges.concat(n.outEdges),p=0;p<l.length;p++)-1===c.indexOf(l[p])&&c.push(l[p]);return c}function Go(e){var t=e.wrapper;if(t.measure(new i(e.width,e.height)),t.children[0]instanceof wo){var r=t.children[0],o=!1;r.width&&r.width<r.desiredSize.width&&(o=!0,r.width=r.desiredSize.width),r.height&&r.height<r.desiredSize.height&&(o=!0,r.height=r.desiredSize.height),o&&r.measure(new i(r.width,r.height))}t.arrange(t.desiredSize)}function Fo(e,t,i){var r,o,n,a,s,h,d,l,c=t.wrapper.children[0];for(r=i;r<c.rows.length;r++)for(h=c.rows[r],o=0;o<h.cells.length;o++)if((d=h.cells[o]).children&&d.children.length>0)for(n=0;n<d.children.length;n++)l=d.children[n],(a=e.nameTable[l.id]).isLane&&l.children.length>1&&(s=e.nameTable[l.children[1].id])&&s.isLane&&(s.rowIndex=r,s.columnIndex=o),a.rowIndex=r,a.columnIndex=o}function Zo(e,t){var r,o,n,a,s,h,d,l,c=t.wrapper.children[0],p=t.shape,g=p.padding,u=p.lanes,f=c.bounds.y,m=p.phaseSize>0?p.phases.length:0,y="Horizontal"===p.orientation,v=y?p.phases.length||1:u.length+1,b=y?(p.header&&p.hasHeader?1:0)+(p.phases.length>0?1:0)+p.lanes.length:(p.header&&p.hasHeader?1:0)+p.phases.length;if(0===m&&!y&&p.lanes.length&&(b+=1),y?(r=(p.header&&p.hasHeader?1:0)+(m>0?1:0),o=0):(r=p.header&&p.hasHeader?1:0,o=m>0?1:0),u.length>0)for(f+=p.header&&p.hasHeader?p.header.height:0,h=0;h<u.length;h++){for(d=0;d<u[h].children.length;d++)if((n=u[h].children[d]).offsetX=u[h].width,n.offsetY=u[h].height,e.initObject(n),e.nodes.push(n),a=n.wrapper,y){for(l=o;l<v;l++)if(s=c.rows[r].cells[l],a.margin.left<s.bounds.right-c.bounds.x){n.parentId=s.children[0].id,l>o?a.margin.left=a.margin.left-(s.bounds.left-c.bounds.left):s.children[0].children[1].actualSize.width+g>=a.margin.left&&(a.margin.left=s.children[0].children[1].actualSize.width+g),a.margin.left<g&&(a.margin.left=g),a.margin.top<g&&(a.margin.top=g),qo(a,n,e);break}}else for(var w=r;w<b;w++)if(s=c.rows[w].cells[o],a.margin.top<s.bounds.bottom-f){n.parentId=s.children[0].id,w>r?a.margin.top=a.margin.top-(s.bounds.top-f):s.children[0].children[1].actualSize.height+g>=a.margin.top&&(a.margin.top=s.children[0].children[1].actualSize.height+g),a.margin.left<g&&(a.margin.left=g),a.margin.top<g&&(a.margin.top=g),qo(a,n,e);break}y?r++:o++}c.measure(new i(t.width,t.height)),c.arrange(c.desiredSize),function(e,t){var i,r,o,n,a,s,h=e.columnDefinitions(),d=e.rowDefinitions(),l=rn(t);"Vertical"===t.shape.orientation&&0===l&&(l=t.shape.header&&t.shape.hasHeader?1:0);var c=t.shape.padding;for(i=0;i<h.length;i++)e.updateColumnWidth(i,h[i].width,!0,c);for(i=l;i<d.length;i++)e.updateRowHeight(i,d[i].height,!0,c);for(r=0;r<d.length;r++)for(s=e.rows[r],i=0;i<h.length;i++)if((n=s.cells[i]).children&&n.children.length>0)for(o=0;o<n.children.length;o++)(a=n.children[o]).maxWidth&&(a.maxWidth=n.actualSize.width),a.maxHeight&&(a.maxHeight=n.actualSize.height)}(c,t),t.width=t.wrapper.width=c.width,t.height=t.wrapper.height=c.height,nn(e,t),t.wrapper.measure(new i(t.width,t.height)),t.wrapper.arrange(c.desiredSize),function(e){if("SwimLane"===e.shape.type)for(var t=e.shape.lanes,i=void 0,r=void 0,o=0;o<t.length;o++){i=t[o];for(var n=0;n<i.children.length;n++)(r=i.children[n]).offsetX=r.wrapper.offsetX,r.offsetY=r.wrapper.offsetY}}(t),Qo(t,e),Ko(t)}function qo(e,t,r){e.measure(new i(t.width,t.height)),e.arrange(e.desiredSize);var o=r.getObject(t.parentId);r.addChild(o,t.id)}function Ko(e){if("SwimLane"===e.shape.type&&!e.shape.isLane&&!e.shape.isPhase){var t=void 0,i=void 0,r=void 0,o=e.shape.lanes,n=rn(e),a=e.wrapper.children[0].rowDefinitions();for(i=0;i<o.length;i++,n++)t=o[i],"Horizontal"===e.shape.orientation?(r=a[n].height,t.height!==r&&(t.height=r)):(r=e.wrapper.children[0].columnDefinitions()[n].width,t.width!==r&&(t.width=r))}}function Qo(e,t){var i,r,o,n,a=e.shape,s=a.phases,h=a.header&&a.hasHeader?1:0,d=e.wrapper.children[0],l=d.bounds.y+(a.header&&a.hasHeader?a.header.height:0);if("SwimLane"===e.shape.type&&(e=t.getObject(e.id)||e,s.length>0))if(d=e.wrapper.children[0],"Horizontal"===a.orientation)for(o=a.header&&a.hasHeader?d.rows[1]:d.rows[0],i=0;i<s.length;i++)r=(n=o.cells[i].children[0]).bounds.right-d.bounds.x,s[i].offset!==r&&(s[i].offset=r),t.nameTable[n.id].maxWidth=n.maxWidth;else for(i=0;i<s.length;i++)r=(n=d.rows[h+i].cells[0].children[0]).bounds.bottom-l,s[i].offset!==r&&(s[i].offset=r),t.nameTable[n.id].maxWidth=n.maxWidth}function Jo(t,i){if(t&&t.length>0){var r=void 0;i.lineRoutingModule&&i.constraints&e.DiagramConstraints.LineRouting&&i.lineRoutingModule.renderVirtualRegion(i,!0);for(var o=0;o<t.length;o++)r=i.getObject(t[o]),i.lineRoutingModule&&i.constraints&e.DiagramConstraints.LineRouting&&"Orthogonal"===r.type?i.lineRoutingModule.refreshConnectorSegments(i,r,!0):i.connectorPropertyChange(r,{},{sourceID:r.sourceID,targetID:r.targetID})}}function $o(t,r,o,n){var a,s,h,d,l,c,p,g,u=t.getObject(r.parentId),f=u.shape,m=u.wrapper.children[0],y=f.lanes,v=Uo(t,m,r.rowIndex);if("Horizontal"===f.orientation&&r.rowIndex!==o.rowIndex||"Vertical"===f.orientation&&r.columnIndex!==o.columnIndex){if("Horizontal"===f.orientation)d=r.rowIndex,l=o.rowIndex,a=(f.header&&f.hasHeader?1:0)+(f.phases.length&&f.phaseSize?1:0),p=r.rowIndex-a,g=o.rowIndex-a,y[p].canMove&&(p<g?n&&o.wrapper.offsetY>n.y&&(l+=g>0?-1:1,g+=g>0?-1:1):n&&o.wrapper.offsetY<n.y&&(l+=1,g+=1),d!==l&&m.updateRowIndex(d,l));else if(d=r.columnIndex,l=o.columnIndex,a=f.phases.length&&f.phaseSize?1:0,p=r.columnIndex-a,g=o.columnIndex-a,f.header&&f.hasHeader?1:0,y[p].canMove&&(p<g?n&&o.wrapper.offsetX>n.x&&(l+=g>0?-1:1,g+=g>0?-1:1):n&&o.wrapper.offsetX<n.x&&(l+=1,g+=1),d!==l)){if(!(0!==f.phaseSize&&0!==f.phases.length||0!==l&&0!==d)&&f.header&&f.hasHeader){var b=0===l?d:l;m.rows[0].cells[b].children=m.rows[0].cells[0].children,m.rows[0].cells[b].columnSpan=m.rows[0].cells[0].columnSpan,m.rows[0].cells[0].children=[]}m.updateColumnIndex(0,d,l)}d!==l&&(c=y[p]).canMove&&(s={target:Ah(o),source:Ah(r)},c=y[p],y.splice(p,1),y.splice(g,0,c),h={type:"LanePositionChanged",redoObject:{target:Ah(s.source),source:Ah(s.target)},undoObject:s,category:"Internal"},t.diagramActions&e.DiagramAction.UndoRedo||t.commandHandler.addHistoryEntry(h),Fo(t,u,0),Jo(v,t),function(e,t){for(var i,r,o=0;o<e.length;o++){i=e[o];for(var n=0;n<i.children.length;n++)(r=t.nameTable[i.children[n].id]).offsetX=r.wrapper.offsetX,r.offsetY=r.wrapper.offsetY}}(y,t),u.wrapper.measure(new i(u.width,u.height)),u.wrapper.arrange(u.wrapper.desiredSize),t.updateDiagramObject(u))}t.updateDiagramElementQuad()}function en(e,t,i,r){var o=e.getObject(i.id),n=o.shape,a=n.header&&n.hasHeader?1:0,s=n.lanes,h=n.phases,d=r.wrapper.actualSize.width,l=r.wrapper.actualSize.height,c=t.wrapper.actualSize.width,p=t.wrapper.actualSize.height;"SwimLane"===o.shape.type&&("Horizontal"===n.orientation?t.isPhase?h[t.columnIndex].offset+=d-c:(a=n.phaseSize&&n.phases.length>0?a+1:a,s[t.rowIndex-a].height+=l-p):t.isPhase?h[t.rowIndex-a].offset+=l-p:(a=n.phaseSize&&n.phases.length>0?1:0,s[t.columnIndex-a].width+=d-c))}function tn(e,t){var i,r=e.shape,o=r.header&&r.hasHeader?1:0;return"Horizontal"===r.orientation?(o+=r.phases.length>0?1:0,i=t.rowIndex-o):i=t.columnIndex-(r.phaseSize&&r.phases.length>0?1:0),i}function rn(e){var t=0,i=e.shape;return"Horizontal"===i.orientation&&(t=i.header&&i.hasHeader?1:0),i.phases.length>0&&i.phaseSize&&(t+=1),t}function on(e,t,i,r){var o=e.shape;if(o.phases.length>0){var n=t.nameTable[o.phases[r].header.id];n&&n.maxWidth<i.outerBounds.width&&(n.maxWidth=i.outerBounds.width,n.wrapper.maxWidth=i.outerBounds.width)}}function nn(e,t){if(t.shape.header&&t.shape.hasHeader){var i=t.wrapper.children[0].rows[0].cells[0].children[0].id,r=e.nameTable[i];r&&r.isHeader&&r.maxWidth<t.width&&(r.maxWidth=t.width,r.wrapper.maxWidth=t.width)}}function an(t,i,r,o){var n,a=t.nameTable[i.id];if("SwimLane"===a.shape.type){t.protectPropertyChange(!0);var s=a.wrapper.children[0],h=s.bounds,d=a.shape,l=void 0,c=!1,p=void 0,g=void 0,u=void 0,f=void 0,m=void 0,y=void 0,v=void 0,b=void 0,w=new Ws(d,"lanes",r,!0);g=d.header&&d.hasHeader?1:0,"Horizontal"===d.orientation&&(c=!0,g=d.phases.length>0?g+1:g);var x=Uo(t,s),C=void 0!==o?o:d.lanes.length;if(g+=C,n={element:w,cause:t.diagramActions,state:"Changing",type:"Addition",cancel:!1,laneIndex:C},t.triggerEvent(e.DiagramEvent.collectionChange,n),!n.cancel){if(c){var S=new xo;S.height=r.height,s.addRow(g,S,!1),a.height=void 0!==a.height?a.height+r.height:a.height,a.wrapper.height=s.height=a.height}else{var P=new Co;P.width=r.width,s.addColumn(C+1,P,!1),a.width&&(a.width+=r.width,a.wrapper.width=s.width=a.width),t.diagramActions&e.DiagramAction.UndoRedo||(s.rows[0].cells[0].columnSpan+=1)}if(t.diagramActions&e.DiagramAction.UndoRedo||(w.id=""===w.id?xh():w.id),void 0!==o?d.lanes.splice(o,0,w):d.lanes.push(w),n={element:w,cause:t.diagramActions,state:"Changed",type:"Addition",cancel:!1,laneIndex:C},t.triggerEvent(e.DiagramEvent.collectionChange,n),Vo(s,t,a,g,C,c),l="Horizontal"===d.orientation?t.nameTable[s.rows[g].cells[0].children[0].id]:d.header&&d.hasHeader?t.nameTable[s.rows[1].cells[g].children[0].id]:t.nameTable[s.rows[0].cells[g].children[0].id],t.diagramActions&e.DiagramAction.UndoRedo||(p={type:"LaneCollectionChanged",changeType:"Insert",undoObject:Ah(w),redoObject:Ah(l),category:"Internal"},t.addHistoryEntry(p)),Fo(t,a,"Horizontal"===d.orientation?g:d.header&&d.hasHeader?1:0),Go(a),nn(t,a),(u=r.children)&&u.length>0)for(f=0;f<u.length;f++)if(b={x:(v=u[f]).wrapper.offsetX,y:v.wrapper.offsetY},"Horizontal"===d.orientation)for(s.rows[g].cells[m],m=0;m<s.rows[g].cells.length;m++)sn(t,s.rows[g].cells[m],b,v);else for(y=0;y<s.rows.length;y++)sn(t,s.rows[y].cells[g],b,v);Jo(x,t),t.drag(a,h.x-s.bounds.x,h.y-s.bounds.y)}t.protectPropertyChange(!1)}}function sn(e,t,i,r){if(t.children&&t.children.length>0){var o=t.children[0],n=e.nameTable[o.id];o.bounds.containsPoint(i)&&e.addChild(n,r)}}function hn(t,i,r){if("SwimLane"===i.shape.type){var o=void 0,n=void 0,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=i.wrapper.bounds.x,p=i.wrapper.bounds.y,g=i.shape,u=g.padding,f=g.phases,m=void 0,y=i.wrapper.children[0],v="Horizontal"===g.orientation;o=g.header&&g.hasHeader?0:-1,g.phases.length>0&&(o+=1);var b=v?g.lanes[0].header.width:g.lanes[0].header.height;if(r.offset>b){for(l=0;l<f.length;l++)if(a=f[l],s=l>0?f[l-1]:a,a.offset>r.offset){if(m=l>0?r.offset-s.offset:r.offset,v){var w=y.columnDefinitions()[l];w.width-=m,(h=t.nameTable[g.phases[l].header.id]).maxWidth=h.wrapper.maxWidth=w.width,y.updateColumnWidth(l,w.width,!1);var x=new Co;x.width=m,d=l,y.addColumn(l,x,!1);break}var C=y.rowDefinitions()[l+o];C.height-=m,h=t.nameTable[g.phases[l].header.id],y.updateRowHeight(l+o,C.height,!1);var S=new xo;S.height=m,d=l,y.addRow(l+o,S,!1);break}if(t.diagramActions&e.DiagramAction.UndoRedo&&void 0===d)(E=t.historyManager.currentEntry.next).isLastPhase&&function(e,t,i,r,o,n){var a=t.shape.phases[e-2],s=i.previousPhase.offset;if(o){var h=r.columnDefinitions()[e-1],d=new Co;e>1?(d.width=h.width-(s-a.offset),h.width=s-a.offset):(d.width=h.width-s,h.width=s),r.updateColumnWidth(e-1,h.width,!1),r.addColumn(e,d,!1)}else{h=r.rowDefinitions()[e];var l=new xo;e>1?(l.height=i.undoObject.offset-s,h.height=s-a.offset):(l.height=h.height-s,h.height=s),r.updateRowHeight(e,h.height,!1),r.addRow(1+e,l,!1)}}(d=f.length,i,E,y,v);var P=new _s(i.shape,"phases",r,!0);if(t.diagramActions&e.DiagramAction.UndoRedo||(P.id+=xh()),g.phases.splice(d,0,P),_o(y,t,i,o,v,d),v){if(n=t.nameTable[y.rows[o].cells[d].children[0].id],0===d&&g.header&&g.hasHeader){y.rows[0].cells[0].children=y.rows[0].cells[1].children,y.rows[0].cells[1].children=[];for(var T=y.rows[0],A=0;A<T.cells.length;A++)T.cells[A].minWidth=void 0,T.cells[A].columnSpan=0===A?y.rows[0].cells.length:1}!function(e,t,i,r,o){var n,a,s,h,d,l=t.shape,c=rn(t);l.header&&l.hasHeader&&(i.rows[0].cells[0].columnSpan=i.rows[0].cells.length);for(a=c;a<i.rows.length;a++)d=i.rows[a],s=d.cells[r-1],h=d.cells[r],n=d.cells[r+1],dn(e,t,s,h,n,a,r);Fo(e,t,1)}(t,i,y,d);var z=y.columnDefinitions();if(y.updateColumnWidth(d,z[d].width,!0,u),n.maxWidth=n.wrapper.maxWidth=z[d].width,z.length>d+1){var O=t.nameTable[y.rows[o].cells[d+1].children[0].id];y.updateColumnWidth(d+1,z[d+1].width,!0,u),O.maxWidth=O.wrapper.maxWidth=z[d+1].width}i.width=i.wrapper.width=i.wrapper.children[0].width=y.width}else{n=t.nameTable[y.rows[o+d].cells[0].children[0].id];var I=y.rowDefinitions(),D=I[o+d].height;!function(e,t,i,r,o){for(var n,a,s,h=i.rows[r],d=i.rows[r+1],l=i.rows[r-1],c=1;c<h.cells.length;c++)a=h.cells[c],s=d?d.cells[c]:void 0,n=l.cells[c],dn(e,t,n,a,s,r,c);Fo(e,t,1)}(t,i,y,o+d),y.updateRowHeight(o+d,D,!0,u),I.length>o+d+1&&(D=I[o+d+1].height,y.updateRowHeight(o+d+1,D,!0,u)),i.height=i.wrapper.height=i.wrapper.children[0].height=y.actualSize.height}if(Go(i),i.width=i.wrapper.actualSize.width,nn(t,i),t.drag(i,c-i.wrapper.bounds.x,p-i.wrapper.bounds.y),Qo(i,t),!(t.diagramActions&e.DiagramAction.UndoRedo)){var E={type:"PhaseCollectionChanged",changeType:"Insert",undoObject:Ah(P),redoObject:Ah(n),category:"Internal"};t.addHistoryEntry(E)}t.updateDiagramObject(i)}}}function dn(t,i,r,o,n,a,s){var h,d,l,c=i.shape,p="Horizontal"===c.orientation,g=i.wrapper.children[0],u=o.desiredCellWidth,f=o.desiredCellHeight,m=p?a:s;r?(h=p?r.bounds.x+r.bounds.width:r.bounds.x,d=p?r.bounds.y:r.bounds.y+r.bounds.height):(h=g.bounds.x,d=n.bounds.y);var y=new b(h,d,u,f),v=Wo(t,0,i,{id:i.id+(p?c.lanes[m-2]:c.lanes[m-1]).id+xh()[0],rowIndex:a,columnIndex:s,width:o.minWidth,height:o.minHeight,style:(p?c.lanes[m-2]:c.lanes[m-1]).style,constraints:e.NodeConstraints.Default|e.NodeConstraints.AllowDrop,container:{type:"Canvas",orientation:p?"Horizontal":"Vertical"}},!1,!1,!0);if(v.children[0].isCalculateDesiredSize=!1,g.addObject(v,a,s),n&&n.children&&n.children.length)for(l=0;l<n.children.length;l++)p?t.nameTable[n.children[l].id].columnIndex+=1:t.nameTable[n.children[l].id].rowIndex+=1;!function(e,t,i,r,o,n,a){var s,h,d,l=e.nameTable[o.id],c=t||a,p=e.nameTable[l.parentId].shape.padding;if(c.children&&c.children[0].children.length>1)for(var g=1;g<c.children[0].children.length;g++)s=c.children[0].children[g],d=e.nameTable[s.id],h=n?{x:s.bounds.x,y:s.bounds.center.y}:{x:s.bounds.center.x,y:s.bounds.top},r.containsPoint(h)?(i.children[0].children.push(s),c.children[0].children.splice(g,1),g--,e.deleteChild(d),d.isLane||(d.parentId=o.id),l.children||(l.children=[]),t||(n?d.margin.left=d.wrapper.bounds.x-c.children[0].bounds.right:d.margin.top=d.wrapper.bounds.y-c.children[0].bounds.bottom),l.children.push(s.id),d.zIndex=l.zIndex+1,e.removeElements(d)):t&&(n?(d.margin.left-=i.desiredCellWidth,p>d.margin.left&&(d.margin.left=p)):(d.margin.top-=i.desiredCellHeight,p>d.margin.top&&(d.margin.top=p)))}(t,n,o,y,v,p,r)}function ln(e,t,i){if("SwimLane"===t.shape.type&&("ResizeSouth"===i||"ResizeEast"===i)){var r=t.shape,o=t.wrapper.children[0],n=void 0,a=void 0;"ResizeSouth"===i?"Vertical"===r.orientation?n=o.rows[o.rows.length-1].cells[0]:(a=o.rows.length-1,n=o.rows[a].cells[o.rows[a].cells.length-1]):(a=r.header&&r.hasHeader?1:0,n=o.rows[a].cells[o.rows[a].cells.length-1]),e.commandHandler.select(e.nameTable[n.children[0].id])}}function cn(e,t,i,r,o,n){var a,s,h,d,l,c,p,g=xh(),u=e.shape,f=u.phases,m=e.offsetX-e.wrapper.actualSize.width/2,y=e.offsetY-e.wrapper.actualSize.height/2;if("Vertical"===u.orientation&&(y+=u.header&&u.hasHeader?u.header.height:0),!n)for(o||(e.id+=g,u&&u.header&&u.hasHeader?u.header.id+=g:u.header=void 0),a=0;f&&a<f.length;a++)f[a].id+=g;var v=o?[i.childTable[r.id]]:u.lanes;for(a=0;v&&a<v.length;a++)for(h=v[a],n||(h.id+=g),s=0;h.children&&s<h.children.length;s++)c=(d=h.children[s]).wrapper.offsetX-d.width/2,p=d.wrapper.offsetY-d.height/2,d.zIndex=-1,d.inEdges=d.outEdges=[],(n||i&&(1===i.pasteIndex||0===i.pasteIndex))&&("Vertical"===u.orientation?d.margin.top=p-y:d.margin.left=c-m),n||(d.id+=g);if(!n){if(o)l={shape:{lanes:v,phases:f,phaseSize:u.phaseSize,type:"SwimLane",orientation:u.orientation,header:{annotation:{content:"Title"},height:50}}},"Horizontal"===u.orientation?(l.width=e.wrapper.actualSize.width,l.height=r.wrapper.actualSize.height+u.header.height+u.phaseSize,l.offsetX=e.wrapper.offsetX+10*i.pasteIndex,l.offsetY=r.wrapper.offsetY+10*i.pasteIndex):(l.width=r.wrapper.actualSize.width,l.height=e.wrapper.actualSize.height,l.offsetX=r.wrapper.offsetX+10*i.pasteIndex,l.offsetY=e.wrapper.offsetY+10*i.pasteIndex),e=l;if(0!==i.pasteIndex&&(e.offsetX+=10,e.offsetY+=10),e.zIndex=-1,e=t.add(e),!o)for(var b=0,w=Object.keys(i.childTable);b<w.length;b++){var x=w[b],C=i.childTable[x];C.id+=g,C.sourceID+=g,C.targetID+=g,C.zIndex=-1,t.add(C)}"SVG"!==t.mode&&t.refreshDiagramLayer(),t.select([e])}return e}function pn(e,t,r,o){var n,a=t.nodes[0];if(o||Eo(e,a,!0)){var s=void 0,h=void 0,d=void 0,l=new be;r&&(d=e.nameTable[r].parentId,s=a=e.nameTable[r]);var c=r?s.wrapper:a.wrapper,p=e.nameTable[d||a.parentId];p&&"Grid"===p.container.type&&((n=new Te).children=[],!o&&a.isHeader||("Horizontal"===p.container.orientation&&a.isPhase||"Vertical"===p.container.orientation&&(a.rowIndex>0&&a.columnIndex>0||a.isLane)?(h=Oo(p,s?s.columnIndex:a.columnIndex,!(!p.shape.header||!p.shape.hasHeader)),n.offsetX=h.center.x,n.offsetY=h.center.y,l.width=h.width,l.height=h.height):(n.offsetX=p.offsetX,n.offsetY=c.offsetY,l.width=p.wrapper.actualSize.width,l.height=c.actualSize.height)),n.children.push(l),n.measure(new i),n.arrange(n.desiredSize))}return n}function gn(t,i,r,o,n){n=void 0!==n?n:tn(i,r);for(var a=!1,s=i.shape.lanes[n],h=s.children.length-1;h>=0;h--)o?o.id===s.children[h].id&&s.children.splice(h,1):(t.removeDependentConnector(s.children[h]),t.diagramActions&e.DiagramAction.UndoRedo||(t.diagramActions=t.diagramActions|e.DiagramAction.UndoRedo,a=!0),t.remove(s.children[h]),s.children.splice(h,1),a&&(t.diagramActions=t.diagramActions&~e.DiagramAction.UndoRedo))}function un(e){return e.children[0]}function fn(e,t){e.nodes.splice(e.nodes.indexOf(t),1),e.removeFromAQuad(t),e.removeObjectsFromLayer(t),delete e.nameTable[t.id],e.removeElements(t)}function mn(t,i,r,o){var n;if("SwimLane"===r.shape.type){var a=r.shape,s=void 0;if(1===a.lanes.length)t.remove(r);else{var h=r.wrapper.bounds.x,d=r.wrapper.bounds.y,l=void 0,c=void 0,p=void 0,g=void 0,u=r.wrapper.children[0];if(s=o?a.lanes.indexOf(o):tn(r,i),n={element:i,cause:t.diagramActions,state:"Changing",type:"Removal",cancel:!1,laneIndex:s},t.triggerEvent(e.DiagramEvent.collectionChange,n),!n.cancel){var f=Ah(a.lanes[s]);if(gn(t,r,i,void 0,s),!(t.diagramActions&e.DiagramAction.UndoRedo)){var m={type:"LaneCollectionChanged",changeType:"Remove",undoObject:f,redoObject:Ah(i),category:"Internal"};t.addHistoryEntry(m)}a.lanes.splice(s,1);var y=i?"Horizontal"===a.orientation?i.rowIndex:i.columnIndex:rn(r)+s;if("Horizontal"===a.orientation){for(l=u.rows[y],c=0;c<l.cells.length;c++)if((p=l.cells[c])&&p.children.length>0)for(g=0;g<p.children.length;g++)yn(t,p.children[g]);u.removeRow(y)}else{for(r.width=void 0!==r.width?r.width-u.rows[0].cells[y].actualSize.width:r.width,c=0;c<u.rows.length;c++)if((p=u.rows[c].cells[y])&&p.children.length>0)for(g=0;g<p.children.length;g++)yn(t,p.children[g]);u.removeColumn(y)}n={element:i,cause:t.diagramActions,state:"Changed",type:"Removal",cancel:!1,laneIndex:s},t.triggerEvent(e.DiagramEvent.collectionChange,n),r.width=r.wrapper.width=u.width,r.height=r.wrapper.height=u.height,Go(r),"Vertical"===r.shape.orientation&&(y=0),Fo(t,r,y),t.drag(r,h-r.wrapper.bounds.x,d-r.wrapper.bounds.y),t.updateDiagramObject(r)}}}}function yn(e,t){var i,r;if(t instanceof Te){if(t.children.length>0)for(i=0;i<t.children.length;i++)t.children[i]instanceof Te&&yn(e,t.children[i]);r=e.getObject(t.id),fn(e,r)}}function vn(t,i,r,o){t.protectPropertyChange(!0);r.wrapper.bounds.x,r.wrapper.bounds.y;var n,a=!1,s=r.shape,h=r.wrapper.children[0],d=o?s.phases.indexOf(o):function(e,t){var i=t.shape,r=i.header&&i.hasHeader?1:0;return"Horizontal"===i.orientation?e.columnIndex:e.rowIndex-r}(i,r),l=s.phases.length;if(s.phases.length>1){d===l-1&&(a=!0,n=Ah(s.phases[d-1]));var c=Ah(s.phases[d]);if(s.phases.splice(d,1),!(t.diagramActions&e.DiagramAction.UndoRedo)){var p={type:"PhaseCollectionChanged",changeType:"Remove",undoObject:c,previousPhase:n,redoObject:Ah(i),category:"Internal",isLastPhase:a};t.addHistoryEntry(p)}"Horizontal"===s.orientation?function(e,t,i,r){var o,n,a,s,h,d,l,c,p,g,u,f;for(r=void 0!==r?r:i.columnIndex,l=0;l<t.rows.length;l++)if((o=t.rows[l]).cells.length>1&&(n=o.cells[r],a=o.cells.length-1===r?o.cells[r-1]:o.cells[r+1],h=a.children[0],n.children.length>0))if(s=n.children[0],u=e.nameTable[s.id],0===a.children.length&&n.children.length>0)a.children=n.children,a.columnSpan=n.columnSpan-1;else{for(c=0;c<s.children.length;c++){if((g=s.children[c])instanceof Te){if((f=e.nameTable[g.id]).isLane||(f.parentId=h.id),o.cells.length-1===r&&(f.margin.left=f.wrapper.bounds.x-h.bounds.x,g.margin.left=f.wrapper.bounds.x-h.bounds.x),h.children.push(g),e.nameTable[h.id]){var m=e.nameTable[h.id];m.children||(m.children=[]),m.children.push(g.id)}s.children.splice(c,1),c--,u&&u.children&&-1!==u.children.indexOf(f.id)&&u.children.splice(u.children.indexOf(f.id),1)}if(o.cells.length-1!==r)for(p=0;p<h.children.length;p++){var y=h.children[p];if(y instanceof Te){var v=e.nameTable[y.id];v.margin.left=v.wrapper.bounds.x-s.bounds.x,y.margin.left=v.wrapper.bounds.x-s.bounds.x}}}if(u&&u.isPhase){var b=e.nameTable[h.id];b&&(h.maxWidth=b.wrapper.maxWidth=b.wrapper.maxWidth+=u.wrapper.maxWidth)}fn(e,u)}var w=t.columnDefinitions()[r].width;t.removeColumn(r),r<t.columnDefinitions().length?(d=t.columnDefinitions()[r].width,d+=w,t.updateColumnWidth(r,d,!0)):(d=t.columnDefinitions()[r-1].width,d+=w,t.updateColumnWidth(r-1,d,!0))}(t,h,i,d):function(e,t,i,r,o){var n,a,s,h,d,l,c,p,g,u=o.shape,f=void 0!==r?u.header?r+1:r:i.rowIndex,m=t.rows[f],y=o.wrapper.bounds.y,v=u.phases.length;void 0!==u.header&&u.hasHeader&&(y+=t.rowDefinitions()[0].height);var b=r===v?t.rows[f-1]:t.rows[f+1];for(s=0;s<m.cells.length;s++)if(n=m.cells[s],l=b.cells[s],c=l.children[0],n.children.length>0){var w=n.children[0],x=e.nameTable[w.id];if(r<v)for(d=0;d<c.children.length;d++)(p=c.children[d])instanceof Te&&((g=e.nameTable[p.id]).margin.top=g.wrapper.bounds.y-(0===r?y:w.bounds.y),p.margin.top=g.wrapper.bounds.y-(0===r?y:w.bounds.y));for(h=0;h<w.children.length;h++)(p=w.children[h])instanceof Te&&((g=e.nameTable[p.id]).parentId=c.id,r===v&&(g.margin.top=g.wrapper.bounds.y-(0===r?y:c.bounds.y),p.margin.top=g.wrapper.bounds.y-(0===r?y:c.bounds.y)),c.children.push(p),w.children.splice(h,1),h--,x.children&&-1!==x.children.indexOf(g.id)&&x.children.splice(x.children.indexOf(g.id),1));fn(e,x)}var C=t.rowDefinitions()[f].height;t.removeRow(f),f<t.rowDefinitions().length?(a=t.rowDefinitions()[f].height,a+=C,t.updateRowHeight(f,a,!0)):(a=t.rowDefinitions()[f-1].height,a+=C,t.updateRowHeight(f-1,a,!0))}(t,h,i,d,r),nn(t,r),Fo(t,r,1),Qo(r,t),t.protectPropertyChange(!1),t.updateDiagramObject(r)}}function bn(e,t){var i;if(e.isLane){var r=t.getObject(e.parentId);if(r&&"SwimLane"===r.shape.type&&e.isLane){var o=tn(r,e);i=r.shape.lanes[o]}}return i}function wn(e,t){if(e.isLane&&bn(e,t).canMove)return!0;return!1}function xn(e,t){for(var i=[],r=0;r<t.length;r++){var o=t[r];e.containsRect(o.wrapper.bounds)&&i.push(o)}return i}function Cn(e,t){for(var i=0;i<e.length;i++)if(e[i].id===t)return!0;return!1}function Sn(e){var t;return e&&(e.type?t="Connector":e.shape&&!e.type&&(t="Node")),t}function Pn(e,t){t instanceof js&&(e.shape.header||(t.shape.hasHeader=!1))}function Tn(e,t,i,r){return r=t?r:void 0!==e[i-1]?e[i-1]+r:0}function An(e,t){var i=[];if(t)i=e;else{for(var r=0;r<e.length;r++)i.push(e[r]);i.push(e[i.length-2]),i.push(e[i.length-2])}return i}function zn(e){for(var t=0;t<e.ports.length;t++)e.ports[t].inEdges=[],e.ports[t].outEdges=[];return e}function On(e,t){if(t instanceof js)switch(sf.base.isBlazor()?e.shape.umlActivityShape:e.shape.shape){case"JoinNode":e.width||(t.width=20),e.height||(t.height=90),e.style&&e.style.fill||(t.style.fill="black");break;case"ForkNode":e.width||(t.width=90),e.height||(t.height=20),e.style&&e.style.fill||(t.style.fill="black");break;case"InitialNode":case"FinalNode":e.style&&e.style.fill||(t.style.fill="black")}else switch(sf.base.isBlazor()?e.shape.umlActivityFlow:e.shape.flow){case"Object":e.style&&e.style.strokeDashArray||(t.style.strokeDashArray="8 4"),e.style&&e.style.strokeWidth||(t.style.strokeWidth=2),e.targetDecorator&&e.targetDecorator.shape||(t.targetDecorator.shape="OpenArrow");break;case"Control":e.style&&e.style.strokeWidth||(t.style.strokeWidth=2),e.targetDecorator&&e.targetDecorator.shape||(t.targetDecorator.shape="OpenArrow"),e.sourceDecorator&&e.sourceDecorator.shape||(t.sourceDecorator.shape="None")}}function In(e,t){switch(e.shape.type){case"Bpmn":switch(sf.base.isBlazor()?e.shape.bpmnFlow:e.shape.flow){case"Sequence":("Normal"===e.shape.sequence&&"Bezier"!==e.type||"Default"===e.shape.sequence||"Conditional"===e.shape.sequence)&&(t.targetDecorator&&t.targetDecorator.style&&(t.targetDecorator.style.fill=e.targetDecorator&&e.targetDecorator.style&&e.targetDecorator.style.fill||"black"),"Conditional"===e.shape.sequence&&t.sourceDecorator&&(t.sourceDecorator.style&&(t.sourceDecorator.style.fill=e.sourceDecorator&&e.sourceDecorator.style&&e.sourceDecorator.style.fill||"white"),t.sourceDecorator.width=e.sourceDecorator&&e.sourceDecorator.width||20,t.sourceDecorator.height=e.sourceDecorator&&e.sourceDecorator.width||10));break;case"Association":"Default"!==e.shape.association&&"Directional"!==e.shape.association&&"BiDirectional"!==e.shape.association||(t.targetDecorator&&t.targetDecorator.style&&(t.targetDecorator.style.fill=e.targetDecorator&&e.targetDecorator.style&&e.targetDecorator.style.fill||"black"),"BiDirectional"===e.shape.association&&t.sourceDecorator&&t.sourceDecorator.style&&(t.sourceDecorator.style.fill=e.sourceDecorator&&e.sourceDecorator.style&&e.sourceDecorator.style.fill||"white",t.sourceDecorator.width=e.sourceDecorator&&e.sourceDecorator.width||5,t.sourceDecorator.height=e.sourceDecorator&&e.sourceDecorator.height||10));break;case"Message":t.style&&!t.style.strokeDashArray&&(t.style.strokeDashArray=e.style&&e.style.strokeDashArray||"4 4")}break;case"UmlActivity":switch(sf.base.isBlazor()?e.shape.umlActivityFlow:e.shape.flow){case"Exception":"Directional"!==e.shape.association&&"BiDirectional"!==e.shape.association||(t.style.strokeDashArray=e.style&&e.style.strokeDashArray||"2 2")}break;case"UmlClassifier":var i=!1;"Association"===e.shape.relationship?i=!0:"Inheritance"===e.shape.relationship?(t.targetDecorator&&t.targetDecorator.style&&(t.targetDecorator.style.fill=e.targetDecorator&&e.targetDecorator.style&&e.targetDecorator.style.fill||"white"),t.style&&(i=!0,t.style.strokeDashArray=e.style&&e.style.strokeDashArray||"4 4")):"Composition"===e.shape.relationship?(t.sourceDecorator&&t.sourceDecorator.style&&(t.sourceDecorator.style.fill=e.sourceDecorator&&e.sourceDecorator.style&&e.sourceDecorator.style.fill||"black"),i=!0):"Aggregation"===e.shape.relationship||void 0===e.shape.relationship?(t.sourceDecorator&&t.sourceDecorator.style&&(t.sourceDecorator.style.fill=e.sourceDecorator&&e.sourceDecorator.style&&e.sourceDecorator.style.fill||"white"),i=!0):"Dependency"===e.shape.relationship?(t.sourceDecorator&&t.sourceDecorator.style&&(t.sourceDecorator.style.fill=e.sourceDecorator&&e.sourceDecorator.style&&e.sourceDecorator.style.fill||"white"),i=!0,t.style.strokeDashArray="4 4"):"Realization"===e.shape.relationship&&(t.sourceDecorator&&t.sourceDecorator.style&&(t.sourceDecorator.style.fill=e.sourceDecorator&&e.sourceDecorator.style&&e.sourceDecorator.style.fill||"white"),i=!0),i&&(t.style.strokeWidth=e.style&&e.style.strokeWidth||2)}}function Dn(e,t,i){var r;r=a.findLength(t,e)>a.findLength(i,e)?i:t;var o=a.findAngle(t,i),n=a.findAngle(r,e),s=a.findLength(r,e),h=n+2*(o-n);return{x:r.x+s*Math.cos(h*Math.PI/180),y:r.y+s*Math.sin(h*Math.PI/180)}}function En(e){var t=e.parentElement;do{if(ch(t,"e-diagram"))return!0;t=t.parentElement}while(t);return!1}function Bn(e,t,i){if(e&&e.children&&e.children.length>0)for(var r=void 0,o=0;o<e.children.length;o++)return(r=i[e.children[o]]).shape.type===t||Bn(r,t,i);return!1}function Ln(e,t,i,r,o){if(i&&(e instanceof wr||e&&(e.shape&&"SwimLane"!==e.shape.type||void 0===e.shape)))for(var n=void 0,a=0,s=Object.keys(i);a<s.length;a++){var h=s[a];if(n=i[h],"shape"===h&&n.type&&(e.shape={type:n.type}),n)if(Array.isArray(n)&&n.length&&n.length>0&&"annotations"!==o&&"ports"!==o)if(e[h].length>0)for(var d=0;d<=e[h].length;d++)Ln(e[h],t?t[h]:void 0,i[h],"annotations"===h||"ports"===h?e:void 0,h);else Ln(e[h],t?t[h]:void 0,i[h],"annotations"===h||"ports"===h?e:void 0,h);else if(n instanceof Object&&t&&"annotations"!==o&&"ports"!==o)Ln(e[h],t[h],i[h]);else if("annotations"!==o&&"ports"!==o&&t&&!t[h]||!t&&e&&(e[h]||void 0!==e[h]))e[h]=i[h];else{var l=void 0;"annotations"!==o&&"ports"!==o||("annotations"===o?(e[h]&&Ln(e[h],t[h],i[h]),e[h]||(Ea(r)===wr?(l=new Ze(r,"annotations",i[h]),r.annotations.push(l)):(l=new Fe(r,"annotations",i[h]),r.annotations.push(l)))):e[h]?Ln(e[h],t[h],i[h]):(l=new Ve(r,"ports",i[h]),r.ports.push(l)))}}}function Mn(e,t,i,r){var o;if(t)for(var n=0,a=Object.keys(t);n<a.length;n++){var s=a[n];if(o=t[s],"getAssistantDetails"===s){if(r.data.Role===t[s].root)for(var h=t[s].assistants,d=0;d<h.length;d++)for(var l=0;l<i.length;l++)i[l].data.Role===h[d]&&(e.assistants.push(i[l].id),e.children.splice(0,1))}else o&&(e[s]=t[s])}!e.hasSubTree&&t.canEnableSubTree&&(e.orientation=r.layoutInfo.orientation,e.type=r.layoutInfo.type,r.layoutInfo.offset!==e.offset&&void 0!==r.layoutInfo.offset&&(e.offset=r.layoutInfo.offset)),r.layoutInfo.hasSubTree=e.hasSubTree}function kn(e,t){for(var i="Bezier"===e.type?function(e){var t=[];if("Bezier"===e.type)for(var i=0,r=0;r<e.segments.length;r++)for(var o=e.segments[r],n=a.isEmptyPoint(o.point1)?o.bezierPoint1:o.point1,s=a.isEmptyPoint(o.point2)?o.bezierPoint2:o.point2,h=Number((e.distance(n,o.points[0])+e.distance(s,n)+e.distance(o.points[1],s))/1.5),d=0;d<h-1;d+=10)t[i]=ur(0,o.points[0],a.isEmptyPoint(o.point1)?o.bezierPoint1:o.point1,a.isEmptyPoint(o.point2)?o.bezierPoint2:o.point2,o.points[1],d,h),i++;return t}(e):e.intermediatePoints,r=0;r<i.length-1;r++){var o=i[r],n=i[r+1],s=b.toBounds([o,n]);if(s.Inflate(e.hitPadding),s.containsPoint(t)){var h=Dn(t,o,n),d=Rn({x1:o.x,x2:n.x,y1:o.y,y2:n.y},{x1:t.x,x2:h.x,y1:t.y,y2:h.y});if(d.enabled){var l=a.findLength(t,d.intersectPt);if(Math.abs(l)<e.hitPadding)return!0}else{var c=b.toBounds([t,t]);if(c.Inflate(3),c.containsPoint(o)||c.containsPoint(n))return!0}if(a.equals(t,h))return!0}}if(e.annotations.length>0){var p=e.wrapper.children;for(r=3;r<p.length;r++){if(p[r].bounds.containsPoint(t))return!0}}return!1}function Rn(e,t){var i={x:0,y:0},r=e,o=t,n=(o.y2-o.y1)*(r.x2-r.x1)-(o.x2-o.x1)*(r.y2-r.y1),a=(o.x2-o.x1)*(r.y1-o.y1)-(o.y2-o.y1)*(r.x1-o.x1),s=(r.x2-r.x1)*(r.y1-o.y1)-(r.y2-r.y1)*(r.x1-o.x1);if(0===n||(e.x1===t.x1||e.y1===t.y1)&&(e.x2===t.x2||e.y2===t.y2)&&(0===a||0===s)&&n>0)return{enabled:!1,intersectPt:i};var h=a/n,d=s/n;return h>=0&&h<=1&&d>=0&&d<=1?(i.x=r.x1+h*(r.x2-r.x1),i.y=r.y1+h*(r.y2-r.y1),{enabled:!0,intersectPt:i}):{enabled:!1,intersectPt:i}}function Nn(e,t,i,r){var o=Rn(jn(e.x,e.y,t.x,t.y),jn(i.x,i.y,r.x,r.y));return o.enabled?o.intersectPt:{x:0,y:0}}function jn(e,t,i,r){return{x1:Number(e)||0,y1:Number(t)||0,x2:Number(i)||0,y2:Number(r)||0}}function Hn(e,t,i){var r=[];i=i||0;var o={x:t.topLeft.x-i,y:t.topLeft.y},n={x:t.topRight.x+i,y:t.topRight.y},a={x:t.bottomRight.x,y:t.bottomRight.y-i},s={x:t.bottomLeft.x,y:t.bottomLeft.y+i};return r.push(o),r.push(n),r.push(a),r.push(s),r}function Wn(t,i,r,o){var n=r instanceof js?r.constraints&e.NodeConstraints.InheritTooltip:r.constraints&e.ConnectorConstraints.InheritTooltip,a=r instanceof js?r.constraints&e.NodeConstraints.Tooltip:r.constraints&e.ConnectorConstraints.Tooltip,s="Mouse"===(!n&&a?r.tooltip.relativeMode:t.tooltip.relativeMode);"Mouse"===o?s=!0:"Object"===o&&(s=!1);var h=function(e,t,i,r){var o={},n=document.getElementById(i.element.id),a=e.wrapper.bounds,s=n.getBoundingClientRect();switch(i.tooltipObject.position){case"BottomCenter":o=_n(t,a.bottomCenter,i,r,s.width/2,s.height);break;case"BottomLeft":case"LeftBottom":o=_n(t,a.bottomLeft,i,r,0,s.height);break;case"BottomRight":case"RightBottom":o=_n(t,a.bottomRight,i,r,s.width,s.height);break;case"LeftCenter":o=_n(t,a.middleLeft,i,r,0,s.height/2);break;case"LeftTop":case"TopLeft":o=_n(t,a.topLeft,i,r,0,0);break;case"RightCenter":o=_n(t,a.middleRight,i,r,s.width,s.height/2);break;case"RightTop":case"TopRight":o=_n(t,a.topRight,i,r,s.width,0);break;case"TopCenter":o=_n(t,a.topCenter,i,r,s.width/2,0)}return o}(r,i,t,s),d=zr(t);return{x:h.x+d.width,y:h.y+d.height}}function _n(e,t,i,r,o,n){var a={},s=i.scroller.transform.scale,h=i.scroller.horizontalOffset,d=i.scroller.verticalOffset;return a.x=(r?e.x:t.x)*s+h-o,a.y=(r?e.y:t.y)*s+d-n,a}function Vn(e,t){var i=new Me;return i.data=e.pathData,i.height=e.height>10?e.height-(e.padding.bottom+e.padding.top):e.height,i.width=e.width>10?e.width-(e.padding.left+e.padding.right):e.width,i.visible=t.visible,i.id=t.id+"_shape",i.inversedAlignment=!1,i.horizontalAlignment="Center",i.verticalAlignment="Center",i.style={fill:e.iconStrokeColor,strokeColor:e.iconStrokeColor,strokeWidth:e.iconStrokeWidth},i.setOffsetWithRespectToBounds(.5,.5,"Fraction"),i.relativeMode="Object",i.description=t.description||"",i}function Xn(e,t){var i,r=0,o=0;for(r=0;r<e.length;r++){var n=Th(e[r].wrapper);for(o=0;o<e.length;o++){var a=Th(e[o].wrapper);"Top"===t||"Bottom"===t||"BottomToTop"===t||"Middle"===t?n.center.y>a.center.y&&(i=e[r],e[r]=e[o],e[o]=i):n.center.x>a.center.x&&(i=e[r],e[r]=e[o],e[o]=i)}}return e}function Yn(e,t,i){var r=Un(e,t),o=a.findAngle(e[r.index],e[r.index+1]),n=Gn(t),s=a.transform(r.point,o+45,n);return r.point=s,r.angle=o,r}function Un(e,t){for(var i,r,o,n,s=0,h=t.offset,d=[],l=0;l<e.length-1;l++)s+=a.distancePoints(e[l],e[l+1]),d.push(s);for(var c=h*s,p=0;p<d.length;p++){if(d[p]>=c)return r=a.findAngle(e[p],e[p+1]),{point:i=a.transform(e[p],r,c-(o||0)),index:n=p};o=d[p]}return{point:i,index:n}}function Gn(e){var t;t=e instanceof qi?0:void 0===e.content?10:0;var i=0;switch(e.alignment){case"Center":i=0;break;case"Before":i=-(0+t);break;case"After":i=0+t}return i}function Fn(e,t,i){t%=360;var r,o;switch(e.alignment){case"Before":t>=45&&t<=135?(o="right",r=.5===e.offset?"center":"top"):t>=225&&t<=315?(o="left",r=.5===e.offset?"center":"bottom"):t>45&&t<225?(r="top",o=.5===e.offset?"center":"right"):(r="bottom",o=.5===e.offset?"center":"left");break;case"After":t>=45&&t<=135?(o="left",r=.5===e.offset?"center":"top"):t>=225&&t<=315?(o="right",r=.5===e.offset?"center":"bottom"):t>45&&t<225?(r="bottom",o=.5===e.offset?"center":"right"):(r="top",o=.5===e.offset?"center":"left");break;case"Center":o="center",r="center"}if(0===e.offset||1===e.offset)switch(Zn(i[0],i[1])){case"left":o=0===e.offset?"right":"left";break;case"right":o=0===e.offset?"left":"right";break;case"bottom":r=0===e.offset?"top":"bottom";break;case"top":r=0===e.offset?"bottom":"top"}return{hAlign:o,vAlign:r}}function Zn(e,t){return Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?e.x<t.x?"right":"left":e.y<t.y?"bottom":"top"}function qn(e,t){if(e instanceof js&&e.children)for(var i=0;i<e.children.length;i++)t.nameTable[e.children[i]].children&&qn(e,t),t.removeFromAQuad(t.nameTable[e.children[i]]),t.removeObjectsFromLayer(t.nameTable[e.children[i]]),delete t.nameTable[e.children[i]]}function Kn(e,t){if(e&&e.children&&e.children.length>0)for(var i=0;i<e.children.length;i++){var r=e.children[i];r instanceof Te&&Kn(r,t)}return-1===t.indexOf(e.id)&&t.push(e.id),t}function Qn(e){var t=function(e){for(var t,i,r=[],o=0;o<e.length;o++)if("SwimLane"===(t=e[o]).shape.type){i=t.wrapper.children[0].childTable;for(var n=0,a=Object.keys(i);n<a.length;n++){r=Kn(i[a[n]],r)}}return r}(e.nodes),i=Ah(e,e.getCustomProperty);return i.selectedItems.nodes=[],i.selectedItems.connectors=[],i.selectedItems.wrapper=null,e.serializationSettings.preventDefaults&&(i=Jn(i,e)),function(e,t){var i=t.nodes;if(i)for(var r=0;r<i.length;r++)-1!==e.indexOf(i[r].id)&&(i.splice(r,1),r--)}(t,i),JSON.stringify(i)}function Jn(e,t,i,r){i=function(e,t){var i,r=[],o=new El;if(e.getClassName)switch(e.getClassName()){case"Diagram":i=new El;break;case"Node":i=new js(o,"",r);break;case"Path":i=new cs(o,"",r);break;case"Native":i=new ps(o,"",r);break;case"Html":i=new gs(o,"",r);break;case"Image":i=new us(o,"",r);break;case"Text":i=new fs(o,"",r);break;case"BasicShape":i=new ms(o,"",r);break;case"FlowShape":i=new ys(o,"",r);break;case"BpmnShape":i=new zs(o,"",r);break;case"UmlActivityShape":i=new Os(o,"",r);break;case"UmlClassifierShape":i=new Rs(o,"",r);break;case"SwimLane":i=new Vs(o,"",r),e.header&&(i.header=new Hs(o,"",r),i.header.style.fill="");break;case"ShapeAnnotation":i=new Fe(o,"",r);break;case"PointPort":i=new Ve(o,"",r);break;case"BpmnGateway":i=new vs(o,"",r);break;case"BpmnDataObject":i=new bs(o,"",r);break;case"BpmnEvent":i=new xs(o,"",r);break;case"BpmnSubEvent":i=new Cs(o,"",r);break;case"BpmnActivity":i=new Ts(o,"",r);break;case"BpmnAnnotation":i=new As(o,"",r);break;case"MethodArguments":i=new Is(o,"",r);break;case"UmlClassAttribute":i=new Ds(o,"",r);break;case"UmlClassMethod":i=new Es(o,"",r);break;case"UmlClass":i=new Bs(o,"",r);break;case"UmlInterface":i=new Ls(o,"",r);break;case"UmlEnumerationMember":i=new Ms(o,"",r);break;case"UmlEnumeration":i=new ks(o,"",r);break;case"Lane":i=new Ws(o,"",r);break;case"Phase":i=new _s(o,"",r);break;case"ChildContainer":i=new Xs;break;case"Connector":i=new wr(o,"",r);break;case"StraightSegment":i=new ar(o,"",r);break;case"BezierSegment":i=new sr(o,"",r);break;case"OrthogonalSegment":i=new hr(o,"",r);break;case"PathAnnotation":i=new Ze(o,"",r);break;case"Stop":i=new se(o,"",r);break;case"Point":i=t||new a(o,"",r);break;case"UserHandle":i=new so(o,"",r);break;case"Command":i=new mo(o,"",r)}else i=t;return i}(t,i);for(var o=[],n=0,s=o=o.concat(Object.keys(e));n<s.length;n++){var h=s[n];t instanceof js&&(r="shape"===h),e[h]instanceof Array?$n(e,i,t,h):e[h]instanceof Object&&i&&i[h]?"wrapper"!==h&&(e[h]=Jn(e[h],t[h],i[h],r)):(i&&e[h]===i[h]||void 0===e[h])&&(r&&"type"===h||t instanceof Vs&&"orientation"===h||delete e[h]),"[]"!==JSON.stringify(e[h])&&"{}"!==JSON.stringify(e[h])&&void 0!==e[h]||delete e[h]}return e}function $n(e,t,i,r){if(0===e[r].length)delete e[r];else if(e[r].every((function(e){return"number"==typeof e}))){var o=void 0,n=!0;for(o=0;o<e[r].length;o++)n=!(!n||e[r][o]!==t[r][o]);n&&delete e[r]}else{o=void 0;if("layers"===r&&(e[r].splice(0,1),0===e[r].length&&delete e[r]),e[r])for(o=e[r].length-1;o>=0;o--)"nodes"!==r&&"connectors"!==r||(e[r][o].wrapper=null),"dataManager"!==r&&(e[r][o]=Jn(e[r][o],i[r][o],void 0!==t[r]?t[r][o]:[]),"[]"!==JSON.stringify(e[r][o])&&"{}"!==JSON.stringify(e[r][o])&&void 0!==e[r][o]||e[r].splice(o,1))}}function ea(t,i){i.enableServerDataBinding(!1);var r=i.blazorActions;i.blazorActions=i.addConstraints(r,e.BlazorAction.ClearObject),i.clear(),i.blazorActions=i.removeConstraints(r,e.BlazorAction.ClearObject),i.protectPropertyChange(!0);for(var o=i.dataSourceSettings.doBinding,n=i.setNodeTemplate,a=i.getDescription,s=i.getCustomProperty,h={},d=0,l=i.commandManager.commands;d<l.length;d++){var c=l[d];h[c.name]={execute:c.execute,canExecute:c.canExecute}}var p,g=i.rulerSettings.horizontalRuler.arrangeTick,u=i.rulerSettings.verticalRuler.arrangeTick,f=i.layout.getLayoutInfo,m=i.layout.getBranch,y=i.getNodeDefaults,v=i.getConnectorDefaults,b=JSON.parse(t);b=ta(b),i.contextMenuSettings=b.contextMenuSettings||{},i.constraints=b.constraints||e.DiagramConstraints.Default,i.tool=b.tool||e.DiagramTools.Default,i.bridgeDirection=b.bridgeDirection||"Top",i.pageSettings=b.pageSettings||{},i.drawingObject=b.drawingObject||void 0,i.tooltip=b.tooltip||{},i.addInfo=b.addInfo||void 0,i.getDescription=a,i.scrollSettings=b.scrollSettings||{},i.commandManager=b.commandManager||{},i.layers=b.layers||[],i.rulerSettings.horizontalRuler.arrangeTick=g,i.rulerSettings.verticalRuler.arrangeTick=u;for(var w=0,x=i.commandManager.commands;w<x.length;w++){var C=x[w];h[C.name]&&(C.execute=h[C.name].execute,C.canExecute=h[C.name].canExecute)}if(i.backgroundColor=b.backgroundColor||"transparent",i.basicElements=b.basicElements||[],i.connectors=b.connectors||[],i.dataSourceSettings=b.dataSourceSettings||{},i.dataSourceSettings.doBinding=o,i.height=b.height||"100%",i.setNodeTemplate=n,i.getConnectorDefaults=v,i.getNodeDefaults=y,i.getCustomProperty=s,i.mode=b.mode||"SVG",b.nodes)for(var S=0;S<b.nodes.length;S++)b.nodes[S].shape&&"SwimLane"===b.nodes[S].shape.type&&(null==b.nodes[S].wrapper&&(b.nodes[S].wrapper={actualSize:{width:b.nodes[S].width,height:b.nodes[S].height},offsetX:b.nodes[S].offsetX,offsetY:b.nodes[S].offsetY}),cn(b.nodes[S],void 0,void 0,void 0,void 0,!0));i.nodes=b.nodes||[],i.rulerSettings=b.rulerSettings||{},i.snapSettings=b.snapSettings||{},i.width=b.width||"100%",i.layout=b.layout||{},i.layout.getLayoutInfo=Wh(f),i.layout.getBranch=Wh(m),i.diagramActions=0,i.isLoading=!0,i.protectPropertyChange(!1);for(S=0;S<i.views.length;S++)p=i.views[i.views[S]],i.blazorActions=i.addConstraints(r,e.BlazorAction.ClearObject),p.refresh(),i.blazorActions=i.removeConstraints(r,e.BlazorAction.ClearObject),p instanceof El&&i.element.classList.add("e-diagram");return b.selectedItems&&(b.selectedItems.nodes=[],b.selectedItems.connectors=[]),i.selectedItems=b.selectedItems,i.enableServerDataBinding(!0),b}function ta(t){if(t&&(void 0===t.version||t.version<17.1)&&t.nodes)for(var i=0,r=t.nodes;i<r.length;i++){var o=r[i];if(o&&o.ports&&o.ports.length>0)for(var n=0,a=o.ports;n<a.length;n++){var s=a[n];s&&s.constraints&&s.constraints===e.PortConstraints.None&&(s.constraints=e.PortConstraints.Default)}}return t}function ia(e,t){var i=t.style,r=t;t.canApplyStyle=!0;for(var o=0,n=Object.keys(e);o<n.length;o++){switch(n[o]){case"fill":i.fill=e.fill,i instanceof ge&&(i.fill="transparent");break;case"textOverflow":i.textOverflow=e.textOverflow;break;case"opacity":i.opacity=e.opacity;break;case"strokeColor":i.strokeColor=e.strokeColor;break;case"strokeDashArray":i.strokeDashArray=e.strokeDashArray;break;case"strokeWidth":i.strokeWidth=e.strokeWidth;break;case"bold":i.bold=e.bold;break;case"color":i.color=e.color;break;case"textWrapping":i.textWrapping=e.textWrapping;break;case"fontFamily":i.fontFamily=e.fontFamily;break;case"fontSize":i.fontSize=e.fontSize;break;case"italic":i.italic=e.italic;break;case"textAlign":i.textAlign=e.textAlign;break;case"whiteSpace":i.whiteSpace=e.whiteSpace;break;case"textDecoration":i.textDecoration=e.textDecoration;break;case"gradient":if(i.gradient){ra(e.gradient,i.gradient);break}}}t instanceof Se&&r.refreshTextElement()}function ra(e,t){for(var i=0,r=Object.keys(e);i<r.length;i++){switch(r[i]){case"type":t.type=e.type;break;case"x1":t.x1=e.x1;break;case"x2":t.x2=e.x2;break;case"y1":t.y1=e.y1;break;case"y2":t.y2=e.y2;break;case"cx":t.cx=e.cx;break;case"cy":t.cy=e.cy;break;case"fx":t.fx=e.fx;break;case"fy":t.fy=e.fy;break;case"r":t.r=e.r;break;case"stops":t.stops=e.stops}}}function oa(e,t,i){for(var r=t,o=r.hyperlink,n=0,a=Object.keys(e);n<a.length;n++){switch(a[n]){case"color":r.style.color=o.color=e.color;break;case"content":r.content=o.content=e.content||o.link;break;case"link":var s=i.style;r.style.color=e.link?o.color:s.color,r.style.textDecoration=e.link?o.textDecoration:i.style.textDecoration,r.content=e.link?o.content||e.link:i.content,o.link=e.link;break;case"textDecoration":r.style.textDecoration=o.textDecoration=e.textDecoration}}}function na(e,t,i){e.width=t.width,e.height=t.height,e.minHeight=t.minHeight,e.maxHeight=t.maxHeight,e.minWidth=t.minWidth,e.maxWidth=t.maxWidth,e.horizontalAlignment=t.wrapper.children[0].horizontalAlignment,e.verticalAlignment=t.wrapper.children[0].verticalAlignment,e.relativeMode=t.wrapper.children[0].relativeMode,e.visible=t.wrapper.children[0].visible,t.shape instanceof fs&&(e.margin=t.shape.margin),e.id=t.wrapper.children[0].id,e.style=t.style;for(var r=0,o=i.views;r<o.length;r++){var n=o[r];gh(t.id+"_groupElement",n),gh(t.id+"_content_groupElement",n),gh(t.id+"_html_element",n)}t.wrapper.children.splice(0,1),t.wrapper.children.splice(0,0,e)}function aa(e,t,i,r){var o=new be;switch(e.shape.type){case"Path":var n=new Me;n.data=t.shape.data,na(o=n,t,r);break;case"Image":var a=new Re;a.source=t.shape.source,a.imageAlign=t.shape.align,a.imageScale=t.shape.scale,na(o=a,t,r);break;case"Text":na(o=new Se,t,r);break;case"Basic":var s=(sf.base.isBlazor()?"Rectangle"===t.shape.basicShape:"Rectangle"===t.shape.shape)?new be:new Me;!sf.base.isBlazor()&&"Polygon"===t.shape.shape||sf.base.isBlazor()&&"Polygon"===t.shape.basicShape?s.data=l(t.shape.points):s.data=Ae(sf.base.isBlazor()?t.shape.basicShape:t.shape.shape),na(o,t,r),(!sf.base.isBlazor()&&"Rectangle"===t.shape.shape||sf.base.isBlazor()&&"Rectangle"===t.shape.basicShape)&&(s.cornerRadius=t.shape.cornerRadius),o=s;break;case"Flow":var h=new Me,d=sf.base.isBlazor()?t.shape.flowShape:t.shape.shape;h.data=et(d),na(o=h,t,r);break;case"Native":var c=new je(e.id,r.element.id);c.content=t.shape.content,c.scale=t.shape.scale,na(o=c,t,r);break;case"HTML":var p=new Yi(t.id,r.element.id);p.content=t.shape.content,na(o=p,t,r)}void 0===e.shape.type||e.shape.type===i.shape.type||sf.base.isBlazor()&&"UmlActivity"===e.shape.type?sa(e,t,r,i):(o.width=t.wrapper.children[0].width,o.height=t.wrapper.children[0].height,t.shape instanceof fs&&(o.margin=t.shape.margin),o.style=t.style,t.wrapper.children[0]=o)}function sa(e,t,i,r){if(Object.keys(e.shape).length>0)if("Path"===t.shape.type&&void 0!==e.shape.data)t.wrapper.children[0].data=e.shape.data;else if("Text"===t.shape.type&&void 0!==e.shape.content)t.wrapper.children[0].content=e.shape.content;else if("Image"===t.shape.type&&void 0!==e.shape.source)t.wrapper.children[0].source=e.shape.source;else if("Native"===t.shape.type){for(var o=void 0,n=0;n<i.views.length;n++)o=Ks(t.wrapper.children[0].id+"_native_element",i.views[n]),void 0!==e.shape.content&&o&&(o.removeChild(o.children[0]),t.wrapper.children[0].content=e.shape.content,o.appendChild(uh(t.wrapper.children[0],!1)));t.wrapper.children[0].scale=e.shape.scale?e.shape.scale:t.wrapper.children[0].scale}else if("HTML"===t.shape.type){var a=void 0;for(n=0;n<i.views.length;n++)(a=Ks(t.wrapper.children[0].id+"_html_element",i.views[n]))&&(a.removeChild(a.children[0]),t.wrapper.children[0].content=e.shape.content,a.appendChild(uh(t.wrapper.children[0],!0)))}else if("Flow"===t.shape.type&&(sf.base.isBlazor()&&void 0!==e.shape.flowShape||void 0!==e.shape.shape)){t.shape.shape=sf.base.isBlazor()?e.shape.flowShape:e.shape.shape;var s=et(t.shape.shape.toString());t.wrapper.children[0].data=s}else if("UmlActivity"===t.shape.type&&(sf.base.isBlazor()&&void 0!==e.shape.umlActivityShape||!sf.base.isBlazor()&&void 0!==e.shape.shape))ha(t,e);else if(void 0!==e.shape.cornerRadius)t.wrapper.children[0].cornerRadius=e.shape.cornerRadius;else if("Basic"===t.shape.type&&r&&"Rectangle"===r.shape.shape){var h=new Me,d=Ae(sf.base.isBlazor()?t.shape.basicShape:t.shape.shape);h.data=d,na(h,t,i)}else if(sf.base.isBlazor()&&void 0!==e.shape.basicShape||void 0!==e.shape.shape){t.shape.shape=sf.base.isBlazor()?e.shape.basicShape:e.shape.shape;var l=Ae(t.shape.shape.toString());t.wrapper.children[0].data=l}t.wrapper.children[0].canMeasurePath=!0}function ha(e,t){sf.base.isBlazor()?e.shape.umlActivityShape=t.shape.umlActivityShape:e.shape.shape=t.shape.shape;var i=ho((sf.base.isBlazor()?e.shape.umlActivityShape:e.shape.shape).toString());sf.base.isBlazor()&&"InitialNode"===e.shape.umlActivityShape||!sf.base.isBlazor()&&"InitialNode"===e.shape.shape||!sf.base.isBlazor()&&("ForkNode"===e.shape.shape||"JoinNode"===e.shape.shape)||sf.base.isBlazor()&&("ForkNode"===e.shape.umlActivityShape||"JoinNode"===e.shape.umlActivityShape)?e.wrapper.children[0].style.fill="black":(!sf.base.isBlazor()&&"FinalNode"===e.shape.shape||sf.base.isBlazor()&&"FinalNode"===e.shape.umlActivityShape)&&e instanceof js&&(e.wrapper=da(e)),i&&(e.wrapper.children[0].data=i)}function da(e){var t=new Te;t.style.fill="transparent";var i="M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50",r=new Me;r.data=i,r.id=e.id+"_0_finalNode",r.horizontalAlignment="Center",r.verticalAlignment="Center",r.relativeMode="Object",r.style.strokeColor=e.style.strokeColor,r.style.strokeWidth=e.style.strokeWidth;var o=new Me;return o.data=i,o.id=e.id+"_1_finalNode",o.horizontalAlignment="Center",o.verticalAlignment="Center",o.relativeMode="Object",o.style.fill=e.style.fill,o.style.strokeColor=e.style.strokeColor,o.style.strokeWidth=e.style.strokeWidth,t.children=[r,o],t.children[0].width=e.width,t.children[0].height=e.height,t.children[1].height=e.height/1.5,t.children[1].width=e.width/1.5,t.style.strokeWidth=0,t.style.strokeColor="transparent",t}function la(e,t,i){var r=sf.base.isBlazor()?i.shape.umlActivityShape:i.shape.shape,o=ho(r);switch(e.data=o,t=e,r){case"StructuredNode":if(i.annotations)for(var n=0;n<i.annotations.length;n++)i.annotations[n].content="<<"+i.annotations[n].content+">>";t=e;break;case"FinalNode":t=da(i)}return t}function ca(e){gh(e+"_linear"),gh(e+"_radial")}function pa(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)}function ga(e,t,i){var r;e.intermediatePoints=t,e.updateSegmentElement(e,t,e.wrapper.children[0],i);var o=e.sourceDecorator;if("Bezier"===e.type){var n=e.segments[0],s=e.segments[e.segments.length-1];r=[a.isEmptyPoint(s.point2)?s.bezierPoint2:s.point2,a.isEmptyPoint(n.point1)?n.bezierPoint1:n.point1]}else r=e.intermediatePoints;t=e.clipDecorators(e,t,i);var h=e.wrapper.children[0];h.canMeasurePath=!0,h=e.wrapper.children[1],e.updateDecoratorElement(h,t[0],r[1],o);var d=e.targetDecorator;h=e.wrapper.children[2],e.updateDecoratorElement(h,t[t.length-1],r[r.length-2],d),e.updateShapeElement(e)}function ua(e,t,i){var r,o=e.wrapper,n=o.bounds,a=t.offset,s=t.size/i.scale,h=t.margin,d=o.offsetX-o.actualSize.width*o.pivot.x,l=o.offsetY-o.actualSize.height*o.pivot.y;if(r={x:0,y:0},e.nodes.length>0){switch(t.side){case"Top":r.x+=d+n.width*a,r.y+=l-(s/2+12.5);break;case"Bottom":r.x+=d+a*n.width,r.y+=l+o.actualSize.height+(s/2+12.5);break;case"Left":r.x+=d-(s/2+12.5),r.y+=l+a*n.height;break;case"Right":r.x+=d+o.actualSize.width+(s/2+12.5),r.y+=l+a*n.height}r.x+=(h.left-h.right)/i.scale+s/2*("Center"===t.horizontalAlignment?0:"Right"===t.horizontalAlignment?-1:1),r.y+=(h.top-h.bottom)/i.scale+s/2*("Center"===t.verticalAlignment?0:"Top"===t.verticalAlignment?-1:1)}else if(e.connectors.length>0){var c=e.connectors[0],p={offset:a},g=Un(c.intermediatePoints,p),u=g.index;r=g.point;var f,m=Yn(c.intermediatePoints,p).angle;P(f=x(),-m,c.intermediatePoints[u].x,c.intermediatePoints[u].y),(r=C(f,r)).x+=h.left-h.right+s/2*("Center"===t.horizontalAlignment?0:"Right"===t.horizontalAlignment?-1:1),r.y+=h.top-h.bottom+s/2*("Center"===t.verticalAlignment?0:"Top"===t.verticalAlignment?-1:1),P(f=x(),m,c.intermediatePoints[u].x,c.intermediatePoints[u].y),r=C(f,r)}0===o.rotateAngle&&0===o.parentTransform||(P(f=x(),o.rotateAngle+o.parentTransform,o.offsetX,o.offsetY),r=C(f,r));return r}function fa(t,i,r,o){if(o.annotation){if(Vr(o.annotation))return!0}else if(e.SelectorConstraints[i]&t&&e.ThumbsConstraints[i]&r)return!0;return!1}function ma(t,i){return!!(e.SelectorConstraints[i]&t)}function ya(e,t){return e.visibility&t}function va(e,t){var i;if("Text"===e.shape.type)i=e.shape;else{var r=t.split("_");t=r[r.length-1];for(var o=0;o<e.annotations.length;o++)t===e.annotations[o].id&&(i=e.annotations[o])}return i}function ba(e,t){var i=t.split("_");if(t=i[i.length-1],e){e=e;for(var r=0;r<e.ports.length;r++)if(t===e.ports[r].id)return e.ports[r]}}function wa(t,i){var r={},o=0;if(t.ports){var n=t.ports;for(o=0;o<n.length;o++)i?n[o].constraints&e.PortConstraints.InConnect&&(r=n[o]):n[o].constraints&e.PortConstraints.OutConnect&&(r=n[o])}return r}function xa(e,t,i){for(var r=i?e.annotations:e.ports,o=0;o<r.length;o++)if(r[o].id===t)return o.toString();return"-1"}function Ca(e,t){var i;for(i=0;i<e.length;i++)if(t===e[i].id)return!0;return!1}function Sa(e,t,i,r){if(void 0!==e.width&&void 0!==e.height&&(e.width*=t,e.height*=i),e instanceof xe){var o=x(),n=r.width||r.actualSize.width,a=r.height||r.actualSize.height;if(void 0!==n&&void 0!==a){var s=r.offsetX-n*r.pivot.x,h=r.offsetY-a*r.pivot.y,d={x:s+n*r.pivot.x,y:h+a*r.pivot.y};d=jh(r.rotateAngle,r.offsetX,r.offsetY,d),P(o,-r.rotateAngle,d.x,d.y),T(o,t,i,d.x,d.y),P(o,r.rotateAngle,d.x,d.y);for(var l=0,c=e.children;l<c.length;l++){var p=c[l];if(void 0!==p.width&&void 0!==p.height){var g=C(o,{x:p.offsetX,y:p.offsetY});p.offsetX=g.x,p.offsetY=g.y,Sa(p,t,i,r)}}}}}function Pa(e,t,r,o,n,a){for(var s,h=e.children,d=0;d<h.length;d++)if(s=o[h[d]])if(s.children)Pa(s,t,r,o,n,a);else if(s.offsetX-=t,s.offsetY-=r,!n){o[s.id]=s;var l=s.initContainer();l.children||(l.children=[]);var c=s.init(a);l.children.push(c),l.measure(new i(s.width,s.height)),l.arrange(l.desiredSize)}}function Ta(e,t,i){if(0===i.length)i.push(e);else if(1===i.length)i[0][t]>e[t]?i.splice(0,0,e):i.push(e);else if(i.length>1){for(var r=0,o=i.length-1,n=Math.floor((r+o)/2);n!==r;)if(i[n][t]<e[t])r=n,n=Math.floor((r+o)/2);else{if(!(i[n][t]>e[t]))break;o=n,n=Math.floor((r+o)/2)}i[o][t]<e[t]?i.push(e):i[r][t]>e[t]?i.splice(r,0,e):i[r][t]<e[t]&&i[o][t]>e[t]&&i.splice(o,0,e)}}function Aa(e){var t=document.getElementById(e.diagramId),i="ej2_instances",r=t[i][0].nodes;void 0===r&&(r=function(e){for(var t=[],i=0;i<e.palettes.length;i++)for(var r=e.palettes[i].symbols,o=0;o<r.length;o++)r[o]instanceof js&&t.push(r[o]);return t}(t[i][0]));for(var o=0;r&&o<r.length;o++)if(r[o].id===e.nodeId)return za(r[o],e);var n=t[i][0].connectors;for(o=0;n&&o<n.length;o++)if(n[o].id===e.nodeId)return za(n[o],e);var a=t[i][0].enterObject;return a&&(a.id===e.nodeId||a.children)?a.children&&Bn(a,"HTML",t[i][0].enterTable)?t[i][0].enterTable[e.nodeId]:a:null}function za(e,t){var i,r=e.annotations;for(i=0;r&&i<r.length;i++)if(t.annotationId&&r[i].id===t.annotationId)return r[i];return e}function Oa(e,t,i,r){return sf.base.isBlazor()&&(e={cause:e.cause,state:i,type:r,cancel:!1,element:Ea(t)===wr?{connector:_a(t)}:{node:_a(t)}}),e}function Ia(e,t){if(sf.base.isBlazor()){var i=Ea(e.source)===wr,r=_a(e.source),o=_a(e.target);t={element:i?{connector:r.connectors[0],connectorId:r.connectors[0].id}:{node:r.nodes[0],nodeId:r.nodes[0].id},target:i?{connector:o}:{node:o},position:t.position,cancel:t.cancel}}return t}function Da(e,t,i,r,o,n,a,s){var h={x:0,y:0},d=x();switch(P(d,o,n,a),s.x){case 0:switch(s.y){case 0:h=C(d,{x:e,y:t});break;case.5:h=C(d,{x:e,y:t+r/2});break;case 1:h=C(d,{x:e,y:t+r})}break;case.5:switch(s.y){case 0:h=C(d,{x:e+i/2,y:t});break;case.5:h=C(d,{x:e+i/2,y:t+r/2});break;case 1:h=C(d,{x:e+i/2,y:t+r})}break;case 1:switch(s.y){case 0:h=C(d,{x:e+i,y:t});break;case.5:h=C(d,{x:e+i,y:t+r/2});break;case 1:h=C(d,{x:e+i,y:t+r})}}return{x:h.x,y:h.y}}var Ea=function(e){return e&&(e=void 0!==e.sourceID||void 0!==e.sourcePoint||void 0!==e.targetID||void 0!==e.targetPoint||void 0!==e.type?wr:js),e},Ba=function(e){if(!e.sourceID&&!e.targetID){var t={x:e.sourcePoint.x,y:e.sourcePoint.y},i={x:e.targetPoint.x,y:e.targetPoint.y};"Horizontal"===e.flip?(e.sourcePoint.x=i.x,e.targetPoint.x=t.x):"Vertical"===e.flip?(e.sourcePoint.y=i.y,e.targetPoint.y=t.y):"Both"===e.flip&&(e.sourcePoint=i,e.targetPoint=t)}},La=function(e,t,i){var r=i.offset.x,o=i.offset.y;return"Horizontal"===t?(r=1-i.offset.x,o=i.offset.y):"Vertical"===t?(r=i.offset.x,o=1-i.offset.y):"Both"===t&&(r=1-i.offset.x,o=1-i.offset.y),e.setOffsetWithRespectToBounds(r,o,"Fraction"),e},Ma=function e(t,r,o,n,a){if(t.hasChildren())for(var s=0,h=t.children;s<h.length;s++){var d=h[s],l=r-d.offsetX+r,c=o-d.offsetY+o;"Horizontal"!==a&&"Both"!==a||(d.offsetX=l,d.flipOffset.x=l-d.desiredSize.width/2),"Vertical"!==a&&"Both"!==a||(d.offsetY=c,d.flipOffset.y=c-d.desiredSize.height/2),(d instanceof Te||d instanceof xe)&&e(d,r,o,n,a),d.measure(new i(d.bounds.width,d.bounds.height)),d.arrange(d.desiredSize);var p=n.nameTable[d.id];p&&n.updateConnectorEdges(p)}},ka=function(e){var t=e.selectedItems.nodes,i=e.selectedItems.connectors,r=e.allowServerDataBinding,o=e.isProtectedOnChange;e.protectPropertyChange(!0),e.allowServerDataBinding=!1,e.selectedItems.nodes=[],e.selectedItems.connectors=[],e.allowServerDataBinding=r,e.protectPropertyChange(o);for(var n=Ah(e.selectedItems),a=0;a<t.length;a++)e.selectedItems.nodes.push(e.nameTable[t[a].id]);for(a=0;a<i.length;a++)e.selectedItems.connectors.push(e.nameTable[i[a].id]);return n},Ra=function(t,i){for(var r,o=new Me,n=0;n<t.length-1;n++)r=ja(t[n],t[n+1]),o.data=r[0],o.id=i.id+"_"+i.shape.sequence,o.offsetX=r[1].x,o.offsetY=r[1].y,o.rotateAngle=45,o.transform=e.Transform.Self;return o},Na=function(e,t){if(e instanceof js)for(var i=0;i<e.ports.length;i++)if(e.ports[i].id===t.id.split("_")[1])return!0;return!1},ja=function(e,t){var i={x:e.x,y:e.y},r=Wa(e,t);r=Math.min(30,r/2);var o=Tt(e,t),n=a.transform({x:i.x,y:i.y},o,r),s=a.transform({x:n.x,y:n.y},o,-12),h=a.transform({x:s.x,y:s.y},o,24);return["M"+s.x+" "+s.y+" L"+h.x+" "+h.y,n]},Ha=function(e,t){return Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?e.x<t.x?"Right":"Left":e.y<t.y?"Bottom":"Top"},Wa=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};function _a(e){return sf.base.isBlazor()&&(e=Ah(e)),e}function Va(){return(navigator.platform.indexOf("Mac")>=0||navigator.platform.indexOf("iPad")>=0||navigator.platform.indexOf("iPhone")>=0||navigator.platform.indexOf("MacIntel")>=0)&&("safari"===sf.base.Browser.info.name||"webkit"===sf.base.Browser.info.name)}function Xa(e){return-1!==e.indexOf("shape")||-1!==e.indexOf("pathData")||-1!==e.indexOf("width")||-1!==e.indexOf("height")}function Ya(e,t,r){var o=Ua(e,t,r,"width"),n=Ua(e,t,r,"height");return new i(o,n)}function Ua(e,t,i,r){return void 0!==t.previewSize[r]?t.previewSize[r]:void 0!==e.symbolPreview[r]?e.symbolPreview[r]:t[r]||i.actualSize[r]}var Ga,Fa,Za=(Ga=function(e,t){return(Ga=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ga(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),qa=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ka=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Za(t,e),qa([sf.base.Property("None")],t.prototype,"shape",void 0),qa([sf.base.Property("white")],t.prototype,"fill",void 0),qa([sf.base.Property("Auto")],t.prototype,"horizontalAlignment",void 0),qa([sf.base.Property("Auto")],t.prototype,"verticalAlignment",void 0),qa([sf.base.Property(10)],t.prototype,"width",void 0),qa([sf.base.Property(10)],t.prototype,"height",void 0),qa([sf.base.Complex({x:.5,y:1},a)],t.prototype,"offset",void 0),qa([sf.base.Property("#1a1a1a")],t.prototype,"borderColor",void 0),qa([sf.base.Property(1)],t.prototype,"borderWidth",void 0),qa([sf.base.Complex({},ne)],t.prototype,"margin",void 0),qa([sf.base.Property("")],t.prototype,"pathData",void 0),qa([sf.base.Property("")],t.prototype,"content",void 0),qa([sf.base.Property(0)],t.prototype,"cornerRadius",void 0),qa([sf.base.Complex({left:2,right:2,top:2,bottom:2},ne)],t.prototype,"padding",void 0),t}(sf.base.ChildProperty),Qa=(Fa=function(e,t){return(Fa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Fa(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ja=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.orientation="Vertical",t.measureChildren=void 0,t.considerPadding=!0,t}return Qa(t,e),t.prototype.measure=function(e){var t="Horizontal"===this.orientation?this.updateHorizontalStack:this.updateVerticalStack;return this.desiredSize=this.measureStackPanel(e,t),this.desiredSize},t.prototype.arrange=function(e){var t="Horizontal"===this.orientation?this.arrangeHorizontalStack:this.arrangeVerticalStack;return this.actualSize=this.arrangeStackPanel(e,t),this.updateBounds(),this.actualSize},t.prototype.measureStackPanel=function(t,i){var r=void 0;if(void 0!==this.children&&this.children.length>0)for(var o=0,n=this.children;o<n.length;o++){var a=n[o];a.parentTransform=this.rotateAngle+this.parentTransform,this.measureChildren?a.measure(a.desiredSize):a.measure(t);var s=a.desiredSize.clone();this.applyChildMargin(a,s),0!==a.rotateAngle&&(s=Nh(s,a.rotateAngle)),void 0===r?r=s:a.preventContainer||i(s,r)}return r=e.prototype.validateDesiredSize.call(this,r,t),this.stretchChildren(r),this.considerPadding&&this.applyPadding(r),r},t.prototype.arrangeStackPanel=function(t,i){if(void 0!==this.children&&this.children.length>0){var r=void 0,o=void 0;r=this.offsetX-t.width*this.pivot.x+this.padding.left,o=this.offsetY-t.height*this.pivot.y+this.padding.top;for(var n=0,a=this.children;n<a.length;n++){var s=a[n],h=s.desiredSize.clone(),d=h;"Vertical"===this.orientation?o+=s.margin.top:r+=s.margin.left,0!==s.rotateAngle&&(d=Nh(h,s.rotateAngle));var l=i(r,o,s,this,t,d);e.prototype.findChildOffsetFromCenter.call(this,s,l),s.arrange(h,!0),"Vertical"===this.orientation?o+=d.height+s.margin.bottom:r+=d.width+s.margin.right}}return t},t.prototype.updateHorizontalStack=function(e,t){t.height=Math.max(e.height,t.height),t.width+=e.width},t.prototype.updateVerticalStack=function(e,t){t.width=Math.max(e.width,t.width),t.height+=e.height},t.prototype.arrangeHorizontalStack=function(e,t,i,r,o,n){var a=0;if("Top"===i.verticalAlignment)a=t+i.margin.top+n.height/2;else if("Bottom"===i.verticalAlignment){a=r.offsetY+o.height*(1-r.pivot.y)-r.padding.bottom-i.margin.bottom-n.height/2}else a=r.offsetY-o.height*r.pivot.y+o.height/2,i.margin.top&&(a=t+i.margin.top+n.height/2);return{x:e+n.width/2,y:a}},t.prototype.arrangeVerticalStack=function(e,t,i,r,o,n){var a=0;if("Left"===i.horizontalAlignment)a=e+i.margin.left+n.width/2;else if("Right"===i.horizontalAlignment){a=r.offsetX+o.width*(1-r.pivot.x)-r.padding.right-i.margin.right-n.width/2}else a=r.offsetX-o.width*r.pivot.x+o.width/2,i.margin.left&&(a=e+i.margin.left+n.width/2);return{x:a,y:t+n.height/2}},t.prototype.stretchChildren=function(e){if(void 0!==this.children&&this.children.length>0)for(var t=0,i=this.children;t<i.length;t++){var r=i[t];"Vertical"===this.orientation?"Stretch"===r.horizontalAlignment&&(r.desiredSize.width=e.width-(r.margin.left+r.margin.right)):"Stretch"===r.verticalAlignment&&(r.desiredSize.height=e.height-(r.margin.top+r.margin.bottom))}},t.prototype.applyChildMargin=function(e,t){t.height+=e.margin.top+e.margin.bottom,t.width+=e.margin.left+e.margin.right},t}(xe);function $a(t,i,r){var o,n="NoWrap";"Class"===i.shape.classifier?o=i.shape.classShape:"Enumeration"===i.shape.classifier?o=i.shape.enumerationShape:"Interface"===i.shape.classifier&&(o=i.shape.interfaceShape),i.container={type:"Stack",orientation:"Vertical"},i.constraints=(e.NodeConstraints.Default|e.NodeConstraints.HideThumbs)&~(e.NodeConstraints.Rotate|e.NodeConstraints.Resize),i.style={fill:i.style.fill,strokeColor:i.style.strokeColor,strokeWidth:1.5},i.children=[],i.maxWidth&&(n="Wrap");var a=new js(r,"nodes",{id:i.id+"_umlClass_header",annotations:[{id:"name",content:o.name,offset:{x:.5,y:.65},margin:{left:10,right:10},style:{bold:!0,fontSize:14,color:o.style.color,fill:o.style.fill,textWrapping:n}},{content:"<<"+i.shape.classifier+">>",margin:{left:10,right:10},id:"class",style:{fontSize:o.style.fontSize,color:o.style.color,fill:o.style.fill,textWrapping:n},offset:{x:.5,y:.3},constraints:e.AnnotationConstraints.ReadOnly}],constraints:(e.NodeConstraints.Default|e.NodeConstraints.HideThumbs)&~(e.NodeConstraints.Rotate|e.NodeConstraints.Drag|e.NodeConstraints.Resize),verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:i.style.fill,strokeColor:"black"===i.style.strokeColor?"#ffffff00":i.style.strokeColor}},!0);return r.initObject(a),r.nodes.push(a),r.UpdateBlazorDiagramModel(a,"Node"),i.children.push(a.id),function(t,i,r,o){if("Enumeration"===t.shape.classifier){var n=r.members;if(n&&n.length){es(t,i);for(var a="",s=0;s<n.length;s++){var h=n[s];if(""!==h.name&&(a+=h.name),s!==n.length){var d=ts(t,h),l=new js(i,"nodes",{id:xh()+"_umlMember",annotations:[{id:"name",content:a,offset:{x:0,y:.5},style:{bold:!0,fontSize:d.fontSize,color:d.color,fill:d.fill,textWrapping:o},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:t.style.fill,strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor,textWrapping:o},constraints:(e.NodeConstraints.Default|e.NodeConstraints.HideThumbs)&~(e.NodeConstraints.Rotate|e.NodeConstraints.Drag|e.NodeConstraints.Resize),minHeight:25},!0);i.initObject(l),i.nodes.push(l),i.UpdateBlazorDiagramModel(l,"Node"),t.children.push(l.id),a="",h.isSeparator&&s!==n.length-1&&es(t,i)}}}}else{var c=r.attributes;if(c.length){var p="";es(t,i);for(s=0;s<c.length;s++){var g=void 0,u=c[s];if(g=u.scope&&"Public"===u.scope?" +":u.scope&&"Private"===u.scope?"-":u.scope&&"Protected"===u.scope?"#":"~",""!==u.name&&g&&(p+=g+" "+u.name+" : "+u.type),s!==c.length){d=ts(t,u),l=new js(i,"nodes",{id:xh()+"_umlProperty",style:{fill:t.style.fill,strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor},annotations:[{id:"name",content:p,offset:{x:0,y:.5},style:{bold:!0,fontSize:d.fontSize,color:d.color,fill:d.fill,textWrapping:o},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(e.NodeConstraints.Default|e.NodeConstraints.HideThumbs)&~(e.NodeConstraints.Rotate|e.NodeConstraints.Drag|e.NodeConstraints.Resize),minHeight:25},!0);i.initObject(l),i.nodes.push(l),i.UpdateBlazorDiagramModel(l,"Node"),t.children.push(l.id),p="",u.isSeparator&&s!==c.length-1&&es(t,i)}}}}}(i,r,o,n),function(t,i,r,o){if(r.methods&&r.methods.length){var n=r.methods;es(t,i);for(var a="",s="",h=void 0,d=0;d<n.length;d++){var l=n[d];if(h=l.scope&&"Public"===l.scope?" +":l.scope&&"Private"===l.scope?"-":l.scope&&"Protected"===l.scope?"#":"~",l.parameters)for(var c=0;c<l.parameters.length;c++)l.parameters[c].type?a+=l.parameters[c].name+":"+l.parameters[c].type:a+=l.parameters[c].name,c!==l.parameters.length-1&&(a+=",");if(""!==l.name&&h&&(s+=h+" "+l.name+"("+a+") : "+l.type),d!==n.length){var p=ts(t,l),g=new js(i,"nodes",{id:xh()+"_umlMethods",verticalAlignment:"Stretch",horizontalAlignment:"Stretch",annotations:[{id:"name",content:s,offset:{x:0,y:.5},style:{bold:!0,fontSize:p.fontSize,color:p.color,fill:p.fill,textWrapping:o},margin:{left:14,right:5},horizontalAlignment:"Left"}],style:{fill:t.style.fill,strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor},minHeight:25,constraints:(e.NodeConstraints.Default|e.NodeConstraints.HideThumbs)&~(e.NodeConstraints.Rotate|e.NodeConstraints.Drag|e.NodeConstraints.Resize)},!0);i.initObject(g),i.nodes.push(g),i.UpdateBlazorDiagramModel(g,"Node"),t.children.push(g.id),s="",l.isSeparator&&d!==n.length-1&&es(t,i)}}}}(i,r,o,n),i.offsetX=i.offsetX,i.offsetY=i.offsetY,i.style.fill=i.style.fill,i.borderColor=i.borderColor,r.initObject(i),t}function es(t,i){var r=new js(i,"nodes",{id:xh()+"_path",height:1,constraints:e.NodeConstraints.Default&~e.NodeConstraints.Select,verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor}},!0);i.initObject(r),i.nodes.push(r),t.children.push(r.id)}function ts(e,t){var i={},r=t.style;return i.fill="transparent"!==r.fill?r.fill:e.style.fill,i.color=r.color,i.fontSize=12!==r.fontSize?r.fontSize:e.style.fontSize,i.strokeColor="black"!==r.strokeColor?r.strokeColor:e.style.strokeColor,i.strokeWidth=1!==r.strokeWidth?r.strokeWidth:e.style.strokeWidth,i}var is,rs,os=(is=function(e,t){return(is=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}is(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ns=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},as=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return os(t,e),ns([sf.base.Property("Horizontal")],t.prototype,"orientation",void 0),ns([sf.base.Property("Center")],t.prototype,"type",void 0),ns([sf.base.Property(void 0)],t.prototype,"offset",void 0),ns([sf.base.Property(!1)],t.prototype,"enableRouting",void 0),ns([sf.base.Property([])],t.prototype,"children",void 0),ns([sf.base.Property("")],t.prototype,"assistants",void 0),ns([sf.base.Property("")],t.prototype,"level",void 0),ns([sf.base.Property("")],t.prototype,"hasSubTree",void 0),ns([sf.base.Property("")],t.prototype,"rows",void 0),t}(sf.base.ChildProperty),ss=(rs=function(e,t){return(rs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}rs(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),hs=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},ds=function(e){if(e){if(sf.base.isBlazor())return Ns;switch(e.type){case"Basic":return ms;case"Flow":return ys;case"Path":return cs;case"Image":return us;case"Text":return fs;case"Bpmn":return zs;case"Native":return ps;case"HTML":return gs;case"UmlActivity":return Os;case"UmlClassifier":return Rs;case"SwimLane":return Vs;default:return ms}}return sf.base.isBlazor()?Ns:ms},ls=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),hs([sf.base.Property("Basic")],t.prototype,"type",void 0),t}(sf.base.ChildProperty),cs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Path"},hs([sf.base.Property("Path")],t.prototype,"type",void 0),hs([sf.base.Property("")],t.prototype,"data",void 0),t}(ls),ps=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Native"},hs([sf.base.Property("Native")],t.prototype,"type",void 0),hs([sf.base.Property("")],t.prototype,"content",void 0),hs([sf.base.Property("Stretch")],t.prototype,"scale",void 0),t}(ls),gs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Html"},hs([sf.base.Property("HTML")],t.prototype,"type",void 0),hs([sf.base.Property("")],t.prototype,"content",void 0),t}(ls),us=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Image"},hs([sf.base.Property("Image")],t.prototype,"type",void 0),hs([sf.base.Property("")],t.prototype,"source",void 0),hs([sf.base.Property("None")],t.prototype,"scale",void 0),hs([sf.base.Property("None")],t.prototype,"align",void 0),t}(ls),fs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Text"},hs([sf.base.Property("Text")],t.prototype,"type",void 0),hs([sf.base.Property("")],t.prototype,"content",void 0),hs([sf.base.Complex({},ne)],t.prototype,"margin",void 0),t}(ls),ms=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BasicShape"},hs([sf.base.Property("Basic")],t.prototype,"type",void 0),hs([sf.base.Property("Rectangle")],t.prototype,"shape",void 0),hs([sf.base.Property(0)],t.prototype,"cornerRadius",void 0),hs([sf.base.Collection([],a)],t.prototype,"points",void 0),t}(ls),ys=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"FlowShape"},hs([sf.base.Property("Flow")],t.prototype,"type",void 0),hs([sf.base.Property("Terminator")],t.prototype,"shape",void 0),t}(ls),vs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnGateway"},hs([sf.base.Property("None")],t.prototype,"type",void 0),t}(sf.base.ChildProperty),bs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnDataObject"},hs([sf.base.Property("None")],t.prototype,"type",void 0),hs([sf.base.Property(!1)],t.prototype,"collection",void 0),t}(sf.base.ChildProperty),ws=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),hs([sf.base.Property("None")],t.prototype,"type",void 0),hs([sf.base.Property("None")],t.prototype,"loop",void 0),hs([sf.base.Property(!1)],t.prototype,"call",void 0),hs([sf.base.Property(!1)],t.prototype,"compensation",void 0),t}(sf.base.ChildProperty),xs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnEvent"},hs([sf.base.Property("Start")],t.prototype,"event",void 0),hs([sf.base.Property("None")],t.prototype,"trigger",void 0),t}(sf.base.ChildProperty),Cs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnSubEvent"},hs([sf.base.Property("None")],t.prototype,"trigger",void 0),hs([sf.base.Property("Start")],t.prototype,"event",void 0),hs([sf.base.Property("")],t.prototype,"id",void 0),hs([sf.base.Complex({},a)],t.prototype,"offset",void 0),hs([sf.base.Collection([],Fe)],t.prototype,"annotations",void 0),hs([sf.base.Collection([],Ve)],t.prototype,"ports",void 0),hs([sf.base.Property()],t.prototype,"width",void 0),hs([sf.base.Property()],t.prototype,"height",void 0),hs([sf.base.Complex({},ne)],t.prototype,"margin",void 0),hs([sf.base.Property("Center")],t.prototype,"horizontalAlignment",void 0),hs([sf.base.Property("Center")],t.prototype,"verticalAlignment",void 0),hs([sf.base.Property(!0)],t.prototype,"visible",void 0),t}(sf.base.ChildProperty),Ss=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),hs([sf.base.Complex({id:"success",event:"End",offset:{x:1,y:.5}},Cs)],t.prototype,"success",void 0),hs([sf.base.Complex({id:"failure",event:"Intermediate",trigger:"Error",offset:{x:.25,y:1}},Cs)],t.prototype,"failure",void 0),hs([sf.base.Complex({id:"cancel",event:"Intermediate",trigger:"Cancel",offset:{x:.75,y:1}},Cs)],t.prototype,"cancel",void 0),t}(sf.base.ChildProperty),Ps=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),hs([sf.base.Property("None")],t.prototype,"type",void 0),hs([sf.base.Property(!1)],t.prototype,"adhoc",void 0),hs([sf.base.Property("Default")],t.prototype,"boundary",void 0),hs([sf.base.Property(!1)],t.prototype,"compensation",void 0),hs([sf.base.Property("None")],t.prototype,"loop",void 0),hs([sf.base.Property(!0)],t.prototype,"collapsed",void 0),hs([sf.base.Collection([],Cs)],t.prototype,"events",void 0),hs([sf.base.Complex({},Ss)],t.prototype,"transaction",void 0),hs([sf.base.Property(void 0)],t.prototype,"processes",void 0),t}(sf.base.ChildProperty),Ts=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnActivity"},hs([sf.base.Property("Task")],t.prototype,"activity",void 0),hs([sf.base.Complex({},ws)],t.prototype,"task",void 0),hs([sf.base.Complex({},Ps)],t.prototype,"subProcess",void 0),t}(sf.base.ChildProperty),As=function(e){function t(t,i,r,o){return e.call(this,t,i,r,o)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnAnnotation"},hs([sf.base.Property("")],t.prototype,"text",void 0),hs([sf.base.Property("")],t.prototype,"id",void 0),hs([sf.base.Property(0)],t.prototype,"angle",void 0),hs([sf.base.Property()],t.prototype,"height",void 0),hs([sf.base.Property()],t.prototype,"width",void 0),hs([sf.base.Property(0)],t.prototype,"length",void 0),t}(sf.base.ChildProperty),zs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"BpmnShape"},hs([sf.base.Property("Bpmn")],t.prototype,"type",void 0),hs([sf.base.Property("Event")],t.prototype,"shape",void 0),hs([sf.base.Complex({},xs)],t.prototype,"event",void 0),hs([sf.base.Complex({},vs)],t.prototype,"gateway",void 0),hs([sf.base.Complex({},bs)],t.prototype,"dataObject",void 0),hs([sf.base.Complex({},Ts)],t.prototype,"activity",void 0),hs([sf.base.Complex({},As)],t.prototype,"annotation",void 0),hs([sf.base.Collection([],As)],t.prototype,"annotations",void 0),t}(ls),Os=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlActivityShape"},hs([sf.base.Property("UmlActivity")],t.prototype,"type",void 0),hs([sf.base.Property("Action")],t.prototype,"shape",void 0),t}(ls),Is=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"MethodArguments"},hs([sf.base.Property("")],t.prototype,"name",void 0),hs([sf.base.Property("")],t.prototype,"type",void 0),hs([sf.base.Complex({},ue)],t.prototype,"style",void 0),t}(sf.base.ChildProperty),Ds=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlClassAttribute"},hs([sf.base.Property("Public")],t.prototype,"scope",void 0),hs([sf.base.Property(!1)],t.prototype,"isSeparator",void 0),t}(Is),Es=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlClassMethod"},hs([sf.base.Collection([],Is)],t.prototype,"parameters",void 0),t}(Ds),Bs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlClass"},hs([sf.base.Property("")],t.prototype,"name",void 0),hs([sf.base.Collection([],Ds)],t.prototype,"attributes",void 0),hs([sf.base.Collection([],Es)],t.prototype,"methods",void 0),hs([sf.base.Complex({},ue)],t.prototype,"style",void 0),t}(sf.base.ChildProperty),Ls=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlInterface"},hs([sf.base.Property(!1)],t.prototype,"isSeparator",void 0),t}(Bs),Ms=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlEnumerationMember"},hs([sf.base.Property("")],t.prototype,"name",void 0),hs([sf.base.Property("")],t.prototype,"value",void 0),hs([sf.base.Property(!1)],t.prototype,"isSeparator",void 0),hs([sf.base.Complex({},ue)],t.prototype,"style",void 0),t}(sf.base.ChildProperty),ks=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlEnumeration"},hs([sf.base.Property("")],t.prototype,"name",void 0),hs([sf.base.Collection([],Ms)],t.prototype,"members",void 0),hs([sf.base.Complex({},ue)],t.prototype,"style",void 0),t}(sf.base.ChildProperty),Rs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"UmlClassifierShape"},hs([sf.base.Property("UmlClassifier")],t.prototype,"type",void 0),hs([sf.base.Complex({},Bs)],t.prototype,"classShape",void 0),hs([sf.base.Complex({},Ls)],t.prototype,"interfaceShape",void 0),hs([sf.base.Complex({},ks)],t.prototype,"enumerationShape",void 0),hs([sf.base.Property("Class")],t.prototype,"classifier",void 0),t}(ls),Ns=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"DiagramShape"},hs([sf.base.Property("Basic")],t.prototype,"type",void 0),hs([sf.base.Property("Rectangle")],t.prototype,"basicShape",void 0),hs([sf.base.Property("Terminator")],t.prototype,"flowShape",void 0),hs([sf.base.Property("Event")],t.prototype,"bpmnShape",void 0),hs([sf.base.Property("Action")],t.prototype,"umlActivityShape",void 0),hs([sf.base.Property("")],t.prototype,"data",void 0),hs([sf.base.Property("")],t.prototype,"content",void 0),hs([sf.base.Property("")],t.prototype,"textContent",void 0),hs([sf.base.Property("Stretch")],t.prototype,"scale",void 0),hs([sf.base.Property("")],t.prototype,"source",void 0),hs([sf.base.Property("None")],t.prototype,"align",void 0),hs([sf.base.Complex({},ne)],t.prototype,"margin",void 0),hs([sf.base.Property(0)],t.prototype,"cornerRadius",void 0),hs([sf.base.Collection([],a)],t.prototype,"points",void 0),hs([sf.base.Complex({},bs)],t.prototype,"dataObject",void 0),hs([sf.base.Complex({},xs)],t.prototype,"event",void 0),hs([sf.base.Complex({},vs)],t.prototype,"gateway",void 0),hs([sf.base.Collection([],As)],t.prototype,"annotations",void 0),hs([sf.base.Complex({},Ts)],t.prototype,"activity",void 0),hs([sf.base.Complex({},As)],t.prototype,"annotation",void 0),hs([sf.base.Complex({},ks)],t.prototype,"enumerationShape",void 0),hs([sf.base.Property("Class")],t.prototype,"classifier",void 0),hs([sf.base.Complex({},Bs)],t.prototype,"classShape",void 0),hs([sf.base.Complex({},Ls)],t.prototype,"interfaceShape",void 0),t}(sf.base.ChildProperty),js=function(t){function r(e,i,r,o){var n,a=t.call(this,e,i,r,o)||this;return a.isCanvasUpdate=!1,a.status="None",a.parentId="",a.processId="",a.umlIndex=-1,a.outEdges=[],a.inEdges=[],a.isHeader=!1,a.isLane=!1,a.isPhase=!1,a.children&&a.children.length>0&&((n=r).style&&n.style.fill||(a.style.fill="transparent"),n.style&&n.style.strokeColor||(a.style.strokeColor="transparent")),a.shape&&"UmlActivity"===a.shape.type&&On(r,a),a.shape&&"SwimLane"===a.shape.type&&Pn(r,a),a.ports&&a.ports.length&&zn(a),a}return ss(r,t),Object.defineProperty(r.prototype,"actualSize",{get:function(){return null!==this.wrapper?this.wrapper.actualSize:new i(this.width||0,this.height||0)},enumerable:!0,configurable:!0}),r.prototype.init=function(t){var i,r;i="SwimLane"!==this.shape.type?new be:new wo;switch(this.shape.changedProperties={},this.shape.oldProperties={},this.shape.type){case"Path":var o=new Me;o.data=this.shape.data,i=o;break;case"Image":var n=new Re;n.source=this.shape.source,n.imageAlign=this.shape.align,n.imageScale=this.shape.scale,i=n;break;case"Text":var a=new Se;a.content=sf.base.isBlazor()?this.shape.textContent:this.shape.content,i=a,r=this.style,i.style=r;break;case"Basic":if(!sf.base.isBlazor()&&"Rectangle"===this.shape.shape||sf.base.isBlazor()&&"Rectangle"===this.shape.basicShape)(i=h=new be).cornerRadius=this.shape.cornerRadius;else if(!sf.base.isBlazor()&&"Polygon"===this.shape.shape||sf.base.isBlazor()&&"Polygon"===this.shape.basicShape){var s=new Me;s.data=l(this.shape.points),i=s}else{var h=new Me,d=Ae(sf.base.isBlazor()?this.shape.basicShape:this.shape.shape);h.data=d,i=h}break;case"Flow":var c=new Me,p=et(sf.base.isBlazor()?this.shape.flowShape:this.shape.shape);c.data=p,i=c;break;case"UmlActivity":i=la(new Me,i,this);break;case"Bpmn":if(t.bpmnModule){i=t.bpmnModule.initBPMNContent(i,this,t),this.wrapper.elementActions=this.wrapper.elementActions|e.ElementAction.ElementIsGroup;var g=this.shape.activity.subProcess;if(g.processes&&g.processes.length)for(var u=0,f=this.shape.activity.subProcess.processes;u<f.length;u++){var m=f[u];!t.nameTable[m]||t.nameTable[m].processId&&t.nameTable[m].processId!==this.id||(t.nameTable[m].processId=this.id,g.collapsed&&t.updateElementVisibility(t.nameTable[m].wrapper,t.nameTable[m],!g.collapsed),i.children.push(t.nameTable[m].wrapper))}}break;case"Native":var y=new je(this.id,t.element.id);y.content=this.shape.content,y.scale=this.shape.scale,i=y;break;case"HTML":var v=new Yi(this.id,t.element.id,void 0,t.nodeTemplate);this.shape.content?v.content=this.shape.content:t.nodeTemplate&&(v.isTemplate=!0,v.template=v.content=uh(v,!0,this)),i=v;break;case"UmlClassifier":i=$a(i,this,t);break;case"SwimLane":this.annotations=[],this.ports=[],i.cellStyle.fill="none",i.cellStyle.strokeColor="none",this.container={type:"Grid",orientation:this.shape.orientation},i.id=this.id,this.container.orientation=this.shape.orientation,this.constraints|=e.NodeConstraints.HideThumbs,Ho(i,t,this)}return i.id=this.id+"_content",i.relativeMode="Object",void 0!==this.width&&(i.width=this.width),i.horizontalAlignment="Stretch",void 0!==this.height&&(i.height=this.height),void 0!==this.minHeight&&(i.minHeight=this.minHeight),void 0!==this.maxHeight&&(i.maxHeight=this.maxHeight),void 0!==this.minWidth&&(i.minWidth=this.minWidth),void 0!==this.maxWidth&&(i.maxWidth=this.maxWidth),(!sf.base.isBlazor()&&"Rectangle"===this.shape.shape&&!this.shape.cornerRadius||sf.base.isBlazor()&&"Rectangle"===this.shape.basicShape&&"Basic"===this.shape.type&&!this.shape.cornerRadius)&&(i.isRectElement=!0),i.verticalAlignment="Stretch",(this.shape instanceof fs||sf.base.isBlazor()&&"Text"===this.shape.type)&&(i.margin=this.shape.margin),Nr(this)&&0!=(this.constraints&e.NodeConstraints.Shadow)&&(i.shadow=this.shadow),("Bpmn"!==this.shape.type||!sf.base.isBlazor()&&"Message"===this.shape.shape||sf.base.isBlazor()&&"Message"===this.shape.bpmnShape||!sf.base.isBlazor()&&"DataSource"===this.shape.shape||sf.base.isBlazor()&&"DataSource"===this.shape.bpmnShape)&&("UmlActivity"!==this.shape.type||!sf.base.isBlazor()&&"FinalNode"!==this.shape.shape||sf.base.isBlazor()&&"FinalNode"!==this.shape.umlActivityShape)&&"Text"!==this.shape.type&&(i.style=this.style),(this.wrapper.elementActions&e.ElementAction.ElementIsGroup||"Horizontal"!==this.flip)&&"Vertical"!==this.flip||(i.flip=this.flip),i},r.prototype.initContainer=function(){var e;if(this.id||(this.id=xh()),!this.container||this.shape instanceof Vs)e=this.children?new xe:new Te;else switch(this.container.type){case"Canvas":e=new Te;break;case"Stack":e=new Ja;break;case"Grid":(e=new wo).setDefinitions(this.rows,this.columns)}return e.id=this.id,e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.visible=this.visible,e.horizontalAlignment=this.horizontalAlignment,e.verticalAlignment=this.verticalAlignment,this.container&&(e.width=this.width,e.height=this.height,"Stack"===this.container.type&&(e.orientation=this.container.orientation)),e.style.fill=this.backgroundColor,e.style.strokeColor=this.borderColor,e.style.strokeWidth=this.borderWidth,e.rotateAngle=this.rotateAngle,e.minHeight=this.minHeight,e.minWidth=this.minWidth,e.maxHeight=this.maxHeight,e.maxWidth=this.maxWidth,e.pivot=this.pivot,e.margin=this.margin,e.flip=this.flip,this.wrapper=e,e},r.prototype.initPorts=function(e,t){for(var i=0;this.ports,i<this.ports.length;i++)this.initPort(e,t,this.ports[i])},r.prototype.initPort=function(t,i,r){var o,n,a=this.wrapper;o=this.initPortWrapper(r);var s=Wh(t);s&&(n=s(o,this)),o.description=n||o.id,o.inversedAlignment=a.inversedAlignment,o.elementActions=o.elementActions|e.ElementAction.ElementIsPort,i.children.push(o)},r.prototype.getIconOffet=function(e,t){var i,r;return"BottomToTop"===e.orientation?(i=t.offset.x,r=1-t.offset.y):"LeftToRight"===e.orientation?(i=t.offset.y,r=t.offset.x):"RightToLeft"===e.orientation?(i=1-t.offset.y,r=t.offset.x):(i=t.offset.x,r=t.offset.y),{x:i,y:r}},r.prototype.initIcons=function(e,t,i,r){var o,n=this.wrapper,a=this.isExpanded?this.expandIcon:this.collapseIcon;if("None"!==a.shape){var s=new Te;s.float=!0;s.id=this.id+"_icon_content",s.children=[],s.height=a.height,s.width=a.width,s.style.strokeColor="transparent",s.margin=a.margin,s.horizontalAlignment="Center",s.verticalAlignment="Center",s.visible=this.visible,o=this.getIconOffet(t,a),s.setOffsetWithRespectToBounds(o.x,o.y,"Fraction"),s.relativeMode="Point",this.initIconSymbol(a,s,e,r);var h=void 0,d=Wh(e);d&&(h=d(a,this)),s.description=h||s.id,s.inversedAlignment=n.inversedAlignment,i.children.push(s)}},r.prototype.initfixedUserHandles=function(e){var t=this.wrapper,i=new Te;i.float=!0;e.id=e.id||xh(),i.id=this.id+"_"+e.id,i.children=[],i.height=e.height,i.width=e.width,i.style.strokeColor=e.handleStrokeColor,i.style.fill=e.fill,i.style.strokeWidth=e.handleStrokeWidth,i.margin=e.margin,i.visible=e.visibility,i.cornerRadius=e.cornerRadius,i.horizontalAlignment="Center",i.verticalAlignment="Center";var r=this.getfixedUserHandleOffet(e);i.setOffsetWithRespectToBounds(r.x,r.y,"Fraction"),i.relativeMode="Point";var o=Vn(e,i);return i.children.push(o),i.description=i.id,i.inversedAlignment=t.inversedAlignment,i},r.prototype.getfixedUserHandleOffet=function(e){return{x:e.offset.x,y:e.offset.y}},r.prototype.initAnnotations=function(e,t,i,r,o){for(var n,a=0;this.annotations,a<this.annotations.length;a++){n=this.initAnnotationWrapper(this.annotations[a],i,r,a,o);var s=void 0,h=Wh(e);h&&(s=h(n,this)),n.description=s||n.id,n.inversedAlignment=t.inversedAlignment,t.children.push(n)}},r.prototype.initPortWrapper=function(t){t.id=t.id||xh();var i=new Me;i.height=t.height,i.width=t.width;var r="Custom"===t.shape?t.pathData:qe(t.shape);i.id=this.id+"_"+t.id,i.margin=t.margin,i.data=r;var o=t.style;return i.style={fill:o.fill,strokeColor:o.strokeColor,gradient:null,opacity:o.opacity,strokeDashArray:o.strokeDashArray,strokeWidth:o.strokeWidth},i.horizontalAlignment=t.horizontalAlignment,i.verticalAlignment=t.verticalAlignment,i=La(i,this.flip,t),void 0===this.width&&void 0===this.height||(i.float=!0),i.relativeMode="Point",i.visible=!(!ya(t,e.PortVisibility.Visible)||ya(t,e.PortVisibility.Hover)||ya(t,e.PortVisibility.Connect)),i.elementActions=i.elementActions|e.ElementAction.ElementIsPort,i},r.prototype.initAnnotationWrapper=function(e,t,i,r,o){e.id=e.id||r+"annotation"||xh();var n,a=e;if(sf.base.isBlazor()&&"Template"===e.annotationType&&(e.template=e.template?e.template:""),t&&(e.template||"Template"===e.annotationType||o&&""===e.content))n=wh(n=new Yi(this.id,t,e.id,o),e,o);else{(n=new Se).canMeasure=!i;var s=e.style,h=e.hyperlink.link?e.hyperlink:void 0;n.style={fill:s.fill,strokeColor:s.strokeColor,strokeWidth:s.strokeWidth,bold:s.bold,textWrapping:s.textWrapping,color:h?h.color||n.hyperlink.color:s.color,whiteSpace:s.whiteSpace,fontFamily:s.fontFamily,fontSize:s.fontSize,italic:s.italic,gradient:null,opacity:s.opacity,strokeDashArray:s.strokeDashArray,textAlign:s.textAlign,textOverflow:e.style.textOverflow,textDecoration:h?h.textDecoration||n.hyperlink.textDecoration:s.textDecoration},n.hyperlink.link=e.hyperlink.link||void 0,n.hyperlink.content=e.hyperlink.content||void 0,n.hyperlink.textDecoration=e.hyperlink.textDecoration||void 0,n.content=h?h.content||n.hyperlink.link:e.content}return n.constraints=e.constraints,n.height=e.height,n.width=e.width,n.visible=e.visibility,n.rotateAngle=e.rotateAngle,n.id=this.id+"_"+e.id,void 0===this.width||e.template||(void 0===e.width||e.width>this.width&&("Wrap"===e.style.textWrapping||"WrapWithOverflow"===e.style.textWrapping))&&(n.width=this.width),n.margin=e.margin,n.horizontalAlignment=e.horizontalAlignment,n.verticalAlignment=e.verticalAlignment,n.setOffsetWithRespectToBounds(a.offset.x,a.offset.y,"Fraction"),void 0===this.width&&void 0===this.height||(n.float=!0),n.relativeMode="Point",n},r.prototype.initIconContainer=function(e,t){var i=new be;return i.id=t.id+"_rect",i.height=e.height,i.width=e.width,i.visible=t.visible,i.margin=e.margin,i.cornerRadius=e.cornerRadius,i.style={fill:e.fill,strokeColor:e.borderColor,strokeWidth:e.borderWidth},i.setOffsetWithRespectToBounds(.5,.5,"Fraction"),i.horizontalAlignment="Center",i.verticalAlignment="Center",i.relativeMode="Object",i.description=i.description||"Click here to expand or collapse",i},r.prototype.initIconSymbol=function(e,t,i,r){var o;if(t.children.push(this.initIconContainer(e,t)),"Template"===e.shape)(o=new je(this.id,r)).content=e.content,o.height=10,o.width=10;else{(o=new Me).data=Qe(e);var n=Gs(o.data);o.height=n.height<10?n.height:10-(e.padding.bottom+e.padding.top),o.width=n.width<10?n.width:10-(e.padding.left+e.padding.right)}o.id=t.id+"_shape",o.horizontalAlignment="Center",o.verticalAlignment="Center",o.visible=t.visible,o.visible=t.visible,o.style={fill:"black",strokeColor:e.borderColor,strokeWidth:e.borderWidth},o.setOffsetWithRespectToBounds(.5,.5,"Fraction"),o.relativeMode="Object",o.description=t.description||"Click here to expand or collapse",t.children.push(o)},r.prototype.getClassName=function(){return"Node"},hs([sf.base.Collection([],Fe)],r.prototype,"annotations",void 0),hs([sf.base.Property(0)],r.prototype,"offsetX",void 0),hs([sf.base.Complex({},as)],r.prototype,"layoutInfo",void 0),hs([sf.base.Property(0)],r.prototype,"offsetY",void 0),hs([sf.base.Collection([],Ve)],r.prototype,"ports",void 0),hs([sf.base.Property(!0)],r.prototype,"isExpanded",void 0),hs([sf.base.Collection([],Zi)],r.prototype,"fixedUserHandles",void 0),hs([sf.base.Complex({},Ka)],r.prototype,"expandIcon",void 0),hs([sf.base.Complex({},Ka)],r.prototype,"collapseIcon",void 0),hs([sf.base.Complex({x:.5,y:.5},a)],r.prototype,"pivot",void 0),hs([sf.base.Property()],r.prototype,"width",void 0),hs([sf.base.Property()],r.prototype,"height",void 0),hs([sf.base.Property()],r.prototype,"minWidth",void 0),hs([sf.base.Property()],r.prototype,"minHeight",void 0),hs([sf.base.Property()],r.prototype,"maxWidth",void 0),hs([sf.base.Property()],r.prototype,"maxHeight",void 0),hs([sf.base.Property(0)],r.prototype,"rotateAngle",void 0),hs([sf.base.Complex({fill:"white"},ue)],r.prototype,"style",void 0),hs([sf.base.Property("transparent")],r.prototype,"backgroundColor",void 0),hs([sf.base.Property("none")],r.prototype,"borderColor",void 0),hs([sf.base.Property(0)],r.prototype,"borderWidth",void 0),hs([sf.base.Property()],r.prototype,"data",void 0),hs([sf.base.ComplexFactory(ds)],r.prototype,"shape",void 0),hs([sf.base.Complex({},ji)],r.prototype,"previewSize",void 0),hs([sf.base.Complex({},ji)],r.prototype,"dragSize",void 0),hs([sf.base.Property(null)],r.prototype,"wrapper",void 0),hs([sf.base.Property(e.NodeConstraints.Default)],r.prototype,"constraints",void 0),hs([sf.base.Complex({},ae)],r.prototype,"shadow",void 0),hs([sf.base.Property()],r.prototype,"children",void 0),hs([sf.base.Property(null)],r.prototype,"container",void 0),hs([sf.base.Property("Left")],r.prototype,"horizontalAlignment",void 0),hs([sf.base.Property("Top")],r.prototype,"verticalAlignment",void 0),hs([sf.base.Property()],r.prototype,"rows",void 0),hs([sf.base.Property()],r.prototype,"columns",void 0),hs([sf.base.Property()],r.prototype,"rowIndex",void 0),hs([sf.base.Property()],r.prototype,"columnIndex",void 0),hs([sf.base.Property()],r.prototype,"rowSpan",void 0),hs([sf.base.Property()],r.prototype,"columnSpan",void 0),hs([sf.base.Property("")],r.prototype,"branch",void 0),r}(Vi),Hs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),hs([sf.base.Property("")],t.prototype,"id",void 0),hs([sf.base.Complex({},Ge)],t.prototype,"annotation",void 0),hs([sf.base.Complex({fill:"#E7F4FF",strokeColor:"#CCCCCC"},pe)],t.prototype,"style",void 0),hs([sf.base.Property(50)],t.prototype,"height",void 0),hs([sf.base.Property(50)],t.prototype,"width",void 0),t}(sf.base.ChildProperty),Ws=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Lane"},hs([sf.base.Property("")],t.prototype,"id",void 0),hs([sf.base.Complex({fill:"#F9F9F9",strokeColor:"#CCCCCC"},pe)],t.prototype,"style",void 0),hs([sf.base.Collection([],js)],t.prototype,"children",void 0),hs([sf.base.Property(100)],t.prototype,"height",void 0),hs([sf.base.Property(100)],t.prototype,"width",void 0),hs([sf.base.Complex({style:{fill:"#E7F4FF",strokeColor:"#CCCCCC"},annotation:{content:"Function"}},Hs)],t.prototype,"header",void 0),hs([sf.base.Property(!0)],t.prototype,"canMove",void 0),t}(sf.base.ChildProperty),_s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ss(t,e),t.prototype.getClassName=function(){return"Phase"},hs([sf.base.Property("")],t.prototype,"id",void 0),hs([sf.base.Complex({strokeColor:"#CCCCCC"},pe)],t.prototype,"style",void 0),hs([sf.base.Complex({annotation:{content:"Phase"}},Hs)],t.prototype,"header",void 0),hs([sf.base.Property(100)],t.prototype,"offset",void 0),t}(sf.base.ChildProperty),Vs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.padding=20,t.hasHeader=!0,t}return ss(t,e),t.prototype.getClassName=function(){return"SwimLane"},hs([sf.base.Property("SwimLane")],t.prototype,"type",void 0),hs([sf.base.Property(20)],t.prototype,"phaseSize",void 0),hs([sf.base.Collection([],_s)],t.prototype,"phases",void 0),hs([sf.base.Property("Horizontal")],t.prototype,"orientation",void 0),hs([sf.base.Collection([],Ws)],t.prototype,"lanes",void 0),hs([sf.base.Complex({style:{fill:"#E7F4FF",strokeColor:"#CCCCCC"},annotation:{content:"Function"}},Hs)],t.prototype,"header",void 0),hs([sf.base.Property(!1)],t.prototype,"isLane",void 0),hs([sf.base.Property(!1)],t.prototype,"isPhase",void 0),t}(ls),Xs=function(){function e(){}return e.prototype.getClassName=function(){return"ChildContainer"},hs([sf.base.Property("Canvas")],e.prototype,"type",void 0),hs([sf.base.Property("Vertical")],e.prototype,"orientation",void 0),e}(),Ys=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ss(i,t),i.prototype.init=function(e){var t=new xe;if(t.measureChildren=!1,t.children=[],this.annotation){var i=this.nodes.length>0?e.nameTable[this.nodes[0].id].wrapper:e.nameTable[this.connectors[0].id].wrapper,r=e.getWrapper(i,this.annotation.id);t.children.push(r)}else if(this.nodes||this.connectors){for(var o=0;o<this.nodes.length;o++){r=e.nameTable[this.nodes[o].id].wrapper;t.children.push(r)}for(var n=0;n<this.connectors.length;n++){r=e.nameTable[this.connectors[n].id].wrapper;t.children.push(r)}}var a=e.isProtectedOnChange;return e.protectPropertyChange(!1),this.wrapper=t,e.protectPropertyChange(a),t},hs([sf.base.Property(null)],i.prototype,"wrapper",void 0),hs([sf.base.Collection([],js)],i.prototype,"nodes",void 0),hs([sf.base.Collection([],wr)],i.prototype,"connectors",void 0),hs([sf.base.Property()],i.prototype,"width",void 0),hs([sf.base.Property()],i.prototype,"height",void 0),hs([sf.base.Property(0)],i.prototype,"rotateAngle",void 0),hs([sf.base.Property(0)],i.prototype,"offsetX",void 0),hs([sf.base.Property(0)],i.prototype,"offsetY",void 0),hs([sf.base.Complex({x:.5,y:.5},a)],i.prototype,"pivot",void 0),hs([sf.base.Property("CompleteIntersect")],i.prototype,"rubberBandSelectionMode",void 0),hs([sf.base.Collection([],so)],i.prototype,"userHandles",void 0),hs([sf.base.Property(e.SelectorConstraints.All)],i.prototype,"constraints",void 0),hs([sf.base.Property()],i.prototype,"setTooltipTemplate",void 0),i}(sf.base.ChildProperty);function Us(e){var t,i=[];if("msie"===sf.base.Browser.info.name||"edge"===sf.base.Browser.info.name)for(var r=0;r<e.childNodes.length;r++)1===(t=e.childNodes[r]).nodeType&&i.push(t);else i=e.children;return i}function Gs(e){if(e){window.measureElement.style.visibility="visible";var t=Us(window.measureElement.children[2])[0];t.setAttribute("d",e);var i=t.getBBox(),r=new b(i.x,i.y,i.width,i.height);return window.measureElement.style.visibility="hidden",r}return new b(0,0,0,0)}function Fs(e,t,r,o,n){var a=new i,s=hh("span",{style:"display:inline-block; line-height: normal"});return e.bold&&(s.style.fontWeight="bold"),e.italic&&(s.style.fontStyle="italic"),void 0!==r&&(s.style.width=r.toString()+"px"),void 0!==o&&(s.style.height=o.toString()+"px"),void 0!==n&&(s.style.maxWidth=n.toString()+"px"),s.style.fontFamily=e.fontFamily,s.style.fontSize=e.fontSize+"px",s.style.color=e.color,s.textContent=t,s.style.whiteSpace=Rh(e.whiteSpace,e.textWrapping),s.style.wordBreak=void 0!==n?"break-word":Bh(e.textWrapping),document.body.appendChild(s),a.width=s.offsetWidth,a.height=s.offsetHeight,document.body.removeChild(s),a}function Zs(e,t,i,r){var o,n=0,a=0,h=!1,d=t;return 0===d.x&&0===d.y||(n=0-Number(d.x),a=0-Number(d.y)),(e.actualSize.width!==d.width||e.actualSize.height!==d.height||r)&&(n=(r&&r.width||e.actualSize.width)/Number(d.width?d.width:1),a=(r&&r.height||e.actualSize.height)/Number(d.height?d.height:1),h=!0),o=p(f(s(e.data)),n,a,h,d.x,d.y,0,0),h=!1,o}function qs(e){return Ks(e).getElementsByClassName("e-diagram-layer")[0]}function Ks(e,t){var i;return t&&(i=document.getElementById(t)),"msie"===sf.base.Browser.info.name||"edge"===sf.base.Browser.info.name?i?i.querySelector("#"+e):document.getElementById(e):i?i.querySelector("#"+CSS.escape(e)):document.getElementById(e)}function Qs(e,t,i){var r,o,n,a=void 0,s="";"native"===i?(r=ah(e),s="_content_groupElement"):"html"===i?(r=sh(e).childNodes[0],s="_html_element"):(r=qs(o=e).getElementById(o+"_diagramLayer"),s="_groupElement");for(var h=0;r.childNodes&&h<r.childNodes.length;h++)if((n=r.childNodes[h])&&n.id===t+s){a=h;break}return a}function Js(e){return Ks(e).getElementsByClassName("e-adorner-layer")[0]}function $s(e){return Js(e).getElementById(e+"_SelectorElement")}function eh(e){return Js(e).getElementById(e+"_diagramAdorner")}function th(e){return Ks(e).getElementsByClassName("e-userHandle-layer")[0]}function ih(e){return Ks(e).getElementsByClassName("e-native-layer")[0]}function rh(e){return Ks(e).getElementsByClassName("e-grid-layer")[0]}function oh(e){return Ks(e).getElementsByClassName("e-background-layer")[0].parentNode}function nh(e){return Ks(e).getElementsByClassName("e-background-layer")[0]}function ah(e){return ih(e).getElementById(e+"_nativeLayer")}function sh(e){var t=null;window.domTable[e+"html_layer"]?t=window.domTable[e+"html_layer"]:(t=Ks(e).getElementsByClassName("e-html-layer")[0],window.domTable[e+"html_layer"]=t);return t}function hh(e,t){var i=sf.base.createElement(e);return yh(i,t),i}function dh(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return fh(i,t),i}function lh(e,t,i){for(var r=e;r&&!(i?r.id===t:ch(r,t));)r=r.parentNode;return r}function ch(e,t){return(" "+("object"===r(e.className)?e.className.animVal:e.className)+" ").indexOf(" "+t+" ")>-1}function ph(e,t,i){e=[];for(var r=0,o=i.length;r<o;r++)e.push({pageX:i[r].clientX,pageY:i[r].clientY,pointerId:null});return e}function gh(e,t){var i=Ks(e,t);i&&i.parentNode.removeChild(i)}function uh(e,t,i){var r;if(t){r=hh("div",{style:"height: 100%; width: 100%"})}else r=document.createElementNS("http://www.w3.org/2000/svg","g");var o,n,a=Aa(e),s="",h={};if(a instanceof js){if(h=a,"Native"===a.shape.type){var d,l=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(l),l.innerHTML=a.shape.content,d=l.getElementsByTagName("svg").length>0?l.getElementsByTagName("svg")[0].outerHTML:l.getElementsByTagName("g")[0].outerHTML,a.shape.content=d,e.content=d,l.parentElement.removeChild(l)}sf.base.isBlazor()&&(s="diagramsf_node_template",h=_a(a)),o="nodeTemplate"}else h=a,sf.base.isBlazor()&&(h=_a(a),s="diagramsf_annotation_template"),o="annotationTemplate";var c=document.getElementById(e.diagramId).ej2_instances[0];if("string"!=typeof e.content||e.isTemplate&&!sf.base.isBlazor())if(e.isTemplate){u=void 0;u=e.getNodeTemplate()(Ah(i),c,o+"_"+("nodeTemplate"===o?i.id:e.nodeId+i.id),void 0,void 0,!1);for(var p=0;p<u.length;p++)r.appendChild(u[p])}else r.appendChild(e.content);else{var g=document.getElementById(e.content);if(g)r.appendChild(g);else for(var u=void 0,f=0,m=(u=sf.base.compile(e.content))(h,c,o,s);f<m.length;f++)n=m[f],r.appendChild(n)}return e.isTemplate?r:r.cloneNode(!0)}function fh(e,t){for(var i=Object.keys(t),r=0;r<i.length;r++)"style"!==i[r]?e.setAttribute(i[r],t[i[r]]):mh(e,t[i[r]])}function mh(e,t){for(var i=t.split(";"),r=0;r<i.length;r++){var o=i[r].split(":");2===o.length&&(e.style[o[0].trim()]=o[1].trim())}}function yh(e,t){for(var i=Object.keys(t),r=0;r<i.length;r++)"style"!==i[r]?e.setAttribute(i[r],t[i[r]]):mh(e,t[i[r]])}function vh(){if(window.measureElement)window.measureElement.usageCount+=1;else{var e=hh("div",{id:"measureElement",style:"visibility:hidden ; height: 0px ; width: 0px; overflow: hidden;"}),t=hh("span",{style:"display:inline-block ; line-height: normal"});e.appendChild(t);var i=hh("img",{});e.appendChild(i);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("xlink","http://www.w3.org/1999/xlink"),e.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");r.appendChild(o);document.createTextNode("");var n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),r.appendChild(n),window.measureElement=e,window.measureElement.usageCount=1,document.body.appendChild(e);window.measureElementCount?window.measureElementCount++:window.measureElementCount=1}}function bh(e,t,i,r){return!(t.length>=1&&0===e.x)||"Clip"!==r.textOverflow&&"Ellipsis"!==r.textOverflow||"Wrap"!==r.textWrapping&&"WrapWithOverflow"!==r.textWrapping||(e.x=t[i-1]?t[i-1].x:-e.width/2),e.x}function wh(e,t,i){return i&&!t.template?(e.isTemplate=!0,e.template=e.content=uh(e,!0,t)):e.content=t.template,e}function xh(){for(var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i="",r=0;r<5;r++){if("crypto"in window&&"getRandomValues"in crypto){var o=new Uint16Array(1);e=(window.msCrypto||window.crypto).getRandomValues(o)[0]%(t.length-1)}else e=Math.floor(Math.random()*t.length);0===r&&e<10?r--:i+=t.substring(e,e+1)}return i}function Ch(e,t){if(e.nodes&&e.nodes.length>0)for(var i=0;i<e.nodes.length;i++)if(e.nodes[i].id===t)return i;if(e.connectors&&e.connectors.length>0)for(i=0;i<e.connectors.length;i++)if(e.connectors[i].id===t)return i;return null}function Sh(e){if(e)try{if(document.querySelectorAll(e).length)return sf.base.compile(document.querySelector(e).innerHTML.trim())}catch(t){return sf.base.compile(e)}}function Ph(e){new b;var t=e.offsetY-e.actualSize.height*e.pivot.y,i=e.offsetY+e.actualSize.height*(1-e.pivot.y),r=e.offsetX-e.actualSize.width*e.pivot.x,o=e.offsetX+e.actualSize.width*(1-e.pivot.x),n={x:r,y:t},a={x:o,y:t},s={x:r,y:i},h={x:o,y:i};return b.toBounds([n,a,s,h])}function Th(e){var t=new b,i=Ph(e),r=i.middleLeft,o=i.topCenter,n=i.bottomCenter,a=i.middleRight,s=i.topLeft,h=i.topRight,d=i.bottomLeft,l=i.bottomRight;if(e.corners={topLeft:s,topCenter:o,topRight:h,middleLeft:r,middleRight:a,bottomLeft:d,bottomCenter:n,bottomRight:l},0!==e.rotateAngle||0!==e.parentTransform){var c=x();P(c,e.rotateAngle+e.parentTransform,e.offsetX,e.offsetY),e.corners.topLeft=s=C(c,s),e.corners.topCenter=o=C(c,o),e.corners.topRight=h=C(c,h),e.corners.middleLeft=r=C(c,r),e.corners.middleRight=a=C(c,a),e.corners.bottomLeft=d=C(c,d),e.corners.bottomCenter=n=C(c,n),e.corners.bottomRight=l=C(c,l)}return t=b.toBounds([s,h,d,l]),e.corners.left=t.left,e.corners.right=t.right,e.corners.top=t.top,e.corners.bottom=t.bottom,e.corners.center=t.center,e.corners.width=t.width,e.corners.height=t.height,t}function Ah(e,t,i,r){var o={},n="properties";if(e){i=e.propName;var a=e[n]||e,s=[],h=[];if((s=s.concat(Object.keys(a))).push("version"),i){var d=Wh(t);h=d?d(i):[],s=s.concat(h)}var l=zh(i);s=s.concat(l),r&&(s=function(e,t){var i=[];return t instanceof js?i=["width","height","offsetX","offsetY","container","visible","horizontalAlignment","verticalAlignment","backgroundColor","borderColor","borderWidth","rotateAngle","minHeight","minWidth","maxHeight","maxWidth","pivot","margin","flip","wrapper","constraints","style","annotations","ports","isExpanded","expandIcon"]:t instanceof wr?i=["constraints","sourcePadding","targetPadding","cornerRadius","flip","type","targetDecorator","sourceDecorator","sourceID","shape","bridgeSpace","annotations","segments","hitPadding","tooltip","previewSize","dragSize","style","sourcePortID","targetID","targetPortID","visible"]:t instanceof er?i=["height","width","shape","style","pivot","pathData"]:t instanceof ls||t instanceof Ka?(i.push("shape"),t instanceof ms?i.push("cornerRadius"):t instanceof Text?i.push("margin"):t instanceof Image?(i.push("align"),i.push("scale")):t instanceof ps?i.push("scale"):t instanceof zs?(i.push("activity"),i.push("annotations")):t instanceof Ka&&(i.push("borderColor"),i.push("borderWidth"),i.push("cornerRadius"),i.push("fill"))):t instanceof Ts?i.push("subProcess"):t instanceof ws?(i.push("call"),i.push("compensation"),i.push("loop")):t instanceof Ps?(i.push("adhoc"),i.push("boundary"),i.push("compensation"),i.push("loop"),i.push("processes")):t instanceof _e?(i.push("height"),i.push("width"),i.push("visibility"),i.push("horizontalAlignment"),i.push("verticalAlignment"),i.push("shape")):t instanceof Ge?(i.push("constraints"),i.push("height"),i.push("horizontalAlignment"),i.push("rotateAngle"),i.push("template"),i.push("verticalAlignment"),i.push("visibility"),i.push("width"),i.push("margin")):t instanceof ne?(i.push("left"),i.push("right"),i.push("top"),i.push("bottom")):t instanceof ue&&(i=["strokeWidth","strokeDashArray","opacity","gradient","fontSize","fontFamily","textOverflow","textDecoration","whiteSpace","textWrapping","textAlign","italic","bold"]),t instanceof pe&&(i.push("strokeColor"),i.push("color")),e=e.concat(i)}(s,e));for(var c=0,p=s;c<p.length;c++){var g=p[c];if("historyManager"!==g)if("wrapper"!==g)!(!e[g]||!e.hasOwnProperty("observers"))||(e[g]instanceof Array?o[g]=Oh(-1===l.indexOf(g)&&e[n]?e[n][g]:e[g],t,g,r):e[g]instanceof Array==!1&&e[g]instanceof HTMLElement?o[g]=e[g].cloneNode(!0).innerHtml:e[g]instanceof Array==!1&&e[g]instanceof Object?o[g]=Ah(-1===l.indexOf(g)&&e[n]?e[n][g]:e[g],void 0,void 0,r):o[g]=e[g]);else e[g]&&(o[g]={actualSize:{width:e[g].actualSize.width,height:e[g].actualSize.height},offsetX:e[g].offsetX,offsetY:e[g].offsetY})}}return o}function zh(e){switch(e){case"nodes":case"children":return["inEdges","outEdges","parentId","processId","nodeId","umlIndex","isPhase","isLane"];case"connectors":return["parentId"];case"annotation":case"annotations":return["nodeId"];case"shape":return["hasHeader"];case"layers":return["objectZIndex"]}return[]}function Oh(e,t,i,r){var o;if(e){o=[];for(var n=0;n<e.length;n++)e[n]instanceof Array?o.push(e[n]):e[n]instanceof Object?o.push(Ah(e[n],t,i,r)):o.push(e[n])}return o}function Ih(e,t){if(e){t||(t={properties:{}});for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];if(e[o]instanceof Array){var n=Dh(e[o],t.properties[o]);t.properties[o]&&t.properties[o].length||(t[o]=n)}else if(e[o]instanceof Array==!1&&e[o]instanceof HTMLElement)t[o]=e[o].cloneNode(!0).innerHtml;else if(e[o]instanceof Array==!1&&e[o]instanceof Object){var a=Ih(e[o],t.properties[o]);a.properties&&!Object.keys(a.properties).length&&delete a.properties,t[o]=a}else t[o]=void 0!==t.properties[o]?t[o]:e[o]}}return t}function Dh(e,t){var i=[],r=!1;t||(t=[]),t.length||(r=!0);for(var o=0;o<e.length;o++)if(e[o]instanceof Array){Dh(e[o],t[o]);r&&i.push(Dh)}else if(e[o]instanceof Object){var n=Ih(e[o],t[o]);r&&i.push(n)}else i.push(e[o]);return i}function Eh(e){var t="";switch(e){case"Center":t="center";break;case"Left":t="left";break;case"Right":t="right"}return t}function Bh(e){var t="";switch(e){case"Wrap":t="breakall";break;case"NoWrap":t="keepall";break;case"WrapWithOverflow":t="normal";break;case"LineThrough":t="line-through"}return t}function Lh(e,t){window.measureElement.style.visibility="visible";var i=Us(window.measureElement.children[2])[1];i.textContent=e,mh(i,"font-size:"+t.fontSize+"px; font-family:"+t.fontFamily+";font-weight:"+(t.bold?"bold":"normal"));var r=i.getBBox().width;return window.measureElement.style.visibility="hidden",r}function Mh(e,t){return(e+t)/2}function kh(e,t){var i,r=0,o=0,n=0,a="";i=e.length;var s=0;do{n>0&&(r=o),o=Math.floor(Mh(r,i)),n=Lh(a+=e.substr(r,o),t)}while(n<=t.width);for(a=a.substr(0,r),s=r;s<i;s++)if((n=Lh(a+=e[s],t))>=t.width){e=e.substr(0,a.length-1);break}return"Ellipsis"===t.textOverflow?(e=e.substr(0,e.length-3),e+="..."):e=e.substr(0,e.length),e}function Rh(e,t){if("NoWrap"===t&&"PreserveAll"===e)return"pre";var i="";switch(e){case"CollapseAll":i="nowrap";break;case"CollapseSpace":i="pre-line";break;case"PreserveAll":i="pre-wrap"}return i}function Nh(e,t){var r=x();P(r,t,0,0);var o=C(r,{x:0,y:0}),n=C(r,{x:e.width,y:0}),a=C(r,{x:0,y:e.height}),s=C(r,{x:e.width,y:e.height}),h=Math.min(o.x,n.x,a.x,s.x),d=Math.min(o.y,n.y,a.y,s.y),l=Math.max(o.x,n.x,a.x,s.x),c=Math.max(o.y,n.y,a.y,s.y);return new i(l-h,c-d)}function jh(e,t,i,r){if(0!==e){var o=x();return P(o,e,t,i),C(o,r)}return r}function Hh(e,t){return{x:e.x+t.desiredSize.width*t.pivot.x,y:e.y+t.desiredSize.height*t.pivot.y}}function Wh(e){return void 0!==e&&"string"==typeof e&&(e=sf.base.getValue(e,window)),e}var _h,Vh,Xh,Yh,Uh,Gh,Fh=function(){function e(){}return e.getContext=function(e){return e.getContext("2d")},e.setCanvasSize=function(e,t,i){e&&(e.setAttribute("width",t.toString()),e.setAttribute("height",i.toString()))},e.prototype.renderGradient=function(e,t,i,r){var o,n,a;if("None"!==e.gradient.type){for(var s=0;s<e.gradient.stops.length;s++)o=void 0!==o?e.gradient.stops[s].offset:Math.max(o,e.gradient.stops[s].offset),n=void 0!==n?e.gradient.stops[s].offset:Math.min(n,e.gradient.stops[s].offset);if("Linear"===e.gradient.type){var h=e.gradient;a=t.createLinearGradient(i+h.x1,r+h.y1,i+h.x2,r+h.y2)}else{var d=e.gradient;a=t.createRadialGradient(i+d.fx,r+d.fy,0,i+d.cx,r+d.cy,d.r)}for(s=0;s<e.gradient.stops.length;s++){var l=e.gradient.stops[s],c=n<0?(o+l.offset)/(2*o):l.offset/o;a.addColorStop(c,l.color)}t.fillStyle=a}return t},e.prototype.renderShadow=function(t,i,r){void 0===r&&(r=null);var o=e.getContext(i);o.save(),o.beginPath(),o.strokeStyle=o.fillStyle=t.shadow.color,o.globalAlpha=t.shadow.opacity;var n=a.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),s=t.x+n.x,h=t.y+n.y,d=s+t.width*t.pivotX,l=h+t.height*t.pivotY;this.rotateContext(i,t.angle,d,l),r?(o.translate(s,h),this.renderPath(i,t,r),o.translate(-s,-h)):(o.rect(s,h,t.width,t.height),o.fillRect(s,h,t.width,t.height)),o.fill(),o.stroke(),o.closePath(),o.restore()},e.createCanvas=function(e,t,i){var r=hh("canvas",{id:e});return this.setCanvasSize(r,t,i),r},e.prototype.setStyle=function(t,i){var r=e.getContext(t);"none"===i.fill&&(i.fill="transparent"),"none"===i.stroke&&(i.stroke="transparent"),r.strokeStyle=i.stroke,r.lineWidth=i.strokeWidth,0===i.strokeWidth&&(r.strokeStyle="transparent"),r.globalAlpha=i.opacity;var o=[];i.dashArray&&(o=this.parseDashArray(i.dashArray)),r.setLineDash(o),i.gradient&&"None"!==i.gradient.type?this.renderGradient(i,r,0,0):r.fillStyle=i.fill},e.prototype.rotateContext=function(t,i,r,o){var n=e.getContext(t);n.translate(r,o),n.rotate(i*Math.PI/180),n.translate(-r,-o)},e.prototype.setFontStyle=function(t,i){var r=e.getContext(t),o="";i.italic&&(o+="italic "),i.bold&&(o+="bold "),o+=i.fontSize+"px ",o+=i.fontFamily,r.font=o},e.prototype.parseDashArray=function(e){for(var t=[],i=-1!==e.indexOf(" ")?" ":",",r=0,o=e.split(i);r<o.length;r++){var n=o[r];t.push(Number(n))}return t},e.prototype.drawRoundedRect=function(t,i){var r=e.getContext(t);r.beginPath();var o=i.x,n=i.y,a=i.width,s=i.height,h=o+a/2,d=n+s/2;r.beginPath(),this.setStyle(t,i),r.moveTo(o,d),r.quadraticCurveTo(o,n,h,n),r.quadraticCurveTo(o+a,n,o+a,d),r.quadraticCurveTo(o+a,n+s,h,n+s),r.quadraticCurveTo(o,n+s,o,d),r.stroke()},e.prototype.drawRectangle=function(t,i){if(!0===i.visible)if(i.cornerRadius)i.width<30||i.height<30?this.drawRoundedRect(t,i):(i.data=d(i.cornerRadius,i.height,i.width),this.drawPath(t,i));else{var r=e.getContext(t);i.shadow&&this.renderShadow(i,t),r.save(),r.beginPath();i.cornerRadius;var o=i.x+i.width*i.pivotX,n=i.y+i.height*i.pivotY;this.rotateContext(t,i.angle,o,n),this.setStyle(t,i),r.rect(i.x,i.y,i.width,i.height),r.fillRect(i.x,i.y,i.width,i.height),r.fill(),r.stroke(),r.closePath(),r.restore()}},e.prototype.drawPath=function(t,i){var r=[];r=c(r=s(i.data)),i.shadow&&this.renderShadow(i,t,r);var o=e.getContext(t);o.save(),o.beginPath();var n=i.y+i.height*i.pivotY,a=i.x+i.width*i.pivotX;"Horizontal"===i.flip||"Vertical"===i.flip?(o.translate(i.x+i.width/2,i.y+i.height/2),o.rotate(-i.angle*Math.PI/180),o.translate(-i.x-i.width/2,-i.y-i.height/2)):this.rotateContext(t,i.angle,a,n),this.setStyle(t,i),o.translate(i.x,i.y),"Horizontal"===i.flip?(o.scale(-1,1),o.translate(-1*i.width,0)):"Vertical"===i.flip?(o.scale(1,-1),o.translate(0,-1*i.height)):"Both"===i.flip&&(o.scale(-1,-1),o.translate(-1*i.width,-1*i.height)),this.renderPath(t,i,r),o.fill(),o.translate(-i.x,-i.y),o.stroke(),o.restore()},e.prototype.renderPath=function(t,i,r){if(!0===i.visible){var o,n=e.getContext(t),a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=void 0,p=void 0,g=void 0,u=void 0,f=r;for(p=0,g=0,u=0,o=f.length;u<o;++u){var m=f[u],y=m.command;switch("x1"in m&&(h=m.x1),"x2"in m&&(l=m.x2),"y1"in m&&(d=m.y1),"y2"in m&&(c=m.y2),"x"in m&&(p=m.x),"y"in m&&(g=m.y),y){case"M":n.moveTo(p,g),m.x=p,m.y=g;break;case"L":n.lineTo(p,g),m.x=p,m.y=g;break;case"C":n.bezierCurveTo(h,d,l,c,p,g),m.x=p,m.y=g,m.x1=h,m.y1=d,m.x2=l,m.y2=c;break;case"Q":n.quadraticCurveTo(h,d,p,g),m.x=p,m.y=g,m.x1=h,m.y1=d;break;case"A":var v={x:a,y:s},b=m.r1,w=m.r2,x=m.angle*(Math.PI/180),C=m.largeArc,S=m.sweep,P={x:p,y:g},T={x:Math.cos(x)*(v.x-P.x)/2+Math.sin(x)*(v.y-P.y)/2,y:-Math.sin(x)*(v.x-P.x)/2+Math.cos(x)*(v.y-P.y)/2},A=Math.pow(T.x,2)/Math.pow(b,2)+Math.pow(T.y,2)/Math.pow(w,2);A>1&&(b*=Math.sqrt(A),w*=Math.sqrt(A));var z=Math.pow(w,2)*Math.pow(T.x,2),O=(C===S?-1:1)*Math.sqrt((Math.pow(b,2)*Math.pow(w,2)-Math.pow(b,2)*Math.pow(T.y,2)-z)/(Math.pow(b,2)*Math.pow(T.y,2)+Math.pow(w,2)*Math.pow(T.x,2)));isNaN(O)&&(O=0);var I={x:O*b*T.y/w,y:O*-w*T.x/b},D={x:(v.x+P.x)/2+Math.cos(x)*I.x-Math.sin(x)*I.y,y:(v.y+P.y)/2+Math.sin(x)*I.x+Math.cos(x)*I.y},E=this.a([1,0],[(T.x-I.x)/b,(T.y-I.y)/w]),B=[(T.x-I.x)/b,(T.y-I.y)/w],L=[(-T.x-I.x)/b,(-T.y-I.y)/w],M=this.a(B,L);if(this.r(B,L)<=-1&&(M=Math.PI),this.r(B,L)>=1&&(M=0),m.centp=D,m.xAxisRotation=x,m.rx=b,m.ry=w,m.a1=E,m.ad=M,m.sweep=S,null!=n){var k=b>w?b:w,R=b>w?1:b/w,N=b>w?w/b:1;n.save(),n.translate(D.x,D.y),n.rotate(x),n.scale(R,N),n.arc(0,0,k,E,E+M,!S),n.scale(1/R,1/N),n.rotate(-x),n.translate(-D.x,-D.y),n.restore()}break;case"Z":case"z":n.closePath(),p=a,g=s}a=p,s=g}}},e.prototype.drawText=function(t,i,r,o,n,a,s){if(i.content&&!0===i.visible){var h=e.getContext(t);h.save(),this.setStyle(t,i),a&&(i.fontSize*=a);var d=i.x+i.width*i.pivotX,l=i.y+i.height*i.pivotY;this.rotateContext(t,i.angle,d,l),this.setFontStyle(t,i);var c,p=0;c=i.childNodes;var g=i.wrapBounds;if(h.fillStyle=i.color,g){var u=this.labelAlign(i,g,c);for(p=0;p<c.length;p++){var f=c[p];f.x=bh(f,c,p,i);var m=u.x+(a?f.x*a:f.x)-g.x,y=u.y+(a?f.dy*a:f.dy)*p+.8*i.fontSize;if(g.width>i.width&&"Wrap"!==i.textOverflow&&"NoWrap"===i.textWrapping&&(f.text=kh(f.text,i)),"Clip"!==i.textOverflow&&"Ellipsis"!==i.textOverflow||"Wrap"!==i.textWrapping)h.fillText(f.text,m,y);else if(y<s.actualSize.height+s.bounds.y){if("Ellipsis"===i.textOverflow&&c[p+1]){var v=c[p+1];u.y+v.dy*(p+1)+.8*i.fontSize>s.actualSize.height+s.bounds.y&&(f.text=f.text.slice(0,f.text.length-3),f.text=f.text.concat("..."))}h.fillText(f.text,m,y)}if("Underline"===i.textDecoration||"Overline"===i.textDecoration||"LineThrough"===i.textDecoration){var b=m,w=void 0,x=m+h.measureText(f.text).width,C=void 0;switch(i.textDecoration){case"Underline":w=y+2,C=y+2;break;case"Overline":w=u.y+f.dy*p,C=u.y+f.dy*p;break;case"LineThrough":w=(y+u.y+f.dy*p)/2+2,C=(y+u.y+f.dy*p)/2+2}h.beginPath(),h.moveTo(b,w),h.lineTo(x,C),h.strokeStyle=i.color,h.lineWidth=.08*i.fontSize,h.globalAlpha=i.opacity,h.stroke()}}}h.restore()}},e.prototype.loadImage=function(e,t,i,r,o){this.rotateContext(i,t.angle,r,o);var n=new Image;n.src=t.source,this.image(e,n,t.x,t.y,t.width,t.height,t)},e.prototype.drawImage=function(t,i,r,o){var n=this;if(i.visible){var a=e.getContext(t);a.save();var s=i.x+i.width*i.pivotX,h=i.y+i.height*i.pivotY,d=new Image;d.src=i.source;var l=a.canvas.id.split("_");l[l.length-1];o?d.onload=function(){n.loadImage(a,i,t,s,h)}:this.loadImage(a,i,t,s,h),a.restore()}},e.prototype.image=function(e,t,i,r,o,n,a){e.beginPath();var s=t.width,h=t.height,d=o,l=n,c=0,p=0;if(a&&"None"!==a.alignment){var g=a.alignment.toLowerCase().substr(1,3),u=a.alignment.toLowerCase().substr(5,3);if("Slice"===a.scale){var f=function(){c=d,p=h*d/s},m=function(){c=s*l/h,p=l};d>l?(f(),l>p&&m()):d===l?s>h?m():f():(m(),d>c&&f());var y=this.getSliceOffset(g,c,d,s),v=this.getSliceOffset(u,p,l,h),b=s-y,w=h-v,x=c-y*(c/s),C=p-v*(p/h),S=hh("canvas",{width:o.toString(),height:n.toString()});S.getContext("2d").drawImage(t,y,v,b,w,0,0,x,C),e.drawImage(S,i,r,o,n)}else if("Meet"===a.scale){var P=h/s,T=l/d;c=T>P?d:l/P,p=T>P?d*P:l,i+=this.getMeetOffset(g,c,d),r+=this.getMeetOffset(u,p,l),e.drawImage(t,0,0,s,h,i,r,c,p)}else e.drawImage(t,i,r,o,n)}else if("None"!==a.flip){var A=1,z=1;"Horizontal"!==a.flip&&"Both"!==a.flip||(i=-i,o=-o,A=-1),"Vertical"!==a.flip&&"Both"!==a.flip||(r=-r,n=-n,z=-1),e.scale(A,z),e.drawImage(t,i,r,o,n)}else e.drawImage(t,i,r,o,n);e.closePath()},e.prototype.getSliceOffset=function(e,t,i,r){switch(e){case"min":return 0;case"mid":return(t-i)/2*r/t;case"max":return(t-i)*r/t;default:return 0}},e.prototype.getMeetOffset=function(e,t,i){var r=Math.max(t,i),o=Math.min(t,i);switch(e){case"min":return 0;case"mid":return(r-o)/2;case"max":return r-o;default:return 0}},e.prototype.m=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},e.prototype.r=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(this.m(e)*this.m(t))},e.prototype.a=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(this.r(e,t))},e.prototype.labelAlign=function(e,t,r){var o=new i(t.width,r.length*(1.2*e.fontSize)),n={x:0,y:0},a=e.x,s=e.y,h=.5*e.width,d=.5*e.height;return"left"===e.textAlign?h=0:"center"===e.textAlign?h=t.width>e.width&&("Ellipsis"===e.textOverflow||"Clip"===e.textOverflow)&&"NoWrap"===e.textWrapping?0:.5*e.width:"right"===e.textAlign&&(h=1*e.width),n.x=a+h+(t?t.x:0),n.y=s+d-o.height/2,n},e}(),Zh=function(){function e(){}return e.prototype.renderShadow=function(e,t,i,r){void 0===i&&(i=null);var o,n,s=a.transform({x:0,y:0},e.shadow.angle,e.shadow.distance);r&&(n=r.getElementById(t.id+"_shadow")),n||(o=i?"path":"rect",n=document.createElementNS("http://www.w3.org/2000/svg",o),t.appendChild(n));var h={id:t.id+"_shadow",fill:e.shadow.color,stroke:e.shadow.color,opacity:e.shadow.opacity.toString(),transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")translate("+(e.x+s.x)+","+(e.y+s.y)+")"};if(r){var d=r.getElementById(t.id);d&&d.insertBefore(n,d.firstChild)}fh(n,h),i?i&&this.renderPath(n,e,i):fh(n,{width:e.width,height:e.height})},e.prototype.parseDashArray=function(e){return[]},e.prototype.drawRectangle=function(e,t,i,r,o,n,a){var s,h,d;t.shadow&&!r&&this.renderShadow(t,e,void 0,n),s=t.id===e.id?t.id+"_container":t.id,n&&(h=n.getElementById(s)),h&&!o||(h=document.createElementNS("http://www.w3.org/2000/svg","rect"),e.appendChild(h)),n&&!t.shadow&&(d=n.getElementById(t.id+"_groupElement_shadow"))&&d.parentNode.removeChild(d);var l={id:s,x:t.x.toString(),y:t.y.toString(),width:t.width.toString(),height:t.height.toString(),visibility:t.visible?"visible":"hidden",transform:"rotate("+t.angle+","+(t.x+t.width*t.pivotX)+","+(t.y+t.height*t.pivotY)+")",rx:t.cornerRadius||0,ry:t.cornerRadius||0,opacity:t.opacity,"aria-label":a||""};t.class&&(l.class=t.class);a||(l["pointer-events"]="none"),fh(h,l),this.setSvgStyle(h,t,i)},e.prototype.updateSelectionRegion=function(e,t){var i;i=e.parentNode.getElementById(t.id);var r={id:t.id,x:t.x.toString(),y:t.y.toString(),width:t.width.toString(),height:t.height.toString(),transform:"rotate("+t.angle+","+(t.x+t.width*t.pivotX)+","+(t.y+t.height*t.pivotY)+")",class:"e-diagram-selected-region"};i||(i=document.createElementNS("http://www.w3.org/2000/svg","rect"),e.appendChild(i)),this.setSvgStyle(i,t),fh(i,r)},e.prototype.createGElement=function(e,t){return dh(e,t)},e.prototype.drawLine=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","line");this.setSvgStyle(i,t);var r=t.x+t.width*t.pivotX,o=t.y+t.height*t.pivotY,n={id:t.id,x1:t.startPoint.x+t.x,y1:t.startPoint.y+t.y,x2:t.endPoint.x+t.x,y2:t.endPoint.y+t.y,stroke:t.stroke,"stroke-width":t.strokeWidth.toString(),opacity:t.opacity.toString(),transform:"rotate("+t.angle+" "+r+" "+o+")",visibility:t.visible?"visible":"hidden"};t.class&&(n.class=t.class),fh(i,n),e.appendChild(i)},e.prototype.drawCircle=function(e,t,i,r){var o=document.createElementNS("http://www.w3.org/2000/svg","circle");this.setSvgStyle(o,t);var n=t.class||"";i||(n+=" e-disabled");var a={id:t.id,cx:t.centerX,cy:t.centerY,r:t.radius,visibility:t.visible?"visible":"hidden",class:n,"aria-label":r?r["aria-label"]:""};o.style.display=t.visible?"block":"none",fh(o,a),e.appendChild(o)},e.prototype.drawPath=function(e,t,i,r,o,n){var a,h,d=[];d=c(d=s(t.data)),t.shadow&&this.renderShadow(t,e,d,o),o&&!t.shadow&&(a=o.getElementById(t.id+"_groupElement_shadow"))&&a.parentNode.removeChild(a),o&&(h=o.getElementById(t.id)),h&&!r||(h=document.createElementNS("http://www.w3.org/2000/svg","path"),e.appendChild(h)),this.renderPath(h,t,d);var l={id:t.id,transform:"rotate("+t.angle+","+(t.x+t.width*t.pivotX)+","+(t.y+t.height*t.pivotY)+")translate("+t.x+","+t.y+")",visibility:t.visible?"visible":"hidden",opacity:t.opacity,"aria-label":n||""};t.class&&(l.class=t.class),fh(h,l),this.setSvgStyle(h,t,i)},e.prototype.renderPath=function(e,t,i){var r,o,n,a,s,h,d,l,c=i,p="";for(s=0,h=0,l=0,d=c.length;l<d;++l){var g=c[l],u=g.command;switch("x1"in g&&(r=g.x1),"x2"in g&&(n=g.x2),"y1"in g&&(o=g.y1),"y2"in g&&(a=g.y2),"x"in g&&(s=g.x),"y"in g&&(h=g.y),u){case"M":p=p+"M"+s.toString()+","+h.toString()+" ";break;case"L":p=p+"L"+s.toString()+","+h.toString()+" ";break;case"C":p=p+"C"+r.toString()+","+o.toString()+","+n.toString()+","+a.toString()+",",p+=s.toString()+","+h.toString()+" ";break;case"Q":p=p+"Q"+r.toString()+","+o.toString()+","+s.toString()+","+h.toString()+" ";break;case"A":p=p+"A"+g.r1.toString()+","+g.r2.toString()+","+g.angle.toString()+",",p+=g.largeArc.toString()+","+g.sweep+","+s.toString()+","+h.toString()+" ";break;case"Z":case"z":p+="Z "}}e.setAttribute("d",p)},e.prototype.setSvgFontStyle=function(e,t){e.style.fontStyle=t.italic?"italic":"normal",e.style.fontWeight=t.bold?"bold":"normal",e.style.fontSize=t.fontSize.toString()+"px",e.style.fontFamily=t.fontFamily},e.prototype.drawText=function(e,t,i,r,o,n,a){if(void 0!==t.content){var s=void 0,h=void 0,d=void 0,l=void 0,c=void 0,p=void 0,g=0,u=0,f=0,m=void 0;if(i&&(m=i.getElementById(t.id+"_text")),m){if(t.doWrap)for(;m.firstChild;)m.removeChild(m.firstChild)}else t.doWrap=!0,m=document.createElementNS("http://www.w3.org/2000/svg","text"),"pre-wrap"===t.whiteSpace&&m.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),e.appendChild(m);var y=t.x+t.width*t.pivotX,v=t.y+t.height*t.pivotY,b=0;if(t.doWrap||"Wrap"!==t.textOverflow){var w=document.getElementById(t.id+"_text");for(w&&(w.innerHTML=""),this.setSvgStyle(m,t,o),this.setSvgFontStyle(m,t),s=document.createTextNode(t.content),h=t.childNodes,d=t.wrapBounds,l=this.svgLabelAlign(t,d,h),d.width>t.width&&"Wrap"!==t.textOverflow&&"NoWrap"===t.textWrapping&&(h[0].text=kh(t.content,t)),f=0;f<h.length;f++)if(p=document.createElementNS("http://www.w3.org/2000/svg","tspan"),s=document.createTextNode(h[f].text),(c=h[f]).x=bh(c,h,f,t),g=l.x+c.x-d.x,u=l.y+c.dy*f+.8*t.fontSize,"Clip"!==t.textOverflow&&"Ellipsis"!==t.textOverflow||"WrapWithOverflow"!==t.textWrapping&&"Wrap"!==t.textWrapping||!a)this.setText(m,p,c,s,g,u);else{var x=t.isHorizontalLane?a.actualSize.width:a.actualSize.height;if(!(u<x))break;if("Ellipsis"===t.textOverflow&&h[f+1]){var C=h[f+1];l.y+C.dy*(f+1)+.8*t.fontSize>x&&(c.text=c.text.slice(0,c.text.length-3),c.text=c.text.concat("..."),s.data=c.text)}this.setText(m,p,c,s,g,u),b+=c.dy}}b&&t.isHorizontalLane&&(y=t.parentOffsetX+t.pivotX,v=t.parentOffsetY+t.pivotY,t.y=t.parentOffsetY-b*t.pivotY+.5),t.textDecoration&&"LineThrough"===t.textDecoration&&(t.textDecoration=Bh(t.textDecoration)),fh(m,{id:t.id+"_text",fill:t.color,visibility:t.visible?"visible":"hidden","text-decoration":t.textDecoration,transform:"rotate("+t.angle+","+y+","+v+")translate("+t.x+","+t.y+")",opacity:t.opacity,"aria-label":r||""})}},e.prototype.setText=function(e,t,i,r,o,n){fh(t,{x:o.toString(),y:n.toString()}),e.setAttribute("fill",i.text),t.appendChild(r),e.appendChild(t)},e.prototype.drawImage=function(e,t,i,r){var o;i&&(o=i.getElementById(t.id+"image")),o||(o=document.createElementNS("http://www.w3.org/2000/svg","image"),e.appendChild(o));var n=new Image;n.src=t.source;var a="None"!==t.scale?t.scale:"";sf.base.isBlazor()&&"None"===t.alignment&&"Stretch"===a&&(a="");var s=t.alignment,h=s.charAt(0).toLowerCase()+s.slice(1);a&&(h+=" "+a.charAt(0).toLowerCase()+a.slice(1)),fh(o,{id:t.id+"image",x:t.x.toString(),y:t.y.toString(),transform:"rotate("+t.angle+","+(t.x+t.width*t.pivotX)+","+(t.y+t.height*t.pivotY)+")",width:t.width.toString(),visibility:t.visible?"visible":"hidden",height:t.height.toString(),preserveAspectRatio:h,opacity:(t.opacity||1).toString()}),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n.src.toString())},e.prototype.drawHTMLContent=function(e,t,i,r,o){var n,a;if(t){var s=void 0,h=void 0,d=void 0;for(s=0;s<t.childNodes.length;s++)for(d=t.childNodes[s],h=0;h<d.childNodes.length;h++)if(d.childNodes[h].id===e.id+"_html_element"){n=d.childNodes[h];break}}if(!n){if(!(a=t.querySelector("#"+e.id+"_html_element")||t.querySelector("#"+e.nodeId+"_html_element")))a=hh("div",{id:e.nodeId+"_html_element",class:"foreign-object"});n=hh("div",{id:e.id+"_html_element",class:"foreign-object"}),e.isTemplate?n.appendChild(e.template):n.appendChild(e.template.cloneNode(!0)),void 0!==o&&t.childNodes.length>o&&t.insertBefore(n,t.childNodes[o]),a.appendChild(n),t.appendChild(a)}var l=Ph(e).topLeft;n.setAttribute("style","height:"+e.actualSize.height+"px; width:"+e.actualSize.width+"px;left:"+l.x+"px; top:"+l.y+"px;position:absolute;transform:rotate("+(e.rotateAngle+e.parentTransform)+"deg);pointer-events:"+(r?"all":"none")+";visibility:"+(e.visible?"visible":"hidden")+";opacity:"+e.style.opacity+";")},e.prototype.drawNativeContent=function(e,t,i,r,o){var n,a;o&&(n=o.getElementById(e.id+"_native_element"),a=o.getElementById(e.id+"_clip")),n||((n=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",e.id+"_native_element"),n.appendChild(e.template.cloneNode(!0)),t.appendChild(n)),a&&n.removeChild(a),n.setAttribute("style","visibility:"+(e.visible?"visible":"hidden")+";opacity:"+e.style.opacity+";"),this.setNativTransform(e,n,i,r),"Slice"===e.scale&&this.drawClipPath(e,n,i,r,o),fh(n,e.description?{"aria-label":e.description}:{})},e.prototype.setNativTransform=function(e,t,i,r){var o=0!==e.contentSize.width?e.contentSize.width:1,n=0!==e.contentSize.height?e.contentSize.height:1,a=e.templatePosition.x*r/o,s=e.templatePosition.y*i/n;t.setAttribute("transform","rotate("+e.parentTransform+","+e.offsetX+","+e.offsetY+") translate("+(e.offsetX-a-r*e.pivot.x)+","+(e.offsetY-s-i*e.pivot.y)+") scale("+r/o+","+i/n+")")},e.prototype.drawClipPath=function(e,t,i,r,o){var n=e.contentSize.width,a=e.contentSize.height,s=e.width/(r/n),h=e.height/(i/a),d=e.templatePosition.x+(e.width>=e.height?0:(n-s)/2),l=e.templatePosition.y+(e.height>=e.width?0:(a-h)/2),c=o.getElementById(e.id+"_clip");(c=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id",e.id+"_clip"),t.appendChild(c);var p=o.getElementById(e.id+"_clip_rect");return p=document.createElementNS("http://www.w3.org/2000/svg","rect"),c.appendChild(p),fh(p,{id:e.id+"_clip_rect",width:s.toString(),height:h.toString(),x:d.toString(),y:l.toString()}),Va()?t.setAttribute("clip-path","url("+location.protocol+"//"+location.host+location.pathname+"#"+e.id+"_clip)"):t.setAttribute("clip-path","url(#"+e.id+"_clip)"),t},e.prototype.renderGradient=function(e,t,i){var r,o,n,a,s,h=oh(i),d=h.getElementById(i+"gradient_pattern");if(d||(d=dh("defs",{id:i+"gradient_pattern"}),h.insertBefore(d,h.firstChild)),ca(t.id),"None"!==e.gradient.type){for(var l=0;l<e.gradient.stops.length;l++)r=r?Math.max(r,e.gradient.stops[l].offset):e.gradient.stops[l].offset,o=o?Math.min(o,e.gradient.stops[l].offset):e.gradient.stops[l].offset;"Linear"===e.gradient.type?((s=e.gradient).id=t.id+"_linear",n=this.createLinearGradient(s),d.appendChild(n)):((a=e.gradient).id=t.id+"_radial",n=this.createRadialGradient(a),d.appendChild(n));for(l=0;l<e.gradient.stops.length;l++){var c=e.gradient.stops[l],p=o<0?(r+c.offset)/(2*r):c.offset/r,g=document.createElementNS("http://www.w3.org/2000/svg","stop");fh(g,{offset:p.toString(),style:"stop-color:"+c.color}),n.appendChild(g)}}return n},e.prototype.createLinearGradient=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");return fh(t,{id:e.id,x1:e.x1+"%",y1:e.y1+"%",x2:e.x2+"%",y2:e.y2+"%"}),t},e.prototype.createRadialGradient=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");return fh(t,{id:e.id,cx:e.cx+"%",cy:e.cy+"%",r:e.r+"%",fx:e.fx+"%",fy:e.fy+"%"}),t},e.prototype.setSvgStyle=function(e,t,i){if(t.canApplyStyle||void 0===t.canApplyStyle){"none"===t.fill&&(t.fill="transparent"),"none"===t.stroke&&(t.stroke="transparent");var r=[],o=void 0;if(t.dashArray)r=(new Fh).parseDashArray(t.dashArray);if(t.gradient&&"None"!==t.gradient.type&&i){var n=this.renderGradient(t,e,i);o=Va()?"url("+location.protocol+"//"+location.host+location.pathname+"#"+n.id+")":"url(#"+n.id+")"}else o=t.fill;t.stroke&&e.setAttribute("stroke",t.stroke),void 0!==t.strokeWidth&&null!==t.strokeWidth&&e.setAttribute("stroke-width",t.strokeWidth.toString()),r&&e.setAttribute("stroke-dasharray",r.toString()||"none"),o&&e.setAttribute("fill",o)}},e.prototype.svgLabelAlign=function(e,t,r){var o=new i(t.width,r.length*(1.2*e.fontSize)),n={x:0,y:0},a=.5*e.width,s=.5*e.height;return"left"===e.textAlign?a=0:"center"===e.textAlign?a=t.width>e.width&&("Ellipsis"===e.textOverflow||"Clip"===e.textOverflow)&&"NoWrap"===e.textWrapping?0:.5*e.width:"right"===e.textAlign&&(a=1*e.width),n.x=0+a+(t?t.x:0),n.y=1.2+s-o.height/2,n},e}(),qh=function(){function t(e,t,i){this.renderer=null,this.isSvgMode=!0,this.transform={x:0,y:0},this.diagramId=e,this.element=Ks(this.diagramId),this.svgRenderer=t,this.isSvgMode=i,this.renderer=i?new Zh:new Fh}return t.prototype.setCursor=function(e,t){e.style.cursor=t},t.prototype.setLayers=function(){this.iconSvgLayer=this.element.getElementsByClassName("e-ports-expand-layer")[0],this.adornerSvgLayer=this.element.getElementsByClassName("e-adorner-layer")[0],this.nativeSvgLayer=this.element.getElementsByClassName("e-native-layer")[0],this.diagramSvgLayer=this.element.getElementsByClassName("e-diagram-layer")[0]},t.prototype.getAdornerLayer=function(){return eh(this.diagramId)},t.prototype.getParentSvg=function(t,i,r){return this.diagramId&&t&&t.id?t.id.split("_icon_content").length>1||t.id.split("_nodeport").length>1||t.elementActions&e.ElementAction.ElementIsPort?this.iconSvgLayer:i&&"selector"===i?this.adornerSvgLayer:t instanceof je?this.nativeSvgLayer:this.diagramSvgLayer:r},t.prototype.getParentElement=function(t,i,r,o){var n=i;if(r&&this.diagramId&&t&&t.id){t.id.split("_icon_content").length>1?(n=r.getElementById(this.diagramId+"_diagramExpander"),i=null):t.id.split("_nodeport").length>1?n=r.getElementById(this.diagramId+"_diagramPorts"):t instanceof je?(n=r.getElementById(this.diagramId+"_nativeLayer"),i=null):t.elementActions&e.ElementAction.ElementIsPort?(n=r.getElementById(this.diagramId+"_diagramPorts"),i=null):n=r.getElementById(this.diagramId+"_diagramLayer");var a=this.getGroupElement(t,i||n,o);n=a.g,a.svg&&(r=a.svg)}return{g:n,svg:r}},t.prototype.getGroupElement=function(e,t,i){var r,o,n=this.getParentSvg(e);if(t&&n){if(n&&!(r=n.getElementById(e.id+"_groupElement"))&&n!==this.nativeSvgLayer){var a=this.nativeSvgLayer;r=a.getElementById(e.id+"_groupElement"),o=a}r||(r=this.svgRenderer.createGElement("g",{id:e.id+"_groupElement"}),void 0!==i&&t.childNodes.length>i?t.insertBefore(r,t.childNodes[i]):t.appendChild(r))}return{g:r,svg:o}},t.prototype.renderElement=function(e,t,i,r,o,n,a,s,h){e instanceof xe?(e.id=e.id?e.id:xh(),this.renderContainer(e,t,i,r,o,n,a,s,h)):e instanceof Re?this.renderImageElement(e,t,r,o,a):e instanceof Me?this.renderPathElement(e,t,r,o,a,h):e instanceof Se?this.renderTextElement(e,t,r,o,a):e instanceof je?this.renderNativeElement(e,t,r,o,a):e instanceof Yi?this.renderHTMLElement(e,t,i,r,o,a,s):this.renderRect(e,t,r,o,h)},t.prototype.drawSelectionRectangle=function(e,t,i,r,o,n){e=(e+n.tx)*n.scale,t=(t+n.ty)*n.scale;var a={width:i*n.scale,height:r*n.scale,x:e+.5,y:t+.5,fill:"transparent",stroke:"gray",angle:0,pivotX:.5,pivotY:.5,strokeWidth:1,dashArray:"6 3",opacity:1,visible:!0,id:o.id+"_selected_region"},s=this.getAdornerLayer();this.svgRenderer.updateSelectionRegion(s,a)},t.prototype.renderHighlighter=function(e,t,i){var r=e.actualSize.width||2,o=e.actualSize.height||2,n=e.offsetX-r*e.pivot.x,a=e.offsetY-o*e.pivot.y;n=(n+i.tx)*i.scale,a=(a+i.ty)*i.scale;var s={width:r*i.scale,height:o*i.scale,x:n,y:a,fill:"transparent",stroke:"#8CC63F",angle:e.rotateAngle,pivotX:e.pivot.x,pivotY:e.pivot.y,strokeWidth:4,dashArray:"",opacity:1,cornerRadius:0,visible:!0,id:t.id+"_highlighter",class:"e-diagram-highlighter"};this.svgRenderer.drawRectangle(t,s,this.diagramId,void 0,void 0,t)},t.prototype.renderStackHighlighter=function(e,t,i,r,o,n,a){var h,d=e.actualSize.width||2,l=e.offsetX-d*e.pivot.x,c=e.actualSize.height||2,g=e.offsetY-c*e.pivot.y;l=(l+i.tx)*i.scale;var u=e.bounds,m="";if(g=(g+i.ty)*i.scale,r)if(n){h="M 0 0 L "+((b=d*i.scale)+2)+" 0 Z";var y=u.x,v=u.y;y=e.actualSize.width/Number(u.width?u.width:1)*i.scale,v=e.actualSize.height/Number(u.height?u.height:1)*i.scale;m=p(f(s("M7,4 L8,4 8,7 11,7 11,8 8,8 8,11 7,11 7,8 4,8 4,7 7,7 z M7.5,0.99999994C3.9160004,1 1,3.9160004 0.99999994,7.5 1,11.084 3.9160004,14 7.5,14 11.084,14 14,11.084 14,7.5 14,3.9160004 11.084,1 7.5,0.99999994 z M7.5,0 C11.636002,0 15,3.3639984 15,7.5 15,11.636002 11.636002,15 7.5,15 3.3640003,15 0,11.636002 0,7.5 0,3.3639984 3.3640003,0 7.5,0 z")),y+b+2,v-8,!1,u.x,u.y,0,0),o.y>=e.offsetY&&(g+=c)}else{var b;a&&o.y>=e.offsetY&&(g+=c),h="M -10 -10 L 0 0 Z M -10 10 L 0 0 Z M 0 0 L "+(b=d*i.scale)+" 0 Z M "+b+" 0 L "+(b+10)+" 10 Z L "+(b+10)+" -10 Z"}else h="M 10 -10 L 0 0 Z M -10 -10 L 0 0 Z M 0 0 L 0 "+(b=c*i.scale)+" Z M 0  "+b+" L -10  "+(b+10)+" Z L 10  "+(b+10)+" Z",o.x>=e.offsetX&&(l+=d);var w={data:h+m,width:d*i.scale,height:c*i.scale,x:l,y:g,fill:"transparent",stroke:"#8CC63F",angle:e.rotateAngle,pivotX:e.pivot.x,pivotY:e.pivot.y,strokeWidth:1,dashArray:"",opacity:1,visible:!0,id:t.id+"_stack_highlighter",class:"e-diagram-highlighter"};this.svgRenderer.drawPath(t,w,this.diagramId)},t.prototype.drawLine=function(e,t){this.svgRenderer.drawLine(e,t)},t.prototype.drawPath=function(e,t){this.svgRenderer.drawPath(e,t,this.diagramId)},t.prototype.renderResizeHandle=function(t,i,r,o,n,a,s,h,d,l){var c=t.offsetX-t.actualSize.width*t.pivot.x,p=t.offsetY-t.actualSize.height*t.pivot.y,g=t.actualSize.height,u=t.actualSize.width;!l&&r&e.ThumbsConstraints.Rotate&&io(this.rendererActions)&&!ro(this.rendererActions)&&(this.renderPivotLine(t,i,a,n,s),this.renderRotateThumb(t,i,a,n,s)),this.renderBorder(t,i,a,h,d,l);var f=t.actualSize.width*o,m=t.actualSize.height*o;d||!io(this.rendererActions)||ro(this.rendererActions)||(f>=40&&m>=40&&(n&e.SelectorConstraints.ResizeNorthWest&&this.renderCircularHandle("resizeNorthWest",t,c,p,i,ma(n,"ResizeNorthWest"),r&e.ThumbsConstraints.ResizeNorthWest,a,void 0,s,{"aria-label":"Thumb to resize the selected object on top left side direction"},void 0,"e-diagram-resize-handle e-northwest"),n&e.SelectorConstraints.ResizeNorthEast&&this.renderCircularHandle("resizeNorthEast",t,c+u,p,i,ma(n,"ResizeNorthEast"),r&e.ThumbsConstraints.ResizeNorthEast,a,void 0,s,{"aria-label":"Thumb to resize the selected object on top right side direction"},void 0,"e-diagram-resize-handle e-northeast"),n&e.SelectorConstraints.ResizeSouthWest&&this.renderCircularHandle("resizeSouthWest",t,c,p+g,i,ma(n,"ResizeSouthWest"),r&e.ThumbsConstraints.ResizeSouthWest,a,void 0,s,{"aria-label":"Thumb to resize the selected object on bottom left side direction"},void 0,"e-diagram-resize-handle e-southwest"),n&e.SelectorConstraints.ResizeSouthEast&&this.renderCircularHandle("resizeSouthEast",t,c+u,p+g,i,ma(n,"ResizeSouthEast"),r&e.ThumbsConstraints.ResizeSouthEast,a,void 0,s,{"aria-label":"Thumb to resize the selected object on bottom right side direction"},void 0,"e-diagram-resize-handle e-southeast")),n&e.SelectorConstraints.ResizeNorth&&this.renderCircularHandle("resizeNorth",t,c+u/2,p,i,ma(n,"ResizeNorth"),r&e.ThumbsConstraints.ResizeNorth,a,void 0,s,{"aria-label":"Thumb to resize the selected object on top side direction"},void 0,"e-diagram-resize-handle e-north"),n&e.SelectorConstraints.ResizeSouth&&this.renderCircularHandle("resizeSouth",t,c+u/2,p+g,i,ma(n,"ResizeSouth"),r&e.ThumbsConstraints.ResizeSouth,a,void 0,s,{"aria-label":"Thumb to resize the selected object on bottom side direction"},void 0,"e-diagram-resize-handle e-south"),n&e.SelectorConstraints.ResizeWest&&this.renderCircularHandle("resizeWest",t,c,p+g/2,i,ma(n,"ResizeWest"),r&e.ThumbsConstraints.ResizeWest,a,void 0,s,{"aria-label":"Thumb to resize the selected object on left side direction"},void 0,"e-diagram-resize-handle e-west"),n&e.SelectorConstraints.ResizeEast&&this.renderCircularHandle("resizeEast",t,c+u,p+g/2,i,ma(n,"ResizeEast"),r&e.ThumbsConstraints.ResizeEast,a,void 0,s,{"aria-label":"Thumb to resize the selected object on right side direction"},void 0,"e-diagram-resize-handle e-east"))},t.prototype.renderEndPointHandle=function(t,i,r,o,n,s,h,d){var l,c,p=t.sourcePoint,g=t.targetPoint,u=t.wrapper;if(this.renderCircularHandle("connectorSourceThumb",u,p.x,p.y,i,ma(o,"ConnectorSourceThumb"),r&e.ThumbsConstraints.ConnectorSource,n,s,void 0,{"aria-label":"Thumb to move the source point of the connector"},void 0,"e-diagram-endpoint-handle e-targetend"),this.renderCircularHandle("connectorTargetThumb",u,g.x,g.y,i,ma(o,"ConnectorTargetThumb"),r&e.ThumbsConstraints.ConnectorTarget,n,h,void 0,{"aria-label":"Thumb to move the target point of the connector"},void 0,"e-diagram-endpoint-handle e-targetend"),d)if(("Straight"===t.type||"Bezier"===t.type)&&t.segments.length>0)for(l=0;l<t.segments.length-1;l++)c=t.segments[l],this.renderCircularHandle("segementThumb_"+(l+1),u,c.point.x,c.point.y,i,!0,r&e.ThumbsConstraints.ConnectorSource,n,s,null,null,l);else for(l=0;l<t.segments.length;l++){var f=t.segments[l];this.renderOrthogonalThumbs("orthoThumb_"+(l+1),u,f,i,ma(o,"ConnectorSourceThumb"),n)}if("Bezier"===t.type)for(l=0;l<t.segments.length;l++){var m=t.segments[l],y=a.isEmptyPoint(m.point1)?m.bezierPoint1:m.point1;this.renderCircularHandle("bezierPoint_"+(l+1)+"_1",u,y.x,y.y,i,ma(o,"ConnectorSourceThumb"),r&e.ThumbsConstraints.ConnectorSource,n,void 0,void 0,{"aria-label":"Thumb to move the source point of the connector"},void 0,"e-diagram-bezier-handle e-source"),ma(o,"ConnectorSourceThumb")&&this.renderBezierLine("bezierLine_"+(l+1)+"_1",u,i,m.points[0],a.isEmptyPoint(m.point1)?m.bezierPoint1:m.point1,n),y=a.isEmptyPoint(m.point2)?m.bezierPoint2:m.point2,this.renderCircularHandle("bezierPoint_"+(l+1)+"_2",u,y.x,y.y,i,ma(o,"ConnectorTargetThumb"),r&e.ThumbsConstraints.ConnectorTarget,n,void 0,void 0,{"aria-label":"Thumb to move the target point of the connector"},void 0,"e-diagram-bezier-handle e-target"),ma(o,"ConnectorTargetThumb")&&this.renderBezierLine("bezierLine_"+(l+1)+"_2",u,i,m.points[1],a.isEmptyPoint(m.point2)?m.bezierPoint2:m.point2,n)}},t.prototype.renderOrthogonalThumbs=function(e,t,i,r,o,n){var s,h,d,l=0;for(l=0;l<i.points.length-1;l++)d=a.distancePoints(i.points[l],i.points[l+1]),s=i.points[l].y.toFixed(2)===i.points[l+1].y.toFixed(2)?"horizontal":"vertical",h=!!(d>=50&&i.allowDrag),this.renderOrthogonalThumb(e+"_"+(l+1),t,(i.points[l].x+i.points[l+1].x)/2,(i.points[l].y+i.points[l+1].y)/2,r,h,s,n)},t.prototype.renderOrthogonalThumb=function(e,t,i,r,o,n,a,s){var h,d,l;"horizontal"===a?(h="M0,7 L15,0 L30,7 L15,14 z",d=-15,l=-7):(h="M7,0 L0,15 L7,30 L14,15 z",d=-7,l=-15);var c={x:(i+s.tx)*s.scale+d,y:(r+s.ty)*s.scale+l,angle:0,fill:"#e2e2e2",stroke:"black",strokeWidth:1,dashArray:"",data:h,width:20,height:20,pivotX:0,pivotY:0,opacity:1,visible:n,id:e};this.svgRenderer.drawPath(o,c,this.diagramId)},t.prototype.renderPivotLine=function(t,i,r,o,n){var a=t,s=!!(o&e.SelectorConstraints.Rotate);n&&(s=!1);var h=this.getBaseAttributes(a,r);h.fill="None",h.stroke="black",h.strokeWidth=1,h.dashArray="2,3",h.visible=s;var d=r.scale;h.x*=d,h.y*=d,h.width*=d,h.height*=d,h.id="pivotLine",h.class="e-diagram-pivot-line";var l={x:a.actualSize.width*a.pivot.x*d,y:-20},c={x:a.actualSize.width*a.pivot.x*d,y:0};h.startPoint=l,h.endPoint=c,this.svgRenderer.drawLine(i,h)},t.prototype.renderBezierLine=function(e,t,i,r,o,n){var a=this.getBaseAttributes(t,n);a.id=e,a.stroke="black",a.strokeWidth=1,a.dashArray="3,3",a.fill="None",a.class="e-diagram-bezier-line",a.x=0,a.y=0;var s=n.scale,h={x:(r.x+n.tx)*s,y:(r.y+n.ty)*s},d={x:(o.x+n.tx)*s,y:(o.y+n.ty)*s};a.startPoint=h,a.endPoint=d,this.svgRenderer.drawLine(i,a)},t.prototype.renderCircularHandle=function(e,t,i,r,o,n,a,s,h,d,l,c,p){var g=t,u=7,f={x:i,y:r};if(0!==g.rotateAngle||0!==g.parentTransform){var m=x();P(m,g.rotateAngle+g.parentTransform,g.offsetX,g.offsetY),f=C(m,f)}var y=this.getBaseAttributes(g);y.stroke="black",y.strokeWidth=1,void 0!==c?(u=5,y.id="segmentEnd_"+c,y.fill="#e2e2e2"):(u=7,y.fill=h?"#8CC63F":"white"),y.centerX=(f.x+s.tx)*s.scale,y.centerY=(f.y+s.ty)*s.scale,y.radius=u,y.angle=0,y.id=e,y.visible=n,y.class=p,h&&(y.class+=" e-connected"),d&&(y.visible=!1),this.svgRenderer.drawCircle(o,y,a,l)},t.prototype.renderBorder=function(t,i,r,o,n,a){var s=t,h=this.getBaseAttributes(s,r);h.x*=r.scale,h.y*=r.scale,h.width*=r.scale,h.height*=r.scale,h.fill="transparent",h.stroke="#097F7F",h.strokeWidth=1.2,h.gradient=null,h.dashArray="6,3",h.class="e-diagram-border",a&&(h.class+=" e-diagram-lane"),h.id="borderRect",h.id=this.rendererActions&e.RendererAction.DrawSelectorBorder?"borderRect_symbol":"borderRect",o||(h.class+=" e-disabled"),n&&(h.class+=" e-thick-border"),h.cornerRadius=0;var d=this.getParentSvg(t,"selector");this.svgRenderer.drawRectangle(i,h,this.diagramId,void 0,!0,d)},t.prototype.renderUserHandler=function(t,r,o,n){for(var a,h=t.wrapper,d=0,l=t.userHandles;d<l.length;d++){var c=l[d];a=!0,(c.disableConnectors&&t.connectors.length>0||c.disableNodes&&t.nodes.length>0)&&(a=!1);var g=document.getElementById(c.name+"_template_hiddenUserHandle");g&&(c.template=g.childNodes[0].cloneNode(!0));var u=ua(t,c,o);if(u.x=(u.x+o.tx)*o.scale,u.y=(u.y+o.ty)*o.scale,c.visible&&(c.visible=!!(t.constraints&e.SelectorConstraints.UserHandle)),a)if(c.pathData){var m=c.pathData?c.pathData:c.content,y=this.getBaseAttributes(h);y.id=c.name+"_userhandle",y.fill=c.backgroundColor,y.stroke=c.borderColor,y.strokeWidth=c.borderWidth,y.centerX=u.x,y.centerY=u.y,y.radius=.5*c.size,y.class="e-diagram-userhandle-circle",y.angle=0,y.visible=c.visible,y.opacity=1,this.svgRenderer.drawCircle(r,y,1,{"aria-label":c.name+"user handle"});var v=[];v=f(v=s(m));var b=Gs(m),w=p(v,(c.size-.45*c.size)/b.width,(c.size-.45*c.size)/b.height,!0,b.x,b.y,0,0);b=Gs(w);var x={x:u.x-b.width/2,y:u.y-b.height/2,angle:0,id:"",class:"e-diagram-userhandle-path",fill:c.pathColor,stroke:c.backgroundColor,strokeWidth:.5,dashArray:"",data:w,width:c.size-5,height:c.size-5,pivotX:0,pivotY:0,opacity:1,visible:c.visible};this.svgRenderer.drawPath(r,x,this.diagramId,void 0,void 0,{"aria-label":c.name+"user handle"})}else if(c.content){var C=new je(c.name,this.diagramId);C.content=c.content,C.offsetX=u.x,C.offsetY=u.y,C.id=c.name+"_shape",C.horizontalAlignment="Center",C.verticalAlignment="Center",C.visible=c.visible,C.setOffsetWithRespectToBounds(u.x,u.y,"Fraction"),C.relativeMode="Object",C.description=c.name||"User handle",C.measure(new i(c.size,c.size)),C.arrange(C.desiredSize),this.svgRenderer.drawNativeContent(C,r,c.size,c.size,this.adornerSvgLayer)}else if(c.source){var S=new Re;(x=this.getBaseAttributes(S,o)).width=c.size,x.height=c.size,x.x=u.x-c.size/2,x.y=u.y-c.size/2,x.sourceWidth=c.size,x.sourceHeight=c.size,x.alignment=S.imageAlign,x.source=c.source,x.scale=S.imageScale,x.visible=c.visible,x.description=c.name||"User handle",x.id=c.name+"_",this.renderer.drawImage(r,x,this.adornerSvgLayer,!1)}else{var P=new Yi(c.name,this.diagramId);P.offsetX=u.x,P.offsetY=u.y,P.id=c.name+"_shape",P.visible=c.visible,P.relativeMode="Object",P.template=c.template,P.measure(new i(c.size,c.size)),P.arrange(P.desiredSize),this.svgRenderer.drawHTMLContent(P,n,void 0,!0,void 0)}}},t.prototype.renderRotateThumb=function(t,r,o,n,a){new Me;var s,h=new i;h.width=18,h.height=16;var d=t.offsetY-t.actualSize.height*t.pivot.y,l=t.offsetX-t.actualSize.width*t.pivot.x,c=!!(n&e.SelectorConstraints.Rotate);a&&(c=!1);var p=l+t.pivot.x*t.actualSize.width,g=d;if(p=(p+o.tx)*o.scale,g=(g+o.ty)*o.scale,s={x:p-.5*h.width,y:g-30-.5*h.height},0!==t.rotateAngle||0!==t.parentTransform){var u=x();P(u,t.rotateAngle+t.parentTransform,(o.tx+t.offsetX)*o.scale,(o.ty+t.offsetY)*o.scale),s=C(u,s)}var f={x:s.x,y:s.y,angle:t.rotateAngle+t.parentTransform,fill:"#231f20",stroke:"black",strokeWidth:.5,dashArray:"",data:"M 16.856144362449648 10.238890446662904 L 18.000144362449646 3.437890446662903L 15.811144362449646 4.254890446662903 C 14.837144362449646 2.5608904466629028 13.329144362449647  1.2598904466629026 11.485144362449645 0.5588904466629026 C 9.375144362449646 - 0.24510955333709716 7.071144362449646  - 0.18010955333709716 5.010144362449646 0.7438904466629028 C 2.942144362449646 1.6678904466629028 1.365144362449646 3.341890446662903 0.558144362449646 5.452890446662903 C - 0.244855637550354 7.567890446662903 - 0.17985563755035394 9.866890446662904 0.7431443624496461 11.930890446662904 C 1.6681443624496461 13.994890446662904 3.343144362449646 15.575890446662903 5.457144362449647 16.380890446662903 C 6.426144362449647 16.7518904466629 7.450144362449647 16.9348904466629 8.470144362449647 16.9348904466629 C 9.815144362449647 16.9348904466629 11.155144362449647 16.6178904466629 12.367144362449647 15.986890446662901 L 11.351144362449647 14.024890446662901 C 9.767144362449647 14.8468904466629 7.906144362449647 14.953890446662902 6.237144362449647 14.3178904466629 C 4.677144362449647 13.7218904466629 3.444144362449647 12.5558904466629 2.758144362449647 11.028890446662901 C 2.078144362449646 9.501890446662903 2.031144362449646 7.802890446662903 2.622144362449646 6.243890446662903 C 3.216144362449646 4.6798904466629025 4.387144362449646 3.442890446662903 5.914144362449646 2.760890446662903 C 7.437144362449646 2.078890446662903 9.137144362449646 2.0298904466629026 10.700144362449645 2.6258904466629027 C 11.946144362449646 3.100890446662903 12.971144362449646 3.9538904466629026 13.686144362449646 5.049890446662903 L 11.540144362449645 5.850890446662903 L 16.856144362449648 10.238890446662904 Z",width:20,height:20,pivotX:0,pivotY:0,opacity:1,visible:c,id:t.id,class:"e-diagram-rotate-handle"};f.id="rotateThumb",this.svgRenderer.drawPath(r,f,this.diagramId,!0,void 0,{"aria-label":"Thumb to rotate the selected object"})},t.prototype.renderPathElement=function(e,t,i,r,o,n){var a=this.getBaseAttributes(e,i,n);a.data=e.absolutePath,a.data=e.absolutePath;var s=e.description?e.description:e.id;if(this.isSvgMode||(a.x=e.flipOffset.x?e.flipOffset.x:a.x,a.y=e.flipOffset.y?e.flipOffset.y:a.y),e.isExport){var h=e.absoluteBounds;a.data=Zs(e,h,0,a)}this.renderer.drawPath(t,a,this.diagramId,void 0,r,s)},t.prototype.renderSvgGridlines=function(t,i,r,o,n,a){var s=document.createElementNS("http://www.w3.org/2000/svg","pattern"),h=document.createElementNS("http://www.w3.org/2000/svg","defs");h.setAttribute("id",this.diagramId+"_grid_pattern_defn"),(t.constraints&e.SnapConstraints.ShowHorizontalLines||t.constraints&e.SnapConstraints.ShowVerticalLines)&&s.setAttribute("id",this.diagramId+"_pattern");var d=0,l=0,c=0,p=0,g=1,u=!1,f="Lines"===t.gridType,m=f?t.verticalGridlines.lineIntervals:t.verticalGridlines.dotIntervals,y=f?t.horizontalGridlines.lineIntervals:t.horizontalGridlines.dotIntervals;if(o.showRulers&&o.dynamicGrid&&n&&a)c=a.updateSegmentWidth(r.scale),p=n.updateSegmentWidth(r.scale),t.horizontalGridlines.scaledIntervals=[c/n.interval],t.verticalGridlines.scaledIntervals=[p/a.interval],u=!0;else{for(var v=0;v<m.length;v+=1)d+=m[v];for(v=0;v<y.length;v+=1)l+=y[v];g=this.scaleSnapInterval(t,r.scale)}d=u?p:d*g,l=u?c:l*g,fh(s,{id:this.diagramId+"_pattern",x:0,y:0,width:d,height:l,patternUnits:"userSpaceOnUse"}),this.horizontalSvgGridlines(s,d,l,g,t,o,a,u,f,y),this.verticalSvgGridlines(s,d,l,g,t,o,n,u,f,m),h.appendChild(s),i.appendChild(h)},t.prototype.horizontalSvgGridlines=function(t,i,r,o,n,a,s,h,d,l){var c,p=0,g=[];if(n.constraints&e.SnapConstraints.ShowHorizontalLines){n.horizontalGridlines.lineDashArray&&(g=this.renderer.parseDashArray(n.horizontalGridlines.lineDashArray)),a.showRulers&&a.dynamicGrid&&s&&(l=this.updateLineIntervals(l,a,s,r,d)),l=An(l,d);for(var u=0;u<l.length;u+=2){p=Tn(l,d,u,p);c=document.createElementNS("http://www.w3.org/2000/svg",d?"path":"circle");var f=d?p+l[u]/2:p;f=h?f:f*o;d?(fh(c,{"stroke-width":l[u],stroke:n.horizontalGridlines.lineColor,d:"M0,"+f+" L"+i+","+f+" Z",dashArray:g.toString(),class:1.25===l[u]?"e-diagram-thick-grid":"e-diagram-thin-grid"}),t.appendChild(c),p+=l[u+1]+l[u]):(this.renderDotGrid(u,t,n,0,f,o,!0),p+=l[u])}}},t.prototype.renderDotGrid=function(e,t,i,r,o,n,a){var s,h,d,l=a?i.verticalGridlines.dotIntervals:i.horizontalGridlines.dotIntervals;l=An(l,!1);for(var c=1;c<l.length;c+=2)s=c===l.length-1?l[0]:l[c-1],d=r,d*=n,fh(h=document.createElementNS("http://www.w3.org/2000/svg","circle"),{cx:a?d:o,cy:a?o:d,fill:i.horizontalGridlines.lineColor,r:s}),t.appendChild(h),r+=l[c]+l[c-1]},t.prototype.verticalSvgGridlines=function(t,i,r,o,n,a,s,h,d,l){var c,p=0,g=[];if(n.constraints&e.SnapConstraints.ShowVerticalLines){n.verticalGridlines.lineDashArray&&(g=this.renderer.parseDashArray(n.verticalGridlines.lineDashArray)),a.showRulers&&a.dynamicGrid&&s&&(l=this.updateLineIntervals(l,a,s,i,d));l=An(l,d);for(var u=0;u<l.length;u+=2){p=Tn(l,d,u,p),c=document.createElementNS("http://www.w3.org/2000/svg",d?"path":"circle");var f=d?p+l[u]/2:p;f=h?f:f*o;d?(fh(c,{"stroke-width":l[u],stroke:n.verticalGridlines.lineColor,d:"M"+f+",0 L"+f+","+r+" Z",dashArray:g.toString(),class:1.25===l[u]?"e-diagram-thick-grid":"e-diagram-thin-grid"}),t.appendChild(c),p+=l[u+1]+l[u]):(this.renderDotGrid(u,t,n,0,f,o,!1),p+=l[u])}}},t.prototype.updateGrid=function(e,t,i,r,o,n){var a=t.getElementById(this.diagramId+"_grid_rect"),s=!1;if(a){var h=t.getElementById(this.diagramId+"_pattern");h&&h.parentNode.removeChild(h);var d=0,l=0,c=1,p="Lines"===e.gridType,g=p?e.verticalGridlines.lineIntervals:e.verticalGridlines.dotIntervals,u=p?e.horizontalGridlines.lineIntervals:e.horizontalGridlines.dotIntervals;r.showRulers&&r.dynamicGrid&&n&&o?(d=n.updateSegmentWidth(i.scale),l=o.updateSegmentWidth(i.scale),s=!0,e.horizontalGridlines.scaledIntervals=[d/o.interval],e.verticalGridlines.scaledIntervals=[l/n.interval]):c=this.scaleSnapInterval(e,i.scale);for(var f=0,m=0;m<u.length;m+=1)f+=u[m];var y=0;for(m=0;m<g.length;m+=1)y+=g[m];var v={x:-i.tx*i.scale,y:-i.ty*i.scale};fh(a,v),y=s?l:y*c,f=s?d:f*c,v={id:this.diagramId+"_pattern",x:0,y:0,width:y,height:f,patternUnits:"userSpaceOnUse"},fh(h=document.createElementNS("http://www.w3.org/2000/svg","pattern"),v),this.horizontalSvgGridlines(h,y,f,c,e,r,n,s,p,u),this.verticalSvgGridlines(h,y,f,c,e,r,o,s,p,g);var b=t.getElementById(this.diagramId+"_grid_pattern_defn");b&&b.appendChild(h)}},t.prototype.updateLineIntervals=function(e,t,i,r,o){for(var n=[],a=r/i.interval,s=o?i.interval:i.interval+1,h=0;h<2*s;h++)n[h]=h%2==0?o?0===h?1.25:.25:0:o?a-n[h-1]:a;return n},t.prototype.scaleSnapInterval=function(e,t){if(t>=2)for(;t>=2;)t/=2;else if(t<=.5)for(;t<=.5;)t*=2;var i;if(e.horizontalGridlines.scaledIntervals=e.horizontalGridlines.snapIntervals,e.verticalGridlines.scaledIntervals=e.verticalGridlines.snapIntervals,1!==t){var r=e.horizontalGridlines;for(r.scaledIntervals=[],i=0;i<r.snapIntervals.length;i++)r.scaledIntervals[i]=r.snapIntervals[i]*t;for((r=e.verticalGridlines).scaledIntervals=[],i=0;i<r.snapIntervals.length;i++)r.scaledIntervals[i]=r.snapIntervals[i]*t}return t},t.prototype.renderTextElement=function(e,t,i,r,o){var n=this.getBaseAttributes(e,i);n.cornerRadius=0,n.whiteSpace=Rh(e.style.whiteSpace,e.style.textWrapping),n.content=e.content,n.breakWord=Bh(e.style.textWrapping),n.textAlign=Eh(e.style.textAlign),n.color=e.style.color,n.italic=e.style.italic,n.bold=e.style.bold,n.fontSize=e.style.fontSize,n.fontFamily=e.style.fontFamily,n.textOverflow=e.style.textOverflow,n.textWrapping=e.style.textWrapping,n.textDecoration=e.style.textDecoration,n.doWrap=e.doWrap,n.wrapBounds=e.wrapBounds,n.childNodes=e.childNodes,n.isHorizontalLane=e.isLaneOrientation,n.id=e.id?e.id:xh(),e.isLaneOrientation&&(n.parentOffsetX=this.groupElement.offsetX,n.parentOffsetY=this.groupElement.offsetY,n.parentWidth=this.groupElement.actualSize.width,n.parentHeight=this.groupElement.actualSize.height),n.dashArray="",n.strokeWidth=0,n.fill=e.style.fill;var a=e.description?e.description:e.content?e.content:e.id;("Wrap"===e.style.textWrapping||"WrapWithOverflow"===e.style.textWrapping)&&this.groupElement&&n.height>this.groupElement.actualSize.height&&("Clip"===e.style.textOverflow||"Ellipsis"===e.style.textOverflow)&&(n.y=n.y+(n.height-this.groupElement.actualSize.height)/2),this.renderer.drawRectangle(t,n,this.diagramId,void 0,void 0,r),this.renderer.drawText(t,n,r,a,this.diagramId,e.isExport&&Math.min(e.exportScaleValue.x||e.exportScaleValue.y),this.groupElement),this.isSvgMode&&(e.doWrap=!1)},t.prototype.renderNativeElement=function(e,t,i,r,o){var n,a,s=this.getParentSvg(e,void 0,t)||r,h=this.getParentElement(e,t,s).g||t,d=this.getBaseAttributes(e,i);switch(d.fill="transparent",d.cornerRadius=e.cornerRadius,d.stroke="transparent",this.renderer.drawRectangle(t,d,this.diagramId,void 0,void 0,r),e.scale){case"None":n=e.contentSize.width,a=e.contentSize.height;break;case"Stretch":n=e.actualSize.width,a=e.actualSize.height;break;case"Meet":n=a=e.actualSize.width<=e.actualSize.height?e.actualSize.width:e.actualSize.height;break;case"Slice":n=a=e.actualSize.width>=e.actualSize.height?e.actualSize.width:e.actualSize.height}this.svgRenderer&&this.svgRenderer.drawNativeContent(e,h,a,n,s)},t.prototype.renderHTMLElement=function(e,t,i,r,o,n,a){var s=this.getBaseAttributes(e,r);s.fill="transparent",s.cornerRadius=e.cornerRadius,s.stroke="transparent",this.renderer.drawRectangle(t,s,this.diagramId,void 0,void 0,o),this.svgRenderer&&this.svgRenderer.drawHTMLContent(e,i.children[0],r,En(i),a)},t.prototype.renderImageElement=function(e,t,i,r,o){var n,a,s,h,d=this.getBaseAttributes(e,i);if(d.cornerRadius=0,this.renderer.drawRectangle(t,d,this.diagramId,void 0,void 0,r),"Stretch"===e.stretch)n=e.actualSize.width,a=e.actualSize.height;else{var l=e.contentSize.width,c=e.contentSize.height,p=d.width/l,g=d.height/c,u=void 0;switch(e.stretch){case"Meet":n=l*(u=Math.min(p,g)),a=c*u,d.x+=Math.abs(d.width-n)/2,d.y+=Math.abs(d.height-a)/2;break;case"Slice":p=d.width/l,g=d.height/c,n=l*(u=Math.max(p,g)),a=c*u,s=d.width/n*l,h=d.height/a*c;break;case"None":n=l,a=c}}d.width=n,d.height=a,d.sourceWidth=s,d.sourceHeight=h,d.source=e.source,d.alignment=e.imageAlign,d.scale=e.imageScale,d.description=e.description?e.description:e.id,this.renderer.drawImage(t,d,r,o)},t.prototype.renderContainer=function(t,i,r,o,n,a,s,h,d){var l={svg:n,g:i};if(this.diagramId&&(n=this.getParentSvg(t)||n,this.isSvgMode)){var c=this.getParentElement(t,i,n,h).g||i;n=this.getParentSvg(this.hasNativeParent(t.children))||n;var p=this.getParentElement(this.hasNativeParent(t.children),c,n,h);l.svg=p.svg||n,l.g=p.g||c,a?(n&&(n.getElementById(l.g.id)||i.appendChild(l.g)),i=l.g):i=l.g}if(this.renderRect(t,i,o,n),this.groupElement=t,t.hasChildren()){for(var g,u=void 0,f=void 0,m=0,y=t.children;m<y.length;m++){var v=y[m];n=this.getParentSvg(this.hasNativeParent(t.children)||v)||n,this.isSvgMode&&(u=(g=this.getParentElement(this.hasNativeParent(t.children)||v,i,n)).g||i,g.svg&&(n=g.svg)),this.isSvgMode||(v.flip=t.flip),this.renderElement(v,u||i,r,o,n,!0,s,h,d),v instanceof Se&&u&&!(t.elementActions&e.ElementAction.ElementIsGroup)&&(f=v.flip&&"None"!==v.flip?v.flip:t.flip,this.renderFlipElement(v,u,f)),v.elementActions&e.ElementAction.ElementIsPort&&u&&(f=v.flip&&"None"!==v.flip?v.flip:t.flip,this.renderFlipElement(t,u,f)),!(v instanceof Se)&&"None"!==t.flip&&t.elementActions&e.ElementAction.ElementIsGroup&&this.renderFlipElement(v,u||i,t.flip)}t.elementActions&e.ElementAction.ElementIsGroup||this.renderFlipElement(t,i,t.flip)}},t.prototype.renderFlipElement=function(e,t,i){var r={},o=1,n=1,a=0,s=0,h=0,d=0;if("None"!==i?("Horizontal"!==i&&"Both"!==i||(a=e.bounds.center.x,h=-e.bounds.center.x,o=-1),"Vertical"!==i&&"Both"!==i||(s=e.bounds.center.y,d=-e.bounds.center.y,n=-1),r={transform:"translate("+a+","+s+") scale("+o+","+n+") translate("+h+","+d+")"}):r={transform:"translate(0,0)"},r)if(e&&e.children&&e.children.length&&e.children[0]instanceof Yi){var l=t.id.split("_preview");(t=(document.getElementById(l[0]+"_html_div")||sh(this.diagramId).children[0]).querySelector("#"+e.id+"_content_html_element"))&&(t.style.transform="scale("+o+","+n+")rotate("+(e.rotateAngle+e.parentTransform)+"deg)")}else fh(t,r)},t.prototype.hasNativeParent=function(e,t){if(e&&e.length>0){var i=e[0];if(i instanceof je)return i;i.children&&i.children.length&&this.hasNativeParent(i.children,t++||0)}},t.prototype.renderRect=function(e,t,i,r,o){var n=this.getBaseAttributes(e,i,o);n.cornerRadius=e.cornerRadius||0;var a=e.description?e.description:e.id;this.renderer.drawRectangle(t,n,this.diagramId,void 0,void 0,r,a)},t.prototype.drawRect=function(e,t){t.cornerRadius=0,this.svgRenderer.drawRectangle(e,t,this.diagramId)},t.prototype.getBaseAttributes=function(e,t,i){var r={width:e.actualSize.width,height:e.actualSize.height,x:e.offsetX-e.actualSize.width*e.pivot.x+.5,y:e.offsetY-e.actualSize.height*e.pivot.y+.5,fill:e.style.fill,stroke:e.style.strokeColor,angle:e.rotateAngle+e.parentTransform,pivotX:e.pivot.x,pivotY:e.pivot.y,strokeWidth:e.style.strokeWidth,dashArray:e.style.strokeDashArray||"",opacity:e.style.opacity,shadow:e.shadow,gradient:e.style.gradient,visible:e.visible,id:e.id,description:e.description,canApplyStyle:e.canApplyStyle};return i&&(r.x=r.x-.5,r.y=r.y-.5),e.isExport&&(r.width*=e.exportScaleValue.x,r.height*=e.exportScaleValue.y,r.x*=e.exportScaleValue.x,r.y*=e.exportScaleValue.y,r.strokeWidth*=e.exportScaleValue.x),e.flip&&(r.flip=e.flip),t&&(r.x+=t.tx,r.y+=t.ty),r},t.renderSvgBackGroundImage=function(e,t,i,r,o,n){if(e.source){var a=oh(t.id).getElementById(t.id+"_image");if(!a){var s=Ks(t.id).getElementsByClassName("e-background-image-layer")[0];(a=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("id",t.id+"_image"),s.appendChild(a)}var h=new Image;h.src=e.source,a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src.toString());var d="None"!==e.scale?e.scale:"",l=e.align,c=l.charAt(0).toLowerCase()+l.slice(1);d&&(c+=" "+d.charAt(0).toLowerCase()+d.slice(1)),fh(a,{id:t.id+"_image",x:i,y:r,width:o,height:n,preserveAspectRatio:c})}},t.prototype.transformLayers=function(e,t){var i,r,o=e.tx*e.scale,n=e.ty*e.scale,a="domTable";if(o!==this.transform.x||n!==this.transform.y||0===o||0===n){if(t)window[a][this.diagramId+"_diagramLayer"]||(window[a][this.diagramId+"_diagramLayer"]=this.diagramSvgLayer.getElementById(this.diagramId+"_diagramLayer")),window[a][this.diagramId+"_diagramLayer"].setAttribute("transform","translate("+e.tx*e.scale+","+e.ty*e.scale+"),scale("+e.scale+")");return(i=this.diagramId,r=null,window.domTable[i+"_gridline"]?r=window.domTable[i+"_gridline"]:(r=rh(i).getElementById(i+"_gridline"),window.domTable[i+"_gridline"]=r),r).setAttribute("transform","translate("+e.tx*e.scale+","+e.ty*e.scale+")"),window[a][this.diagramId+"_diagramPorts"]||(window[a][this.diagramId+"_diagramPorts"]=this.iconSvgLayer.getElementById(this.diagramId+"_diagramPorts")),window[a][this.diagramId+"_diagramPorts"].setAttribute("transform","translate("+e.tx*e.scale+","+e.ty*e.scale+"),scale("+e.scale+")"),window[a][this.diagramId+"_diagramExpander"]||(window[a][this.diagramId+"_diagramExpander"]=this.iconSvgLayer.getElementById(this.diagramId+"_diagramExpander")),window[a][this.diagramId+"_diagramExpander"].setAttribute("transform","translate("+e.tx*e.scale+","+e.ty*e.scale+"),scale("+e.scale+")"),window[a][this.diagramId+"_nativeLayer"]||(window[a][this.diagramId+"_nativeLayer"]=this.nativeSvgLayer.getElementById(this.diagramId+"_nativeLayer")),window[a][this.diagramId+"_nativeLayer"].setAttribute("transform","translate("+e.tx*e.scale+","+e.ty*e.scale+"),scale("+e.scale+")"),sh(this.diagramId).children[0].style.transform="translate("+e.tx*e.scale+"px,"+e.ty*e.scale+"px)scale("+e.scale+")",this.transform={x:e.tx*e.scale,y:e.ty*e.scale},!0}return!1},t.prototype.updateNode=function(e,t,i,r,o){this.renderElement(e,t,i,r,this.getParentSvg(e),void 0,void 0,o)},t}(),Kh=(_h=function(e,t){return(_h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}_h(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Qh=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Jh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Kh(t,e),Qh([sf.base.Property("")],t.prototype,"source",void 0),Qh([sf.base.Property("transparent")],t.prototype,"color",void 0),Qh([sf.base.Property("None")],t.prototype,"scale",void 0),Qh([sf.base.Property("None")],t.prototype,"align",void 0),t}(sf.base.ChildProperty),$h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Kh(t,e),Qh([sf.base.Property("Page")],t.prototype,"mode",void 0),Qh([sf.base.Property("PageSettings")],t.prototype,"region",void 0),Qh([sf.base.Complex({top:25,bottom:25,left:25,right:25},ne)],t.prototype,"margin",void 0),Qh([sf.base.Property(!1)],t.prototype,"canZoomIn",void 0),Qh([sf.base.Property(void 0)],t.prototype,"customBounds",void 0),Qh([sf.base.Property(!1)],t.prototype,"canFit",void 0),t}(sf.base.ChildProperty),ed=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Kh(t,e),Qh([sf.base.Property(null)],t.prototype,"width",void 0),Qh([sf.base.Property(null)],t.prototype,"height",void 0),Qh([sf.base.Complex({},ne)],t.prototype,"margin",void 0),Qh([sf.base.Property("Landscape")],t.prototype,"orientation",void 0),Qh([sf.base.Property("Infinity")],t.prototype,"boundaryConstraints",void 0),Qh([sf.base.Complex({},Jh)],t.prototype,"background",void 0),Qh([sf.base.Property(!1)],t.prototype,"multiplePage",void 0),Qh([sf.base.Property(!1)],t.prototype,"showPageBreaks",void 0),Qh([sf.base.Complex({},$h)],t.prototype,"fitOptions",void 0),t}(sf.base.ChildProperty),td=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Kh(t,e),Qh([sf.base.Property(0)],t.prototype,"horizontalOffset",void 0),Qh([sf.base.Property(0)],t.prototype,"verticalOffset",void 0),Qh([sf.base.Property(1)],t.prototype,"currentZoom",void 0),Qh([sf.base.Property(0)],t.prototype,"viewPortWidth",void 0),Qh([sf.base.Property(0)],t.prototype,"viewPortHeight",void 0),Qh([sf.base.Property(.2)],t.prototype,"minZoom",void 0),Qh([sf.base.Property(30)],t.prototype,"maxZoom",void 0),Qh([sf.base.Property("Diagram")],t.prototype,"scrollLimit",void 0),Qh([sf.base.Property()],t.prototype,"scrollableArea",void 0),Qh([sf.base.Property(!1)],t.prototype,"canAutoScroll",void 0),Qh([sf.base.Complex({left:15,right:15,top:15,bottom:15},ne)],t.prototype,"autoScrollBorder",void 0),Qh([sf.base.Complex({left:0,right:0,top:0,bottom:0},ne)],t.prototype,"padding",void 0),t}(sf.base.ChildProperty),id=function(){function e(){this.services={}}return e.prototype.register=function(e,t){this.services[e]=t},e.prototype.getService=function(e){return this.services[e]},e}(),rd=(Vh=function(e,t){return(Vh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Vh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),od=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},nd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rd(t,e),od([sf.base.Property("lightgray")],t.prototype,"lineColor",void 0),od([sf.base.Property("")],t.prototype,"lineDashArray",void 0),od([sf.base.Property([1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75])],t.prototype,"lineIntervals",void 0),od([sf.base.Property([1,19,.5,19.5,.5,19.5,.5,19.5,.5,19.5])],t.prototype,"dotIntervals",void 0),od([sf.base.Property([20])],t.prototype,"snapIntervals",void 0),t}(sf.base.ChildProperty),ad=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return rd(i,t),od([sf.base.Complex({},nd)],i.prototype,"horizontalGridlines",void 0),od([sf.base.Complex({},nd)],i.prototype,"verticalGridlines",void 0),od([sf.base.Property(e.SnapConstraints.All)],i.prototype,"constraints",void 0),od([sf.base.Property(5)],i.prototype,"snapAngle",void 0),od([sf.base.Property("Lines")],i.prototype,"gridType",void 0),od([sf.base.Property(5)],i.prototype,"snapObjectDistance",void 0),i}(sf.base.ChildProperty),sd=(Xh=function(e,t){return(Xh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Xh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),hd=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},dd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return sd(t,e),hd([sf.base.Property(5)],t.prototype,"interval",void 0),hd([sf.base.Property(100)],t.prototype,"segmentWidth",void 0),hd([sf.base.Property("Horizontal")],t.prototype,"orientation",void 0),hd([sf.base.Property("RightOrBottom")],t.prototype,"tickAlignment",void 0),hd([sf.base.Property("red")],t.prototype,"markerColor",void 0),hd([sf.base.Property(25)],t.prototype,"thickness",void 0),hd([sf.base.Property(null)],t.prototype,"arrangeTick",void 0),t}(sf.base.ChildProperty),ld=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return sd(t,e),hd([sf.base.Property(!1)],t.prototype,"showRulers",void 0),hd([sf.base.Property(!0)],t.prototype,"dynamicGrid",void 0),hd([sf.base.Complex({orientation:"Horizontal"},dd)],t.prototype,"horizontalRuler",void 0),hd([sf.base.Complex({orientation:"Vertical"},dd)],t.prototype,"verticalRuler",void 0),t}(sf.base.ChildProperty),cd=(Yh=function(e,t){return(Yh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Yh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),pd=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},gd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cd(t,e),pd([sf.base.Property("")],t.prototype,"property",void 0),pd([sf.base.Property("")],t.prototype,"field",void 0),t}(sf.base.ChildProperty),ud=(Uh=function(e,t){return(Uh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Uh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),fd=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},md=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ud(t,e),fd([sf.base.Property("")],t.prototype,"read",void 0),fd([sf.base.Property("")],t.prototype,"create",void 0),fd([sf.base.Property("")],t.prototype,"update",void 0),fd([sf.base.Property("")],t.prototype,"destroy",void 0),fd([sf.base.Property()],t.prototype,"customFields",void 0),t}(sf.base.ChildProperty),yd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ud(t,e),fd([sf.base.Property("")],t.prototype,"id",void 0),fd([sf.base.Property("")],t.prototype,"sourceID",void 0),fd([sf.base.Property("")],t.prototype,"targetID",void 0),fd([sf.base.Property(null)],t.prototype,"sourcePointX",void 0),fd([sf.base.Property(null)],t.prototype,"sourcePointY",void 0),fd([sf.base.Property(null)],t.prototype,"targetPointX",void 0),fd([sf.base.Property(null)],t.prototype,"targetPointY",void 0),fd([sf.base.Property(null)],t.prototype,"dataManager",void 0),fd([sf.base.Complex({},md)],t.prototype,"crudAction",void 0),t}(sf.base.ChildProperty),vd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ud(t,e),fd([sf.base.Property("")],t.prototype,"id",void 0),fd([sf.base.Property(null)],t.prototype,"dataManager",void 0),fd([sf.base.Property(null)],t.prototype,"dataSource",void 0),fd([sf.base.Property("")],t.prototype,"root",void 0),fd([sf.base.Property("")],t.prototype,"parentId",void 0),fd([sf.base.Property()],t.prototype,"doBinding",void 0),fd([sf.base.Collection([],gd)],t.prototype,"dataMapSettings",void 0),fd([sf.base.Complex({},md)],t.prototype,"crudAction",void 0),fd([sf.base.Complex({},yd)],t.prototype,"connectionDataSource",void 0),t}(sf.base.ChildProperty),bd=(Gh=function(e,t){return(Gh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Gh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),wd=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},xd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return bd(t,e),wd([sf.base.Property("")],t.prototype,"fixedNode",void 0),wd([sf.base.Property(30)],t.prototype,"horizontalSpacing",void 0),wd([sf.base.Property("SamePoint")],t.prototype,"connectionPointOrigin",void 0),wd([sf.base.Property("Nonlinear")],t.prototype,"arrangement",void 0),wd([sf.base.Property(30)],t.prototype,"verticalSpacing",void 0),wd([sf.base.Property(30)],t.prototype,"maxIteration",void 0),wd([sf.base.Property(40)],t.prototype,"springFactor",void 0),wd([sf.base.Property(50)],t.prototype,"springLength",void 0),wd([sf.base.Complex({left:50,top:50,right:0,bottom:0},ne)],t.prototype,"margin",void 0),wd([sf.base.Property("Auto")],t.prototype,"horizontalAlignment",void 0),wd([sf.base.Property("Auto")],t.prototype,"verticalAlignment",void 0),wd([sf.base.Property("TopToBottom")],t.prototype,"orientation",void 0),wd([sf.base.Property("Auto")],t.prototype,"connectionDirection",void 0),wd([sf.base.Property("Default")],t.prototype,"connectorSegments",void 0),wd([sf.base.Property("None")],t.prototype,"type",void 0),wd([sf.base.Property()],t.prototype,"getLayoutInfo",void 0),wd([sf.base.Property()],t.prototype,"layoutInfo",void 0),wd([sf.base.Property()],t.prototype,"getBranch",void 0),wd([sf.base.Property()],t.prototype,"bounds",void 0),wd([sf.base.Property(!0)],t.prototype,"enableAnimation",void 0),wd([sf.base.Property(!1)],t.prototype,"enableRouting",void 0),wd([sf.base.Property("")],t.prototype,"root",void 0),t}(sf.base.ChildProperty);function Cd(t,i,r,o,n,s,h){if(s&&s.length>1&&n&&n.length>1)return"PinchZoom";if(o.currentSymbol)return"Drag";if("PortDraw"===o.eventHandler.action&&(o.tool&=~e.DiagramTools.DrawOnce),(qr(o)||Zr(o))&&o.drawingObject)return"Draw";if(Td(o)&&((u=o.selectedItems).wrapper&&ma(u.constraints,"UserHandle")))for(var d=0,l=u.userHandles;d<l.length;d++){var c=l[d];if(c.visible)if(Pd(r,f=ua(u,c,o.scroller.transform),c.size/(2*o.scroller.transform.scale)))return c.name}if(Td(o)){var p=o.selectedItems.annotation?o.selectedItems.wrapper.children[0]:o.selectedItems.wrapper,g=p.bounds,u=o.selectedItems,f=new b(g.x,g.y,g.width,g.height);if(Ad(o)&&!o.selectedItems.annotation){var m=o.selectedItems.connectors[0],y=10/o.scrollSettings.currentZoom,v=10/o.scrollSettings.currentZoom;if(ma(u.constraints,"ResizeAll")){if(ma(u.constraints,"ConnectorSourceThumb")&&Lr(m)&&Pd(r,m.sourcePoint,y))return"ConnectorSourceEnd";if(ma(u.constraints,"ConnectorTargetThumb")&&Mr(m)&&Pd(r,m.targetPoint,v))return"ConnectorTargetEnd";if("OrthoThumb"===(O=function(e,t,i,r){var o=10/r.scrollSettings.currentZoom,n=10/r.scrollSettings.currentZoom;if("Bezier"===e.type)for(var s=0;s<e.segments.length;s++){var h=e.segments[s];if(Pd(i,a.isEmptyPoint(h.point1)?h.bezierPoint1:h.point1,n))return"BezierSourceThumb";if(Pd(i,a.isEmptyPoint(h.point2)?h.bezierPoint2:h.point2,o))return"BezierTargetThumb"}if(r.connectorEditingToolModule&&kr(e))if("Straight"===e.type||"Bezier"===e.type)for(s=0;s<e.segments.length;s++){h=e.segments[s];if(Pd(i,h.point,10))return"SegmentEnd"}else for(s=0;s<e.segments.length;s++){var d={x:0,y:0};if((h=e.segments[s]).allowDrag)for(var l=0;l<h.points.length-1;l++){if(a.distancePoints(h.points[l],h.points[l+1])>=50&&(d.x=(h.points[l].x+h.points[l+1].x)/2,d.y=(h.points[l].y+h.points[l+1].y)/2,Pd(i,d,30)))return"OrthoThumb"}}return null}(m,0,r,o)))return O;if(ma(u.constraints,"ConnectorSourceThumb")&&Lr(m)&&O)return O;if(ma(u.constraints,"ConnectorTargetThumb")&&Mr(m)&&O)return O}}else{var w=10/o.scroller.currentZoom,S=x();P(S,p.rotateAngle+p.parentTransform,p.offsetX,p.offsetY);var T=p.offsetX-p.pivot.x*p.actualSize.width,A=p.offsetY-p.pivot.y*p.actualSize.height,z={x:T+(.5===p.pivot.x?2*p.pivot.x:p.pivot.x)*p.actualSize.width/2,y:A-30/o.scroller.currentZoom};z=C(S,z);var O,I=!!o.selectedItems.annotation,D=!(!I||!Rr(o.selectedItems.annotation));if(ma(u.constraints,"Rotate")&&Pd(r,z,w)&&o.selectedItems.thumbsConstraints&e.ThumbsConstraints.Rotate){if(I&&D)return"LabelRotate";if(!I)return"Rotate"}if(f.Inflate(w),f.containsPoint(r))if(O=function(e,t,i,r,o,n){var a;1===e.selectedItems.nodes.length&&0===e.selectedItems.connectors.length&&e.selectedItems.nodes[0].container&&(a=function(e,t,i,r,o){var n=10/e.scroller.currentZoom,a=40/e.scroller.currentZoom,s=e.selectedItems,h=t.actualSize.width,d=t.actualSize.height,l=new b(r,o+20,t.style.strokeWidth,d-40),c=new b(r+h,o+20,t.style.strokeWidth,d-40),p=new b(r+20,o,h-40,t.style.strokeWidth),g=new b(r+20,o+d,h-40,t.style.strokeWidth),u=Eo(e,e.selectedItems.nodes[0],!0)?e.nameTable[e.selectedItems.nodes[0].parentId]:e.selectedItems.nodes[0];if(h>=a&&d>=a){if(fa(s.constraints,"ResizeEast",s.thumbsConstraints,s)&&c.containsPoint(i,n))return"ResizeEast";if(fa(s.constraints,"ResizeSouth",s.thumbsConstraints,s)&&g.containsPoint(i,n))return"ResizeSouth";if("Grid"!==u.container.type){if(fa(s.constraints,"ResizeWest",s.thumbsConstraints,s)&&l.containsPoint(i,n))return"ResizeWest";if(fa(s.constraints,"ResizeNorth",s.thumbsConstraints,s)&&p.containsPoint(i,n))return"ResizeNorth"}}return null}(e,t,i,o,n));a||e.selectedItems.nodes[0]&&(e.selectedItems.nodes[0].isPhase||e.selectedItems.nodes[0].isLane||"SwimLane"===e.selectedItems.nodes[0].shape.type)||(a=function(e,t,i,r,o,n){var a=40/e.scroller.currentZoom,s=10/e.scroller.currentZoom,h=e.selectedItems,d=!!h.annotation;if(t.actualSize.width>=a&&t.actualSize.height>=a){if(fa(h.constraints,"ResizeSouthEast",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o+t.actualSize.width,y:n+t.actualSize.height}),s))return d?"LabelResizeSouthEast":"ResizeSouthEast";if(fa(h.constraints,"ResizeSouthWest",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o,y:n+t.actualSize.height}),s))return d?"LabelResizeSouthWest":"ResizeSouthWest";if(fa(h.constraints,"ResizeNorthEast",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o+t.actualSize.width,y:n}),s))return d?"LabelResizeNorthEast":"ResizeNorthEast";if(fa(h.constraints,"ResizeNorthWest",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o,y:n}),s))return d?"LabelResizeNorthWest":"ResizeNorthWest"}if(fa(h.constraints,"ResizeEast",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o+t.actualSize.width,y:n+t.actualSize.height/2}),s))return d?"LabelResizeEast":"ResizeEast";if(fa(h.constraints,"ResizeWest",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o,y:n+t.actualSize.height/2}),s))return d?"LabelResizeWest":"ResizeWest";if(fa(h.constraints,"ResizeSouth",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o+t.actualSize.width/2,y:n+t.actualSize.height}),s))return d?"LabelResizeSouth":"ResizeSouth";if(fa(h.constraints,"ResizeNorth",h.thumbsConstraints,h)&&Pd(i,C(r,{x:o+t.actualSize.width/2,y:n}),s))return d?"LabelResizeNorth":"ResizeNorth";return null}(e,t,i,r,o,n));if(a)return a;return null}(o,p,r,S,T,A))return O}}if(Fr(o)&&!t)return"Pan";if(h instanceof Ve&&!Fr(o)&&"None"!==(O=Sd(o,h)))return O;if((h instanceof Fe||h instanceof Ze)&&!Fr(o)&&Dr(h))return zd(o,h,void 0,i)&&Er(h)?"LabelDrag":"LabelSelect";if(null!==t){if(!(t instanceof js||t instanceof wr))return"Select";if(i&&i.id){var E=i.id.split(t.id)[1];if(E&&E.match("^_icon"))return"LayoutAnimation"}if(i&&i.id)for(var B=void 0,L=0;L<t.fixedUserHandles.length;L++)if(B=t.fixedUserHandles[L].id,i.id&&i.id.indexOf(B)>-1)return"FixedUserHandle";if(Er(t)&&i instanceof Se&&i.hyperlink.link)return"Hyperlink";if(!Er(t)||!zd(o,t,!1)||void 0!==o.selectedItems.annotation)return t&&Fr(o)&&!Kr(o)?"Pan":o.selectedItems.nodes.length&&o.selectedItems.nodes[0].isLane&&o.selectedItems.wrapper&&o.selectedItems.wrapper.bounds.containsPoint(r)?"Drag":"Select";if(t instanceof wr&&!Pd(r,t.sourcePoint,t.hitPadding)&&!Pd(r,t.targetPoint,t.hitPadding)||!(t instanceof wr))return"Drag"}return"Select"}function Sd(t,i,r,o){if(to(i)&&(ya(i,e.PortVisibility.Hover)||ya(i,e.PortVisibility.Visible))){if(i.constraints&e.PortConstraints.Drag)return"PortDrag"}else if(eo(i)&&(ya(i,e.PortVisibility.Hover)||ya(i,e.PortVisibility.Visible))&&i.constraints&e.PortConstraints.Draw){t.drawingObject={};var n={type:"Orthogonal",sourcePortID:i.id};return t.drawingObject=n,t.tool|=e.DiagramTools.DrawOnce,t.currentDrawingObject=n,"PortDraw"}return"None"}function Pd(e,t,i){return e.x>=t.x-i&&e.x<=t.x+i&&e.y>=t.y-i&&e.y<=t.y+i}function Td(e){return e.selectedItems.nodes.length>0||e.selectedItems.connectors.length>0}function Ad(e){return 1===e.selectedItems.connectors.length&&!e.selectedItems.nodes.length}function zd(e,t,i,r){if(void 0===i&&(i=!0),t instanceof Ys)return!0;if(t instanceof js)for(;t;){if(-1!==e.selectedItems.nodes.indexOf(t)&&void 0===e.selectedItems.annotation)return!0;if(i)break;t=e.nameTable[t.parentId]}else if(t instanceof wr){if(-1!==e.selectedItems.connectors.indexOf(t)&&void 0===e.selectedItems.annotation)return!0}else if((t instanceof Fe||t instanceof Ze)&&e.selectedItems.annotation&&e.selectedItems.wrapper.children[0].id===r.id)return!0;return!1}function Od(e,t){if(t+=360,t%=360,-1===e.indexOf("Resize"))return Rd[e];var i=Rd[e];return t>=0&&t<25||t>=160&&t<=205||t>=340&&t<=360?i:t>=25&&t<=70||t>=205&&t<=250?"n-resize"===i||"s-resize"===i?"ne-resize":"nw-resize"===i||"se-resize"===i?"n-resize":"e-resize"===i||"w-resize"===i?"nw-resize":"e-resize":t>=70&&t<=115||t>=250&&t<=295?"n-resize"===i||"s-resize"===i?"e-resize":"nw-resize"===i||"se-resize"===i?"ne-resize":"e-resize"===i||"w-resize"===i?"n-resize":"nw-resize":t>=115&&t<=155||t>=295&&t<=340?"n-resize"===i||"s-resize"===i?"nw-resize":"nw-resize"===i||"se-resize"===i?"e-resize":"e-resize"===i||"w-resize"===i?"ne-resize":Rd[e]:"n-resize"}var Id,Dd,Ed,Bd,Ld,Md,kd,Rd={None:"default",Rotate:"crosshair",Select:"default",Drag:"move",ResizeWest:"w-resize",ResizeEast:"e-resize",ResizeSouth:"s-resize",ResizeNorth:"n-resize",Draw:"crosshair",PortDraw:"crosshair",ResizeNorthEast:"ne-resize",ResizeNorthWest:"nw-resize",ResizeSouthEast:"se-resize",ResizeSouthWest:"sw-resize",ConnectorSourceEnd:"move",ConnectorTargetEnd:"move",BezierSourceThumb:"move",BezierTargetThumb:"move",OrthoThumb:"move",SegmentEnd:"move",Pan:"grab",Hyperlink:"pointer",PortDrag:"pointer",LabelSelect:"pointer",LabelDrag:"move",LabelRotate:"crosshair",LabelResizeWest:"w-resize",LabelResizeEast:"e-resize",LabelResizeSouth:"s-resize",LabelResizeNorth:"n-resize",LabelResizeNorthEast:"ne-resize",LabelResizeNorthWest:"nw-resize",LabelResizeSouthEast:"se-resize",LabelResizeSouthWest:"sw-resize"},Nd=function(){function e(){this.valueCreated="created",this.valueUpdated="updated",this.valueDeleted="deleted",this.valueUnchanged="unchanged",this.newNodeObject=[],this.newConnectorObject=[],this.diagramObject={}}return e.prototype.updateObjectCollection=function(e,t){for(var i=0;i<e.length;i++)e[i].objects||(e[i].objects=[]),e[i].objects=t.layers[i].objects},e.prototype.getOldObject=function(e,t,i){for(var r=t?i.oldNodeObjects:i.oldConnectorObjects,o=0;o<r.length;o++)if(r[o].id===e)return r[o]},e.prototype.changeSegments=function(e,t){for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];if("segments"===o){var n=this.removeNullValues(t[o]);e[o]=n}}return e},e.prototype.removeNullValues=function(e){for(var t=[],i={},r=0;r<e.length;r++)i=this.removeNullObjectValues(e[r]),t.push(i);return t},e.prototype.removeNullObjectValues=function(e){for(var t={},i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];void 0!==e[o]&&(t[o]=e[o]instanceof Object?this.removeNullObjectValues(e[o]):e[o])}return t},e.prototype.getDifferenceValues=function(e,t,i,r){var o,n,a,s,h=e instanceof js;if(e&&(s=h?this.getOldObject(e.id,!0,r):this.getOldObject(e.id,!1,r))){var d=Ah(e);if(a=this.map(d,s),o=this.frameObject({},a),n=this.removeEmptyValues(o),(n=this.changeSegments(n,d)).children&&(n.children=Ah(e).children),n.ports&&n.ports.length)for(var l=0;l<n.ports.length;l++)d.ports[l].outEdges&&(n.ports[l].outEdges=d.ports[l].outEdges),d.ports[l].inEdges&&(n.ports[l].inEdges=d.ports[l].inEdges);return this.getDiagramObjects(n,e.id,h,t,i,r)}},e.prototype.getLayerObject=function(e,t,i){if(sf.base.isBlazor()){for(var r={layers:[]},o={layers:[]},n=0;n<i.layers.length;n++)o.layers.push(Ah(i.layers[n]));var a=void 0;for(n=0;n<o.layers.length;n++){a=t?this.map(e.layers[n],Ah(o.layers[n])):this.map(Ah(o.layers[n]),e.layers[n]);var s=this.frameObject({},a),h=this.removeEmptyValues(s);r.layers[n]=h}return this.updateObjectCollection(r.layers,i),r}},e.prototype.getDiagramObjects=function(e,t,i,r,o,n){var a;if(a=Ch(n,t),e.sfIndex=a,i?this.newNodeObject.push(e):this.newConnectorObject.push(e),r&&(r.sourceWrapper instanceof Se&&o||r.portId)){var s=void 0,h=void 0;h=i?r.portId?this.newNodeObject[0].ports:this.newNodeObject[0].annotations:this.newConnectorObject[0].annotations||[];for(var d=0;d<h.length;d++)if(Object.keys(h[d]).length>0){var l=n.nameTable[t];if(s=h[d],r.portId)this.newNodeObject[0].ports=[s];else{for(var c=0;c<l.annotations.length;c++)r.sourceWrapper.id===l.id+"_"+l.annotations[c].id&&(s.sfIndex=c);i?this.newNodeObject[0].annotations=[s]:this.newConnectorObject[0].annotations=[s]}}}this.diagramObject={nodes:this.newNodeObject,connectors:this.newConnectorObject}},e.prototype.removeArrayValues=function(e){var t=[];if(JSON.stringify(e)!==JSON.stringify({data:[]}))for(var i=0;i<e.length;i++)if(e[i]instanceof Object){var r=this.removeEmptyValues(e[i]);t.push(r)}else t.push(e[i]);return t},e.prototype.removeEmptyValues=function(e){for(var t={},i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];if("wrapper"!==o&&("data"!==o||"data"===o&&!(e[o]instanceof Array))){var n=e[o],a=JSON.stringify(n);if(n instanceof Array){var s=this.removeArrayValues(n);"[]"!==JSON.stringify(s)&&(t[o]=s)}else if(n instanceof Object){if(a!==JSON.stringify({data:[]})){s=this.removeEmptyValues(n);"{}"!==JSON.stringify(s)&&(t[o]=s)}}else a!==JSON.stringify(["data"])&&a!==JSON.stringify("data")&&a!==JSON.stringify({data:[]})&&"version"!==o&&"ejsAction"!==o&&(t[o]=e[o])}}return t},e.prototype.map=function(e,t,i){if(this.isFunction(e)||this.isFunction(t))throw"Invalid argument. Function given, object expected.";if(this.isValue(e)||this.isValue(t))return{type:this.compareValues(e,t),data:void 0===e?t:e};var r={};if(this.isArray(e))for(var o=0;o<e.length;o++){r[i]||(r[i]=[]);var n=this.map(e[o],t[o]);r[i].push(n)}else for(var a in e)if(!this.isFunction(e[a])){var s=void 0;void 0!==t[a]&&(s=t[a]);var h=this.map(e[a],s,this.isArray(s)?a:void 0);this.isArray(s)?r[a]=h[a]:r[a]=h}if(this.isArray(t))for(var d=t.length-1;d>=0;d--)if(r[i]||(r[i]=[]),this.isFunction(t[d])||void 0!==r[i][d])r[i][d].type&&r[i][d].type!==this.valueUpdated&&delete r[i];else{n=this.map(void 0,t[d]);r[i][d]=n}else for(var a in t)if(this.isFunction(t[a])||void 0!==r[a])r[a].type&&r[a].type!==this.valueUpdated&&r[a].type!==this.valueDeleted&&delete r[a];else{h=this.map(void 0,t[a]);r[a]=h}return r},e.prototype.compareValues=function(e,t){return e===t||this.isDate(e)&&this.isDate(t)&&e.getTime()===t.getTime()?this.valueUnchanged:void 0===e?this.valueCreated:void 0===t?this.valueDeleted:this.valueUpdated},e.prototype.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},e.prototype.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.prototype.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},e.prototype.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.prototype.isValue=function(e){return!this.isObject(e)&&!this.isArray(e)},e.prototype.frameObject=function(e,t){for(var i in t)if(this.isArray(t[i])){e[i]||(e[i]=[]);for(var r=0;r<t[i].length;r++){var o=this.frameObject({},t[i][r]);e[i].push(o)}}else if("type"!=i||"type"==i&&t[i]!==this.valueUpdated&&t[i]!==this.valueUnchanged&&t[i]!==this.valueDeleted&&t[i]!==this.valueCreated){if(this.isFunction(t[i]))continue;if(this.isValue(t[i]))return t.data;o=this.frameObject({},t[i]);(this.isValue(o)||Object.keys(o).length>0)&&(e[i]=o)}return e},e}(),jd=(Id=function(e,t){return(Id=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Id(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Hd=function(e,t,i,r){return new(i||(i=Promise))((function(o,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function s(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){e.done?o(e.value):new i((function(t){t(e.value)})).then(a,s)}h((r=r.apply(e,t||[])).next())}))},Wd=function(e,t){var i,r,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,r=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},_d=function(){function e(e,t){void 0===t&&(t=!1),this.commandHandler=null,this.deepDiffer=new Nd,this.inAction=!1,this.isProtectChange=!1,this.currentElement=null,this.blocked=!1,this.isTooltipVisible=!1,this.childTable={},this.undoElement={nodes:[],connectors:[]},this.checkProperty=!0,this.undoParentElement={nodes:[],connectors:[]},this.commandHandler=e,this.isProtectChange=t}return e.prototype.startAction=function(e){this.currentElement=e,this.inAction=!0},e.prototype.mouseDown=function(e){sf.base.isBlazor()&&(this.commandHandler.enableCloneObject(!0),this.commandHandler.ismouseEvents(!0)),this.currentElement=e.source,this.startPosition=this.currentPosition=this.prevPosition=e.position,this.isTooltipVisible=!0,this.startAction(e.source),this.checkProperty=!0,this.mouseDownElement=e.source},e.prototype.checkPropertyValue=function(){this.checkProperty&&this.commandHandler.startTransaction(this.isProtectChange)},e.prototype.mouseMove=function(e){return this.currentPosition=e.position,this.inAction&&(this.commandHandler.startTransaction(this.isProtectChange),this.checkProperty=!1),!this.blocked},e.prototype.mouseUp=function(e){this.checkPropertyValue(),this.currentPosition=e.position,this.isTooltipVisible=!1,this.commandHandler.endTransaction(this.isProtectChange),sf.base.isBlazor()&&(this.commandHandler.enableCloneObject(!1),this.commandHandler.ismouseEvents(!1),this.commandHandler.getBlazorOldValues(e,this instanceof il)),this.endAction(),this.mouseDownElement=null},e.prototype.endAction=function(){this.isTooltipVisible||this.commandHandler.closeTooltip(),this.commandHandler=null,this.currentElement=null,this.currentPosition=null,this.inAction=!1,this.blocked=!1},e.prototype.mouseWheel=function(e){this.currentPosition=e.position},e.prototype.mouseLeave=function(e){this.mouseUp(e)},e.prototype.updateSize=function(e,t,i,r,o,n){e=this.commandHandler.renderContainerHelper(e)||e;var a,s={snapped:!1,offset:0,left:!1,right:!1},h={snapped:!1,offset:0,top:!1,bottom:!1},d=this.currentPosition.x-this.startPosition.x,l=this.currentPosition.y-this.startPosition.y,c=!(e instanceof Se)&&this.commandHandler.snappingModule&&this.commandHandler.snappingModule.canSnap(),p=c?this.commandHandler.snappingModule.getLayer():null,g=e instanceof Se?n:e.rotateAngle;P(a=x(),-g,0,0);e.offsetX,e.offsetY;var u=e.width,f=e.height;e.pivot.x,e.pivot.y;var m,y=0,v=0,b=e instanceof Se?e.actualSize.width:e.width,w=e instanceof Se?e.actualSize.height:e.height;switch(r){case"ResizeWest":d=(m=C(a,{x:d,y:l})).x,l=m.y,v=1,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,e,i===t,o):d,l=0,y=(o.width-d)/b;break;case"ResizeEast":d=(m=C(a,{x:d,y:l})).x,l=m.y,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,e,i===t,o):d,l=0,y=(o.width+d)/b,v=1;break;case"ResizeNorth":y=1,d=(m=C(a,{x:d,y:l})).x,l=m.y,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,e,i===t,o):l,v=(o.height-l)/w;break;case"ResizeSouth":y=1,d=(m=C(a,{x:d,y:l})).x,l=m.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,e,i===t,o):l,v=(o.height+l)/w;break;case"ResizeNorthEast":d=(m=C(a,{x:d,y:l})).x,l=m.y,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,e,i===t,o):d,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,e,i===t,o):l,y=(o.width+d)/b,v=(o.height-l)/w;break;case"ResizeNorthWest":d=(m=C(a,{x:d,y:l})).x,l=m.y,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,e,i===t,o):l,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,e,i===t,o):d,y=(o.width-d)/b,v=(o.height-l)/w;break;case"ResizeSouthEast":d=(m=C(a,{x:d,y:l})).x,l=m.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,e,i===t,o):l,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,e,i===t,o):d,v=(o.height+l)/w,y=(o.width+d)/b;break;case"ResizeSouthWest":d=(m=C(a,{x:d,y:l})).x,l=m.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,e,i===t,o):l,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,e,i===t,o):d,y=(o.width-d)/b,v=(o.height+l)/w}return{width:y,height:v}},e.prototype.getPivot=function(e){switch(e){case"ResizeWest":return{x:1,y:.5};case"ResizeEast":return{x:0,y:.5};case"ResizeNorth":return{x:.5,y:1};case"ResizeSouth":return{x:.5,y:0};case"ResizeNorthEast":return{x:0,y:1};case"ResizeNorthWest":return{x:1,y:1};case"ResizeSouthEast":return{x:0,y:0};case"ResizeSouthWest":return{x:1,y:0}}return{x:.5,y:.5}},e}(),Vd=function(e){function t(t,i,r){var o=e.call(this,t,!0)||this;return o.action=r,o}return jd(t,e),t.prototype.mouseDown=function(t){this.inAction=!0,e.prototype.mouseDown.call(this,t)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction&&!1===a.equals(this.currentPosition,this.prevPosition)){var i=b.toBounds([this.prevPosition,this.currentPosition]);this.mouseDownElement&&!Er(this.mouseDownElement)?this.commandHandler.clearObjectSelection(this.mouseDownElement):(this.commandHandler.clearSelectedItems(),this.commandHandler.drawSelectionRectangle(i.x,i.y,i.width,i.height))}return!this.blocked},t.prototype.mouseUp=function(t){if(this.checkPropertyValue(),!this.commandHandler.isUserHandle(this.currentPosition))if(!1===a.equals(this.currentPosition,this.prevPosition)&&this.inAction){var i=b.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.doRubberBandSelection(i)}else{var r=this.commandHandler.getSelectedObject();this.commandHandler.hasSelection()&&t.info&&t.info.ctrlKey?t&&t.source&&(this.commandHandler.isSelected(t.source)?1===t.clickCount&&(this.commandHandler.unSelect(t.source),this.commandHandler.updateBlazorSelector()):this.commandHandler.selectObjects([t.source],!0)):(this.commandHandler.clearSelection(null===t.source),"LabelSelect"===this.action?this.commandHandler.labelSelect(t.source,t.sourceWrapper):t.source&&this.commandHandler.selectObjects([t.source],!1,r))}this.inAction=!1,e.prototype.mouseUp.call(this,t)},t.prototype.mouseLeave=function(e){this.inAction&&this.mouseUp(e)},t}(_d),Xd=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return jd(i,t),i.prototype.mouseUp=function(i){this.checkPropertyValue(),this.inAction=!1;for(var r,o=i.source,n=i.sourceWrapper.id,a=0;a<o.fixedUserHandles.length;a++)n.indexOf(o.fixedUserHandles[a].id)>-1&&(r=o.fixedUserHandles[a]);if(sf.base.isBlazor()){var s=Ea(i.source)===wr?{connector:i.source}:{node:i.source},h={fixedUserHandle:Ea(i.source)===wr?{connectorFixedUserHandle:r}:{nodeFixedUserHandle:r},element:s},d=e.DiagramEvent.fixedUserHandleClick;this.commandHandler.triggerEvent(d,h),t.prototype.mouseUp.call(this,i)}else{h={fixedUserHandle:r,element:i.source},d=e.DiagramEvent.fixedUserHandleClick;this.commandHandler.triggerEvent(d,h),t.prototype.mouseUp.call(this,i)}},i}(_d),Yd=function(t){function i(e,i){var r=t.call(this,e,!0)||this;return r.isConnected=!1,r.endPoint=i,r}return jd(i,t),i.prototype.mouseDown=function(e){return Hd(this,void 0,void 0,(function(){var i,r,o,n,s,h,d,l;return Wd(this,(function(c){if(sf.base.isBlazor()&&e&&e.source&&(this.commandHandler.insertSelectedObjects(),this.commandHandler.insertBlazorConnector(e.source),(i=e.source).connectors&&(r=i.connectors[0],this.oldConnector=Ah(r),o={connector:_a(r),oldValue:{connectorTargetValue:{portId:void 0,nodeId:void 0}},newValue:{connectorTargetValue:{portId:void 0,nodeId:void 0}},cancel:!1,state:"Changing",connectorEnd:this.endPoint},this.tempArgs=o)),this.inAction=!0,this.undoElement=void 0,this instanceof qd||(this.undoElement=Ah(e.source)),t.prototype.mouseDown.call(this,e),e.source&&e.source.connectors&&({x:this.prevPosition.x,y:this.prevPosition.y},n=e.source.connectors[0],this.oldConnector=Ah(n)),"BezierSourceThumb"===this.endPoint||"BezierTargetThumb"===this.endPoint)for(s=0;s<n.segments.length;s++)h=n.segments[s],d=a.isEmptyPoint(h.point1)?h.bezierPoint1:h.point1,l=a.isEmptyPoint(h.point2)?h.bezierPoint2:h.point2,(Pd(this.currentPosition,d,n.hitPadding)||Pd(this.currentPosition,l,n.hitPadding))&&(this.selectedSegment=h);return this.currentPosition=e.position,[2]}))}))},i.prototype.mouseUp=function(i){return Hd(this,void 0,void 0,(function(){var r,o,n,s,h,d,l,c,p,g,u,f,m;return Wd(this,(function(y){switch(y.label){case 0:return sf.base.isBlazor()?(u=e.DiagramEvent.connectionChange,r=void 0,this.tempArgs&&this.oldConnector?(this.commandHandler.updatePropertiesToBlazor(i,!1),this.tempArgs.state="Changed",n="ConnectorSourceEnd"===this.endPoint?"sourceID":"targetID",s="ConnectorSourceEnd"===this.endPoint?"sourcePortID":"targetPortID",this.tempArgs.oldValue="ConnectorSourceEnd"===this.endPoint?{connectorSourceValue:{nodeId:this.oldConnector[n],portId:this.oldConnector[s]}}:{connectorTargetValue:{nodeId:this.oldConnector[n],portId:this.oldConnector[s]}},r={state:this.tempArgs.state,oldValue:this.tempArgs.oldValue,newValue:this.tempArgs.newValue,cancel:this.tempArgs.cancel,connectorEnd:this.tempArgs.connectorEnd},"diagram","sfBlazor","Blazor",window&&window.Blazor&&this.commandHandler.diagram.connectionChange?(o={EventName:"connectionChange",args:JSON.stringify(this.tempArgs)},[4,window.sfBlazor.updateBlazorDiagramEvents(o,this.commandHandler.diagram)]):[3,2]):[3,3]):[3,3];case 1:r=y.sent(),y.label=2;case 2:r&&this.commandHandler.updateConnectorValue(r),y.label=3;case 3:return!sf.base.isBlazor()&&this.isConnected&&i.source.connectors&&(d=i.source.connectors[0],n="ConnectorSourceEnd"===this.endPoint?"sourceID":"targetID",s="ConnectorSourceEnd"===this.endPoint?"sourcePortID":"targetPortID",g={connector:_a(d),oldValue:{nodeId:this.oldConnector[n],portId:this.oldConnector[s]},newValue:{nodeId:d[n],portId:d[s]},cancel:!1,state:"Changed",connectorEnd:this.endPoint},d[n]!==this.oldConnector[n]&&(this.commandHandler.triggerEvent(e.DiagramEvent.connectionChange,g),this.isConnected=!1)),this.checkPropertyValue(),this.commandHandler.updateSelector(),this.commandHandler.removeSnap(),this.commandHandler.changeAnnotationDrag(i),this instanceof qd||("ConnectorSourceEnd"!==this.endPoint||!i.source.connectors.length||a.equals(i.source.connectors[0].sourcePoint,this.undoElement.connectors[0].sourcePoint)&&i.source.connectors[0].sourceID===this.undoElement.connectors[0].sourceID)&&("ConnectorTargetEnd"!==this.endPoint||a.equals(i.source.connectors[0].targetPoint,this.undoElement.connectors[0].targetPoint)&&i.source.connectors[0].targetID===this.undoElement.connectors[0].targetID)?this instanceof qd||"BezierTargetThumb"!==this.endPoint&&"BezierSourceThumb"!==this.endPoint||this.undoElement&&i.source&&(f=Ah(i.source),m={type:"SegmentChanged",redoObject:f,undoObject:this.undoElement,category:"Internal"},this.commandHandler.addHistoryEntry(m)):(h=void 0,d=void 0,i.source&&i.source.connectors&&(h={x:this.prevPosition.x,y:this.prevPosition.y},d=i.source.connectors[0]),l=void 0,c=void 0,i.target&&((p=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof Ve?l=p.id:c=p.id),g={connector:d,state:"Completed",targetNode:c,oldValue:h,newValue:h,cancel:!1,targetPort:l},sf.base.isBlazor()&&(g={connector:_a(d),state:"Completed",targetNode:c,oldValue:_a(h),newValue:h,cancel:g.cancel,targetPort:l}),u="ConnectorSourceEnd"===this.endPoint?e.DiagramEvent.sourcePointChange:e.DiagramEvent.targetPointChange,this.commandHandler.triggerEvent(u,g),this.commandHandler.removeTerminalSegment(d,!0),this.undoElement&&i.source&&(f=void 0,f=Ah(i.source),m={type:"ConnectionChanged",redoObject:Ah(f),undoObject:Ah(this.undoElement),category:"Internal"},this.commandHandler.addHistoryEntry(m))),this.commandHandler.updateBlazorSelector(),this.canCancel=void 0,this.tempArgs=void 0,t.prototype.mouseUp.call(this,i),[2]}}))}))},i.prototype.mouseMove=function(i){var r;if(t.prototype.mouseMove.call(this,i),!(this instanceof qd)&&("ConnectorSourceEnd"===this.endPoint&&a.equals(i.source.connectors[0].sourcePoint,this.undoElement.connectors[0].sourcePoint)||"ConnectorTargetEnd"===this.endPoint&&a.equals(i.source.connectors[0].targetPoint,this.undoElement.connectors[0].targetPoint))){var o=void 0,n=void 0;i.source&&i.source.connectors&&(o={x:this.prevPosition.x,y:this.prevPosition.y},n=i.source.connectors[0]);var s=void 0,h=void 0;if(i.target)h=i.target.id,(b=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof Ve||b instanceof Cs?s=b.id:h=b.id;var d={connector:n,state:"Start",targetNode:h,oldValue:o,newValue:o,cancel:!1,targetPort:s};sf.base.isBlazor()&&(d={connector:_a(n),state:"Start",targetNode:h,oldValue:o,newValue:o,cancel:d.cancel,targetPort:s});var l="ConnectorSourceEnd"===this.endPoint?e.DiagramEvent.sourcePointChange:e.DiagramEvent.targetPointChange;this.commandHandler.triggerEvent(l,d)}if(this.currentPosition=i.position,this.currentPosition&&this.prevPosition){var c=this.currentPosition.x-this.prevPosition.x,p=this.currentPosition.y-this.prevPosition.y,g=void 0,u=(o=void 0,void 0),f=void 0;this.currentPosition=this.commandHandler.snapConnectorEnd(this.currentPosition);var m=void 0;i.source&&i.source.connectors&&(g={x:this.currentPosition.x,y:this.currentPosition.y},o={x:this.prevPosition.x,y:this.prevPosition.y},m=i.source.connectors[0]);var y=void 0,v=void 0;if(i.target)(b=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof Ve?y=b.id:v=b.id;var b;d={connector:m,state:"Progress",targetNode:v,oldValue:o,newValue:g,cancel:!1,targetPort:y};if(sf.base.isBlazor()&&(d={connector:_a(m),state:"Progress",targetNode:v,oldValue:o,newValue:g,cancel:d.cancel,targetPort:y}),!(this instanceof qd)){l="ConnectorSourceEnd"===this.endPoint?e.DiagramEvent.sourcePointChange:e.DiagramEvent.targetPointChange;this.commandHandler.triggerEvent(l,d)}if(i.target&&(u=wa(i.target,!0),f=wa(i.target,!1)),!d.cancel&&this.inAction&&void 0!==this.endPoint&&0!==c||0!==p)if(this.blocked=!this.commandHandler.dragConnectorEnds(this.endPoint,i.source,this.currentPosition,this.selectedSegment,i.target,y),this.commandHandler.updateSelector(),i.target&&("ConnectorSourceEnd"===this.endPoint&&(Wr(i.target)||_r(f))||"ConnectorTargetEnd"===this.endPoint&&(jr(i.target)||Hr(u))))if(this.commandHandler.canDisconnect(this.endPoint,i,y,v)&&(r=this.commandHandler.disConnect(i.source,this.endPoint,this.canCancel),this.isConnected=!0),(b=this.commandHandler.findTarget(i.targetWrapper,i.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof js)(jr(b)&&"ConnectorTargetEnd"===this.endPoint||Wr(b)&&"ConnectorSourceEnd"===this.endPoint)&&(r=this.commandHandler.connect(this.endPoint,i,this.canCancel),this.isConnected=!0);else this.checkConnect(b)&&(this.isConnected=!0,r=this.commandHandler.connect(this.endPoint,i,this.canCancel));else-1===this.endPoint.indexOf("Bezier")&&(this.isConnected=!0,r=this.commandHandler.disConnect(i.source,this.endPoint,this.canCancel),this.commandHandler.updateSelector());if(this.commandHandler.canEnableDefaultTooltip()){var w=this.getTooltipContent(i.position);this.commandHandler.showTooltip(i.source,i.position,w,"ConnectTool",this.isTooltipVisible),this.isTooltipVisible=!1}r&&(this.tempArgs=r)}return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.mouseLeave=function(e){this.mouseUp(e)},i.prototype.getTooltipContent=function(e){return"X:"+Math.round(e.x)+" Y:"+Math.round(e.y)},i.prototype.checkConnect=function(t){return!(!Hr(t)||"ConnectorTargetEnd"!==this.endPoint)||(!(!_r(t)||"ConnectorSourceEnd"!==this.endPoint)||!(t.constraints&e.PortConstraints.None||Hr(t)||_r(t)))},i.prototype.endAction=function(){t.prototype.endAction.call(this),this.prevPosition=null,this.endPoint=null},i}(_d),Ud=function(t){function i(e,i){var r=t.call(this,e,!0)||this;return r.currentTarget=null,r.canCancel=!1,r.objectType=i,r}return jd(i,t),i.prototype.mouseDown=function(e){if(e.source instanceof js||e.source instanceof wr){var i=this.commandHandler.getSelectedObject();this.commandHandler.selectObjects([e.source],e.info&&e.info.ctrlKey,i);var r={nodes:[],connectors:[]};e.source instanceof js?r.nodes.push(Ah(e.source)):r.connectors.push(Ah(e.source)),this.undoElement=Ah(r)}else this.undoElement=Ah(e.source);var o;if(this.undoParentElement=this.commandHandler.getSubProcess(e.source),"Port"===this.objectType&&(this.portId=e.sourceWrapper.id),this.commandHandler.insertBlazorConnector(e.source),sf.base.isBlazor()){this.commandHandler.insertSelectedObjects(),this.startPosition=this.currentPosition=this.prevPosition=e.position,this.initialOffset={x:0,y:0},e.source&&(o={offsetX:e.source.wrapper.offsetX,offsetY:e.source.wrapper.offsetY});var n={source:Ah(e.source),state:"Start",oldValue:o,newValue:{},target:Ah(e.target),targetPosition:e.position,allowDrop:!0,cancel:!1};this.tempArgs=n}t.prototype.mouseDown.call(this,e),this.initialOffset={x:0,y:0}},i.prototype.mouseUp=function(i,r){return Hd(this,void 0,void 0,(function(){var o,n,a,s,h,d,l,c,p,g,u,f,m,y,v,b,w;return Wd(this,(function(x){switch(x.label){case 0:return sf.base.isBlazor()&&"Port"!==this.objectType?(this.commandHandler.updatePropertiesToBlazor(i,!1),i.source&&(n={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY},o={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY}),m={state:"Completed",oldValue:_a(this.tempArgs.oldValue),newValue:_a(n),target:_a(this.currentTarget),targetPosition:_a(this.currentPosition),allowDrop:!0,cancel:!1},a=void 0,"diagram","sfBlazor","Blazor",window&&window.Blazor&&this.commandHandler.diagram.positionChange?(s={EventName:"positionChange",args:JSON.stringify(m)},[4,window.sfBlazor.updateBlazorDiagramEvents(s,this.commandHandler.diagram)]):[3,2]):[3,3];case 1:a=x.sent(),x.label=2;case 2:a&&a.cancel&&(this.commandHandler.enableCloneObject(!0),this.commandHandler.ismouseEvents(!0),this.canCancel=!0),this.canCancel&&(this.commandHandler.insertBlazorObject(i.source),h=this.tempArgs.oldValue.offsetX-i.source.wrapper.offsetX,d=this.tempArgs.oldValue.offsetY-i.source.wrapper.offsetY,this.commandHandler.dragSelectedObjects(h,d)),x.label=3;case 3:return this.checkPropertyValue(),c=!1,g={nodes:[],connectors:[]},"Port"===this.objectType?[3,8]:(i.source instanceof js||i.source instanceof wr?(i.source instanceof js?g.nodes.push(Ah(i.source)):g.connectors.push(Ah(i.source)),l=Ah(g),u=i.source.wrapper,l.offsetX=u.offsetX,l.offsetY=u.offsetY):l=Ah(i.source),("helper"!==(p=this.commandHandler.renderContainerHelper(i.source)||i.source||this.commandHandler.renderContainerHelper(i.source)).id||l.nodes[0].isLane||l.nodes[0].isPhase)&&"helper"===p.id||(!(p instanceof Ys&&p.width===this.undoElement.width&&p.height===this.undoElement.height)&&p instanceof Ys||p.offsetX===this.undoElement.offsetX&&p.offsetY===this.undoElement.offsetY&&p.sourcePoint===this.undoElement.sourcePoint&&p.targetPoint===this.undoElement.targetPoint)&&!this.isSelectionHasConnector(p)||(i.source&&(n={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY},o={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY}),m={source:i.source,state:"Completed",oldValue:o,newValue:n,target:this.currentTarget,targetPosition:this.currentPosition,allowDrop:!0,cancel:!1},m={source:_a(i.source),state:"Completed",oldValue:_a(o),newValue:_a(n),target:_a(this.currentTarget),targetPosition:_a(this.currentPosition),allowDrop:m.allowDrop,cancel:m.cancel},sf.base.isBlazor()&&(m=this.getBlazorPositionChangeEventArgs(m,this.currentTarget)),sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.positionChange,m),r||(this.commandHandler.startGroupAction(),c=!0,w={type:"PositionChanged",redoObject:Ah(l),undoObject:Ah(this.undoElement),category:"Internal"},l.nodes[0]&&l.nodes[0].processId&&(f={type:"SizeChanged",category:"Internal",undoObject:this.undoParentElement,redoObject:this.commandHandler.getSubProcess(i.source)},this.commandHandler.addHistoryEntry(f)),this.commandHandler.addHistoryEntry(w))),this.commandHandler.snapPoint(this.prevPosition,this.currentPosition,0,0),this.commandHandler.removeSnap(),this.commandHandler.removeHighlighter(),i.source&&this.currentTarget&&Xr(this.currentTarget)&&this.commandHandler.isDroppable(i.source,this.currentTarget)?(this.commandHandler.drop(this.currentElement,this.currentTarget,this.currentPosition),m={element:i.source,target:this.currentTarget,position:this.currentPosition,cancel:!1},sf.base.isBlazor()?(m=Ia(i,m),[4,this.commandHandler.triggerEvent(e.DiagramEvent.drop,m)]):[3,5]):[3,7]);case 4:return m=x.sent()||m,[3,6];case 5:this.commandHandler.triggerEvent(e.DiagramEvent.drop,m),x.label=6;case 6:if(!m.cancel&&i.source&&this.commandHandler.isParentAsContainer(this.currentTarget)){for(y=i.source instanceof Ys?i.source.nodes:[i.source],v=!1,b=0;b<y.length;b++)y[b].container||(v=!0,this.commandHandler.dropChildToContainer(this.currentTarget,y[b]),this.commandHandler.renderContainerHelper(y[b]));c&&this.commandHandler.isContainer&&v&&this.commandHandler.endGroupAction()}x.label=7;case 7:return i.source&&this.currentTarget&&this.commandHandler.dropAnnotation(i.source,this.currentTarget),this.commandHandler.updateSelector(),c&&!this.commandHandler.isContainer&&this.commandHandler.endGroupAction(),[3,9];case 8:g.nodes.push(Ah(i.source)),i.portId=this.portId,l=Ah(g),w={type:"PortPositionChanged",objectId:this.portId,redoObject:Ah(l),undoObject:Ah(this.undoElement),category:"Internal"},this.commandHandler.addHistoryEntry(w),x.label=9;case 9:return this.commandHandler.updateBlazorSelector(),t.prototype.mouseUp.call(this,i),[2]}}))}))},i.prototype.isSelectionHasConnector=function(e){return!(!(e.nodes&&e.connectors&&e.nodes.length>0&&e.connectors.length>0)||e.width===this.undoElement.width&&e.height===this.undoElement.height)},i.prototype.getBlazorPositionChangeEventArgs=function(e,t){return e={source:_a(e.source),state:e.state,oldValue:e.oldValue,newValue:e.newValue,target:Ea(t)===wr?{connector:_a(t)}:{node:_a(t)},targetPosition:this.currentPosition,allowDrop:!0,cancel:!1}},i.prototype.mouseMove=function(i){t.prototype.mouseMove.call(this,i);var r,o,n=!1;(r=this.commandHandler.renderContainerHelper(i.source)||i.source)instanceof js||r instanceof wr?r instanceof js?r.offsetX===this.undoElement.nodes[0].offsetX&&r.offsetY===this.undoElement.nodes[0].offsetY&&(n=!0):a.equals(r.sourcePoint,this.undoElement.connectors[0].sourcePoint)&&a.equals(r.targetPoint,this.undoElement.connectors[0].targetPoint)&&(n=!0):r.wrapper.offsetX===this.undoElement.wrapper.offsetX&&r.wrapper.offsetY===this.undoElement.wrapper.offsetY&&(n=!0),r&&(o={offsetX:r.wrapper.offsetX,offsetY:r.wrapper.offsetY});var s={source:r,state:"Start",oldValue:o,newValue:o,target:i.target,targetPosition:i.position,allowDrop:!0,cancel:!1};if(s={source:_a(r),state:"Start",oldValue:_a(o),newValue:_a(o),target:i.target,targetPosition:i.position,allowDrop:s.allowDrop,cancel:s.cancel},n&&!sf.base.isBlazor()&&this.commandHandler.triggerEvent(e.DiagramEvent.positionChange,s),this.currentPosition=i.position,"Port"!==this.objectType){this.currentPosition.x,this.prevPosition.x,this.currentPosition.y,this.prevPosition.y;var h,d=this.initialOffset.x+(this.currentPosition.x-this.prevPosition.x),l=this.initialOffset.y+(this.currentPosition.y-this.prevPosition.y);this.commandHandler.dragOverElement(i,this.currentPosition),this.commandHandler.disConnect(i.source),this.commandHandler.removeSnap();var c=void 0,p=this.commandHandler.snapPoint(this.prevPosition,this.currentPosition,d,l);this.initialOffset.x=d-p.x,this.initialOffset.y=l-p.y,r&&(h={offsetX:r.wrapper.offsetX,offsetY:r.wrapper.offsetY},c={offsetX:r.wrapper.offsetX+p.x,offsetY:r.wrapper.offsetY+p.y}),this.currentTarget&&i.target!==this.currentTarget&&this.commandHandler.removeChildFromBPmn(i.source,i.target,this.currentTarget),this.currentTarget=i.target;var g={source:r,state:"Progress",oldValue:h,newValue:c,target:i.target,targetPosition:i.position,allowDrop:!0,cancel:!1};if(sf.base.isBlazor()&&(g=this.getBlazorPositionChangeEventArgs(g,i.target)),sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.positionChange,g),!g.cancel&&!this.canCancel){this.blocked=!this.commandHandler.dragSelectedObjects(p.x,p.y);var u=!this.commandHandler.mouseOver(this.currentElement,this.currentTarget,this.currentPosition);this.blocked=this.blocked||u}if(this.commandHandler.removeStackHighlighter(),this.commandHandler.renderStackHighlighter(i),this.currentTarget&&i.source!==this.currentTarget&&this.commandHandler.isDroppable(i.source,this.currentTarget)&&"helper"!==i.source.id){var f=i.source instanceof Ys?i.source.nodes[0]:i.source;this.commandHandler.isParentAsContainer(f,!0)||"SwimLane"===f.shape.type||f.shape.isPhase||(this.currentTarget.isLane?this.commandHandler.renderStackHighlighter(i,this.currentTarget):this.commandHandler.drawHighlighter(this.currentTarget))}else this.commandHandler.removeHighlighter();if(this.commandHandler.canEnableDefaultTooltip()){var m=this.getTooltipContent(i.source);this.commandHandler.showTooltip(i.source,i.position,m,"MoveTool",this.isTooltipVisible),this.isTooltipVisible=!1}}else{var y=x(),v=i.source;P(y,-v.rotateAngle,v.offsetX,v.offsetY);var b=C(y,{x:this.prevPosition.x,y:this.prevPosition.y}),w=C(y,{x:i.position.x,y:i.position.y});this.commandHandler.portDrag(i.source,i.sourceWrapper,w.x-b.x,w.y-b.y)}return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.getTooltipContent=function(e){return"X:"+Math.round(e.wrapper.bounds.x)+" Y:"+Math.round(e.wrapper.bounds.y)},i.prototype.mouseLeave=function(e){this.mouseUp(e)},i.prototype.endAction=function(){t.prototype.endAction.call(this),this.currentTarget=null,this.prevPosition=null},i}(_d),Gd=function(t){function i(e){return t.call(this,e,!0)||this}return jd(i,t),i.prototype.mouseDown=function(e){if(sf.base.isBlazor()){var i={rotateAngle:(this.commandHandler.renderContainerHelper(e.source)||e.source).wrapper.rotateAngle},r={source:_a(e.source),state:"Start",oldValue:i,newValue:void 0,cancel:!1};this.tempArgs=r,this.tempArgs&&this.tempArgs.cancel&&(this.canCancel=!0)}if(this.undoElement=Ah(e.source),this.undoElement.nodes[0]&&this.undoElement.nodes[0].children)for(var o=this.commandHandler.getAllDescendants(this.undoElement.nodes[0],[]),n=0;n<o.length;n++){var a=this.commandHandler.cloneChild(o[n].id);this.childTable[o[n].id]=Ah(a)}t.prototype.mouseDown.call(this,e)},i.prototype.mouseUp=function(i){return Hd(this,void 0,void 0,(function(){var r,o,n,a,s,h,d,l,c;return Wd(this,(function(p){switch(p.label){case 0:return this.checkPropertyValue(),sf.base.isBlazor()?("diagram","sfBlazor","Blazor",this.commandHandler.updatePropertiesToBlazor(i,!1),r=this.commandHandler.renderContainerHelper(i.source)||i.source,h={rotateAngle:this.tempArgs.oldValue.rotateAngle},o={rotateAngle:r.wrapper.rotateAngle},d={state:"Completed",oldValue:h,newValue:o,cancel:!1},n=void 0,window&&window.Blazor&&this.commandHandler.diagram.rotateChange?(a={EventName:"rotateChange",args:JSON.stringify(d)},[4,window.sfBlazor.updateBlazorDiagramEvents(a,this.commandHandler.diagram)]):[3,2]):[3,3];case 1:n=p.sent(),p.label=2;case 2:n&&n.cancel&&(this.commandHandler.enableCloneObject(!0),this.commandHandler.ismouseEvents(!0),this.canCancel=!0),this.canCancel&&(this.commandHandler.insertBlazorObject(i.source),this.commandHandler.rotatePropertyChnage(this.tempArgs.oldValue.rotateAngle)),p.label=3;case 3:return s=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.rotateAngle!==s.wrapper.rotateAngle&&(h={rotateAngle:s.wrapper.rotateAngle},d={source:i.source,state:"Completed",oldValue:h,newValue:h,cancel:!1},sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.rotateChange,d),void 0,l=Ah(i.source),c={type:"RotationChanged",redoObject:Ah(l),undoObject:Ah(this.undoElement),category:"Internal",childTable:this.childTable},this.commandHandler.addHistoryEntry(c),this.commandHandler.updateSelector()),this.commandHandler.updateBlazorSelector(),this.canCancel=void 0,this.tempArgs=void 0,t.prototype.mouseUp.call(this,i),[2]}}))}))},i.prototype.mouseMove=function(i){var r;if(t.prototype.mouseMove.call(this,i),r=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.rotateAngle===r.wrapper.rotateAngle){var o={rotateAngle:r.wrapper.rotateAngle},n={source:i.source,state:"Start",oldValue:o,newValue:o,cancel:!1};sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.rotateChange,n)}this.currentPosition=i.position;var s={x:r.wrapper.offsetX,y:r.wrapper.offsetY},h=a.findAngle(s,this.currentPosition)+90,d=this.commandHandler.snapAngle(h);h=((h=0!==d?d:h)+360)%360;var l={rotateAngle:r.wrapper.rotateAngle},c={rotateAngle:h},p=(i.source,!1),g={source:_a(i.source),state:"Progress",oldValue:_a(l),newValue:_a(c),cancel:p};if(sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.rotateChange,g),(!sf.base.isBlazor()&&!g.cancel||sf.base.isBlazor()&&!this.canCancel)&&(this.blocked=!this.commandHandler.rotateSelectedItems(h-r.wrapper.rotateAngle)),this.commandHandler.canEnableDefaultTooltip()){var u=this.getTooltipContent(i.source);this.commandHandler.showTooltip(i.source,i.position,u,"RotateTool",this.isTooltipVisible),this.isTooltipVisible=!1}return!this.blocked},i.prototype.getTooltipContent=function(e){return Math.round(e.rotateAngle%360).toString()+""},i.prototype.mouseLeave=function(e){this.mouseUp(e)},i.prototype.endAction=function(){t.prototype.endAction.call(this)},i}(_d),Fd=function(t){function i(e,i){var r=t.call(this,e,!0)||this;return r.initialBounds=new b,r.canCancel=!1,r.corner=i,r}return jd(i,t),i.prototype.mouseDown=function(e){var i;if(sf.base.isBlazor()){this.commandHandler.insertSelectedObjects(),this.startPosition=this.currentPosition=this.prevPosition=e.position,this.currentElement=e.source,this.initialBounds.x=e.source.wrapper.offsetX,this.initialBounds.y=e.source.wrapper.offsetY,this.initialBounds.height=e.source.wrapper.actualSize.height,this.initialBounds.width=e.source.wrapper.actualSize.width,e.source&&(i={offsetX:e.source.wrapper.offsetX,offsetY:e.source.wrapper.offsetY,width:e.source.wrapper.actualSize.width,height:e.source.wrapper.actualSize.height});var r={source:_a(e.source),state:"Start",oldValue:i,newValue:_a(this.currentElement),cancel:!1};this.tempArgs=r}if(this.undoElement=Ah(e.source),this.undoParentElement=this.commandHandler.getSubProcess(e.source),t.prototype.mouseDown.call(this,e),this.undoElement.nodes[0]&&this.undoElement.nodes[0].children)for(var o=this.commandHandler.getAllDescendants(this.undoElement.nodes[0],[]),n=0;n<o.length;n++){var a=this.commandHandler.cloneChild(o[n].id);this.childTable[o[n].id]=Ah(a)}this.commandHandler.checkSelection(e.source,this.corner),t.prototype.mouseDown.call(this,e),this.initialBounds.x=e.source.wrapper.offsetX,this.initialBounds.y=e.source.wrapper.offsetY,this.initialBounds.height=e.source.wrapper.actualSize.height,this.initialBounds.width=e.source.wrapper.actualSize.width},i.prototype.mouseUp=function(i,r){return Hd(this,void 0,void 0,(function(){var o,n,a,s,h,d,l,c,p,g,u,f;return Wd(this,(function(m){switch(m.label){case 0:return sf.base.isBlazor()?("diagram","sfBlazor","Blazor",this.commandHandler.updatePropertiesToBlazor(i,!1),g=Ah(i.source),o={width:i.source.wrapper.actualSize.width,height:i.source.wrapper.actualSize.height,offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY},p={oldValue:this.tempArgs.oldValue,newValue:o,cancel:!1,state:"Completed"},this.canCancel?[3,3]:(n=void 0,window&&window.Blazor&&this.commandHandler.diagram.sizeChange?(a={EventName:"sizeChange",args:JSON.stringify(p)},[4,window.sfBlazor.updateBlazorDiagramEvents(a,this.commandHandler.diagram)]):[3,2])):[3,4];case 1:n=m.sent(),m.label=2;case 2:n&&n.cancel&&(this.commandHandler.enableCloneObject(!0),this.commandHandler.ismouseEvents(!0),this.commandHandler.insertBlazorObject(i.source),s=this.tempArgs.oldValue.width/g.wrapper.actualSize.width,h=this.tempArgs.oldValue.height/g.wrapper.actualSize.height,this.commandHandler.scaleSelectedItems(s,h,this.getPivot(this.corner))),m.label=3;case 3:this.tempArgs=void 0,this.canCancel=void 0,m.label=4;case 4:return this.checkPropertyValue(),this.commandHandler.removeSnap(),this.commandHandler.updateSelector(),d=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.offsetX===d.wrapper.offsetX&&this.undoElement.offsetY===d.wrapper.offsetY&&this.undoElement.width===d.wrapper.bounds.width&&this.undoElement.height===d.wrapper.bounds.height||(sf.base.isBlazor()||(l=this.updateSize(i.source,this.currentPosition,this.prevPosition,this.corner,this.initialBounds),this.blocked=this.scaleObjects(l.width,l.height,this.corner,this.currentPosition,this.prevPosition,d),c={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY,width:i.source.wrapper.actualSize.width,height:i.source.wrapper.actualSize.height},p={source:_a(i.source),state:"Completed",oldValue:c,newValue:c,cancel:!1},this.commandHandler.triggerEvent(e.DiagramEvent.sizeChange,p)),g=Ah(i.source),u={type:"SizeChanged",redoObject:Ah(g),undoObject:Ah(this.undoElement),category:"Internal",childTable:this.childTable},r||(this.commandHandler.startGroupAction(),this.commandHandler.addHistoryEntry(u),g.nodes[0]&&g.nodes[0].processId&&(f={type:"SizeChanged",redoObject:this.commandHandler.getSubProcess(i.source),undoObject:this.undoParentElement,category:"Internal"},this.commandHandler.addHistoryEntry(f)),this.commandHandler.endGroupAction())),this.commandHandler.updateBlazorSelector(),t.prototype.mouseUp.call(this,i),[2,!this.blocked]}}))}))},i.prototype.mouseMove=function(i){var r;if(t.prototype.mouseMove.call(this,i),r=this.commandHandler.renderContainerHelper(i.source)||i.source,this.undoElement.offsetX===r.wrapper.offsetX&&this.undoElement.offsetY===r.wrapper.offsetY){var o={offsetX:i.source.wrapper.offsetX,offsetY:i.source.wrapper.offsetY,width:i.source.wrapper.actualSize.width,height:i.source.wrapper.actualSize.height},n={source:i.source,state:"Start",oldValue:o,newValue:this.currentElement,cancel:!1};sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.sizeChange,n)}this.currentPosition=i.position;var a={x:this.currentPosition.x-this.startPosition.x,y:this.currentPosition.y-this.startPosition.y};a=jh(-this.currentElement.wrapper.rotateAngle,void 0,void 0,a);this.currentElement.wrapper.actualSize.width,a.x,this.currentElement.wrapper.actualSize.width,this.currentElement.wrapper.actualSize.height,a.y,this.currentElement.wrapper.actualSize.height;a=this.getChanges(a),this.commandHandler.removeSnap();var s=this.updateSize(i.source,this.startPosition,this.currentPosition,this.corner,this.initialBounds);if(this.blocked=!this.scaleObjects(s.width,s.height,this.corner,this.startPosition,this.currentPosition,r),this.commandHandler.canEnableDefaultTooltip()){var h=this.getTooltipContent(i.source);this.commandHandler.showTooltip(i.source,i.position,h,"ResizeTool",this.isTooltipVisible),this.isTooltipVisible=!1}return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.mouseLeave=function(e){this.mouseUp(e)},i.prototype.getTooltipContent=function(e){return"W:"+Math.round(e.wrapper.bounds.width)+" H:"+Math.round(e.wrapper.bounds.height)},i.prototype.getChanges=function(e){switch(this.corner){case"ResizeEast":return{x:e.x,y:0};case"ResizeSouthEast":return e;case"ResizeSouth":return{x:0,y:e.y};case"ResizeNorth":return{x:0,y:-e.y};case"ResizeNorthEast":return{x:e.x,y:-e.y};case"ResizeNorthWest":return{x:-e.x,y:-e.y};case"ResizeWest":return{x:-e.x,y:0};case"ResizeSouthWest":return{x:-e.x,y:e.y}}return e},i.prototype.scaleObjects=function(t,i,r,o,n,a){a instanceof Ys&&1===a.nodes.length&&a.nodes[0].constraints&e.NodeConstraints.AspectRatio&&("ResizeWest"===r||"ResizeEast"===r||"ResizeNorth"===r||"ResizeSouth"===r?1===i&&1===t||(i=t=Math.max(1===i?0:i,1===t?0:t)):i=t=o!==n?Math.max(i,t):0);var s={offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height};this.blocked=this.commandHandler.scaleSelectedItems(t,i,this.getPivot(this.corner));var h,d,l={offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height};return h={source:a,state:"Progress",oldValue:s,newValue:l,cancel:!1},d={source:_a(a),state:"Progress",oldValue:_a(s),newValue:_a(l),cancel:h.cancel},sf.base.isBlazor()||this.commandHandler.triggerEvent(e.DiagramEvent.sizeChange,d),(d.cancel||this.canCancel)&&this.commandHandler.scaleSelectedItems(1/t,1/i,this.getPivot(this.corner)),this.blocked},i}(_d),Zd=function(e){function t(t,i){var r=e.call(this,t,!0)||this;return r.sourceObject=i,r}return jd(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.inAction=!0,this.commandHandler.setFocus()},t.prototype.mouseMove=function(t){var i;e.prototype.mouseMove.call(this,t);var r={offsetX:this.currentPosition.x,width:3,height:3,offsetY:this.currentPosition.y};if(this.drawingObject||(this.drawingObject=this.commandHandler.drawObject(r)),this.inAction&&!1===a.equals(this.currentPosition,this.prevPosition)){var o=b.toBounds([this.prevPosition,this.currentPosition]);(i=this.commandHandler.checkBoundaryConstraints(void 0,void 0,o))&&this.commandHandler.updateNodeDimension(this.drawingObject,o)}return i},t.prototype.mouseUp=function(t){this.checkPropertyValue();var i=b.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.checkBoundaryConstraints(void 0,void 0,i),this.drawingObject&&this.drawingObject instanceof js&&(this.commandHandler.addObjectToDiagram(this.drawingObject),this.drawingObject=null),this.commandHandler.updateBlazorSelector(),e.prototype.mouseUp.call(this,t),this.inAction=!1},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t.prototype.mouseLeave=function(e){this.inAction&&this.mouseUp(e)},t}(_d),qd=function(e){function t(t,i,r){var o=e.call(this,t,i)||this;return o.sourceObject=r,o}return jd(t,e),t.prototype.mouseDown=function(t){return Hd(this,void 0,void 0,(function(){return Wd(this,(function(i){return e.prototype.mouseDown.call(this,t),this.inAction=!0,this.commandHandler.setFocus(),[2]}))}))},t.prototype.mouseMove=function(t){if(this.commandHandler.enableServerDataBinding(!1),this.inAction){var i={sourcePoint:this.currentPosition,targetPoint:this.currentPosition};this.drawingObject||(this.drawingObject=this.commandHandler.drawObject(i)),t.source=this.drawingObject,(t.target&&t.target instanceof js||t.actualObject&&t.sourceWrapper&&Na(t.actualObject,t.sourceWrapper))&&("ConnectorTargetEnd"!==this.endPoint||jr(t.target))&&this.commandHandler.connect(this.endPoint,t),this.endPoint="ConnectorTargetEnd"}return this.inAction||(this.commandHandler.updateSelector(),t.source&&t.sourceWrapper&&this.commandHandler.renderHighlighter(t,!0)),e.prototype.mouseMove.call(this,t),this.commandHandler.enableServerDataBinding(!0),!this.blocked},t.prototype.mouseUp=function(t){return Hd(this,void 0,void 0,(function(){return Wd(this,(function(i){return this.commandHandler.enableServerDataBinding(!1),this.checkPropertyValue(),this.drawingObject&&this.drawingObject instanceof wr&&(this.commandHandler.addObjectToDiagram(this.drawingObject),this.drawingObject=null),this.commandHandler.updateBlazorSelector(),this.inAction=!1,this.commandHandler.enableServerDataBinding(!0),e.prototype.mouseUp.call(this,t),[2]}))}))},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t.prototype.mouseLeave=function(e){this.inAction&&this.mouseUp(e)},t}(Yd),Kd=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.commandHandler.clearSelection();var i={shape:{type:"Text"},offsetX:this.currentPosition.x,offsetY:this.currentPosition.y};t.source||(this.drawingNode=this.commandHandler.drawObject(i))},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.drawingNode)this.drawingNode.style.strokeColor="black",this.drawingNode.style.strokeDashArray="2 2",this.drawingNode.style.fill="transparent";else{var i={shape:{type:"Text"},offsetX:this.currentPosition.x,width:30,height:30,offsetY:this.currentPosition.y};this.drawingNode=this.commandHandler.drawObject(i),this.drawingNode.style.strokeDashArray="2 2",this.drawingNode.style.fill="transparent"}if(this.inAction&&!1===a.equals(this.currentPosition,this.prevPosition)){var r=b.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.updateNodeDimension(this.drawingNode,r)}return!this.blocked},t.prototype.mouseUp=function(t){this.checkPropertyValue(),this.drawingNode?(this.drawingNode.style.strokeColor="none",this.drawingNode.style.fill="none"):this.drawingNode=t.source,this.drawingNode&&(this.drawingNode instanceof js||this.drawingNode instanceof wr)&&this.commandHandler.addText(this.drawingNode,this.currentPosition),e.prototype.mouseUp.call(this,t),this.inAction=!1},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t}(_d),Qd=function(e){function t(t,i){var r=e.call(this,t)||this;return r.zooming=i,r}return jd(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.inAction=!0,this.commandHandler.setBlazorDiagramProps(!0)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction)if(this.zooming||!1!==a.equals(this.currentPosition,this.prevPosition)){if(t.moveTouches&&t.moveTouches.length&&t.moveTouches.length>=2){var i=t.startTouches[0],r=t.startTouches[1],o=t.moveTouches[0],n=t.moveTouches[1],s=this.getDistance(o,n)/this.getDistance(i,r),h=t.position;this.commandHandler.zoom(s,0,0,h),this.updateTouch(i,o),this.updateTouch(r,n)}}else{var d=this.currentPosition.x-this.prevPosition.x,l=this.currentPosition.y-this.prevPosition.y;this.commandHandler.scroll(d,l,this.currentPosition)}return this.commandHandler.dataBinding(),!this.blocked},t.prototype.mouseUp=function(t){this.commandHandler.setBlazorDiagramProps(!1),this.checkPropertyValue(),this.commandHandler.updatePanState(!1),e.prototype.mouseUp.call(this,t),this.inAction=!1},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t.prototype.getDistance=function(e,t){var i=t.pageX-e.pageX,r=t.pageY-e.pageY;return Math.sqrt(i*i+r*r)},t.prototype.updateTouch=function(e,t){e.pageX=t.pageX,e.pageY=t.pageY},t}(_d),Jd=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseUp=function(t){this.checkPropertyValue(),this.commandHandler.initExpand(t),e.prototype.mouseUp.call(this,t)},t}(_d),$d=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseUp=function(t){this.checkPropertyValue(),window.open(t.sourceWrapper.hyperlink.link,"_blank").focus(),e.prototype.mouseUp.call(this,t)},t}(_d),el=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseDown=function(t){if(e.prototype.mouseDown.call(this,t),this.inAction=!0,this.drawingObject){var i=void 0,r=this.drawingObject.shape;i={x:(i=r.points[r.points.length-1]).x,y:i.y},this.drawingObject.shape.points.push(i)}else{this.startPoint={x:this.startPosition.x,y:this.startPosition.y};var o={offsetX:this.currentPosition.x,offsetY:this.currentPosition.y,width:5,height:5,style:{strokeColor:"black",strokeWidth:1},shape:{type:"Basic",shape:"Polygon",points:[{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPosition.x,y:this.currentPosition.y}]}};sf.base.isBlazor()&&"Basic"===o.shape.type&&(o.shape.basicShape="Polygon"),this.drawingObject=this.commandHandler.drawObject(o)}},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction){var i=this.drawingObject.shape;if(this.drawingObject&&this.currentPosition&&(i.points[i.points.length-1].x=this.currentPosition.x,i.points[i.points.length-1].y=this.currentPosition.y,this.drawingObject.wrapper.children[0].data=l(this.drawingObject.shape.points),this.inAction&&!1===a.equals(this.currentPosition,this.prevPosition))){var r=b.toBounds(this.drawingObject.shape.points);this.commandHandler.updateNodeDimension(this.drawingObject,r)}}return!0},t.prototype.mouseUp=function(t,i){this.checkPropertyValue(),e.prototype.mouseMove.call(this,t),this.inAction&&(this.inAction=!1,this.drawingObject&&this.commandHandler.addObjectToDiagram(this.drawingObject)),this.endAction()},t.prototype.mouseWheel=function(t){e.prototype.mouseWheel.call(this,t),this.mouseMove(t)},t.prototype.endAction=function(){this.inAction=!1,this.drawingObject=null},t}(_d),tl=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction){var i=this.drawingObject;i.targetPoint=this.currentPosition,this.commandHandler.updateConnectorPoints(i)}return!0},t.prototype.mouseDown=function(t){if(e.prototype.mouseDown.call(this,t),this.inAction=!0,this.drawingObject){var i=this.drawingObject,r=void 0;(r=new ar(i,"segments",{type:"Straight"},!0)).point=this.currentPosition,i.segments[i.segments.length-1]=r}else{var o={id:"Connector",type:"Straight",sourcePoint:this.currentPosition,targetPoint:this.currentPosition};this.drawingObject=this.commandHandler.drawObject(o)}},t.prototype.mouseWheel=function(t){e.prototype.mouseWheel.call(this,t),this.mouseMove(t)},t.prototype.mouseUp=function(t){if(this.checkPropertyValue(),e.prototype.mouseMove.call(this,t),this.inAction&&this.drawingObject){var i=this.drawingObject;i.segments[i.segments.length-1].point={x:0,y:0},this.commandHandler.addObjectToDiagram(this.drawingObject)}this.endAction()},t.prototype.endAction=function(){this.drawingObject=null,this.inAction=!1},t}(_d),il=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseDown=function(t){this.inAction=!0,this.undoElement=Ah(t.source),this.annotationId=t.sourceWrapper.id,e.prototype.mouseDown.call(this,t)},t.prototype.mouseMove=function(t){e.prototype.mouseMove.call(this,t);var i=this.currentPosition.x-this.prevPosition.x,r=this.currentPosition.y-this.prevPosition.y,o=t.source;if(o instanceof js){var n=x();P(n,-o.rotateAngle,0,0);var a=C(n,{x:i,y:r});i=a.x,r=a.y}return this.inAction&&(this.commandHandler.labelDrag(t.source,t.sourceWrapper,i,r),this.commandHandler.updateSelector()),this.prevPosition=this.currentPosition,!this.blocked},t.prototype.mouseUp=function(t){this.checkPropertyValue();var i=t.source;this.inAction=!1;var r={type:"AnnotationPropertyChanged",objectId:this.annotationId,undoObject:Ah(this.undoElement),category:"Internal",redoObject:Ah(i)};this.commandHandler.addHistoryEntry(r),e.prototype.mouseUp.call(this,t)},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t}(_d),rl=function(e){function t(t,i){var r=e.call(this,t,!0)||this;return r.corner=i,r}return jd(t,e),t.prototype.mouseDown=function(t){this.inAction=!0;var i=t.source.nodes.length?t.source.nodes[0]:t.source.connectors[0];this.annotationId=t.source.wrapper.children[0].id,this.undoElement=Ah(i);var r=t.source.wrapper.children[0];this.initialBounds={x:r.offsetX,y:r.offsetY,width:r.actualSize.width,height:r.actualSize.height},e.prototype.mouseDown.call(this,t)},t.prototype.mouseMove=function(t){return e.prototype.mouseMove.call(this,t),this.inAction&&this.resizeObject(t),!this.blocked},t.prototype.mouseUp=function(t){this.checkPropertyValue();var i=t.source.nodes.length?t.source.nodes[0]:t.source.connectors[0];this.inAction=!1;var r={type:"AnnotationPropertyChanged",objectId:this.annotationId,redoObject:Ah(i),undoObject:Ah(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(r),e.prototype.mouseUp.call(this,t)},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t.prototype.resizeObject=function(e){var t;t=e.source.nodes.length?e.source.nodes[0]:e.source.connectors[0];var i,r,o=e.source.wrapper.children[0],n={x:o.offsetX,y:o.offsetY},a=o.rotateAngle;a=((a+=t instanceof js?t.rotateAngle:0)+360)%360;var s=x();P(s,a,n.x,n.y);var h=this.corner.slice(5),d=this.updateSize(o,this.startPosition,this.currentPosition,h,this.initialBounds,a),l=o.offsetX-o.actualSize.width*o.pivot.x,c=o.offsetY-o.actualSize.height*o.pivot.y,p=this.getPivot(h),g=C(s,p={x:l+o.actualSize.width*p.x,y:c+o.actualSize.height*p.y});d.x=g.x,d.y=g.y,i=(i=d.width)<0?1:i,r=(r=d.height)<0?1:r,this.commandHandler.labelResize(t,e.source.annotation,i,r,d,e.source),this.commandHandler.updateSelector()},t}(_d),ol=function(e){function t(t){return e.call(this,t,!0)||this}return jd(t,e),t.prototype.mouseDown=function(t){this.inAction=!0,this.annotationId=t.source.wrapper.children[0].id;var i=t.source.nodes.length?t.source.nodes[0]:t.source.connectors[0];this.undoElement=Ah(i),e.prototype.mouseDown.call(this,t)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),t.source&&this.inAction){var i,r=t.source.nodes[0]?t.source.nodes[0]:t.source.connectors[0];i=t.source.annotation,this.commandHandler.labelRotate(r,i,this.currentPosition,t.source),this.commandHandler.updateSelector()}return this.prevPosition=this.currentPosition,!this.blocked},t.prototype.mouseUp=function(t){this.checkPropertyValue(),this.inAction=!1;var i=t.source.nodes.length?t.source.nodes[0]:t.source.connectors[0],r={type:"AnnotationPropertyChanged",objectId:this.annotationId,redoObject:Ah(i),undoObject:Ah(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(r),e.prototype.mouseUp.call(this,t)},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t}(_d),nl=(Dd=function(e,t){return(Dd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Dd(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),al=function(t){function i(e,i){var r=t.call(this,e,!0)||this;return r.endPoint=i,r}return nl(i,t),i.prototype.mouseDown=function(e){var i,r=!0;if(e.source&&e.source.connectors&&(i=e.source.connectors[0]),e.info&&(r=e.info.ctrlKey&&"Orthogonal"!==e.actualObject.type),i&&r){this.inAction=!0,this.undoElement=Ah(e.source),t.prototype.mouseDown.call(this,e);for(var o=0;o<i.segments.length;o++){var n=i.segments[o];if("OrthoThumb"===this.endPoint)for(var a=0;a<n.points.length-1;a++){var s={x:0,y:0};s.x=(n.points[a].x+n.points[a+1].x)/2,s.y=(n.points[a].y+n.points[a+1].y)/2,Pd(this.currentPosition,s,30)&&(this.selectedSegment=n,this.segmentIndex=a)}else Pd(this.currentPosition,n.point,10)&&(this.selectedSegment=n)}}},i.prototype.mouseMove=function(e){if(t.prototype.mouseMove.call(this,e),this.currentPosition=e.position,this.currentPosition&&this.prevPosition){var i=this.currentPosition.y-this.prevPosition.y,r=this.currentPosition.x-this.prevPosition.x;this.currentPosition=this.commandHandler.snapConnectorEnd(this.currentPosition);var o=void 0;if(e.source&&e.source.connectors&&(o=e.source.connectors[0]),this.inAction&&void 0!==this.selectedSegment&&void 0!==this.endPoint&&(0!==r||0!==i)){if("OrthoThumb"===this.endPoint)this.blocked=!this.dragOrthogonalSegment(o,this.selectedSegment,this.currentPosition,this.segmentIndex);else{var n=this.currentPosition.x-this.selectedSegment.point.x,a=this.currentPosition.y-this.selectedSegment.point.y,s=o.segments.indexOf(this.selectedSegment);this.blocked=!this.commandHandler.dragControlPoint(o,n,a,!1,s)}this.commandHandler.updateSelector()}}return this.prevPosition=this.currentPosition,!this.blocked},i.prototype.mouseUp=function(e){var i,r;if(e.source&&e.source.connectors&&(r={segments:(i=e.source.connectors[0]).segments}),e&&e.source&&e.info&&e.info.ctrlKey&&e.info.shiftKey&&"Straight"===i.type)this.addOrRemoveSegment(i,this.currentPosition);else if("OrthoThumb"===this.endPoint&&this.selectedSegment){var o=i.segments.indexOf(this.selectedSegment),n=i.segments[o-1],s=i.segments[o+1];if(o===i.segments.length-2&&this.updateLastSegment(i,this.selectedSegment))i.segments.splice(i.segments.length-2,1);else if(n&&Math.abs(n.length)<5)1!==o&&this.removePrevSegment(i,o);else if(s){var h=a.distancePoints(s.points[0],s.points[1]),d=s.length||0===s.length?s.length:h;Math.abs(d)<=5&&this.removeNextSegment(i,o)}this.commandHandler.updateEndPoint(i,r)}if(this.undoElement){var l={type:"SegmentChanged",redoObject:Ah(e.source),undoObject:this.undoElement,category:"Internal"};this.commandHandler.addHistoryEntry(l)}t.prototype.mouseUp.call(this,e)},i.prototype.removePrevSegment=function(t,i){var r=t.segments[i-2],o=t.segments[i+1];if(!((o.length||0===o.length?o.length:a.distancePoints(o.points[0],o.points[1]))<=5)){var n=t.segments.slice(i-1,i+1),s={element:t,removeSegments:n,type:"Removal",cancel:!1};if(sf.base.isBlazor()&&(s={element:_a(t),removeSegments:_a(n),type:"Removal",cancel:s.cancel}),this.commandHandler.triggerEvent(e.DiagramEvent.segmentCollectionChange,s),!s.cancel){var h=t.segments[i+1];t.segments.splice(i-1,2);var d=this.selectedSegment;"Left"===d.direction||"Right"===d.direction?(r.points[r.points.length-1].x=h.points[0].x,h.points[0].y=r.points[r.points.length-1].y):(r.points[r.points.length-1].y=h.points[0].y,h.points[0].x=r.points[r.points.length-1].x),(d.length||0===d.length)&&this.findSegmentDirection(r),this.findSegmentDirection(h)}}},i.prototype.findSegmentDirection=function(e){e.direction&&(e.length||0===e.length)&&(e.length=a.distancePoints(e.points[0],e.points[e.points.length-1]),e.direction=a.direction(e.points[0],e.points[e.points.length-1]))},i.prototype.removeNextSegment=function(t,i){var r,o,n=this.selectedSegment,s=t.segments[i-1],h=t.segments[i+2],d=t.segments[i+1];if(d.length||0===d.length?(r=t.segments.slice(i,2),o={element:t,removeSegments:r,type:"Removal",cancel:!1},o={element:_a(t),removeSegments:_a(r),type:"Removal",cancel:!1},sf.base.isBlazor()&&(o={element:_a(t),removeSegments:_a(r),type:"Removal",cancel:!1}),this.commandHandler.triggerEvent(e.DiagramEvent.segmentCollectionChange,o),o.cancel||(t.segments.splice(i,2),"Top"===n.direction||"Bottom"===n.direction?(h.points[0].y=n.points[0].y,s.points[s.points.length-1].x=h.points[0].x):(h.points[0].x=n.points[0].x,s.points[s.points.length-1].y=h.points[0].y))):(r=t.segments.slice(i+1,1),o={element:t,removeSegments:r,type:"Removal",cancel:!1},sf.base.isBlazor()&&(o={element:t,removeSegments:r,type:"Removal",cancel:!1}),this.commandHandler.triggerEvent(e.DiagramEvent.segmentCollectionChange,o),o.cancel||(t.segments.splice(i+1,1),"Top"===n.direction||"Bottom"===n.direction?s.points[s.points.length-1].x=d.points[d.points.length-1].x:s.points[s.points.length-1].y=d.points[d.points.length-1].y,this.findSegmentDirection(s),n.length=n.direction=null)),s&&h&&!o.cancel&&(s.length=a.distancePoints(s.points[0],h.points[0]),s.direction=a.direction(s.points[0],h.points[0]),h.length||0===h.length)){h.length=a.distancePoints(s.points[s.points.length-1],h.points[h.points.length-1]);var l=s.points,c=h.points;h.direction=a.direction(l[l.length-1],c[c.length-1])}},i.prototype.addOrRemoveSegment=function(e,t){for(var i,r,o={segments:e.segments},n=0;n<e.segments.length;n++){Pd(t,(a=e.segments[n]).point,e.hitPadding)&&(r=n,i=!0)}if(i&&void 0!==r){if(e.segments&&e.segments[r]&&"Straight"===e.segments[r].type){var a=e.segments[r],s=e.segments[r+1];s&&(e.segments.splice(r,1),s.points[0]=a.points[0])}}else{this.commandHandler.enableServerDataBinding(!1);var h=this.findIndex(e,t);if(e.segments&&e.segments[h]&&"Straight"===e.segments[h].type){a=e.segments[h];var d=new ar(e,"segments",{type:"Straight",point:t},!0);d.points[0]=a.points[0],d.points[1]=t,a.points[0]=t,e.segments.splice(h,0,d),i=!0}this.commandHandler.enableServerDataBinding(!0)}i&&this.commandHandler.updateEndPoint(e,o)},i.prototype.findIndex=function(e,t){for(var i=[],r=0;r<e.segments.length;r++){var o=e.segments[r],n=b.toBounds([o.points[0],o.points[1]]);n.Inflate(e.hitPadding),n.containsPoint(t)&&i.push(o)}if(1===i.length)return e.segments.indexOf(i[0]);var a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=void 0;for(r=0;r<i.length;r++)d=i[r],l=(t.y-d.points[0].y)/(d.points[1].y-t.y),c=(t.x-d.points[0].x)/(d.points[1].x-t.x),a=Math.abs(l-c),0===r&&(s=a,h=0),a<s&&(s=a,h=r);return e.segments.indexOf(i[h])},i.prototype.dragOrthogonalSegment=function(e,t,i,r){var o={x:0,y:0},n={segments:e.segments};o.x=(t.points[r].x+t.points[r+1].x)/2,o.y=(t.points[r].y+t.points[r+1].y)/2;var a=i.y-o.y,s=i.x-o.x,h=e.segments.indexOf(t),d=!1;return-1!==h&&(0===h&&1===e.segments.length&&2===t.points.length?(h=this.addSegments(e,t,s,a,h),d=!0):h!==e.segments.length-1||null!==t.direction&&null!==t.length?0===h&&(h=this.insertFirstSegment(e,t,s,a,h),d=!0):(h=this.addTerminalSegment(e,t,s,a,r),d=!0),h&&(d&&(this.selectedSegment=t=e.segments[h],this.segmentIndex=0),this.updateAdjacentSegments(e,h,s,a),this.commandHandler.updateEndPoint(e,n))),!0},i.prototype.addSegments=function(t,i,r,o,n){var s,h=[],d=a.distancePoints(i.points[0],i.points[1]),l=a.direction(i.points[0],i.points[1]);h.push(new hr(t,"segments",{type:"Orthogonal",direction:l,length:d/4},!0));var c=i.points[0].y===i.points[1].y?o>0?"Bottom":"Top":r>0?"Right":"Left",p=i.points[0].x===i.points[1].x?o:r;h.push(new hr(t,"segments",{type:"Orthogonal",direction:c,length:p},!0)),h.push(new hr(t,"segments",{type:"Orthogonal",direction:l,length:d/2},!0));var g={element:t,addSegments:h,type:"Addition",cancel:!1};return sf.base.isBlazor()&&(g={addSegments:_a(h),type:"Addition",cancel:g.cancel,element:_a(t)}),this.commandHandler.triggerEvent(e.DiagramEvent.segmentCollectionChange,g),g.cancel||(t.segments=h.concat(t.segments),s=n+2),s},i.prototype.insertFirstSegment=function(t,i,r,o,n){var s,h,d,l,c,p=[];if(t.sourcePortID&&i.length&&t.segments[0].points.length>2)for(var g=void 0,u=0;u<i.points.length-1;u++){var f=a.distancePoints(i.points[u],i.points[u+1]),m=a.direction(i.points[u],i.points[u+1]);0===(c=new hr(t,"segments",{type:"Orthogonal",direction:m,length:f},!0)).length&&(!g||"Top"!==g.direction&&"Bottom"!==g.direction?c.direction=o>0?"Bottom":"Top":c.direction=r>0?"Right":"Left"),g=c,p.push(c)}else d={type:"Orthogonal",direction:i.direction,length:i.length/3},p.push(new hr(t,"segments",d,!0)),"Bottom"===i.direction||"Top"===i.direction?(h=Math.abs(r),s=r>0?"Right":"Left"):(h=Math.abs(o),s=o>0?"Bottom":"Top"),c=new hr(t,"segments",{type:"Orthogonal",direction:s,length:h},!0),p.push(c);var y={element:t,addSegments:p,type:"Addition",cancel:!1};if(sf.base.isBlazor()&&(y={element:_a(t),addSegments:_a(p),type:"Addition",cancel:y.cancel}),this.commandHandler.triggerEvent(e.DiagramEvent.segmentCollectionChange,y),!y.cancel){if(t.sourcePortID&&i.length&&t.segments[0].points.length>2)t.segments.splice(0,1),l=1;else{var v=t.segments[1];v&&v.length&&(v.length=s!==v.direction?v.length+h:v.length-h),l=2,i.length=2*i.length/3}t.segments=p.concat(t.segments)}return l},i.prototype.updateAdjacentSegments=function(e,t,i,r){var o=e.segments[t],n=o.points[o.points.length-1],a=o.points[0],s=!0;if("Orthogonal"===o.type&&(o.points[0]=a,o.points[o.points.length-1]=n,e.segments[t-1]&&(s=this.updatePreviousSegment(i,r,e,t)),e.segments.length-1>t&&s)){var h=e.segments[t+1];this.updateNextSegment(e,o,h,i,r)}},i.prototype.addTerminalSegment=function(t,i,r,o,n){var s,h,d,l,c=t.segments.indexOf(i),p=[],g=t.segments.pop(),u=t.segments[t.segments.length-1];s=u&&"Orthogonal"===u.type?u:null;for(var f=0;f<i.points.length-2;f++)d=a.distancePoints(i.points[f],i.points[f+1]),l=a.direction(i.points[f],i.points[f+1]),h=new hr(t,"segments",{type:"Orthogonal",length:d,direction:l},!0),p.push(h),s=h;var m=n;if((2===i.points.length||m===i.points.length-2)&&(s&&(s.length+=5),void 0!==m)){d=2*a.distancePoints(i.points[i.points.length-2],i.points[i.points.length-1])/3,l=a.direction(i.points[i.points.length-2],i.points[i.points.length-1]);var y=new hr(t,"segments",{type:"Orthogonal",length:d,direction:l});p.push(y)}var v=new hr(t,"segments",{type:"Orthogonal"},!0);p.push(v);var b,w=!1;return b={element:_a(t),addSegments:_a(p),type:"Addition",cancel:w},sf.base.isBlazor()&&(b={element:_a(t),addSegments:_a(p),type:"Addition",cancel:w}),this.commandHandler.triggerEvent(e.DiagramEvent.segmentCollectionChange,b),b.cancel?t.segments.push(g):(t.segments=t.segments.concat(p),c+=n),this.commandHandler.updateEndPoint(t),c},i.prototype.updatePortSegment=function(e,t,i,r,o){if(1===i&&2===e.points.length&&e.length<0){var n=t.sourceWrapper.corners,a=t.segments[i],s=t.segments[i+1],h=void 0,d=[];h=new hr(t,"segments",{type:"Orthogonal",length:13,direction:e.direction}),d.push(h);var l=void 0;l="Left"===a.direction?a.points[0].x-(n.middleLeft.x-20):"Right"===a.direction?n.middleRight.x+20-a.points[0].x:"Bottom"===a.direction?n.bottomCenter.y+20-a.points[0].y:a.points[0].y-(n.topCenter.y-20),h=new hr(t,"segments",{type:"Orthogonal",length:l,direction:a.direction}),d.push(h),a.length=a.length-l,s&&s.length&&s.direction&&(s.direction===e.direction?s.length-=13:s.direction===_t(e.direction)&&(s.length+=13)),t.segments=d.concat(t.segments),this.selectedSegment=t.segments[3]}},i.prototype.updatePreviousSegment=function(e,t,i,r){var o=i.segments[r],n=i.segments[r-1];n.points[n.points.length-1]=o.points[0];var a=!i.sourceID||""!==i.sourcePortID,s=!0;return"Orthogonal"===n.type&&("Bottom"===n.direction?n.length+=t:"Top"===n.direction?n.length-=t:"Right"===n.direction?n.length+=e:n.length-=e,""!==i.sourcePortID&&n.length<0?this.updatePortSegment(n,i,r,e,t):i.sourceID&&""===i.sourcePortID&&n.length<0&&1===r&&(s=!1,this.updateFirstSegment(i,o)),a&&this.changeSegmentDirection(n)),s},i.prototype.changeSegmentDirection=function(e){e.length<0&&(e.direction=_t(e.direction),e.length*=-1)},i.prototype.updateNextSegment=function(e,t,i,r,o){i.points[0]=t.points[t.points.length-1],i&&"Orthogonal"===i.type&&(i.length||0===i.length)&&("Left"===i.direction||"Right"===i.direction?0!==r&&(i.length="Right"===i.direction?i.length-r:i.length+r,(i.length||0===i.length)&&this.changeSegmentDirection(i)):0!==o&&(i.length="Bottom"===i.direction?i.length-o:i.length+o,(i.length||0===i.length)&&this.changeSegmentDirection(i)))},i.prototype.updateFirstSegment=function(e,t){var i,r=e.segments.indexOf(t),o=!1,n=e.segments[r],s=e.segments[r-1],h={segments:e.segments};if(s.length<0&&e.sourceID){var d=e.sourceWrapper.corners,l=[],c=void 0,p=!1;this.changeSegmentDirection(n);var g=e.segments[r+1],u=e.segments[r+2];switch(g&&this.changeSegmentDirection(g),u&&this.changeSegmentDirection(u),s.direction){case"Top":case"Bottom":i=n.length>0&&"Left"===n.direction?d.middleLeft:d.middleRight,n.length>d.width/2?Math.abs(s.length)<d.height/2&&(s.length=a.distancePoints(d.center,s.points[s.points.length-1]),n.points[0].x=i.x,n.length=a.distancePoints(n.points[0],n.points[n.points.length-1]),n.length-=20,o=!0):(g&&g.direction&&g.length&&(g.points[0].y=i.y,g.points[0].x=g.points[g.points.length-1].x="Right"===n.direction?i.x+20:i.x-20),o=!0,p=!0);break;case"Left":case"Right":i=n.length>0&&"Top"===n.direction?d.topCenter:d.bottomCenter,n.length>d.height/2?Math.abs(s.length)<d.width/2&&(s.length=a.distancePoints(d.center,s.points[s.points.length-1]),n.points[0].y=i.y,n.length=a.distancePoints(n.points[0],n.points[n.points.length-1]),n.length-=20,o=!0):(g&&g.direction&&g.length&&(g.points[0].x=i.x,g.points[0].y=g.points[g.points.length-1].y="Bottom"===n.direction?i.y+20:i.y-20),o=!0,p=!0)}this.changeSegmentDirection(s),this.changeSegmentDirection(n),o&&(c={type:"Orthogonal",direction:n.direction,length:20},l.push(new hr(e,"segments",c,!0)),p&&(g&&g.direction&&g.length&&(g.length=a.distancePoints(g.points[0],g.points[g.points.length-1])),u&&u.direction&&u.length&&(u.length=a.distancePoints(g.points[g.points.length-1],u.points[u.points.length-1])),e.segments.splice(r-1,2)),e.segments=l.concat(e.segments)),this.selectedSegment=p?e.segments[r-1]:e.segments[r+1],this.commandHandler.updateEndPoint(e,h)}},i.prototype.updateLastSegment=function(e,t){if(e.targetID&&""===e.targetPortID){var i=void 0,r=void 0,o=void 0,n=void 0,a=e.targetWrapper.corners,s=t.points[0],h=t.points[t.points.length-1];return"Right"===t.direction||"Left"===t.direction?(i={x:s.x,y:s.y},r={x:"Left"===t.direction?h.x-a.width/2:h.x+a.width/2,y:h.y},o={x:a.center.x,y:a.center.y-a.height},n={x:a.center.x,y:a.center.y+a.height}):(i={x:s.x,y:s.y},r={x:h.x,y:"Bottom"===t.direction?h.y+a.height/2:h.y-a.height/2},o={x:a.center.x-a.width,y:a.center.y},n={x:a.center.x+a.width,y:a.center.y}),Rn({x1:i.x,y1:i.y,x2:r.x,y2:r.y},{x1:o.x,y1:o.y,x2:n.x,y2:n.y}).enabled}return!1},i.prototype.destroy=function(){},i.prototype.getModuleName=function(){return"ConnectorEditingTool"},i}(_d),sl=function(){function t(e,t){this.currentAction="None",this.previousAction="None",this.focus=!1,this.isBlocked=!1,this.isMouseDown=!1,this.inAction=!1,this.doingAutoScroll=!1,this.diagram=null,this.objectFinder=null,this.tool=null,this.eventArgs=null,this.keyArgs={},this.diagram=e,this.objectFinder=new hl,this.commandHandler=t}return Object.defineProperty(t.prototype,"action",{get:function(){return this.currentAction},set:function(t){t!==this.currentAction&&("PortDraw"===this.currentAction&&(this.diagram.tool&=~e.DiagramTools.DrawOnce,this.tool&&this.tool.mouseUp({position:this.currentPosition}),this.tool=null),"Rotate"===t||"LabelRotate"===t?this.diagram.diagramCanvas.classList.add("e-diagram-rotate"):"Rotate"!==this.currentAction&&"LabelRotate"!==this.currentAction||this.diagram.diagramCanvas.classList.remove("e-diagram-rotate"),this.currentAction=t,"None"!==this.currentAction&&"Select"!==this.currentAction&&!(this.diagram.diagramActions&e.DiagramAction.TextEdit)||this.commandHandler.isUserHandle(this.currentPosition)?this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.ToolAction:this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.ToolAction,this.diagram.setCursor(this.diagram.getCursor(t,this.inAction)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blocked",{get:function(){return this.isBlocked},set:function(e){this.isBlocked=e,this.blocked?this.diagram.setCursor("not-allowed"):this.diagram.setCursor(this.diagram.getCursor(this.action,this.inAction))},enumerable:!0,configurable:!0}),t.prototype.getMousePosition=function(e){var t,r,o;-1!==e.type.indexOf("touch")?(r=(t=e).changedTouches[0].clientX,o=t.changedTouches[0].clientY):(r=e.clientX,o=e.clientY);var n=new i;n=zr(this.diagram);var a=this.diagram.element.getBoundingClientRect();return r=r+this.diagram.diagramCanvas.scrollLeft-a.left-n.width,o=o+this.diagram.diagramCanvas.scrollTop-a.top-n.height,r/=this.diagram.scroller.transform.scale,o/=this.diagram.scroller.transform.scale,{x:r-=this.diagram.scroller.transform.tx,y:o-=this.diagram.scroller.transform.ty}},t.prototype.windowResize=function(e){var t=this;return this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout((function(){t.updateViewPortSize(t.diagram.element)}),300),!1},t.prototype.updateViewPortSize=function(e){var t=document.getElementById(e.id);if(t){var r=t.getBoundingClientRect();this.diagram.scroller.setViewPortSize(r.width,r.height);var o=new i;o=zr(this.diagram);var n=this.diagram.getSizeValue(this.diagram.width,o.width),a=this.diagram.getSizeValue(this.diagram.height,o.height);this.diagram.diagramCanvas.style.width=n,this.diagram.diagramCanvas.style.height=a,this.diagram.scroller.setSize(),this.diagram.transformLayers(),this.diagram.rulerSettings.showRulers&&Tr(this.diagram)}},t.prototype.canHideResizers=function(){return(this.tool instanceof Ud||this.tool instanceof Gd)&&this.isMouseDown},t.prototype.updateCursor=function(){if(1===this.diagram.selectedItems.nodes.length||1===this.diagram.selectedItems.connectors.length){var e=[];e=e.concat(this.diagram.selectedItems.nodes,this.diagram.selectedItems.connectors),this.blocked=!(this.eventArgs&&this.eventArgs.source&&!Er(this.eventArgs.source))&&(this.isMouseDown&&1===e.length&&this.tool instanceof Vd&&!Er(e[0]))}},t.prototype.isForeignObject=function(e,t){var i=e;if(i)for(;null!==i.parentNode;){if("string"==typeof i.className&&(!t&&-1!==i.className.indexOf("foreign-object")||t&&-1!==i.className.indexOf("e-diagram-text-edit")))return i;i=i.parentNode}return null},t.prototype.isMetaKey=function(e){return navigator.platform.match("Mac")?e.metaKey:e.ctrlKey},t.prototype.renderUmlHighLighter=function(e){this.diagram.commandHandler.removeStackHighlighter();var t=this.diagram.selectedItems.nodes[0];if(t&&t.container&&"Stack"===t.container.type&&"UmlClassifier"===t.shape.type&&!t.wrapper.bounds.containsPoint(this.currentPosition)){var i=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x-20,y:this.currentPosition.y}),r=this.diagram.findObjectUnderMouse(i,this.action,this.inAction);if(r&&r.parentId&&r.parentId===t.id){var o="Vertical"===this.diagram.nameTable[r.parentId].container.orientation;No(r.wrapper,o,e.position,this.diagram,!0)}}},t.prototype.isDeleteKey=function(e,t){return navigator.platform.match("Mac")&&"Backspace"===e&&"delete"===t},t.prototype.isMouseOnScrollBar=function(e){var t,i,r,o,n=e.offsetX,a=e.offsetY,s=this.diagram.diagramCanvas,h=s.offsetHeight,d=s.offsetWidth;return!!(h<s.scrollHeight&&(t={x:d-17,y:0},i={x:d,y:0},r={x:d-17,y:h},o={x:d,y:h},b.toBounds([t,i,r,o]).containsPoint({x:n,y:a})))||!!(d<s.scrollWidth&&(t={x:0,y:h-17},i={x:d,y:h-17},r={x:0,y:h},o={x:d,y:h},b.toBounds([t,i,r,o]).containsPoint({x:n,y:a})))},t.prototype.updateVirtualization=function(){var e=this,t=setInterval((function(i){e.diagram.removeVirtualObjects(t)}),50);setTimeout((function(){e.diagram.deleteVirtualObject=!0}),50)},t.prototype.checkPreviousAction=function(){if(this.action!==this.previousAction&&this.diagram.selectedItems.userHandles.length)for(var t=0;t<this.diagram.selectedItems.userHandles.length;t++)this.previousAction&&this.diagram.selectedItems.userHandles[t]&&(this.checkUserHandleEvent(e.DiagramEvent.onUserHandleMouseLeave),this.previousAction="None")},t.prototype.checkUserHandleEvent=function(t){if(this.diagram.selectedItems&&this.diagram.selectedItems.userHandles.length>0)for(var i=t===e.DiagramEvent.onUserHandleMouseLeave?this.previousAction:this.action,r={element:void 0},o=0;o<this.diagram.selectedItems.userHandles.length;o++)if(i===this.diagram.selectedItems.userHandles[o].name||t===e.DiagramEvent.onUserHandleMouseUp&&"Select"===i){r.element=this.diagram.selectedItems.userHandles[o],t===e.DiagramEvent.onUserHandleMouseEnter&&(this.previousAction=this.action),t===e.DiagramEvent.onUserHandleMouseDown&&(this.userHandleObject=this.diagram.selectedItems.userHandles[o].name);var n=document.getElementById(this.diagram.selectedItems.userHandles[o].name+"_userhandle");t===e.DiagramEvent.onUserHandleMouseUp?this.commandHandler.isUserHandle(this.currentPosition)&&n&&n.id===this.userHandleObject+"_userhandle"&&this.diagram.triggerEvent(t,r):this.diagram.triggerEvent(t,r)}},t.prototype.mouseDown=function(t){this.focus=!0;var i=t.touches;if(this.isMouseOnScrollBar(t))return this.isScrolling=!0,void t.preventDefault();if(this.checkUserHandleEvent(e.DiagramEvent.onUserHandleMouseDown),!this.checkEditBoxAsTarget(t)&&Qr(this.diagram)||Fr(this.diagram)&&!Kr(this.diagram))if("Select"!==this.action&&"Drag"!==this.action||this.diagram.updatePortVisibility(this.hoverElement,e.PortVisibility.Hover,!0),!(this.tool instanceof el||this.tool instanceof tl)||2!==t.button&&2!==t.buttons)if(!0===this.inAction&&!0===this.isMouseDown&&(this.tool instanceof el||this.tool instanceof tl))this.isMouseDown=!0,this.eventArgs={},this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.eventArgs.position=this.currentPosition,this.tool.mouseDown(this.eventArgs);else{this.isMouseDown=!0,this.currentPosition=this.prevPosition=this.getMousePosition(t),this.eventArgs={},this.diagram.textEditing&&!this.isMouseOnScrollBar(t)&&(this.diagram.endEdit(),this.diagram.textEditing=!1);var r=void 0,o=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action),n=this.objectFinder.findObjectUnderMouse(this.diagram,o,this.action,this.inAction,this.eventArgs,this.currentPosition),a=null;null!==n&&(a=this.diagram.findElementUnderMouse(n,this.currentPosition))&&(r=this.commandHandler.findTarget(a,n)),this.action=this.diagram.findActionToBeDone(n,a,this.currentPosition,r);var s=this.isMetaKey(t);if(s&&t.shiftKey&&this.diagram.connectorEditingToolModule?this.action="SegmentEnd":!s&&!t.shiftKey||Fr(this.diagram)||(this.action="Select"),this.tool=this.diagram.getTool(this.action),this.tool||(this.action="Select",this.tool=this.diagram.getTool(this.action)),this.getMouseEventArgs(this.currentPosition,this.eventArgs),s||t.shiftKey){var h=s&&t.shiftKey?{ctrlKey:s,shiftKey:t.shiftKey}:{ctrlKey:!0};this.eventArgs.info=h}this.eventArgs.position=this.currentPosition,this.tool.mouseDown(this.eventArgs),this.initialEventArgs={source:this.eventArgs.source,sourceWrapper:this.eventArgs.sourceWrapper},this.initialEventArgs.position=this.currentPosition,this.initialEventArgs.info=this.eventArgs.info,this.inAction=!1,"touchstart"===t.type&&(i&&i.length>=2&&(this.touchStartList=ph(this.touchStartList,0,i)),i||t.preventDefault())}else{_a(this.diagram),_a(this.currentPosition),t.buttons,_a(this.eventArgs.actualObject),0===t.button||t.button;this.inAction=!1,this.tool.mouseUp(this.eventArgs)}this.isForeignObject(t.target)||this.isForeignObject(t.target,!0)||i||t.preventDefault()},t.prototype.mouseMoveExtend=function(t,i){(this.tool instanceof el||this.tool instanceof tl)&&this.tool.mouseMove(this.eventArgs),this.diagram.scrollSettings.canAutoScroll?this.checkAutoScroll(t):this.blocked||this.tool.mouseMove(this.eventArgs),this.eventArgs.target&&(this.hoverElement=this.eventArgs.target);var r=!(this.eventArgs.target instanceof js&&i instanceof js);this.tool instanceof Yd&&this.diagram.updatePortVisibility(this.hoverElement instanceof js?this.hoverElement:this.hoverNode,e.PortVisibility.Connect|e.PortVisibility.Hover,r),this.hoverElement instanceof js&&this.hoverNode instanceof js&&this.hoverNode&&this.hoverNode.id!==this.hoverElement.id&&this.diagram.updatePortVisibility(this.hoverNode,e.PortVisibility.Connect|e.PortVisibility.Hover,!0),this.hoverElement=r?null:i,this.hoverNode=r?null:i},t.prototype.checkAction=function(e){if("LabelSelect"===this.action&&this.eventArgs.sourceWrapper&&(this.eventArgs.sourceWrapper instanceof Se||this.eventArgs.sourceWrapper instanceof Yi)){var t=this.commandHandler.findTarget(this.eventArgs.sourceWrapper,this.eventArgs.source);!zd(this.diagram,t,!1,this.eventArgs.sourceWrapper)&&Er(t)&&(this.action="LabelDrag",this.tool=this.getTool(this.action),this.tool.mouseDown(this.initialEventArgs))}else Er(e)&&Dr(e)&&this.initialEventArgs&&this.initialEventArgs.source&&"Select"===this.action&&(!zd(this.diagram,this.eventArgs.source,!1)&&this.eventArgs.source instanceof Ys&&this.getMouseEventArgs(this.currentPosition,this.eventArgs),e instanceof wr&&(!(e instanceof wr)||Pd(this.currentPosition,e.sourcePoint,e.hitPadding)||Pd(this.currentPosition,e.targetPoint,e.hitPadding))||(this.action="Drag"),this.tool=this.getTool(this.action),this.tool.mouseDown(this.initialEventArgs))},t.prototype.isSwimlaneElements=function(e){return!e||!(e.isLane||e.isPhase||e.isHeader)},t.prototype.mouseMove=function(t,i){var r,o;if(this.focus=!0,this.isScrolling)t.preventDefault();else if(Qr(this.diagram)||Fr(this.diagram)&&!Kr(this.diagram)){this.currentPosition=this.getMousePosition(t);var n=this.diagram.findObjectsUnderMouse(this.currentPosition),s=this.diagram.findObjectUnderMouse(n,this.action,this.inAction);r=this.diagram,o=this.currentPosition,r.rulerSettings.showRulers&&(r.hRuler.drawRulerMarker(r.hRuler.element,o,r.scroller.horizontalOffset),r.vRuler.drawRulerMarker(r.vRuler.element,o,r.scroller.verticalOffset));var h=!1,d=void 0;if("touchmove"===t.type&&(i=t.touches)&&i.length>1&&(this.touchMoveList=ph(this.touchMoveList,0,i),"PinchZoom"!==this.action&&(h=!0)),!1===a.equals(this.currentPosition,this.prevPosition)||this.inAction){if(!1===this.isMouseDown||h){this.eventArgs={};var l=null;if(null!==s){if(l=this.diagram.findElementUnderMouse(s,this.currentPosition),s!==this.hoverElement){var c=this.getContent();this.hoverElement&&"Auto"===this.hoverElement.tooltip.openOn&&""!==c&&this.elementLeave(),this.diagram.updatePortVisibility(this.hoverElement,e.PortVisibility.Hover,!0),s instanceof js&&(this.hoverNode=s);var p=!0;!this.isSwimlaneElements(s)&&this.hoverElement&&this.isSwimlaneElements(this.hoverElement)&&(p=!1),this.hoverElement=p?s:this.hoverElement,p?this.elementEnter(this.currentPosition,!1):this.hoverElement=s}else this.hoverElement||this.hoverElement!==s||this.elementEnter(this.currentPosition,!0);l&&(d=this.commandHandler.findTarget(l,s))}this.action=this.diagram.findActionToBeDone(s,l,this.currentPosition,d),this.checkUserHandleEvent(e.DiagramEvent.onUserHandleMouseEnter),this.checkPreviousAction(),this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.tool=this.getTool(this.action),this.mouseEvents(),this.tool instanceof qd||this.tool instanceof tl||this.tool instanceof el?this.tool.mouseMove(this.eventArgs):i&&this.tool instanceof Qd&&this.tool.mouseDown(this.eventArgs),this.updateCursor(),this.renderUmlHighLighter(this.eventArgs);var g=!1;(!this.hoverElement||this.tool instanceof Qd||!(s instanceof js)||!this.isSwimlaneElements(s)||0!==this.diagram.selectedItems.nodes.length&&zd(this.diagram,this.hoverElement))&&(g=!0),this.diagram.updatePortVisibility(this.hoverElement,e.PortVisibility.Hover,g);var u=this.getContent();null===s&&this.hoverElement&&"Auto"===this.hoverElement.tooltip.openOn&&u&&(this.hoverElement=null,this.elementLeave()),h=!1}else{if(this.eventArgs.position=this.currentPosition,"Drag"===this.action&&!zd(this.diagram,this.eventArgs.source,!1)&&this.eventArgs.source instanceof Ys&&this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.mouseEvents(),t.ctrlKey||t.shiftKey){var f=t.ctrlKey&&t.shiftKey?{ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}:{ctrlKey:!0};this.eventArgs.info=f}this.checkAction(s);var m=this.getConnectorPadding(this.eventArgs);this.getMouseEventArgs(this.currentPosition,this.eventArgs,this.eventArgs.source,m),this.updateCursor(),this.inAction=!0,this.initialEventArgs=null,"Drag"!==this.action&&"Rotate"!==this.action||(this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.Interactions),this.mouseMoveExtend(t,s)}this.prevPosition=this.currentPosition,this.isForeignObject(t.target,!0)||t.preventDefault()}}},t.prototype.getContent=function(){return this.hoverElement instanceof js&&this.hoverElement.constraints&e.NodeConstraints.Tooltip||this.hoverElement instanceof wr&&this.hoverElement.constraints&e.ConnectorConstraints.Tooltip?this.hoverElement.tooltip.content:this.diagram.tooltip.content},t.prototype.checkAutoScroll=function(e){var t=this.startAutoScroll(e);if(!t&&this.doingAutoScroll)this.doingAutoScroll=!1,clearInterval(this.timeOutValue);else if(t){if((this.tool instanceof Zd||this.tool instanceof qd||this.tool instanceof Ud||this.tool instanceof Fd||this.tool instanceof Vd)&&this.inAction){var i=this;this.diagram.scrollSettings.canAutoScroll&&t&&!this.doingAutoScroll&&(this.doingAutoScroll=!0,this.timeOutValue=setInterval((function(r){i.doAutoScroll(t,e,100)}),100))}}else this.blocked=!this.tool.mouseMove(this.eventArgs)},t.prototype.mouseUp=function(t){this.checkUserHandleEvent(e.DiagramEvent.onUserHandleMouseUp),"SVG"===this.diagram.mode&&Yr(this.diagram)&&this.updateVirtualization(),this.diagram.previousSelectedObject=null,this.diagram.diagramRenderer.rendererActions=this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions,e.RendererAction.DrawSelectorBorder);var i=t.touches;if(this.isScrolling)return this.isScrolling=!1,void t.preventDefault();if(!this.checkEditBoxAsTarget(t)&&Qr(this.diagram)||Fr(this.diagram)&&!Kr(this.diagram)){if(this.tool&&(!(this.tool instanceof el||this.tool instanceof tl)||(this.tool instanceof el||this.tool instanceof tl)&&2===t.detail)){if(!this.isForeignObject(t.target)&&this.isMouseDown&&document.getElementById(this.diagram.element.id+"content").focus(),!this.inAction&&3!==t.which&&"Drag"===this.action){this.action="Select";var r=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(r,this.action,this.inAction),n=!0;!t.ctrlKey&&this.isMouseDown&&this.diagram.selectedItems.nodes.length+this.diagram.selectedItems.connectors.length>1&&1===t.which&&!(this.diagram.diagramActions&e.DiagramAction.PreventClearSelection)&&(n=!1,this.commandHandler.clearSelection()),zd(this.diagram,o)&&n||this.commandHandler.selectObjects([o])}var a=!1,s=this.updateContainerProperties(),h=void 0;if(this.addUmlNode(),this.inAction=!1,this.isMouseDown=!1,this.currentPosition=this.getMousePosition(t),this.diagram.selectedObject.helperObject&&(h=this.updateContainerBounds()),this.tool&&(this.tool.prevPosition||this.tool instanceof $d)){this.eventArgs.position=this.currentPosition;var d=this.getConnectorPadding(this.eventArgs);this.getMouseEventArgs(this.currentPosition,this.eventArgs,this.eventArgs.source,d);var l=this.isMetaKey(t);if(l||t.shiftKey){var c=l&&t.shiftKey?{ctrlKey:l,shiftKey:t.shiftKey}:{ctrlKey:!0};this.eventArgs.info=c}if(this.diagram.diagramActions&e.DiagramAction.Interactions&&(this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.Interactions),this.eventArgs.clickCount=t.detail,this.diagram.selectedObject.helperObject&&(this.tool instanceof Ud||this.tool instanceof Fd)){if(this.diagram.selectedObject.actualObject&&""!==this.diagram.selectedObject.actualObject.parentId){var p=this.diagram.getObject(this.diagram.selectedObject.actualObject.parentId);p&&p.isLane&&(this.commandHandler.isContainer=!0)}(a=this.diagram.lineRoutingModule&&this.diagram.nameTable.helper&&this.eventArgs.target&&this.eventArgs.target.isLane&&(this.eventArgs.source instanceof Ys&&this.eventArgs.source.nodes.length>0&&""===this.eventArgs.source.nodes[0].parentId||""===this.eventArgs.source.parentId))&&(this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.PreventLaneContainerUpdate),this.tool.mouseUp(this.eventArgs,s.isPreventHistory)}else this.tool.mouseUp(this.eventArgs),!this.diagram.checkMenu||-1===window.navigator.userAgent.indexOf("Linux")&&-1===window.navigator.userAgent.indexOf("X11")||(this.diagram.contextMenuModule.contextMenu.open(t.pageY,t.pageX,this.diagram.element),this.diagram.checkMenu=!1);s.hasStack&&this.diagram.endGroupAction()}if(h&&this.diagram.endGroupAction(),this.updateContainerBounds(!0),2!==this.eventArgs.clickCount&&(this.commandHandler.updateSelectedNodeProperties(this.eventArgs.source),a)){this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.PreventLaneContainerUpdate;var g=this.eventArgs.source instanceof Ys?this.eventArgs.source.nodes:[this.eventArgs.source];if(g)for(var u=0;u<g.length;u++)g[u].container||(this.commandHandler.dropChildToContainer(this.eventArgs.target,g[u]),this.commandHandler.renderContainerHelper(g[u]))}if(this.diagram.selectedObject&&this.diagram.selectedObject.helperObject&&(this.diagram.remove(this.diagram.selectedObject.helperObject),this.diagram.selectedObject={helperObject:void 0,actualObject:void 0},this.diagram.diagramActions&e.DiagramAction.PublicMethod&&this.diagram.constraints&e.DiagramConstraints.LineRouting&&(this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.PublicMethod)),this.blocked=!1,this.hoverElement){var f=e.PortVisibility.Connect;zd(this.diagram,this.hoverElement)&&(f|=e.PortVisibility.Hover),this.diagram.updatePortVisibility(this.hoverElement,f,!0),this.hoverElement=null}this.touchStartList=null,this.touchMoveList=null,this.tool instanceof Kd||(this.tool=null)}i||t.preventDefault(),this.diagram.currentDrawingObject=void 0;var m=this.diagram.selectedItems,y=!1;if(this.commandHandler.isUserHandle(this.currentPosition)&&this.isForeignObject(t.target)&&(y=!0),!this.inAction&&m.wrapper&&m.userHandles.length>0&&!y&&this.diagram.renderSelector(!0),!this.inAction&&!this.diagram.currentSymbol&&this.eventArgs){var v={element:_a(this.eventArgs.source)||_a(this.diagram),position:_a(this.eventArgs.position),count:t.detail,actualObject:_a(this.eventArgs.actualObject),button:0===t.button?"Left":1===t.button?"Middle":"Right"};sf.base.isBlazor()&&this.diagram.click&&(v=this.getBlazorClickEventArgs(v)),this.diagram.tool!==e.DiagramTools.ZoomPan&&this.diagram.triggerEvent(e.DiagramEvent.click,v)}this.eventArgs={}}this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.PreventLaneContainerUpdate,this.eventArgs={},this.diagram.commandHandler.removeStackHighlighter()},t.prototype.getConnectorPadding=function(t){var i,r=t.source;if(r&&r instanceof Ys&&r.connectors.length){var o=r.connectors[0];i=o.constraints&e.ConnectorConstraints.ConnectToNearByPort?o.connectionPadding:0}return i||0},t.prototype.getBlazorClickEventArgs=function(e){return e={element:this.eventArgs.source?{selector:_a(this.eventArgs.source)}:{diagram:_a(this.diagram)},position:_a(this.eventArgs.position),count:e.count,actualObject:this.eventArgs.actualObject?{selector:_a(this.eventArgs.actualObject)}:{diagram:_a(this.diagram)},button:e.button},this.eventArgs.source instanceof js?(e.element.selector.nodes=[],e.element.selector.nodes.push(_a(this.eventArgs.source))):this.eventArgs.source instanceof wr&&(e.element.selector.connectors=[],e.element.selector.connectors.push(_a(this.eventArgs.source))),e},t.prototype.addSwimLaneObject=function(e){var t,i,r,o,n,a,s=0,h=e.shape,d=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action);if(i||(i=this.diagram.findObjectUnderMouse(d,this.action,this.inAction)),this.diagram.clearSelectorLayer(),i&&!(i.isLane||i.isPhase||i.isHeader))for(var l=0;l<d.length;l++){var c=this.diagram.nameTable[d[l].id];(c.isLane||c.isPhase||c.isHeader)&&(i=c)}if(i&&(h.isPhase||h.isLane&&i.isLane)){var p=i.parentId;t=this.diagram.nameTable[p]}if(t&&(r=t.shape,n=h.isLane?h.orientation===r.orientation:h.orientation!==r.orientation),n&&i){if(r.header&&r.hasHeader&&"Horizontal"===r.orientation&&(s=1),r.phases.length>0&&(s+=1),h.isPhase){a="Horizontal"===r.orientation?this.currentPosition.x-t.wrapper.bounds.x:this.currentPosition.y-(t.wrapper.bounds.y+r.header.height);var g={id:xh(),offset:a,header:{annotation:{content:"Phase"}}};this.diagram.addPhases(t,[g])}else{var u={id:xh(),style:h.lanes[0].style,header:{annotation:{content:h.lanes[0].header.annotation.content,style:h.lanes[0].header.annotation.style},style:h.lanes[0].header.style}};"Horizontal"===h.orientation?u.height=h.lanes[0].height:u.width=h.lanes[0].width,"Horizontal"===r.orientation?(o=i.rowIndex?i.rowIndex:this.diagram.nameTable[i.parentId].rowIndex,i.wrapper.offsetY<this.currentPosition.y&&(o+=1)):(o=i.columnIndex?i.columnIndex:this.diagram.nameTable[i.parentId].columnIndex,this.currentPosition.x<i.wrapper.bounds.center.x&&(o-=1)),r.lanes.length>o-s?(u.header.width=r.lanes[o-s].header.width,u.header.height=r.lanes[o-s].header.height):(u.header.width=r.lanes[o-s-1].header.width,u.header.height=r.lanes[o-s-1].header.height),this.diagram.addLanes(t,[u],o-s)}this.commandHandler.select(t)}else if(h.isLane){var f={id:xh(),width:e.width,height:e.height,addInfo:e.addInfo,shape:{type:"SwimLane",header:{annotation:{content:"Header"},height:50,style:h.lanes[0].header.style},phases:[{id:xh(),header:{annotation:{content:"Phase"}}}],lanes:[{id:xh(),height:e.height,width:e.width,style:h.lanes[0].style,header:{annotation:{content:h.lanes[0].header.annotation.content,style:h.lanes[0].header.annotation.style},style:h.lanes[0].header.style}}],orientation:h.orientation}};"Vertical"===h.orientation&&(f.width+=20),f.offsetX=this.currentPosition.x+f.width/2,f.offsetY=this.currentPosition.y+f.height/2,this.diagram.add(f)}},t.prototype.mouseLeave=function(t){(this.tool&&this.inAction&&this.tool.mouseLeave(this.eventArgs),this.diagram.selectedObject.helperObject)&&(this.updateContainerProperties(),this.updateContainerBounds()&&this.diagram.endGroupAction());this.eventArgs&&this.eventArgs.source&&(this.diagram.updatePortVisibility(this.eventArgs.source,e.PortVisibility.Hover,!0),this.hoverElement=null),this.eventArgs&&!this.eventArgs.source&&this.hoverElement&&(this.hoverElement=null),this.tool instanceof Yd&&this.eventArgs&&this.eventArgs.target&&this.eventArgs.target instanceof js&&(this.diagram.updatePortVisibility(this.eventArgs.target,e.PortVisibility.Hover|e.PortVisibility.Connect,!0),this.hoverElement=null);var i=this.diagram.selectedItems;i&&i.wrapper&&this.diagram.renderSelector(!0),(this.diagram.diagramActions&e.DiagramAction.Interactions||this.diagram.diagramActions&e.DiagramAction.ToolAction)&&(this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.ToolAction),this.isMouseDown=!1,this.focus=!1,this.touchStartList=null,this.touchMoveList=null,this.elementLeave(),this.commandHandler.removeSnap(),this.inAction=!1,this.eventArgs={},this.diagram.selectedObject&&this.diagram.selectedObject.helperObject&&(this.diagram.remove(this.diagram.selectedObject.helperObject),this.diagram.selectedObject={helperObject:void 0,actualObject:void 0}),this.tool=null,function(){var e,t,i=document.getElementsByClassName("e-d-ruler-marker");if(i&&i.length>0)for(t=i.length-1;t>=0;t--)(e=i[t])&&e.parentNode.removeChild(e)}(),"Rotate"===this.action&&this.diagram.diagramCanvas.classList.remove("e-diagram-rotate"),t.preventDefault()},t.prototype.mouseWheel=function(t){this.diagram.blazorActions|=e.BlazorAction.interaction;var i=t.wheelDelta>0||-40*t.detail>0,r=this.getMousePosition(t);if(this.diagram.tooltipObject.close(),this.isMetaKey(t))this.diagram.zoom(i?1.2:1/1.2,r),t.preventDefault();else{var o=this.diagram.scroller.horizontalOffset,n=this.diagram.scroller.verticalOffset,a=i?20:-20;this.tool&&(this.tool instanceof el||this.tool instanceof tl)&&(this.eventArgs={},this.getMouseEventArgs(r,this.eventArgs),this.eventArgs.position=r,this.tool.mouseWheel(this.eventArgs)),this.diagram.scrollActions|=e.ScrollActions.Interaction,t.shiftKey?this.diagram.scroller.zoom(1,a,0,r):this.diagram.scroller.zoom(1,0,a,r),this.diagram.scrollActions&=~e.ScrollActions.Interaction,o===this.diagram.scroller.horizontalOffset&&n===this.diagram.scroller.verticalOffset||t.preventDefault()}if(this.diagram.textEditing){if(this.diagram.isTriggerEvent=!0,this.diagram.activeLabel.parentId){var s=this.diagram.getObject(this.diagram.activeLabel.parentId);this.diagram.startTextEdit(s,this.diagram.activeLabel.id)}this.diagram.isTriggerEvent=!1}this.diagram.blazorActions=this.diagram.blazorActions&~e.BlazorAction.interaction},t.prototype.keyDown=function(t){if(!(this.diagram.diagramActions&e.DiagramAction.TextEdit)&&!this.checkEditBoxAsTarget(t)||"Escape"===t.key||27===t.keyCode){var i=void 0,r=t.keyCode?t.keyCode:t.which,o=t.key,n=this.isMetaKey(t);if(this.diagram.commandManager&&this.diagram.commands)for(var a=this.diagram.commands,s=0,h=Object.keys(a);s<h.length;s++){var d=h[s];if((i=this.diagram.commands[d])&&(i.gesture.keyModifiers||i.gesture.key)&&(r===i.gesture.key||o===e.Keys[i.gesture.key]||this.isDeleteKey(o,d))&&(!i.gesture.keyModifiers&&!t.altKey&&!t.shiftKey&&!n||i.gesture.keyModifiers&&(n||t.altKey||t.shiftKey)&&this.altKeyPressed(i.gesture.keyModifiers)&&t.altKey||this.shiftKeyPressed(i.gesture.keyModifiers)&&t.shiftKey||this.ctrlKeyPressed(i.gesture.keyModifiers)&&n)){var l=Wh(i.canExecute);if(sf.base.isBlazor()||l&&l({keyDownEventArgs:KeyboardEvent,parameter:i.parameter})){if(t.preventDefault(),"Escape"===t.key)if(this.checkEditBoxAsTarget(t))document.getElementById(this.diagram.diagramCanvas.id).focus();else if(this.diagram.currentSymbol){this.diagram.removeFromAQuad(this.diagram.currentSymbol),this.diagram.removeObjectsFromLayer(this.diagram.nameTable[this.diagram.currentSymbol.id]),this.diagram.removeElements(this.diagram.currentSymbol),qn(this.diagram.currentSymbol,this.diagram),delete this.diagram.nameTable[this.diagram.currentSymbol.id],this.diagram.droppable.sourceElement.draggable.intDestroy();var c=this.diagram.droppable.selectedSymbols;c.parentNode.removeChild(c);var p=this.diagram.diagramActions;this.diagram.diagramActions=this.diagram.addConstraints(p,e.DiagramAction.PreventClearSelection),this.tool.mouseUp(this.eventArgs),this.diagram.diagramRenderer.rendererActions=this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions,e.RendererAction.DrawSelectorBorder),this.diagram.previousSelectedObject&&this.diagram.select(this.diagram.previousSelectedObject),this.action="Select",this.diagram.previousSelectedObject=null,this.diagram.currentSymbol=null,this.diagram.diagramActions=this.diagram.removeConstraints(p,e.DiagramAction.PreventClearSelection),this.isMouseDown=!1}else this.inAction&&this.diagram.drawingObject&&this.tool&&this.tool.inAction&&(this.tool.mouseUp(this.eventArgs),this.tool=null,this.isMouseDown=!1);if(i.execute)if(this.diagram.tool!==e.DiagramTools.ZoomPan)Wh(i.execute)({keyDownEventArgs:KeyboardEvent,parameter:i.parameter});if(sf.base.isBlazor()){var g={gesture:i.gesture};this.diagram.triggerEvent(e.DiagramEvent.commandExecute,g)}break}}}}this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes:this.diagram.selectedItems.connectors;this.keyArgs={element:_a(this.diagram.selectedItems),key:t.key,keyCode:t.keyCode?t.keyCode:t.which},this.getKeyModifier(this.keyArgs,t),this.diagram.diagramActions&e.DiagramAction.TextEdit&&this.getlabel(this.keyArgs,t),this.diagram.triggerEvent(e.DiagramEvent.keyDown,this.keyArgs)},t.prototype.getlabel=function(e,t){var i=this.diagram.activeLabel;e.target=this.diagram.element.id+"_editBox";var r=this.diagram.nameTable[i.parentId];if(document.getElementById(this.diagram.element.id+"_editBox")){e.text=document.getElementById(this.diagram.element.id+"_editBox").value;for(var o=0;o<r.annotations.length;o++)if(r.annotations[o].id===i.id){e.label=r.annotations[o];break}}},t.prototype.getKeyModifier=function(t,i){t.keyModifiers=e.KeyModifiers.None,i.ctrlKey&&(t.keyModifiers|=e.KeyModifiers.Control),i.shiftKey&&(t.keyModifiers|=e.KeyModifiers.Shift),i.altKey&&(t.keyModifiers|=e.KeyModifiers.Alt),this.isMetaKey(i)&&(t.keyModifiers|=e.KeyModifiers.Meta)},t.prototype.keyUp=function(t){this.keyArgs={element:_a(this.diagram.selectedItems),key:t.key,keyCode:t.keyCode?t.keyCode:t.which};this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes:this.diagram.selectedItems.connectors;this.getKeyModifier(this.keyArgs,t),this.diagram.diagramActions&e.DiagramAction.TextEdit&&this.getlabel(this.keyArgs,t),this.diagram.triggerEvent(e.DiagramEvent.keyUp,this.keyArgs)},t.prototype.startAutoScroll=function(e){var t=this.getMousePosition(e);t.x*=this.diagram.scroller.currentZoom,t.y*=this.diagram.scroller.currentZoom;var i,r=zr(this.diagram),o=this.diagram.scrollSettings.autoScrollBorder;if("mozilla"===sf.base.Browser.info.name&&0===this.diagram.scroller.viewPortWidth){var n=document.getElementById(this.diagram.element.id).getBoundingClientRect();n.width!==this.diagram.scroller.viewPortWidth&&this.diagram.scroller.setViewPortSize(n.width,n.height)}return this.diagram.scrollSettings.canAutoScroll&&(t.x+this.diagram.scroller.horizontalOffset+o.right+r.width>=this.diagram.scroller.viewPortWidth-18?i="right":t.x+this.diagram.scroller.horizontalOffset<o.left?i="left":t.y+this.diagram.scroller.verticalOffset+o.bottom+r.height>this.diagram.scroller.viewPortHeight-18?i="bottom":t.y+this.diagram.scroller.verticalOffset<o.top&&(i="top")),i},t.prototype.doAutoScroll=function(t,i,r,o){var n=t;if((this.tool instanceof Zd||this.tool instanceof qd||this.tool instanceof Ud||this.tool instanceof Fd||this.tool instanceof Vd)&&this.inAction){var a=this.getMousePosition(i),s=(this.diagram.scrollSettings.autoScrollBorder,0),h=0,d={x:a.x,y:a.y};switch(n){case"right":d.x=a.x+10,s=10;break;case"left":d.x=a.x-10,s=-10;break;case"bottom":d.y=a.y+10,h=10;break;case"top":d.y=a.y-10,h=-10}this.eventArgs.position={x:d.x,y:d.y},this.currentPosition=this.eventArgs.position;var l=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action);this.eventArgs.target=this.diagram.findObjectUnderMouse(l,this.action,this.inAction),this.tool.mouseMove(this.eventArgs),this.diagram.scrollActions|=e.ScrollActions.Interaction,this.diagram.scroller.zoom(1,-s,-h,a),this.diagram.scrollActions&=~e.ScrollActions.Interaction}},t.prototype.mouseEvents=function(){for(var t=this.diagram.findObjectsUnderMouse(this.currentPosition),i=0;i<t.length;i++)this.eventArgs.actualObject===t[i]&&t.splice(i,1);var r={targets:{}};if(sf.base.isBlazor()||(r={targets:_a(t),element:_a(this.eventArgs.source===this.eventArgs.actualObject?void 0:this.eventArgs.source),actualObject:_a(this.eventArgs.actualObject)}),sf.base.isBlazor()&&(this.diagram.mouseEnter||this.diagram.mouseOver)&&(r.actualObject=Ea(this.eventArgs.actualObject)===wr?{connector:_a(this.eventArgs.actualObject)}:{node:_a(this.eventArgs.actualObject)},r.targets.connector=[],r.targets.node=[],this.getBlazorCollectionObject(t,r)),this.lastObjectUnderMouse&&this.diagram.mouseLeave&&(!this.eventArgs.actualObject||this.lastObjectUnderMouse!==this.eventArgs.actualObject)){var o={targets:void 0,element:_a(this.lastObjectUnderMouse),actualObject:void 0};sf.base.isBlazor()&&(o={targets:void 0,element:Ea(this.lastObjectUnderMouse)===wr?{connector:_a(t)}:{node:_a(this.lastObjectUnderMouse)},actualObject:void 0}),this.diagram.triggerEvent(e.DiagramEvent.mouseLeave,o),this.lastObjectUnderMouse=null}(!this.lastObjectUnderMouse&&this.eventArgs.source||this.lastObjectUnderMouse!==this.eventArgs.actualObject)&&(this.lastObjectUnderMouse=this.eventArgs.actualObject,void 0!==this.eventArgs.actualObject&&this.diagram.triggerEvent(e.DiagramEvent.mouseEnter,r)),this.eventArgs.actualObject&&this.diagram.triggerEvent(e.DiagramEvent.mouseOver,r)},t.prototype.getBlazorCollectionObject=function(e,t){if(e)for(var i=0;i<e.length;i++)Ea(e[i])===wr?t.targets.connector.push(_a(e[i])):t.targets.node.push(_a(e[i]))},t.prototype.elementEnter=function(t,i){if(!i){var r=this.hoverElement instanceof js&&this.hoverElement.constraints&e.NodeConstraints.Tooltip||this.hoverElement instanceof wr&&this.hoverElement.constraints&e.ConnectorConstraints.Tooltip,o=this.getContent();"Auto"===this.hoverElement.tooltip.openOn&&""!==o&&Ii(this.diagram,r?this.hoverElement:void 0);var n=Wn(this.diagram,t,this.hoverElement);"Auto"===this.hoverElement.tooltip.openOn&&""!==o&&(this.diagram.tooltipObject.close(),this.diagram.tooltipObject.openOn=this.hoverElement.tooltip.openOn,this.diagram.tooltipObject.offsetX=n.x,this.diagram.tooltipObject.offsetY=n.y,sf.base.isBlazor()?this.diagram.tooltipObject.open(this.diagram.element,{}):this.diagram.tooltipObject.dataBind()),a=this.hoverElement,s=this.diagram,h=0,a instanceof wr?a.constraints&e.ConnectorConstraints.Tooltip?h=a.constraints&e.ConnectorConstraints.Tooltip:a.constraints&e.ConnectorConstraints.InheritTooltip&&(h=s.constraints&e.DiagramConstraints.Tooltip):a.constraints&e.NodeConstraints.Tooltip?h=a.constraints&e.NodeConstraints.Tooltip:a.constraints&e.NodeConstraints.InheritTooltip&&(h=s.constraints&e.DiagramConstraints.Tooltip),h&&"Auto"===this.hoverElement.tooltip.openOn&&this.diagram.tooltipObject.open(this.diagram.element)}var a,s,h},t.prototype.elementLeave=function(){this.diagram.tooltipObject&&"Custom"!==this.diagram.tooltipObject.openOn&&this.diagram.tooltipObject.close()},t.prototype.altKeyPressed=function(t){return!!(t&e.KeyModifiers.Alt)},t.prototype.ctrlKeyPressed=function(t){return!!(t&e.KeyModifiers.Control)},t.prototype.shiftKeyPressed=function(t){return!!(t&e.KeyModifiers.Shift)},t.prototype.scrolled=function(t){this.diagram.updateScrollOffset(),sf.base.isBlazor()&&this.diagram.realActions&e.RealAction.OverViewAction&&this.diagram.setBlazorDiagramProps(!1)},t.prototype.doubleClick=function(t){if(Qr(this.diagram)){var i=void 0,r=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(r,this.action,this.inAction);if(null!==o&&Qr(this.diagram))if(i=this.diagram.findElementUnderMouse(o,this.currentPosition),this.tool&&(this.tool instanceof el||this.tool instanceof tl)){_a(o)||_a(this.diagram),this.currentPosition,t.detail;this.tool.mouseUp(this.eventArgs),this.isMouseDown=!1,this.eventArgs={},this.tool=null,t.preventDefault()}else{var n=this.diagram.commandHandler.getObjectLayer(o.id);if(n&&!n.lock&&n.visible&&!(this.diagram.diagramActions&e.DiagramAction.TextEdit)){var a="";"TextAnnotation"===o.shape.shape&&(a=o.wrapper.children[1].id.split("_")[1]),this.diagram.startTextEdit(o,a||(i instanceof Se?i.id.split(o.id+"_")[1]:void 0))}}var s={source:_a(o)||_a(this.diagram),position:this.currentPosition,count:t.detail};if(sf.base.isBlazor()){var h=void 0;h=o instanceof js?{nodes:[_a(o)]}:o instanceof wr?{connectors:[_a(o)]}:_a(o),s={source:o?{selector:h}:{diagram:_a(this.diagram)},position:this.currentPosition,count:t.detail}}this.diagram.triggerEvent(e.DiagramEvent.doubleClick,s)}},t.prototype.itemClick=function(e,t){var i=e;return Eo(this.diagram,i,!0)?i:null},t.prototype.inputChange=function(e){var t,i,r,o,n,a,s,h,d,l=document.getElementById(this.diagram.element.id+"_editBox"),c=document.getElementById(this.diagram.element.id+"_editTextBoxDiv"),p=l.value,g=p.split("\n");(!(o=this.diagram.selectedItems.nodes[0]?this.diagram.selectedItems.nodes[0]:this.diagram.selectedItems.connectors[0])&&this.tool instanceof Kd||o&&"SwimLane"===o.shape.type)&&(o=this.diagram.nameTable[this.diagram.activeLabel.parentId]),o&&("Text"!==o.shape.type&&o.annotations.length>0||"Text"===o.shape.type)&&(r=this.diagram.getWrapper(o.wrapper,this.diagram.activeLabel.id),t=(t=o.wrapper.bounds.width<r.bounds.width?o.wrapper.bounds.width:r.bounds.width)>90?t:90,s=Fs(r.style,p,void 0,void 0,t),i=Number(l.style.fontSize.split("px")[0]),g.length>1&&""===g[g.length-1]&&(s.height=s.height+i),h=this.diagram.scroller.transform,d=Jr(this.diagram)?h.scale:1,a=(90>(a=s.width)?90:a)*d,n=(12>s.height?12:s.height)*d,c.style.left=(r.bounds.center.x+h.tx)*h.scale-a/2-2.5+"px",c.style.top=(r.bounds.center.y+h.ty)*h.scale-n/2-3+"px",c.style.width=a+"px",c.style.height=n+"px",l.style.minHeight="12px",l.style.minWidth="90px",l.style.width=a+"px",l.style.height=n+"px")},t.prototype.isAddTextNode=function(e,t){return!!(this.tool instanceof Kd||t)&&(this.tool=null,e&&!Zr(this.diagram)&&(this.diagram.drawingObject=void 0,this.diagram.currentDrawingObject=void 0),!(Ca(this.diagram.nodes,e.id)||Ca(this.diagram.connectors,e.id)||this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(e)>-1))},t.prototype.checkEditBoxAsTarget=function(e){return!(!e.target||e.target.id!==this.diagram.element.id+"_editBox")},t.prototype.getMouseEventArgs=function(t,i,r,o){var n,a,s;if(i.position=t,r?(a=this.diagram.findObjectsUnderMouse(this.currentPosition,r),n=this.diagram.findTargetObjectUnderMouse(a,this.action,this.inAction,i.position,r)):"Drag"===this.action||"ConnectorSourceEnd"===this.action||"SegmentEnd"===this.action||"OrthoThumb"===this.action||"BezierSourceThumb"===this.action||"BezierTargetThumb"===this.action||"ConnectorTargetEnd"===this.action||-1!==this.action.indexOf("Rotate")||-1!==this.action.indexOf("Resize")?(n=this.diagram.selectedItems,!this.diagram.currentSymbol&&"Drag"===this.action&&n&&this.diagram.selectedItems.nodes.length>0&&"SwimLane"===this.diagram.selectedItems.nodes[0].shape.type&&(a=this.diagram.findObjectsUnderMouse(this.currentPosition),n=this.diagram.findObjectUnderMouse(a,this.action,this.inAction))):(a=this.diagram.findObjectsUnderMouse(this.currentPosition),n=this.diagram.findObjectUnderMouse(a,this.action,this.inAction)),n&&n.isHeader&&(n=this.diagram.nameTable[n.parentId],this.eventArgs.actualObject=n),n){var h=void 0,d=void 0,l=void 0;if(((s=this.diagram.findElementUnderMouse(n,this.currentPosition,o))&&n.ports&&n.ports.length&&!Na(n,s)||!s||!n)&&a&&a.length&&r instanceof Ys)for(h=r.connectors[0],l=a.length-1;l>=0;l--)if((d=a[l])instanceof js&&h&&h.connectionPadding){if(n=d,s=this.diagram.findElementUnderMouse(n,this.currentPosition,o),h.constraints&e.ConnectorConstraints.ConnectToNearByPort&&n&&n.ports&&n.ports.length&&Na(n,s))break;if(d instanceof js&&h&&h.connectionPadding&&d.wrapper.outerBounds.containsPoint(this.currentPosition)&&h.constraints&e.ConnectorConstraints.ConnectToNearByNode&&!(h.constraints&e.ConnectorConstraints.ConnectToNearByPort)){n=d,s=this.diagram.findElementUnderMouse(n,this.currentPosition,0);break}}}return r?(i.target=n,i.targetWrapper=s):(i.source=n,i.sourceWrapper=s),i.actualObject=this.eventArgs.actualObject,i.source instanceof Ys&&void 0===i.actualObject&&(i.source.nodes.length>0||i.source.connectors.length>0)&&(i.actualObject=i.source.nodes.length>0?this.diagram.nameTable[i.source.nodes[0].id]:this.diagram.nameTable[i.source.connectors[0].id]),i.startTouches=this.touchStartList,i.moveTouches=this.touchMoveList,i},t.prototype.resetTool=function(){this.action="Select",this.hoverElement=null,this.hoverNode=null,this.tool=this.diagram.getTool(this.action),this.updateCursor()},t.prototype.getTool=function(e){switch(e){case"Select":return new Vd(this.commandHandler,!0);case"Drag":return new Ud(this.commandHandler);case"Rotate":return new Gd(this.commandHandler);case"LayoutAnimation":return new Jd(this.commandHandler);case"FixedUserHandle":return new Xd(this.commandHandler,!0);case"Hyperlink":return new $d(this.commandHandler);case"ResizeSouthEast":case"ResizeSouthWest":case"ResizeNorthEast":case"ResizeNorthWest":case"ResizeSouth":case"ResizeNorth":case"ResizeWest":case"ResizeEast":return new Fd(this.commandHandler,e);case"ConnectorSourceEnd":case"ConnectorTargetEnd":case"BezierSourceThumb":case"BezierTargetThumb":return new Yd(this.commandHandler,e);case"SegmentEnd":case"OrthoThumb":return new al(this.commandHandler,e);case"Draw":var t=Sn(this.diagram.drawingObject);if("Node"===t&&"Text"===this.diagram.drawingObject.shape.type)return new Kd(this.commandHandler);if("Node"===t&&("Polygon"===this.diagram.drawingObject.shape.shape||sf.base.isBlazor()&&"Polygon"===this.diagram.drawingObject.shape.basicShape)&&!this.diagram.drawingObject.shape.points)return new el(this.commandHandler);if("Node"===t||"Node"===t&&"Polygon"===this.diagram.drawingObject.shape.shape&&this.diagram.drawingObject.shape.points)return new Zd(this.commandHandler,this.diagram.drawingObject);if("Connector"===t&&"Polyline"===this.diagram.drawingObject.type)return new tl(this.commandHandler);if("Connector"===t)return new qd(this.commandHandler,"ConnectorSourceEnd",this.diagram.drawingObject);break;case"Pan":return new Qd(this.commandHandler,!1);case"PinchZoom":return new Qd(this.commandHandler,!0);case"PortDrag":return new Ud(this.commandHandler,"Port");case"PortDraw":return new qd(this.commandHandler,"ConnectorSourceEnd",this.diagram.drawingObject);case"LabelSelect":return new Vd(this.commandHandler,!0,"LabelSelect");case"LabelDrag":return new il(this.commandHandler);case"LabelResizeSouthEast":case"LabelResizeSouthWest":case"LabelResizeNorthEast":case"LabelResizeNorthWest":case"LabelResizeSouth":case"LabelResizeNorth":case"LabelResizeWest":case"LabelResizeEast":return new rl(this.commandHandler,e);case"LabelRotate":return new ol(this.commandHandler)}return null},t.prototype.getCursor=function(e){var t=this.diagram.selectedItems.annotation?this.diagram.selectedItems.wrapper.children[0]:this.diagram.selectedItems;return Od(e,this.diagram.selectedItems.annotation?t.rotateAngle+t.parentTransform:t.rotateAngle)},t.prototype.findElementUnderMouse=function(e,t,i){return this.objectFinder.findElementUnderSelectedItem(e,t,i)},t.prototype.findObjectsUnderMouse=function(e,t){return this.objectFinder.findObjectsUnderMouse(e,this.diagram,this.eventArgs,t)},t.prototype.findObjectUnderMouse=function(e,t,i){return this.objectFinder.findObjectUnderMouse(this.diagram,e,t,i,this.eventArgs,this.currentPosition)},t.prototype.findTargetUnderMouse=function(e,t,i,r,o){return this.objectFinder.findObjectUnderMouse(this.diagram,e,t,i,this.eventArgs,r,o)},t.prototype.findActionToBeDone=function(e,t,i,r){return Cd(e,t,this.currentPosition,this.diagram,this.touchStartList,this.touchMoveList,r)},t.prototype.updateContainerBounds=function(e){var t=!1;if(this.diagram.selectedObject.helperObject&&this.diagram.selectedObject.actualObject instanceof js){var i=this.tool instanceof Fd,r=this.diagram.selectedObject.actualObject,o=this.diagram.nameTable[r.parentId];e?zo(this.diagram,r,this.currentPosition,i):((!o||o&&"SwimLane"!==o.shape.type)&&this.diagram.updateDiagramObject(r),t=Ao(this.diagram,r,this.currentPosition,i),this.diagram.updateSelector(),(r.isLane||r.isPhase)&&(this.diagram.clearSelection(),this.commandHandler.selectObjects([r])))}return t},t.prototype.updateContainerProperties=function(){var t,i,r,o,n=!1,a=!1,s={hasStack:!1,isPreventHistory:!1};if(this.diagram.selectedObject.helperObject){var h=this.diagram.findObjectsUnderMouse(this.currentPosition),d=this.diagram.findObjectUnderMouse(h,this.action,this.inAction);if(t=this.diagram.selectedObject.helperObject,(o=this.diagram.selectedObject.actualObject)instanceof js){if("SwimLane"===o.shape.type&&(r=Uo(this.diagram,o.wrapper.children[0])),"SwimLane"!==o.shape.type&&o.parentId&&"SwimLane"===this.diagram.getObject(o.parentId).shape.type&&d instanceof js&&this.diagram.getObject(d.parentId)&&"SwimLane"!==this.diagram.getObject(d.parentId).shape.type&&(d=this.diagram.getObject(d.parentId)),"Drag"===this.currentAction&&o.container&&"Canvas"===o.container.type&&o.parentId&&"SwimLane"===this.diagram.getObject(o.parentId).shape.type&&d&&d!==o&&d.container&&"Canvas"===d.container.type&&d.isLane&&o.isLane&&d.parentId===o.parentId)$o(this.diagram,o,d,this.currentPosition),s.isPreventHistory=!0;else{var l=this.diagram.nameTable[o.parentId];if(!l||l&&"SwimLane"!==l.shape.type)if(l&&l.isLane&&o.constraints&e.NodeConstraints.AllowMovingOutsideLane){var c=this.diagram.getObject(l.parentId),p=c.id+c.shape.lanes[0].id+"0",g=this.diagram.getObject(p),u=g.wrapper.bounds.x,f=g.wrapper.bounds.y,m=c.wrapper.bounds.bottomRight.x-u,y=c.wrapper.bounds.bottomRight.y-f;new b(u,f,m,y).containsPoint(this.currentPosition)&&(o.offsetX=t.offsetX,o.offsetY=t.offsetY,o.width=t.width,o.height=t.height,o.rotateAngle=t.rotateAngle)}else o.offsetX=t.offsetX,o.offsetY=t.offsetY,o&&o.shape&&"UmlClassifier"!==o.shape.type&&("Bpmn"!==o.shape.type||"Bpmn"===o.shape.type&&"TextAnnotation"!==o.shape.shape)&&(o.width=t.width,o.height=t.height),o.rotateAngle=t.rotateAngle;var v=void 0;if(l&&l.container&&"Stack"===l.container.type&&(this.diagram.startGroupAction(),a=!0),!d&&l&&l.container&&"Stack"===l.container.type&&"Drag"===this.action){var w=l.wrapper.children.indexOf(o.wrapper);if(v={targetIndex:void 0,target:void 0,sourceIndex:w,source:Ah(o)},w>-1){var x=l.children;x.splice(x.indexOf(o.id),1),this.diagram.nameTable[o.id].parentId="",i=!0,l.wrapper.children.splice(w,1)}}if(jo(o,d,this.diagram,this.action),(l=Eo(this.diagram,o)?this.diagram.nameTable[o.parentId]:this.diagram.nameTable[o.parentId]||o)&&l.container&&"Canvas"===l.container.type&&(l.wrapper.maxWidth=l.maxWidth=l.wrapper.actualSize.width,l.wrapper.maxHeight=l.maxHeight=l.wrapper.actualSize.height,n=!0),Eo(this.diagram,o,!0)&&l&&"Canvas"===l.container.type?Bo(this.diagram,o):s=this.updateContainerPropertiesExtend(l,o,r,t,s),this.diagram.lineRoutingModule&&this.diagram.constraints&e.DiagramConstraints.LineRouting&&!Eo(this.diagram,o,!0)&&(o.children&&(this.diagram.realActions|=e.RealAction.EnableGroupAction),this.diagram.nodePropertyChange(o,{},{width:o.width,height:o.height,offsetX:o.offsetX,offsetY:o.offsetY}),o.children&&(this.diagram.realActions&=~e.RealAction.EnableGroupAction)),o.shape.lanes&&this.updateLaneChildNode(o),n&&(l.maxWidth=l.wrapper.maxWidth=void 0,l.maxHeight=l.wrapper.maxHeight=void 0),i){this.diagram.nodePropertyChange(l,{},{offsetX:l.offsetX,offsetY:l.offsetY,width:l.width,height:l.height,rotateAngle:l.rotateAngle});var C={redoObject:{sourceIndex:void 0,source:v.source},type:"StackChildPositionChanged",undoObject:v,category:"Internal"};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.diagram.addHistoryEntry(C)}o&&o.container&&("Stack"===o.container.type||"Canvas"===o.container.type&&""===o.parentId)&&(o&&o.shape&&"UmlClassifier"===o.shape.type&&(o.wrapper.measureChildren=!0),this.diagram.nodePropertyChange(o,{},{offsetX:o.offsetX,offsetY:o.offsetY,width:o.width,height:o.height,rotateAngle:o.rotateAngle}),o&&o.shape&&"UmlClassifier"===o.shape.type&&(o.wrapper.measureChildren=!1))}Jo(r,this.diagram),s.hasStack=a}}return o&&(o.isPhase||o.isLane||o.shape&&"SwimLane"===o.shape.type)&&this.diagram.updateDiagramElementQuad(),s},t.prototype.updateLaneChildNode=function(e){for(var t=0;t<e.shape.lanes.length;t++)if(e.shape.lanes[t].children&&e.shape.lanes[t].children.length>0)for(var i=0;i<e.shape.lanes[t].children.length;i++){var r=e.shape.lanes[t].children[i].id,o=this.diagram.nameTable[r];o.offsetX=o.wrapper.offsetX,o.offsetY=o.wrapper.offsetY}},t.prototype.updateContainerPropertiesExtend=function(e,t,r,o,n){if("ResizeEast"===this.currentAction||"ResizeSouth"===this.currentAction||"SwimLane"===t.shape.type){var a=Ah(t),s=!1;if(e&&e.container&&"Grid"===e.container.type){var h="SwimLane"===e.shape.type,d=h?e.wrapper.children[0]:e.wrapper,l=h?e.shape.padding:void 0,c=e.wrapper.bounds.x,p=e.wrapper.bounds.y;if(void 0!==t.columnIndex&&"Horizontal"===e.container.orientation&&(h&&t.isPhase||!h&&1===t.rowIndex)||"Vertical"===e.container.orientation&&(!h&&t.rowIndex>0&&t.columnIndex>0||h&&t.isLane)){if("Horizontal"===e.container.orientation&&t.isPhase&&t.wrapper.width>t.maxWidth&&(t.maxWidth=t.wrapper.width,t.wrapper.maxWidth=t.wrapper.width),en(this.diagram,t,e,o),d.updateColumnWidth(t.columnIndex,o.width,!0,l),t.isPhase){var g=e.shape.phases[t.columnIndex].header.id,u=this.diagram.nameTable[g];u.maxWidth<o.width&&(u.maxWidth=o.width,u.wrapper.maxWidth=o.width)}"SwimLane"===e.shape.type&&(e.width=e.width?d.width:e.width,nn(this.diagram,e),e.wrapper.width=e.width,r=Uo(this.diagram,d,t.rowIndex))}else void 0!==t.rowIndex&&(s=!0,en(this.diagram,t,e,o),d.updateRowHeight(t.rowIndex,o.height,!0,l),"SwimLane"===e.shape.type&&(e.height=e.height?d.height:e.height,e.wrapper.height=e.height,r=Uo(this.diagram,d,t.rowIndex)));"SwimLane"===e.shape.type&&(n.isPreventHistory=!0),this.diagram.nodePropertyChange(e,{},{offsetX:e.offsetX,offsetY:e.offsetY,rotateAngle:e.rotateAngle}),this.diagram.drag(e,c-e.wrapper.bounds.x,p-e.wrapper.bounds.y)}else t&&t.shape&&"UmlClassifier"===t.shape.type&&(t.wrapper.measureChildren=!0),this.diagram.nodePropertyChange(t,{},{offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height,rotateAngle:t.rotateAngle}),t.wrapper.measureChildren=!1;if(t.wrapper.measure(new i(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize),"ResizeEast"===this.currentAction||"ResizeSouth"===this.currentAction){var f={category:"Internal",type:s?"RowHeightChanged":"ColumnWidthChanged",undoObject:a,redoObject:Ah(t)};this.diagram.addHistoryEntry(f)}}return Jo(r,this.diagram),n},t.prototype.addUmlNode=function(){var t=this.diagram.selectedItems.nodes[0],i=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x+20,y:this.currentPosition.y}),r=this.diagram.findObjectUnderMouse(i,this.action,this.inAction);if(r||(i=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x-20,y:this.currentPosition.y}),r=this.diagram.findObjectUnderMouse(i,this.action,this.inAction)),t&&t.container&&"Stack"===t.container.type&&r&&r.parentId&&r.parentId===t.id){var o=r,n=Js(this.diagram.element.id);if(n.getElementById(n.id+"_stack_highlighter")){var a=t.wrapper.children.indexOf(r.wrapper)+1;this.diagram.enableServerDataBinding(!1);var s=new js(this.diagram,"nodes",{style:{fill:t.style.fill,strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor},annotations:r.annotations,verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(e.NodeConstraints.Default|e.NodeConstraints.HideThumbs)&~(e.NodeConstraints.Rotate|e.NodeConstraints.Drag|e.NodeConstraints.Resize),minHeight:25},!0);s.annotations[0].content=" + Name : Type";o.id.split("_");s.id=xh()+s.id,s.parentId=t.id,s.zIndex=-1,s.umlIndex=a,this.diagram.startGroupAction();t.wrapper.children.indexOf(s.wrapper);this.diagram.enableServerDataBinding(!0),this.diagram.add(s),this.diagram.updateConnectorEdges(t),this.diagram.clearSelection(),this.diagram.select([this.diagram.nameTable[s.id]]),this.diagram.endGroupAction(),this.diagram.startTextEdit()}}},t}(),hl=function(){function t(){}return t.prototype.findObjectsUnderMouse=function(t,i,r,o,n){var a,s,h,d,l=[];o&&o instanceof Ys&&o.nodes.length+o.connectors.length===1&&(o=o.nodes[0]||o.connectors[0]).children&&0===o.children.length&&(r.actualObject=o);for(var c,p,g=o&&o instanceof wr&&(o.constraints&e.ConnectorConstraints.ConnectToNearByNode||o.constraints&e.ConnectorConstraints.ConnectToNearByPort)&&o.connectionPadding||0,u={},f=0,m=i.spatialSearch.findObjects(new b(t.x-50-g,t.y-50-g,100+g,100+g));f<m.length;f++){var y=t;s=(E=m[f]).wrapper.outerBounds;var v=!E.rotateAngle&&s.containsPoint(y,g);if((E!==o||i.currentDrawingObject instanceof wr)&&E instanceof wr?E!==i.currentDrawingObject:E.wrapper.visible)if((O=i.commandHandler.getObjectLayer(E.id))&&!O.lock&&O.visible){if(c=u[O.zIndex]=u[O.zIndex]||[],E.rotateAngle){s=Ph(a=E.wrapper);for(var w=0,S=a.children;w<S.length;w++)h=S[w],P(d=x(),-(h.rotateAngle+h.parentTransform),h.offsetX,h.offsetY),y=C(d,t),Ph(h).containsPoint(y,g)&&(v=!0)}if((!o||!1===zd(i,E))&&((p=E)instanceof wr?p.constraints&e.ConnectorConstraints.PointerEvents:p.constraints&e.NodeConstraints.PointerEvents)&&(E instanceof wr?kn(E,t):v)){var T=E instanceof wr&&E.hitPadding||0;this.findElementUnderMouse(E,t,g||T)&&"helper"!==E.id&&Ta(E,"zIndex",c)}}}for(var A=0,z=i.layers;A<z.length;A++)for(var O=z[A],I=0,D=l=l.concat(u[O.zIndex]||[]);I<D.length;I++){var E;if("Bpmn"===(E=D[I]).shape.type&&E.processId&&(!(i.eventHandler.tool instanceof Ud)||i.eventHandler.tool instanceof Ud&&Xr(E)))(N=l.indexOf(i.nameTable[E.processId]))>-1&&l.splice(N,1);if("UmlClassifier"===E.shape.type&&E.container&&"Stack"===E.container.type)(N=l.indexOf(i.nameTable[i.nameTable[E.id].wrapper.children[0].id]))>-1&&l.splice(N,1)}for(var B=0;B<l.length;B++){var L=i.nameTable[l[B].parentId];if(L)for(var M=this.findElementUnderMouse(L,t),k=0;k<L.ports.length;k++)if(M.id.match("_"+L.ports[k].id+"$")){var R=L.ports[k];if(to(R)||eo(R))return l}for(;L;){var N;if(-1===(N=l.indexOf(L)))break;l.splice(N,1),L=i.nameTable[L.parentId]}}if(this.checkSwimlane(l),r&&!r.source)for(B=0;B<l.length;B++){var j=i.nameTable[l[B].parentId];if(j&&"SwimLane"===j.shape.type)for(k=0;k<l.length;k++){l[k]instanceof wr&&l.splice(B,1)}}return l},t.prototype.checkSwimlane=function(e){for(var t,i=0;i<e.length;i++){var r=e[i],o=void 0,n=void 0;if(r instanceof js&&(o=e[i].parentId,n=r),""===o&&(t=!0),i>0&&t&&n&&(n.isLane||n.isPhase||n.isHeader)){var a=e[i];e[i]=e[i-1],e[i-1]=a}}},t.prototype.isTarget=function(e,t,i){var r,o=t.selectedItems.connectors[0];if(!(r="ConnectorSourceEnd"===i?t.nameTable[o.targetID]:r=t.nameTable[o.sourceID])||(r.processId||e.processId)&&r.processId===e.processId||(r.processId!==e.processId&&(e=null),e&&e.parentId&&"UmlClassifier"===t.nameTable[e.parentId].shape.type&&(e=t.nameTable[e.parentId])),"ConnectorSourceEnd"===i&&o.targetID){var n=t.nameTable[o.targetID];if(n&&n.shape&&"TextAnnotation"===n.shape.shape){var a=o.id.split("_");("Bpmn"===n.shape.type&&"Bpmn"!==e.shape.type||a[0]===e.id||"TextAnnotation"===e.shape.shape)&&(e=null),e.parentId&&"UmlClassifier"===t.nameTable[e.parentId].shape.type&&(e=t.nameTable[e.parentId])}}return e},t.prototype.findObjectUnderMouse=function(e,t,i,r,o,n,a){var s,h,d=null;if(0!==t.length)if(a&&a instanceof Ys&&a.nodes.length+a.connectors.length===1&&(a=a.nodes[0]||a.connectors[0]),"ConnectorSourceEnd"===i&&a||"PortDraw"===i||(qr(e)||Zr(e))&&Ea(e.drawingObject)===wr)for(var l=e.selectedItems.connectors[0],c=t.length-1;c>=0;c--){h=wa(t[c],!1),s=wa(t[c],!0);var p=e.eventHandler.tool,g=this.findTargetElement(t[c].wrapper,n,void 0);if("Draw"===i&&g&&t[c]instanceof js&&!Na(t[c],g)&&(p&&"ConnectorSourceEnd"===p.endPoint&&!Wr(t[c])||p&&"ConnectorTargetEnd"===p.endPoint&&!jr(t[c])))return d;if(t[c]instanceof js&&(Wr(t[c])||_r(h)||jr(t[c])||Hr(s)||"PortDraw"===i&&p instanceof Yd&&"ConnectorTargetEnd"===p.endPoint&&(jr(t[c])||Hr(s))))return d=t[c],l&&(d=this.isTarget(d,e,i)),o.actualObject=d,d}else if("ConnectorTargetEnd"===i&&a){for(c=t.length-1;c>=0;c--)if(s=wa(t[c],!0),t[c]instanceof js&&(jr(t[c])||Hr(s)))return d=t[c],d=this.isTarget(d,e,i),o.actualObject=d,d}else{if(a&&("Drag"===i||e.eventHandler.tool instanceof Ud)){var u=0;for(c=0;c<t.length;c++){var f=t[c];a!==f&&(f instanceof wr||!n||f.wrapper.bounds.containsPoint(n))&&Xr(f)&&(d?(d=u>=f.zIndex?d:f,u=Math.max(u,f.zIndex)):u=(d=f).zIndex)}return d&&"Bpmn"===d.shape.type&&(d=e.selectedItems.nodes.length>0&&"Bpmn"===e.selectedItems.nodes[0].shape.type?d:null),d&&(o.actualObject=d),d}if("Select"!==i&&"Pan"!==i||!e.eventHandler.tool)if("Pan"===i||"LayoutAnimation"===i){for(c=t.length-1;c>=0;c--)if(t[c]instanceof js||t[c]instanceof wr){g=this.findTargetElement(t[c].wrapper,n,void 0);if("Pan"===i||g&&(g.id.match("_icon_content_shape$")||g.id.match("_icon_content_rect$")))return t[c]}}else d=t[t.length-1],o&&d&&(o.actualObject=d);else{for(var c=t.length-1;c>=0;c--)if(t[c]instanceof wr){var m=t[c-1];if(t[c-1]instanceof js&&m.ports){if((g=this.findTargetElement(m.wrapper,n,void 0))&&(g.id.match("_icon_content_shape$")||g.id.match("_icon_content_rect$")))return m;for(var y=0;y<m.ports.length;y++)if(g&&g.id.match("_"+m.ports[y].id+"$")&&eo(m.ports[y]))return m}}if(d=t[t.length-1],o.actualObject=d,!e.eventHandler.itemClick(d,!0)&&d.parentId)for(var v=d,b=zd(e,v);v&&(!zd(e,v)||b);)d=v,v=e.nameTable[v.parentId]}}return d},t.prototype.findElementUnderSelectedItem=function(e,t,i){return e instanceof Ys?1!==e.nodes.length||e.connectors&&e.connectors.length?e.nodes&&!e.nodes.length||1!==e.connectors.length?null:this.findElementUnderMouse(e.connectors[0],t):this.findElementUnderMouse(e.nodes[0],t):this.findElementUnderMouse(e,t,i)},t.prototype.findElementUnderMouse=function(e,t,i){return this.findTargetElement(e.wrapper,t,i)},t.prototype.findTargetElement=function(e,t,i){for(var r=e.children.length-1;r>=0;r--){var o=e.children[r];if(o&&o.outerBounds.containsPoint(t,i||0)){if(o instanceof xe){var n=this.findTargetElement(o,t);if(n)return n}if(o.bounds.containsPoint(t,i||0))return o}}return e.bounds.containsPoint(t,i)&&"none"!==e.style.fill?e:null},t}(),dl=(Ed=function(e,t){return(Ed=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ed(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ll=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},cl=function(e){function t(t,i,r,o){var n=e.call(this,t,i,r,o)||this;return n.objectZIndex=-1,n.zIndexTable={},n.objects=[],n}return dl(t,e),ll([sf.base.Property("")],t.prototype,"id",void 0),ll([sf.base.Property(!0)],t.prototype,"visible",void 0),ll([sf.base.Property(!1)],t.prototype,"lock",void 0),ll([sf.base.Property()],t.prototype,"objects",void 0),ll([sf.base.Property()],t.prototype,"addInfo",void 0),ll([sf.base.Property(-1)],t.prototype,"zIndex",void 0),t}(sf.base.ChildProperty),pl=function(e,t,i,r){return new(i||(i=Promise))((function(o,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function s(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){e.done?o(e.value):new i((function(t){t(e.value)})).then(a,s)}h((r=r.apply(e,t||[])).next())}))},gl=function(e,t){var i,r,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,r=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},ul=function(){function t(e){this.clipboardData={},this.diagramObject={},this.newSelectedObjects={},this.oldSelectedObjects={},this.connectorsTable=[],this.processTable={},this.deepDiffer=new Nd,this.isContainer=!1,this.childTable={},this.parentTable={},this.blazor="Blazor",this.blazorInterop="sfBlazor",this.cloneGroupChildCollection=[],this.diagram=e}return Object.defineProperty(t.prototype,"snappingModule",{get:function(){return this.diagram.snappingModule},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutAnimateModule",{get:function(){return this.diagram.layoutAnimateModule},enumerable:!0,configurable:!0}),t.prototype.startTransaction=function(e){this.state={element:this.diagram.selectedItems,backup:null},e&&this.diagram.protectPropertyChange(!0),eh(this.diagram.element.id).style.pointerEvents="none"},t.prototype.endTransaction=function(e){this.state=null,e&&this.diagram.protectPropertyChange(!1),eh(this.diagram.element.id).style.pointerEvents="all"},t.prototype.setFocus=function(){document.getElementById(this.diagram.element.id).focus()},t.prototype.showTooltip=function(e,t,i,r,o){var n=this;if(o&&(this.diagram.tooltipObject.position="BottomCenter",this.diagram.tooltipObject.animation={open:{delay:0,duration:0}},this.diagram.tooltipObject.openDelay=0,this.diagram.tooltipObject.closeDelay=0),this.diagram.selectedItems.setTooltipTemplate){var a=void 0,s=Wh(this.diagram.selectedItems.setTooltipTemplate);s&&(a=s(e,this.diagram)),i=a instanceof HTMLElement?a.cloneNode(!0):a||i}sf.base.isBlazor()&&o&&this.diagram.tooltipObject.close(),e.tooltip&&(this.diagram.tooltipObject.openOn=e.tooltip.openOn),this.diagram.tooltipObject.content=i;var h=Wn(this.diagram,{x:t.x,y:t.y},e,"ConnectTool"===r?"Mouse":"Object");this.diagram.tooltipObject.offsetX=h.x+("ConnectTool"===r?10:0),this.diagram.tooltipObject.offsetY=h.y+10,sf.base.isBlazor()?this.diagram.tooltipObject.updateTooltip(this.diagram.element):this.diagram.tooltipObject.dataBind(),o&&setTimeout((function(){n.diagram.tooltipObject.open(n.diagram.element)}),1)},t.prototype.closeTooltip=function(){this.diagram.tooltipObject.close()},t.prototype.canEnableDefaultTooltip=function(){return!!(this.diagram.selectedItems.constraints&e.SelectorConstraints.ToolTip)},t.prototype.updateSelector=function(){this.diagram.updateSelector()},t.prototype.updateConnectorValue=function(e){if(e.cancel){this.enableCloneObject(!0),this.ismouseEvents(!0),this.insertBlazorObject(e.connector);var t={},i={},r=this.diagram.nameTable[e.connector.id],o="ConnectorSourceEnd"===e.connectorEnd?"sourceID":"targetID",n="ConnectorSourceEnd"===e.connectorEnd?"sourcePortID":"targetPortID",a="ConnectorTargetEnd"===e.connectorEnd,s=a?e.newValue.connectorTargetValue:e.newValue.connectorSourceValue,h=a?e.oldValue.connectorTargetValue:e.oldValue.connectorSourceValue;i[o]=s.nodeId,i[n]=s.portId,t[o]=h.nodeId,t[n]=h.portId,e.cancel&&"ConnectorTargetEnd"!==e.connectorEnd&&(r.sourceID=h.nodeId,e.connector.sourcePortID&&(r.sourcePortID=h.portId),this.diagram.connectorPropertyChange(r,i,t)),e.cancel&&"ConnectorTargetEnd"===e.connectorEnd&&(e.connector.targetPortID&&(r.targetPortID=h.portId),r.targetID=h.nodeId,this.diagram.connectorPropertyChange(r,i,t))}},t.prototype.triggerEvent=function(t,i){return pl(this,void 0,void 0,(function(){return gl(this,(function(r){switch(r.label){case 0:if(t===e.DiagramEvent.drop||t===e.DiagramEvent.positionChange||t===e.DiagramEvent.connectionChange){if(this.diagram.currentSymbol)return[2];if(t===e.DiagramEvent.drop&&(i.source=_a(this.diagram)),this.diagram.currentDrawingObject&&t!==e.DiagramEvent.positionChange)return[2]}return[4,this.diagram.triggerEvent(t,i)];case 1:return[2,r.sent()]}}))}))},t.prototype.dragOverElement=function(t,i){if(this.diagram.currentSymbol){var r={element:_a(t.source),target:_a(t.target),mousePosition:_a(i),diagram:_a(this.diagram)};this.triggerEvent(e.DiagramEvent.dragOver,r)}},t.prototype.disConnect=function(t,i,r){var o,n,a=sf.base.isBlazor(),s={},h={};if(t instanceof Ys?n=t.connectors[0]:t instanceof wr&&this.diagram.currentDrawingObject&&(n=this.diagram.currentDrawingObject),t&&n&&(Ad(this.diagram)||this.diagram.currentDrawingObject))if(sf.base.isBlazor()&&this.diagram.insertValue(Ah(n),!1),!i||"ConnectorSourceEnd"!==i&&"ConnectorTargetEnd"!==i){if("OrthoThumb"!==i&&"SegmentEnd"!==i&&(n.sourceID||n.targetID)){s={sourceID:n.sourceID,sourcePortID:n.sourcePortID,targetID:n.targetID,targetPortID:n.targetPortID},n.sourceID="",n.sourcePortID="",n.targetID="",n.targetPortID="",h={sourceID:n.sourceID,sourcePortID:n.sourcePortID,targetID:n.targetID,targetPortID:n.targetPortID};var d={connector:_a(n),oldValue:s,newValue:h,cancel:!1,state:"Changing",connectorEnd:i};sf.base.isBlazor()&&(o=d={connector:_a(n),oldValue:{connector:_a(s)},newValue:{connector:_a(h)},cancel:!1,state:"Changed",connectorEnd:i}),a||this.triggerEvent(e.DiagramEvent.connectionChange,d),d.cancel?(n.sourceID=s.sourceID,n.sourcePortID=s.sourcePortID,n.targetID=s.targetID,n.targetPortID=s.targetPortID):(this.diagram.connectorPropertyChange(n,s,h),this.diagram.updateDiagramObject(n),d={connector:n,oldValue:s,newValue:h,cancel:!1,state:"Changed",connectorEnd:i},sf.base.isBlazor()&&(o=d={connector:_a(n),oldValue:{connector:s},newValue:{connector:h},cancel:!1,state:"Changed",connectorEnd:i}),a||this.triggerEvent(e.DiagramEvent.connectionChange,d))}}else{var l="ConnectorSourceEnd"===i?"sourceID":"targetID",c="ConnectorSourceEnd"===i?"sourcePortID":"targetPortID";n[l]&&(s[l]=n[l],n[l]="",h[l]=n[l],(n.sourcePortID||n.targetPortID)&&(s[c]=n[c],n[c]="",h[c]=n[c]),o=this.connectionEventChange(n,s,h,i,r))}return o},t.prototype.connectionEventChange=function(t,i,r,o,n){var a,s,h=sf.base.isBlazor(),d="ConnectorSourceEnd"===o?"sourceID":"targetID",l="ConnectorSourceEnd"===o?"sourcePortID":"targetPortID";if(this.enableCloneObject){var c=Ah(a=this.diagram.nameTable[r[d]]);this.diagram.insertValue(c,!0)}var p={cancel:!1,state:"Changing",connectorEnd:o,connector:_a(t),oldValue:{nodeId:i[d],portId:i[l]},newValue:{nodeId:r[d],portId:r[l]}};if(sf.base.isBlazor()&&(p={connector:_a(t),cancel:!1,state:"Changing",connectorEnd:o,oldValue:void 0,newValue:void 0},"ConnectorSourceEnd"===o?(p.oldValue={connectorSourceValue:{portId:i[l],nodeId:i[d]}},p.newValue={connectorSourceValue:{nodeId:r[d],portId:r[l]}}):(p.oldValue={connectorTargetValue:{nodeId:i[d],portId:i[l]}},p.newValue={connectorTargetValue:{nodeId:r[d],portId:r[l]}}),s=p),h||this.triggerEvent(e.DiagramEvent.connectionChange,p),p.cancel||sf.base.isBlazor()&&n?(t[d]=i[d],t[l]=i[l],r=i):(this.diagram.connectorPropertyChange(t,i,r),this.diagram.updateDiagramObject(t),p={connector:_a(t),oldValue:{nodeId:i[d],portId:i[l]},newValue:{nodeId:r[d],portId:r[l]},cancel:!1,state:"Changing",connectorEnd:o},sf.base.isBlazor()&&(p={connector:_a(t),oldValue:void 0,newValue:void 0,cancel:!1,state:"Changing",connectorEnd:o},"ConnectorSourceEnd"===o?(p.newValue={connectorSourceValue:{portId:r[l],nodeId:r[d]}},p.oldValue={connectorSourceValue:{portId:i[l],nodeId:i[d]}}):(p.oldValue={connectorTargetValue:{nodeId:i[d],portId:i[l]}},p.newValue={connectorTargetValue:{portId:r[l],nodeId:r[d]}}),s=p)),this.enableCloneObject&&void 0===a){c=Ah(a=this.diagram.nameTable[i[d]]);this.diagram.insertValue(c,!0)}return s},t.prototype.insertBlazorObject=function(e,t){var i,r;if(e instanceof Ys){this.oldSelectedObjects=ka(this.diagram);for(var o=0;o<e.nodes.length;o++)i=this.diagram.getObject(e.nodes[o].id),this.diagram.insertValue(Ah(i),!0);for(o=0;o<e.connectors.length;o++)r=this.diagram.getObject(e.connectors[o].id),this.diagram.insertValue(Ah(r),!1)}else e=this.diagram.getObject(e.id),this.diagram.insertValue(Ah(e),e instanceof js)},t.prototype.updatePropertiesToBlazor=function(e,t){this.enableCloneObject(!1),this.ismouseEvents(!1),this.getBlazorOldValues(e,t),this.updateBlazorSelector()},t.prototype.insertSelectedObjects=function(){this.oldSelectedObjects=ka(this.diagram)},t.prototype.findTarget=function(e,t,i,r){if(t instanceof js){if(e&&e.id===t.id+"_content")return t;if(i&&"Bpmn"===t.shape.type&&(!sf.base.isBlazor()&&"Activity"===t.shape.shape||sf.base.isBlazor()&&"Activity"===t.shape.bpmnShape)&&"Transaction"===t.shape.activity.subProcess.type){var o=t.shape.activity.subProcess.transaction;if(o.success.visible&&0===e.id.indexOf(t.id+"_success"))return o.success;if(o.cancel.visible&&0===e.id.indexOf(t.id+"_cancel"))return o.cancel;if(o.failure.visible&&0===e.id.indexOf(t.id+"_failure"))return o.failure}if(e instanceof Me)for(var n=0;n<t.ports.length;n++){var a=t.ports[n];if(e.id===t.id+"_"+a.id)return a}}if(!r){var s=void 0;for(n=0;n<t.annotations.length;n++)if(s=t.annotations[n],e.id===t.id+"_"+s.id)return s}return t},t.prototype.canDisconnect=function(e,t,i,r){var o;t.source instanceof Ys?o=t.source.connectors[0]:t.source instanceof wr&&this.diagram.currentDrawingObject&&(o=this.diagram.currentDrawingObject);this.findTarget(t.targetWrapper,t.target,"ConnectorSourceEnd"===e,!0);var n="ConnectorSourceEnd"===e?"sourcePortID":"targetPortID";return o["ConnectorSourceEnd"===e?"sourceID":"targetID"]!==r||o[n]!==i},t.prototype.changeAnnotationDrag=function(e){var t;if(e.source&&e.source.connectors&&e.source.connectors.length&&this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(e.source.connectors[0])>-1){e.source instanceof Ys&&(t=e.source.connectors[0]);var i=t.id.split("_"),r=(i[i.length-1],i[i.length-3]||i[0]);if(e.target&&e.target.id!==r&&(!sf.base.isBlazor()&&"TextAnnotation"!==e.target.shape.shape||sf.base.isBlazor()&&"TextAnnotation"!==e.target.shape.bpmnShape)){this.diagram.startGroupAction();var o=this.diagram.nameTable[i[0]],n=this.getAnnotation(o,i[1]),s={id:i[1]+xh(),angle:a.findAngle(t.intermediatePoints[0],t.intermediatePoints[1]),text:n.text,length:a.distancePoints(t.intermediatePoints[0],t.intermediatePoints[1]),shape:{shape:"TextAnnotation",type:"Bpmn"},nodeId:n.nodeId},h=new As(e.target.shape,"annotations",s,!0);this.diagram.bpmnModule.checkAndRemoveAnnotations(this.diagram.nameTable[t.targetID],this.diagram),this.diagram.refreshCanvasLayers(),h.id=i[1],this.diagram.addTextAnnotation(h,e.target),this.diagram.endGroupAction()}else t&&(t.sourceID=r,this.diagram.connectorPropertyChange(t,{},{sourceID:r}),this.diagram.updateDiagramObject(t))}},t.prototype.connect=function(t,i,r){var o,n,a,s,h={},d={};i.source instanceof Ys?a=i.source.connectors[0]:i.source instanceof wr&&this.diagram.currentDrawingObject&&(a=this.diagram.currentDrawingObject);var l=this.findTarget(i.targetWrapper||i.sourceWrapper,i.target||i.actualObject,"ConnectorSourceEnd"===t,!0),c="ConnectorSourceEnd"===t?"sourceID":"targetID",p="ConnectorSourceEnd"===t?"sourcePortID":"targetPortID";if(l instanceof js)d[c]=a[c],a[c]=l.id,h[c]=a[c],d[p]=a[p],s=this.connectionEventChange(a,d,h,t,r);else{o=a[c],n=a[p],a[p]=l.id,a[c]=i.target&&i.target.id||i.actualObject.id,h[c]=a[c],h[p]=a[p];var g={connector:_a(a),oldValue:{nodeId:o,portId:n},newValue:{nodeId:h[c],portId:h[p]},cancel:!1,state:"Changing",connectorEnd:t};sf.base.isBlazor()&&(g={connector:_a(a),oldValue:void 0,newValue:void 0,cancel:!1,state:"Changing",connectorEnd:t},"ConnectorSourceEnd"===t?(g.oldValue={connectorSourceValue:{portId:d[p],nodeId:d[c]}},g.newValue={connectorSourceValue:{portId:h[p],nodeId:h[c]}}):(g.newValue={connectorTargetValue:{portId:h[p],nodeId:h[c]}},g.oldValue={connectorTargetValue:{portId:d[p],nodeId:d[c]}}),s=g),this.triggerEvent(e.DiagramEvent.connectionChange,g),g.cancel||sf.base.isBlazor()&&r?(a[c]=o,a[p]=n,h[c]=o,h[p]=n):(this.diagram.connectorPropertyChange(a,d,h),this.diagram.updateDiagramObject(a),g={connector:_a(a),oldValue:{nodeId:o,portId:n},newValue:{nodeId:h[c],portId:h[p]},cancel:!1,state:"Changing",connectorEnd:t},sf.base.isBlazor()&&(g={newValue:void 0,connector:_a(a),oldValue:void 0,cancel:!1,state:"Changing",connectorEnd:t},"ConnectorSourceEnd"===t?(g.oldValue={connectorSourceValue:{portId:d[p],nodeId:d[c]}},g.newValue={connectorTargetValue:{portId:h[p],nodeId:h[c]}}):(g.oldValue={connectorTargetValue:{portId:d[p],nodeId:d[c]}},g.newValue={connectorTargetValue:{portId:h[p],nodeId:h[c]}})))}return this.renderHighlighter(i,void 0,"ConnectorSourceEnd"===t),s},t.prototype.cut=function(){this.clipboardData.pasteIndex=0,this.diagram.undoRedoModule&&this.diagram.historyManager.startGroupAction(),this.clipboardData.clipObject=this.copyObjects(),this.diagram.undoRedoModule&&this.diagram.historyManager.endGroupAction(),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer()},t.prototype.UpdateBlazorDiagramModelLayers=function(e,t){var i=_a(e);if(window&&window.Blazor){var r={methodName:"UpdateBlazorDiagramModelLayers",diagramobj:JSON.stringify(i),isRemove:t};this.diagram.isLoading||window.sfBlazor.updateBlazorProperties(r,this.diagram)}},t.prototype.addLayer=function(e,t,i){void 0===i&&(i=!0),e.id=e.id||xh(),e.zIndex=this.diagram.layers.length;var r=this.diagram.allowServerDataBinding;this.diagram.enableServerDataBinding(!1),e=new cl(this.diagram,"layers",e,!0),this.diagram.enableServerDataBinding(r),e.objectZIndex=-1,e.zIndexTable={},this.diagram.layers.push(e),i&&this.UpdateBlazorDiagramModelLayers(e,!1),this.diagram.layerZIndexTable[e.zIndex]=e.id,this.diagram.activeLayer=e;e.objects;if(t)for(var o=0;o<t.length;o++)this.diagram.add(t[o])},t.prototype.getObjectLayer=function(e){for(var t=this.diagram.layers,i=0;i<t.length;i++){if(t[i].objects.indexOf(e)>-1)return t[i]}return this.diagram.activeLayer},t.prototype.getLayer=function(e){for(var t=this.diagram.layers,i=0;i<t.length;i++)if(t[i].id===e)return t[i]},t.prototype.removeLayer=function(e,t){void 0===t&&(t=!0);var i=this.getLayer(e);if(i){for(var r=this.diagram.layers.indexOf(i),o=i.objects,n=o.length-1;n>=0;n--)this.diagram.unSelect(this.diagram.nameTable[o[n]]),this.diagram.remove(this.diagram.nameTable[o[n]]),"default_layer"!==i.id&&this.diagram.activeLayer.id===e&&(this.diagram.activeLayer=this.diagram.layers[this.diagram.layers.length-1]);t&&this.UpdateBlazorDiagramModelLayers(this.diagram.layers[r],!0),delete this.diagram.layerZIndexTable[i.zIndex],this.diagram.layers.splice(r,1),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer()}},t.prototype.moveObjects=function(e,t){var i,r=this.getLayer(t)||this.diagram.activeLayer;this.diagram.setActiveLayer(r.id);for(var o=0,n=e;o<n.length;o++){var a=n[o];this.getObjectLayer(a).objects.indexOf(a)>-1&&(i=this.diagram.nameTable[a],this.diagram.unSelect(i),this.diagram.remove(this.diagram.nameTable[a]),this.diagram.add(i))}},t.prototype.cloneLayer=function(e){this.diagram.layers;var t=this.getLayer(e);if(t){var i=[],r={id:e+"_"+xh(),objects:[],visible:!0,lock:!1};this.addLayer(r,null,!0),r.zIndex=this.diagram.layers.length-1;for(var o=0,n=t.objects;o<n.length;o++){var a=n[o];i.push(this.diagram.nameTable[a])}this.paste(i)}},t.prototype.copy=function(){return this.clipboardData.pasteIndex=1,this.clipboardData.clipObject=this.copyObjects(),this.clipboardData.clipObject},t.prototype.copyObjects=function(){var e=[],t=[];if(this.clipboardData.childTable={},this.diagram.selectedItems.connectors.length>0){e=this.diagram.selectedItems.connectors;for(var i=0;i<e.length;i++){var r=void 0;r=this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(e[i])>-1?Ah(this.diagram.nameTable[e[i].targetID]):Ah(e[i]),t.push(r)}}if(this.diagram.selectedItems.nodes.length>0){e=e.concat(this.diagram.selectedItems.nodes);for(i=0;i<this.diagram.selectedItems.nodes.length;i++)if(!e[i].isPhase){var o=Ah(this.diagram.selectedItems.nodes[i]);o.wrapper&&o.offsetX!==o.wrapper.offsetX&&(o.offsetX=o.wrapper.offsetX),o.wrapper&&o.offsetY!==o.wrapper.offsetY&&(o.offsetY=o.wrapper.offsetY),this.copyProcesses(o),t.push(Ah(o));var n=x();if(P(n,-o.rotateAngle,o.offsetX,o.offsetY),o.children){for(var a=this.clipboardData.childTable,s=void 0,h=this.getAllDescendants(o,[],!0),d=0;d<h.length;d++){var l=a[(s=this.diagram.nameTable[h[d].id]).id]=Ah(s),c=C(n,{x:l.wrapper.offsetX,y:l.wrapper.offsetY});s instanceof js&&(l.offsetX=c.x,l.offsetY=c.y,l.rotateAngle-=o.rotateAngle)}this.clipboardData.childTable=a}if("SwimLane"===o.shape.type){var p=this.diagram.getObject(this.diagram.selectedItems.nodes[i].id),g=(a=this.clipboardData.childTable,Uo(this.diagram,p.wrapper.children[0]));for(d=0;d<g.length;d++){var u=this.diagram.getObject(g[d]);a[u.id]=Ah(u)}}if(o&&o.isLane){a=this.clipboardData.childTable,p=this.diagram.getObject(o.parentId);var f=bn(o,this.diagram);a[o.id]=Ah(f),a[o.id].width=p.wrapper.actualSize.width}}}if(0===this.clipboardData.pasteIndex){this.startGroupAction();for(var m=0,y=e;m<y.length;m++){var v=y[m];this.diagram.nameTable[v.id]&&(this.diagram.bpmnModule&&this.diagram.bpmnModule.textAnnotationConnectors.indexOf(v)>-1?this.diagram.remove(this.diagram.nameTable[v.targetID]):this.diagram.remove(v))}this.endGroupAction()}return this.sortByZIndex(t,"zIndex"),t},t.prototype.copyProcesses=function(e){if("Bpmn"===e.shape.type&&e.shape.activity&&e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length>0){for(var t=0,i=e.shape.activity.subProcess.processes;t<i.length;t++){var r=i[t];this.processTable[r]=Ah(this.diagram.nameTable[r]),this.processTable[r].shape.activity.subProcess.processes&&this.processTable[r].shape.activity.subProcess.processes.length>0&&this.copyProcesses(this.processTable[r])}this.clipboardData.processTable=this.processTable}},t.prototype.group=function(){this.oldSelectedObjects=ka(this.diagram);var t=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0),this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.Group;var i=[],r={};r.id="group"+xh(),(r=new js(this.diagram,"nodes",r,!0)).children=[],i=(i=this.diagram.selectedItems.nodes).concat(this.diagram.selectedItems.connectors);for(var o=0;o<i.length;o++)i[o].parentId||r.children.push(i[o].id);var n=this.diagram.add(r);n&&this.select(n);var a={type:"Group",undoObject:r,redoObject:r,category:"Internal"};this.addHistoryEntry(a),this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.Group,this.diagram.protectPropertyChange(t),this.updateBlazorSelector()},t.prototype.unGroup=function(t){var i=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0),this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.Group;var r=[];t?r.push(t):r=this.diagram.selectedItems.nodes,this.diagram.startGroupAction();for(var o=0;o<r.length;o++){for(var n=r[o],a=Ah(n),s=[],h=0;h<n.children.length;h++)s.push(n.children[h]);if(n.children){n.ports&&n.ports.length>0&&this.diagram.removePorts(n,n.ports),n.annotations&&n.annotations.length>0&&(!sf.base.isBlazor()||sf.base.isBlazor()&&""!==n.annotations[0].content)&&this.diagram.removeLabels(n,n.annotations);for(var d=this.diagram.nameTable[n.parentId],l=n.children.length-1;l>=0;l--)this.diagram.nameTable[n.children[l]].parentId="",this.diagram.deleteChild(this.diagram.nameTable[n.children[l]],n),n.parentId&&n.children[l]&&this.diagram.addChild(d,n.children[l]);this.resetDependentConnectors(n.inEdges,!0),this.resetDependentConnectors(n.outEdges,!1);var c={type:"UnGroup",undoObject:a,redoObject:a,category:"Internal"};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(c),n.parentId&&this.diagram.deleteChild(n,d)}this.diagram.removeNode(n,s),this.clearSelection()}this.diagram.endGroupAction(),this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.Group,this.diagram.protectPropertyChange(i)},t.prototype.resetDependentConnectors=function(t,i){for(var r=0;r<t.length;r++){var o=this.diagram.nameTable[t[r]],n=Ah(o),a=void 0;i?(o.targetID="",o.targetPortID="",a={targetID:o.targetID,targetPortID:o.targetPortID}):(o.sourceID="",o.sourcePortID="",a={sourceID:o.sourceID,sourcePortID:o.sourcePortID}),this.diagram.connectorPropertyChange(o,{},a);var s={type:"ConnectionChanged",undoObject:{connectors:[n],nodes:[]},redoObject:{connectors:[Ah(o)],nodes:[]},category:"Internal"};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(s)}},t.prototype.paste=function(e){if(e||this.clipboardData.clipObject){this.diagram.protectPropertyChange(!0);var t=e?this.getNewObject(e):this.clipboardData.clipObject;if(t){var i=1!==t.length,r=!1,o={},n={};0!==this.clipboardData.pasteIndex&&this.clearSelection(),this.diagram.undoRedoModule&&(r=!0,this.diagram.historyManager.startGroupAction());for(var a=0,s=t;a<s.length;a++){o[(l=s[a]).id]=l}var h=[];i&&(this.diagram.isServerUpdate=!0);for(var d=0;d<t.length;d++){var l=t[d];if(Ea(l)===wr){var c=Ah(l),p=c.sourceID;c.sourceID="",o[p]&&n[p]&&(c.sourceID=n[p]),p=c.targetID,c.targetID="",o[p]&&n[p]&&(c.targetID=n[p]);var g=this.cloneConnector(c,i);h.push(g),n[l.id]=g.id}else{var u=this.cloneNode(l,i);if(sf.base.isBlazor()&&u&&u.children&&u.children.length>0?(h=h.concat(this.cloneGroupChildCollection),this.cloneGroupChildCollection=[]):h.push(u),u){n[l.id]=u.id;var f=l.inEdges;if(f)for(var m=0,y=f;m<y.length;m++){if(o[w=y[m]]&&n[w])(x=this.diagram.nameTable[n[w]]).targetID=n[l.id],this.diagram.connectorPropertyChange(x,{targetID:"",targetPortID:""},{targetID:x.targetID,targetPortID:x.targetPortID})}if(f=l.outEdges)for(var v=0,b=f;v<b.length;v++){var w,x;if(o[w=b[v]]&&n[w])(x=this.diagram.nameTable[n[w]]).sourceID=n[l.id],this.diagram.connectorPropertyChange(x,{sourceID:"",sourcePortID:""},{sourceID:x.sourceID,sourcePortID:x.sourcePortID})}}}}i&&(this.diagram.isServerUpdate=!1,this.diagram.UpdateBlazorDiagramModelCollection(t[0],h),this.getBlazorOldValues(),this.diagram.select(h,!0)),!0===r&&(this.diagram.historyManager.endGroupAction(),r=!1),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer(),this.clipboardData.pasteIndex++,this.diagram.protectPropertyChange(!1)}}},t.prototype.getNewObject=function(e){var t,i=[];this.clipboardData.pasteIndex=1;for(var r=0;r<e.length;r++)t=Ah(e[r]),i.push(t);return i},t.prototype.cloneConnector=function(e,t){var i=Ah(e);this.translateObject(i),i.zIndex=-1;var r=this.diagram.add(i);return this.diagram.isServerUpdate||this.selectObjects([r],t),r},t.prototype.cloneNode=function(e,t,i,r){var o,n,a={},s=Ah(e),h=this.diagram.nameTable[e.parentId];if(e.shape&&"Bpmn"===e.shape.type&&e.shape.activity&&e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length&&(n=s.shape.activity.subProcess.processes,s.zIndex=-1,s.shape.activity.subProcess.processes=void 0),e.shape&&"SwimLane"===e.shape.type)cn(e,this.diagram,this.clipboardData);else if(h&&"SwimLane"===h.shape.type)cn(Ah(h),this.diagram,this.clipboardData,e,!0);else if(!e.children||!e.children.length||i&&i.length)if(e.shape&&(!sf.base.isBlazor()&&"TextAnnotation"===e.shape.shape||sf.base.isBlazor()&&"TextAnnotation"===e.shape.bpmnShape)&&-1!==e.id.indexOf("_textannotation_")&&this.diagram.nameTable[e.id])for(var d=e.id.split("_textannotation_"),l=this.diagram.nameTable[e.id],c=0;c<l.inEdges.length;c++){var p=this.diagram.nameTable[l.inEdges[c]];if(p){var g=this.diagram.nameTable[p.sourceID],u=this.getAnnotation(g,d[1]),f={id:d[1]+xh(),angle:u.angle,text:u.text,length:u.length,shape:{shape:"TextAnnotation",type:"Bpmn"},nodeId:u.nodeId};this.diagram.addTextAnnotation(f,g)}}else this.translateObject(s,r),s.zIndex=-1,i&&(s.children=i),o=this.diagram.add(s);else o=this.cloneGroup(e,t);for(var m=0,y=Object.keys(a);m<y.length;m++){var v=y[m];this.diagram.add(a[v])}return n&&n.length&&(o.shape.activity.subProcess.processes=n,this.cloneSubProcesses(o)),o&&!this.diagram.isServerUpdate&&this.selectObjects([o],t),o},t.prototype.getAnnotation=function(e,t){var i=e.shape.annotations;if(i&&i.length)for(var r=0;r<=i.length;r++)if(i[r].id===t)return i[r]},t.prototype.cloneSubProcesses=function(e){var t=[],i={};if("Bpmn"===e.shape.type&&e.shape.activity&&e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length)for(var r=e.shape.activity.subProcess.processes,o=0;o<r.length;o++){for(var n=this.diagram.nameTable[r[o]]||this.clipboardData.processTable[r[o]],a=0,s=n.outEdges;a<s.length;a++){var h=s[a];t.indexOf(h)<0&&t.push(h)}for(var d=0,l=n.inEdges;d<l.length;d++){h=l[d];t.indexOf(h)<0&&t.push(h)}var c=Ah(this.clipboardData.processTable[r[o]]);c.processId=e.id;var p=this.cloneNode(c,!1);i[r[o]]=p.id,r[o]=p.id,this.diagram.addProcess(p,e.id);for(var g=0,u=t;g<u.length;g++){var f=u[g],m=Ah(this.diagram.nameTable[f]||this.diagram.connectorTable[f]);i[m.sourceID]&&i[m.targetID]&&(m.zIndex=-1,m.id+=xh(),m.sourceID=i[m.sourceID],m.targetID=i[m.targetID],t.splice(t.indexOf(f),1),this.diagram.add(m))}}},t.prototype.cloneGroup=function(t,r){var o,n=[],a=[],s=[],h=[];a=a.concat(t.children);var d=xh(),l=[];if(this.diagram.blazorActions|=e.BlazorAction.GroupClipboardInProcess,this.clipboardData.childTable||t.children.length>0)for(var c=0;c<a.length;c++){var p=void 0;(p=this.clipboardData.childTable?this.clipboardData.childTable[a[c]]:this.diagram.nameTable[a[c]]).parentId="",p&&(Ea(p)===wr?s.push(p):(o=this.cloneNode(p,r,void 0,d),h.push(p.id),n.push(o.id),l.push(o)))}for(var g=0;g<s.length;g++){if(s[g].sourceID||s[g].targetID)for(var u=0;u<h.length;u++)s[g].sourceID===h[u]&&(s[g].sourceID+=d),s[g].targetID===h[u]&&(s[g].targetID+=d);o=this.cloneConnector(s[g],r),n.push(o.id),l.push(o)}var f=this.cloneNode(t,r,n);return l.push(f),f&&f.container&&f.shape&&"UmlClassifier"===f.shape.type&&(this.diagram.updateDiagramObject(f),f.wrapper.measure(new i)),this.diagram.blazorActions&=~e.BlazorAction.GroupClipboardInProcess,this.diagram.isServerUpdate?this.cloneGroupChildCollection=l:this.diagram.UpdateBlazorDiagramModelCollection(void 0,l,void 0,!0),f},t.prototype.translateObject=function(e,t){e.id+=t||xh();var i=10*this.clipboardData.pasteIndex;if(Ea(e)===wr){if(e.sourcePoint={x:e.sourcePoint.x+i,y:e.sourcePoint.y+i},e.targetPoint={x:e.targetPoint.x+i,y:e.targetPoint.y+i},"Bezier"===e.type)for(var r=e.segments,o=0;o<r.length;o++)a.isEmptyPoint(r[o].point1)||(r[o].point1={x:r[o].point1.x+i,y:r[o].point1.y+i}),a.isEmptyPoint(r[o].point2)||(r[o].point2={x:r[o].point2.x+i,y:r[o].point2.y+i});if(("Straight"===e.type||"Bezier"===e.type)&&e.segments&&e.segments.length>0)for(r=e.segments,o=0;o<r.length-1;o++)r[o].point.x+=i,r[o].point.y+=i}else e.offsetX+=i,e.offsetY+=i},t.prototype.drawObject=function(e){var t,i;sf.base.isBlazor()&&(t=this.diagram.getProtectPropertyChangeValue(),this.diagram.protectPropertyChange(!0)),e&&e.shape&&"Text"===e.shape.type&&(e.width=this.diagram.drawingObject.width?this.diagram.drawingObject.width:50,e.height=this.diagram.drawingObject.height?this.diagram.drawingObject.height:20);for(var r=Ah(this.diagram.drawingObject),o=0,n=Object.keys(e);o<n.length;o++){var a=n[o];r[a]=e[a]}return Ea(this.diagram.drawingObject)===js?(i=new js(this.diagram,"nodes",r,!0)).id=(this.diagram.drawingObject.id||"node")+xh():(i=new wr(this.diagram,"connectors",r,!0)).id=(this.diagram.drawingObject.id||"connector")+xh(),sf.base.isBlazor()&&Ln(i,r,Ea(this.diagram.drawingObject)===js?this.diagram.nodeDefaults:this.diagram.connectorDefaults),this.diagram.initObject(i),this.diagram.updateDiagramObject(i),this.diagram.currentDrawingObject=i,sf.base.isBlazor()&&this.diagram.protectPropertyChange(t),i},t.prototype.addObjectToDiagram=function(t){this.diagram.removeFromAQuad(t),this.diagram.removeObjectsFromLayer(this.diagram.nameTable[t.id]),delete this.diagram.nameTable[t.id];var i=this.diagram.add(t);"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer(),this.selectObjects([i]),t&&!Zr(this.diagram)&&(this.diagram.tool&=~e.DiagramTools.DrawOnce,this.diagram.currentDrawingObject=void 0)},t.prototype.enableServerDataBinding=function(e){this.diagram.enableServerDataBinding(e)},t.prototype.addText=function(e,t){var i=this.diagram.findElementUnderMouse(e,t);this.diagram.startTextEdit(e,i instanceof Se?i.id.split("_")[1]:void 0)},t.prototype.updateArgsObject=function(e,t,i){if(e)for(var r=0;r<e.length;r++)Ea(e[r])===wr?i.connectorCollection.push(e[r].id):i.nodeCollection.push(e[r].id)},t.prototype.updateSelectionChangeEventArgs=function(e,t,i){if(sf.base.isBlazor()){var r=(e={cause:this.diagram.diagramActions,newValue:{},oldValue:{},state:e.state,type:e.type,cancel:!1}).oldValue,o=e.newValue;return r.connectors=[],r.nodes=[],o.connectors=[],o.nodes=[],r.nodeCollection=[],r.connectorCollection=[],o.nodeCollection=[],o.connectorCollection=[],this.updateArgsObject(this.getSelectedObject(),e,o),this.updateArgsObject(i,e,r),e}return e},t.prototype.isUserHandle=function(e){var t=this.diagram.selectedItems;if(t.wrapper&&ma(t.constraints,"UserHandle"))for(var i=0,r=t.userHandles;i<r.length;i++){var o=r[i];if(o.visible)if(Pd(e,ua(t,o,this.diagram.scroller.transform),o.size/(2*this.diagram.scroller.transform.scale)))return!0}return!1},t.prototype.selectObjects=function(t,i,r){return pl(this,void 0,void 0,(function(){var o,n,a,s,h,d,l,c,p,g;return gl(this,(function(u){switch(u.label){case 0:if(o={oldValue:r||this.getSelectedObject(),newValue:t,cause:this.diagram.diagramActions,state:"Changing",type:"Addition",cancel:!1},this.diagram.enableServerDataBinding(!1),!0,sf.base.isBlazor()?this.oldSelectedObjects=ka(this.diagram):this.diagram.triggerEvent(e.DiagramEvent.selectionChange,o),n=Gr(this.diagram),(a=Ur(this.diagram))||n){if(!n&&(t.length>1||i&&1===t.length)){if(1!==t.length)return[2];this.clearSelection()}if(!(a||1!==t.length||i&&Td(this.diagram)))return this.clearSelection(),[2]}if(o.cancel)return[3,5];for(g=0;g<t.length;g++)if(s=t[g])if(!0,Td(this.diagram)){if((g>0||i)&&s.children&&!s.parentId)for(h=0;h<this.diagram.selectedItems.nodes.length;h++)(d=this.diagram.nameTable[this.diagram.selectedItems.nodes[h].parentId])&&(d=this.findParent(d))&&s.id===d.id&&this.selectGroup(s);this.selectProcesses(s),this.selectBpmnSubProcesses(s)&&this.select(s,g>0||i,!0)}else this.select(s,g>0||i,!0);return o={oldValue:r||[],newValue:this.getSelectedObject(),cause:this.diagram.diagramActions,state:"Changed",type:"Addition",cancel:!1},this.diagram.renderSelector(i||t&&t.length>1),this.updateBlazorSelectorModel(r),sf.base.isBlazor()&&this.diagram.selectionChange&&(o=this.updateSelectionChangeEventArgs(o,t,r||[]),this.updateBlazorSelector()),sf.base.isBlazor()?[3,1]:(this.diagram.triggerEvent(e.DiagramEvent.selectionChange,o),[3,4]);case 1:return l=void 0,window&&window[this.blazor]&&this.diagram.selectionChange?(c={EventName:"selectionChange",args:JSON.stringify(o)},[4,window[this.blazorInterop].updateBlazorDiagramEvents(c,this.diagram)]):[3,3];case 2:l=u.sent(),u.label=3;case 3:if(l&&l.cancel&&(p=[],l.oldValue.nodes.length>0&&(p=l.oldValue.nodes),l.oldValue.connectors.length>0&&(p=p.concat(l.oldValue.connectors)),p))if(p.length>0)for(g=0;g<p.length;g++)this.select(this.diagram.nameTable[p[g].id],0!==g&&p.length>1);else this.clearSelection();u.label=4;case 4:this.diagram.enableServerDataBinding(!0),this.updateBlazorSelector(),u.label=5;case 5:return[2]}}))}))},t.prototype.updateBlazorSelector=function(){if(sf.base.isBlazor()&&this.oldSelectedObjects){this.newSelectedObjects=ka(this.diagram);var e=this.deepDiffer.map(Ah(this.newSelectedObjects),this.oldSelectedObjects),t=this.deepDiffer.frameObject({},e),i=this.deepDiffer.removeEmptyValues(t);i.nodes=[];for(var r=0;r<this.diagram.selectedItems.nodes.length;r++)i.nodes.push(this.diagram.selectedItems.nodes[r].id);i.connectors=[];for(r=0;r<this.diagram.selectedItems.connectors.length;r++)i.connectors.push(this.diagram.selectedItems.connectors[r].id);if(window&&window.Blazor){var o={methodName:"UpdateBlazorProperties",diagramobj:{selectedItems:i}};window.sfBlazor.updateBlazorProperties(o,this.diagram)}this.oldSelectedObjects=void 0,this.newSelectedObjects=void 0}},t.prototype.findParent=function(e){return e.parentId&&(e=this.diagram.nameTable[e.parentId],this.findParent(e)),e},t.prototype.selectProcesses=function(e){if(this.hasProcesses(e))for(var t=e.shape.activity.subProcess.processes,i=0;i<t.length;i++){var r=this.diagram.nameTable[t[i]];this.hasProcesses(r)&&this.selectObjects([r],!0),this.unSelect(r)}},t.prototype.selectGroup=function(e){for(var t=0;t<e.children.length;t++){var i=this.diagram.nameTable[e.children[t]];i.children&&this.selectGroup(i),this.unSelect(this.diagram.nameTable[e.children[t]])}},t.prototype.selectBpmnSubProcesses=function(e){var t,i=!0;if(e.processId)i=!zd(this.diagram,this.diagram.nameTable[e.processId])&&this.selectBpmnSubProcesses(this.diagram.nameTable[e.processId]);else if(e instanceof wr){if(e.sourceID&&this.diagram.nameTable[e.sourceID]&&this.diagram.nameTable[e.sourceID].processId&&(t=this.diagram.nameTable[e.sourceID].processId),e.targetID&&this.diagram.nameTable[e.targetID]&&this.diagram.nameTable[e.targetID].processId&&(t=this.diagram.nameTable[e.targetID].processId),t){if(zd(this.diagram,this.diagram.nameTable[t]))return!1;i=this.selectBpmnSubProcesses(this.diagram.nameTable[t])}}else e.parentId&&this.diagram.nameTable[e.parentId]&&"UmlClassifier"===this.diagram.nameTable[e.parentId].shape.type&&zd(this.diagram,this.diagram.nameTable[e.parentId])&&(i=!1);return i},t.prototype.hasProcesses=function(e){return!!(e&&"Bpmn"===e.shape.type&&e.shape.activity&&e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length>0)},t.prototype.select=function(e,t,i){var r=this.getObjectLayer(e.id);if(Dr(e)&&!(e instanceof Ys)&&!zd(this.diagram,e)&&r&&!r.lock&&r.visible&&e.wrapper.visible){(t=!!Td(this.diagram)&&t)||this.clearSelection(),this.diagram.enableServerDataBinding(!1);var o=this.diagram.selectedItems;if(e instanceof js)if(e.isHeader){var n=this.diagram.nameTable[e.parentId];o.nodes.push(n)}else o.nodes.push(e);else o.connectors.push(e);if(t)o.wrapper.rotateAngle=o.rotateAngle=0,o.wrapper.children.push(e.wrapper);else if(o.init(this.diagram),1===o.nodes.length&&0===o.connectors.length){var a=pn(this.diagram,o);a&&(o.wrapper.children[0]=a),o.rotateAngle=o.nodes[0].rotateAngle,o.wrapper.rotateAngle=o.nodes[0].rotateAngle,o.wrapper.pivot=o.nodes[0].pivot}i||this.diagram.renderSelector(t),this.diagram.enableServerDataBinding(!0)}},t.prototype.getObjectCollectionId=function(e,t){for(var i=[],r=0,o=e?this.diagram.selectedItems.nodes:this.diagram.selectedItems.connectors;!t&&r<o.length;)i[r]=o[r].id,r++;return i},t.prototype.updateBlazorSelectorModel=function(e,t){if(window&&window.sfBlazor){for(var i=0,r=[];e&&i<e.length;)r[i]=e[i].id,i++;i=0;var o=_a({nodes:this.getObjectCollectionId(!0,t),connectors:this.getObjectCollectionId(!1,t)});window.sfBlazor.updateDiagramCollection&&window.sfBlazor.updateDiagramCollection.call(this.diagram,"selectedItems",o,r,!1,!0)}},t.prototype.labelSelect=function(e,t){this.oldSelectedObjects=ka(this.diagram);var i=this.diagram.selectedItems,r=this.diagram.allowServerDataBinding;this.diagram.allowServerDataBinding=!1,i.nodes=i.connectors=[],this.diagram.allowServerDataBinding=r,e instanceof js?i.nodes[0]=e:i.connectors[0]=e,i.annotation=this.findTarget(t,e),i.init(this.diagram),this.diagram.renderSelector(!1),this.updateBlazorSelector()},t.prototype.unSelect=function(t){var i=[];i.push(t);var r={oldValue:i,newValue:[],cause:this.diagram.diagramActions,state:"Changing",type:"Removal",cancel:!1};if(this.diagram.currentSymbol||sf.base.isBlazor()||this.diagram.triggerEvent(e.DiagramEvent.selectionChange,r),zd(this.diagram,t)){var o=this.diagram.selectedItems,n=void 0;if(t instanceof js?(n=o.nodes.indexOf(t,0),o.nodes.splice(n,1)):(n=o.connectors.indexOf(t,0),o.connectors.splice(n,1)),r={oldValue:i,newValue:[],cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:!1},this.updateBlazorSelectorModel(i),!(r={oldValue:_a(i),newValue:[],cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:r.cancel}).cancel&&(n=o.wrapper.children.indexOf(t.wrapper,0),o.wrapper.children.splice(n,1),this.diagram.updateSelector(),!this.diagram.currentSymbol))if(sf.base.isBlazor()){if(r=this.updateSelectionChangeEventArgs(r,[],i),this.updateBlazorSelector(),window&&window[this.blazor]&&this.diagram.selectionChange){var a={EventName:"selectionChange",args:JSON.stringify(r)};window[this.blazorInterop].updateBlazorDiagramEvents(a,this.diagram)}}else this.diagram.triggerEvent(e.DiagramEvent.selectionChange,r)}},t.prototype.getChildElements=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];r.children&&r.children.length>0?t.concat(this.getChildElements(r.children)):(t.push(r.id),r instanceof Se&&t.push(r.id+"_text"))}return t},t.prototype.moveSvgNode=function(e,t){var i=Ks(t+"_groupElement",this.diagram.element.id),r=Ks(e+"_groupElement",this.diagram.element.id);i.parentNode.insertBefore(r,i)},t.prototype.sendLayerBackward=function(e){var t=this.getLayer(e);if(t&&0!==t.zIndex){var i=t.zIndex;if("SVG"===this.diagram.mode){var r=t.objects,o=this.getLayer(this.diagram.layerZIndexTable[i-1]).objects[0];if(o)for(var n=0,a=r;n<a.length;n++){var s=a[n];this.moveSvgNode(s,o)}}var h=this.getLayer(this.diagram.layerZIndexTable[i-1]);h.zIndex=h.zIndex+1,t.zIndex=t.zIndex-1;var d=this.diagram.layerZIndexTable[i];this.diagram.layerZIndexTable[i]=this.diagram.layerZIndexTable[i-1],this.diagram.layerZIndexTable[i-1]=d,"Canvas"===this.diagram.mode&&this.diagram.refreshDiagramLayer()}},t.prototype.bringLayerForward=function(e){var t=this.getLayer(e);if(t&&t.zIndex<this.diagram.layers.length-1){var i=t.zIndex,r=this.getLayer(this.diagram.layerZIndexTable[i+1]);if("SVG"===this.diagram.mode)for(var o=t.objects[0],n=0,a=r.objects;n<a.length;n++){var s=a[n];s&&this.moveSvgNode(s,o)}r.zIndex=r.zIndex-1,t.zIndex=t.zIndex+1;var h=this.diagram.layerZIndexTable[i];this.diagram.layerZIndexTable[i]=this.diagram.layerZIndexTable[i+1],this.diagram.layerZIndexTable[i+1]=h,"Canvas"===this.diagram.mode&&this.diagram.refreshDiagramLayer()}},t.prototype.sendToBack=function(t){if(this.diagram.protectPropertyChange(!0),Td(this.diagram)||t){var i=t&&t.id;i=i||(this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id);var r=this.diagram.nameTable[i].zIndex,o=this.diagram.layers.indexOf(this.getObjectLayer(i)),n=this.diagram.layers[o].zIndexTable,a=Ah(this.diagram.selectedItems);if(1!==this.diagram.nodes.length&&(void 0===this.diagram.nameTable[i].children||this.checkObjectBehind(i,n,r))){for(var s=r;s>0;s--)n[s]&&(n[s-1]?(n[s]=n[s-1],this.diagram.nameTable[n[s]].zIndex=s):(n[s-1]=n[s],this.diagram.nameTable[n[s-1]].zIndex=s,delete n[s]));if(n[0]=this.diagram.nameTable[i].id,this.diagram.nameTable[i].zIndex=0,"SVG"===this.diagram.mode){var h=n[s=1];for(h=this.resetTargetNode(i,h,s,n);!h&&s<r;)h=n[++s];h=this.diagram.nameTable[h].parentId?this.checkParentExist(h):h,this.moveSvgNode(i,h),this.updateNativeNodeIndex(i)}else this.diagram.refreshCanvasLayers();var d={type:"SendToBack",category:"Internal",undoObject:a,redoObject:Ah(this.diagram.selectedItems)};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(d)}}this.diagram.protectPropertyChange(!1),sf.base.isBlazor()&&this.getZIndexObjects()},t.prototype.resetTargetNode=function(e,t,i,r){return"SwimLane"===this.diagram.nameTable[e].shape.type&&null!=this.diagram.nameTable[t].parentId&&""!=this.diagram.nameTable[t].parentId&&this.diagram.nameTable[this.diagram.nameTable[t].parentId].isLane?(t=r[i+=1],this.resetTargetNode(e,t,i,r)):t},t.prototype.getZIndexObjects=function(){var e,t,i=[];for(e=0;e<this.diagram.nodes.length;e++)i.push(this.diagram.nodes[e]);for(t=0;t<this.diagram.connectors.length;t++)i.push(this.diagram.connectors[t]);this.updateBlazorZIndex(i)},t.prototype.updateBlazorZIndex=function(e){var t,i,r=[],o=[];if(e&&e.length>0)for(i=0;i<e.length;i++){var n=e[i];n instanceof js?r.push(this.getBlazorObject(n)):n instanceof wr&&o.push(this.getBlazorObject(n))}if(t={nodes:r,connectors:o},window&&window.Blazor){var a={methodName:"UpdateBlazorProperties",diagramobj:t};window.sfBlazor.updateBlazorProperties(a,this.diagram)}},t.prototype.getBlazorObject=function(e){return{sfIndex:Ch(this.diagram,e.id),zIndex:e.zIndex}},t.prototype.checkParentExist=function(e){for(var t=e;this.diagram.nameTable[t].parentId;)t=this.diagram.nameTable[t].parentId;return t},t.prototype.checkObjectBehind=function(e,t,i){for(var r=0;r<i;r++){var o=t[r];if(e!==this.diagram.nameTable[o].parentId)return!0}return!1},t.prototype.bringToFront=function(t){if(this.diagram.protectPropertyChange(!0),Td(this.diagram)||t){var i=t&&t.id;i=i||(this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id);for(var r=this.diagram.layers.indexOf(this.getObjectLayer(i)),o=this.diagram.layers[r].zIndexTable,n=Ah(this.diagram.selectedItems),a=Number(Object.keys(o).sort((function(e,t){return Number(e)-Number(t)})).reverse()[0]),s=this.diagram.nameTable[i].zIndex,h=[],d=0;d<=a;d++)h.push(o[d]);for(d=s;d<a;d++)o[d]&&(o[d+1]?(o[d]=o[d+1],this.diagram.nameTable[o[d]].zIndex=d):(o[d+1]=o[d],this.diagram.nameTable[o[d+1]].zIndex=d,delete o[d]));if(o[a]=this.diagram.nameTable[i].id,this.diagram.nameTable[i].zIndex=a,"SVG"===this.diagram.mode){var l=this.diagram.diagramLayer,c=Ks(i+"_groupElement",this.diagram.element.id),p=this.diagram.selectedItems.nodes;if(p.length>0&&("Native"===p[0].shape.type||"HTML"===p[0].shape.type)){c.parentNode.removeChild(c);for(var g=0;g<this.diagram.views.length;g++){var u=(c=Ks(i+("HTML"===p[0].shape.type?"_html_element":"_content_groupElement"),this.diagram.views[g])).parentNode.lastChild;u.parentNode.insertBefore(c,u.nextSibling)}var f=sh(this.diagram.element.id);this.diagram.diagramRenderer.renderElement(this.diagram.nameTable[i].wrapper,l,f)}else{var m=this.getObjectLayer(i);for(d=0;d<m.objects.length;d++)m.objects[d]!==i&&this.diagram.nameTable[m.objects[d]].parentId!==i&&void 0!==m.objects[d]&&h.indexOf(i)<h.indexOf(m.objects[d])&&(""===this.diagram.nameTable[i].parentId&&""===this.diagram.nameTable[m.objects[d]].parentId&&void 0===this.diagram.nameTable[m.objects[d]].parentId&&this.diagram.nameTable[i].parentId!==this.diagram.nameTable[m.objects[d]].id||this.checkGroupNode(i,m.objects[d],this.diagram.nameTable))&&(this.moveSvgNode(m.objects[d],i),this.updateNativeNodeIndex(i))}}else this.diagram.refreshCanvasLayers();var y={type:"BringToFront",category:"Internal",undoObject:n,redoObject:Ah(this.diagram.selectedItems)};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(y)}this.diagram.protectPropertyChange(!1),sf.base.isBlazor()&&this.getZIndexObjects()},t.prototype.checkGroupNode=function(e,t,i){return i[t].parentId===i[e].parentId},t.prototype.sortByZIndex=function(e,t){var i=t||"zIndex";return e=e.sort((function(e,t){return e[i]-t[i]}))},t.prototype.orderCommands=function(e,t,i){var r=t.nodes;if(r=r.concat(t.connectors),e)"SendBackward"===i?this.sendBackward(r[0]):"SendForward"===i?this.sendForward(r[0]):"BringToFront"===i?this.bringToFront(r[0]):"SendToBack"===i&&this.sendToBack(r[0]);else{var o=r[0].zIndex,n=this.diagram.nameTable[r[0].id].zIndex,a=r[0],s=this.getObjectLayer(a.id),h=s.zIndex,d=s.zIndexTable;if("SendBackward"===i||"SendForward"===i)for(var l=0;l<r.length;l++){var c=r[l],p=this.diagram.layers.indexOf(this.getObjectLayer(c.id));this.diagram.nameTable[r[l].id].zIndex=c.zIndex,this.diagram.layers[p].zIndexTable[c.zIndex]=c.id}else if("BringToFront"===i)for(var g=n;g>o;g--)d[g]&&(d[g-1]?(d[g]=d[g-1],this.diagram.nameTable[d[g]].zIndex=g):(d[g-1]=d[g],this.diagram.nameTable[d[g-1]].zIndex=g,delete d[g]));else if("SendToBack"===i)for(g=n;g<o;g++)d[g]&&(d[g+1]?(d[g]=d[g+1],this.diagram.nameTable[d[g]].zIndex=g):(d[g+1]=d[g],this.diagram.nameTable[d[g+1]].zIndex=g,delete d[g]));if("BringToFront"===i||"SendToBack"===i)this.diagram.nameTable[r[0].id].zIndex=a.zIndex,this.diagram.layers[h].zIndexTable[a.zIndex]=a.id;if("SVG"===this.diagram.mode){if("SendBackward"===i)this.moveObject(r[1].id,r[0].id);else if("SendForward"===i)this.moveObject(r[0].id,r[1].id);else if("BringToFront"===i)this.moveObject(r[0].id,d[r[0].zIndex+1]);else if("SendToBack"===i){var u=this.getObjectLayer(r[0].id);for(l=0;l<=r[0].zIndex;l++)u.objects[l]!==r[0].id&&(this.moveSvgNode(u.objects[l],r[0].id),this.updateNativeNodeIndex(r[0].id))}}else this.diagram.refreshCanvasLayers()}},t.prototype.moveObject=function(e,t){t&&(this.moveSvgNode(e,t),this.updateNativeNodeIndex(e,t))},t.prototype.sendForward=function(t){if(this.diagram.protectPropertyChange(!0),Td(this.diagram)||t){var i=t&&t.id;i=i||(this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id);var r=this.diagram.layers.indexOf(this.getObjectLayer(i)),o=this.diagram.layers[r].zIndexTable,n=this.diagram.nameTable[i],a=[],s=this.diagram.spatialSearch.findObjects(n.wrapper.bounds);s.length>2&&(s=this.sortByZIndex(s));for(var h=0,d=s;h<d.length;h++){var l=d[h];if(n.id!==l.id)if(r===this.getObjectLayer(l.id).zIndex&&Number(this.diagram.nameTable[i].zIndex)<Number(l.zIndex)&&n.wrapper.bounds.intersects(l.wrapper.bounds)){a.push(l);break}}if(a.length>0){var c=a[0].zIndex,p=n.zIndex,g=o[c],u=Ah(this.diagram.selectedItems);this.diagram.nameTable[g]instanceof js?u.nodes.push(Ah(this.diagram.nameTable[g])):u.connectors.push(Ah(this.diagram.nameTable[g])),this.diagram.layers[0].zIndexTable[c]=n.id,this.diagram.nameTable[o[c]].zIndex=c,this.diagram.layers[0].zIndexTable[p]=a[0].id,this.diagram.nameTable[o[p]].zIndex=p,"SVG"===this.diagram.mode?(this.moveSvgNode(o[Number(a[0].zIndex)],i),this.updateNativeNodeIndex(o[Number(a[0].zIndex)],i)):this.diagram.refreshCanvasLayers();var f=Ah(this.diagram.selectedItems);this.diagram.nameTable[g]instanceof js?f.nodes.push(Ah(this.diagram.nameTable[g])):f.connectors.push(Ah(this.diagram.nameTable[g]));var m={type:"SendForward",category:"Internal",undoObject:u,redoObject:f};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(m)}if(sf.base.isBlazor()){var y=[];y.push(n),y.push(a[a.length-1]),this.updateBlazorZIndex(y)}}this.diagram.protectPropertyChange(!1)},t.prototype.sendBackward=function(t){if(this.diagram.protectPropertyChange(!0),Td(this.diagram)||t){var i=t&&t.id;i=i||(this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes[0].id:this.diagram.selectedItems.connectors[0].id);var r=this.diagram.layers.indexOf(this.getObjectLayer(i)),o=this.diagram.layers[r].zIndexTable,n=this.diagram.nameTable[i],a=[],s=this.diagram.spatialSearch.findObjects(n.wrapper.bounds);s.length>2&&(s=this.sortByZIndex(s));for(var h=0,d=s;h<d.length;h++){var l=d[h];if(n.id!==l.id)r===this.getObjectLayer(l.id).zIndex&&Number(this.diagram.nameTable[i].zIndex)>Number(l.zIndex)&&n.wrapper.bounds.intersects(l.wrapper.bounds)&&a.push(l)}if(a.length>0){var c=a[a.length-1].zIndex,p=n.zIndex,g=o[c],u=Ah(this.diagram.selectedItems);if(this.diagram.nameTable[g]instanceof js?u.nodes.push(Ah(this.diagram.nameTable[g])):u.connectors.push(Ah(this.diagram.nameTable[g])),o[c]=n.id,this.diagram.nameTable[o[c]].zIndex=c,o[p]=a[a.length-1].id,this.diagram.nameTable[o[p]].zIndex=p,"SVG"===this.diagram.mode){if(!(n.children&&n.children.length>0)&&(this.moveSvgNode(i,o[a[a.length-1].zIndex]),this.updateNativeNodeIndex(i,o[a[a.length-1].zIndex]),sf.base.isBlazor())){var f=[];f.push(n),f.push(a[a.length-1]),this.updateBlazorZIndex(f)}}else this.diagram.refreshCanvasLayers();var m=Ah(this.diagram.selectedItems);this.diagram.nameTable[g]instanceof js?m.nodes.push(Ah(this.diagram.nameTable[g])):m.connectors.push(Ah(this.diagram.nameTable[g]));var y={type:"SendBackward",category:"Internal",undoObject:u,redoObject:m};this.diagram.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(y)}}this.diagram.protectPropertyChange(!1)},t.prototype.updateNativeNodeIndex=function(e,t){for(var i=this.diagram.selectedItems.nodes[0]||this.diagram.getObject(t),r=0;r<this.diagram.views.length;r++)if(i&&("HTML"===i.shape.type||"Native"===i.shape.type)){var o="HTML"===i.shape.type?"_html_element":"_content_groupElement",n=Ks(e+o,this.diagram.views[r]),a=t?Ks(t+o,this.diagram.views[r]):n.parentElement.firstChild;n.parentNode.id===a.parentNode.id&&a.parentNode.insertBefore(n,a)}},t.prototype.initSelectorWrapper=function(){var e=this.diagram.selectedItems;e.init(this.diagram),1===e.nodes.length&&0===e.connectors.length&&(e.rotateAngle=e.nodes[0].rotateAngle,e.wrapper.rotateAngle=e.nodes[0].rotateAngle,e.wrapper.pivot=e.nodes[0].pivot)},t.prototype.doRubberBandSelection=function(e){this.clearSelectionRectangle();var t=[],i=[];t=this.diagram.getNodesConnectors(t),(i="CompleteIntersect"===this.diagram.selectedItems.rubberBandSelectionMode?xn(e,t):this.diagram.spatialSearch.findObjects(e)).length&&this.selectObjects(i,!0)},t.prototype.clearSelectionRectangle=function(){var e=Js(this.diagram.element.id).getElementById(this.diagram.element.id+"_diagramAdorner_selected_region");e&&sf.base.remove(e)},t.prototype.dragConnectorEnds=function(e,t,i,r,o,n){var a,s,h,d=!1;return t instanceof Ys?a=t.connectors[0]:t instanceof wr&&this.diagram.currentDrawingObject&&(this.clearSelection(),a=this.diagram.currentDrawingObject),"BezierSourceThumb"!==e&&"BezierTargetThumb"!==e||(d=!0),"ConnectorSourceEnd"===e||"BezierSourceThumb"===e?(s=i.x-(d?r.bezierPoint1.x:a.sourcePoint.x),h=i.y-(d?r.bezierPoint1.y:a.sourcePoint.y),this.dragSourceEnd(a,s,h,null,i,e,void 0,o,n,void 0,r)):(s=i.x-(d?r.bezierPoint2.x:a.targetPoint.x),h=i.y-(d?r.bezierPoint2.y:a.targetPoint.y),this.dragTargetEnd(a,s,h,null,i,e,void 0,r))},t.prototype.getSelectedObject=function(){var e=this.diagram.selectedItems;return e.nodes.concat(e.connectors)},t.prototype.updateBlazorProperties=function(e){if(e){if(window&&window.Blazor&&"{}"!==JSON.stringify(this.deepDiffer.diagramObject)){t={methodName:"UpdateBlazorProperties",diagramobj:this.deepDiffer.diagramObject};this.diagram.isLoading||window.sfBlazor.updateBlazorProperties(t,this.diagram)}}else if(window&&window.Blazor){var t={methodName:"UpdateBlazorProperties",diagramobj:this.diagramObject};window.sfBlazor.updateBlazorProperties(t,this.diagram)}this.deepDiffer.newNodeObject=[],this.deepDiffer.newConnectorObject=[],this.diagramObject=[],this.diagram.oldNodeObjects=[],this.diagram.oldConnectorObjects=[]},t.prototype.enableCloneObject=function(t){this.diagram.lineRoutingModule&&this.diagram.constraints&e.DiagramConstraints.LineRouting||(this.diagram.canEnableBlazorObject=t)},t.prototype.ismouseEvents=function(t){this.diagram.blazorActions=t?this.diagram.addConstraints(this.diagram.blazorActions,e.BlazorAction.interaction):this.diagram.removeConstraints(this.diagram.blazorActions,e.BlazorAction.interaction)},t.prototype.updateLayerObject=function(e,t){if(sf.base.isBlazor()){var i;i=this.deepDiffer.getLayerObject(e,t,this.diagram),this.diagramObject=i,this.updateBlazorProperties()}},t.prototype.getDiagramOldValues=function(t,i){for(var r={},o=0;o<i.length;o++)r[i[o]]=Ah(this.diagram[i[o]]);var n=Ah(r),a=this.deepDiffer.map(n,t),s=this.deepDiffer.frameObject({},a),h=this.deepDiffer.removeEmptyValues(s);h=this.deepDiffer.changeSegments(h,n),this.diagramObject=h,this.diagram.blazorActions&e.BlazorAction.ClearObject||this.updateBlazorProperties()},t.prototype.getBlazorOldValues=function(e,t){if(sf.base.isBlazor()){for(var i=this.diagram.oldNodeObjects,r=0;r<i.length;r++)i[r].id&&(this.diagram.oldNodeObjects[r]instanceof js&&(this.diagram.oldNodeObjects[r]=_a(this.diagram.oldNodeObjects[r])),this.deepDiffer.getDifferenceValues(this.diagram.nameTable[i[r].id],e,t,this.diagram));var o=this.diagram.oldConnectorObjects;for(r=0;r<o.length;r++)o[r].id&&(this.diagram.oldConnectorObjects[r]instanceof wr&&(this.diagram.oldConnectorObjects[r]=_a(this.diagram.oldConnectorObjects[r])),this.deepDiffer.getDifferenceValues(this.diagram.nameTable[o[r].id],e,t,this.diagram));(i.length>0||o.length>0)&&this.updateBlazorProperties(!0)}},t.prototype.getObjectChanges=function(e,t,i){for(var r=0;r<e.length;r++){var o=this.deepDiffer.map(t[r],e[r]),n=this.deepDiffer.frameObject({},o),a=this.deepDiffer.removeEmptyValues(n);a.children&&(a.children=Ah(t[r]).children),(a=this.deepDiffer.changeSegments(a,t[r])).sfIndex=Ch(this.diagram,t[r].id),i.push(a)}},t.prototype.clearObjectSelection=function(e){var t=this.diagram.selectedItems,i=[];-1===(i=i.concat(t.nodes,t.connectors)).indexOf(e)&&(this.clearSelection(i.length>0),this.selectObjects([e],!0))},t.prototype.clearSelection=function(t,i){return pl(this,void 0,void 0,(function(){var r,o,n,a,s,h,d,l;return gl(this,(function(c){switch(c.label){case 0:return r=this.diagram.allowServerDataBinding,this.diagram.enableServerDataBinding(!1),Td(this.diagram)?(o=this.diagram.selectedItems,n=this.getSelectedObject(),this.diagram.currentSymbol&&(this.diagram.previousSelectedObject=n),a={oldValue:n,newValue:[],cause:this.diagram.diagramActions,state:"Changing",type:"Removal",cancel:!1},this.updateBlazorSelectorModel(n,!0),t&&(sf.base.isBlazor()?this.oldSelectedObjects=Ah(o):this.diagram.triggerEvent(e.DiagramEvent.selectionChange,a)),a.cancel?[3,4]:(o.offsetX=0,o.offsetY=0,o.width=0,o.height=0,o.rotateAngle=0,o.nodes=[],o.connectors=[],o.wrapper=null,o.annotation=void 0,this.diagram.clearSelectorLayer(),t?(a={oldValue:_a(n),newValue:[],cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:!1},sf.base.isBlazor()&&(a=this.updateSelectionChangeEventArgs(a,[],n),this.updateBlazorSelector()),sf.base.isBlazor()?[3,1]:(this.diagram.triggerEvent(e.DiagramEvent.selectionChange,a),[3,4])):[3,4])):[3,5];case 1:return s=void 0,window&&window[this.blazor]&&this.diagram.selectionChange?(h={EventName:"selectionChange",args:JSON.stringify(a)},[4,window[this.blazorInterop].updateBlazorDiagramEvents(h,this.diagram)]):[3,3];case 2:s=c.sent(),c.label=3;case 3:if(s&&s.cancel&&!i&&(d=[],s.oldValue.nodes.length>0&&(d=s.oldValue.nodes),s.oldValue.connectors.length>0&&(d=d.concat(s.oldValue.connectors)),d))for(l=0;l<d.length;l++)this.select(this.diagram.nameTable[d[l].id],0!==l&&d.length>1);c.label=4;case 4:this.updateBlazorSelector(),this.diagram.enableServerDataBinding(r),c.label=5;case 5:return[2]}}))}))},t.prototype.clearSelectedItems=function(){var e=this.diagram.selectedItems.nodes?this.diagram.selectedItems.nodes.length:0,t=this.diagram.selectedItems.connectors?this.diagram.selectedItems.connectors.length:0;this.clearSelection(e+t>0)},t.prototype.removeStackHighlighter=function(){var e=Js(this.diagram.element.id),t=e.getElementById(e.id+"_stack_highlighter");t&&t.parentNode.removeChild(t)},t.prototype.renderStackHighlighter=function(e,t){var i,r,o,n=this.diagram.selectedItems.nodes[0];if(!t){var a=this.diagram.findObjectsUnderMouse(e.position);if((t=this.diagram.findObjectUnderMouse(a,"Drag",!0))&&!(t.isLane||t.isPhase||t.isHeader))for(var s=0;s<a.length;s++){var h=this.diagram.nameTable[a[s].id];(h.isLane||h.isPhase||h.isHeader)&&(t=h,this.diagram.parentObject=t)}}n&&t&&t.isLane&&n.shape&&!n.shape.isPhase&&(r=this.diagram.nameTable[t.parentId],this.diagram.currentSymbol&&"SwimLane"===r.shape.type&&(i=!0),(n&&!n.parentId&&"SwimLane"!==n.shape.type||n&&n.parentId&&this.diagram.nameTable[n.parentId]&&this.diagram.nameTable[n.parentId].isLane&&n.parentId!==t.parentId&&n.parentId!==t.id)&&(o=this.diagram.selectedItems,(d=pn(this.diagram,o,t.id,!0))&&(o.wrapper.children[0]=d),this.diagram.renderSelector(!1,!0),o.wrapper.children[0]=o.nodes[0].wrapper));n&&t&&t.parentId&&n.shape&&n.shape.isPhase&&("SwimLane"===this.diagram.nameTable[t.parentId].shape.type&&(this.diagram.selectedItems.wrapper.children[0]=this.diagram.nameTable[t.parentId].wrapper,this.diagram.renderSelector(!1,!0)));if(i&&this.diagram.currentSymbol.shape.isLane||n&&t&&n.parentId&&t.parentId&&!n.isPhase&&n.parentId===t.parentId&&n.id!==t.id&&r&&r.container&&("Stack"===r.container.type||"Grid"===r.container.type)){var d=void 0,l="Vertical"===r.container.orientation,c="Stack"===r.container?l:!l;"Grid"===r.container.type&&t.isLane&&(!this.diagram.currentSymbol&&"Horizontal"===r.shape.orientation&&t.rowIndex!==n.rowIndex||"Vertical"===r.shape.orientation&&t.columnIndex!==n.columnIndex||this.diagram.currentSymbol&&this.diagram.currentSymbol.shape.orientation===r.container.orientation)&&(o=this.diagram.selectedItems,(n.isLane&&wn(n,this.diagram)||!n.isLane)&&(d=pn(this.diagram,o,t.id,i)));var p="Stack"===r.container.type?t.wrapper:d;p&&No(p,c,e.position,this.diagram,!1,!0)}},t.prototype.insertBlazorConnector=function(e){if(e instanceof Ys)for(var t=0;t<e.connectors.length;t++)this.diagram.insertBlazorConnector(e.connectors[t]);else this.diagram.insertBlazorConnector(e)},t.prototype.drag=function(t,i,r){var o;if(Er(t)&&this.checkBoundaryConstraints(i,r,t.wrapper.bounds)&&$r(this.diagram))if(t instanceof js){var n={offsetX:t.offsetX,offsetY:t.offsetY};if(t.offsetX+=i,t.offsetY+=r,t.children&&!t.container){Eo(this.diagram,t,!0)||(this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.isGroupDragging);for(var a=this.getAllDescendants(t,[]),s=0;s<a.length;s++)o=this.diagram.nameTable[a[s].id],this.drag(o,i,r);this.updateInnerParentProperties(t),this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.isGroupDragging}if(Eo(this.diagram,t,!0)?Bo(this.diagram,t):(t&&t.shape&&"UmlClassifier"===t.shape.type&&(t.wrapper.measureChildren=!0),this.diagram.nodePropertyChange(t,n,{offsetX:t.offsetX,offsetY:t.offsetY},void 0,void 0,!1),t.wrapper.measureChildren=!1),"SwimLane"===t.shape.type&&!this.diagram.currentSymbol){var h=t.wrapper.children[0];Jo(Uo(this.diagram,h),this.diagram)}}else{var d=t,l=(n={sourcePoint:d.sourcePoint,targetPoint:d.targetPoint},"Bezier"===d.type),c=!1;d.sourceWrapper?c=!0:this.dragSourceEnd(d,i,r,!0,null,"",l),d.targetWrapper?c=!0:this.dragTargetEnd(d,i,r,!0,null,"",l);var p=!1;for(s=0;s<this.diagram.selectedItems.connectors.length;s++)this.diagram.selectedItems.connectors[s].id===t.id&&(p=!0);if(!c||p){this.dragControlPoint(d,i,r,!0);var g={sourcePoint:d.sourcePoint,targetPoint:d.targetPoint};this.diagram.connectorPropertyChange(d,n,g)}}},t.prototype.connectorSegmentChange=function(t,i,r){var o,n,s=!0;if(!1===i.equals(i,t.wrapper.bounds)&&t.outEdges.length>0)for(var h=0;h<t.outEdges.length;h++){var d=this.diagram.nameTable[t.outEdges[h]];if(s=""!==d.targetID?!this.isSelected(this.diagram.nameTable[d.targetID]):!this.isSelected(this.diagram.nameTable[d.id]),"Orthogonal"===d.type&&d.segments&&d.segments.length>1)if(r){var l=d.segments[0],c=d.segments[1],p=At(mt(t.wrapper,t.wrapper.corners,t.wrapper.bounds),l.direction),g=Mt({corners:void 0,point:p=Ot(d,d.sourceWrapper,p,{x:d.sourceWrapper.offsetX,y:d.sourceWrapper.offsetY},!1),margin:void 0,direction:l.direction},{corners:void 0,point:c.points[1],margin:void 0,direction:void 0});l.length=a.distancePoints(g[0],g[1]),c.direction&&c.length&&(c.length=a.distancePoints(g[1],g[2]))}else if(s){switch(d.segments[0].direction){case"Bottom":o=t.wrapper.bounds.bottomCenter.x-i.bottomCenter.x,n=t.wrapper.bounds.bottomCenter.y-i.bottomCenter.y;break;case"Top":o=t.wrapper.bounds.topCenter.x-i.topCenter.x,n=t.wrapper.bounds.topCenter.y-i.topCenter.y;break;case"Left":o=t.wrapper.bounds.middleLeft.x-i.middleLeft.x,n=t.wrapper.bounds.middleLeft.y-i.middleLeft.y;break;case"Right":o=t.wrapper.bounds.middleRight.x-i.middleRight.x,n=t.wrapper.bounds.middleRight.y-i.middleRight.y}this.dragSourceEnd(d,o,n,!0,null,"ConnectorSourceEnd",void 0,void 0,void 0,!(t.parentId&&this.diagram.diagramActions&e.DiagramAction.isGroupDragging))}}},t.prototype.updateEndPoint=function(e,t){e.sourcePoint,e.targetPoint,e.sourceID&&e.sourceID,e.targetID&&e.targetID,e.sourcePortID&&e.sourcePortID,e.targetPortID&&e.targetPortID,e.segments&&e.segments;var i={sourcePoint:e.sourcePoint,targetPoint:e.targetPoint};e.sourceID&&(i.sourceID=e.sourceID),e.targetID&&(i.targetID=e.targetID),e.sourcePortID&&(i.sourcePortID=e.sourcePortID),e.targetPortID&&(i.targetPortID=e.targetPortID),e.segments&&(i.segments=e.segments),this.diagram.connectorPropertyChange(e,t||{},i),this.diagram.updateSelector()},t.prototype.dragSourceEnd=function(t,i,r,o,n,a,s,h,d,l,c){var p=this.diagram.nameTable[t.id],g={},u=this.checkBoundaryConstraints(i,r,p.wrapper.bounds);if(Lr(p)&&u&&"BezierSourceThumb"!==a&&$r(this.diagram)&&(g={sourcePoint:p.sourcePoint},p.sourcePoint.x+=i,p.sourcePoint.y+=r,"ConnectorSourceEnd"===a&&"Orthogonal"===p.type&&this.changeSegmentLength(p,h,d,l),"Bpmn"===p.shape.type&&"Default"===p.shape.sequence&&this.updatePathElementOffset(p)),"Bezier"===p.type)if(g={sourcePoint:p.sourcePoint},c)this.translateBezierPoints(t,""===a?"ConnectorSourceEnd":a,i,r,c,n,!s);else for(var f=0;f<t.segments.length;f++)this.translateBezierPoints(t,""===a?"ConnectorSourceEnd":a,i,r,t.segments[f],n,!s);return o||this.updateEndPoint(p,g),this.diagram.realActions&e.RealAction.AnimationClick||this.diagram.refreshCanvasLayers(),u},t.prototype.updatePathElementOffset=function(e){e.wrapper.children.splice(3,1);var t=new Me,i=e.intermediatePoints;t=Ra(i,e),e.wrapper.children.splice(3,0,t)},t.prototype.changeSegmentLength=function(e,t,i,r){if(e.segments&&null!==e.segments[0].direction&&(!t&&""===e.sourceID||r)){var o=e.segments[0],n=e.segments[1],s=this.diagram.nameTable[e.sourceID],h=void 0;if(o.points[0]=e.sourcePoint,"Top"===o.direction||"Bottom"===o.direction?(o.points[o.points.length-1].x=e.sourcePoint.x,n.points[0].y=o.points[o.points.length-1].y):(o.points[o.points.length-1].y=e.sourcePoint.y,n.points[0].x=o.points[o.points.length-1].x),o.direction&&(o.length||0===o.length)&&(o.length=a.distancePoints(o.points[0],o.points[o.points.length-1])),n.direction&&(n.length||0===n.length)&&(n.length=a.distancePoints(o.points[o.points.length-1],n.points[n.points.length-1]),n.direction=a.direction(o.points[o.points.length-1],n.points[n.points.length-1])),""!==e.sourcePortID&&o.length<10)if(e.segments.length>2){var d=e.segments[2],l=a.direction(d.points[0],d.points[1]);o.direction===_t(l)?("Right"===o.direction?d.points[0].x=o.points[o.points.length-1].x=s.wrapper.corners.middleRight.x+20:"Left"===o.direction?d.points[0].x=o.points[o.points.length-1].x=s.wrapper.corners.middleLeft.x-20:"Top"===o.direction?d.points[0].y=o.points[o.points.length-1].y=s.wrapper.corners.topCenter.y-20:d.points[0].y=o.points[o.points.length-1].y=s.wrapper.corners.bottomCenter.y+20,d.direction&&d.length&&(d.length=a.distancePoints(d.points[0],d.points[d.points.length-1])),o.length=a.distancePoints(o.points[0],o.points[o.points.length-1])):o.direction===l&&d.direction&&d.length?("Top"===o.direction||"Bottom"===o.direction?(d.points[0]=o.points[0],d.points[d.points.length-1].x=d.points[0].x):(d.points[0]=o.points[0],d.points[d.points.length-1].y=d.points[0].y),d.length=a.distancePoints(d.points[0],d.points[d.points.length-1]),e.segments.splice(0,2)):o.length=20}else o.length=20;else if(o.length<1)if(""!==e.sourceID){if("Right"===n.direction?(h=s.wrapper.corners.middleRight,n.points[n.points.length-1].y=h.y):"Left"===n.direction?(h=s.wrapper.corners.middleLeft,n.points[n.points.length-1].y=h.y):"Top"===n.direction?(h=s.wrapper.corners.topCenter,n.points[n.points.length-1].x=h.x):(h=s.wrapper.corners.bottomCenter,n.points[n.points.length-1].x=h.x),n.length=a.distancePoints(h,n.points[n.points.length-1]),e.segments.length>2)(d=e.segments[2]).direction&&d.length&&(d.length=a.distancePoints(n.points[n.points.length-1],d.points[d.points.length-1]));e.segments.splice(0,1)}else e.segments.splice(0,1)}else t&&!i&&e.sourceID!==t.id&&e.segments&&null!==e.segments[0].direction&&t&&t instanceof js&&this.changeSourceEndToNode(e,t),t&&i&&e.sourcePortID!==i&&e.segments&&null!==e.segments[0].direction&&t&&t instanceof js&&this.changeSourceEndToPort(e,t,i)},t.prototype.changeSourceEndToPort=function(e,t,i){var r=this.diagram.getWrapper(t.wrapper,i),o={x:r.offsetX,y:r.offsetY},n=Ht(o,Ph(t.wrapper),t.wrapper.bounds),s=e.segments[0],h=e.segments[1];if(s.direction!==n){var d=[],l={};if(s.direction===_t(n)){l={};var c=void 0;"Top"===n||"Bottom"===n?(c="Top"===n?{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(s.points[0].y-o.y)}:{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(o.y-s.points[0].y)},l=s.points[0].x>o.x?{type:"Orthogonal",isTerminal:!0,direction:"Right",length:s.points[0].x-o.x}:{type:"Orthogonal",isTerminal:!0,direction:"Left",length:o.x-s.points[0].x}):(c="Right"===n?{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(s.points[0].x-o.x)}:{type:"Orthogonal",isTerminal:!0,direction:n,length:Math.abs(o.x-s.points[0].x)},l=s.points[0].y>o.y?{type:"Orthogonal",direction:"Top",isTerminal:!0,length:s.points[0].y-o.y}:{type:"Orthogonal",direction:"Bottom",isTerminal:!0,length:o.y-s.points[0].y}),d.push(new hr(e,"segments",c,!0)),d.push(new hr(e,"segments",l,!0))}else l={type:"Orthogonal",direction:n,length:20,isTerminal:!0},d.push(new hr(e,"segments",l,!0));s.direction!==_t(n)&&("Top"===n||"Bottom"===n?(s.points[0].x=o.x,s.points[0].y=s.points[s.points.length-1].y="Top"===n?o.y-20:o.y+20):(s.points[0].y=o.y,s.points[0].x=s.points[s.points.length-1].x="Right"===n?o.x+20:o.x-20),s.length=a.distancePoints(s.points[0],s.points[s.points.length-1]),h.length=a.distancePoints(s.points[s.points.length-1],h.points[h.points.length-1])),e.segments=d.concat(e.segments)}else s.points[0]=o,"Top"===n||"Bottom"===n?s.points[s.points.length-1].x=o.x:s.points[s.points.length-1].y=o.y,s.length=a.distancePoints(s.points[0],s.points[s.points.length-1]),h.length=a.distancePoints(s.points[s.points.length-1],h.points[h.points.length-1])},t.prototype.removeTerminalSegment=function(e,t){for(var i=0;i<e.segments.length-2;i++){var r=e.segments[0];r.isTerminal&&(t?r.isTerminal=!1:(e.segments.splice(i,1),i--))}},t.prototype.changeSourceEndToNode=function(e,t){this.removeTerminalSegment(e);var i,r,o=t.wrapper.children[0].corners,n=e.segments[0],s=e.segments[1],h=[];if("Right"===n.direction||"Left"===n.direction)if(i="Left"===n.direction?o.middleLeft:o.middleRight,n.length>o.width||"Left"===n.direction&&i.x>=n.points[0].x||"Right"===n.direction&&i.x<=n.points[0].x)n.points[0].y=n.points[n.points.length-1].y=i.y,n.points[0].x=i.x,n.length=a.distancePoints(n.points[0],n.points[n.points.length-1]),s.length=a.distancePoints(n.points[n.points.length-1],s.points[s.points.length-1]);else{var d=void 0;r="Bottom"===(d=s.direction?s.direction:a.direction(s.points[0],s.points[s.points.length-1]))?o.bottomCenter:o.topCenter,s.length&&s.direction&&(s.length="Top"===d?n.points[n.points.length-1].y-(r.y+20):r.y+20-n.points[n.points.length-1].y),n.length=n.points[n.points.length-1].x-r.x,n.direction=n.length>0?"Right":"Left";var l={type:"Orthogonal",direction:d,length:20};h.push(new hr(e,"segments",l,!0)),e.segments=h.concat(e.segments)}else if(i="Bottom"===n.direction?o.bottomCenter:o.topCenter,n.length>o.height||"Top"===n.direction&&i.y>=n.points[0].y||"Bottom"===n.direction&&i.y<=n.points[0].y)n.points[0].x=n.points[n.points.length-1].x=i.x,n.points[0].y=i.y,n.length=a.distancePoints(n.points[0],n.points[n.points.length-1]),s.length=a.distancePoints(n.points[n.points.length-1],s.points[s.points.length-1]);else{r="Left"===s.direction?o.middleLeft:o.middleRight;d=void 0;d=s.direction?s.direction:a.direction(s.points[0],s.points[s.points.length-1]),s.length&&s.direction&&(s.length="Left"===d?n.points[n.points.length-1].x-(r.x+20):r.x+20-n.points[n.points.length-1].x),n.length=n.points[n.points.length-1].y-r.y,n.direction=n.length>0?"Bottom":"Top";l={type:"Orthogonal",direction:d,length:20};h.push(new hr(e,"segments",l,!0)),e.segments=h.concat(e.segments)}},t.prototype.translateBezierPoints=function(e,t,i,r,o,n,s){var h=e.segments.indexOf(o),d=e.segments[h];d&&("BezierSourceThumb"===t&&(d.vector1.angle||d.vector1.distance)?d.vector1={distance:e.distance(e.sourcePoint,n),angle:a.findAngle(e.sourcePoint,n)}:"BezierTargetThumb"===t&&(d.vector2.angle||d.vector2.distance)?d.vector2={distance:e.distance(e.targetPoint,n),angle:a.findAngle(e.targetPoint,n)}:("ConnectorSourceEnd"===t&&!e.sourceID||"ConnectorTargetEnd"===t&&!e.targetID)&&s&&cr(d.vector1)&&cr(d.vector2)?(a.isEmptyPoint(d.point1)&&(d.bezierPoint1=pr(e.sourcePoint,e.targetPoint)),a.isEmptyPoint(d.point2)&&(d.bezierPoint2=pr(e.targetPoint,e.sourcePoint))):"BezierSourceThumb"===t||"ConnectorSourceEnd"===t&&!s&&cr(d.vector1)?(d.bezierPoint1.x+=i,d.bezierPoint1.y+=r,a.isEmptyPoint(d.point1)&&!s||(d.point1={x:d.bezierPoint1.x,y:d.bezierPoint1.y})):("BezierTargetThumb"===t||"ConnectorTargetEnd"===t&&!s&&cr(d.vector2))&&(d.bezierPoint2.x+=i,d.bezierPoint2.y+=r,a.isEmptyPoint(d.point2)&&!s||(d.point2={x:d.bezierPoint2.x,y:d.bezierPoint2.y})))},t.prototype.dragTargetEnd=function(t,i,r,o,n,s,h,d){var l,c=this.diagram.nameTable[t.id],p=this.checkBoundaryConstraints(i,r,c.wrapper.bounds);if(Mr(c)&&"BezierTargetThumb"!==s&&p&&$r(this.diagram)){if(l={targetPoint:c.targetPoint},c.targetPoint.x+=i,c.targetPoint.y+=r,"ConnectorTargetEnd"===s&&"Orthogonal"===c.type&&c.segments&&c.segments.length>0){var g=c.segments[c.segments.length-2];g&&2===c.segments[c.segments.length-1].points.length&&("Left"===g.direction||"Right"===g.direction?g.points[g.points.length-1].x=c.targetPoint.x:g.points[g.points.length-1].y=c.targetPoint.y,g.length=a.distancePoints(g.points[0],g.points[g.points.length-1]),g.direction=a.direction(g.points[0],g.points[g.points.length-1]))}"Bpmn"===c.shape.type&&"Default"===c.shape.sequence&&this.updatePathElementOffset(c)}if("Bezier"===c.type)if(l={targetPoint:c.targetPoint},d)this.translateBezierPoints(t,""===s?"ConnectorTargetEnd":s,i,r,d,n,!h);else for(var u=0;u<t.segments.length;u++)this.translateBezierPoints(t,""===s?"ConnectorTargetEnd":s,i,r,t.segments[u],n,!h);return o||this.updateEndPoint(c,l),this.diagram.realActions&e.RealAction.AnimationClick||this.diagram.refreshCanvasLayers(),p},t.prototype.dragControlPoint=function(e,t,i,r,o){var n=this.diagram.nameTable[e.id];if(("Straight"===n.type||"Bezier"===n.type)&&n.segments.length>0){if(void 0!==o&&n.segments[o])n.segments[o].point.x+=t,n.segments[o].point.y+=i;else for(var a=0;a<n.segments.length-1;a++)n.segments[a].point.x+=t,n.segments[a].point.y+=i;r||this.updateEndPoint(n)}return!0},t.prototype.rotatePropertyChnage=function(e){var t=this.diagram.selectedItems,i=[];i=(i=i.concat(t.nodes)).concat(t.connectors);var r={x:t.offsetX,y:t.offsetY};this.rotateObjects(t,i,e-t.rotateAngle,r),t.wrapper.rotateAngle=t.rotateAngle=e,this.diagram.updateSelector()},t.prototype.rotateObjects=function(e,t,i,r,o){r=r||{};var n=x();P(n,i,r.x,r.y);for(var a=0,s=t;a<s.length;a++){var h=s[a];if(h instanceof js){if(Rr(h)&&$r(this.diagram)){if(!1!==o||e!==h){({rotateAngle:h.rotateAngle}),h.rotateAngle+=i,h.rotateAngle=(h.rotateAngle+360)%360;var d=C(n,{x:h.offsetX,y:h.offsetY});h.offsetX=d.x,h.offsetY=d.y,this.diagram.nodePropertyChange(h,{},{offsetX:h.offsetX,offsetY:h.offsetY,rotateAngle:h.rotateAngle})}if(h.processId){var l=this.diagram.nameTable[h.processId],c=this.diagram.bpmnModule.getChildrenBound(l,h.id,this.diagram);this.diagram.bpmnModule.updateSubProcessess(c,h,this.diagram)}h.children&&h.children.length&&!h.container&&this.getChildren(h,t)}}else this.rotatePoints(h,i,r||{x:h.wrapper.offsetX,y:h.wrapper.offsetY});this.diagram.updateDiagramObject(h)}this.diagram.refreshCanvasLayers(),this.diagram.updateSelector()},t.prototype.snapConnectorEnd=function(t){return this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToLines&&this.snappingModule&&this.diagram.snappingModule.snapConnectorEnd(t),t},t.prototype.snapAngle=function(t){return this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToLines&&this.snappingModule?this.snappingModule.snapAngle(this.diagram,t):0},t.prototype.rotatePoints=function(e,t,i){if(!e.sourceWrapper||!e.targetWrapper){var r=x();P(r,t,i.x,i.y),e.sourcePoint=C(r,e.sourcePoint),e.targetPoint=C(r,e.targetPoint),"Bpmn"===e.shape.type&&"Default"===e.shape.sequence&&this.updatePathElementOffset(e);var o={sourcePoint:e.sourcePoint,targetPoint:e.targetPoint};this.diagram.connectorPropertyChange(e,{},o)}},t.prototype.updateInnerParentProperties=function(e){var t=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0);for(var i=this.getAllDescendants(e,[],!1,!0),r=0;r<i.length;r++){var o=this.diagram.nameTable[i[r].id];o.offsetX=o.wrapper.offsetX,o.offsetY=o.wrapper.offsetY,o.width=o.wrapper.width,o.height=o.wrapper.height}this.diagram.protectPropertyChange(t)},t.prototype.scale=function(e,t,r,o,n,a){var s=this.diagram.nameTable[e.id],h=s,d=s.wrapper;n||(n=e);var l=n.wrapper,c=Da(l.offsetX-l.actualSize.width*l.pivot.x,l.offsetY-l.actualSize.height*l.pivot.y,l.actualSize.width,l.actualSize.height,l.rotateAngle,l.offsetX,l.offsetY,o);if(void 0!==d.actualSize.width&&void 0!==d.actualSize.height&&$r(this.diagram)){if(h.children&&!h.container){for(var p=0,g=this.getAllDescendants(h,[]);p<g.length;p++){var u=g[p];this.scaleObject(t,r,c,u,d,n)}e.wrapper.measure(new i),e.wrapper.arrange(e.wrapper.desiredSize),this.diagram.updateGroupOffset(s),this.updateInnerParentProperties(h)}else this.scaleObject(t,r,c,s,d,n);var f=Th(e.wrapper);if(!this.checkBoundaryConstraints(void 0,void 0,f)&&a)return this.scale(e,1/t,1/r,o,void 0,!0),!1;this.diagram.updateDiagramObject(e)}return!0},t.prototype.getAllDescendants=function(e,t,i,r){for(var o=e,n=[],a=0;a<o.children.length;a++)(e=this.diagram.nameTable[o.children[a]])&&(e.children?(i&&t.push(e),r&&n.push(e),t=this.getAllDescendants(e,t)):t.push(e));return r?n:t},t.prototype.getChildren=function(e,t){var i=e;if(e.children)for(var r=0;r<i.children.length;r++)e=this.diagram.nameTable[i.children[r]],t.push(e);return t},t.prototype.cloneChild=function(e){return this.diagram.nameTable[e]},t.prototype.scaleObject=function(e,t,i,r,o,n){t=t<0?1:t;var a={};if(1!==(e=e<0?1:e)||1!==t){var s=void 0,h=void 0;if(r instanceof js){var d=r,l=void 0,c=void 0;a={width:r.wrapper.actualSize.width,height:r.wrapper.actualSize.height,offsetX:r.wrapper.offsetX,offsetY:r.wrapper.offsetY,margin:{top:d.margin.top,left:d.margin.left}},"Bpmn"===d.shape.type&&d.shape.activity.subProcess.processes&&d.shape.activity.subProcess.processes.length>0&&(c=this.diagram.bpmnModule.getChildrenBound(d,d.id,this.diagram),l=d.wrapper.bounds.containsRect(c)),s=d.wrapper.actualSize.width*e,h=d.wrapper.actualSize.height*t,void 0!==d.maxWidth&&0!==d.maxWidth&&(s=Math.min(d.maxWidth,s)),void 0!==d.minWidth&&0!==d.minWidth&&(s=Math.max(d.minWidth,s)),void 0!==d.maxHeight&&0!==d.maxHeight&&(h=Math.min(d.maxHeight,h)),void 0!==d.minHeight&&0!==d.minHeight&&(h=Math.max(d.minHeight,h)),l&&(s=Math.max(s,c.right-d.wrapper.bounds.x),h=Math.max(h,c.bottom-d.wrapper.bounds.y)),e=s/d.actualSize.width,t=h/d.actualSize.height}var p=x();n||(n=r);var g=n.wrapper;if(P(p,-g.rotateAngle,i.x,i.y),T(p,e,t,i.x,i.y),P(p,g.rotateAngle,i.x,i.y),r instanceof js){var u=C(p,{x:(d=r).wrapper.offsetX,y:d.wrapper.offsetY}),f=d.wrapper.offsetX-d.wrapper.actualSize.width*d.pivot.x,m=d.wrapper.offsetY-d.wrapper.actualSize.height*d.pivot.y;if(s>0)if(d.processId){var y=this.diagram.nameTable[d.processId];(!y.maxWidth||d.margin.left+s<y.maxWidth)&&(d.width=s,d.offsetX=u.x)}else d.width=s,d.offsetX=u.x;if(h>0)if(d.processId){var v=this.diagram.nameTable[d.processId];(!v.maxHeight||d.margin.top+h<v.maxHeight)&&(d.height=h,d.offsetY=u.y)}else d.height=h,d.offsetY=u.y;var b=d.wrapper.offsetX-d.wrapper.actualSize.width*d.pivot.x,w=d.wrapper.offsetY-d.wrapper.actualSize.height*d.pivot.y;this.diagram.nameTable[d.processId]&&(d.margin.top+(w-m)<=0||d.margin.left+(b-f)<=0)?this.diagram.nodePropertyChange(r,{},{margin:{top:d.margin.top,left:d.margin.left}}):Eo(this.diagram,r,!0)?Bo(this.diagram,r):this.diagram.nodePropertyChange(r,a,{width:d.width,height:d.height,offsetX:d.offsetX,offsetY:d.offsetY,margin:{top:d.margin.top+(w-m),left:d.margin.left+(b-f)}})}else{var S=r,A={sourcePoint:S.sourcePoint,targetPoint:S.targetPoint};S.sourceWrapper&&S.targetWrapper||this.scaleConnector(S,p,A)}var z=this.diagram.nameTable[r.processId];if(z){z.wrapper.bounds,r.wrapper.bounds,c=this.diagram.bpmnModule.getChildrenBound(z,r.id,this.diagram);this.diagram.bpmnModule.updateSubProcessess(c,r,this.diagram)}}},t.prototype.scaleConnector=function(e,t,i){e.sourcePoint=C(t,e.sourcePoint),e.targetPoint=C(t,e.targetPoint),"Bpmn"===e.shape.type&&"Default"===e.shape.sequence&&this.updatePathElementOffset(e);var r={sourcePoint:e.sourcePoint,targetPoint:e.targetPoint};this.diagram.connectorPropertyChange(e,i,r)},t.prototype.portDrag=function(e,t,i,r){var o,n,a=this.findTarget(t,e),s=Th(e.wrapper);a&&to(a,this.diagram)&&(o=this.getPortChanges(e,a),a.offset.x+=i/s.width,a.offset.y+=r/s.height,n=this.getPortChanges(e,a),this.diagram.nodePropertyChange(e,o,n),this.diagram.updateDiagramObject(e))},t.prototype.labelDrag=function(e,t,i,r){var o=this.findTarget(t,e),n=Ph(e.wrapper),a=this.getAnnotationChanges(e,o);o instanceof Fe?(o.offset.x+=i/n.width,o.offset.y+=r/n.height):(this.updatePathAnnotationOffset(e,o,i,r),o instanceof Ze&&(o.alignment="Center"));var s=this.getAnnotationChanges(e,o);e instanceof js?this.diagram.nodePropertyChange(e,a,s):this.diagram.connectorPropertyChange(e,a,s),this.diagram.updateDiagramObject(e),zd(this.diagram,o,!1,t)||this.labelSelect(e,t)},t.prototype.updatePathAnnotationOffset=function(e,t,i,r,o,n){var s,h,d,l,c=this.diagram.getWrapper(e.wrapper,t.id),p=c.offsetX,g=c.offsetY,u=e.intermediatePoints,f=0,m=o||{x:p+i,y:g+r},y=this.getInterceptWithSegment(m,u),v=u[u.length-1];if(d=a.getLengthFromListOfPoints(u),y.length>0){if(t.dragLimit.top||t.dragLimit.bottom||t.dragLimit.left||t.dragLimit.right){var w={minDistance:null};v=this.getRelativeOffset(m,u,w);var x={minDistance:null};if(l=this.getRelativeOffset(m,y,x),null!=w&&x.minDistance<w.minDistance)v=l;else v=Un(e.intermediatePoints,t).point}else v=l=y[y.length-1];if(v){var C=void 0;for(C=0;C<u.length;C++){if(null!=h){if(b.toBounds([h,u[C]]).containsPoint(v)){f+=a.findLength(h,v);break}f+=a.findLength(h,u[C])}h=u[C]}s={x:f/d,y:0}}this.updateLabelMargin(e,t,s,m,n,i,r)}else this.updateLabelMargin(e,t,null,m,n,i,r)},t.prototype.getRelativeOffset=function(e,t,i){var r,o,n,a;for(a=0;a<t.length;a++)n=t[a],o=Math.round(Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))),null!==i.minDistance&&Math.min(Math.abs(i.minDistance),Math.abs(o))!==Math.abs(o)||(r=n,i.minDistance=o);return r},t.prototype.dragLimitValue=function(e,t,i,r){var o=!1,n=!1;return i.x>=t.x-e.dragLimit.left-r.width/2&&i.x<=t.x+e.dragLimit.right+r.width/2&&(o=!0),i.y>=t.y-e.dragLimit.top-r.height/2&&i.y<=t.y+e.dragLimit.bottom+r.height/2&&(n=!0),{x:o,y:n}},t.prototype.updateLabelMargin=function(e,t,i,r,o,n,s){if(i=i||{x:t.offset,y:0},t&&i&&i.x>0&&i.x<1){var h=a.getLengthFromListOfPoints(e.intermediatePoints),d=this.getPointAtLength(h*i.x,e.intermediatePoints,0),l=this.diagram.scrollSettings.currentZoom,c=t.dragLimit;if(c.top||c.bottom||c.left||c.right){this.diagram.getWrapper(e.wrapper,t.id);var p=new b(0,0,0,0),g=this.diagram.getWrapper(e.wrapper,t.id);p.x=g.offsetX/l+n,p.y=g.offsetY/l+s,p.width=g.bounds.width/l,p.height=g.bounds.height/l;var u=new b(d.x-(c.left||0)-p.width/2,d.y-(c.top||0)-p.height/2,(c.left||0)+(c.right||0)+p.width,(c.top||0)+(c.bottom||0)+p.height);if(u.containsPoint(r))r=r;else for(var f=[d,r],m=0,y=this.boundsInterSects(f,u,!1);m<y.length;m++){r=y[m]}var v=this.dragLimitValue(t,d,r,p);t.margin={left:v.x?r.x-d.x:t.margin.left,top:v.y?r.y-d.y:t.margin.top,right:0,bottom:0}}else t.margin={left:r.x-d.x,top:r.y-d.y,right:0,bottom:0};t.offset=i.x,o&&(t.width=o.width,t.height=o.height)}},t.prototype.boundsInterSects=function(e,t,i){var r;if(t){var o=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height},{x:t.x,y:t.y}];r=this.intersect(e,o,i)}return r},t.prototype.intersect=function(e,t,i){for(var r=[],o=0;o<e.length-1;o++)for(var n=0;n<t.length-1;n++){var a=Nn(e[o],e[o+1],t[n],t[n+1]);0!==a.x&&0!==a.y&&r.push(a)}return r},t.prototype.getPointAtLength=function(e,t,i){for(var r,o,n=0,s={x:0,y:0},h=0;h<t.length;h++)if(o=t[h],r){var d=a.findLength(r,o),l=void 0,c=void 0,p=void 0,g=void 0;if(n+d>=e){l=e-n,c=a.findAngle(r,o),p=l*Math.cos(c*Math.PI/180),g=l*Math.sin(c*Math.PI/180),s={x:r.x+p,y:r.y+g},c;break}n+=d,r=o}else r=o;return s},t.prototype.getInterceptWithSegment=function(e,t){for(var i,r,o=[],n=[],s=[],h=a.findLength({x:0,y:0},{x:this.diagram.scroller.viewPortWidth,y:this.diagram.scroller.viewPortHeight}),d=1;d<t.length;d++){s=[t[d-1],t[d]],n=[],r=Math.round(a.findAngle(s[0],s[1])%360),i=Math.round(a.findAngle(s[1],s[0])%360);var l=r>0&&r<=90||r>180&&r<=270?90:-90;n.push(a.transform(e,r+l,h)),n.push(a.transform(e,i+l,h));var c=Rn({x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y},{x1:n[0].x,y1:n[0].y,x2:n[1].x,y2:n[1].y});c.enabled&&o.push(c.intersectPt)}return o},t.prototype.getAnnotationChanges=function(e,t){var i={};return i[xa(e,t.id,!0)]={width:t.width,height:t.height,offset:e instanceof js?{x:t.offset.x,y:t.offset.y}:t.offset,rotateAngle:t.rotateAngle,margin:{left:t.margin.left,right:t.margin.right,top:t.margin.top,bottom:t.margin.bottom},horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,alignment:e instanceof wr?t.alignment:void 0},{annotations:i}},t.prototype.getPortChanges=function(e,t){var i={};return i[xa(e,t.id,!1)]={offset:t.offset},{ports:i}},t.prototype.labelRotate=function(e,t,i,r){var o,n;o=this.getAnnotationChanges(e,t);x(),t.rotateAngle;var a=this.diagram.getWrapper(e.wrapper,t.id),s=Tt({x:a.offsetX,y:a.offsetY},i)+90,h=this.snapAngle(s);(s=0!==h?h:s,t instanceof Ze&&t.segmentAngle)&&(s-=Yn(e.intermediatePoints,t,e.wrapper.bounds).angle);s=(s+360)%360,t.rotateAngle+=s-(t.rotateAngle+a.parentTransform),t.margin.bottom+="Top"===a.verticalAlignment?-t.height/2:"Bottom"===a.verticalAlignment?t.height/2:0,t.margin.right+="Left"===a.horizontalAlignment?-t.width/2:"Right"===a.horizontalAlignment?t.width/2:0,t instanceof Ze?t.alignment="Center":t.horizontalAlignment=t.verticalAlignment="Center",r.wrapper.rotateAngle=r.rotateAngle=t.rotateAngle,n=this.getAnnotationChanges(e,t),e instanceof js?this.diagram.nodePropertyChange(e,o,n):this.diagram.connectorPropertyChange(e,o,n),this.diagram.updateDiagramObject(e)},t.prototype.labelResize=function(e,t,r,o,n,a){var s,h,d;s=this.getAnnotationChanges(e,t);var l=a.wrapper.children[0];if(r&&1!==r||o&&1!==o){var c=x(),p=x();P(c,-e.rotateAngle,e.offsetX,e.offsetY),P(p,-(d=(l.rotateAngle+(e instanceof js?e.rotateAngle:0)+360)%360),n.x,n.y),T(p,r,o,n.x,n.y),P(p,d,n.x,n.y);var g=C(p,{x:l.offsetX,y:l.offsetY}),u=l.actualSize.height*o,f=l.actualSize.width*r,m=this.findTarget(l,e);if(m instanceof Ze)this.updatePathAnnotationOffset(e,t,0,0,g,new i(f,u));else{var y=Ph(e.wrapper);(g=C(c,g)).x=g.x-l.margin.left+l.margin.right,g.y=g.y-l.margin.top+l.margin.bottom,g.y+="Top"===m.verticalAlignment?-u/2:"Bottom"===m.verticalAlignment?u/2:0,g.x+="Left"===m.horizontalAlignment?-f/2:"Right"===m.horizontalAlignment?f/2:0;var v=y.width/(g.x-y.x),b=y.height/(g.y-y.y);f>1&&(m.width=f,m.offset.x=1/v),u>1&&(m.height=u,m.offset.y=1/b)}}t instanceof Ze&&(t.alignment="Center"),h=this.getAnnotationChanges(e,t),e instanceof js?this.diagram.nodePropertyChange(e,s,h):this.diagram.connectorPropertyChange(e,s,h),this.diagram.updateDiagramObject(e)},t.prototype.getSubProcess=function(e){var t,i={nodes:[],connectors:[]};return e instanceof js?t=e.processId:e&&e.nodes&&e.nodes.length&&e.nodes[0].processId&&(t=e.nodes[0].processId),t?(i.nodes.push(Ah(this.diagram.nameTable[t])),i):i},t.prototype.checkBoundaryConstraints=function(e,t,i){var r=this.diagram.pageSettings,o=this.diagram.pageSettings.boundaryConstraints,n=this.diagram.scroller;if("Page"===o||"Diagram"===o){var a=i?void 0:this.diagram.selectedItems.wrapper.bounds,s="Page"===o?r.width:n.viewPortWidth,h="Page"===o?r.height:n.viewPortHeight,d=i,l=(i?d.right:a.right)+(e||0),c=(i?d.left:a.left)+(e||0),p=(i?d.top:a.top)+(t||0),g=(i?d.bottom:a.bottom)+(t||0);return l<=s&&c>=0&&g<=h&&p>=0}return!0},t.prototype.dragSelectedObjects=function(t,i){var r=this.diagram.selectedItems;if(this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.offsetX=r.offsetX,this.state.backup.offsetY=r.offsetY),r=Do(this.diagram,r)||r,this.checkBoundaryConstraints(t,i)){this.diagram.diagramActions=this.diagram.diagramActions|e.DiagramAction.PreventZIndexOnDragging|e.DiagramAction.DragUsingMouse;var o=this.diagram.selectedObject.actualObject;return(o&&o instanceof js&&o.isLane&&wn(o,this.diagram)||!o||!o.isLane)&&this.diagram.drag(r,t,i),this.diagram.diagramActions=this.diagram.diagramActions&~(e.DiagramAction.PreventZIndexOnDragging|e.DiagramAction.DragUsingMouse),this.diagram.refreshCanvasLayers(),!0}return!1},t.prototype.scaleSelectedItems=function(e,t,i){var r=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.offsetX=r.offsetX,this.state.backup.offsetY=r.offsetY,this.state.backup.width=r.width,this.state.backup.height=r.height,this.state.backup.pivot=i),r=Do(this.diagram,r)||r,this.diagram.scale(r,e,t,i)},t.prototype.rotateSelectedItems=function(e){var t=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.angle=t.rotateAngle),t=Do(this.diagram,t)||t,this.diagram.rotate(t,e)},t.prototype.hasSelection=function(){return Td(this.diagram)},t.prototype.isSelected=function(e){return zd(this.diagram,e)},t.prototype.initExpand=function(t){var i=this.diagram.isProtectedOnChange;this.diagram.protectPropertyChange(!0);var r=t.target||t.source,o={isExpanded:r.isExpanded};r.isExpanded=!r.isExpanded,this.diagram.preventNodesUpdate=!0,this.diagram.diagramActions|=e.DiagramAction.PreventIconsUpdate,this.diagram.nodePropertyChange(r,o,{isExpanded:r.isExpanded}),this.diagram.diagramActions=this.diagram.diagramActions&~e.DiagramAction.PreventIconsUpdate,this.diagram.preventNodesUpdate=!1;for(var n=0,a=this.diagram.views;n<a.length;n++){var s=a[n],h=this.diagram.views[s];h instanceof El||this.diagram.refreshCanvasDiagramLayer(h)}this.diagram.protectPropertyChange(i)},t.prototype.expandNode=function(t,i){var r=this.diagram.preventNodesUpdate,o=t.isExpanded;this.diagram.preventNodesUpdate=!0,this.diagram.preventConnectorsUpdate=!0,this.expandCollapse(t,o,this.diagram),t.isExpanded=o;var n=this.diagram.layout.fixedNode;this.diagram.layout.fixedNode=t.id,this.diagram.diagramActions!=e.DiagramAction.Render&&this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&this.diagram.organizationalChartModule&&(this.diagram.organizationalChartModule.isAnimation=!0),this.diagram.blazorActions|=e.BlazorAction.expandNode;var a=this.diagram.doLayout();if(this.diagram.blazorActions&=~e.BlazorAction.expandNode,this.diagram.preventNodesUpdate=r,this.diagram.preventConnectorsUpdate=!1,this.diagram.layoutAnimateModule&&this.diagram.organizationalChartModule)this.diagram.allowServerDataBinding=!1,this.layoutAnimateModule.expand(this.diagram.layout.enableAnimation,a,t,this.diagram),this.diagram.allowServerDataBinding=!0;else{var s={element:_a(Ah(t)),state:!!t.isExpanded};this.triggerEvent(e.DiagramEvent.expandStateChange,s),this.diagram.lineRoutingModule&&this.diagram.constraints&e.DiagramConstraints.LineRouting&&this.diagram.resetSegments()}return this.diagram.layout.fixedNode=""===n?"":this.diagram.layout.fixedNode,a},t.prototype.getparentexpand=function(e,t,i,r){for(var o,n=0;n<e.inEdges.length;n++){var a=t.nameTable[e.inEdges[n]],s=t.nameTable[a.sourceID];if(s.isExpanded&&!i&&s.id!==r.sourceID&&a.visible)return!1;o=!0}return o},t.prototype.expandCollapse=function(e,t,i){for(var r=0;r<e.outEdges.length;r++){var o=i.nameTable[e.outEdges[r]],n=i.nameTable[o.targetID],a=this.getparentexpand(n,i,t,o);o.visible=t;var s={visible:n.visible,style:{opacity:n.wrapper.style.opacity}},h={visible:n.visible,style:{opacity:n.wrapper.style.opacity}};a&&(n.isExpanded&&this.expandCollapse(n,t,i),n.visible=t,n.style.opacity=this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&t?.1:n.style.opacity,i.nodePropertyChange(n,s,h)),i.connectorPropertyChange(o,s,h)}},t.prototype.updateNodeDimension=function(e,t){e instanceof js&&(e.offsetX=t.x+t.width/2,e.offsetY=t.y+t.height/2,e.width=t.width,e.height=t.height,e.wrapper.children[0].canMeasurePath=!0,this.diagram.nodePropertyChange(e,{},{width:t.width,height:t.height,offsetX:e.offsetX,offsetY:e.offsetY}),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer())},t.prototype.updateConnectorPoints=function(e,t){e instanceof wr&&(this.diagram.connectorPropertyChange(e,{},{targetPoint:e.targetPoint}),this.diagram.updateDiagramObject(e))},t.prototype.updateSelectedNodeProperties=function(t){if(this.diagram.lineRoutingModule&&this.diagram.constraints&e.DiagramConstraints.LineRouting){var i=[],r=[],o=[],n=[],a=[],s=[];this.diagram.protectPropertyChange(!0);var h=[],d=[],l=this.diagram.selectedObject.actualObject,c=this.diagram.selectedObject.helperObject;if(c&&l){var p=c.offsetX-l.offsetX,g=c.offsetY-l.offsetY,u=c.width-l.width,f=c.height-l.height,m=c.rotateAngle-l.rotateAngle;if(this.diagram.selectedItems.nodes.length+this.diagram.selectedItems.connectors.length>0&&(this.diagram.selectedItems.wrapper.rotateAngle=this.diagram.selectedItems.rotateAngle=c.rotateAngle),l instanceof js&&"SwimLane"!==l.shape.type&&!l.isLane&&!l.isPhase&&!l.isHeader)l.offsetX===l.wrapper.offsetX&&l.offsetY===l.wrapper.offsetY&&l.width===l.wrapper.width&&l.height===l.wrapper.height&&l.rotateAngle===l.wrapper.rotateAngle||(sf.base.isBlazor()&&i.push(Ah(l,void 0,void 0,!0)),l.offsetX+=p,l.offsetY+=g,l.width+=u,l.height+=f,l.rotateAngle+=m,this.diagram.nodePropertyChange(l,{},{offsetX:l.offsetX,offsetY:l.offsetY,width:l.width,height:l.height,rotateAngle:l.rotateAngle}),sf.base.isBlazor()&&o.push(Ah(l,void 0,void 0,!0))),h=this.diagram.spatialSearch.findObjects(l.wrapper.outerBounds);else if(l instanceof Ys)for(var y=0;y<l.nodes.length;y++){var v=l.nodes[y];v instanceof js&&"SwimLane"!==v.shape.type&&!v.isLane&&!v.isPhase&&!v.isHeader&&(v.offsetX+=p,v.offsetY+=g,v.width+=u,v.height+=f,v.rotateAngle+=m,this.diagram.nodePropertyChange(v,{},{offsetX:v.offsetX,offsetY:v.offsetY,width:v.width,height:v.height,rotateAngle:v.rotateAngle}),h=h.concat(this.diagram.spatialSearch.findObjects(l.wrapper.outerBounds)))}}else t instanceof wr?h.push(t):t instanceof Ys&&t.connectors.length&&(h=h.concat(t.connectors));for(y=0;y<h.length;y++)h[y]instanceof wr&&-1===d.indexOf(h[y].id)&&d.push(h[y].id);this.diagram.lineRoutingModule.renderVirtualRegion(this.diagram,!0);for(y=0;y<d.length;y++){var b=this.diagram.nameTable[d[y]];b instanceof wr&&"Orthogonal"===b.type&&(sf.base.isBlazor()&&r.push(Ah(b,void 0,void 0,!0)),this.diagram.lineRoutingModule.refreshConnectorSegments(this.diagram,b,!0),sf.base.isBlazor()&&n.push(Ah(b,void 0,void 0,!0)))}if(this.updateSelector(),sf.base.isBlazor()){this.getObjectChanges(i,o,a),this.getObjectChanges(r,n,s);var w={nodes:a,connectors:s};if(window&&window.Blazor&&s.length+a.length){var x={methodName:"UpdateBlazorProperties",diagramobj:w};window.sfBlazor.updateBlazorProperties(x,this.diagram)}}this.diagram.protectPropertyChange(!1)}},t.prototype.drawSelectionRectangle=function(e,t,i,r){this.diagram.drawSelectionRectangle(e,t,i,r)},t.prototype.startGroupAction=function(){this.diagram.startGroupAction()},t.prototype.endGroupAction=function(){this.diagram.endGroupAction()},t.prototype.removeChildFromBPmn=function(e,t,i){var r=this.diagram.nameTable[e.id]||e.nodes[0];if(i&&r&&r.processId&&r.processId===i.wrapper.id){var o=Ah(r);o.processId=r.processId,this.diagram.startGroupAction();for(var n=[],a=(n=n.concat(r.outEdges,r.inEdges)).length-1;a>=0;a--){var s=this.diagram.nameTable[n[a]];s&&this.diagram.remove(s)}var h=this.diagram.nameTable[r.processId].shape.activity.subProcess.processes||[];h.splice(h.indexOf(r.id),1),this.diagram.bpmnModule.removeChildFromBPMN(this.diagram.nameTable[r.processId].wrapper,r.id),this.diagram.nameTable[r.id].processId="",r.offsetX=r.wrapper.offsetX,r.offsetY=r.wrapper.offsetY;var d={type:"PositionChanged",redoObject:{nodes:[Ah(r)]},undoObject:{nodes:[o]},category:"Internal"};this.addHistoryEntry(d),this.diagram.endGroupAction()}},t.prototype.isDroppable=function(e,t){var i=this.diagram.nameTable[e.id]||e.nodes[0];return!!i&&(!!(!sf.base.isBlazor()&&"TextAnnotation"===i.shape.shape||sf.base.isBlazor()&&"TextAnnotation"===i.shape.bpmnShape)||(!i||"Bpmn"!==i.shape.type||!(i.processId===t.id||i.id===t.processId||"Bpmn"===t.shape.type&&t.shape.activity.subProcess.collapsed)))},t.prototype.renderHighlighter=function(e,t,i){new b;if(e.target instanceof js||t&&e.source instanceof js){var r=t?e.source:e.target,o=t?e.sourceWrapper:e.targetWrapper,n=this.findTarget(o,r,i,!0),a=void 0;if(n instanceof Cs)for(var s=n.id,h=e.target,d=0,l=h.wrapper.children[0].children[0].children[2].children;d<l.length;d++){var c=l[d];if(c.id===h.id+"_"+s){a=c.children[0];break}}else a=n instanceof js?n.wrapper:t?e.sourceWrapper:e.targetWrapper;this.diagram.renderHighlighter(a)}},t.prototype.mouseOver=function(e,t,i){return!0},t.prototype.snapPoint=function(e,t,i,r){var o,n=this.diagram.selectedItems,a=t.x<e.x,s=t.y<e.y,h=o={x:i,y:r};return this.snappingModule&&(h=this.diagram.snappingModule.snapPoint(this.diagram,n,a,s,o,e,t)),h},t.prototype.removeSnap=function(){this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject&&this.snappingModule&&this.snappingModule.removeGuidelines(this.diagram)},t.prototype.dropAnnotation=function(e,t){var i=e instanceof js?e:e.nodes[0];if(this.diagram.bpmnModule&&"Bpmn"===t.shape.type&&(!sf.base.isBlazor()&&"TextAnnotation"===i.shape.shape||sf.base.isBlazor()&&"TextAnnotation"===i.shape.bpmnShape)){i.hasTarget=t.id,i.shape.annotation.nodeId=t.id,this.diagram.currentSymbol||(this.diagram.addTextAnnotation(i.shape.annotation,t),i.shape.annotation.nodeId="",this.diagram.remove(i)),this.diagram.refreshDiagramLayer()}},t.prototype.drop=function(e,t,i){if(this.diagram.bpmnModule){var r=e instanceof js?e:e.nodes[0];r&&"Bpmn"===r.shape.type&&"Bpmn"===t.shape.type&&(this.diagram.bpmnModule.dropBPMNchild(t,e instanceof js?e:e.nodes[0],this.diagram),this.diagram.refreshDiagramLayer())}},t.prototype.addHistoryEntry=function(e){this.diagram.addHistoryEntry(e)},t.prototype.align=function(e,t,i){if(e.length>0){var r=0;e[0]=this.diagram.nameTable[e[0].id]||e[0];var o="Object"===i?Th(e[0].wrapper):this.diagram.selectedItems.wrapper.bounds,n={nodes:[],connectors:[]},a={nodes:[],connectors:[]};for(r="Object"===i?r+1:r;r<e.length;r++){var s=0,h=0;e[r]=this.diagram.nameTable[e[r].id]||e[r];var d=Th(e[r].wrapper);"Left"===t?s=o.left+d.width/2-d.center.x:"Right"===t?s=o.right-d.width/2-d.center.x:"Top"===t?h=o.top+d.height/2-d.center.y:"Bottom"===t?h=o.bottom-d.height/2-d.center.y:"Center"===t?s=o.center.x-d.center.x:"Middle"===t&&(h=o.center.y-d.center.y),n=this.storeObject(n,e[r]),this.drag(e[r],s,h),this.diagram.updateSelector(),a=this.storeObject(a,e[r])}n=Ah(n),a=Ah(a);var l={type:"Align",category:"Internal",undoObject:Ah(n),redoObject:Ah(a)};this.addHistoryEntry(l)}},t.prototype.distribute=function(e,t){if(e.length>0){var i=0,r=0,o=0,n=0,a=0,s=0,h=0,d=0,l={nodes:[],connectors:[]},c={nodes:[],connectors:[]};for(i=0;i<e.length;i++)e[i]=this.diagram.nameTable[e[i].id]||e[i];for(e=Xn(e,t),i=1;i<e.length;i++)r=r+e[i].wrapper.bounds.topRight.x-e[i-1].wrapper.bounds.topRight.x,o=o+e[i].wrapper.bounds.topLeft.x-e[i-1].wrapper.bounds.topLeft.x,n=n+e[i].wrapper.bounds.topRight.y-e[i-1].wrapper.bounds.topRight.y,a=a+e[i].wrapper.bounds.bottomRight.y-e[i-1].wrapper.bounds.bottomRight.y,s=s+e[i].wrapper.bounds.center.x-e[i-1].wrapper.bounds.center.x,h=h+e[i].wrapper.bounds.center.y-e[i-1].wrapper.bounds.center.y,d=d+e[i].wrapper.bounds.topRight.y-e[i-1].wrapper.bounds.bottomRight.y;for(i=1;i<e.length-1;i++){var p=0,g=0,u=Th(e[i-1].wrapper),f=Th(e[i].wrapper);"RightToLeft"===t||"Center"===t?p=u.center.x-f.center.x+s/(e.length-1):"Right"===t?p=u.topRight.x-f.topRight.x+r/(e.length-1):"Left"===t?p=u.topLeft.x-f.topLeft.x+o/(e.length-1):"Middle"===t?g=u.center.y-f.center.y+h/(e.length-1):"Top"===t?g=u.topRight.y-f.topRight.y+n/(e.length-1):"Bottom"===t?g=u.bottomRight.y-f.bottomRight.y+a/(e.length-1):"BottomToTop"===t&&(g=u.bottomRight.y-f.topRight.y+d/(e.length-1)),l=this.storeObject(l,e[i]),this.drag(e[i],p,g),this.diagram.updateSelector(),c=this.storeObject(c,e[i])}l=Ah(l),c=Ah(c);var m={type:"Distribute",category:"Internal",undoObject:Ah(l),redoObject:Ah(c)};this.addHistoryEntry(m)}},t.prototype.sameSize=function(e,t){if(e.length>0){var i=0,r={x:.5,y:.5};e[0]=this.diagram.nameTable[e[0].id]||e[0];var o=Th(e[0].wrapper),n={nodes:[],connectors:[]},a={nodes:[],connectors:[]};for(i=1;i<e.length;i++){e[i]=this.diagram.nameTable[e[i].id]||e[0];var s=Th(e[i].wrapper),h=1,d=1;"Width"===t?h=o.width/s.width:"Height"===t?d=o.height/s.height:"Size"===t&&(h=o.width/s.width,d=o.height/s.height),n=this.storeObject(n,e[i]),this.scale(e[i],h,d,r),a=this.storeObject(a,e[i])}this.diagram.updateSelector(),n=Ah(n),a=Ah(a);var l={type:"Sizing",category:"Internal",undoObject:Ah(n),redoObject:Ah(a)};this.addHistoryEntry(l)}},t.prototype.storeObject=function(e,t){return t instanceof js?e.nodes.push(Ah(t)):e.connectors.push(Ah(t)),e},t.prototype.updatePanState=function(t){if(t)this.diagram.realActions=this.diagram.realActions|e.RealAction.PanInProgress;else{this.diagram.dataBind();var i=this.diagram.scrollSettings;this.diagram.realActions=this.diagram.realActions&~e.RealAction.PanInProgress;var r={VerticalOffset:i.verticalOffset,HorizontalOffset:i.horizontalOffset,ViewportHeight:i.viewPortHeight,ViewportWidth:i.viewPortWidth,CurrentZoom:i.currentZoom},o={oldValue:r,newValue:r,source:this.diagram,panState:"Completed"};this.triggerEvent(e.DiagramEvent.scrollChange,o)}},t.prototype.dataBinding=function(){this.diagram.dataBind()},t.prototype.setBlazorDiagramProps=function(e){this.diagram.setBlazorDiagramProps(e)},t.prototype.scroll=function(t,i,r){var o=this.diagram.constraints&e.DiagramConstraints.PanX,n=function(t){return t.constraints&e.DiagramConstraints.PanY}(this.diagram);sf.base.isBlazor()?(this.diagram.setCursor("grabbing"),this.diagram.scroller.zoom(1,(t=o?t:0)*this.diagram.scroller.currentZoom,(i=n?i:0)*this.diagram.scroller.currentZoom,r)):this.diagram.pan((t=o?t:0)*this.diagram.scroller.currentZoom,(i=n?i:0)*this.diagram.scroller.currentZoom,r)},t.prototype.drawHighlighter=function(e){this.diagram.renderHighlighter(e.wrapper)},t.prototype.removeHighlighter=function(){this.diagram.clearHighlighter()},t.prototype.renderContainerHelper=function(e){return Do(this.diagram,e)},t.prototype.isParentAsContainer=function(e,t){return Eo(this.diagram,e,t)},t.prototype.dropChildToContainer=function(t,i){this.diagram.diagramActions&e.DiagramAction.PreventLaneContainerUpdate||Mo(this.diagram,t,i)},t.prototype.checkSelection=function(e,t){var i;if(1===e.nodes.length&&0===e.connectors.length)if(Eo(this.diagram,e.nodes[0],!0)){i="SwimLane"===e.nodes[0].shape?e.nodes[0]:this.diagram.nameTable[e.nodes[0].parentId];var r=e.nodes[0];if("SwimLane"===i.shape.type){var o="Horizontal"===i.shape.orientation;(r.isPhase&&(o&&"ResizeSouth"===t||!o&&"ResizeEast"===t)||r.isLane&&(o&&"ResizeEast"===t||!o&&"ResizeSouth"===t))&&ln(this.diagram,i,t)}else if("Grid"===i.container.type)if("Horizontal"===i.container.orientation&&1===r.rowIndex||"Vertical"===i.container.orientation&&r.rowIndex>0&&r.columnIndex>0){if("ResizeSouth"===t)for(var n=0;n<this.diagram.nodes.length;n++){if((a=this.diagram.nodes[n]).rowIndex===i.rows.length-1&&0===a.columnIndex){this.select(a);break}}}else if("ResizeEast"===t)for(n=0;n<this.diagram.nodes.length;n++){var a;if(1===(a=this.diagram.nodes[n]).rowIndex&&a.columnIndex===i.columns.length-1){this.select(a);break}}}else ln(this.diagram,e.nodes[0],t)},t.prototype.zoom=function(e,t,i,r){this.diagram.scroller.zoom(e,t*this.diagram.scroller.currentZoom,i*this.diagram.scroller.currentZoom,r)},t}(),fl=function(){function t(e){this.transform={tx:0,ty:0,scale:1},this.oldCollectionObjects=[],this.removeCollection=[],this.vPortWidth=0,this.vPortHeight=0,this.currentZoomFActor=1,this.hOffset=0,this.vOffset=0,this.scrolled=!1,this.hScrollSize=0,this.vScrollSize=0,this.diagram=e,this.objects=[],this.transform=e.scroller?e.scroller.transform:{tx:0,ty:0,scale:1},this.vPortWidth=e.scrollSettings.viewPortWidth,this.vPortHeight=e.scrollSettings.viewPortHeight,this.currentZoomFActor=e.scrollSettings.currentZoom,this.hOffset=e.scrollSettings.horizontalOffset,this.vOffset=e.scrollSettings.verticalOffset}return Object.defineProperty(t.prototype,"viewPortHeight",{get:function(){return this.vPortHeight},set:function(e){this.vPortHeight=e,this.diagram.scrollSettings.viewPortHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentZoom",{get:function(){return this.currentZoomFActor},set:function(e){this.currentZoomFActor=e,this.diagram.scrollSettings.currentZoom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPortWidth",{get:function(){return this.vPortWidth},set:function(e){this.vPortWidth=e,this.diagram.scrollSettings.viewPortWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalOffset",{get:function(){return this.hOffset},set:function(t){this.hOffset=t,Math.abs(this.hOffset-this.diagram.scrollSettings.horizontalOffset)>1&&(this.diagram.realActions=this.diagram.realActions|e.RealAction.hScrollbarMoved,this.scrolled=!0),this.diagram.scrollSettings.horizontalOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalOffset",{get:function(){return this.vOffset},set:function(t){this.vOffset=t,Math.abs(this.vOffset-this.diagram.scrollSettings.verticalOffset)>1&&(this.diagram.realActions=this.diagram.realActions|e.RealAction.vScrollbarMoved,this.scrolled=!0),this.diagram.scrollSettings.verticalOffset=t},enumerable:!0,configurable:!0}),t.prototype.updateScrollOffsets=function(e,t){var i,r,o=this.getPageBounds(void 0,void 0,!0);o.x*=this.currentZoom,o.y*=this.currentZoom,o.width*=this.currentZoom,o.height*=this.currentZoom,i=Math.max(0,e-o.left),r=Math.max(0,t-o.top),void 0!==e&&void 0!==t?(this.horizontalOffset=i,this.verticalOffset=r,this.diagram.setOffset(i,r)):this.diagram.setOffset(-this.horizontalOffset-o.x,-this.verticalOffset-o.y),this.transform={tx:Math.max(this.horizontalOffset,-o.left)/this.currentZoom,ty:Math.max(this.verticalOffset,-o.top)/this.currentZoom,scale:this.currentZoom}},t.prototype.setScrollOffset=function(e,t){this.scrolled=!1;var i=this.getPageBounds(void 0,void 0,!0);i.x*=this.currentZoom,i.y*=this.currentZoom,i.width*=this.currentZoom,i.height*=this.currentZoom;var r=-i.left,o=-i.top,n=!1,a=this.viewPortWidth*this.currentZoom,s=this.viewPortHeight*this.currentZoom,h=r-e;if(h!==this.horizontalOffset){r<this.horizontalOffset&&(this.horizontalOffset>h?this.horizontalOffset-=e:this.horizontalOffset=h,n=!0);var d=Math.max(i.right+this.vScrollSize,a);if(!n&&d<-h+this.viewPortWidth){var l=-h+a-this.vScrollSize,c=-this.horizontalOffset+a-this.vScrollSize;l<c||l-i.right>l-c?this.horizontalOffset=h:this.horizontalOffset=-(i.right+this.vScrollSize-a),n=!0}n||(this.horizontalOffset=r-e)}n=!1;var p=o-t;if(p!==this.verticalOffset){o<this.verticalOffset&&(this.verticalOffset>p?this.verticalOffset-=t:this.verticalOffset=p,n=!0);var g=Math.max(i.bottom+this.hScrollSize,s);if(!n&&g<-p+s){var u=-p+s-this.hScrollSize,f=-this.verticalOffset+s-this.hScrollSize;u<f||u-i.bottom>u-f?this.verticalOffset=p:this.verticalOffset=-(i.bottom+this.hScrollSize-s),n=!0}n||(this.verticalOffset=o-t)}this.transform={tx:Math.max(this.horizontalOffset,-i.left)/this.currentZoom,ty:Math.max(this.verticalOffset,-i.top)/this.currentZoom,scale:this.currentZoom},this.setSize()},t.prototype.getObjects=function(e,t){for(var i=[],r=0;r<e.length;r++){for(var o=!1,n=0;n<t.length;n++)if(e[r]===t[n]){o=!0;break}o||i.push(e[r])}return i},t.prototype.virtualizeElements=function(){for(var e=this.viewPortWidth/this.currentZoom,t=this.viewPortHeight/this.currentZoom,i=this.diagram.spatialSearch.findObjects(new b(-this.horizontalOffset/this.currentZoom,-this.verticalOffset/this.currentZoom,e,t)),r=[],o=0;o<i.length;o++)r.push(i[o].id);var n=this.getObjects(r,this.oldCollectionObjects);0===this.oldCollectionObjects.length&&(this.oldCollectionObjects=r);var a=this.getObjects(this.oldCollectionObjects,r);this.diagram.updateVirtualObjects(n,!1,a),this.oldCollectionObjects=r},t.prototype.setSize=function(t){var i=this.getPageBounds(void 0,void 0,!0);i.x*=this.currentZoom,i.y*=this.currentZoom,i.width*=this.currentZoom,i.height*=this.currentZoom;var r=Math.min(i.x,-this.horizontalOffset),o=Math.min(i.y,-this.verticalOffset),n=(this.horizontalOffset,this.viewPortWidth,i.right,this.verticalOffset,this.viewPortHeight,i.bottom,this.scrollerWidth),a=this.scrollerWidth;-this.verticalOffset<=i.y&&-this.verticalOffset+this.viewPortHeight>=i.bottom&&(a=0),-this.horizontalOffset<=i.x&&-this.horizontalOffset+this.viewPortWidth>=i.right&&(n=0),this.hScrollSize=n,this.vScrollSize=a;var s=this.diagramWidth,h=this.diagramHeight;this.diagramWidth=Math.max(i.right,-this.horizontalOffset+this.viewPortWidth-a)-r,this.diagramHeight=Math.max(i.bottom,-this.verticalOffset+this.viewPortHeight-n)-o,s===this.diagramWidth&&h===this.diagramHeight||"Diagram"===this.diagram.scrollSettings.scrollLimit||this.diagram.setSize(this.diagramWidth,this.diagramHeight),"Diagram"===this.diagram.scrollSettings.scrollLimit&&(s===this.diagramWidth&&h===this.diagramHeight&&1===this.currentZoom||this.diagram.diagramActions&&t&&(!this.diagram.diagramActions||!t||0===this.verticalOffset&&this.verticalOffset!==t.y||0===this.horizontalOffset&&this.horizontalOffset!==t.x)?t&&s===this.diagramWidth&&h===this.diagramHeight&&(this.diagram.diagramCanvas.scrollHeight>this.viewPortHeight&&t.y<0&&this.horizontalOffset===t.x&&0===this.verticalOffset||this.diagram.diagramCanvas.scrollWidth>this.viewPortWidth&&t.x<0&&this.verticalOffset===t.y&&0===this.horizontalOffset)&&(this.verticalOffset=t.y,this.horizontalOffset=t.x,this.transform={tx:Math.max(t.x,-i.left)/this.currentZoom,ty:Math.max(t.y,-i.top)/this.currentZoom,scale:this.currentZoom}):(this.diagram.scrollActions&e.ScrollActions.Interaction&&t&&(this.transform={tx:Math.max(t.x,-i.left/this.currentZoom)/this.currentZoom,ty:Math.max(t.y,-i.top/this.currentZoom)/this.currentZoom,scale:this.currentZoom},this.horizontalOffset=t.x,this.verticalOffset=t.y),this.diagram.setSize(this.diagramWidth,this.diagramHeight),this.diagram.scrollActions&e.ScrollActions.PropertyChange||!t||(this.horizontalOffset=t.x,this.verticalOffset=t.y,this.transform={tx:Math.max(t.x,-i.left)/this.currentZoom,ty:Math.max(t.y,-i.top)/this.currentZoom,scale:this.currentZoom}))),this.diagram.transformLayers(),this.diagram.element.style.overflow="hidden"},t.prototype.setViewPortSize=function(e,t){this.viewPortWidth=e,this.viewPortHeight=t},t.prototype.getPageBounds=function(e,t,i){var r,o=new b;if("Content"!==t&&null!==this.diagram.pageSettings.width&&null!==this.diagram.pageSettings.height){var n=this.diagram.pageSettings.width,a=this.diagram.pageSettings.height,s=0,h=0;if(this.diagram.pageSettings.multiplePage){if((o=this.diagram.spatialSearch.getPageBounds(0,0)).right>n)n*=d=Math.ceil(o.right/n);if(o.bottom>a)a*=d=Math.ceil(o.bottom/a);if(o.left<0&&Math.abs(o.left)>s){var d=Math.ceil(Math.abs(o.left)/this.diagram.pageSettings.width);s=this.diagram.pageSettings.width*d}if(o.top<0&&Math.abs(o.top)>h){d=Math.ceil(Math.abs(o.top)/this.diagram.pageSettings.height);h=this.diagram.pageSettings.height*d}}r=new b(-s,-h,n+s,a+h)}else{var l=e?void 0:0;r=this.diagram.spatialSearch.getPageBounds(l,l)}if(i){var c=this.diagram.scrollSettings.padding;r.x-=c.left,r.y-=c.top,r.width+=c.left+c.right,r.height+=c.top+c.bottom}return r},t.prototype.getPageBreak=function(e){for(var t=0,i=0,r=-1,o=[],n=0,a=0,s=0,h=0,d=this.diagram.pageSettings.margin.left,l=this.diagram.pageSettings.margin.right,c=this.diagram.pageSettings.margin.top,p=this.diagram.pageSettings.margin.bottom,g=1,u=1,f={x1:n,y1:s,x2:a,y2:h};e.width>t;)(t+=this.diagram.pageSettings.width?this.diagram.pageSettings.width:e.width)===this.diagram.pageSettings.width&&(f={x1:e.left+d,y1:e.top+c,x2:e.left+d,y2:e.bottom-p},o[++r]=f),t<e.width&&(f={x1:n=e.topLeft.x+this.diagram.pageSettings.width*g,y1:s=e.topLeft.y+c,x2:a=e.bottomLeft.x+this.diagram.pageSettings.width*g,y2:h=e.bottomLeft.y-p},o[++r]=f,g++),e.width===t&&(f={x1:e.right-l,y1:e.top+c,x2:e.right-l,y2:e.bottom-p},o[++r]=f);for(;e.height>i;)(i+=this.diagram.pageSettings.height?this.diagram.pageSettings.height:e.height)===this.diagram.pageSettings.height&&(f={x1:e.left+d,y1:e.top+c,x2:e.right-l,y2:e.top+c},o[++r]=f),i<e.height&&(f={x1:n=e.topLeft.x+d,y1:s=e.topLeft.y+this.diagram.pageSettings.height*u,x2:a=e.topRight.x-l,y2:h=e.topRight.y+this.diagram.pageSettings.height*u},o[++r]=f,u++),e.height===i&&(f={x1:e.left+d,y1:e.bottom-p,x2:e.right-l,y2:e.bottom-p},o[++r]=f);return o},t.prototype.zoom=function(t,i,r,o){if(this.diagram.constraints&e.DiagramConstraints.Zoom&&1!==t||function(t){return t.constraints&e.DiagramConstraints.Pan}(this.diagram)&&1===t){var n=x();if(T(n,this.currentZoom,this.currentZoom),A(n,this.horizontalOffset,this.verticalOffset),o=C(n,o=o||{x:(this.viewPortWidth/2-this.horizontalOffset)/this.currentZoom,y:(this.viewPortHeight/2-this.verticalOffset)/this.currentZoom}),this.currentZoom*t>=this.diagram.scrollSettings.minZoom&&this.currentZoom*t<=this.diagram.scrollSettings.maxZoom){this.currentZoom*=t;var a=this.getPageBounds(void 0,void 0,!0);a.x*=this.currentZoom,a.y*=this.currentZoom;var s=x();T(s,t,t,o.x,o.y),A(s,i||0,r||0),z(n,s);var h=C(n,{x:0,y:0});1===t&&(h=this.applyScrollLimit(h.x,h.y)),!(this.diagram.scrollActions&e.ScrollActions.PropertyChange)&&this.diagram.scrollActions&e.ScrollActions.Interaction&&"Diagram"===this.diagram.scrollSettings.scrollLimit||(this.transform={tx:Math.max(h.x,-a.left)/this.currentZoom,ty:Math.max(h.y,-a.top)/this.currentZoom,scale:this.currentZoom},this.horizontalOffset=h.x,this.verticalOffset=h.y),this.setSize(h),"SVG"!==this.diagram.mode&&Yr(this.diagram)&&this.diagram.scroller.virtualizeElements(),"SVG"===this.diagram.mode||Yr(this.diagram)||this.diagram.refreshDiagramLayer(),this.diagram.setOffset(-this.horizontalOffset-a.x,-this.verticalOffset-a.y),Tr(this.diagram)}}},t.prototype.fitToPage=function(e){var t=(e=e||{}).mode,i=e.region,r=e.margin||{},o=e.canZoomIn,n=e.customBounds;r.bottom=r.bottom||25,r.top=r.top||25,r.left=r.left||25,r.right=r.right||25;var a,s=n,h=-this.horizontalOffset,d=-this.verticalOffset;if("PageSettings"===(i=i||"PageSettings")&&this.diagram.pageSettings.width&&this.diagram.pageSettings.height||this.diagram.nodes.length>0||this.diagram.connectors.length>0){t=t||"Page","CustomBounds"!==i&&(s=this.getPageBounds(!0,i,!0));var l={x:0,y:0};l.x=(this.viewPortWidth-(r.left+r.right))/s.width,l.y=(this.viewPortHeight-(r.top+r.bottom))/s.height,!o&&s.width-this.horizontalOffset<this.viewPortWidth&&s.height-this.verticalOffset<this.viewPortHeight&&(l.x=Math.min(this.currentZoom,l.x),l.y=Math.min(this.currentZoom,l.y));var c=void 0,p=void 0,g=void 0;switch(t){case"Width":a=(c=l.x)/this.currentZoom,h+=(p=(this.viewPortWidth-s.width*c)/2-s.x*c)+(r.left-r.right)/2*c,d-=-this.verticalOffset*a,d="CustomBounds"!==i?d:d-this.verticalOffset*a;break;case"Height":a=(c=l.y)/this.currentZoom,p=(this.viewPortWidth-s.width*c)/2-s.x*c,g=(this.viewPortHeight-s.height*c)/2-s.y*c,h+=p+(r.left-r.right)/2*c,d+=g+(r.top-r.bottom)/2*c;break;case"Page":a=(c=Math.min(l.x,l.y))/this.currentZoom,p=(this.viewPortWidth-s.width*c)/2-s.x*c,g=(this.viewPortHeight-s.height*c)/2-s.y*c,h+=p+(r.left-r.right)/2*c,d+=g+(r.top-r.bottom)/2*c}this.zoom(a,h,d,{x:0,y:0})}else a=1/this.currentZoom,this.zoom(a,h,d,{x:0,y:0})},t.prototype.bringIntoView=function(e){var t=0,i=0,r=this.currentZoom,o=e,n=-this.horizontalOffset,a=-this.verticalOffset;o=new b(o.x*r,o.y*r,o.width*r,o.height*r),new b(n,a,this.viewPortWidth,this.viewPortHeight).containsRect(o)||(o.right>-n+this.viewPortWidth&&(t=o.right-this.viewPortWidth),o.x<-n&&(t=o.x),o.bottom>-a+this.viewPortHeight&&(i=o.bottom-this.viewPortHeight),o.y<-a&&(i=o.y),this.zoom(1,-this.horizontalOffset-t,-this.verticalOffset-i,null))},t.prototype.bringToCenter=function(e){var t=this.currentZoom,i=new b(e.x*t,e.y*t,e.width*t,e.height*t),r=i.x+i.width/2-this.viewPortWidth/2,o=i.y+i.height/2-this.viewPortHeight/2;this.zoom(1,-this.horizontalOffset-r,-this.verticalOffset-o,null)},t.prototype.applyScrollLimit=function(e,t){if("Infinity"!==this.diagram.scrollSettings.scrollLimit){var i=void 0;if("Limited"===this.diagram.scrollSettings.scrollLimit){var r=this.diagram.scrollSettings.scrollableArea;i=new b(r.x,r.y,r.width,r.height)}(i=i||this.getPageBounds(!0)).x*=this.currentZoom,i.y*=this.currentZoom,i.width*=this.currentZoom,i.height*=this.currentZoom,e*=-1,t*=-1;var o=Math.max(i.right,this.viewPortWidth);if(!(e<=i.x&&(e+this.viewPortWidth>=i.right||e>=i.right-this.viewPortWidth)||e>=i.x&&e+this.viewPortWidth<=o))if(e>=i.x)e=Math.max(i.x,Math.min(e,e-(e+this.viewPortWidth-this.vScrollSize-o)));else{var n=i.right-this.viewPortWidth;e=Math.min(n,i.x)}var a=Math.max(i.bottom,this.viewPortHeight);if(!(t<=i.y&&t+this.viewPortHeight>=i.bottom||t>=i.y&&t+this.viewPortHeight<=a))if(t>=i.y)t=Math.max(i.y,Math.min(t,t-(t+this.viewPortHeight-this.hScrollSize-a)));else{n=i.bottom-this.viewPortHeight;t=Math.min(i.y,n)}e*=-1,t*=-1}return{x:e,y:t}},t}(),ml=function(){function e(e,t,i,r,o){this.objects=[],this.left=e,this.top=t,this.width=i,this.height=r,this.spatialSearch=o}return e.prototype.findQuads=function(e,t){null!=this.first&&this.first.isIntersect(e)&&this.first.findQuads(e,t),null!=this.second&&this.second.isIntersect(e)&&this.second.findQuads(e,t),null!=this.third&&this.third.isIntersect(e)&&this.third.findQuads(e,t),null!=this.fourth&&this.fourth.isIntersect(e)&&this.fourth.findQuads(e,t),this.objects.length>0&&t.push(this)},e.prototype.isIntersect=function(e){return!(this.left+this.width<e.left||this.top+this.height<e.top||this.left>e.right||this.top>e.bottom)},e.prototype.selectQuad=function(){for(var e,t=null,i=this;null!=i;)e=i.getQuad(t),i=e.source,t=e.target||t;return t},e.prototype.getQuad=function(t){var i=this.width/2,r=this.height/2;if(i>=1e3&&r>=1e3){var o=this.left+i,n=this.top+r;if(this.spatialSearch.childRight<=o){if(this.spatialSearch.childBottom<=n){if(!this.first)(a=new e(this.left,this.top,i,r,this.spatialSearch)).parent=this,this.first=a;return{source:this.first}}if(this.spatialSearch.childTop>=n){if(!this.third)(a=new e(this.left,n,i,r,this.spatialSearch)).parent=this,this.third=a;return{source:this.third}}}else if(this.spatialSearch.childLeft>=o){if(this.spatialSearch.childBottom<=n){if(!this.second)(a=new e(o,this.top,i,r,this.spatialSearch)).parent=this,this.second=a;return{source:this.second}}if(this.spatialSearch.childTop>=n){var a;if(!this.fourth)(a=new e(o,n,i,r,this.spatialSearch)).parent=this,this.fourth=a;return{source:this.fourth}}}}return this,this.objects.push(this.spatialSearch.childNode),{target:this}},e.prototype.isContained=function(){return this.spatialSearch.childLeft>=this.left&&this.spatialSearch.childRight<=this.left+this.width&&this.spatialSearch.childTop>=this.top&&this.spatialSearch.childBottom<=this.top+this.height},e.prototype.addIntoAQuad=function(e){var t={};this.spatialSearch.setCurrentNode(e);for(var i=null;!t.isAdded;)i=(t=this.spatialSearch.parentQuad.add(i)).quad;return i},e.prototype.add=function(t){if(t=null,this.isContained())return{isAdded:!0,quad:t=this.selectQuad()};var i=void 0,r=!(0!==this.objects.length||this.first||this.second||this.third||this.fourth),o=2*this.width,n=2*this.height;return this.spatialSearch.childLeft<this.left?this.spatialSearch.childTop<this.top?(i=new e(this.left-this.width,this.top-this.height,o,n,this.spatialSearch),r||(i.fourth=this)):(i=new e(this.left-this.width,this.top,o,n,this.spatialSearch),r||(i.second=this)):this.spatialSearch.childTop<this.top?(i=new e(this.left,this.top-this.height,o,n,this.spatialSearch),r||(i.third=this)):(i=new e(this.left,this.top,o,n,this.spatialSearch),r||(i.first=this)),this.parent=i,this.spatialSearch.parentQuad=i,{isAdded:!1,quad:t}},e}(),yl=function(){function e(e){this.quadSize=500,this.objectTable=e,this.parentQuad=new ml(0,0,2*this.quadSize,2*this.quadSize,this),this.pageLeft=Number.MAX_VALUE,this.pageRight=-Number.MAX_VALUE,this.pageTop=Number.MAX_VALUE,this.pageBottom=-Number.MAX_VALUE,this.quadTable={}}return e.prototype.removeFromAQuad=function(e){if(this.quadTable[e.id]){var t=this.quadTable[e.id],i=this.objectIndex(t.objects,e);-1!==i&&(t.objects.splice(i,1),this.update(t),delete this.quadTable[e.id])}},e.prototype.update=function(e){if(e.parent&&0===e.objects.length&&e.first&&e.second&&e.third&&e.fourth){var t=e.parent;t.first===e?t.first=null:t.second===e?t.second=null:t.third===e?t.third=null:t.fourth===e&&(t.fourth=null),this.update(e.parent)}else e!==this.parentQuad||e.first||e.second||e.third||e.fourth||(e.left=0,e.width=1e3,e.top=0,e.height=1e3)},e.prototype.addIntoAQuad=function(e){var t=this.parentQuad.addIntoAQuad(e);this.quadTable[e.id]=t},e.prototype.objectIndex=function(e,t){for(var i=0;i<e.length;i++)if(e[i].id===t.id)return i;return-1},e.prototype.updateQuad=function(e){this.setCurrentNode(e);var t=e.outerBounds;if(isNaN(t.x)||isNaN(t.y)||isNaN(t.width)||isNaN(t.height))return!1;this.quadTable[e.id]?this.quadTable[e.id].isContained()||(this.removeFromAQuad(e),this.addIntoAQuad(e)):this.addIntoAQuad(e);if(!this.isWithinPageBounds(t)||this.leftElement===e||this.topElement===e||this.rightElement===e||this.bottomElement===e){var i=!1;return this.pageLeft===this.childLeft&&e===this.leftElement||(this.pageLeft>=this.childLeft?(this.pageLeft=this.childLeft,this.leftElement=e,i=!0):e===this.leftElement&&(this.pageLeft=Number.MAX_VALUE,this.findLeft(this.parentQuad),i=!0)),this.pageTop===this.childTop&&e===this.topElement||(this.pageTop>=this.childTop?(this.pageTop=this.childTop,this.topElement=e,i=!0):e===this.topElement&&(this.pageTop=Number.MAX_VALUE,this.findTop(this.parentQuad),i=!0)),this.pageBottom===this.childBottom&&e===this.bottomElement||(this.pageBottom<=this.childBottom?(i=!0,this.pageBottom=this.childBottom,this.bottomElement=e):e===this.bottomElement&&(this.pageBottom=-Number.MAX_VALUE,this.findBottom(this.parentQuad),i=!0)),this.pageRight===this.childRight&&e===this.rightElement||(this.pageRight<=this.childRight?(this.pageRight=this.childRight,this.rightElement=e,i=!0):e===this.rightElement&&(this.pageRight=-Number.MAX_VALUE,this.findRight(this.parentQuad),i=!0)),i}return this.setCurrentNode(null),!1},e.prototype.isWithinPageBounds=function(e){return e.left>=this.pageLeft&&e.right<=this.pageRight&&e.top>=this.pageTop&&e.bottom<=this.pageBottom},e.prototype.findQuads=function(e){var t=[];return this.parentQuad.findQuads(e,t),t},e.prototype.findObjects=function(e){for(var t=[],i=0,r=this.findQuads(e);i<r.length;i++)for(var o=0,n=r[i].objects;o<n.length;o++){var a=n[o];a.outerBounds.intersects(e)&&t.push(this.objectTable[a.id])}return t},e.prototype.updateBounds=function(e){var t=!1;return e===this.topElement&&(this.pageTop=Number.MAX_VALUE,this.topElement=null,this.findTop(this.parentQuad),t=!0),e===this.leftElement&&(this.pageLeft=Number.MAX_VALUE,this.leftElement=null,this.findLeft(this.parentQuad),t=!0),e===this.rightElement&&(this.pageRight=-Number.MAX_VALUE,this.rightElement=null,this.findRight(this.parentQuad),t=!0),e===this.bottomElement&&(this.pageBottom=-Number.MAX_VALUE,this.bottomElement=null,this.findBottom(this.parentQuad),t=!0),t},e.prototype.findBottom=function(e){e.third||e.fourth?(e.third&&this.findBottom(e.third),e.fourth&&this.findBottom(e.fourth)):(e.second&&this.findBottom(e.second),e.first&&this.findBottom(e.first));for(var t=0,i=e.objects;t<i.length;t++){var r=i[t];this.pageBottom<=r.outerBounds.bottom&&(this.pageBottom=r.outerBounds.bottom,this.bottomElement=r)}},e.prototype.findRight=function(e){e.second||e.fourth?(e.second&&this.findRight(e.second),e.fourth&&this.findRight(e.fourth)):(e.first&&this.findRight(e.first),e.third&&this.findRight(e.third));for(var t=0,i=e.objects;t<i.length;t++){var r=i[t];this.pageRight<=r.outerBounds.right&&(this.pageRight=r.outerBounds.right,this.rightElement=r)}},e.prototype.findLeft=function(e){e.first||e.third?(e.first&&this.findLeft(e.first),e.third&&this.findLeft(e.third)):(e.second&&this.findLeft(e.second),e.fourth&&this.findLeft(e.fourth));for(var t=0,i=e.objects;t<i.length;t++){var r=i[t];this.pageLeft>=r.outerBounds.left&&(this.pageLeft=r.outerBounds.left,this.leftElement=r)}},e.prototype.findTop=function(e){e.first||e.second?(e.first&&this.findTop(e.first),e.second&&this.findTop(e.second)):(e.third&&this.findTop(e.third),e.fourth&&this.findTop(e.fourth));for(var t=0,i=e.objects;t<i.length;t++){var r=i[t];this.pageTop>=r.outerBounds.top&&(this.pageTop=r.outerBounds.top,this.topElement=r)}},e.prototype.setCurrentNode=function(e){if(this.childNode=e,e){var t=e.outerBounds;this.childLeft=Number(t.left),this.childTop=Number(t.top),this.childRight=Number(t.right),this.childBottom=Number(t.bottom)}else this.childLeft=Number.MAX_VALUE,this.childTop=Number.MAX_VALUE,this.childRight=-Number.MAX_VALUE,this.childBottom=-Number.MAX_VALUE},e.prototype.getPageBounds=function(e,t){if(this.pageLeft===Number.MAX_VALUE)return new b(0,0,0,0);var i=void 0!==e?Math.min(this.pageLeft,0):this.pageLeft,r=void 0!==t?Math.min(this.pageTop,0):this.pageTop;return new b(Math.round(i),Math.round(r),Math.round(this.pageRight-i),Math.round(this.pageBottom-r))},e.prototype.getQuad=function(e){return this.quadTable[e.id]},e}(),vl=(Bd=function(e,t){return(Bd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Bd(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),bl=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},wl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vl(t,e),bl([sf.base.Property(!1)],t.prototype,"preventDefaults",void 0),t}(sf.base.ChildProperty),xl=(Ld=function(e,t){return(Ld=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ld(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Cl=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Sl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xl(t,e),Cl([sf.base.Property("")],t.prototype,"action",void 0),Cl([sf.base.Property("")],t.prototype,"cursor",void 0),t}(sf.base.ChildProperty),Pl=(Md=function(e,t){return(Md=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Md(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Tl=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Al=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pl(t,e),Tl([sf.base.Property(!0)],t.prototype,"inversedAlignment",void 0),t}(sf.base.ChildProperty),zl=(kd=function(e,t){return(kd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}kd(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ol=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Il=function(e,t,i,r){return new(i||(i=Promise))((function(o,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function s(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){e.done?o(e.value):new i((function(t){t(e.value)})).then(a,s)}h((r=r.apply(e,t||[])).next())}))},Dl=function(e,t){var i,r,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,r=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},El=function(t){function o(i,r){var o,n,a=t.call(this,i,r)||this;a.version=17.1,a.checkMenu=!1,a.isServerUpdate=!1,a.oldNodeObjects=[],a.oldDiagramObject={},a.oldConnectorObjects=[],a.canEnableBlazorObject=!1,a.connectorTable={},a.groupTable={},a.scrollActions=e.ScrollActions.None,a.blazorActions=e.BlazorAction.Default,a.activeLabel={id:"",parentId:"",isGroup:!1,text:void 0},a.textEditing=!1,a.isTriggerEvent=!1,a.preventNodesUpdate=!1,a.preventConnectorsUpdate=!1,a.callBlazorModel=!0,a.selectionConnectorsList=[],a.deleteVirtualObject=!1,a.changedConnectorCollection=[],a.changedNodesCollection=[],a.previousNodeCollection=[],a.previousConnectorCollection=[],a.crudDeleteNodes=[],a.blazorAddorRemoveCollection=[],a.blazorRemoveIndexCollection=[],a.diagramid=88123,a.selectedObject={helperObject:void 0,actualObject:void 0},a.renderTimer=null;var s=sf.base.isBlazor()&&window&&window.Blazor&&!a.dataSourceSettings.dataSource;a.ignoreCollectionWatch=!0;for(var h=0;i&&i.nodes&&h<i.nodes.length;h++)o=i.nodes[h],n=a.nodes[h],o.children&&o.children.length>0&&(o.style&&o.style.fill||(n.style.fill="transparent"),o.style&&o.style.strokeColor||(n.style.strokeColor="transparent")),o.shape&&"UmlActivity"===o.shape.type&&On(o,n),o.shape&&"SwimLane"===o.shape.type&&Pn(o,n),s&&a.previousNodeCollection.push(Ah(n,void 0,void 0,!0)),a.nodeDefaults&&Ln(n,o,a.nodeDefaults),a.updateAnnotationText(n.annotations);if(i&&i.connectors)for(h=0;i&&i.connectors&&h<i.connectors.length;h++)o=i.connectors[h],n=a.connectors[h],s&&a.previousConnectorCollection.push(Ah(n,void 0,void 0,!0)),a.connectorDefaults&&Ln(n,o,a.connectorDefaults),a.updateAnnotationText(n.annotations);for(h=0;i&&i.connectors&&h<i.connectors.length;h++){var d=i.connectors[h],l=a.connectors[h];if(d.shape&&"None"!==d.shape.type&&In(d,l),sf.base.isBlazor()){var c=Ah(a.bulkChanges);a.enableServerDataBinding(!0),a.protectPropertyChange(!0);for(var p=Object.keys(c),g=0;g<p.length;g++){var u=p[g],f=u.split("-");f&&f[0]&&("nodes"===f[0]&&(c[u].sfIndex=Number(f[1]),a.changedNodesCollection.push(c[u])),"connectors"===f[0]&&(c[u].sfIndex=Number(f[1]),a.changedConnectorCollection.push(c[u])))}}}return a}return zl(o,t),o.prototype.updateAnnotationText=function(e){if(sf.base.isBlazor()&&e.length>0)for(var t=0;e&&t<e.length;t++){var i=e[t];i.content=i.content.split("\\n").join("\n")}},o.prototype.callFromServer=function(e){if("getParentID"===e.methodName){var t=e.id;return this.nameTable[t].parentId}if("getEdges"===e.methodName){var i=e.outEdge;t=e.id;return i?this.nameTable[t].outEdges:this.nameTable[t].inEdges}if("updateDiagramObjects"===e.methodName){var r=e.obj;if(this.isServerUpdate=!0,e.IsAdding){this.add.apply(this,r)}else{this.remove.apply(this,r)}this.isServerUpdate=!1}else if("invokeLoadDiagramMethod"===e.methodName){this.loadDiagram(e.data)}},o.prototype.clearCollection=function(e){for(var t,i=[],r=0,o=Object.keys(this.nameTable);r<o.length;r++){var n=o[r];(t=this.nameTable[n])&&(e&&t instanceof wr||!e&&t instanceof js)&&i.push(t)}this.clearObjects(i)},o.prototype.onPropertyChanged=function(i,r){var n=!0,a=!1,s=!1;if(this.diagramActions&e.DiagramAction.Render){for(var h=0,d=Object.keys(i);h<d.length;h++){switch(d[h]){case"width":case"height":this.element.style.width=this.getSizeValue(this.width),this.element.style.height=this.getSizeValue(this.height),this.eventHandler.updateViewPortSize(this.element);for(var l=0,c=this.views;l<c.length;l++){var p=c[l];(R=this.views[p])instanceof o||R.updateView(R)}break;case"nodes":if(i.nodes.length>0&&0===r.nodes.length)this.clearCollection(),s=!0;else{for(var g=0,u=Object.keys(i.nodes);g<u.length;g++){var f=u[g],m=Number(f),y=this.nodes[m],v=i.nodes[m];a=a||void 0!==v.excludeFromLayout,this.nodePropertyChange(y,r.nodes[m],v,void 0,!0,!0);var b={element:_a(y),cause:this.diagramActions,oldValue:_a(r.nodes[m]),newValue:_a(i.nodes[m])};sf.base.isBlazor()&&(b.element={node:_a(y)},b.oldValue={node:_a(void 0)},b.newValue={node:_a(void 0)}),this.triggerEvent(e.DiagramEvent.propertyChange,b),n&&(n=!1)}"Canvas"===this.mode&&this.refreshDiagramLayer()}break;case"connectors":if(i.connectors.length>0&&0===r.connectors.length)this.clearCollection(!0),s=!0;else{for(var w=0,x=Object.keys(i.connectors);w<x.length;w++){f=x[w],m=Number(f),y=this.connectors[m];(v=i.connectors[m])&&(v.sourceDecorator||v.targetDecorator)&&(this.diagramActions|=e.DiagramAction.DecoratorPropertyChange),this.connectorPropertyChange(y,r.connectors[m],v,!0,!0),v&&(v.sourceDecorator||v.targetDecorator)&&(this.diagramActions=this.diagramActions&~e.DiagramAction.DecoratorPropertyChange);b={element:_a(y),cause:this.diagramActions,oldValue:_a(r.connectors[m]),newValue:_a(i.connectors[m])};sf.base.isBlazor()&&(b.element={connector:_a(y)},b.oldValue={connector:_a(void 0)},b.newValue={connector:_a(void 0)}),this.triggerEvent(e.DiagramEvent.propertyChange,b),y&&y.parentId&&"UmlClassifier"===this.nameTable[y.parentId].shape.type&&this.updateConnectorEdges(this.nameTable[y.parentId]||y),n&&(n=!1)}this.updateBridging(),"Canvas"===this.mode&&this.refreshDiagramLayer()}break;case"bridgeDirection":this.updateBridging(),"Canvas"===this.mode&&this.refreshDiagramLayer();break;case"backgroundColor":this.intOffPageBackground();break;case"pageSettings":this.validatePageSize(),this.updatePage();break;case"selectedItems":if(i.selectedItems.userHandles&&this.selectedItems.wrapper&&this.selectedItems.userHandles&&this.selectedItems.userHandles.length>0){this.renderSelector(!0);break}if(i.selectedItems.constraints){this.renderSelector(!0);break}break;case"snapSettings":this.updateSnapSettings(i);break;case"commandManager":this.initCommands();break;case"layout":a=!0;break;case"dataSourceSettings":this.clear(),this.initObjects(),"None"===this.layout.type?s=!0:a=!0;break;case"tooltip":Ai(this);break;case"rulerSettings":this.updateRulerSettings(i);break;case"layers":this.updateLayer(i);break;case"scrollSettings":this.scrollActions|=e.ScrollActions.PropertyChange,this.updateScrollSettings(i),this.scrollActions&=~e.ScrollActions.PropertyChange;break;case"locale":i.locale!==r.locale&&(this.realActions|=e.RealAction.PreventDataInit,t.prototype.refresh.call(this),this.realActions&=~e.RealAction.PreventDataInit);break;case"contextMenuSettings":if(void 0!==i.contextMenuSettings.showCustomMenuOnly&&(this.contextMenuSettings.showCustomMenuOnly=i.contextMenuSettings.showCustomMenuOnly),void 0!==i.contextMenuSettings.show&&(this.contextMenuSettings.show=i.contextMenuSettings.show),i.contextMenuSettings.items){for(var C=i.contextMenuSettings.items,S=0,P=Object.keys(C);S<P.length;S++){f=P[S],m=Number(f);this.contextMenuSettings.items[m]=C[m]}this.contextMenuModule&&this.contextMenuModule.refreshItems()}break;case"serializationSettings":void 0!==i.serializationSettings.preventDefaults&&(this.serializationSettings.preventDefaults=i.serializationSettings.preventDefaults)}}if(a&&!s){if(r.layout&&"DifferentPoint"===r.layout.connectionPointOrigin&&"SamePoint"===i.layout.connectionPointOrigin||r.layout&&i.layout&&!i.layout.enableRouting&&r.layout.enableRouting){for(var T=0;T<this.nodes.length;T++){var A=this.nodes[T];if(A.ports&&A.ports.length>0){for(var z=[],O=A.ports.length-1;O>=0;O--)"LineDistribution"===A.ports[O].id.split("_")[1]&&z.push(A.ports[O]);this.removePorts(A,z)}}for(O=0;O<this.connectors.length;O++){var I=this.connectors[O],D=I.sourcePortID,E=I.targetPortID;I.sourcePortID="",I.targetPortID="",I.sourcePortWrapper=void 0,I.targetPortWrapper=void 0,I.segments=[],this.connectorPropertyChange(I,{sourcePortID:D,targetPortID:E},{sourcePortID:"",targetPortID:""})}}this.doLayout(),this.renderReactTemplates()}if(n&&this.propertyChange){b={element:_a(this),cause:this.diagramActions,oldValue:_a(r),newValue:_a(i)};sf.base.isBlazor()&&(b.element={diagram:_a(this)},b.oldValue={diagram:_a(void 0)},b.newValue={diagram:_a(void 0)}),this.triggerEvent(e.DiagramEvent.propertyChange,b)}if(!s&&this.canLogChange()&&this.modelChanged(i,r)){var B={type:"PropertyChanged",undoObject:r,redoObject:i,category:"Internal"};this.historyManager&&this.addHistoryEntry(B)}this.resetDiagramActions(),s&&(this.initObjects(!0),this.refreshDiagramLayer(),a&&this.doLayout());var L=1===Object.keys(i).length&&void 0!==i.scrollSettings;if(!s)for(var M=0,k=this.views;M<k.length;M++){var R=k[M];(p=this.views[R])instanceof o||(i.scrollSettings&&i.scrollSettings.currentZoom!==r.scrollSettings.currentZoom&&p.updateHtmlLayer(p),L||this.refreshCanvasDiagramLayer(p))}this.resetTemplate()}},o.prototype.updateSnapSettings=function(e){(void 0!==e.snapSettings.constraints||e.snapSettings.horizontalGridlines||e.snapSettings.verticalGridlines||e.snapSettings.gridType)&&this.diagramRenderer.updateGrid(this.snapSettings,rh(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler)},o.prototype.updateRulerSettings=function(e){void 0!==e.rulerSettings.dynamicGrid&&this.diagramRenderer.updateGrid(this.snapSettings,rh(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),void 0!==e.rulerSettings.showRulers?(this.intOffPageBackground(),this.scroller.setSize(),this.renderRulers()):void 0===e.rulerSettings.horizontalRuler&&void 0===e.rulerSettings.verticalRuler||(void 0!==e.rulerSettings.horizontalRuler.thickness||void 0!==e.rulerSettings.verticalRuler.thickness?(Ar(this),this.intOffPageBackground(),this.scroller.setSize(),this.renderRulers()):Tr(this)),this.diagramRenderer.updateGrid(this.snapSettings,rh(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler)},o.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},o.prototype.preRender=function(){this.initializePrivateVariables(),this.isProtectedOnChange=!0,this.serviceLocator=new id,this.initializeServices(),this.setCulture();window.measureElement&&(window.measureElement=null),this.initDiagram(),this.initViews(),this.unWireEvents(),this.wireEvents(),this.element.classList.add("e-diagram")},o.prototype.initializePrivateVariables=function(){if(""===this.element.id){var e=document.getElementsByClassName("e-diagram").length;this.element.id="diagram_"+this.diagramid+"_"+e}this.defaultLocale={Copy:"Copy",Cut:"Cut",Paste:"Paste",Undo:"Undo",Redo:"Redo",SelectAll:"Select All",Grouping:"Grouping",Group:"Group",UnGroup:"Un Group",Order:"Order",BringToFront:"Bring To Front",MoveForward:"Move Forward",SendToBack:"Send To Back",SendBackward:"Send Backward"},this.layerZIndex=-1,this.layerZIndexTable={},this.nameTable={},this.pathTable={},this.groupTable={},this.commands={},this.isLoading||(this.views=[]),this.commandHandler=new ul(this),this.eventHandler=new sl(this,this.commandHandler),this.spatialSearch=new yl(this.nameTable),this.scroller=new fl(this)},o.prototype.initializeServices=function(){this.serviceLocator.register("localization",this.localeObj=new sf.base.L10n(this.getModuleName(),this.defaultLocale,this.locale))},o.prototype.setCulture=function(){this.localeObj=new sf.base.L10n(this.getModuleName(),this.defaultLocale,this.locale)},o.prototype.render=function(){this.refreshing&&this.dataSourceSettings.dataSource&&!this.isLoading&&(this.nodes=[],this.connectors=[]),this.ignoreCollectionWatch=!0;window.domTable={};var t=[];if(sf.base.isBlazor()){for(var i=[],r=[],o=0;o<this.changedNodesCollection.length;o++)i.push(this.commandHandler.deepDiffer.removeEmptyValues(this.changedNodesCollection[o]));for(o=0;o<this.changedConnectorCollection.length;o++)r.push(this.commandHandler.deepDiffer.removeEmptyValues(this.changedConnectorCollection[o]));var n="sfBlazor",a="Blazor",s={nodes:i,connectors:r};if(window&&window[a]&&!this.dataSourceSettings.dataSource&&(i.length>0||r.length>0)){var h={methodName:"UpdateBlazorProperties",diagramobj:s};window[n].updateBlazorProperties(h,this)}}this.dataSourceSettings.crudAction.read&&this.renderInitialCrud(),this.initHistory(),this.diagramRenderer=new qh(this.element.id,new Zh,"SVG"===this.mode),this.initLayers(),this.initializeDiagramLayers(),this.diagramRenderer.setLayers(),this.initObjects(!0);var d=!1;if(sf.base.isBlazor()&&!this.dataSourceSettings.dataSource&&"None"!==this.layout.type){for(var l=0,c=this.nodes;l<c.length;l++){h=c[l];this.insertValue(Ah(h),!0)}for(var p=0,g=this.connectors;p<g.length;p++){h=g[p];this.insertValue(Ah(h),!1)}d=!0}var u=this.nodes;for(o=0;o<u.length;o++)u[o].isExpanded||t.push(u[o]);if(t.length)for(o=t.length-1;o>=0;o--)this.commandHandler.expandNode(t[o],this);if(this.doLayout(),d&&this.commandHandler.getBlazorOldValues(),this.lineRoutingModule){var f=[],m=[],y=[];if(sf.base.isBlazor())for(var v=0,b=this.connectors;v<b.length;v++){h=b[v];f.push(Ah(h,void 0,void 0,!0))}if(this.lineRoutingModule.lineRouting(this),sf.base.isBlazor()){for(var w=0,x=this.connectors;w<x.length;w++){h=x[w];m.push(Ah(h,void 0,void 0,!0))}if(this.commandHandler.getObjectChanges(f,m,y),!(this.blazorActions&e.BlazorAction.ClearObject)){n="sfBlazor",a="Blazor",s={nodes:[],connectors:y};if(window&&window[a]){h={methodName:"UpdateBlazorProperties",diagramobj:s};window[n].updateBlazorProperties(h,this)}}}}this.validatePageSize(),this.renderPageBreaks(),this.diagramRenderer.renderSvgGridlines(this.snapSettings,rh(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),this.commandHandler.initSelectorWrapper(),this.notify("initial-load",{}),this.trigger("load"),this.scroller.setSize(),this.scroller.updateScrollOffsets(),this.refreshDiagramLayer(),(this.scrollSettings.verticalOffset>0||this.scrollSettings.horizontalOffset>0)&&this.updateScrollOffset(),sf.base.Browser.isDevice&&(this.tool=e.DiagramTools.ZoomPan|e.DiagramTools.SingleSelect),this.notify("initial-end",{}),this.isProtectedOnChange=!1,this.tooltipObject=Ai(this),this.diagramActions=e.DiagramAction.Render,this.initCommands();var C=document.getElementsByClassName(this.element.id+"_hiddenUserHandleTemplate");!function(e,t,i,r){var o,n,a,s,h,d=document.getElementById(r).ej2_instances[0];if(e&&t){o=Sh(e);for(var l=0,c=i.userHandles;l<c.length;l++)if(n=c[l],o){for(a=o(Ah(n),d,"userHandleTemplate_"+n.name,void 0,void 0,!1),s=0;s<a.length;s++){(h=hh("div",{style:"height: 100%; width: 100%; pointer-events: all",id:n.name+"_template_hiddenUserHandle"})).appendChild(a[s])}t[0].appendChild(h)}}else if(sf.base.isBlazor())for(var p=void 0,g=0,u=i.userHandles;g<u.length;g++)if(!(n=u[g]).pathData&&!n.content&&!n.source){for(s=0,p=(a=sf.base.compile(n.content))(_a(n),d,"userHandleTemplate","diagramsf_userHandle_template");s<p.length;s++){(h=hh("div",{style:"height: 100%; width: 100%; pointer-events: all",id:n.name+"_template_hiddenUserHandle"})).appendChild(p[s])}t[0].appendChild(h)}}(this.userHandleTemplate,C,this.selectedItems,this.element.id),this.updateTemplate(),this.isLoading=!1,this.renderComplete(),this.updateFitToPage(),this.refreshing&&this.renderReactTemplates()},o.prototype.updateFitToPage=function(){this.pageSettings&&this.pageSettings.fitOptions&&this.pageSettings.fitOptions.canFit&&this.fitToPage(this.pageSettings.fitOptions)},o.prototype.updateTemplate=function(){for(var e,t,i,r=0;r<this.nodes.length;r++)if("HTML"===(e=this.nodes[r]).shape.type||"Native"===e.shape.type){sf.base.updateBlazorTemplate("diagramsf_node_template","NodeTemplate",this,!1);break}for(r=0;r<this.nodes.length;r++)if((t=(e=this.nodes[r]).annotations[0])&&"Template"===t.annotationType){sf.base.updateBlazorTemplate("diagramsf_annotation_template","AnnotationTemplate",this,!1);break}for(r=0;r<this.connectors.length;r++)if((i=this.connectors[r].annotations[0])&&"Template"===i.annotationType){sf.base.updateBlazorTemplate("diagramsf_annotation_template","AnnotationTemplate",this,!1);break}for(r=0;r<this.selectedItems.userHandles.length;r++)if(this.selectedItems.userHandles[r].template){sf.base.updateBlazorTemplate("diagramsf_userHandle_template","UserHandleTemplate",this,!1);break}},o.prototype.resetTemplate=function(){for(var e,t,i,r=0;r<this.nodes.length;r++)if("HTML"===(e=this.nodes[r]).shape.type&&e.shape.content instanceof HTMLElement){sf.base.resetBlazorTemplate("diagramsf_node_template","NodeTemplate");break}for(r=0;r<this.nodes.length;r++)if((t=(e=this.nodes[r]).annotations[0])&&"Template"===t.annotationType&&t.content instanceof HTMLElement){sf.base.resetBlazorTemplate("diagramsf_annotation_template","AnnotationTemplate");break}for(r=0;r<this.connectors.length;r++)if((i=this.connectors[r].annotations[0])&&"Template"===i.annotationType&&i.content instanceof HTMLElement){sf.base.resetBlazorTemplate("diagramsf_annotation_template","AnnotationTemplate");break}for(r=0;r<this.selectedItems.userHandles.length;r++)if(this.selectedItems.userHandles[r].template){sf.base.updateBlazorTemplate("diagramsf_userHandle_template","UserHandleTemplate",this,!1);break}},o.prototype.renderInitialCrud=function(){var e,t=this;t.dataSourceSettings.crudAction.read&&((e=new sf.base.Ajax(t.dataSourceSettings.crudAction.read,"GET",!1)).onSuccess=function(e){t.dataSourceSettings.dataManager?t.dataSourceSettings.dataManager=JSON.parse(e):t.dataSourceSettings.dataSource=JSON.parse(e),t.dataBind()},e.send().then());t.dataSourceSettings.connectionDataSource.crudAction.read&&((e=new sf.base.Ajax(t.dataSourceSettings.connectionDataSource.crudAction.read,"GET",!1)).onSuccess=function(e){t.dataSourceSettings.connectionDataSource.dataManager=JSON.parse(e),t.dataBind()},e.send().then())},o.prototype.getModuleName=function(){return"diagram"},o.prototype.getClassName=function(){return"Diagram"},o.prototype.requiredModules=function(){var t=[];return t.push({member:"Bpmn",args:[]}),t.push({member:"Bridging",args:[]}),t.push({member:"ConnectorEditingTool",args:[]}),sf.base.isBlazor()&&t.push({member:"BlazorTooltip",args:[]}),this.constraints&e.DiagramConstraints.UndoRedo&&t.push({member:"UndoRedo",args:[]}),("OrganizationalChart"===this.layout.type||"HierarchicalTree"===this.layout.type||this.layout.enableAnimation)&&t.push({member:"LayoutAnimate",args:[]}),this.snapSettings.constraints&&t.push({member:"Snapping",args:[this]}),t.push({member:"PrintandExport",args:[this]}),this.contextMenuSettings.show&&t.push({member:"contextMenu",args:[this,this.serviceLocator]}),"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type||t.push({member:"OrganizationalChart",args:[this]}),"ComplexHierarchicalTree"===this.layout.type&&t.push({member:"ComplexHierarchicalTree",args:[]}),"MindMap"===this.layout.type&&t.push({member:"MindMapChart",args:[]}),"RadialTree"===this.layout.type&&t.push({member:"RadialTree",args:[]}),"SymmetricalLayout"===this.layout.type&&t.push({member:"SymmetricalLayout",args:[]}),(this.dataSourceSettings.dataManager||this.dataSourceSettings.dataSource||this.dataSourceSettings.crudAction.read||this.dataSourceSettings.connectionDataSource.crudAction.read)&&t.push({member:"DataBinding",args:[]}),this.constraints&e.DiagramConstraints.LineRouting&&t.push({member:"LineRouting",args:[]}),(this.layout&&"DifferentPoint"===this.layout.connectionPointOrigin||"Linear"===this.layout.arrangement||this.layout.enableRouting)&&t.push({member:"LineDistribution",args:[]}),t},o.prototype.removeUserHandlesTemplate=function(){if(this.selectedItems.userHandles.length)for(var e=0;e<this.selectedItems.userHandles.length;e++)for(var t=0,i=this.views;t<i.length;t++){var r=i[t];gh(this.selectedItems.userHandles[e].name+"_template_hiddenUserHandle",r)}},o.prototype.destroy=function(){if(clearInterval(this.renderTimer),this.renderTimer=null,this.hRuler&&this.vRuler&&(this.hRuler.destroy(),this.vRuler.destroy()),this.tooltipObject.destroy(),this.droppable.destroy(),this.unWireEvents(),this.notify("destroy",{}),t.prototype.destroy.call(this),this.removeUserHandlesTemplate(),this.clearTemplate(),document.getElementById(this.element.id)){this.element.classList.remove("e-diagram");for(var e=document.getElementsByClassName("e-diagram-tooltip");e.length>0;)e[0].parentNode.removeChild(e[0]);var i=document.getElementById(this.element.id+"content");i&&this.element.removeChild(i);if(window.measureElement){window.measureElement.usageCount-=1;window.measureElementCount--,0===window.measureElementCount&&(window.measureElement.parentNode.removeChild(window.measureElement),window.measureElement=null)}}window.domTable={};for(var r=0;r<this.layers.length;r++){this.layers[r].zIndexTable={}}this.diagramActions=void 0},o.prototype.wireEvents=function(){var e=sf.base.Browser.touchStartEvent,t=sf.base.Browser.touchEndEvent,i=sf.base.Browser.touchMoveEvent,r=sf.base.Browser.isPointer?"pointerleave":"mouseleave",o=sf.base.Browser.isPointer,n="mozilla"===sf.base.Browser.info.name?o?"mousewheel":"DOMMouseScroll":"mousewheel";sf.base.EventHandler.add(this.diagramCanvas,e,this.eventHandler.mouseDown,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,i,this.eventHandler.mouseMove,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,t,this.eventHandler.mouseUp,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,r,this.eventHandler.mouseLeave,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,"keydown",this.eventHandler.keyDown,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,"keyup",this.eventHandler.keyUp,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,"dblclick",this.eventHandler.doubleClick,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,"scroll",this.eventHandler.scrolled,this.eventHandler),sf.base.EventHandler.add(this.diagramCanvas,n,this.eventHandler.mouseWheel,this.eventHandler),sf.base.EventHandler.add(window,"resize",this.eventHandler.windowResize,this.eventHandler),this.initDroppables()},o.prototype.unWireEvents=function(){var e=sf.base.Browser.touchStartEvent,t=sf.base.Browser.touchMoveEvent,i=sf.base.Browser.isPointer?"pointerleave":"mouseleave",r=sf.base.Browser.isPointer,o="mozilla"===sf.base.Browser.info.name?r?"mousewheel":"DOMMouseScroll":"mousewheel",n=sf.base.Browser.touchEndEvent;sf.base.EventHandler.remove(this.diagramCanvas,e,this.eventHandler.mouseDown),sf.base.EventHandler.remove(this.diagramCanvas,t,this.eventHandler.mouseMove),sf.base.EventHandler.remove(this.diagramCanvas,n,this.eventHandler.mouseUp),sf.base.EventHandler.remove(this.diagramCanvas,i,this.eventHandler.mouseLeave),sf.base.EventHandler.remove(this.diagramCanvas,"keydown",this.eventHandler.keyDown),sf.base.EventHandler.remove(this.diagramCanvas,"keyup",this.eventHandler.keyUp),sf.base.EventHandler.remove(this.diagramCanvas,"dblclick",this.eventHandler.doubleClick),sf.base.EventHandler.remove(this.diagramCanvas,"scroll",this.eventHandler.scrolled),sf.base.EventHandler.remove(this.diagramCanvas,o,this.eventHandler.mouseWheel),sf.base.EventHandler.remove(window,"resize",this.eventHandler.windowResize)},o.prototype.select=function(e,t){if(sf.base.isBlazor()){for(var i=0;i<e.length;i++)e[i]=this.nameTable[e[i].id];e=this.nameTable[e.id]||e}null!=e&&this.commandHandler.selectObjects(e,t)},o.prototype.selectAll=function(){var e;e=this.getObjectsOfLayer(this.activeLayer.objects),this.select(e)},o.prototype.unSelect=function(e){sf.base.isBlazor()&&(this.commandHandler.oldSelectedObjects=Ah(this.selectedItems),e=this.nameTable[e.id]||e),e&&zd(this,e)&&(this.commandHandler.unSelect(e),this.commandHandler.updateBlazorSelector())},o.prototype.clearSelection=function(){this.commandHandler.clearSelection(!0)},o.prototype.updateViewPort=function(){var e=this.getZoomingAttribute();this.updateBlazorDiagramProperties(e),this.eventHandler.updateViewPortSize(this.element),this.updateBlazorDiagramProperties(e,!0)},o.prototype.cutCommand=function(){this.cut()},o.prototype.cut=function(){this.commandHandler.cut()},o.prototype.addProcess=function(e,t){this.bpmnModule&&this.bpmnModule.addProcess(e,t,this)},o.prototype.removeProcess=function(e){this.bpmnModule&&this.bpmnModule.removeProcess(e,this)},o.prototype.pasteCommand=function(){this.paste()},o.prototype.paste=function(e){this.commandHandler.paste(e)},o.prototype.fitToPage=function(e){var t=this.getZoomingAttribute();this.updateBlazorDiagramProperties(t),this.scroller.fitToPage(e),this.updateBlazorDiagramProperties(t,!0)},o.prototype.bringIntoView=function(e){var t=this.getZoomingAttribute();this.updateBlazorDiagramProperties(t),this.scroller.bringIntoView(e),this.updateBlazorDiagramProperties(t,!0)},o.prototype.bringToCenter=function(e){var t=this.getZoomingAttribute();this.updateBlazorDiagramProperties(t),this.scroller.bringToCenter(e),this.updateBlazorDiagramProperties(t,!0)},o.prototype.copyCommand=function(){this.copy()},o.prototype.copy=function(){return this.commandHandler.copy()},o.prototype.group=function(){this.callBlazorModel=!1,this.insertBlazorDiagramObjects(this.selectedItems),this.commandHandler.group(),this.callBlazorModel=!0,this.commandHandler.getBlazorOldValues()},o.prototype.unGroup=function(){this.callBlazorModel=!1,this.insertBlazorDiagramObjects(this.selectedItems),this.commandHandler.unGroup(),this.callBlazorModel=!0,this.commandHandler.getBlazorOldValues()},o.prototype.sendToBack=function(){this.commandHandler.sendToBack()},o.prototype.setActiveLayer=function(e){var t=this.commandHandler.getLayer(e);this.activeLayer=t},o.prototype.addLayer=function(e,t){this.commandHandler.addLayer(e,t)},o.prototype.addDiagramLayer=function(e,t){this.commandHandler.addLayer(e,t,!1)},o.prototype.removeLayer=function(e){this.commandHandler.removeLayer(e,sf.base.isBlazor())},o.prototype.removeDiagramLayer=function(e){this.commandHandler.removeLayer(e,!1)},o.prototype.moveObjects=function(e,t){var i=Ah(this.layers);this.enableServerDataBinding(!1),this.commandHandler.moveObjects(e,t);var r=this.commandHandler.deepDiffer.map(i,Ah(this.layers)),o=this.commandHandler.deepDiffer.frameObject({},r);this.oldDiagramObject={layers:o},this.commandHandler.updateBlazorProperties()},o.prototype.layerObjectUpdate=function(){if(sf.base.isBlazor()){this.enableServerDataBinding(!1),this.oldDiagramObject.layers=[];for(var e=0;e<this.layers.length;e++){var t=Ah(this.layers[e]);t.sfIndex=this.layers[e].zIndex,this.oldDiagramObject.layers.push(t)}}},o.prototype.sendLayerBackward=function(e){this.layerObjectUpdate(),this.commandHandler.sendLayerBackward(e),this.commandHandler.updateLayerObject(this.oldDiagramObject,!0)},o.prototype.bringLayerForward=function(e){this.layerObjectUpdate(),this.commandHandler.bringLayerForward(e),this.commandHandler.updateLayerObject(this.oldDiagramObject)},o.prototype.cloneLayer=function(e){this.commandHandler.cloneLayer(e)},o.prototype.bringToFront=function(){this.commandHandler.bringToFront()},o.prototype.moveForward=function(){this.commandHandler.sendForward()},o.prototype.sendBackward=function(){this.commandHandler.sendBackward()},o.prototype.getObject=function(e){return this.nameTable[e]},o.prototype.getNodeObject=function(e){return Ah(this.nameTable[e])},o.prototype.getConnectorObject=function(e){return Ah(this.nameTable[e])},o.prototype.getActiveLayer=function(){return this.activeLayer},o.prototype.nudgeCommand=function(e,t,i){"object"!==r(e)&&(this.selectedItems.nodes.length||this.selectedItems.connectors.length)>0&&this.nudge(e)},o.prototype.nudge=function(e,t,i){var r=0,o=0;"Left"===e||"Right"===e?r=("Left"===e?-1:1)*(t||1):o=("Up"===e?-1:1)*(i||1);var n=this.selectedItems,a=this.selectedItems.wrapper.children[0];if(a instanceof Se)this.commandHandler.labelDrag(n.nodes[0],a,r,o);else{var s=Ah(this.selectedItems);this.protectPropertyChange(!0),this.drag(n,r,o),this.protectPropertyChange(!1);var h={type:"PositionChanged",redoObject:Ah(this.selectedItems),undoObject:s,category:"Internal"};this.addHistoryEntry(h)}this.refreshCanvasLayers()},o.prototype.insertBlazorDiagramObjects=function(t){if(sf.base.isBlazor()&&!(this.blazorActions&e.BlazorAction.interaction)){if(this.enableServerDataBinding(!1),t instanceof Ys){for(var i=0;i<t.nodes.length;i++)this.insertBlazorDiagramObjects(t.nodes[i]);for(i=0;i<t.connectors.length;i++)this.insertBlazorDiagramObjects(t.connectors[i])}if(!(t instanceof Ys)){if(t&&t.children&&t.children.length>0)for(i=0;i<t.children.length;i++)this.insertBlazorDiagramObjects(this.nameTable[t.children[i]]);var r=Ah(this.nameTable[t.id]);this.insertValue(r,!(Ea(t)===wr))}}},o.prototype.drag=function(t,i,r){if((this.insertBlazorDiagramObjects(t),sf.base.isBlazor()&&t.id&&(t=this.nameTable[t.id]||t),this.bpmnModule&&t instanceof js)&&this.bpmnModule.updateAnnotationDrag(t,this,i,r))return;if(t instanceof Ys){if(this.preventConnectorsUpdate=!0,t.nodes&&t.nodes.length){for(var o=0,n=t.nodes;o<n.length;o++){var a=n[o];if(this.callBlazorModel=!1,this.drag(a,i,r),a.parentId){var s=this.nameTable[a.parentId];if(s.isLane)Ro(s,this.nameTable[s.parentId],a,this)}}this.callBlazorModel=!0}if(t.connectors&&t.connectors.length){this.callBlazorModel=!1;for(var h=0,d=t.connectors;h<d.length;h++){var l=d[h];this.drag(l,i,r),-1===this.selectionConnectorsList.indexOf(l)&&this.selectionConnectorsList.push(l)}this.callBlazorModel=!0}this.updateSelector(),this.diagramActions&e.DiagramAction.DragUsingMouse&&this.updatePage()}else t instanceof js&&this.bpmnModule&&this.bpmnModule.updateAnnotationDrag(t,this,i,r),this.commandHandler.drag(t,i,r);if(t instanceof Ys){this.preventConnectorsUpdate=!1;for(var c=0,p=this.selectionConnectorsList;c<p.length;c++){var g=p[c];this.updateConnectorProperties(this.nameTable[g.id]),"Bpmn"===g.shape.type&&"Default"===g.shape.sequence&&this.commandHandler.updatePathElementOffset(g)}this.selectionConnectorsList=[]}this.diagramActions&e.DiagramAction.ToolAction||this.diagramActions&e.DiagramAction.DragUsingMouse||this.updateSelector(),!this.callBlazorModel||this.blazorActions&e.BlazorAction.interaction||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||this.commandHandler.getBlazorOldValues()},o.prototype.disableStackContainerPadding=function(e,t){if(e instanceof Ja&&(e.considerPadding=t),e.children)for(var i=0,r=e.children;i<r.length;i++){var o=r[i];this.disableStackContainerPadding(o,!1)}},o.prototype.scale=function(t,i,r,o){this.disableStackContainerPadding(t.wrapper,!1),this.insertBlazorDiagramObjects(t);var n=!0;if(t.id&&(t=this.nameTable[t.id]||t),t instanceof Ys){if(t.nodes&&t.nodes.length){this.callBlazorModel=!1;for(var a=0,s=t.nodes;a<s.length;a++){var h=s[a];n=this.commandHandler.scale(h,i,r,o,t),this.commandHandler.checkBoundaryConstraints(void 0,void 0,t.wrapper.bounds)||this.commandHandler.scale(h,1/i,1/r,o,t)}this.callBlazorModel=!0}if(t.connectors&&t.connectors.length){this.callBlazorModel=!1;for(var d=0,l=t.connectors;d<l.length;d++){var c=l[d];this.commandHandler.scale(c,i,r,o,t),this.commandHandler.checkBoundaryConstraints(void 0,void 0,t.wrapper.bounds)||this.commandHandler.scale(c,1/i,1/r,o,t)}this.callBlazorModel=!0}this.updateSelector(),this.refreshCanvasLayers()}else this.commandHandler.scale(t,i,r,o,t.children?t:void 0);return!this.callBlazorModel||this.blazorActions&e.BlazorAction.interaction||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||this.commandHandler.getBlazorOldValues(),this.disableStackContainerPadding(t.wrapper,!0),n},o.prototype.rotate=function(t,i,r){var o;if(this.insertBlazorDiagramObjects(t),t.id&&(t=this.nameTable[t.id]||t),t)if(r=r||{x:t.wrapper.offsetX,y:t.wrapper.offsetY},t instanceof Ys){this.callBlazorModel=!1,t.rotateAngle+=i,t.wrapper.rotateAngle+=i;var n=Th(t.wrapper);if(!(o=this.commandHandler.checkBoundaryConstraints(void 0,void 0,n)))return t.rotateAngle-=i,t.wrapper.rotateAngle-=i,o;var a=[];a=(a=a.concat(t.nodes)).concat(t.connectors),this.commandHandler.rotateObjects(t,a,i,r),this.callBlazorModel=!0}else this.commandHandler.rotateObjects(t,[t],i,r);return!this.callBlazorModel||this.blazorActions&e.BlazorAction.interaction||this.commandHandler.getBlazorOldValues(),o},o.prototype.dragSourceEnd=function(e,t,i){this.insertBlazorDiagramObjects(e),this.commandHandler.dragSourceEnd(e,t,i),this.callBlazorModel&&this.commandHandler.getBlazorOldValues()},o.prototype.dragTargetEnd=function(e,t,i){this.insertBlazorDiagramObjects(e),this.commandHandler.dragTargetEnd(e,t,i),this.callBlazorModel&&this.commandHandler.getBlazorOldValues()},o.prototype.findObjectsUnderMouse=function(e,t){return this.eventHandler.findObjectsUnderMouse(e,t)},o.prototype.findObjectUnderMouse=function(e,t,i){return this.eventHandler.findObjectUnderMouse(e,t,i)},o.prototype.findTargetObjectUnderMouse=function(e,t,i,r,o){return this.eventHandler.findTargetUnderMouse(e,t,i,r,o)},o.prototype.findElementUnderMouse=function(e,t,i){return this.eventHandler.findElementUnderMouse(e,t,i)},o.prototype.findActionToBeDone=function(e,t,i,r){return this.eventHandler.findActionToBeDone(e,t,i,r)},o.prototype.getTool=function(e){var t,i=Wh(this.getCustomTool);return i&&(t=i(e))?t:this.eventHandler.getTool(e)},o.prototype.getCursor=function(e,t){var i,r=Wh(this.getCustomCursor);if(r&&(i=r(e,t)))return i;if(this.customCursor.length)for(var o=0;o<this.customCursor.length;o++)if(this.customCursor[o].action===e)return this.customCursor[o].cursor;return this.eventHandler.getCursor(e)},o.prototype.initHistory=function(){this.undoRedoModule&&this.undoRedoModule.initHistory(this)},o.prototype.addHistoryEntry=function(t){if(this.undoRedoModule&&this.constraints&e.DiagramConstraints.UndoRedo&&(!this.currentSymbol||this.checkCurrentSymbol(this.currentSymbol,t))){if(t.undoObject&&"helper"===t.undoObject.id)return;this.undoRedoModule.addHistoryEntry(t,this),"StartGroup"!==t.type&&"EndGroup"!==t.type&&this.historyChangeTrigger(t,"CustomAction")}},o.prototype.checkCurrentSymbol=function(e,t){var i=!1;if(t.undoObject&&t.redoObject){var r=t.undoObject,o=t.undoObject;return!(!o.id||!r.id||o.id===e.id||r.id===e.id)||i}return i},o.prototype.addCustomHistoryEntry=function(t){sf.base.isBlazor()&&this.undoRedoModule&&this.constraints&e.DiagramConstraints.UndoRedo&&(t.type=void 0,t.category="External",this.undoRedoModule.addHistoryEntry(t,this))},o.prototype.historyChangeTrigger=function(t,i){var r={},o=[];if("Internal"===t.category){switch(t&&t.redoObject&&t.redoObject.nodes instanceof Array&&t.redoObject.connectors instanceof Array?o=t.redoObject.nodes.concat(t.redoObject.connectors):t.redoObject&&o.push(t.redoObject),r.type=t.type,sf.base.isBlazor()&&(r.entryType=t.type),t.type){case"PositionChanged":r.oldValue={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY},r.newValue={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY};break;case"RotationChanged":r.oldValue={rotateAngle:t.undoObject.rotateAngle},r.newValue={rotateAngle:t.redoObject.rotateAngle};break;case"SizeChanged":r.oldValue={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY,width:t.undoObject.width,height:t.undoObject.height},r.newValue={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY,width:t.redoObject.width,height:t.redoObject.height};break;case"CollectionChanged":r[t.changeType]=o;break;case"ConnectionChanged":r.oldValue={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY},r.newValue={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY}}var n=void 0;if(n={cause:t.category,source:_a(o),change:_a(r),action:i},sf.base.isBlazor()){var a=(n={cause:t.category,change:_a(r),source:{connectors:void 0,nodes:void 0},action:i}).source;a.connectors=[],a.nodes=[];for(var s=void 0,h=0;h<o.length;h++)s=_a(o[h]),Ea(o[h])===wr?a.connectors.push(s):a.nodes.push(s);n.source=a}o.length&&this.triggerEvent(e.DiagramEvent.historyChange,n)}},o.prototype.startGroupAction=function(){this.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry({type:"StartGroup",category:"Internal"})},o.prototype.endGroupAction=function(){this.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry({type:"EndGroup",category:"Internal"})},o.prototype.undo=function(){this.canEnableBlazorObject=!0,this.callBlazorModel=!1,this.undoRedoModule&&this.constraints&e.DiagramConstraints.UndoRedo&&this.undoRedoModule.undo(this),this.commandHandler.getBlazorOldValues(),this.callBlazorModel=!0,this.canEnableBlazorObject=!1},o.prototype.redo=function(){this.canEnableBlazorObject=!0,this.callBlazorModel=!1,this.undoRedoModule&&this.constraints&e.DiagramConstraints.UndoRedo&&this.undoRedoModule.redo(this),this.commandHandler.getBlazorOldValues(),this.callBlazorModel=!0,this.canEnableBlazorObject=!1},o.prototype.getBlazorDiagramObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.insertBlazorDiagramObjects(e[t]);else this.insertBlazorDiagramObjects(this.selectedItems);this.callBlazorModel=!1,this.canEnableBlazorObject=!0},o.prototype.align=function(t,i,r){this.getBlazorDiagramObjects(i),i||(i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors)),this.diagramActions=this.diagramActions|e.DiagramAction.PublicMethod,this.commandHandler.align(i,t,r||"Object"),this.commandHandler.getBlazorOldValues(),this.callBlazorModel=!0,this.canEnableBlazorObject=!1},o.prototype.distribute=function(t,i){this.getBlazorDiagramObjects(i),i||(i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors)),this.diagramActions=this.diagramActions|e.DiagramAction.PublicMethod,this.commandHandler.distribute(i,t),this.commandHandler.getBlazorOldValues(),this.canEnableBlazorObject=!1,this.callBlazorModel=!0},o.prototype.sameSize=function(t,i){this.getBlazorDiagramObjects(i),i||(i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors)),this.diagramActions=this.diagramActions|e.DiagramAction.PublicMethod,this.commandHandler.sameSize(i,t),this.commandHandler.getBlazorOldValues(),this.canEnableBlazorObject=!1,this.callBlazorModel=!0},o.prototype.updateBlazorDiagramProperties=function(e,t){if(sf.base.isBlazor()&&!t){var i=this.allowServerDataBinding;this.enableServerDataBinding(!0);for(var r=0;r<e.length;r++)this.oldDiagramObject[e[r]]=Ah(this[e[r]]);this.enableServerDataBinding(i)}t&&this.commandHandler.getDiagramOldValues(this.oldDiagramObject,e)},o.prototype.getZoomingAttribute=function(){var e=[];return e.push("scrollSettings"),e.push("snapSettings"),e},o.prototype.zoom=function(t,i){var r=this.getZoomingAttribute();this.updateBlazorDiagramProperties(r),this.scroller.zoom(t,0,0,i),this.blazorActions&e.BlazorAction.interaction||this.updateBlazorDiagramProperties(r,!0)},o.prototype.zoomTo=function(e){var t=this.getZoomingAttribute();this.updateBlazorDiagramProperties(t);var i=e.zoomFactor?e.zoomFactor:.2;i="ZoomOut"===e.type?1/(1+i):1+i,this.scroller.zoom(i,0,0,e.focusPoint),this.updateBlazorDiagramProperties(t,!0)},o.prototype.pan=function(e,t,i){var r=this.getZoomingAttribute();this.updateBlazorDiagramProperties(r),this.setCursor("grabbing"),this.scroller.zoom(1,e,t,i),this.updateBlazorDiagramProperties(r,!0)},o.prototype.reset=function(){var e=this.getZoomingAttribute();this.updateBlazorDiagramProperties(e),this.scroller.zoom(1/this.scroller.currentZoom,-this.scroller.horizontalOffset,-this.scroller.verticalOffset,{x:0,y:0}),this.updateBlazorDiagramProperties(e,!0)},o.prototype.resetSegments=function(){var t=[],i=[],r=[];if(sf.base.isBlazor())for(var o=0,n=this.connectors;o<n.length;o++){var a=n[o];t.push(Ah(a,void 0,void 0,!0))}if(this.constraints&e.DiagramConstraints.LineRouting&&this.lineRoutingModule)this.lineRoutingModule.lineRouting(this);else{this.protectPropertyChange(!0);for(var s=void 0,h=0;h<this.connectors.length;h++)(s=this.connectors[h]).segments=[],this.connectorPropertyChange(s,{},{segments:s.segments});this.protectPropertyChange(!1)}if(sf.base.isBlazor()){for(var d=0,l=this.connectors;d<l.length;d++){a=l[d];i.push(Ah(a,void 0,void 0,!0))}this.commandHandler.getObjectChanges(t,i,r);var c={nodes:[],connectors:r};if(window&&window.Blazor){a={methodName:"UpdateBlazorProperties",diagramobj:c};window.sfBlazor.updateBlazorProperties(a,this)}}},o.prototype.setBlazorDiagramProps=function(e){var t=this.getZoomingAttribute();e?this.updateBlazorDiagramProperties(t):this.updateBlazorDiagramProperties(t,!0)},o.prototype.triggerEvent=function(t,i){return Il(this,void 0,void 0,(function(){var r;return Dl(this,(function(o){switch(o.label){case 0:return i&&this.updateEventValue(i),[4,this.trigger(e.DiagramEvent[t],i)];case 1:return r=o.sent(),sf.base.isBlazor()&&"string"==typeof r&&(r=JSON.parse(r)),[2,r]}}))}))},o.prototype.updateEventValue=function(e){var t=e.element;e.element&&t instanceof Ys&&t.nodes.length+t.connectors.length===1&&(e.element=1===t.nodes.length?t.nodes[0]:t.connectors[0])},o.prototype.addNodeToLane=function(e,t,i){if(this.nameTable[t]){var r=this.nameTable[t];if(this.protectPropertyChange(!0),this.undoRedoModule&&this.historyManager.startGroupAction(),this.nameTable[e.id]||(e.offsetX=r.wrapper.bounds.width+r.wrapper.bounds.x,e.offsetY=r.wrapper.bounds.height+r.wrapper.bounds.y,e=this.add(e)),e.parentId="",r.shape.phases.length)for(var o=0;o<r.shape.phases.length;o++){h=t+i+o;if(this.nameTable[h]&&this.nameTable[h].isLane){var n=this.nameTable[h].wrapper.bounds,a={x:n.x+(n.x-r.wrapper.bounds.x+e.margin.left+e.wrapper.bounds.width/2),y:n.y+r.wrapper.bounds.y-e.margin.top};if("Horizontal"===r.shape.orientation)a.y=n.y;else{a.x=n.x;var s=this.nameTable[h].parentId+r.shape.lanes[0].id+"_0_header";a.y=n.y+(r.wrapper.bounds.y-this.nameTable[s].wrapper.bounds.height+e.margin.top+e.wrapper.bounds.height/2)}if(n.containsPoint(a)||h===t+i+(r.shape.phases.length-1)){Mo(this,this.nameTable[h],e,void 0,!0),Ro(this.nameTable[h],r,e,this);break}}}else{var h=t+i+"0";this.nameTable[h]&&(Mo(this,this.nameTable[h],e,void 0,!0),Ro(this.nameTable[h],r,e,this))}this.undoRedoModule&&this.historyManager.endGroupAction(),this.protectPropertyChange(!1)}this.updateDiagramElementQuad()},o.prototype.showTooltip=function(e){e&&e.id&&!e.wrapper&&(e=this.nameTable[e.id]);var t=Th(e.wrapper),i={x:0,y:0},r=e.tooltip.content?e.tooltip.content:"X:"+Math.round(t.x)+" Y:"+Math.round(t.y);e&&"Custom"===e.tooltip.openOn&&(i=e instanceof js?{x:e.offsetX+e.width/2,y:e.offsetY+e.height/2}:{x:e.targetPoint.x,y:e.targetPoint.x},this.commandHandler.showTooltip(e,i,r,"SelectTool",!0))},o.prototype.hideTooltip=function(e){e&&"Custom"===e.tooltip.openOn&&this.tooltipObject.close()},o.prototype.addNode=function(e,t){return this.add(e,t)},o.prototype.addChildToGroup=function(t,i){var r=this.allowServerDataBinding;this.enableServerDataBinding(!1);var o=this.isProtectedOnChange;this.protectPropertyChange(!0),t=this.getObject(t.id),sf.base.isBlazor()&&this.insertValue(t,!0);var n=!(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.Group||this.diagramActions&e.DiagramAction.PreventHistory);n&&this.startGroupAction();var a=this.addChild(t,i);if(n){var s={};s[a]=Ah(this.getObject(a));var h={type:"AddChildToGroupNode",changeType:"Insert",undoObject:Ah(t),redoObject:Ah(t),category:"Internal",objectId:a,childTable:s};this.addHistoryEntry(h),this.endGroupAction()}this.protectPropertyChange(o),this.enableServerDataBinding(r),this.updateSelector(),sf.base.isBlazor()&&n&&this.commandHandler.getBlazorOldValues()},o.prototype.getHistoryStack=function(e){var t=[],i=e?this.historyManager.undoStack:this.historyManager.redoStack;if(void 0!==this.historyManager.stackLimit){for(var r=i.length-1;r>=0;r--)if(t.push(i[r]),t.length>this.historyManager.stackLimit)return t}else t=i;return t},o.prototype.getEdges=function(e){return e.outEdge?this.nameTable[e.id].outEdges:this.nameTable[e.id].inEdges},o.prototype.getParentId=function(e){return this.nameTable[e].parentId},o.prototype.addConnector=function(e){return this.add(e)},o.prototype.UpdateBlazorDiagramModelCollection=function(t,i,r,o){if(!(this.blazorActions&e.BlazorAction.ClearObject)){if(window&&window.Blazor){var n=void 0,a=[],s=[],h=[],d=[];if(o&&!i)for(var l=0;l<this.blazorAddorRemoveCollection.length;l++)h.push(Ea(this.blazorAddorRemoveCollection[l])===wr?"Connector":"Node"),n=_a(this.blazorAddorRemoveCollection[l]),s.push(n),d=this.blazorRemoveIndexCollection;else if(!this.isServerUpdate||r){this.isServerUpdate=!0;var c=_a(t),p=void 0,g=[];if(!i){g=r||this.commandHandler.getChildren(t,[]);for(l=0;l<g.length;l++)c=_a(g[l]),s.push(c),p=Ea(g[l])===wr?this.connectors.indexOf(g[l]):this.nodes.indexOf(g[l]),d.push(p),h.push(Ea(g[l])===wr?"Connector":"Node");r||(s.push(_a(t)),d.push(this.nodes.indexOf(t)),h.push(Ea(t)===wr?"Connector":"Node"))}if(i&&i.length>0)for(l=0;l<i.length;l++){c=_a(i[l]),i[l]instanceof js?s.push(c):a.push(c),h.push(Ea(i[l])===wr?"Connector":"Node")}this.isServerUpdate=!1}var u={methodName:"UpdateBlazorDiagramObjects",diagramobj:{nodeObj:JSON.stringify(s),ObjectType:h,removalIndex:i?void 0:d,isMultipleObjects:!0,annotationIndex:void 0,connectorObj:JSON.stringify(a)}};window.sfBlazor.updateBlazorProperties(u,this),o&&!i&&(this.blazorAddorRemoveCollection=[],this.blazorRemoveIndexCollection=[])}}},o.prototype.UpdateBlazorDiagramModel=function(t,i,r,o){if(!(this.blazorActions&e.BlazorAction.GroupClipboardInProcess)){if(window&&window.Blazor&&!this.isServerUpdate&&!(this.diagramActions&e.DiagramAction.Clear)){var n=_a(t),a={methodName:"UpdateBlazorDiagramObjects",diagramobj:{nodeObj:JSON.stringify(n),ObjectType:i,removalIndex:r,isMultipleObjects:!1,annotationIndex:o,connectorObj:void 0}};window.sfBlazor.updateBlazorProperties(a,this)}}},o.prototype.UpdateBlazorLabelOrPortObjects=function(t,i,r,o){if(window&&window.Blazor&&t.length>0&&!this.isServerUpdate&&!(this.diagramActions&e.DiagramAction.Clear)){for(var n=[],a=[],s=[],h=0;h<t.length;h++)n.push(_a(t[h])),a.push(i),s.push(o);var d={methodName:"UpdateBlazorDiagramObjects",diagramobj:{nodeObj:JSON.stringify(n),ObjectType:a,removalIndex:r,isMultipleObjects:!0,annotationIndex:s,connectorObj:null,portIndex:"Port"===i?s:[]}};window.sfBlazor.updateBlazorProperties(d,this)}},o.prototype.addBlazorDiagramObjects=function(){var t=[],i=[];if(this.dataBindingModule&&!(this.realActions&e.RealAction.PreventDataInit)){for(var r=0;r<this.nodes.length;r++)t.push(Ah(this.nodes[r],void 0,void 0,!0));for(r=0;r<this.connectors.length;r++)i.push(Ah(this.connectors[r],void 0,void 0,!0))}if(window&&window.Blazor){var o={methodName:"AddBlazorObjects",diagramobj:{nodeObj:JSON.stringify(t),isConnector:!1}};window.sfBlazor.updateBlazorProperties(o,this),o={methodName:"AddBlazorObjects",diagramobj:{nodeObj:JSON.stringify(i),isConnector:!0}},window.sfBlazor.updateBlazorProperties(o,this)}},o.prototype.removeNodeEdges=function(e,t,i){var r=this.nameTable[e],o=i?r.outEdges:r.inEdges;if(o.length>0)for(var n=0;n<o.length;n++)o[n]===t&&o.splice(n,1)},o.prototype.insertBlazorConnector=function(e){sf.base.isBlazor()&&e instanceof wr&&(e.sourceID&&this.nameTable[e.sourceID]&&this.insertValue(Ah(this.nameTable[e.sourceID]),!0),e.targetID&&this.nameTable[e.targetID]&&this.insertValue(Ah(this.nameTable[e.targetID]),!0))},o.prototype.add=function(t,r){var n,a=this.isProtectedOnChange;if(this.protectPropertyChange(!0),t){var s=void 0;s={element:t=Ah(t),cause:this.diagramActions,state:"Changing",type:"Addition",cancel:!1},this.parentObject&&(s.parentId=this.parentObject.id),sf.base.isBlazor()&&(s=Oa(s,t,"Changing","Addition")),"helper"===t.id||this.diagramActions&e.DiagramAction.PreventCollectionChangeOnDragOver||this.triggerEvent(e.DiagramEvent.collectionChange,s),s.cancel&&this.drawingObject&&(this.removeElements(s.element),this.tooltipObject.close(),Ea(s.element)===wr&&(s.element.sourceID&&this.removeNodeEdges(s.element.sourceID,s.element.id,!0),s.element.targetID&&this.removeNodeEdges(s.element.targetID,s.element.id,!1))),this.diagramActions=this.diagramActions|e.DiagramAction.PublicMethod,t.id=t.id||xh();var h=this.activeLayer;if(!s.cancel&&!h.lock){if(h.objects.indexOf(t.id)<0&&!h.lock&&(h.visible||(h.visible=!0,this.dataBind()),h.objects.push(t.id)),Ea(t)===wr)(n=new wr(this,"connectors",t,!0)).status="New",Ln(n,t,this.connectorDefaults),this.connectors.push(n),this.initObject(n),sf.base.isBlazor()&&(this.blazorActions&e.BlazorAction.GroupingInProgress?this.blazorAddorRemoveCollection.push(n):this.blazorAddorRemoveCollection.length>0?(this.isServerUpdate=!1,this.blazorAddorRemoveCollection.push(n),this.UpdateBlazorDiagramModelCollection(void 0,this.blazorAddorRemoveCollection,void 0,!0),this.blazorAddorRemoveCollection=[],this.commandHandler.getBlazorOldValues()):this.isServerUpdate||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||(this.UpdateBlazorDiagramModel(n,"Connector"),this.commandHandler.getBlazorOldValues())),!1===t.visible&&this.updateElementVisibility(n.wrapper,n,t.visible),this.updateEdges(n),this.insertBlazorConnector(n);else{if(Ln(n=new js(this,"nodes",t,!0),t,this.nodeDefaults),n.parentId=t.parentId,n.umlIndex=t.umlIndex,n.status="New",this.nodes.push(n),this.initObject(n,h,void 0,r),sf.base.isBlazor()&&(this.blazorActions&e.BlazorAction.GroupingInProgress?this.blazorAddorRemoveCollection.push(n):this.blazorAddorRemoveCollection.length>0?(this.blazorAddorRemoveCollection.push(n),this.isServerUpdate=!1,this.UpdateBlazorDiagramModelCollection(void 0,this.blazorAddorRemoveCollection,void 0,!0),this.commandHandler.getBlazorOldValues(),this.blazorAddorRemoveCollection=[]):this.isServerUpdate||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||(this.UpdateBlazorDiagramModel(n,"Node"),this.commandHandler.getBlazorOldValues())),this.updateTemplate(),this.bpmnModule){if(n.shape.annotations&&0!==n.shape.annotations.length)for(var d=0,l=this.bpmnModule.getTextAnnotationConn(n);d<l.length;d++){var c=l[d];this.initConnectors(c,h,!1)}n.shape.activity&&n.shape.activity.subProcess.processes&&n.shape.activity.subProcess.processes.length&&this.bpmnModule.updateDocks(n,this)}if(this.lineRoutingModule&&this.constraints&e.DiagramConstraints.LineRouting)for(var p=this.spatialSearch.findObjects(n.wrapper.outerBounds),g=0;g<p.length;g++){var u=p[g];u instanceof wr&&this.connectorPropertyChange(u,{},{sourceID:u.sourceID,targetID:u.targetID,sourcePortID:u.sourcePortID,targetPortID:u.targetPortID,sourcePoint:u.sourcePoint,targetPoint:u.targetPoint})}if(n.umlIndex>-1&&t.parentId&&this.nameTable[t.parentId]&&"UmlClassifier"===this.nameTable[t.parentId].shape.type){var f=this.nameTable[t.parentId];f.children.splice(n.umlIndex,0,n.id),f.wrapper.children.splice(n.umlIndex,0,n.wrapper),f.wrapper.measure(new i),f.wrapper.arrange(f.wrapper.desiredSize),this.updateDiagramObject(f)}}if(s={element:n,cause:this.diagramActions,state:"Changed",type:"Addition",cancel:!1},this.parentObject&&(s.parentId=this.parentObject.id),sf.base.isBlazor()&&(s=Oa(s,t,"Changed","Addition")),"helper"===t.id||this.diagramActions&e.DiagramAction.PreventCollectionChangeOnDragOver||this.triggerEvent(e.DiagramEvent.collectionChange,s),!(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.Group||this.diagramActions&e.DiagramAction.PreventHistory)){var m={type:"CollectionChanged",changeType:"Insert",undoObject:Ah(t),redoObject:Ah(t),category:"Internal"};this.addHistoryEntry(m)}this.parentObject=void 0,"SVG"===this.mode&&(this.updateSvgNodes(n),this.updateTextElementValue(n),this.updateDiagramObject(n),n.shape.activity&&n.shape.activity.subProcess.processes&&n.shape.activity.subProcess.processes.length&&this.updateProcesses(n),this.updateBridging())}}this.protectPropertyChange(a),this.resetDiagramActions(e.DiagramAction.PublicMethod),n&&this.layers.length>1&&this.moveNode(n);for(var y=0,v=this.views;y<v.length;y++){var b=v[y],w=this.views[b];w instanceof o||this.refreshCanvasDiagramLayer(w)}return this.renderReactTemplates(),n},o.prototype.updateSvgNodes=function(e){if(e.children)for(var t=0,i=e.children;t<i.length;t++){var r=i[t];if(this.nameTable[r]&&this.nameTable[r].parentId){var o=Ks(r+"_groupElement",this.element.id);o&&o.parentNode.removeChild(o)}}},o.prototype.updateProcesses=function(e){if(this.bpmnModule&&e&&e.shape&&e.shape.activity&&e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length){var t=e.shape.activity.subProcess.processes;this.moveSvgNode(e.id);for(var i=0,r=t;i<r.length;i++){var o=r[i];this.moveSvgNode(o);for(var n=[],a=(n=n.concat(this.nameTable[o].outEdges,this.nameTable[o].inEdges)).length-1;a>=0;a--)this.moveSvgNode(n[a])}for(var s=0,h=t;s<h.length;s++){o=h[s];this.nameTable[o].shape.activity.subProcess.processes&&this.nameTable[o].shape.activity.subProcess.processes.length&&this.updateProcesses(this.nameTable[o])}}else this.moveSvgNode(e.id)},o.prototype.moveSvgNode=function(e){var t=Ks(e+"_groupElement",this.element.id),i=t.parentElement;t.parentNode.removeChild(t),i.appendChild(t)},o.prototype.addTextAnnotation=function(t,i){if(this.bpmnModule){var r=this.bpmnModule.addAnnotation(i,t,this);if(this.initConnectors(r,this.commandHandler.getObjectLayer(i.id),!1),this.updateDiagramObject(i),!(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.Group)){var o={type:"CollectionChanged",changeType:"Insert",undoObject:Ah(t),redoObject:Ah(t),category:"Internal"};this.addHistoryEntry(o)}}},o.prototype.spliceConnectorEdges=function(e,t){var i=[],r=t?this.nameTable[e.sourceID]:this.nameTable[e.targetID];if(r){for(var o=(i=t?r.outEdges:r.inEdges).length-1;o>=0;o--)i[o]===e.id&&i.splice(o,1);for(var n=0;r.ports&&n<r.ports.length;n++){var a=!t;this.removePortEdges(r,r.ports[n].id,e.id,a)}}},o.prototype.removeDependentConnector=function(e){for(var t,i=[],r=(i=i.concat(e.outEdges,e.inEdges)).length-1;r>=0;r--)(t=this.nameTable[i[r]])&&(this.connectorTable[t.id]=Ah(t),this.remove(t))},o.prototype.removeObjectsFromLayer=function(e){if(e.children)for(var t=0;t<e.children.length;t++){var i=this.nameTable[e.children[t]];i&&this.removeObjectsFromLayer(i)}var r=this.layers.indexOf(this.commandHandler.getObjectLayer(e.id)),o=this.layers[r].objects.indexOf(e.id);o>-1&&(zd(this,e)&&this.unSelect(e),this.layers[r].objects.splice(o,1),delete this.layers[r].zIndexTable[this.nameTable[e.id].zIndex])},o.prototype.removeElements=function(e){if("SVG"===this.mode||"Canvas"===this.mode&&"Native"===e.shape.type){var t=Ks(e.id+"_groupElement",this.element.id),i=e;if(i.ports&&i.ports.length>0)for(var r=0;r<i.ports.length;r++){var o=i.ports[r],n=Ks(i.id+"_"+o.id+"_groupElement",this.element.id);n&&n.parentNode.removeChild(n)}t&&t.parentNode.removeChild(t)}if(this.refreshCanvasLayers(),e.wrapper){var a=e.wrapper.children,s=void 0;if(a)for(r=0;r<a.length;r++){if(a[r]instanceof je||a[r].id&&a[r].id.indexOf("icon_content")>0){a[r].id.indexOf("icon_content")>0&&"SVG"===this.mode&&((s=Ks(a[r].id+"_shape_groupElement",this.element.id))&&s.parentNode.removeChild(s),(s=Ks(a[r].id+"_rect_groupElement",this.element.id))&&s.parentNode.removeChild(s));for(var h=0,d=this.views;h<d.length;h++){var l=d[h];gh(a[r].id+"_groupElement",l);var c=this.scroller.removeCollection.indexOf(e.id);this.scroller.removeCollection.splice(c,1)}}else if(a[r]instanceof Yi)for(var p=0,g=this.views;p<g.length;p++){l=g[p];gh(e.id+"_html_element",l),gh(a[r].id+"_html_element",l),this.clearTemplate(["nodeTemplate_"+e.id]),a[r].annotationId&&this.clearTemplate(["annotationTemplate_"+e.id+a[r].annotationId])}ca(a[r].id)}}},o.prototype.removeCommand=function(){this.remove()},o.prototype.remove=function(t){var i,r=[];r=r.concat(this.selectedItems.nodes,this.selectedItems.connectors);var o=!1;if(t){if(t=this.nameTable[t.id],this.insertBlazorConnector(t),t&&(Br(t)||this.diagramActions&e.DiagramAction.Clear)&&(i={element:t,cause:this.diagramActions,state:"Changing",type:"Removal",cancel:!1},sf.base.isBlazor()&&(i=Oa(i,t,"Changing","Removal")),this.diagramActions&e.DiagramAction.Clear||"helper"===t.id||this.triggerEvent(e.DiagramEvent.collectionChange,i),!i.cancel)){if(Br(t)&&t&&t.shape&&"SwimLane"===t.shape.type&&function(t,i){var r,o,n,a,s,h,d=i.wrapper.children[0].rows;for(o=0;o<d.length;o++)for(n=0;n<d[o].cells.length;n++){if((s=un(d[o].cells[n]))&&s.children)for(a=s.children.length-1;a>=0;a--)s.children[a].children&&(h=t.nameTable[s.children[a].id])&&(h.isLane?fn(t,h):(t.removeDependentConnector(h),t.diagramActions|=e.DiagramAction.PreventHistory,h.constraints&e.NodeConstraints.Delete?t.remove(h):zo(t,h,{},!1),t.diagramActions&=~e.DiagramAction.PreventHistory));s&&(r=t.nameTable[s.id])&&fn(t,r)}}(this,t),this.bpmnModule&&this.bpmnModule.checkAndRemoveAnnotations(t,this))return void this.refreshCanvasLayers();if(!(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.PreventHistory||!(t instanceof js||t instanceof wr))){var n={type:"CollectionChanged",changeType:"Remove",undoObject:Ah(t),redoObject:Ah(t),category:"Internal"};this.diagramActions&e.DiagramAction.Clear||t.children&&!t.isLane&&!t.isPhase&&t.children.length>0&&this.undoRedoModule&&"None"===this.layout.type&&(this.historyManager.startGroupAction(),o=!0),t instanceof js&&this.removeDependentConnector(t),t.isLane||t.isPhase||this.diagramActions&e.DiagramAction.Clear||this.isStackChild(t)||this.addHistoryEntry(n)}!t.children||t.isLane||t.isPhase||sf.base.isBlazor()&&this.diagramActions&e.DiagramAction.UndoRedo||this.deleteGroup(t),t.parentId&&(this.deleteChild(t),this.nameTable[t.parentId]&&"UmlClassifier"===this.nameTable[t.parentId].shape.type&&(this.updateDiagramObject(this.nameTable[t.parentId]),this.updateConnectorEdges(this.nameTable[t.parentId])));var a=void 0;this.diagramActions=this.diagramActions|e.DiagramAction.PublicMethod;var s=this.nameTable[t.id];if(s instanceof js){if("Bpmn"===s.shape.type&&this.bpmnModule&&this.bpmnModule.removeBpmnProcesses(s,this),s.isLane||s.isPhase||"SwimLane"===s.shape.type){(h=s.isLane||s.isPhase?this.nameTable[s.parentId]:this.nameTable[s.id]).wrapper.children[0];s.isLane?mn(this,s,h):s.isPhase&&vn(this,s,h)}a=this.nodes.indexOf(s),sf.base.isBlazor()&&"helper"!==t.id&&(this.blazorActions&e.BlazorAction.GroupingInProgress?(this.blazorRemoveIndexCollection.splice(0,0,a),this.blazorAddorRemoveCollection.splice(0,0,t)):this.blazorAddorRemoveCollection.length>0?(this.commandHandler.getBlazorOldValues(),this.blazorRemoveIndexCollection.splice(0,0,a),this.blazorAddorRemoveCollection.splice(0,0,t),this.UpdateBlazorDiagramModelCollection(void 0,void 0,void 0,!0)):this.isServerUpdate||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||this.UpdateBlazorDiagramModel(t,"Node",a)),-1!==a&&(this.crudDeleteNodes.push(this.nameTable[s.id]),this.nodes.splice(a,1),this.updateNodeEdges(s))}else a=this.connectors.indexOf(s),sf.base.isBlazor()&&(this.blazorActions&e.BlazorAction.GroupingInProgress?(this.blazorAddorRemoveCollection.splice(0,0,t),this.blazorRemoveIndexCollection.splice(0,0,a)):this.blazorAddorRemoveCollection.length>0?(this.commandHandler.getBlazorOldValues(),this.blazorAddorRemoveCollection.splice(0,0,t),this.blazorRemoveIndexCollection.splice(0,0,a),this.UpdateBlazorDiagramModelCollection(void 0,void 0,void 0,!0)):this.isServerUpdate||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||this.UpdateBlazorDiagramModel(t,"Connector",a)),-1!==a&&(this.crudDeleteNodes.push(this.nameTable[s.id]),this.connectors.splice(a,1)),this.updateEdges(s),this.spliceConnectorEdges(t,!0),this.spliceConnectorEdges(t,!1);if(this.isServerUpdate||this.blazorActions&e.BlazorAction.GroupClipboardInProcess||this.commandHandler.getBlazorOldValues(),o&&this.historyManager.endGroupAction(),zd(this,s)&&this.unSelect(s),!s.isPhase){if(this.removeObjectsFromLayer(t),this.currentDrawingObject&&(this.currentDrawingObject.wrapper=void 0),delete this.nameTable[t.id],r.length>0&&r[0].id===s.id&&s.parentId){var h,d=this.nameTable[s.parentId];if(d&&d.isLane&&"SwimLane"===this.nameTable[d.parentId].shape.type)gn(this,h=this.nameTable[d.parentId],d,s)}this.removeElements(s),this.updateBridging(),"SVG"!==this.mode&&this.refreshDiagramLayer(),this.diagramActions&e.DiagramAction.Clear||(this.removeFromAQuad(s),i={element:t,cause:this.diagramActions,state:"Changed",type:"Removal",cancel:!1},sf.base.isBlazor()&&(i=Oa(i,t,"Changed","Removal")),"helper"!==t.id&&this.triggerEvent(e.DiagramEvent.collectionChange,i),this.resetTool())}}}else if(r.length>0){this.undoRedoModule&&(this.historyManager.startGroupAction(),this.blazorActions|=e.BlazorAction.GroupingInProgress,o=!0),sf.base.isBlazor()&&r.length>1&&this.clearSelection();for(var l=0;l<r.length;l++){r[l];if(this.nameTable[r[l].id]){if(r[l]instanceof wr&&this.bpmnModule&&this.bpmnModule.textAnnotationConnectors.indexOf(r[l])>-1)return void this.remove(this.nameTable[r[l].targetID]);sf.base.isBlazor()&&(!this.isServerUpdate&&r&&r.length>1&&(this.isServerUpdate=!0),r[l].parentId&&this.insertBlazorDiagramObjects(this.nameTable[r[l].parentId])),this.remove(r[l]),sf.base.isBlazor()&&r[l].parentId&&(this.commandHandler.getBlazorOldValues(),this.isServerUpdate=!1)}}o&&(this.blazorActions&=~e.BlazorAction.GroupingInProgress,this.isServerUpdate=!0,this.commandHandler.getBlazorOldValues(),this.UpdateBlazorDiagramModelCollection(void 0,void 0,void 0,!0),this.historyManager.endGroupAction(),this.isServerUpdate=!1),this.clearSelection()}if(this.tooltipObject.close(),sf.base.isBlazor()&&r&&r.length>0){for(var c=!0,p=0;p<r.length;p++)this.nameTable[r[p].id]&&(c=!1);c&&(this.isServerUpdate=!1)}},o.prototype.isStackChild=function(t){var i,r=this.nameTable[t.parentId];if(t&&t.parentId&&r.container&&"Stack"===r.container.type&&"UmlClassifier"!==this.nameTable[t.parentId].shape.type){i=!0;var o={type:"StackChildPositionChanged",redoObject:{sourceIndex:void 0,source:t,target:void 0,targetIndex:void 0},undoObject:{sourceIndex:r.wrapper.children.indexOf(t.wrapper),source:t,target:void 0,targetIndex:void 0},category:"Internal"};this.diagramActions&e.DiagramAction.UndoRedo||this.addHistoryEntry(o)}return i},o.prototype.deleteChild=function(e,t){var r;if(t=t?this.nameTable[t.id]:this.nameTable[e.parentId],r="string"==typeof e?e:e.id,t&&t.children){for(var o=0;o<t.children.length;o++)if(t.children[o]===r){t.children.splice(o,1);for(var n=0;n<t.wrapper.children.length;n++)t.wrapper.children[n].id===r&&t.wrapper.children.splice(n,1)}t.wrapper.measure(new i),t.wrapper.arrange(t.wrapper.desiredSize)}},o.prototype.addChild=function(e,t,r){var o,n=this.nameTable[e.id];if(n.children||(n.children=[]),n.children&&("string"==typeof t?this.nameTable[t]&&(o=t):(o=t.id=t.id||xh(),this.add(t)),o&&(!t.umlIndex||-1===t.umlIndex))){var a=this.nameTable[o];a.parentId=n.id,n.container&&"Stack"===n.container.type&&this.updateStackProperty(n,a),r?(n.children.splice(r,0,o),n.wrapper.children.splice(r,0,a.wrapper)):(n.children.push(o),n.wrapper.children.push(a.wrapper)),n.wrapper.measure(new i),n.wrapper.arrange(n.wrapper.desiredSize),n.isLane||(this.nameTable[e.id].width=n.wrapper.actualSize.width,this.nameTable[e.id].height=n.wrapper.actualSize.height,this.nameTable[e.id].offsetX=n.wrapper.offsetX,this.nameTable[e.id].offsetY=n.wrapper.offsetY),void 0!==n.container&&(a.offsetX=a.wrapper.offsetX,a.offsetY=a.wrapper.offsetY),(!n.parentId||this.nameTable[n.parentId]&&"SwimLane"!==this.nameTable[n.parentId].shape.type)&&this.updateDiagramObject(n)}return o},o.prototype.clear=function(){this.clearObjects()},o.prototype.clearObjects=function(t){var i=[];i=t||(i=i.concat(this.nodes)).concat(this.connectors),this.diagramActions=this.diagramActions|e.DiagramAction.Clear;for(var r=0,o=i;r<o.length;r++){var n=o[r];this.nameTable[n.id]&&this.remove(n)}this.diagramActions=this.diagramActions&~e.DiagramAction.Clear,this.spatialSearch=new yl(this.nameTable),this.initHistory()},o.prototype.startEditCommad=function(){var e,t=this.selectedItems.nodes[0]?this.selectedItems.nodes[0]:void 0;if(t&&t instanceof js)if(t.isLane&&t.parentId)for(var i=this.nameTable[t.parentId],r=i.shape.lanes,o=t.id.slice(i.id.length),n=o.substring(0,o.length-1),a=0;a<r.length;a++)t.isLane&&n===r[a].id&&(e=this.nameTable[r[a].header.id]);else if("SwimLane"===t.shape.type&&t.shape.header&&t.shape.hasHeader){var s=t.wrapper.children[0].rows[0].cells[0].children[0].id;e=this.nameTable[s]}this.startTextEdit(e)},o.prototype.startTextEdit=function(t,r){if(!Fr(this)&&!Gr(this)||Ur(this)){this.textEditing=!0;var o=this.scroller.transform,n=Jr(this)?o.scale:1,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0;if(t||(t=this.selectedItems.nodes[0]?this.selectedItems.nodes[0]:this.selectedItems.connectors[0]),t){if(sf.base.isBlazor()){var c=Ah(t);c.annotations.length>0&&this.insertValue(c,t instanceof js),t=this.nameTable[t.id]||t}t.shape&&"UmlClassifier"===t.shape.type&&(t=this.nameTable[t.children[0]]);var p=!1;if(this.bpmnModule&&(l=this.bpmnModule.getTextAnnotationWrapper(t,r))&&(t=this.nameTable[t.id.split("_textannotation_")[0]]),l?p=!0:("Text"!==t.shape.type&&0===t.annotations.length&&(t.constraints&e.NodeConstraints.ReadOnly||(this.activeLabel.isGroup=!0,this.startGroupAction(),this.addLabels(t,[{id:xh(),content:""}]))),!r&&("Text"!==t.shape.type&&t.annotations.length>0||"Text"===t.shape.type)&&(r="Text"===t.shape.type?t.wrapper.children[0].id.split("_")[1]:t.annotations[0].id),r&&(l=this.getWrapper(t.wrapper,r))),t&&l&&!(l instanceof Yi)&&(!function(t,i){var r;return r=i instanceof wr?e.ConnectorConstraints.ReadOnly:e.NodeConstraints.ReadOnly,"Text"===i.shape.type?i.constraints&e.NodeConstraints.ReadOnly:i.constraints&r?t.constraints&e.AnnotationConstraints.InheritReadOnly?1:0:t.constraints&e.AnnotationConstraints.ReadOnly?1:0}(l,t)||p)){var g=l.style,u=void 0;u=90>(u=l.bounds.width<t.wrapper.bounds.width?l.bounds.width:t.wrapper.bounds.width)?90:u;var f=document.getElementById(this.element.id+"_editTextBoxDiv"),m=document.getElementById(this.element.id+"_editBox");a=m?m.value:l.content,this.activeLabel.text=a,f||m||(f=hh("div",{}),m=hh("textarea",{}),this.diagramCanvas.appendChild(f),f.appendChild(m),m.appendChild(document.createTextNode(a))),(s=Fs(l.style,a,void 0,void 0,u)).isEmpty()&&(s="Text"!==t.shape.type?new i(va(t,l.id.split(t.id+"_")[1]).width||50,l.style.fontSize):new i(t.width>50?50:t.width,l.style.fontSize)),t.parentId&&"UmlClassifier"===this.nameTable[t.parentId].shape.type?(s.width=t.wrapper.bounds.width-20,h=(t.wrapper.bounds.center.x+o.tx)*o.scale-s.width/2*n-2.5,d=(t.wrapper.bounds.center.y+o.ty)*o.scale-s.height/2*n-3,l.style.textAlign="Left"):(s.width=Math.max(s.width,50),h=(l.bounds.center.x+o.tx)*o.scale-s.width/2*n-2.5,d=(l.bounds.center.y+o.ty)*o.scale-s.height/2*n-3),yh(f,{id:this.element.id+"_editTextBoxDiv",style:"position: absolute;left:"+h+"px;top:"+d+"px;width:"+(s.width+1)*n+"px;height:"+s.height*n+"px; containerName:"+t.id+";"}),yh(m,{id:this.element.id+"_editBox",style:"width:"+(s.width+1)*n+"px;height:"+s.height*n+"px;resize: none;outline: none;overflow: hidden;;font-family:"+g.fontFamily+";font-size:"+g.fontSize*n+"px;text-align:"+l.style.textAlign.toLocaleLowerCase()+";",class:"e-diagram-text-edit"}),m.style.fontWeight=g.bold?"bold":"",m.style.fontStyle=g.italic?"italic":"",m.style.lineHeight=(1.2*g.fontSize+"px;").toString(),m.style.textDecoration=g.textDecoration?g.textDecoration:"",this.activeLabel.parentId=t.id,this.activeLabel.id=r,l.visible=!1,this.updateDiagramObject(t),this.diagramActions=this.diagramActions|e.DiagramAction.TextEdit,this.isTriggerEvent||(sf.base.EventHandler.add(m,"input",this.eventHandler.inputChange,this.eventHandler),sf.base.EventHandler.add(m,"focusout",this.focusOutEdit,this),m.select())}}}},o.prototype.updateConnectorfixedUserHandles=function(e){if(e.fixedUserHandles.length)for(var t=void 0,r=0,o=e.fixedUserHandles;r<o.length;r++){var n=o[r];t=this.getWrapper(e.wrapper,n.id),e.updateAnnotation(n,e.intermediatePoints,e.wrapper.bounds,t)}e.wrapper.measure(new i(e.wrapper.width,e.wrapper.height)),e.wrapper.arrange(e.wrapper.desiredSize)},o.prototype.updateNodeExpand=function(e,t){for(var i=0;i<e.outEdges.length;i++){var r=this.nameTable[e.outEdges[i]],o=this.nameTable[r.targetID];r.visible=t,t||(this.updateElementVisibility(r.wrapper,r,!1),o.isExpanded=t),this.updateNodeExpand(o,o.isExpanded),o.visible=t,t||this.updateElementVisibility(o.wrapper,o,!1)}},o.prototype.updateConnectorAnnotation=function(t){if(t.annotations.length)for(var r=void 0,o=0,n=t.annotations;o<n.length;o++){var a=n[o];r=this.getWrapper(t.wrapper,a.id),t.updateAnnotation(a,t.intermediatePoints,t.wrapper.bounds,r,this.diagramActions&e.DiagramAction.Interactions)}t.wrapper.measure(new i(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize)},o.prototype.removeChildrenFromLayout=function(e){for(var t,i=[],r=0;r<e.length;r++)(t=e[r]).parentId||t.processId||i.push(t);return i},o.prototype.doLayout=function(){var t,r=!1,o="ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type,n=this.isProtectedOnChange;this.protectPropertyChange(!0);var a=this.removeChildrenFromLayout(this.nodes),s=this.layout.enableRouting&&"ComplexHierarchicalTree"===this.layout.type,h={x:this.scroller.viewPortWidth,y:this.scroller.viewPortHeight};if("None"!==this.layout.type){if((s||"DifferentPoint"===this.layout.connectionPointOrigin&&this.lineDistributionModule&&o||"Linear"===this.layout.arrangement)&&this.lineDistributionModule.initLineDistribution(this.layout,this),this.organizationalChartModule)t=this.organizationalChartModule.updateLayout(a,this.nameTable,this.layout,h,this.dataSourceSettings.id,this.diagramActions),r=!0,this.layoutAnimateModule&&t.rootNode&&!this.diagramActions&&this.updateNodeExpand(t.rootNode,t.rootNode.isExpanded);else if(this.mindMapChartModule)a&&a.length>0&&this.mindMapChartModule.updateLayout(a,this.nameTable,this.layout,h,this.dataSourceSettings.id,this.dataSourceSettings.root),r=!0;else if(this.radialTreeModule)this.radialTreeModule.updateLayout(a,this.nameTable,this.layout,h),r=!0;else if(this.symmetricalLayoutModule)this.symmetricalLayoutModule.maxIteration=this.layout.maxIteration,this.symmetricalLayoutModule.springLength=this.layout.springLength,this.symmetricalLayoutModule.springFactor=this.layout.springFactor,this.symmetricalLayoutModule.updateLayout(a,this.connectors,this.symmetricalLayoutModule,this.nameTable,this.layout,h),r=!0;else if(this.complexHierarchicalTreeModule){var d=this.complexHierarchicalTreeModule.getLayoutNodesCollection(this.nodes);d.length>0&&this.complexHierarchicalTreeModule.doLayout(d,this.nameTable,this.layout,h,this.lineDistributionModule),r=!0}if(r){this.preventDiagramUpdate=!0;var l={},c=a;sf.base.isBlazor()&&this.updateTemplate();for(var p=0,g=c;p<g.length;p++){var u=g[p];if(this.preventNodesUpdate||this.diagramActions&&this.diagramActions&e.DiagramAction.PreventIconsUpdate||(this.updateIcon(u),this.updateDefaultLayoutIcons(u)),this.preventNodesUpdate=!0,this.nodePropertyChange(u,{},{offsetX:u.offsetX,offsetY:u.offsetY},!0),this.preventNodesUpdate=!1,u.wrapper.measure(new i(u.wrapper.width,u.wrapper.height)),u.wrapper.arrange(u.wrapper.desiredSize),this.updateDiagramObject(u,!0),u.inEdges.length>0)for(var f=0;f<u.inEdges.length;f++){l[(x=this.nameTable[u.inEdges[f]]).id]=x}if(u.outEdges.length>0)for(var m=0;m<u.outEdges.length;m++){var y=this.nameTable[u.outEdges[m]];l[y.id]=y}}for(var v=0,b=Object.keys(l);v<b.length;v++){var w=b[v];s&&this.lineDistributionModule.resetConnectorSegments(this.nameTable[w]);var x=l[w],C=this.getPoints(x);s&&this.lineDistributionModule.resetRoutingSegments(x,this,C),ga(x,C),"Bpmn"===x.shape.type&&"Default"===x.shape.sequence&&this.commandHandler.updatePathElementOffset(x),x.wrapper.measure(new i(void 0,void 0)),x.wrapper.arrange(x.wrapper.desiredSize),this.updateConnectorAnnotation(x),this.updateConnectorfixedUserHandles(x),this.updateQuad(x),this.updateDiagramObject(x,!0)}(s||"DifferentPoint"===this.layout.connectionPointOrigin&&this.lineDistributionModule&&o)&&this.lineDistributionModule.distributeLines(this.layout,this),this.preventDiagramUpdate=!1,this.updatePage(),this.diagramActions&e.DiagramAction.Render&&"Canvas"!==this.mode||this.refreshDiagramLayer()}n||this.protectPropertyChange(n)}return r&&this.updateDiagramElementQuad(),this.blazorActions&e.BlazorAction.expandNode?t:!sf.base.isBlazor()||null},o.prototype.saveDiagram=function(){return Qn(this)},o.prototype.loadDiagram=function(e){return ea(e,this)},o.prototype.getDiagramContent=function(e){return this.printandExportModule?this.printandExportModule.getDiagramContent(e):""},o.prototype.exportImage=function(e,t){this.printandExportModule&&this.printandExportModule.exportImages(e,t)},o.prototype.printImage=function(e,t){this.printandExportModule&&(t.printOptions=!0,this.printandExportModule.exportImages(e,t))},o.prototype.setStackLimit=function(e){this.undoRedoModule&&e&&(this.historyManager.stackLimit=e,this.undoRedoModule.applyLimit(this.historyManager.currentEntry,e,this,!0))},o.prototype.clearHistory=function(){this.undoRedoModule&&this.undoRedoModule.clearHistory(this)},o.prototype.getDiagramBounds=function(){if(this.printandExportModule){var e=this.printandExportModule.getDiagramBounds("",{});return e.width=e.width>this.scrollSettings.viewPortWidth?e.width+(e.x>0?e.x:0):this.scrollSettings.viewPortWidth,e.height=e.height>this.scrollSettings.viewPortHeight?e.height+(e.y>0?e.y:0):this.scrollSettings.viewPortHeight,e.x=e.x>0?0:e.x,e.y=e.y>0?0:e.y,e}return new b},o.prototype.exportDiagram=function(e){return this.printandExportModule?this.printandExportModule.exportDiagram(e):""},o.prototype.print=function(e){this.printandExportModule&&this.printandExportModule.print(e)},o.prototype.addPorts=function(t,r){this.protectPropertyChange(!0);var o,n=[],a=!0;sf.base.isBlazor()&&null!==t&&t.ports.length>0&&!(this.diagramActions&e.DiagramAction.UndoRedo)&&(-1!==Number(xa(t,r[0].id,!1))&&(a=!1));t=this.nameTable[t.id]||t,r.length>1&&this.startGroupAction();for(var s=0;s<r.length;s++){if(o=new Ve(t,"ports",r[s],!0),t.ports.push(o),sf.base.isBlazor()&&a&&n.push(o),t.children){var h=t.wrapper;t.initPort(this.getDescription,t.wrapper.children[h.children.length-1],o)}else{t.wrapper.children.push(t.initPortWrapper(t.ports[t.ports.length-1]))}if(!(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.Group)){var d={type:"PortCollectionChanged",changeType:"Insert",undoObject:Ah(o),redoObject:Ah(t),category:"Internal"};this.addHistoryEntry(d)}}r.length>1&&this.endGroupAction(),sf.base.isBlazor()&&a&&this.UpdateBlazorLabelOrPortObjects(n,"Port",void 0,this.nodes.indexOf(t)),t.wrapper.measure(new i(t.width,t.height)),t.wrapper.arrange(t.wrapper.desiredSize),this.updateDiagramObject(t),this.protectPropertyChange(!1)},o.prototype.addConstraints=function(e,t){return e|t},o.prototype.removeConstraints=function(e,t){return e&~t},o.prototype.addNodeLabels=function(e,t){this.addLabels(e,t)},o.prototype.addConnectorLabels=function(e,t){this.addLabels(e,t)},o.prototype.addLabels=function(t,r){this.protectPropertyChange(!0);var o=!0,n=[];sf.base.isBlazor()&&null!=t&&t.annotations.length>0&&!(this.diagramActions&e.DiagramAction.UndoRedo)&&(-1!==Number(xa(t,r[0].id,!0))&&(o=!1));var a,s=(t=this.nameTable[t.id]||t).wrapper;r.length>1&&this.startGroupAction();for(var h=0;h<r.length;h++){if(t instanceof js)if(a=new Fe(t,"annotations",r[h],!0),t.annotations.push(a),sf.base.isBlazor()&&o&&n.push(a),t.children)for(var d=t,l=0;l<d.wrapper.children.length;l++){if(d.wrapper.children[l].id===d.id+"group_container")d.wrapper.children[l].children.push(t.initAnnotationWrapper(t.annotations[t.annotations.length-1],this.element.id))}else s.children.push(t.initAnnotationWrapper(t.annotations[t.annotations.length-1],this.element.id));else if(t instanceof wr){a=new Ze(t,"annotations",r[h],!0),t.annotations.push(a),sf.base.isBlazor()&&o&&n.push(a);var c=s.children[0],p=new b(c.offsetX-c.width/2,c.offsetY-c.height/2,c.width,c.height);s.children.push(t.getAnnotationElement(t.annotations[t.annotations.length-1],t.intermediatePoints,p,this.getDescription,this.element.id))}if(!(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.Group)){var g={type:"LabelCollectionChanged",changeType:"Insert",undoObject:Ah(a),redoObject:Ah(t),category:"Internal"};this.addHistoryEntry(g)}}r.length>1&&this.endGroupAction(),sf.base.isBlazor()&&o&&this.UpdateBlazorLabelOrPortObjects(n,t instanceof js?"NodeAnnotation":"ConnectorAnnotation",void 0,t instanceof js?this.nodes.indexOf(t):this.connectors.indexOf(t)),t.wrapper.measure(new i(s.width,s.height)),t.wrapper.arrange(s.desiredSize),this.updateDiagramObject(t),this.protectPropertyChange(!1)},o.prototype.addLanes=function(e,t,i){e=this.nameTable[e.id]||e;for(var r=0;r<t.length;r++)an(this,e,t[r],i),void 0!==i&&(i+=1);this.updateDiagramElementQuad()},o.prototype.addPhases=function(e,t){e=this.nameTable[e.id]||e;for(var i=0;i<t.length;i++)hn(this,e,t[i]);this.updateDiagramElementQuad()},o.prototype.removeLane=function(e,t){mn(this,void 0,e,t),this.updateDiagramElementQuad()},o.prototype.removePhase=function(e,t){vn(this,void 0,e,t),this.updateDiagramElementQuad()},o.prototype.removelabelExtension=function(t,i,r,o){for(var n=0;n<o.children.length;n++){var a=o.children[n];if((a instanceof Se||a instanceof Yi)&&a.id.match("_"+i[r].id+"$")){for(var s=0;s<t.annotations.length;s++)if(a.id.match("_"+t.annotations[s].id+"$")){if(!(this.diagramActions&e.DiagramAction.UndoRedo)){var h={type:"LabelCollectionChanged",changeType:"Remove",undoObject:Ah(t.annotations[s]),redoObject:Ah(t),category:"Internal"};this.addHistoryEntry(h)}t.annotations.splice(s,1)}if(o.children.splice(n,1),"SVG"===this.mode){var d=Ks(a.id,this.element.id);if(d){var l=Ks(a.id,this.element.id);l.parentNode.removeChild(l)}Ks(a.id+"_text",this.element.id)&&(d=Ks(a.id+"_text",this.element.id)).parentNode.removeChild(d);var c=Ks(a.id+"_html_element",this.element.id);c&&c.parentNode.removeChild(c)}else this.refreshCanvasLayers()}}},o.prototype.removeLabels=function(t,i){var r=!0;!sf.base.isBlazor()||null===t||this.diagramActions&e.DiagramAction.UndoRedo||-1===(s=t.annotations.length>0?Number(xa(t,i[0].id,!0)):-1)&&(r=!1);if(t=this.nameTable[t.id]||t,sf.base.isBlazor()&&r){for(var o=[],n=[],a=0;a<i.length;a++){var s=Number(xa(t,i[a].id,!0));n.push(s),o.push(i[a])}this.UpdateBlazorLabelOrPortObjects(o,t instanceof js?"NodeAnnotation":"ConnectorAnnotation",n,t instanceof js?this.nodes.indexOf(t):this.connectors.indexOf(t))}i.length>1&&this.startGroupAction();for(a=i.length-1;a>=0;a--)if(t.children&&t.children.length>0)for(var h=0;h<t.wrapper.children.length;h++)this.removelabelExtension(t,i,a,t.wrapper.children[h]);else this.removelabelExtension(t,i,a,t.wrapper);i.length>1&&this.endGroupAction()},o.prototype.removePortsExtenion=function(t,i,r,o){for(var n=0;n<o.children.length;n++){var a=o.children[n];if(a instanceof Me&&a.id.match("_"+i[r].id+"$")){for(var s=0;s<t.ports.length;s++)if(a.id.match("_"+t.ports[s].id+"$")){if(!(this.diagramActions&e.DiagramAction.UndoRedo)){var h={type:"PortCollectionChanged",changeType:"Remove",undoObject:Ah(t.ports[s]),redoObject:Ah(t),category:"Internal"};this.addHistoryEntry(h)}t.ports.splice(s,1)}if(o.children.splice(n,1),"SVG"===this.mode){var d=Ks(a.id,this.element.id);d.parentNode.removeChild(d)}else this.refreshCanvasLayers()}}},o.prototype.removePorts=function(t,i){var r=!0;!sf.base.isBlazor()||null===t||this.diagramActions&e.DiagramAction.UndoRedo||-1===(s=t.ports.length>0?Number(xa(t,i[0].id,!1)):-1)&&(r=!1);if(t=this.nameTable[t.id]||t,sf.base.isBlazor()&&r){for(var o=[],n=[],a=i.length-1;a>=0;a--){var s=Number(xa(t,i[a].id,!1));o.push(s),n.push(i[a])}this.UpdateBlazorLabelOrPortObjects(n,"Port",o,this.nodes.indexOf(t))}i.length>1&&this.startGroupAction();for(a=i.length-1;a>=0;a--)if(t.children&&t.children.length>0)for(var h=0;h<t.wrapper.children.length;h++)this.removePortsExtenion(t,i,a,t.wrapper.children[h]);else this.removePortsExtenion(t,i,a,t.wrapper);i.length>1&&this.endGroupAction()},o.prototype.getSizeValue=function(e,t){var i;if(i=e.toString().indexOf("px")>0?e.toString():e.toString().indexOf("%")>0?void 0!==t?"100%":e.toString():e.toString()+"px",t){zr(this);i="calc("+i+" - "+t+"px)"}return i},o.prototype.renderRulers=function(){var e,t,i;this.rulerSettings.showRulers?(t=zr(e=this),i=hh("div",{id:e.element.id+"_overlapRuler",style:"height:"+t.height+"px;width:"+t.width+"px;position:absolute;left:0;top:0",class:"e-ruler-overlap"}),e.element.insertBefore(i,e.element.firstChild),Pr(this,!0),Pr(this,!1)):Ar(this)},o.prototype.intOffPageBackground=function(){var e=new i;e=zr(this);var t=document.getElementById(this.element.id+"content"),r=this.getSizeValue(this.width,e.width),o=this.getSizeValue(this.height,e.height),n=this.rulerSettings.showRulers?"width:"+r+"; height:"+o+";top:"+e.height+"px;left:"+e.width+"px;overflow: scroll;position:absolute;overflow:auto;":"width:"+r+"; height:"+o+";position:absolute; left:0px;  top:0px;overflow: auto;",a={id:this.element.id+"content",tabindex:"0",style:n};t?(this.diagramCanvas=t,mh(this.diagramCanvas,n)):(this.diagramCanvas=hh("div",a),this.element.appendChild(this.diagramCanvas)),this.diagramCanvas.style.background=this.backgroundColor},o.prototype.initDiagram=function(){this.intOffPageBackground(),yh(this.element,{style:"width:"+this.getSizeValue(this.width)+"; height:"+this.getSizeValue(this.height)+";position:relative;overflow:hidden;"})},o.prototype.renderHiddenUserHandleTemplateLayer=function(e){var t=hh("div",{class:this.element.id+"_hiddenUserHandleTemplate",style:"width:"+e.width+"px; height:"+e.height+"px;visibility:hidden ;  overflow: hidden;"});this.element.appendChild(t)},o.prototype.renderBackgroundLayer=function(e,t){var i=this.createSvg(this.element.id+"_backgroundLayer_svg",e.width,e.height);mh(i,t);var r=dh("g",{id:this.element.id+"_backgroundImageLayer",class:"e-background-image-layer"});i.appendChild(r);var o=dh("g",{id:this.element.id+"_backgroundLayer",class:"e-background-layer"});i.appendChild(o),this.diagramCanvas.appendChild(i)},o.prototype.renderGridLayer=function(e,t){var i=this.createSvg(this.element.id+"_gridline_svg",e.width,e.height);i.setAttribute("class","e-grid-layer");var r=dh("g",{id:this.element.id+"_gridline",width:"100%",height:"100%"}),o=dh("rect",{id:this.element.id+"_grid_rect",x:"0",y:"0",width:"100%",height:"100%"});Va()?o.setAttribute("fill","url("+location.protocol+"//"+location.host+location.pathname+"#"+this.element.id+"_pattern)"):o.setAttribute("fill","url(#"+this.element.id+"_pattern)"),r.appendChild(o),i.appendChild(r),this.diagramCanvas.appendChild(i),fh(i,{style:t})},o.prototype.renderDiagramLayer=function(e,t){var i={id:this.element.id+"_diagramLayer_div",style:"width:"+e.width+"px; height:"+e.height+"px;"+t};if(this.diagramLayerDiv=hh("div",i),"SVG"===this.mode){var r=this.createSvg(this.element.id+"_diagramLayer_svg",e.width,e.height);r.style["pointer-events"]="none",r.setAttribute("class","e-diagram-layer");var o=dh("g",{id:this.element.id+"_diagramLayer"}),n=dh("g",{});this.diagramLayer=o,r.style["pointer-events"]="all",n.appendChild(o),r.appendChild(n),this.diagramLayerDiv.appendChild(r)}else this.diagramLayer=Fh.createCanvas(this.element.id+"_diagram",e.width,e.height),mh(this.diagramLayer,"position:absolute;left:0px;top:0px;"),this.diagramLayerDiv.appendChild(this.diagramLayer);this.diagramCanvas.appendChild(this.diagramLayerDiv)},o.prototype.initLayers=function(){var e="position:absolute;top:0px;left:0px;overflow:hidden;pointer-events:none;",t=document.getElementById(this.element.id).getBoundingClientRect(),i=function(){var e=hh("div",{style:"visibility:hidden; width: 100px"});document.body.appendChild(e);var t=e.getBoundingClientRect().width;e.style.overflow="scroll";var i=hh("div",{style:"width:100%"});e.appendChild(i);var r=i.getBoundingClientRect().width;return e.parentNode.removeChild(e),t-r}();this.scroller.scrollerWidth=i,this.scroller.setViewPortSize(t.width,t.height),this.renderRulers();window.measureElement&&(window.measureElement=null,document.getElementById("measureElement").remove());vh(),this.renderBackgroundLayer(t,e),this.renderGridLayer(t,e),this.renderDiagramLayer(t,e),this.renderHTMLLayer(t,e),this.renderPortsExpandLayer(t,e),this.renderNativeLayer(t,e),this.renderAdornerLayer(t,e),this.renderHiddenUserHandleTemplateLayer(t)},o.prototype.renderAdornerLayer=function(e,t){var i=hh("div",{id:this.element.id+"_diagramAdornerLayer",style:"width:"+e.width+"px;height:"+e.height+"px;"+t}),r=hh("div",{id:this.element.id+"_diagramUserHandleLayer",style:"width:"+e.width+"px;height:"+e.height+"px;"+t});r.setAttribute("class","e-userHandle-layer"),i.appendChild(r);var o=this.createSvg(this.element.id+"_diagramAdorner_svg",e.width,e.height);o.setAttribute("class","e-adorner-layer"),o.style["pointer-events"]="none",this.adornerLayer=dh("g",{id:this.element.id+"_diagramAdorner"}),this.adornerLayer.style[" pointer-events"]="all",o.appendChild(this.adornerLayer),i.appendChild(o),this.diagramCanvas.appendChild(i);var n=dh("g",{id:this.element.id+"_SelectorElement"});this.adornerLayer.appendChild(n),fh(o,{style:"pointer-events:none;"})},o.prototype.renderPortsExpandLayer=function(e,t){var i=this.createSvg(this.element.id+"_diagramPorts_svg",e.width,e.height);i.setAttribute("class","e-ports-expand-layer");var r=dh("g",{id:this.element.id+"_diagramPorts",class:"e-ports-layer",style:"pointer-events: all;"});i.appendChild(r);var o=dh("g",{id:this.element.id+"_diagramExpander",class:"e-expand-layer",style:"pointer-events: all;"});i.appendChild(o),this.diagramCanvas.appendChild(i),fh(i,{style:t})},o.prototype.renderHTMLLayer=function(e,t){this.htmlLayer=hh("div",{id:this.element.id+"_htmlLayer",style:"width:"+e.width+"px; height:"+e.height+"px;position:absolute;top:0px;left:0px;overflow:hidden;pointer-events:none;",class:"e-html-layer"});var i=hh("div",{id:this.element.id+"_htmlLayer_div",style:"position:absolute;top:0px;left:0px;pointer-events:all;"});this.htmlLayer.appendChild(i),this.diagramCanvas.appendChild(this.htmlLayer)},o.prototype.renderNativeLayer=function(e,t){var i=this.createSvg(this.element.id+"_nativeLayer_svg",e.width,e.height),r=dh("g",{id:this.element.id+"_nativeLayer",style:"pointer-events:all;"});i.appendChild(r),this.diagramLayerDiv.appendChild(i),fh(i,{class:"e-native-layer",style:t})},o.prototype.createSvg=function(e,t,i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return fh(r,{id:e,width:t,height:i}),r},o.prototype.updateBazorShape=function(){for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];switch(t.shape.type){case"Bpmn":t.shape.bpmnShape=t.shape.shape?t.shape.shape:t.shape.bpmnShape;break;case"UmlActivity":t.shape.umlActivityShape=t.shape.shape?t.shape.shape:t.shape.umlActivityShape;break;case"Flow":t.shape.flowShape=t.shape.shape?t.shape.shape:t.shape.flowShape;break;case"Basic":t.shape.basicShape=t.shape.shape?t.shape.shape:t.shape.basicShape;break;case"Text":t.shape.textContent=t.shape.content?t.shape.content:t.shape.textContent}}},o.prototype.initObjects=function(e){this.updateBazorShape(),this.isLoading||this.initData(),this.initLayerObjects(),this.updateBridging(e)},o.prototype.initLayerObjects=function(){var t=this.layers.length>1,i=[],r=window&&window.Blazor&&!this.dataSourceSettings.dataSource,o={},n={},a=[],s=[],h=[],d=[],l=[],c=[],p=[];sf.base.isBlazor()&&r&&(s=this.previousNodeCollection,h=this.previousConnectorCollection);for(var g=0,u=this.nodes;g<u.length;g++){(T=u[g]).id=T.id||xh(),this.addToLayer(T,t),o[T.id]=T}for(var f=0,m=this.connectors;f<m.length;f++){(T=m[f]).id=T.id||xh(),this.addToLayer(T,t),o[T.id]=T}for(var y=0,v=this.layers;y<v.length;y++){for(var b=0,w=(D=v[y]).objects;b<w.length;b++){if(o[T=w[b]])if(o[T]instanceof wr)if((L=o[T]).sourceID&&L.targetID){var x=o[L.sourceID],C=o[L.targetID];x&&x.wrapper&&C&&C.wrapper?this.initConnectors(o[T],D):i.push(o[T])}else this.initConnectors(o[T],D);else o[T].children?a.push(T):o[T].shape instanceof zs&&o[T].shape.activity.subProcess.processes&&o[T].shape.activity.subProcess.processes.length>0?n[o[T].id]=T:this.initNodes(o[T],D)}if(this.bpmnModule)for(var S=0,P=this.bpmnModule.textAnnotationConnectors;S<P.length;S++){var T=P[S];this.initConnectors(T,D,!1)}}for(var A=0,z=Object.keys(n);A<z.length;A++){T=z[A];this.initObject(o[T]),this.bpmnModule.updateDocks(o[T],this)}for(var O=0,I=this.alignGroup(a,o);O<I.length;O++){T=I[O];var D=this.commandHandler.getObjectLayer(T);this.initNodes(o[T],D)}for(var E=0,B=i;E<B.length;E++){var L=B[E];D=this.commandHandler.getObjectLayer(L.id);this.initConnectors(L,D)}if(sf.base.isBlazor()&&r){for(var M=0,k=this.nodes;M<k.length;M++){T=k[M];d.push(Ah(T,void 0,void 0,!0))}for(var R=0,N=this.connectors;R<N.length;R++){T=N[R];l.push(Ah(T,void 0,void 0,!0))}if(this.commandHandler.getObjectChanges(s,d,c),this.commandHandler.getObjectChanges(h,l,p),!(this.blazorActions&e.BlazorAction.ClearObject)){T={methodName:"UpdateBlazorProperties",diagramobj:{nodes:c,connectors:p}};window.sfBlazor.updateBlazorProperties(T,this)}}},o.prototype.alignGroup=function(e,t){var i,r,o,n,a=[],s=[];for(o=0;o<e.length;o++){var h=void 0;if((r=t[i=e[o]])&&r.children.length)for(n=0;n<r.children.length;n++)h=r.children[n],e.indexOf(h)>-1&&-1===a.indexOf(h)&&-1===s.indexOf(h)&&a.splice(0,0,h);-1===a.indexOf(i)&&s.push(i)}return a=a.concat(s)},o.prototype.addToLayer=function(e,t){var i;t&&(i=this.commandHandler.getObjectLayer(e.id)),t&&i||-1===this.activeLayer.objects.indexOf(e.id)&&this.activeLayer.objects.push(e.id),this.setZIndex(i||this.activeLayer,e)},o.prototype.updateLayer=function(e){for(var t=0,i=Object.keys(e.layers);t<i.length;t++){for(var r=i[t],o=0,n=this.layers[r].objects;o<n.length;o++){var a=n[o],s=this.nameTable[a];void 0!==e.layers[r].visible?this.updateElementVisibility(s.wrapper,s,e.layers[r].visible):!0===e.layers[r].lock&&this.unSelect(s)}void 0!==e.layers[r].lock&&(this.layers[r].lock=e.layers[r].lock)}"SVG"!==this.mode&&this.refreshDiagramLayer()},o.prototype.updateScrollSettings=function(t){var i=-this.scroller.horizontalOffset+t.scrollSettings.horizontalOffset||0,r=this.scroller.verticalOffset-t.scrollSettings.verticalOffset||0,o={VerticalOffset:this.scrollSettings.verticalOffset,HorizontalOffset:this.scrollSettings.horizontalOffset,ViewportHeight:this.scrollSettings.viewPortHeight,ViewportWidth:this.scrollSettings.viewPortWidth,CurrentZoom:this.scroller.currentZoom};0===i&&0===r||this.pan(i,r);var n={VerticalOffset:this.scrollSettings.verticalOffset,HorizontalOffset:this.scrollSettings.horizontalOffset,ViewportHeight:this.scrollSettings.viewPortHeight,ViewportWidth:this.scrollSettings.viewPortWidth,CurrentZoom:this.scroller.currentZoom},a="Start";this.realActions&e.RealAction.PanInProgress&&(a="Progress");var s={oldValue:o,newValue:n,source:this,panState:a};sf.base.isBlazor()&&this.scrollChange&&(s={oldValue:o,newValue:n,sourceId:this.element.id,panState:a}),this.triggerEvent(e.DiagramEvent.scrollChange,s),this.commandHandler.updatePanState(!0),"Canvas"===this.mode&&this.constraints&e.DiagramConstraints.Virtualization&&this.refreshDiagramLayer()},o.prototype.initData=function(){var t=this.dataSourceSettings.dataManager||this.dataSourceSettings.dataSource;if(this.dataBindingModule&&!(this.realActions&e.RealAction.PreventDataInit))if(t&&this.dataSourceSettings.connectionDataSource.dataManager){var i=this.dataSourceSettings.dataManager||this.dataSourceSettings.dataSource;this.nodes=this.generateData(i,!0),this.connectors=this.generateData(this.dataSourceSettings.connectionDataSource.dataManager,!1)}else t&&t.dataSource&&(t.dataSource.url||"BlazorAdaptor"===t.adaptorName&&!t.dataSource.url)?this.dataBindingModule.initSource(this.dataSourceSettings,this):this.dataBindingModule.initData(this.dataSourceSettings,this)},o.prototype.generateData=function(e,t){var i,r=[];for(i=0;i<e.length;i++){var o=e[i],n=t?this.makeData(o,!0):this.makeData(o,!1);!n||!n.id||Cn(r,n.id)&&Cn(r,n.id)||r.push(n)}return r},o.prototype.makeData=function(e,t){var i,r=t?this.dataSourceSettings:this.dataSourceSettings.connectionDataSource,o={};if(o.id=e[r.id]?e[r.id]:xh(),r.sourceID&&(o.sourceID=e[r.sourceID]),r.targetID&&(o.targetID=e[r.targetID]),e[r.sourcePointX]&&e[r.sourcePointY]&&(o.sourcePoint={x:Number(e[r.sourcePointX]),y:Number(e[r.sourcePointY])}),e[r.targetPointX]&&e[r.targetPointY]&&(o.targetPoint={x:Number(e[r.targetPointX]),y:Number(e[r.targetPointY])}),r.crudAction.customFields&&r.crudAction.customFields.length>0)for(i=0;i<r.crudAction.customFields.length;i++)o[r.crudAction.customFields[i]]=e[r.crudAction.customFields[i]];return o},o.prototype.initNodes=function(e,t){this.preventDiagramUpdate=!0,this.initObject(e,t),this.preventDiagramUpdate=!1},o.prototype.initConnectors=function(e,t,i){this.preventDiagramUpdate=!0,this.initObject(e,t,i),this.updateEdges(e),this.preventDiagramUpdate=!1},o.prototype.setZIndex=function(e,t){var i=e;if(-1===t.zIndex){for(;i.zIndexTable[i.objectZIndex+1];)e.objectZIndex++;t.zIndex=++i.objectZIndex}else{var r=t.zIndex;if(i.zIndexTable[r])for(var o=Object.keys(i.zIndexTable).length,n=0;n<o;n++)if(n===r){for(var a=o;a>r;a--)i.zIndexTable[a]=i.zIndexTable[a-1],this.nameTable[i.zIndexTable[a]]&&(this.nameTable[i.zIndexTable[a]].zIndex=a);i.zIndexTable[n]=t.id}}},o.prototype.initializeDiagramLayers=function(){for(var e=0;e<this.layers.length;e++)if(-1!==this.layers[e].zIndex){var t=this.layers[e];this.layers[e]=this.layers[this.layers[e].zIndex],this.layers[t.zIndex]=t}for(var i=0,r=this.layers;i<r.length;i++){var o=r[i];o.zIndex=-1!==o.zIndex?o.zIndex:this.layers.indexOf(o),this.layerZIndexTable[o.zIndex]=o.id}for(e=0;e<this.layers.length;e++)for(var n=e+1;n<this.layers.length;n++)if(this.layers[e].zIndex>this.layers[n].zIndex){t=this.layers[e];this.layers[e]=this.layers[n],this.layers[n]=t}if(0===this.layers.length){this.commandHandler.addLayer({id:"default_layer",visible:!0,lock:!1,objects:[],zIndex:0,objectZIndex:-1,zIndexTable:{}},null,!0)}this.setActiveLayer(this.layers[this.layers.length-1].id)},o.prototype.resetTool=function(){this.eventHandler.resetTool()},o.prototype.initObjectExtend=function(e,t,i){if(i){for(var r=this.commandHandler.checkBoundaryConstraints(void 0,void 0,e.wrapper.bounds),o=0,n=Object.keys(t.zIndexTable);o<n.length;o++)t.zIndexTable[n[o]]&&t.zIndexTable[n[o]]===e.id&&delete t.zIndexTable[n[o]];if(t.zIndexTable[e.zIndex]=e.id,!r){var a=e instanceof js?this.nodes:this.connectors;for(o=0;o<=a.length;o++)a[o]&&e.id===a[o].id&&a.splice(o,1);delete t.zIndexTable[e.zIndex]}}},o.prototype.initObject=function(t,r,o,n){if(void 0===o&&(o=!0),void 0!==t){if(o&&(r||(this.addToLayer(t,!1),r=this.activeLayer),(t instanceof js||t instanceof wr)&&this.setZIndex(r,t)),t instanceof js){if(o){if("helper"!==t.id)if(s=Wh(this.getNodeDefaults)){if((h=s(t,this))&&h.ports)for(var a=0;a<h.ports.length;a++)h.ports[a].inEdges=[],h.ports[a].outEdges=[];h&&h!==t&&Ih(h,t)}this.initNode(t,this.element.id)}}else if(t instanceof wr){var s,h;if(s=Wh(this.getConnectorDefaults))(h=s(t,this))&&h!==t&&Ih(h,t),t.segments.length&&t.type!==t.segments[0].type&&(t.segments=[]);var d=this.nameTable[t.sourceID],l=this.nameTable[t.targetID],c=this.getConnectedPort(d,t,!0),p=this.getConnectedPort(l,t),g=this.findInOutConnectPorts(d,!1),u=this.findInOutConnectPorts(l,!0);if((void 0!==d&&Wr(d)||""!==t.sourcePortID&&_r(g))&&(t.sourceWrapper=this.getEndNodeWrapper(d,t,!0),t.sourcePortID&&c&&c.constraints&&!(c.constraints&e.PortConstraints.None)&&c.constraints&e.PortConstraints.OutConnect&&(t.sourcePortWrapper=this.getWrapper(d.wrapper,t.sourcePortID))),(void 0!==l&&jr(l)||""!==t.targetPortID&&Hr(u))&&(t.targetWrapper=this.getEndNodeWrapper(l,t,!1),t.targetPortID&&p&&p.constraints&&!(p.constraints&e.PortConstraints.None)&&p.constraints&e.PortConstraints.InConnect&&(t.targetPortWrapper=this.getWrapper(l.wrapper,t.targetPortID))),!o){var f=t.getConnectorPoints(t.type);ga(t,f)}o&&t.init(this);for(var m=0;m<t.wrapper.children.length;m++)this.pathTable[t.wrapper.children[m].data]&&(t.wrapper.children[m].absoluteBounds=this.pathTable[t.wrapper.children[m].data].absoluteBounds);t.wrapper.measure(new i(void 0,void 0)),t.wrapper.arrange(t.wrapper.desiredSize),t instanceof wr&&"Bezier"===t.type&&(this.updateConnectorAnnotation(t),this.updateConnectorfixedUserHandles(t));for(var y=0;y<t.wrapper.children.length;y++)this.pathTable[t.wrapper.children[y].data]={},this.pathTable[t.wrapper.children[y].data].absoluteBounds=t.wrapper.children[y].absoluteBounds}if(t instanceof js&&t.children&&t.container)for(a=0;a<t.children.length;a++)this.nameTable[t.children[a]].offsetX=this.nameTable[t.children[a]].wrapper.offsetX,this.nameTable[t.children[a]].offsetY=this.nameTable[t.children[a]].wrapper.offsetY;if(this.bpmnModule&&t instanceof js&&"Bpmn"===t.shape.type&&t.shape.annotations.length>0&&this.bpmnModule.updateQuad(t,this),this.initObjectExtend(t,r,o),this.nameTable[t.id]=t,t instanceof js&&t.children){this.preventNodesUpdate=!0,this.preventConnectorsUpdate=!0,n||t.container||this.updateGroupOffset(t,!0),this.groupTable[t.id]=t.children;for(a=0;a<t.children.length;a++){var v=this.nameTable[t.children[a]];v&&(v.parentId=t.id)}this.isLoading||!t.rotateAngle||t.container||this.commandHandler.rotateObjects(t,[t],t.rotateAngle,{x:t.offsetX,y:t.offsetY},!1),this.preventNodesUpdate=!1,this.preventConnectorsUpdate=!1}void 0===this.enterObject&&this.updateQuad(t)}!1===t.visible&&this.updateElementVisibility(t.wrapper,t,!1)},o.prototype.getConnectedPort=function(e,t,i){if(e&&e.ports)for(var r=0,o=e.ports;r<o.length;r++){var n=o[r];if(n.id===t.sourcePortID&&i)return n;if(n.id===t.targetPortID&&!i)return n}return null},o.prototype.scaleObject=function(t,i,r){var o=r?t.wrapper.actualSize.width:t.wrapper.actualSize.height,n=r?1+(i-o)/o:1,a=r?1:1+(i-o)/o;this.realActions|=e.RealAction.PreventDrag,this.scale(t,n,a,{x:.5,y:.5}),this.realActions&=~e.RealAction.PreventDrag},o.prototype.updateDefaultLayoutIcons=function(e){"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type&&"ComplexHierarchicalTree"!==this.layout.type||(this.updateDefaultLayoutIcon(e,e.expandIcon),this.updateDefaultLayoutIcon(e,e.collapseIcon))},o.prototype.updateDefaultLayoutIcon=function(e,t){if("None"!==t.shape&&"Auto"===t.horizontalAlignment&&"Auto"===t.verticalAlignment&&.5===t.offset.x&&1===t.offset.y){var r=this.getWrapper(e.wrapper,"icon_content"),o=void 0,n=void 0;"TopToBottom"===this.layout.orientation||"BottomToTop"===this.layout.orientation?(o=.5,n="TopToBottom"===this.layout.orientation?1:0):"RightToLeft"!==this.layout.orientation&&"LeftToRight"!==this.layout.orientation||(o="LeftToRight"===this.layout.orientation?1:0,n=.5),r.setOffsetWithRespectToBounds(o,n,"Fraction"),r.horizontalAlignment="Center",r.verticalAlignment="Center",e.wrapper.measure(new i(e.wrapper.width,e.wrapper.height)),e.wrapper.arrange(e.wrapper.desiredSize)}},o.prototype.updateGroupOffset=function(t,i){var r=!1;if(t.children&&t.children.length>0&&!t.container||t.processId){var o=this.nameTable[t.id];if(!(this.realActions&e.RealAction.PreventScale||this.realActions&e.RealAction.PreventDrag)){if(!o.offsetX||!(this.realActions&e.RealAction.EnableGroupAction)&&(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.ToolAction||this.diagramActions&e.DiagramAction.PublicMethod))sf.base.isBlazor()&&(this.insertValue(Ah(o),!0),r=!0),o.offsetX=t.wrapper.offsetX;else{this.realActions|=e.RealAction.PreventScale;var n=o.offsetX-t.wrapper.offsetX;o.offsetX=t.wrapper.offsetX;var a=o.offsetY-t.wrapper.offsetY;o.offsetY=t.wrapper.offsetY,"None"===t.flip&&this.drag(o,n,a),this.realActions&=~e.RealAction.PreventScale}if(!o.offsetY||!(this.realActions&e.RealAction.EnableGroupAction)&&(this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.ToolAction||this.diagramActions&e.DiagramAction.PublicMethod))sf.base.isBlazor()&&(this.insertValue(Ah(o),!0),r=!0),o.offsetY=t.wrapper.offsetY;else{this.realActions|=e.RealAction.PreventScale;a=o.offsetY-t.wrapper.offsetY;o.offsetY=t.wrapper.offsetY,"None"===t.flip&&this.drag(o,0,a),this.realActions&=~e.RealAction.PreventScale}this.diagramActions&&(sf.base.isBlazor()&&(this.insertValue(Ah(o),!0),r=!0),o.width=t.wrapper.actualSize.width,o.height=t.wrapper.actualSize.height)}}i&&t.children&&t.children.length>0&&(void 0!==this.nameTable[t.id].width?this.scaleObject(t,this.nameTable[t.id].width,!0):(sf.base.isBlazor()&&(this.insertValue(Ah(this.nameTable[t.id]),!0),r=!0),this.nameTable[t.id].width=t.wrapper.actualSize.width),void 0!==this.nameTable[t.id].height?this.scaleObject(t,this.nameTable[t.id].height,!1):(sf.base.isBlazor()&&(this.insertValue(Ah(this.nameTable[t.id]),!0),r=!0),this.nameTable[t.id].height=t.wrapper.actualSize.height)),!r||this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.ToolAction||this.diagramActions&e.DiagramAction.PublicMethod||this.commandHandler.getBlazorOldValues()},o.prototype.initNode=function(t,r,o){var n,a,s=t.initContainer(),h=new Te;if(this.diagramSettings.inversedAlignment||(s.inversedAlignment=!1),s.children||(s.children=[]),t.children){s.measureChildren=!1,h.id=t.id+"group_container",h.style.fill="none",h.style.strokeColor="none",h.horizontalAlignment="Stretch",h.verticalAlignment="Stretch",s.style=t.style,h.children=[],h.preventContainer=!0,t.container&&(h.relativeMode="Object");var d=!!(t.ports&&t.ports.length>0);if(sf.base.isNullOrUndefined(t.container)&&!d&&s.children.push(h),t.container&&"Grid"===t.container.type)for(var l=0;l<t.children.length;l++){var c=new Te,p=this.nameTable[t.children[l]];c.children=[],c.children.push(p.wrapper),p&&s.addObject(p.wrapper,p.rowIndex,p.columnIndex,p.rowSpan,p.columnSpan)}else for(l=0;l<t.children.length;l++)if(this.nameTable[t.children[l]]){p=this.nameTable[t.children[l]];this.updateStackProperty(t,p,l),s.children.push(p.wrapper),s.elementActions=s.elementActions|e.ElementAction.ElementIsGroup,p.wrapper.flip="None"===p.wrapper.flip?t.wrapper.flip:p.wrapper.flip}(d||t.container&&"Grid"!==t.container.type)&&s.children.push(h)}else{var g=Wh(this.setNodeTemplate);g&&"helper"!==t.id&&(n=g(t,this)),n||(n=t.init(this)),s.children.push(n)}a=Wh(this.getDescription),(t.children?s:n).description=a||(t.annotations.length?t.annotations[0].content:t.id);var u=t.children?h:s;t.initAnnotations(this.getDescription,u,this.element.id,!!Yr(this),this.annotationTemplate),t.initPorts(this.getDescription,u),t.initIcons(this.getDescription,this.layout,u,r);for(l=0;t.fixedUserHandles,l<t.fixedUserHandles.length;l++){var f=t.initfixedUserHandles(t.fixedUserHandles[l]);u.children.push(f)}"SwimLane"===t.shape.type&&t.wrapper&&t.wrapper.children.length>0&&t.wrapper.children[0]instanceof wo?(Go(t),Zo(this,t),this.updateDiagramElementQuad()):(s.measure(new i(t.width,t.height),t.id,this.onLoadImageSize.bind(this)),s instanceof wo?s.arrange(s.desiredSize,!0):s.arrange(s.desiredSize)),"None"!==t.wrapper.flip&&t.wrapper.elementActions&e.ElementAction.ElementIsGroup&&Ma(t.wrapper,t.wrapper.offsetX,t.wrapper.offsetY,this,t.wrapper.flip),t instanceof js&&t.container&&(t.width<s.outerBounds.width||t.height<s.outerBounds.height)&&s.bounds.x<=s.outerBounds.x&&s.bounds.y<=s.outerBounds.y&&(t.width=s.width=s.outerBounds.width,t.height=s.height=s.outerBounds.height,s.measure(new i(t.width,t.height)),s.arrange(s.desiredSize)),t.container&&"Grid"===t.container.type&&t.children&&t.children.length>0&&this.updateChildPosition(t)},o.prototype.updateDiagramElementQuad=function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].wrapper&&this.nodes[e].wrapper instanceof xe&&this.updateQuad(this.nodes[e])},o.prototype.onLoadImageSize=function(t,i){var r=this.getObject(t),o=document.getElementById(t+"sf-imageNode");o&&o.parentNode.removeChild(o),this.nodePropertyChange(r,{},{width:i.width,height:i.height});var n={element:Ah(r),size:i};this.triggerEvent(e.DiagramEvent.onImageLoad,n)},o.prototype.updateChildPosition=function(e){for(var t=0;t<e.children.length;t++){var i=this.getObject(e.children[t]);i.offsetX=i.wrapper.offsetX,i.offsetY=i.wrapper.offsetY,i.children&&i.children.length>0&&this.updateChildPosition(i)}},o.prototype.canExecute=function(){return!0},o.prototype.updateStackProperty=function(e,t,i){e.container&&"Stack"===e.container.type&&(t.width||(t.wrapper.horizontalAlignment="Stretch",t.horizontalAlignment="Stretch"),t.height||(t.verticalAlignment="Stretch",t.wrapper.verticalAlignment="Stretch"),i&&"UmlClassifier"===e.shape.type&&(t.umlIndex=i))},o.prototype.initViews=function(){this.isLoading||(this.views.push(this.element.id),this.views[this.element.id]=this)},o.prototype.initCommands=function(){var t=this.commandManager.commands,i={copy:{execute:this.copyCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.C,keyModifiers:e.KeyModifiers.Control}},paste:{execute:this.pasteCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.V,keyModifiers:e.KeyModifiers.Control}},cut:{execute:this.cutCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.X,keyModifiers:e.KeyModifiers.Control}},delete:{execute:this.removeCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Delete}},selectAll:{execute:this.selectAll.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.A,keyModifiers:e.KeyModifiers.Control}},undo:{execute:this.undo.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Z,keyModifiers:e.KeyModifiers.Control}},redo:{execute:this.redo.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Y,keyModifiers:e.KeyModifiers.Control}},nudgeUp:{execute:this.nudgeCommand.bind(this,"Up"),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Up},parameter:"up"},nudgeRight:{execute:this.nudgeCommand.bind(this,"Right"),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Right},parameter:"right"},nudgeDown:{execute:this.nudgeCommand.bind(this,"Down"),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Down},parameter:"down"},nudgeLeft:{execute:this.nudgeCommand.bind(this,"Left"),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Left},parameter:"left"},startEdit:{execute:this.startEditCommad.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.F2}},endEdit:{execute:this.endEditCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Escape}},focusToNextItem:{canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Tab}},focusToPreviousItem:{canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Tab,keyModifiers:e.KeyModifiers.Control}},selectFocusedItem:{execute:this.startEditCommad.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:e.Keys.Enter}}};this.initCommandManager(t,i)},o.prototype.overrideCommands=function(e,t){for(var i,r=0,o=Object.keys(t);r<o.length;r++){var n=o[r];if(i=t[n],e.gesture.key===i.gesture.key&&e.gesture.keyModifiers===i.gesture.keyModifiers){delete t[n];break}}},o.prototype.initCommandManager=function(e,t){var i=0;if(e)for(i=0;i<e.length;i++)t[e[i].name]&&e[i]?(e[i].canExecute&&(t[e[i].name].canExecute=e[i].canExecute),e[i].execute&&(t[e[i].name].execute=e[i].execute),(e[i].gesture.key||e[i].gesture.keyModifiers)&&(t[e[i].name].gesture=e[i].gesture),""!==e[i].parameter&&(t[e[i].name].parameter=e[i].parameter)):(this.overrideCommands(e[i],t),t[e[i].name]={execute:e[i].execute,canExecute:e[i].canExecute,gesture:e[i].gesture,parameter:e[i].parameter});this.commands=t},o.prototype.updateNodeEdges=function(e){for(var t=0,i=e.inEdges;t<i.length;t++){var r=i[t];this.nameTable[r]&&(this.nameTable[r].targetID="")}for(var o=0,n=e.outEdges;o<n.length;o++){r=n[o];this.nameTable[r]&&(this.nameTable[r].sourceID="")}e.inEdges=[],e.outEdges=[]},o.prototype.updateIconVisibility=function(e,t){for(var i=0;i<e.wrapper.children.length;i++){var r=e.wrapper.children[i];if(r.id){var o=r.id.split(e.id)[1];o&&o.match("^_icon")&&(r.visible=t,this.updateDiagramContainerVisibility(r,t))}}},o.prototype.updateEdges=function(e){var t;void 0!==e.sourceID&&""!==e.sourceID&&((t=this.nameTable[e.sourceID])&&t.outEdges&&0===t.outEdges.length&&(t.outEdges=[]),t&&t.outEdges&&-1===t.outEdges.indexOf(e.id)&&t.outEdges.push(e.id),this.updatePortEdges(t,e,!1));if(void 0!==e.targetID&&""!==e.targetID&&((t=this.nameTable[e.targetID])&&t.inEdges&&0===t.inEdges.length&&(t.inEdges=[]),t&&t.inEdges&&-1===t.inEdges.indexOf(e.id)&&t.inEdges.push(e.id),this.updatePortEdges(t,e,!0),t&&t.visible&&t.outEdges)){var i=0!==t.outEdges.length;this.updateIconVisibility(t,i)}},o.prototype.updatePortEdges=function(e,t,i){if(e)for(var r=0;r<e.ports.length;r++){var o=e.ports[r],n=i?t.targetPortID:t.sourcePortID;if(o.id===n){var a=i?o.inEdges:o.outEdges;-1===a.indexOf(t.id)&&a.push(t.id)}}},o.prototype.refreshDiagram=function(){if(this.initLayerObjects(),this.doLayout(),this.updateBridging(),this.scroller.setSize(),this.addBlazorDiagramObjects(),sf.base.isBlazor()&&this.layout&&this.layout.layoutInfo&&this.layout.layoutInfo.isRootInverse&&this.nodes.length>2){var e=this.nodes[0];if(e.outEdges.length>1)for(var t=this.isProtectedOnChange,i=1;i<e.outEdges.length;i++){var r=this.nameTable[e.outEdges[i]],o=this.allowServerDataBinding;this.protectPropertyChange(!1),this.enableServerDataBinding(!1),this.preventDiagramUpdate=!0,"Left"===this.getObject(r.targetID).data.Branch&&(r.sourcePortID=e.ports[1].id),this.dataBind(),this.preventDiagramUpdate=!1,this.enableServerDataBinding(o),this.protectPropertyChange(t)}}if(sf.base.isBlazor())for(var n=void 0,a=0,s=this.views;a<s.length;a++){var h=s[a];(n=this.views[h]).renderDocument&&(n.renderDocument(n),n.diagramRenderer.setLayers(),n.updateView(n),this.renderNodes(n))}this.updateFitToPage()},o.prototype.updateCanupdateStyle=function(e,t){for(var i=0;i<e.length;i++)e[i].children&&this.updateCanupdateStyle(e[i].children,t),e[i].canApplyStyle=t},o.prototype.getZindexPosition=function(e,t){var i,r=[],o=void 0;if(r=(r=r.concat(this.nodes)).concat(this.connectors),-1!==e.zIndex)for(var n=0;n<r.length;n++)if(r[n].zIndex>e.zIndex){"HTML"!==e.shape.type&&"Native"!==e.shape.type||(i="HTML"===e.shape.type?"html":"native"),o=Qs(t,r[n].id,i);break}return o},o.prototype.updateDiagramObject=function(t,i,r){for(var o,n=0,a=this.views;n<a.length;n++){var s=a[n];if(o=this.views[s],this.diagramActions&&"SVG"===o.mode){var h=void 0;if(this.layers.length>1&&(h=this.commandHandler.getObjectLayer(t.id)),void 0===h||h&&h.visible||r){var d=sh(this.element.id);window.domTable[o.element.id+"_diagramLayer"]||(window.domTable[o.element.id+"_diagramLayer"]=document.getElementById(o.element.id+"_diagramLayer"));var l=window.domTable[o.element.id+"_diagramLayer"];this.diagramActions&e.DiagramAction.Interactions&&this.updateCanupdateStyle(t.wrapper.children,!0),this.diagramRenderer.updateNode(t.wrapper,l,d,void 0,i?void 0:this.getZindexPosition(t,o.element.id)),this.updateCanupdateStyle(t.wrapper.children,!0)}}}},o.prototype.updateGridContainer=function(e){for(var t,i=sh(this.element.id),r=0,o=this.views;r<o.length;r++){var n=o[r];if("SVG"===(t=this.views[n]).mode&&this.diagramActions){var a=document.getElementById(t.element.id+"_diagramLayer");this.diagramRenderer.updateNode(e,a,i,void 0)}else this.refreshCanvasDiagramLayer(t)}},o.prototype.getObjectsOfLayer=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];this.nameTable[o]&&t.push(this.nameTable[o])}return t},o.prototype.refreshDiagramLayer=function(){for(var e,t=0,i=this.views;t<i.length;t++){var r=i[t];switch((e=this.views[r]).mode){case"SVG":this.refreshSvgDiagramLayer(e);break;case"Canvas":this.refreshCanvasLayers(e)}}},o.prototype.refreshCanvasLayers=function(e){if(e)this.refreshCanvasDiagramLayer(e);else for(var t=0,i=this.views;t<i.length;t++){var r=i[t],o=this.views[r];this.refreshCanvasDiagramLayer(o)}},o.prototype.renderBasicElement=function(e){for(var t=sh(e.element.id),r=0;r<this.basicElements.length;r++){var o=this.basicElements[r];o instanceof xe&&(o.prevRotateAngle=0),o.measure(new i(o.width,o.height)),o.arrange(o.desiredSize),e.diagramRenderer.renderElement(o,e.diagramLayer,t)}},o.prototype.refreshElements=function(e){if(!this.isDestroyed){this.clearCanvas(e),e instanceof o&&(e.diagramLayer.getContext("2d").setTransform(e.scroller.currentZoom,0,0,e.scroller.currentZoom,0,0),e.diagramLayer.getContext("2d").scale(1.5,1.5));var t=sh(e.element.id);this.renderDiagramElements(e.diagramLayer,e.diagramRenderer,t);for(var r=0;r<this.basicElements.length;r++){var n=this.basicElements[r];n.measure(new i(n.width,n.height)),n.arrange(n.desiredSize),e.diagramRenderer.renderElement(n,e.diagramLayer,t)}e instanceof o&&(e.diagramLayer.style.transform="scale("+2/3+")",e.diagramLayer.style.transformOrigin="0 0"),this.renderTimer=null}},o.prototype.refreshCanvasDiagramLayer=function(t){var i=this;"SVG"===t.mode||this.isDestroyed||(this.basicElements.length>0&&this.renderBasicElement(t),!this.diagramActions||0==(this.diagramActions&e.DiagramAction.Render)||e.DiagramAction.ToolAction&this.diagramActions||Yr(this)||1!==this.scroller.currentZoom?this.refreshElements(t):this.renderTimer||(this.renderTimer=setTimeout((function(){i.refreshElements(t)}),40)))},o.prototype.updatePortVisibility=function(t,i,r){var o,n=!this.drawingObject||!this.drawingObject.shape;if(t instanceof js&&n&&Er(t)){for(var a=t.ports,s=!1,h=0;h<a.length;h++)o=this.getWrapper(t.wrapper,a[h].id),(i&e.PortVisibility.Hover||i&e.PortVisibility.Connect)&&ya(a[h],i)&&(o.visible=!r,s=!0);s&&this.updateDiagramObject(t)}},o.prototype.refreshSvgDiagramLayer=function(t){var r,o=document.getElementById(t.element.id+"_diagramLayer"),n=sh(t.element.id);if(Yr(this))this.scroller.virtualizeElements();else{for(var a=0;a<this.basicElements.length;a++)(r=this.basicElements[a]).measure(new i(r.width,r.height)),r.arrange(r.desiredSize,!(this.diagramActions&e.DiagramAction.Render)),this.diagramRenderer.renderElement(r,o,n);this.renderDiagramElements(o,this.diagramRenderer,n)}},o.prototype.removeVirtualObjects=function(e){if(this.deleteVirtualObject){for(var t=0;t<this.scroller.removeCollection.length;t++){var i=this.nameTable[this.scroller.removeCollection[t]];this.removeElements(i)}this.deleteVirtualObject=!1}clearInterval(e)},o.prototype.updateTextElementValue=function(e){for(var t=0;t<e.wrapper.children.length;t++){var r=e.wrapper.children[t];r instanceof Se&&(r.canMeasure=!0,r.measure(new i(e.width,e.height)),r.arrange(r.desiredSize))}},o.prototype.updateVirtualObjects=function(e,t,i){var r=document.getElementById(this.element.id+"_diagramLayer"),o=sh(this.element.id);if("SVG"===this.mode){for(var n=0;n<e.length;n++){var a=this.scroller.removeCollection.indexOf(e[n]);a>=0&&this.scroller.removeCollection.splice(a,1);var s=this.nameTable[e[n]];this.updateTextElementValue(s),this.diagramRenderer.renderElement(s.wrapper,r,o,void 0,void 0,void 0,void 0,s.zIndex)}for(var h=0;h<i.length;h++)this.scroller.removeCollection.push(i[h]);1!==this.scroller.currentZoom&&this.eventHandler.updateVirtualization()}else this.diagramActions&&this.refreshDiagramLayer()},o.prototype.renderDiagramElements=function(t,r,o,n,a,s){void 0===n&&(n=!0);var h=this.scroller.getPageBounds();h.x*=this.scroller.currentZoom,h.y*=this.scroller.currentZoom,h.width*=this.scroller.currentZoom,h.height*=this.scroller.currentZoom;for(var d=-this.scroller.horizontalOffset-h.x,l=-this.scroller.verticalOffset-h.y,c=0,p=Object.keys(this.layerZIndexTable);c<p.length;c++){var g=p[c],u=this.commandHandler.getLayer(this.layerZIndexTable[g]),f=void 0,m=void 0;"Canvas"===this.mode&&Yr(this)&&!this.diagramActions&&this.scroller.virtualizeElements();for(var y="Canvas"===this.mode&&Yr(this)&&this.scroller.oldCollectionObjects.length>0?this.scroller.oldCollectionObjects:void 0,v=0,b=Object.keys(y||u.zIndexTable);v<b.length;v++){var w=b[v],x=y?this.nameTable[y[w]]:this.nameTable[u.zIndexTable[w]];if(x&&!x.parentId&&u.visible&&(!x.processId||this.refreshing)){var C={tx:this.scroller.transform.tx,ty:this.scroller.transform.ty,scale:this.scroller.transform.scale};if(Yr(this)){if(this.scroller.currentZoom<1){if(h.x<0||this.scroller.horizontalOffset<0){var S=this.scroller.verticalOffset<0?this.scroller.verticalOffset:0;f=(d>0?d:0)+"px",m=(this.realActions&e.RealAction.vScrollbarMoved?0:-S)+"px"}else f="0px",m="0px";this.realActions&e.RealAction.hScrollbarMoved&&(this.realActions=this.realActions&~e.RealAction.hScrollbarMoved),this.realActions&e.RealAction.vScrollbarMoved&&(this.realActions=this.realActions&~e.RealAction.vScrollbarMoved)}else f=(h.x<0?d:-this.scroller.horizontalOffset)+"px",m=(h.y<0?l:-this.scroller.verticalOffset)+"px";this.diagramLayer.style.left=f,this.diagramLayer.style.top=m,C.tx=this.scroller.horizontalOffset/C.scale,C.ty=this.scroller.verticalOffset/C.scale}var P=!0;if(a&&(P=!1),this.updateTextElementValue(x),this.refreshing&&x.shape.activity&&x.shape.activity.subProcess&&x.shape.activity.subProcess.processes){for(var T=0;T<x.shape.activity.subProcess.processes.length;T++){var A=x.shape.activity.subProcess.processes[T];x.wrapper.children.push(this.nameTable[A].wrapper)}x.wrapper.measure(new i(x.wrapper.bounds.width,x.wrapper.bounds.height)),x.wrapper.arrange(x.wrapper.desiredSize)}r.renderElement(x.wrapper,t,o,!r.isSvgMode&&n?C:void 0,void 0,void 0,P&&(!this.diagramActions||s))}}}},o.prototype.updateBridging=function(e){if(this.bridgingModule)for(var t=0;t<this.connectors.length;t++){var r=this.connectors[t];this.bridgingModule.updateBridging(r,this);var o=this.connectors[t].wrapper;if(o){var n=o.children[0],a=n.data;r.getSegmentElement(r,n,"ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type?this.layout.orientation:void 0),n.data!==a&&(o.measure(new i),o.arrange(o.desiredSize),"SVG"!==this.mode||e||this.updateDiagramObject(r))}}},o.prototype.setCursor=function(e){this.diagramRenderer.setCursor(this.diagramCanvas,e)},o.prototype.clearCanvas=function(e){var t=e.contentWidth||e.diagramLayer.width/this.scroller.currentZoom,i=e.contentHeight||e.diagramLayer.height/this.scroller.currentZoom;"SVG"!==e.mode&&Fh.getContext(e.diagramLayer).clearRect(0,0,t,i)},o.prototype.updateScrollOffset=function(){this.scroller.setScrollOffset(this.diagramCanvas.scrollLeft,this.diagramCanvas.scrollTop),Tr(this),Yr(this)&&this.scroller.virtualizeElements()},o.prototype.setOffset=function(e,t){window.domTable[this.element.id+"content"]||(window.domTable[this.element.id+"content"]=document.getElementById(this.element.id+"content"));var i=window.domTable[this.element.id+"content"];i&&(i.scrollLeft=e,i.scrollTop=t)},o.prototype.setSize=function(t,i){if(this.diagramLayer&&!this.preventDiagramUpdate){var r=zr(this);t-=r.width,i-=r.height;var o=this.spatialSearch.getPageBounds();o.x*=this.scroller.currentZoom,o.y*=this.scroller.currentZoom,o.width*=this.scroller.currentZoom,o.height*=this.scroller.currentZoom;var n="SVG"===this.mode?1:1.5,a="SVG"===this.mode?qs(this.element.id):this.diagramLayer,s="Canvas"===this.mode&&this.constraints&e.DiagramConstraints.Virtualization?this.scroller.viewPortWidth:t,h="Canvas"===this.mode&&this.constraints&e.DiagramConstraints.Virtualization?this.scroller.viewPortHeight:i;a.setAttribute("width",(n*s).toString()),a.setAttribute("height",(n*h).toString());var d=document.getElementById(this.element.id+"_diagramUserHandleLayer");d&&(d.style.width=t+"px",d.style.height=i+"px");var l={width:t.toString(),height:i.toString()};this.diagramLayerDiv.style.width=t+"px",this.diagramLayerDiv.style.height=i+"px",fh(ih(this.element.id),l),fh(Ks(this.element.id).getElementsByClassName("e-ports-expand-layer")[0],l);var c=Js(this.element.id);fh(c,l),c.parentNode.style.width=t+"px",c.parentNode.style.height=i+"px";var p=rh(this.element.id);fh(p,l),this.diagramRenderer.updateGrid(this.snapSettings,p,this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),fh(oh(this.element.id),l),this.htmlLayer.style.width=t+"px",this.htmlLayer.style.height=i+"px","SVG"===this.mode||Yr(this)||this.refreshDiagramLayer(),"SVG"===this.mode&&Yr(this)&&this.scroller.virtualizeElements()}},o.prototype.transformLayers=function(){var t=this.spatialSearch.getPageBounds();t.x*=this.scroller.currentZoom,t.y*=this.scroller.currentZoom,t.width*=this.scroller.currentZoom,t.height*=this.scroller.currentZoom,this.diagramRenderer.updateGrid(this.snapSettings,rh(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),this.diagramRenderer.transformLayers(this.scroller.transform,"SVG"===this.mode),this.diagramActions&e.DiagramAction.DragUsingMouse||this.updateSelector(),this.renderPageBreaks(t)},o.prototype.removePageBreaks=function(){if(this.diagramLayer){var e=nh(this.element.id);if(e&&e.childNodes)for(var t=e.childNodes.length,i=0;i<t;i++)e.removeChild(e.childNodes[0])}},o.prototype.renderPageBreaks=function(e){this.removePageBreaks();var t=nh(this.element.id);if(t){var i=0;e=this.scroller.getPageBounds(!0);var r=(this.scroller.transform.tx+e.x)*this.scroller.currentZoom,o=(this.scroller.transform.ty+e.y)*this.scroller.currentZoom,n=e.height*this.scroller.currentZoom,a=e.width*this.scroller.currentZoom;qh.renderSvgBackGroundImage(this.pageSettings.background,this.element,r,o,a,n);var s={id:t.id+"rect",x:r,y:o,height:n,width:a,angle:0,stroke:"",strokeWidth:1,fill:this.pageSettings.background.color,opacity:1,pivotX:0,pivotY:0,visible:!0,dashArray:"0"};if(this.diagramRenderer.drawRect(t,s),this.pageSettings.showPageBreaks){var h=this.scroller.getPageBreak(e);for(i=0;i<h.length;i++)this.diagramRenderer.drawLine(t,{class:"e-diagram-page-break",fill:"none",stroke:"#aaaaaa",strokeWidth:1,dashArray:"10 10",opacity:2,x:0,y:0,width:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,startPoint:{x:(h[i].x1+this.scroller.transform.tx)*this.scroller.currentZoom,y:(h[i].y1+this.scroller.transform.ty)*this.scroller.currentZoom},endPoint:{x:(h[i].x2+this.scroller.transform.tx)*this.scroller.currentZoom,y:(h[i].y2+this.scroller.transform.ty)*this.scroller.currentZoom},id:h[i].y1===h[i].y2?"HorizontalLines":"VerticalLines"})}}},o.prototype.validatePageSize=function(){var e=0;"Portrait"===this.pageSettings.orientation?this.pageSettings.width>this.pageSettings.height&&(e=this.pageSettings.height,this.pageSettings.height=this.pageSettings.width,this.pageSettings.width=e):this.pageSettings.height>this.pageSettings.width&&(e=this.pageSettings.width,this.pageSettings.width=this.pageSettings.height,this.pageSettings.height=e)},o.prototype.setOverview=function(e,t){if(e)e&&(this.views.push(e.id),this.views[e.id]=e,e.renderDocument(e),e.diagramRenderer.setLayers(),e.updateView(e),this.renderNodes(e));else{for(var i=0;i<this.views.length;i++)this.views[i]===t&&(e=this.views[t]);this.views[t]=void 0;var r=this.views.indexOf(t);this.views.splice(r,1)}},o.prototype.renderNodes=function(e){if(e){var t=new qh(e.id,new Zh,!1),i=document.getElementById(e.element.id+"_diagramLayer"),r=sh(e.element.id);this.renderDiagramElements(i,e.diagramRenderer||t,r,void 0,void 0,!0)}},o.prototype.updateThumbConstraints=function(t,i,r){for(var o=t.length,n=0;n<o;n++){var a=t[n],s=!1,h=!1,d=i.thumbsConstraints;a instanceof js?(s="Bpmn"===a.shape.type&&"Activity"===a.shape.shape&&!1===a.shape.activity.subProcess.collapsed||"TextAnnotation"===a.shape.shape,h="Bpmn"===a.shape.type&&"TextAnnotation"===a.shape.shape,Rr(a)&&d&e.ThumbsConstraints.Rotate&&!s||(d&=~e.ThumbsConstraints.Rotate),Vr(a,"SouthEast")&&d&e.ThumbsConstraints.ResizeSouthEast&&!h||(d&=~e.ThumbsConstraints.ResizeSouthEast),Vr(a,"NorthWest")&&d&e.ThumbsConstraints.ResizeNorthWest&&!h||(d&=~e.ThumbsConstraints.ResizeNorthWest),Vr(a,"East")&&d&e.ThumbsConstraints.ResizeEast&&!h||(d&=~e.ThumbsConstraints.ResizeEast),Vr(a,"West")&&d&e.ThumbsConstraints.ResizeWest&&!h||(d&=~e.ThumbsConstraints.ResizeWest),Vr(a,"North")&&d&e.ThumbsConstraints.ResizeNorth&&!h||(d&=~e.ThumbsConstraints.ResizeNorth),Vr(a,"South")&&d&e.ThumbsConstraints.ResizeSouth&&!h||(d&=~e.ThumbsConstraints.ResizeSouth),Vr(a,"NorthEast")&&d&e.ThumbsConstraints.ResizeNorthEast&&!h||(d&=~e.ThumbsConstraints.ResizeNorthEast),Vr(a,"SouthWest")&&d&e.ThumbsConstraints.ResizeSouthWest&&!h||(d&=~e.ThumbsConstraints.ResizeSouthWest)):a instanceof wr?(r||(d|=e.ThumbsConstraints.Default),Lr(a)?d|=e.ThumbsConstraints.ConnectorSource:d&=~e.ThumbsConstraints.ConnectorSource,Mr(a)?d|=e.ThumbsConstraints.ConnectorTarget:d&=~e.ThumbsConstraints.ConnectorTarget):(r||(d|=e.ThumbsConstraints.Default),Vr(a)||(d&=~(e.ThumbsConstraints.ResizeSouthEast|e.ThumbsConstraints.ResizeSouthWest|e.ThumbsConstraints.ResizeSouth|e.ThumbsConstraints.ResizeEast|e.ThumbsConstraints.ResizeWest|e.ThumbsConstraints.ResizeNorth|e.ThumbsConstraints.ResizeNorthEast|e.ThumbsConstraints.ResizeNorthWest)),Rr(a)||(d&=~e.ThumbsConstraints.Rotate)),i.thumbsConstraints=d}},o.prototype.renderSelector=function(t,r){var o=this.isProtectedOnChange;sf.base.isBlazor()&&(this.isProtectedOnChange=!0);var n,a=new i,s=this.selectedItems,h=(s.constraints,this.diagramRenderer.rendererActions),d=document.getElementsByClassName("blazor-inner-template");if(this.diagramRenderer.rendererActions=this.currentSymbol?this.addConstraints(h,e.RendererAction.DrawSelectorBorder):this.removeConstraints(h,e.RendererAction.DrawSelectorBorder),this.clearSelectorLayer(),this.commandHandler.hasSelection()){if(1===s.nodes.length&&0===s.connectors.length&&(s.rotateAngle=s.nodes[0].rotateAngle,s.pivot=s.nodes[0].pivot),s.wrapper.measure(a),s.wrapper.arrange(s.wrapper.desiredSize),s.width=s.wrapper.actualSize.width,s.height=s.wrapper.actualSize.height,s.offsetX=s.wrapper.offsetX,s.offsetY=s.wrapper.offsetY,0!==s.rotateAngle){for(var l=0,c=s.nodes;l<c.length;l++){var p=c[l];p.offsetX=p.wrapper.offsetX,p.offsetY=p.wrapper.offsetY}for(var g=0,u=s.connectors;g<u.length;g++)u[g]}this.spatialSearch.getPageBounds();var f=$s(this.element.id),m=th(this.element.id);if(s.thumbsConstraints=e.ThumbsConstraints.Default,s.annotation?this.updateThumbConstraints([s.annotation],s):(this.updateThumbConstraints(s.nodes,s),this.updateThumbConstraints(s.connectors,s,!0)),s.annotation)this.renderSelectorForAnnotation(s,f);else if(s.nodes.length+s.connectors.length===1||this.nameTable.helper){if(s.nodes[0]instanceof js){var y=s.nodes[0];Eo(this,y)&&(r||"UmlClassifier"===y.shape.type||y.parentId&&this.nameTable[y.parentId]&&"UmlClassifier"===this.nameTable[y.parentId].shape.type||((!y.container||"Canvas"!==y.container.type&&"Grid"!==y.container.type)&&(s.nodes[0].constraints&=~(e.NodeConstraints.Rotate|e.NodeConstraints.HideThumbs)),s.thumbsConstraints&=~e.ThumbsConstraints.Rotate));var v=!!r||!!(y.constraints&e.NodeConstraints.HideThumbs),b=!!("SwimLane"===y.shape.type||y.isLane||y.isPhase||r);this.diagramRenderer.renderResizeHandle(s.wrapper.children[0],f,s.thumbsConstraints,this.scroller.currentZoom,s.constraints,this.scroller.transform,void 0,Er(y),v,b)}else if(s.connectors[0]instanceof wr&&io(this.diagramRenderer.rendererActions)){var w=s.connectors[0];this.diagramRenderer.renderEndPointHandle(w,f,s.thumbsConstraints,s.constraints,this.scroller.transform,void 0!==w.sourceWrapper,void 0!==w.targetWrapper,!(!this.connectorEditingToolModule||!kr(w)))}}else this.diagramRenderer.renderResizeHandle(s.wrapper,f,s.thumbsConstraints,this.scroller.currentZoom,s.constraints,this.scroller.transform,void 0,Er(s));if(!s.annotation&&!this.currentSymbol&&(this.diagramRenderer.renderUserHandler(s,f,this.scroller.transform,m),sf.base.isBlazor()&&d.length>0))for(n=0;n<this.selectedItems.userHandles.length;n++){var x=this.selectedItems.userHandles[n];document.getElementById(x.name+"_html_element").style.display="block"}}this.isProtectedOnChange=o},o.prototype.updateSelector=function(){var t=this.allowServerDataBinding;this.enableServerDataBinding(!1);var r,o=new i,n=this.selectedItems,a=n.constraints,s=document.getElementsByClassName("blazor-inner-template");if(this.diagramActions&e.DiagramAction.ToolAction||1!==this.selectedItems.nodes.length||(this.selectedItems.rotateAngle=this.selectedItems.nodes[0].rotateAngle,this.selectedItems.wrapper.rotateAngle=this.selectedItems.nodes[0].rotateAngle),void 0!==this.selectedItems&&(this.clearSelectorLayer(),null!==n.wrapper&&n.wrapper.children&&n.wrapper.children.length)){if(n.wrapper.measure(o),n.wrapper.arrange(n.wrapper.desiredSize),0!==n.rotateAngle||n.rotateAngle!==n.wrapper.prevRotateAngle)for(var h=0,d=n.nodes;h<d.length;h++){var l=d[h];l.offsetX=l.wrapper.offsetX,l.offsetY=l.wrapper.offsetY}n.width=n.wrapper.actualSize.width,n.height=n.wrapper.actualSize.height,n.offsetX=n.wrapper.offsetX,n.offsetY=n.wrapper.offsetY;var c=$s(this.element.id),p=th(this.element.id),g=this.eventHandler.canHideResizers();if(n.thumbsConstraints=e.ThumbsConstraints.Default,n.annotation?this.updateThumbConstraints([n.annotation],n):(this.updateThumbConstraints(n.nodes,n),this.updateThumbConstraints(n.connectors,n,!0)),this.selectedItems.constraints&e.SelectorConstraints.UserHandle&&!n.annotation&&!this.currentSymbol&&(this.diagramRenderer.renderUserHandler(n,c,this.scroller.transform,p),sf.base.isBlazor()&&s.length>0))for(r=0;r<this.selectedItems.userHandles.length;r++){var u=this.selectedItems.userHandles[r];document.getElementById(u.name+"_html_element").style.display="block"}if(n.annotation)this.renderSelectorForAnnotation(n,c);else if(n.nodes.length+n.connectors.length===1){if(n.connectors[0]instanceof wr&&io(this.diagramRenderer.rendererActions)){var f=n.connectors[0];this.diagramRenderer.renderEndPointHandle(f,c,n.thumbsConstraints,a,this.scroller.transform,void 0!==f.sourceWrapper,void 0!==f.targetWrapper,!(!this.connectorEditingToolModule||!kr(f)))}else if(n.nodes[0]instanceof js){var m=n.nodes[0];Eo(this,n.nodes[0])&&("UmlClassifier"===m.shape.type||m.parentId&&this.nameTable[m.parentId]&&"UmlClassifier"===this.nameTable[m.parentId].shape.type||((!m.container||"Canvas"!==m.container.type&&"Grid"!==m.container.type)&&(n.nodes[0].constraints&=~(e.NodeConstraints.HideThumbs|e.NodeConstraints.Rotate)),n.thumbsConstraints&=~e.ThumbsConstraints.Rotate));var y=!("SwimLane"!==m.shape.type&&!m.isLane&&!m.isPhase);this.diagramRenderer.renderResizeHandle(n.wrapper.children[0],c,n.thumbsConstraints,this.scroller.currentZoom,n.constraints,this.scroller.transform,g,Er(n.nodes[0]),!!(n.nodes[0].constraints&e.NodeConstraints.HideThumbs),y)}}else this.diagramActions&e.DiagramAction.Interactions&&(this.diagramRenderer.rendererActions=this.diagramRenderer.rendererActions|e.RendererAction.PreventRenderSelector),this.diagramRenderer.renderResizeHandle(n.wrapper,c,n.thumbsConstraints,this.scroller.currentZoom,n.constraints,this.scroller.transform,g,Er(n)),this.diagramRenderer.rendererActions=this.diagramRenderer.rendererActions&~e.RendererAction.PreventRenderSelector}this.enableServerDataBinding(t)},o.prototype.renderSelectorForAnnotation=function(e,t){this.diagramRenderer.renderResizeHandle(e.wrapper.children[0],t,e.thumbsConstraints,this.scroller.currentZoom,e.constraints,this.scroller.transform,void 0,Er(e.annotation))},o.prototype.drawSelectionRectangle=function(e,t,i,r){this.clearSelectorLayer(),this.diagramRenderer.drawSelectionRectangle(e,t,i,r,this.adornerLayer,this.scroller.transform)},o.prototype.renderHighlighter=function(e){var t=Js(this.element.id);this.diagramRenderer.renderHighlighter(e,t,this.scroller.transform)},o.prototype.clearHighlighter=function(){var e=Js(this.element.id),t=e.getElementById(e.id+"_highlighter");t&&t.parentNode.removeChild(t)},o.prototype.getNodesConnectors=function(e){for(var t=0;t<this.nodes.length;t++){var i=this.nodes[t];e.push(i)}for(t=0;t<this.connectors.length;t++){var r=this.connectors[t];e.push(r)}return e},o.prototype.clearSelectorLayer=function(){var t,i=Js(this.element.id),r=document.getElementsByClassName("blazor-inner-template");if(this.currentSymbol){var o=i.getElementById("borderRect_symbol");o&&o.parentNode.removeChild(o)}else{var n=i.getElementById(this.adornerLayer.id+"_selected_region");n&&n.parentNode.removeChild(n),this.clearHighlighter();for(var a=$s(this.element.id).childNodes,s=void 0,h=a.length;h>0;h--)(s=a[h-1]).parentNode.removeChild(s);if(sf.base.isBlazor()&&!(this.diagramActions&e.DiagramAction.DragUsingMouse)&&r.length>0)for(t=0;t<this.selectedItems.userHandles.length;t++){var d=this.selectedItems.userHandles[t];document.getElementById(d.name+"_html_element").style.display="none"}else if(!sf.base.isBlazor()){var l=th(this.element.id).childNodes;for(t=l.length;t>0;t--)l[t-1].parentNode.removeChild(l[t-1])}}},o.prototype.getWrapper=function(e,t){var i;t=e.id+"_"+t;for(var r=e instanceof Te?e:this.getPortContainer(this.nameTable[e.id]),o=0;o<r.children.length;o++)t===r.children[o].id&&(i=r.children[o]);return i},o.prototype.getEndNodeWrapper=function(e,t,i){if("Bpmn"===e.shape.type&&e.wrapper.children[0]instanceof Te){if(!sf.base.isBlazor()&&"Activity"===e.shape.shape||sf.base.isBlazor()&&"Activity"===e.shadow.bpmnShape){if(i&&"Transaction"===e.shape.activity.subProcess.type&&t.sourcePortID){var r=t.sourcePortID,o=e.wrapper.children[0].children[0].children[2];if(o.children)for(var n=0,a=o.children;n<a.length;n++){var s=a[n];if(s.visible&&s.id===e.id+"_"+r)return s.children[0]}}return e.wrapper.children[0].children[0].children[0]}return e.wrapper.children[0].children[0]}return this.containsMargin(e.wrapper.children[0])||e.children?e.wrapper:e.wrapper.children[0]},o.prototype.containsMargin=function(e){return e.margin&&(0!==e.margin.left||0!==e.margin.top||0!==e.margin.right||0!==e.margin.bottom)},o.prototype.focusOutEdit=function(){this.endEdit()},o.prototype.endEditCommand=function(){this.endEdit(),this.textEditing=!1},o.prototype.endEdit=function(){return Il(this,void 0,void 0,(function(){var t,i,r,o,n,a,s,h,d,l,c,p,g,u,f,m,y,v,b,w,x,C,S,P,T,A;return Dl(this,(function(z){switch(z.label){case 0:return this.diagramActions&e.DiagramAction.TextEdit?(t="Blazor",i="sfBlazor",r=void 0,o=void 0,n={},this.enableServerDataBinding(!1),sf.base.isBlazor()&&(this.canEnableBlazorObject=!0),a=document.getElementById(this.element.id+"_editBox"),sf.base.isBlazor()&&a||!sf.base.isBlazor()?(s=a.value,sf.base.EventHandler.remove(a,"input",this.eventHandler.inputChange),sf.base.EventHandler.remove(a,"focusout",this.focusOutEdit),h=document.getElementById(this.element.id+"_editTextBoxDiv"),d=void 0,d=this.nameTable[this.activeLabel.parentId],l=va(d,this.activeLabel.id),c={oldValue:this.activeLabel.text,newValue:s,cancel:!1,element:d,annotation:l},sf.base.isBlazor()&&this.textEdit&&(c=this.getBlazorTextEditArgs(c)),p=!1,h.parentNode.removeChild(h),g=void 0,this.bpmnModule?(d=this.bpmnModule.isBpmnTextAnnotation(this.activeLabel,this),g=this.bpmnModule.getTextAnnotationWrapper(d,this.activeLabel.id),(p=!!d)?h.textContent===s&&s===this.activeLabel.text?[3,5]:sf.base.isBlazor()?this.textEdit&&window&&window[t]?(m={EventName:"textEdit",args:JSON.stringify(c)},[4,window[i].updateBlazorDiagramEvents(m,this)]):[3,2]:[3,3]:[3,5]):[3,5]):[3,11]):[3,11];case 1:c=z.sent()||c,z.label=2;case 2:return[3,4];case 3:this.triggerEvent(e.DiagramEvent.textEdit,c),z.label=4;case 4:c.cancel||this.bpmnModule.updateTextAnnotationContent(d,this.activeLabel,s,this),z.label=5;case 5:return p?[3,10]:(d=this.nameTable[this.activeLabel.parentId],!(u=va(d,this.activeLabel.id))||u instanceof fs?r=sf.base.isBlazor()&&"Text"===d.shape.type?{shape:{textContent:d.shape.content}}:{shape:{content:d.shape.content}}:(y=xa(d,u.id,!0),n[y]={content:u.content},r={annotations:n}),(f=this.eventHandler.isAddTextNode(d,!0))||h.textContent===s&&s===this.activeLabel.text?[3,9]:sf.base.isBlazor()?window&&window[t]&&this.textEdit?(m={EventName:"textEdit",args:JSON.stringify(c)},[4,window[i].updateBlazorDiagramEvents(m,this)]):[3,7]:[3,8]);case 6:c=z.sent()||c,z.label=7;case 7:return[3,9];case 8:this.triggerEvent(e.DiagramEvent.textEdit,c),z.label=9;case 9:g||(g=this.getWrapper(d.wrapper,this.activeLabel.id)),u.content===s||c.cancel||(d.parentId&&"UmlClassifier"===this.nameTable[d.parentId].shape.type&&-1===s.indexOf("+")&&-1===s.indexOf("-")&&-1===s.indexOf("#")&&-1===s.indexOf("~")&&-1===d.id.indexOf("_umlClass_header")&&(s=" + "+s),(d.isLane||d.isPhase)&&this.protectPropertyChange(!0),u instanceof fs?o=sf.base.isBlazor()&&"Text"===d.shape.type?{shape:{textContent:s}}:{shape:{content:s}}:(y=xa(d,u.id,!0),(v={})[y]={content:s},o={annotations:v}),(b=this.getIndex(d,d.id))&&((w={})[b]=r,(x={})[b]=o,Ea(d)===js?this.onPropertyChanged({nodes:x},{nodes:w}):this.onPropertyChanged({connectors:x},{connectors:w})),this.protectPropertyChange(!0),sf.base.isBlazor()&&"Text"===d.shape.type?d.shape.textContent=s:u.content=s,this.protectPropertyChange(!1),this.updateSelector(),(d.isLane||d.isPhase)&&this.protectPropertyChange(!1)),f&&(this.removeObjectsFromLayer(d),this.removeFromAQuad(d),delete this.nameTable[this.activeLabel.parentId],""!==s&&(this.clearSelection(),C=Ah(d),d=this.add(C),this.updateDiagramObject(d),this.commandHandler.oldSelectedObjects=ka(this),this.commandHandler.select(this.nameTable[d.id]),this.commandHandler.updateBlazorSelector())),z.label=10;case 10:if(this.selectedItems.nodes.length){if(S=this.nameTable[this.activeLabel.parentId],(P=this.nameTable[S.parentId])&&"SwimLane"===P.shape.type||"SwimLane"===S.shape.type)if("LaneHeaderParent","PhaseHeaderParent","SwimLane"===S.shape.type&&(P=this.nameTable[this.activeLabel.parentId],S=d),S.isLane||S.isPhase)for(T=S.isLane?P.shape.lanes:P.shape.phases,A=0;A<T.length;A++)T[A].id===(S.LaneHeaderParent||S.PhaseHeaderParent)&&(T[A].header.annotation.content=S.annotations[0].content);else S.isHeader&&P.shape.hasHeader&&(P.shape.header.annotation.content=S.annotations[0].content);this.dataBind()}g.visible=!0,this.updateDiagramObject(d),this.diagramActions=this.diagramActions&~e.DiagramAction.TextEdit,this.activeLabel.isGroup&&this.endGroupAction(),this.activeLabel={id:"",parentId:"",isGroup:!1,text:void 0},this.commandHandler.getBlazorOldValues(),sf.base.isBlazor()&&(this.canEnableBlazorObject=!1),this.enableServerDataBinding(!0),z.label=11;case 11:return[2]}}))}))},o.prototype.getIndex=function(e,t){for(var i=Ea(e)===js?this.nodes:this.connectors,r=0;r<i.length;r++)if(i[r].id.toString()===t.toString())return r.toString();return null},o.prototype.getBlazorTextEditArgs=function(e){var t=Ea(e.element)===wr?{connectorId:e.element.id}:{nodeId:e.element.id},i={};return Ea(e.element)===js&&"Text"===e.element.shape.type?i.textNode=e.element.shape:i.annotationId=e.element.annotations[0].id,e={oldValue:e.oldValue,newValue:e.newValue,cancel:e.cancel,element:t,annotation:i}},o.prototype.canLogChange=function(){return!(!(this.diagramActions&e.DiagramAction.Render)||this.diagramActions&e.DiagramAction.ToolAction||this.diagramActions&e.DiagramAction.UndoRedo||this.diagramActions&e.DiagramAction.PublicMethod)},o.prototype.modelChanged=function(e,t){return!!(e.connectors||t.connectors||e.nodes||t.connectors||e.pageSettings||t.pageSettings||e.bridgeDirection||t.bridgeDirection)},o.prototype.resetDiagramActions=function(t){var i=!!t;this.diagramActions&e.DiagramAction.UndoRedo&&(!i||t===e.DiagramAction.UndoRedo)&&(this.diagramActions=this.diagramActions&~e.DiagramAction.UndoRedo),this.diagramActions&e.DiagramAction.PublicMethod&&(!i||t===e.DiagramAction.PublicMethod)&&(this.diagramActions=this.diagramActions&~e.DiagramAction.PublicMethod)},o.prototype.removeNode=function(e,t){this.removeObjectsFromLayer(e),this.removeFromAQuad(this.nameTable[e.id]);var i=document.getElementById(e.id+"_groupElement");if(delete this.nameTable[e.id],e.children&&delete this.groupTable[e.id],sf.base.isBlazor())for(var r=0;r<this.nodes.length;r++)e.id===this.nodes[r].id&&this.UpdateBlazorDiagramModel(e,"Node",r);if(this.nodes.splice(this.nodes.indexOf(e),1),i.children&&i.children.length>0)for(var o=void 0,n=i.children.length-1;n>=0;n--){var a=i.children[n];t.length>0&&-1!==t.indexOf(a.id.split("_")[0])&&(o?i.parentNode.insertBefore(a,o):i.parentNode.insertBefore(a,i),o=a)}i&&i.parentNode.removeChild(i)},o.prototype.deleteGroup=function(e){var t=[];e.children&&(t=this.commandHandler.getChildren(e,[])),this.UpdateBlazorDiagramModelCollection(e);for(var i=0,r=t;i<r.length;i++){var o=r[i];this.nameTable[o.id]&&this.remove(o)}},o.prototype.updateObject=function(t,i,r){if(!(this.diagramActions&e.DiagramAction.ToolAction)){var o=t.wrapper.children[0].bounds;if(!this.commandHandler.checkBoundaryConstraints(void 0,void 0,o))if(t instanceof js){for(var n=i,a=0,s=Object.keys(r);a<s.length;a++){switch(l=s[a]){case"width":t.width=n.width;break;case"height":t.height=n.height;break;case"offsetX":t.offsetX=n.offsetX;break;case"offsetY":t.offsetY=n.offsetY;break;case"rotateAngle":t.rotateAngle=n.rotateAngle}}this.nodePropertyChange(t,r,i)}else{for(var h=0,d=Object.keys(r);h<d.length;h++){var l=d[h],c=i,p=t.sourcePoint,g=t.targetPoint;switch(l){case"sourcePoint":p.x=c.sourcePoint.x||p.x,p.y=c.sourcePoint.y||p.y;break;case"targetPoint":g.x=c.targetPoint.x||g.x,g.y=c.targetPoint.y||g.y}}this.connectorPropertyChange(t,r,i)}}},o.prototype.nodePropertyChangeExtend=function(t,i,r,o){return void 0!==r.style&&"Bpmn"!==t.shape.type&&(ia(r.style,t.wrapper.children[0]),o=!0),void 0!==r.shadow&&(this.updateShadow(t.shadow,r.shadow),o=!0),void 0!==r.constraints&&(i.constraints&e.NodeConstraints.Select&&!(r.constraints&e.NodeConstraints.Select)&&zd(this,t)?this.clearSelection():(this.updateThumbConstraints(this.selectedItems.nodes,this.selectedItems),this.updateSelector(),o=!0)),this.swimLaneNodePropertyChange(t,i,r,o),o},o.prototype.swimLaneNodePropertyChange=function(t,i,r,o){if("SwimLane"===t.shape.type&&!this.currentSymbol){if(i.shape){var n=r.shape,a=t.shape,s="Horizontal"===a.orientation,h=a.padding,d=i.shape,l=t.wrapper.children[0],c=void 0,p=void 0,g=void 0;if(d.lanes||d.phases){if(d.lanes)for(var u=0,f=Object.keys(n.lanes);u<f.length;u++){var m=f[u],y=Number(m),v=d.lanes[y],b=void 0,w=n.lanes[y];if(w&&w.header&&(g=a.lanes[y].header.id,c=v.header,p=w.header,this.nodePropertyChange(this.nameTable[g],c,p)),v.children)for(var x=0,C=Object.keys(v.children);x<C.length;x++){var S=C[x];g=a.lanes[y].children[Number(S)].id;var P=this.nameTable[g];c=v.children[Number(S)],p=w.children[Number(S)],this.nodePropertyChange(P,c,p)}v.width&&!s&&(b=a.phases&&a.phaseSize?y+1:y,l.updateColumnWidth(b,w.width,!0,h),this.updateDiagramElementQuad()),v.height&&s&&(b=a.header&&a.hasHeader?y+1:y,b+=a.phases&&a.phaseSize?1:0,l.updateRowHeight(b,w.height,!0,h),this.updateDiagramElementQuad())}if(n.phases)for(var T=0,A=Object.keys(n.phases);T<A.length;T++){var z=A[T],O=(y=Number(z),n.phases[y]),I=void 0,D=a.header&&a.hasHeader?1:0;if(O&&O.header&&(g=a.phases[y].header.id,c=d.phases[y].header,p=O.header,this.nodePropertyChange(this.nameTable[g],c,p)),O.offset){if(0===y)I=O.offset;else{var E=a.phases[y-1];(I=O.offset-E.offset)<=0&&(I=O.offset)}s?(l.updateColumnWidth(y,I,!0,h),on(t,this,l.rows[D].cells[y],y)):l.updateRowHeight(D+y,I,!0,h)}}}if(void 0!==n.phaseSize&&a.phases.length)if(0===n.phaseSize||0===d.phaseSize)if(d.phaseSize)s?(l.removeRow(a.header&&a.hasHeader?1:0),t.height=t.wrapper.height=l.height):(a.header&&a.hasHeader&&(l.rows[0].cells[1].children=l.rows[0].cells[0].children,l.rows[0].cells[1].columnSpan=l.rows[0].cells[0].columnSpan-1,l.rows[0].cells[0].children=[]),l.removeColumn(0));else{if(s){var B=new xo;B.height=n.phaseSize,l.addRow(a.header&&a.hasHeader?1:0,B,!0),t.height=t.wrapper.height+=n.phaseSize}else{var L=new Co;L.width=n.phaseSize,l.addColumn(0,L,!0),a.header&&a.hasHeader&&(l.rows[0].cells[0].children=l.rows[0].cells[1].children,l.rows[0].cells[1].children=[],l.rows[0].cells[1].columnSpan=1,l.rows[0].cells[1].minWidth=void 0,l.rows[0].cells[0].columnSpan=a.lanes.length+1)}for(var M=0;M<a.phases.length;M++)""===a.phases[M].id&&(a.phases[M].id=xh()),_o(l,this,t,a.header&&a.hasHeader?1:0,s,M)}else s?l.updateRowHeight(a.header&&a.hasHeader?1:0,n.phaseSize,!1):l.updateColumnWidth(0,n.phaseSize,!1);if(a.header&&a.hasHeader&&d.header){var k=l.rows[0].cells[0].children[0].id,R=this.nameTable[k];this.nodePropertyChange(R,d.header,n.header)}t.height=t.wrapper.height=l.height,t.width=t.wrapper.width=l.width}else if(i.constraints){var N=i.constraints&e.NodeConstraints.Select,j=r.constraints&e.NodeConstraints.Select;if(N!==j){n=t.shape;(R=this.nameTable[t.id+n.header.id]).constraints=j?R.constraints|e.NodeConstraints.Select:R.constraints&~e.NodeConstraints.Select;var H=void 0;if(n.phaseSize>0)for(var W=0;W<n.phases.length;W++)(H=this.nameTable[t.id+n.phases[W].id+"_header"]).constraints=j?H.constraints|e.NodeConstraints.Select:H.constraints&~e.NodeConstraints.Select;var _=void 0,V=void 0,X=n.phases.length||1;for(W=0;W<n.lanes.length;W++)for(var Y=0;Y<X;Y++)(_=this.nameTable[t.id+n.lanes[W].id+Y]).constraints=j?_.constraints|e.NodeConstraints.Select:_.constraints&~e.NodeConstraints.Select,0===Y&&((V=this.nameTable[t.id+n.lanes[W].id+"_"+Y+"_header"]).constraints=j?V.constraints|e.NodeConstraints.Select:V.constraints&~e.NodeConstraints.Select)}}o=!0}return o},o.prototype.insertValue=function(t,i){if(!(this.blazorActions&e.BlazorAction.GroupClipboardInProcess)){for(var r=void 0,o=i?this.oldNodeObjects:this.oldConnectorObjects,n=0;n<o.length;n++)o[n].id===t.id&&(r=!0);r||(i?this.oldNodeObjects.push(t):this.oldConnectorObjects.push(t))}},o.prototype.nodePropertyChange=function(t,r,o,n,a,s){if(this.canEnableBlazorObject&&"helper"!==t.id){var h=Ah(t);this.insertValue(h,!0)}var d,l=t.wrapper.outerBounds,c=t.wrapper.bounds,p=!1;if(void 0!==o.width&&(t.children?t.container?t.wrapper.width=o.width:this.scaleObject(t,o.width,!0):(t.wrapper.children[0].width=o.width,d=!0,p=!0)),void 0!==o.height&&(t.children?t.container?t.wrapper.height=o.height:this.scaleObject(t,o.height,!1):(t.wrapper.children[0].height=o.height,d=!0,p=!0)),d=this.nodePropertyChangeExtend(t,r,o,d),void 0!==o.constraints&&Nr(r)!==Nr(o)&&(t.wrapper.children[0].shadow=Nr(t)?t.shadow:null),void 0!==o.offsetX){if("None"!==t.wrapper.flip){if(t.offsetX!==t.wrapper.offsetX&&void 0!==r.offsetX){var g=o.offsetX-r.offsetX;t.wrapper.offsetX=t.wrapper.offsetX+g,this.updateFlipOffset(t.wrapper,g,0,t.wrapper.flip)}}else t.wrapper.offsetX=o.offsetX;d=!0,p=!0}if(void 0!==o.offsetY){if("None"!==t.wrapper.flip){if(t.offsetY!==t.wrapper.offsetY&&void 0!==r.offsetY){var u=o.offsetY-r.offsetY;t.wrapper.offsetY=t.wrapper.offsetY+u,this.updateFlipOffset(t.wrapper,0,u,t.wrapper.flip)}}else t.wrapper.offsetY=o.offsetY;d=!0,p=!0}if(void 0!==o.pivot&&(t.wrapper.pivot=o.pivot,d=!0),void 0!==o.minWidth&&(t.wrapper.minWidth=t.wrapper.children[0].minWidth=o.minWidth,d=!0,p=!0),void 0!==o.minHeight&&(t.wrapper.minHeight=t.wrapper.children[0].minHeight=o.minHeight,d=!0,p=!0),void 0!==o.maxWidth&&(t.wrapper.maxWidth=o.maxWidth,d=!0,p=!0),void 0!==o.maxHeight&&(t.wrapper.maxHeight=o.maxHeight,d=!0,p=!0),void 0!==o.flip)if(t.wrapper.flip=o.flip,d=!0,p=!0,t.wrapper.elementActions&e.ElementAction.ElementIsGroup){if(Ma(t.wrapper,t.offsetX,t.offsetY,this,o.flip),t&&t.children)for(var f=0,m=t.children;f<m.length;f++){var y=m[f],v=this.nameTable[y];v.wrapper.flip=o.flip,this.updatePorts(v,o.flip)}}else t.wrapper.children[0].flip=o.flip,this.updatePorts(t,o.flip);if(void 0!==o.rotateAngle&&t.constraints&e.NodeConstraints.Rotate&&(t.children&&a&&this.commandHandler.rotateObjects(t,[t],t.rotateAngle-t.wrapper.rotateAngle,{x:t.offsetX,y:t.offsetY},!1),t.wrapper.rotateAngle=o.rotateAngle,d=!0,p=!0),void 0!==o.backgroundColor&&(t.wrapper.style.fill=o.backgroundColor),void 0!==o.visible&&this.updateElementVisibility(t.wrapper,t,t.visible),void 0!==o.shape&&"Bpmn"!==t.shape.type&&(d=!0,aa(o,t,r,this),p=!0),o.margin&&(d=!0,this.updateMargin(t,o),p=!0),((void 0!==o.shape&&void 0===o.shape.type||void 0!==o.width||void 0!==o.height||void 0!==o.style)&&"Bpmn"===t.shape.type&&this.bpmnModule||sf.base.isBlazor()&&o&&o.shape&&"Bpmn"===o.shape.type)&&(d=!0,p=!0,this.bpmnModule.updateBPMN(o,r,t,this)),"UmlActivity"===t.shape.type&&(!sf.base.isBlazor()&&"FinalNode"===t.shape.shape||sf.base.isBlazor()&&"FinalNode"===t.shape.umlActivityShape)&&(d=!0,p=!0,this.updateUMLActivity(o,r,t,this)),(t.shape&&"UmlClassifier"===t.shape.type||t.parentId&&this.nameTable[t.parentId]&&"UmlClassifier"===this.nameTable[t.parentId].shape.type)&&(d=!0,p=!0),void 0!==o.ports)for(var b=0,w=Object.keys(o.ports);b<w.length;b++){var x=w[b],C=Number(x);d=!0;var S=o.ports[x],P=t.ports[C];this.updatePort(S,P,t.wrapper),p=!0}if(void 0!==o.annotation||void 0!==o.annotations||void 0!==o.width)for(var T=0,A=Object.keys(o.annotations||t.annotations);T<A.length;T++){x=A[T],C=Number(x);d=!0;S=void 0;S=o.annotation?o.annotation:o.annotations?o.annotations[x]:t.annotations;var z=t.annotations[C];if(z){var O=!!t.width;this.updateAnnotation(S,z,t.wrapper,t,O);var I=this.nameTable[t.parentId];if(I&&"SwimLane"===I.shape.type){if(t.isLane||t.isPhase)for(var D=t.isLane?I.shape.lanes:I.shape.phases,E=0;E<D.length;E++)if(D[E].id===(t.LaneHeaderParent||t.PhaseHeaderParent)){D[E].header.annotation.content=t.annotations[0].content,D[E].header.annotation.style=t.annotations[0].style;break}}}}if(void 0===o.expandIcon&&void 0===o.collapseIcon&&void 0===o.isExpanded||(this.updateIcon(t),this.updateDefaultLayoutIcons(t),void 0!==o.isExpanded&&this.commandHandler.expandNode(t,this),d=!0),void 0!==o.fixedUserHandles){C=void 0,S=void 0;for(var B=void 0,L=0,M=Object.keys(o.fixedUserHandles);L<M.length;L++){x=M[L];C=Number(x),d=!0,o.fixedUserHandles[C]&&(S=o.fixedUserHandles[C]),(B=t.fixedUserHandles[C])&&this.updateNodefixedUserHandle(S,B,t.wrapper,t)}}if(void 0!==o.tooltip&&this.updateTooltip(t,o),d){if(void 0!==this.bpmnModule&&this.bpmnModule.updateTextAnnotationProp(t,{offsetX:r.offsetX||t.offsetX,offsetY:r.offsetY||t.offsetY},this),this.checkSelectedItem(t)&&t.wrapper.children[0]instanceof Se&&t.wrapper.children[0].refreshTextElement(),t.wrapper.measure(new i(t.wrapper.bounds.width,t.wrapper.bounds.height),t.id,this.onLoadImageSize.bind(this)),t.wrapper.arrange(t.wrapper.desiredSize),this.updateObject(t,r,o),!("SwimLane"!==t.shape.type||this.currentSymbol||this.diagramActions&e.DiagramAction.ToolAction)){nn(this,t);var k=t.wrapper.children[0],R=t.shape,N=k.columnDefinitions().length;if("Horizontal"===R.orientation){C=R.header&&R.hasHeader?1:0;on(t,this,k.rows[C].cells[N-1],N-1)}t.wrapper.measure(new i(t.wrapper.bounds.width,t.wrapper.bounds.height)),t.wrapper.arrange(t.wrapper.desiredSize)}if(this.diagramActions&e.DiagramAction.ToolAction&&!(this.diagramActions&e.DiagramAction.UndoRedo)||this.checkSelectedItem(t)&&this.updateSelector(),!1===l.equals(l,t.wrapper.outerBounds)&&this.updateQuad(t),n?t&&t.visible&&t.outEdges&&this.updateIconVisibility(t,0!==t.outEdges.length):this.commandHandler.connectorSegmentChange(t,c,void 0!==o.rotateAngle),void 0!==this.bpmnModule&&this.bpmnModule.updateDocks(t,this),o.annotations&&t.processId||this.updateGroupOffset(t),t.parentId&&this.nameTable[t.parentId]){var j=this.nameTable[t.parentId];j.wrapper.measure(new i(j.wrapper.width,t.wrapper.height)),j.wrapper.arrange(j.wrapper.desiredSize),j.offsetX=j.wrapper.offsetX,j.offsetY=j.wrapper.offsetY}if(!1===c.equals(c,t.wrapper.bounds)&&(this.updateGroupSize(t),t.children&&this.updateGroupOffset(t)),"SwimLane"===t.shape.type&&!this.currentSymbol&&this.diagramActions&e.DiagramAction.Render)Jo(Uo(this,t.wrapper.children[0]),this);if(!this.preventNodesUpdate&&((!Yr(this)||Yr(this)&&this.scroller.oldCollectionObjects.indexOf(t.id)>-1)&&(this.diagramActions&e.DiagramAction.PreventZIndexOnDragging?this.updateDiagramObject(t,!0):this.updateDiagramObject(t)),!n&&p&&(this.lineRoutingModule&&this.diagramActions&&this.constraints&e.DiagramConstraints.LineRouting&&"helper"!==t.id&&(this.diagramActions&e.DiagramAction.ToolAction||this.lineRoutingModule.renderVirtualRegion(this,!0)),this.updateConnectorEdges(t),"helper"!==t.id&&!(this.diagramActions&e.DiagramAction.ToolAction))))for(var H=this.spatialSearch.findObjects(t.wrapper.outerBounds),W=0;W<H.length;W++){var _=H[W];_ instanceof wr&&this.connectorPropertyChange(H[W],{},{sourceID:_.sourceID,targetID:_.targetID,sourcePortID:_.sourcePortID,targetPortID:_.targetPortID,sourcePoint:_.sourcePoint,targetPoint:_.targetPoint})}"New"!==t.status&&this.diagramActions&&(t.status="Update")}if(!s){var V=t,X={element:V,cause:this.diagramActions,oldValue:r,newValue:o};sf.base.isBlazor()&&this.propertyChange&&(X.element={node:_a(V)},X.oldValue={node:_a(r)},X.newValue={node:_a(o)}),this.triggerEvent(e.DiagramEvent.propertyChange,X)}},o.prototype.updatePorts=function(e,t){if(e&&e.ports.length>0)for(var r=0,o=Object.keys(e.ports);r<o.length;r++){var n=o[r],a=Number(n),s=e.ports[a],h=this.getWrapper(e.wrapper,s.id);(h=La(h,t,s)).relativeMode="Point",h.measure(new i(h.width,h.height)),h.arrange(h.desiredSize)}},o.prototype.updateFlipOffset=function(e,t,i,r){if(e.hasChildren())for(var o=0,n=e.children;o<n.length;o++){var a=n[o];"Horizontal"!==r&&"Both"!==r||(a.flipOffset.x=a.flipOffset.x+t),"Vertical"!==r&&"Both"!==r||(a.flipOffset.y=a.flipOffset.y+i),(a instanceof Te||a instanceof xe)&&this.updateFlipOffset(a,t,i,r)}},o.prototype.updateUMLActivity=function(e,t,i,r){if(void 0!==e.width||void 0!==e.height){var o=i.wrapper.children[0].children[0];o.width=e.width,o.height=e.height;var n=i.wrapper.children[0].children[1];n.width=e.width/1.5,n.height=e.height/1.5}},o.prototype.updateConnectorProperties=function(e){if(this.preventConnectorsUpdate){-1===this.selectionConnectorsList.indexOf(e)&&this.selectionConnectorsList.push(e)}else{var t={sourcePoint:e.sourcePoint,targetPoint:e.targetPoint,sourceID:e.sourceID,targetID:e.targetID,sourcePortID:e.sourcePortID,targetPortID:e.targetPortID};this.connectorPropertyChange(e,{},t,void 0,!0)}},o.prototype.updateConnectorEdges=function(e){if(e.inEdges.length>0)for(var t=0;t<e.inEdges.length;t++)this.updateConnectorProperties(this.nameTable[e.inEdges[t]]);if(e.outEdges.length>0)for(var i=0;i<e.outEdges.length;i++)this.updateConnectorProperties(this.nameTable[e.outEdges[i]]);e.parentId&&this.nameTable[e.parentId]&&this.updateConnectorEdges(this.nameTable[e.parentId])},o.prototype.connectorProprtyChangeExtend=function(e,t,i,r){return void 0!==i.type&&i.type!==t.type&&e.segments.length>0&&void 0===i.segments&&(e.segments=[]),void 0!==i.shape&&void 0!==e.shape&&e.shape&&"Bpmn"===e.shape.type&&this.bpmnModule&&this.bpmnModule.updateBPMNConnector(e,t,i,this),void 0!==e.constraints?(this.updateThumbConstraints(this.selectedItems.connectors,this.selectedItems),!0):r},o.prototype.connectorPropertyChange=function(t,r,o,n,a){if(this.canEnableBlazorObject){var s=Ah(t);this.insertValue(s,!1)}var h,d,l,c,p=t.wrapper.bounds,g=!1,u=[];if(g=this.connectorProprtyChangeExtend(t,r,o,g),void 0!==o.visible&&this.updateElementVisibility(t.wrapper,t,t.visible),void 0!==o.sourcePoint||void 0!==o.targetPoint||void 0!==o.sourceID||void 0!==o.targetID||void 0!==o.targetPadding||void 0!==o.sourcePortID||void 0!==o.targetPortID||void 0!==o.sourcePadding||void 0!==o.type||void 0!==o.segments||void 0!==o.flip){if(void 0!==o.sourceID&&o.sourceID!==r.sourceID||o.sourcePortID){var f=this.nameTable[t.sourceID];if(d=this.findInOutConnectPorts(f,!1),(!f||Wr(f)||""!==t.sourcePortID&&_r(d))&&(t.sourceWrapper=f?this.getEndNodeWrapper(f,t,!0):void 0,t.sourcePortID&&void 0===o.sourcePortID&&(t.sourcePortWrapper=f?this.getWrapper(f.wrapper,t.sourcePortID):void 0),this.removePortEdges(this.nameTable[r.sourceID]||f,r.sourcePortID||t.sourcePortID,t.id,!1)),void 0!==o.sourceID&&void 0!==r.sourceID&&""!==r.sourceID){var m=this.nameTable[r.sourceID];void 0!==m&&m.outEdges&&-1!==m.outEdges.indexOf(t.id)&&pa(m.outEdges,t.id)}this.updateEdges(t)}if(void 0!==o.targetID&&o.targetID!==r.targetID){var y=this.nameTable[o.targetID];if(h=this.findInOutConnectPorts(y,!0),(!y||jr(y)||""!==t.targetPortID&&Hr(h))&&(t.targetWrapper=y?this.getEndNodeWrapper(y,t,!1):void 0,t.targetPortID&&void 0===o.targetPortID&&(t.targetPortWrapper=y?this.getWrapper(y.wrapper,t.targetPortID):void 0),this.removePortEdges(this.nameTable[r.targetID]||y,r.targetPortID||t.targetPortID,t.id,!0)),void 0!==r&&void 0!==r.targetID&&""!==r.targetID){var v=this.nameTable[r.targetID];void 0!==v&&v.inEdges&&-1!==v.inEdges.indexOf(t.id)&&pa(v.inEdges,t.id)}this.updateEdges(t)}if(void 0!==o.sourcePortID&&o.sourcePortID!==r.sourcePortID)t.sourceID&&this.nameTable[t.sourceID]&&(l=this.nameTable[t.sourceID].wrapper),!(f=this.nameTable[t.sourceID])||Wr(f)||""!==t.sourcePortID&&_r(d)?t.sourcePortWrapper=l?this.getWrapper(l,o.sourcePortID):void 0:""!==t.sourcePortID||Wr(f)||(t.sourcePortWrapper=void 0);if(void 0!==o.targetPortID&&o.targetPortID!==r.targetPortID){y=this.nameTable[t.targetID];t.targetID&&this.nameTable[t.targetID]&&(c=this.nameTable[t.targetID].wrapper),!y||jr(y)||""!==t.targetPortID&&Hr(h)?t.targetPortWrapper=c?this.getWrapper(c,o.targetPortID):void 0:""!==t.targetPortID||jr(y)||(t.targetPortWrapper=void 0)}void 0!==o.flip&&(t.flip=o.flip,Ba(t)),"Orthogonal"===t.type&&this.lineRoutingModule&&this.diagramActions&&this.constraints&e.DiagramConstraints.LineRouting&&!(this.diagramActions&e.DiagramAction.ToolAction)&&(this.lineRoutingModule.renderVirtualRegion(this,!0),this.lineRoutingModule.refreshConnectorSegments(this,t,!1)),u=this.getPoints(t)}void 0!==o.style&&ia(o.style,t.wrapper.children[0]),(u.length>0||void 0!==o.sourceDecorator||void 0!==o.targetDecorator&&Xa(Object.keys(o.targetDecorator))||void 0!==o.cornerRadius)&&(ga(t,u.length>0?u:t.intermediatePoints,this.diagramActions),void 0!==o.type&&(g=!0),u.length>0&&(t.wrapper.measure(new i(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize),this.updateConnectorAnnotation(t),this.updateConnectorfixedUserHandles(t),this.updateObject(t,r,o))),(o.sourcePoint||o.targetPoint||o.segments)&&this.diagramActions===e.DiagramAction.Render&&(g=!0),"Bpmn"===t.shape.type&&"Default"===t.shape.sequence&&this.commandHandler.updatePathElementOffset(t),n||this.updateBridging(),this.updateAnnotations(o,t),this.updatefixedUserHandle(o,t),t.wrapper.measure(new i(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize),!1===p.equals(p,t.wrapper.bounds)&&(this.updateQuad(t),this.updateGroupSize(t)),!0!==g||!this.checkSelectedItem(t)||this.diagramActions&e.DiagramAction.ToolAction&&!(this.diagramActions&e.DiagramAction.UndoRedo)||this.updateSelector(),this.preventConnectorsUpdate||(!Yr(this)||Yr(this)&&this.scroller.oldCollectionObjects.indexOf(t.id)>-1)&&(this.diagramActions&e.DiagramAction.PreventZIndexOnDragging?this.updateDiagramObject(t,!0):this.updateDiagramObject(t)),this.diagramActions&&"New"!==t.status&&(t.status="Update"),this.triggerPropertyChange(a,t,r,o)},o.prototype.removePortEdges=function(e,t,i,r){if(e)for(var o=0;o<e.ports.length;o++){var n=e.ports[o];if(n.id===t)pa(r?n.inEdges:n.outEdges,i)}},o.prototype.getpropertyChangeArgs=function(e,t,i,r){return r.element={connector:_a(e)},r.oldValue={connector:_a(t)},r.newValue={connector:_a(i)},r},o.prototype.triggerPropertyChange=function(t,i,r,o){if(!t){var n=i,a={element:_a(n),cause:this.diagramActions,oldValue:_a(r),newValue:_a(o)};sf.base.isBlazor()&&(a=this.getpropertyChangeArgs(n,r,o,a)),this.triggerEvent(e.DiagramEvent.propertyChange,a)}},o.prototype.findInOutConnectPorts=function(e,t){var i={};return e&&(i=wa(e,t)),i},o.prototype.getPoints=function(e,t){var i=!!this.lineDistributionModule;return e.getConnectorPoints(e.type,t,"ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type?this.layout.orientation:void 0,i)},o.prototype.updateNodeProperty=function(e,t,i){if(void 0===t)this.updateElementVisibility(e,this.nameTable[e.id],t);else{e.style.opacity=i;for(var r=0;r<e.children.length;r++)e.children[r]instanceof xe&&this.updateNodeProperty(e.children[r],void 0,i),e.children[r].style.opacity=i}},o.prototype.checkSelectedItem=function(e){var t=this.selectedItems,i=!1,r=[];return(r=r.concat(t.nodes,t.connectors)).length>0&&e.id===r[r.length-1].id&&(i=!0),i},o.prototype.updateDiagramContainerVisibility=function(e,t){if(e instanceof xe)for(var i=0;i<e.children.length;i++)this.updateDiagramContainerVisibility(e.children[i],t);e.visible=t},o.prototype.updateElementVisibility=function(t,i,r){if(void 0!==r){if(t.visible=r,i instanceof js){if(i.children)for(var o=0,n=i.children;o<n.length;o++){var a=n[o];this.updateElementVisibility(this.nameTable[a].wrapper,this.nameTable[a],r)}else t.children[0].visible=r,this.updateDiagramContainerVisibility(t.children[0],r),"Bpmn"===i.shape.type&&this.bpmnModule&&this.bpmnModule.updateElementVisibility(i,r,this);if(i.ports)for(var s=0,h=i.ports;s<h.length;s++){var d=h[s];if(d.visibility&e.PortVisibility.Visible)(m=this.getWrapper(t,d.id)).visible=r}if(i.annotations)for(var l=0,c=i.annotations;l<c.length;l++){var p=c[l];(m=this.getWrapper(t,p.id)).visible=r}}else for(var g=0;g<3;g++)t.children[g].visible=r;if(i.annotations)for(var u=0,f=i.annotations;u<f.length;u++){p=f[u];(m=this.getWrapper(t,p.id)).visible=r}if(i.expandIcon||i.collapseIcon){var m;if(m=this.getWrapper(t,"icon_content")){for(g=0;g<m.children.length;g++)m.children[g].visible=r;m.visible=r}i&&i.visible&&i.outEdges&&this.updateIconVisibility(i,0!==i.outEdges.length)}!1===r&&this.unSelect(this.nameTable[t.id]),(i instanceof js&&!this.preventNodesUpdate||i instanceof wr&&!this.preventConnectorsUpdate)&&this.diagramActions&&this.updateDiagramObject(this.nameTable[t.id],void 0,!0)}},o.prototype.updateAnnotations=function(e,t){if(void 0!==e.annotations)for(var i=0,r=Object.keys(e.annotations);i<r.length;i++){var o=r[i],n=Number(o),a=e.annotations[o],s=t.annotations[n];this.updateAnnotation(a,s,t.wrapper,t)}},o.prototype.updatefixedUserHandle=function(e,t){if(void 0!==e.fixedUserHandles)for(var i=void 0,r=void 0,o=void 0,n=0,a=Object.keys(e.fixedUserHandles);n<a.length;n++){var s=a[n];i=Number(s),r=e.fixedUserHandles[s],o=t.fixedUserHandles[i],this.updateConnectorfixedUserHandle(r,o,t.wrapper,t)}},o.prototype.updateConnectorfixedUserHandle=function(e,t,r,o,n){var a=!1,s=this.getWrapper(r,t.id);void 0!==s&&(void 0!==e.width&&(s.width=e.width,a=!0),void 0!==e.height&&(s.height=e.height,a=!0),t instanceof qi&&void 0!==e.offset&&o.updateAnnotation(t,o.intermediatePoints,o.wrapper.bounds,s),t instanceof qi&&e.displacement&&(void 0===e.displacement.x&&void 0===e.displacement.y||(a=!0)),void 0!==e.fill&&(s.style.fill=e.fill),void 0!==e.handleStrokeColor&&(s.style.strokeColor=e.handleStrokeColor),void 0!==e.handleStrokeWidth&&(s.style.strokeWidth=e.handleStrokeWidth),void 0!==e.visibility&&(s.visible=e.visibility),void 0!==e.cornerRadius&&(s.cornerRadius=e.cornerRadius),this.updatefixedUserHandleContent(e,a,s,o,t,r),!0===a&&(s.measure(new i(s.width,s.height)),s.arrange(s.desiredSize)))},o.prototype.updateAnnotation=function(t,r,o,n,a){var s=!1,h=this.getWrapper(o,r.id);if(void 0!==h){if(void 0!==t.width&&void 0!==t.height&&(h.width=t.width,h.height=t.height,s=!0),void 0!==t.rotateAngle&&(h.rotateAngle=t.rotateAngle),!a||h instanceof Yi||h.refreshTextElement(),r instanceof Ze&&void 0!==t.segmentAngle&&(h.rotateAngle=r.rotateAngle),r instanceof Fe&&void 0!==t.offset){var d=t.offset;s=!0;var l=void 0!==d.x?d.x:r.offset.x,c=void 0!==d.y?d.y:r.offset.y;h.setOffsetWithRespectToBounds(l,c,"Fraction"),h.relativeMode="Point"}else r instanceof Ze&&(void 0!==t.offset||void 0!==t.segmentAngle)&&n.updateAnnotation(r,n.intermediatePoints,n.wrapper.bounds,h);if(r instanceof Ze&&t.displacement&&(void 0===t.displacement.x&&void 0===t.displacement.y||(s=!0)),void 0!==t.margin&&(s=!0,void 0!==t.margin.bottom&&(h.margin.bottom=t.margin.bottom),void 0!==t.margin.top&&(h.margin.top=t.margin.top),void 0!==t.margin.left&&(h.margin.left=t.margin.left),void 0!==t.margin.right&&(h.margin.right=t.margin.right)),(s||a)&&(h.width=r.width||n.width,r.template&&(h.width=h.width||h.actualSize.width,h.height=r.height||n.height||h.actualSize.height)),void 0!==t.horizontalAlignment&&(h.horizontalAlignment=t.horizontalAlignment,s=!0),void 0!==t.verticalAlignment&&(h.verticalAlignment=t.verticalAlignment,s=!0),void 0!==t.visibility&&(h.visible=!(!o.visible||!t.visibility)),void 0!==t.constraints){h.constraints&e.AnnotationConstraints.Select&&!(t.constraints&e.AnnotationConstraints.Select)&&zd(this,n,!1,h),h.constraints=t.constraints}void 0!==t.style&&ia(t.style,h),void 0!==t.hyperlink&&oa(t.hyperlink,h,r),this.updateAnnotationContent(t,s,h,n,r,o),!0===s&&(h.measure(new i(h.width,h.height)),h.arrange(h.desiredSize)),h instanceof Yi||h.refreshTextElement()}},o.prototype.updatefixedUserHandleContent=function(e,t,i,r,o,n){void 0!==e&&this.updateConnectorfixedUserHandleWrapper(i,r,o,n)},o.prototype.updateConnectorfixedUserHandleWrapper=function(e,t,i,r){for(var o=0,n=this.views;o<n.length;o++){var a=n[o];gh(e.id+"_groupElement",a),gh(e.id+"_html_element",a)}if(t instanceof wr){var s=t.wrapper.children[0],h=new b(s.offsetX-s.width/2,s.offsetY-s.height/2,s.width,s.height);e=t.getfixedUserHandle(t.fixedUserHandles[t.fixedUserHandles.length-1],t.intermediatePoints,h)}for(var d=0;d<r.children.length;d++)e.id===r.children[d].id&&r.children.splice(d,1,e)},o.prototype.updateAnnotationContent=function(e,t,i,r,o,n){void 0!==e.content&&(i&&(!0,"UmlActivity"===r.shape.type&&(sf.base.isBlazor()&&"StructuredNode"===r.shape.umlActivityShape||!sf.base.isBlazor()&&"StructuredNode"===r.shape.shape)?i.content="<<"+e.content+">>":i.content=e.content),i instanceof Yi&&this.updateAnnotationWrapper(i,r,o,n)),void 0!==e.template&&(i.content=e.template,this.updateAnnotationWrapper(i,r,o,n))},o.prototype.updateAnnotationWrapper=function(e,t,i,r){for(var o=0,n=this.views;o<n.length;o++){var a=n[o];gh(e.id+"_groupElement",a),gh(e.id+"_html_element",a)}if(t instanceof js)e=t.initAnnotationWrapper(i,this.element.id);else if(t instanceof wr){var s=t.wrapper.children[0],h=new b(s.offsetX-s.width/2,s.offsetY-s.height/2,s.width,s.height);e=t.getAnnotationElement(t.annotations[t.annotations.length-1],t.intermediatePoints,h,this.getDescription,this.element.id)}for(var d=0;d<r.children.length;d++)e.id===r.children[d].id&&r.children.splice(d,1,e)},o.prototype.updateNodefixedUserHandle=function(e,t,r,o){var n=!1,a=this.getWrapper(r,t.id);if(void 0!==a){if(void 0!==e.width&&(a.actualSize.width=e.width,n=!0),void 0!==e.height&&(a.height=e.height,n=!0),t instanceof Zi&&void 0!==e.offset){var s=e.offset;n=!0;var h=void 0!==s.x?s.x:t.offset.x,d=void 0!==s.y?s.y:t.offset.y;a.setOffsetWithRespectToBounds(h,d,"Fraction"),a.relativeMode="Point"}void 0!==e.margin&&(n=!0,void 0!==e.margin.bottom&&(a.margin.bottom=e.margin.bottom),void 0!==e.margin.top&&(a.margin.top=e.margin.top),void 0!==e.margin.left&&(a.margin.left=e.margin.left),void 0!==e.margin.right&&(a.margin.right=e.margin.right)),void 0!==e.visibility&&(a.visible=e.visibility),void 0!==e.fill&&(a.style.fill=e.fill),void 0!==e.handleStrokeColor&&(a.style.strokeColor=e.handleStrokeColor),void 0!==e.handleStrokeWidth&&(a.style.strokeWidth=e.handleStrokeWidth),void 0!==e.cornerRadius&&(a.cornerRadius=e.cornerRadius),this.updatefixedUserHandleWrapper(a,o,t,r),!0===n&&(a.measure(new i(a.width,a.height)),a.arrange(a.desiredSize))}},o.prototype.updatefixedUserHandleWrapper=function(e,t,i,r){for(var o=0,n=this.views;o<n.length;o++){var a=n[o];gh(e.id+"_groupElement",a),gh(e.id+"_html_element",a)}t instanceof js&&(e=t.initfixedUserHandles(i));for(var s=0;s<r.children.length;s++)e.id===r.children[s].id&&r.children.splice(s,1,e)},o.prototype.updatePort=function(t,r,o){var n=!1,a=this.getWrapper(o,r.id);if(void 0!==a){if(void 0!==t.offset){n=!0;var s=void 0!==t.offset.x?t.offset.x:r.offset.x,h=void 0!==t.offset.y?t.offset.y:r.offset.y;a.setOffsetWithRespectToBounds(s,h,"Fraction"),a.relativeMode="Point"}if(void 0!==t.width&&(n=!0,a.width=t.width),void 0!==t.height&&(n=!0,a.height=t.height),void 0!==t.visibility&&(a.visible=!(!o.visible||!ya(r,e.PortVisibility.Visible))),void 0!==t.margin&&(n=!0,void 0!==t.margin.bottom&&(a.margin.bottom=t.margin.bottom),void 0!==t.margin.top&&(a.margin.top=t.margin.top),void 0!==t.margin.right&&(a.margin.right=t.margin.right),void 0!==t.margin.left&&(a.margin.left=t.margin.left)),void 0!==t.horizontalAlignment&&(n=!0,a.horizontalAlignment=t.horizontalAlignment),void 0!==t.verticalAlignment&&(n=!0,a.verticalAlignment=t.verticalAlignment),void 0!==t.style&&(void 0!==t.style.fill&&(a.style.fill=t.style.fill),void 0!==t.style.opacity&&(a.style.opacity=t.style.opacity),void 0!==t.style.strokeColor&&(a.style.strokeColor=t.style.strokeColor),void 0!==t.style.strokeWidth&&(a.style.strokeWidth=t.style.strokeWidth),void 0!==t.style.strokeDashArray&&(a.style.strokeDashArray=t.style.strokeDashArray)),void 0!==t.shape&&a){var d=qe(t.shape);a.data=d,a.canMeasurePath=!0}void 0!==t.pathData&&(a.data=String(t.pathData),n=!0),!0===n&&(a.measure(new i(a.width,a.height)),a.arrange(a.desiredSize))}},o.prototype.updateIcon=function(t){var i=this.getWrapper(t.wrapper,"icon_content"),r=this.diagramActions&e.DiagramAction.Render?this.element.id:void 0;if(i){if("SVG"===this.mode){var o=Ks(t.wrapper.id+"_icon_content",r);if(o){var n=Ks(o.id+"_rect",r),a=Ks(o.id+"_shape",r),s=Ks(a.id+"_native_element",r);s&&s.parentNode.removeChild(s),a.parentNode.removeChild(a),n.parentNode.removeChild(n),o.parentNode.removeChild(o)}}var h=t.wrapper.children.indexOf(i);t.wrapper.children.splice(h,1)}var d=this.getPortContainer(t);t.initIcons(this.getDescription,this.layout,d,this.element.id)},o.prototype.getPortContainer=function(e){if(e.children)for(var t=0;t<e.wrapper.children.length;t++)if(e.wrapper.children[t].id===e.id+"group_container")return e.wrapper.children[t];return e.wrapper},o.prototype.updateTooltip=function(e,t){void 0!==t.tooltip.content&&(e.tooltip.content=t.tooltip.content),void 0!==t.tooltip.position&&(e.tooltip.position=t.tooltip.position),void 0!==t.tooltip.height&&(e.tooltip.height=t.tooltip.height),void 0!==t.tooltip.width&&(e.tooltip.width=t.tooltip.width),void 0!==t.tooltip.showTipPointer&&(e.tooltip.showTipPointer=t.tooltip.showTipPointer),void 0!==t.tooltip.relativeMode&&(e.tooltip.relativeMode=t.tooltip.relativeMode)},o.prototype.updateQuad=function(e){this.spatialSearch.updateQuad(e.wrapper)&&!this.preventDiagramUpdate&&this.updatePage()},o.prototype.removeFromAQuad=function(e){if(e.children)for(var t=void 0,i=e.children,r=0;r<i.length;r++)(t=this.nameTable[i[r]])&&this.removeFromAQuad(t);this.spatialSearch.removeFromAQuad(e.wrapper),this.spatialSearch.updateBounds(e.wrapper)&&!this.preventDiagramUpdate&&this.updatePage()},o.prototype.updateGroupSize=function(e){var t;e.parentId&&(t=this.nameTable[e.parentId])&&(t.parentId?this.updateGroupSize(t):(t.wrapper.measure(new i),t.wrapper.arrange(t.wrapper.desiredSize),this.updateGroupOffset(t),this.updateDiagramObject(t)))},o.prototype.updatePage=function(){if(this.diagramActions&e.DiagramAction.Render&&!(this.diagramActions&e.DiagramAction.DragUsingMouse)){this.scroller.updateScrollOffsets(),this.scroller.setSize();for(var t=0,i=this.views;t<i.length;t++){var r=i[t],n=this.views[r];n instanceof o||n.updateView(n)}}this.diagramActions&e.DiagramAction.DragUsingMouse&&this.renderPageBreaks()},o.prototype.protectPropertyChange=function(e){this.isProtectedOnChange=e},o.prototype.getProtectPropertyChangeValue=function(){return this.isProtectedOnChange},o.prototype.enableServerDataBinding=function(e){sf.base.isBlazor()&&(this.allowServerDataBinding=e,e&&(this.bulkChanges={}))},o.prototype.updateShadow=function(e,t){void 0!==t.angle&&(e.angle=t.angle),void 0!==t.color&&(e.color=t.color),void 0!==t.distance&&(e.distance=t.distance),void 0!==t.opacity&&(e.opacity=t.opacity)},o.prototype.updateMargin=function(e,t){void 0!==t.margin.top&&(e.margin.top=t.margin.top),void 0!==t.margin.bottom&&(e.margin.bottom=t.margin.bottom),void 0!==t.margin.left&&(e.margin.left=t.margin.left),void 0!==t.margin.right&&(e.margin.right=t.margin.right)},o.prototype.removePreviewChildren=function(e){if(e.children&&e.children.length&&e.shape&&"SwimLane"===e.shape.type){for(var t=0;t<e.children.length;t++){var i=e.children[t],r=this.nodes.indexOf(this.nameTable[i]);r>=0&&this.nodes.splice(r,1),delete this.nameTable[i]}var o=this.nodes.indexOf(this.nameTable[this.currentSymbol.id]);o>=0&&this.nodes.splice(o,1)}},o.prototype.initDroppables=function(){var t,i,r=this,o={},n={};this.droppable=new sf.base.Droppable(this.element),this.droppable.over=function(a){if(r.currentSymbol)a.event.touches&&a.event.touches.length&&r.eventHandler.mouseMove(a.event,a.event.touches);else{var s=null;if(!a.dragData&&"drag"===a.name){var h=document.getElementsByClassName("e-dragclone")[0];h&&(s=h)}if(a.dragData||s){var d=void 0,l=void 0;document.getElementById(r.element.id+"content").focus();var c=r.eventHandler.getMousePosition(a.event),p=void 0,g=s||a.dragData.helper,u=g.getAttribute("paletteId"),f=void 0,m=void 0,y=void 0,v=void 0;if(u){var w=document.getElementById(u).ej2_instances[0];r.droppable.sourceElement=w;if(w){var x=w.selectedSymbols;r.allowServerDataBinding=!1,p=Ah(w.selectedSymbols),o=w.childTable;var C=x.wrapper.children[0].children[0];if(v=Ya(w,p,C),w.selectedSymbols instanceof js){"TextAnnotation"===x.shape.shape?(p.offsetX=c.x+11+v.width*p.pivot.x,p.offsetY=c.y+11+v.height*p.pivot.y):(p.offsetX=c.x+5+v.width*p.pivot.x,p.offsetY=c.y+v.height*p.pivot.y);var S=new js(r,"nodes",p,!0);"Bpmn"===S.shape.type&&S.shape.activity.subProcess.processes&&S.shape.activity.subProcess.processes.length&&(S.shape.activity.subProcess.processes=[]),f=S.dragSize,m=S.previewSize,y=w.symbolDragSize;var P=w.symbolPreview;if(S.width=f.width||y.width||m.width||P.width||S.width,S.height=f.height||y.height||m.height||P.height||S.height,"SwimLane"===S.shape.type){if(r.diagramActions|=e.DiagramAction.PreventHistory,S.shape.isLane){S.children=[],t={id:"header"+xh()},"Horizontal"===S.shape.orientation?(t.width=S.shape.lanes[0].header.width,t.height=S.shape.lanes[0].height):(t.width=S.shape.lanes[0].width,t.height=S.shape.lanes[0].header.height),t.style=S.shape.lanes[0].header.style,t.offsetX=c.x+5+t.width/2,t.offsetY=c.y+t.height/2,r.diagramActions|=e.DiagramAction.PreventCollectionChangeOnDragOver,t=r.add(t),i={id:"body"+xh()},"Horizontal"===S.shape.orientation?(i.width=S.shape.lanes[0].width-t.width,i.height=S.shape.lanes[0].height,i.offsetX=c.x+5+(S.shape.lanes[0].header.width+i.width/2),i.offsetY=c.y+i.height/2):(i.width=S.shape.lanes[0].width,i.height=S.shape.lanes[0].height-t.height,i.offsetX=c.x+5+i.width/2,i.offsetY=c.y+(S.shape.lanes[0].header.height+i.height/2)),i.style=S.shape.lanes[0].style,i=r.add(i);var T={id:"group"+xh(),children:[t.id,i.id]};T.shape=S.shape,T.width=S.shape.lanes[0].width,T.height=S.shape.lanes[0].height,T.previewSize=S.previewSize,T.dragSize=S.dragSize,T.addInfo=S.addInfo,S=r.add(T),r.diagramActions&=~e.DiagramAction.PreventCollectionChangeOnDragOver}r.diagramActions&=~e.DiagramAction.PreventHistory}if(S.shape.isPhase&&((l="Horizontal"===S.shape.orientation)?(S.offsetX=c.x+5+(S.width||C.actualSize.width)/2,S.offsetY=c.y,S.shape.data="M20,"+S.height/2+" L"+(S.width-20)+","+S.height/2+"z",S.height=1):(S.offsetX=c.x+5,S.offsetY=c.y+(S.height||C.actualSize.height)/2,S.shape.data="M"+S.width/2+",20 L"+S.width/2+","+(S.height-20)+"z",S.width=1)),d=S,p.children){var A=p;n=r.getChildren(A,{},o),Pa(A,-A.offsetX,-A.offsetY,n,!0,r)}}else if(w.selectedSymbols instanceof wr){d=new wr(r,"connectors",p,!0);var z=b.toBounds([d.sourcePoint,d.targetPoint]),O=c.x-z.left,I=c.y-z.top;d.sourcePoint.x+=O,d.sourcePoint.y+=I,d.targetPoint.x+=O,d.targetPoint.y+=I}d.shape.isLane||(d.id+=xh());var D={source:w,element:d,cancel:!1,diagram:r};if(sf.base.isBlazor()&&(D=r.getBlazorDragEventArgs(D)),r.enterObject=d,r.enterTable=n,r.triggerEvent(e.DiagramEvent.dragEnter,D),d instanceof js&&"SwimLane"===d.shape.type&&d.shape.isLane){var E=D.element,B=E.shape.lanes[0];l="Horizontal"===E.shape.orientation;var L=r.nameTable[d.children[0]],M=r.nameTable[d.children[1]];f=d.dragSize,m=d.previewSize,y=w.symbolDragSize,B.width=f.width||y.width||m.width||B.width,B.height=f.height||y.height||m.height||B.height,l?(t.width=B.header.width,t.height=B.height,i.width=B.width-t.width,i.height=B.height,i.offsetX=c.x+5+(B.header.width+M.width/2),i.offsetY=c.y+M.height/2):(t.width=B.width,t.height=B.header.height,i.width=B.width,i.height=B.height-t.height,i.offsetX=c.x+5+M.width/2,i.offsetY=c.y+(B.header.height+M.height/2)),t.offsetX=c.x+5+L.width/2,t.offsetY=c.y+L.height/2,d.width=B.width,d.height=B.height}d instanceof js&&d.shape.isPhase&&(l?d.height=1:d.width=1),r.activeLayer.lock||D.cancel||(r.preventDiagramUpdate=!0,d.children&&r.findChild(d,n),r.preventDiagramUpdate=!0,-1!==d.zIndex&&(d.zIndex=-1),r.initObject(d,void 0,void 0,!0),r.currentSymbol=d,"SVG"!==r.mode&&r.refreshDiagramLayer(),r.commandHandler.oldSelectedObjects=ka(r),r.commandHandler.select(d),r.commandHandler.updateBlazorSelector(),r.eventHandler.mouseDown(a.event),r.eventHandler.mouseMove(a.event,a),r.preventDiagramUpdate=!1,r.updatePage(),g.style.opacity="0"),delete r.enterObject,delete r.enterTable}r.droppable.selectedSymbols=g,r.allowServerDataBinding=!0}}}},this.droppable.drop=function(t){return Il(r,void 0,void 0,(function(){var i,r,o,n,a,s,h,d,l,c,p,g;return Dl(this,(function(u){switch(u.label){case 0:return this.allowServerDataBinding=!1,i="sourceElement",this.currentSymbol?(o=!1,a=this.currentSymbol instanceof wr,t.event.touches&&this.eventHandler.mouseUp(t.event),d=void 0,d={source:this.droppable[i],element:this.currentSymbol,target:this.eventHandler.hoverNode||this.eventHandler.lastObjectUnderMouse||this,cancel:!1,position:{x:this.currentSymbol.wrapper.offsetX,y:this.currentSymbol.wrapper.offsetY}},sf.base.isBlazor()?(d={source:_a(this.droppable[i]),element:Ea(this.currentSymbol)===wr?{connector:_a(this.currentSymbol)}:{node:_a(this.currentSymbol)},cancel:!1,target:{},position:{x:this.currentSymbol.wrapper.offsetX,y:this.currentSymbol.wrapper.offsetY}},this.getDropEventArgs(d),[4,this.triggerEvent(e.DiagramEvent.drop,d)]):[3,2]):[3,4];case 1:return d=u.sent()||d,[3,3];case 2:this.triggerEvent(e.DiagramEvent.drop,d),u.label=3;case 3:return c="id",(l=Ah(this.currentSymbol)).hasTarget=this.currentSymbol.hasTarget,this.removeFromAQuad(this.currentSymbol),this.removeObjectsFromLayer(this.nameTable[this.currentSymbol.id]),this.removeElements(this.currentSymbol),(this.currentSymbol.shape.isLane||this.currentSymbol.shape.isPhase)&&this.removeChildInNodes(this.currentSymbol),d.cancel&&qn(this.currentSymbol,this),this.currentSymbol.shape.isPhase&&(o=!0,n=this.currentSymbol.shape.orientation),this.removePreviewChildren(this.currentSymbol),delete this.nameTable[this.currentSymbol.id],this.currentSymbol=null,this.protectPropertyChange(!0),d.cancel?this.clearSelectorLayer():(this.startGroupAction(),l&&(l.shape.isLane||o)&&(o&&(l.shape.isPhase=o,l.shape.orientation=n),this.eventHandler.addSwimLaneObject(l)),"Bpmn"===l.shape.type&&l.shape.annotation&&l.hasTarget&&(s=l.shape.annotation.nodeId,l.shape.annotation.id=l.id,this.addTextAnnotation(l.shape.annotation,this.nameTable[s]),l.nodeId=""),l.shape.isLane||o||(l.children&&this.addChildNodes(l),d.target&&d.target instanceof js&&!a&&Eo(this,d.target)&&Xr(d.target)?Mo(this,d.target,l):r=this.add(l,!0),(l||r)&&Ur(this)&&this.select([this.nameTable[l[c]]]))),this.protectPropertyChange(!1),h=this.nameTable[l[c]],l.hasTarget&&(l.nodeId=l.hasTarget,this.remove(l)),this.bpmnModule&&h instanceof js&&l.processId&&(h.processId=l.processId,this.bpmnModule.dropBPMNchild(this.nameTable[h.processId],h,this)),d.cancel||this.endGroupAction(),"SVG"!==this.mode&&this.refreshDiagramLayer(),delete this.droppable[i],[3,5];case 4:d={source:_a(t.droppedElement),element:void 0,target:_a(this.eventHandler.hoverNode||this.eventHandler.lastObjectUnderMouse||this),cancel:!1,position:void 0},sf.base.isBlazor()&&(d={source:_a(t.droppedElement),element:void 0,cancel:!1,position:void 0,target:{}},this.getDropEventArgs(d)),this.triggerEvent(e.DiagramEvent.drop,d),l=void 0,c="id",u.label=5;case 5:if("selectedSymbols",this.droppable.selectedSymbols&&this.droppable.selectedSymbols.parentNode)sf.base.remove(this.droppable.selectedSymbols);else for(p=document.getElementsByClassName("e-dragclone"),g=0;g<p.length;g++)p[g].remove();return this.allowServerDataBinding=!0,[2]}}))}))},this.droppable.out=function(t){if(r.currentSymbol&&!r.eventHandler.focus){r.unSelect(r.currentSymbol),r.removeFromAQuad(r.currentSymbol),"SVG"!==r.mode&&"Native"===r.currentSymbol.shape.type&&r.removeElements(r.currentSymbol),r.removeObjectsFromLayer(r.nameTable[r.currentSymbol.id]),r.removePreviewChildren(r.currentSymbol),delete r.nameTable[r.currentSymbol.id];var i={element:_a(r.currentSymbol),diagram:r};sf.base.isBlazor()&&(i=r.getBlazorDragLeaveEventArgs(i)),r.triggerEvent(e.DiagramEvent.dragLeave,i),"SVG"!==r.mode?r.refreshDiagramLayer():r.removeElements(r.currentSymbol),r.currentSymbol=null;r.droppable.selectedSymbols.style.opacity="1";delete r.droppable.sourceElement,r.diagramRenderer.rendererActions=r.removeConstraints(r.diagramRenderer.rendererActions,e.RendererAction.DrawSelectorBorder),r.previousSelectedObject&&r.select(r.previousSelectedObject,r.previousSelectedObject.length>1),r.previousSelectedObject=null}}},o.prototype.getBlazorDragLeaveEventArgs=function(e){return e={diagramId:this.element.id,element:Ea(e.element)===wr?{connector:_a(e.element)}:{node:_a(e.element)}}},o.prototype.getDropEventArgs=function(e){if(this.eventHandler.lastObjectUnderMouse||this.eventHandler.hoverNode){var t=this.eventHandler.lastObjectUnderMouse||this.eventHandler.hoverNode;e.target=Ea(t)===wr?{connector:_a(t)}:{node:_a(t)}}else e.target.diagramId=this.element.id},o.prototype.removeChildInNodes=function(e){if(e){if(e.children)for(var t=0;t<e.children.length;t++)this.removeChildInNodes(this.nameTable[e.children[t]]);var i=this.nodes.indexOf(e);-1!==i&&this.nodes.splice(i,1)}},o.prototype.getBlazorDragEventArgs=function(e){return e={source:_a(e.source),element:Ea(e.element)===wr?{connector:_a(e.element)}:{node:_a(e.element)},cancel:e.cancel,diagramId:this.element.id}},o.prototype.findChild=function(e,t){for(var i,r,o=0;o<e.children.length;o++)(i=t[e.children[o]])&&(i.children&&this.findChild(i,t),i.id=i.id+xh(),t[i.id]=i,e.children[o]=i.id,r=new js(this,"nodes",i,!0),this.initObject(r,void 0,void 0,!0))},o.prototype.getChildren=function(e,t,i){for(var r,o=0;o<e.children.length;o++)(r=i[e.children[o]])&&(r.children&&(t=this.getChildren(r,t,i)),t[r.id]=Ah(r));return t},o.prototype.addChildNodes=function(e){for(var t,i=0;i<e.children.length;i++)(t=this.nameTable[e.children[i]])&&(t.children&&this.addChildNodes(t),this.add(t,!0))},o.prototype.moveNode=function(e){for(var t,i=this.commandHandler.getObjectLayer(e.id),r=i.zIndex,o=i.objects.length,n=0;n<this.layers.length;n++)r===this.layers[n].zIndex&&(t=this.layers[n+1]);if(o>1)this.commandHandler.moveSvgNode(e.id,i.objects[o-2]),this.commandHandler.moveSvgNode(i.objects[o-2],e.id);else if(t){var a=this.commandHandler.getLayer(this.layerZIndexTable[t.zIndex]).objects[0];a?(this.commandHandler.moveSvgNode(e.id,a),this.commandHandler.updateNativeNodeIndex(e.id,a)):this.moveObjectsUp(e,i)}else this.moveObjectsUp(e,i)},o.prototype.moveObjectsUp=function(e,t){for(var i,r=this.layers.length-1;r>=0;r--)if(i=this.layers[r],t.id!==i.id){var o=this.commandHandler.getLayer(this.layerZIndexTable[i.zIndex]).objects[i.objects.length-1];if(o){this.commandHandler.moveSvgNode(e.id,o),this.commandHandler.moveSvgNode(o,e.id);break}}},o.prototype.insertData=function(e){return this.crudOperation(e,"create",this.getNewUpdateNodes("New"))},o.prototype.updateData=function(e){return this.crudOperation(e,"update",this.getNewUpdateNodes("Update"))},o.prototype.removeData=function(e){return this.crudOperation(e,"destroy",this.getDeletedNodes())},o.prototype.crudOperation=function(e,t,i){if(e){var r=this.parameterMap(e,!(e instanceof wr));if(r){var o=e instanceof wr?this.dataSourceSettings.connectionDataSource.crudAction[t]:this.dataSourceSettings.crudAction[t];this.raiseAjaxPost(JSON.stringify(r),o)}return r}var n=i;return this.processCrudCollection(n,this.dataSourceSettings.crudAction[t],this.dataSourceSettings.connectionDataSource.crudAction[t]),n},o.prototype.processCrudCollection=function(e,t,i){if(e.nodes){var r=[],o=void 0;for(o=0;o<e.nodes.length;o++)r.push(this.parameterMap(e.nodes[o],!0));r&&r.length>0&&this.raiseAjaxPost(JSON.stringify(r),t)}if(e.connectors){r=[],o=void 0;for(o=0;o<e.connectors.length;o++)r.push(this.parameterMap(e.connectors[o],!1));r&&r.length>0&&this.raiseAjaxPost(JSON.stringify(r),i)}},o.prototype.parameterMap=function(e,t){var i,r={},o=t?this.dataSourceSettings:this.dataSourceSettings.connectionDataSource;if(o.id&&(r[o.id]=e.id),o.sourcePointX&&o.sourcePointY&&(r[o.sourcePointX]=e.sourcePoint.x,r[o.sourcePointY]=e.sourcePoint.y),o.targetPointX&&o.targetPointY&&(r[o.targetPointX]=e.targetPoint.x,r[o.targetPointY]=e.targetPoint.y),o.sourceID&&(r[o.sourceID]=e.sourceID),o.targetID&&(r[o.targetID]=e.targetID),o.crudAction&&o.crudAction.customFields&&o.crudAction.customFields.length>0)for(i=0;i<o.crudAction.customFields.length;i++)r[o.crudAction.customFields[i]]=e[o.crudAction.customFields[i]];return r},o.prototype.getNewUpdateNodes=function(e){var t=[],i=[];for(var r in this.nameTable){var o=this.nameTable[r];o.status===e&&(o&&o instanceof wr?(o.status="None",i.push(o)):(o.status="None",t.push(o)))}return{nodes:t,connectors:i}},o.prototype.getDeletedNodes=function(){var e,t=[],i=[];for(e=0;e<this.crudDeleteNodes.length;e++){var r=this.crudDeleteNodes[e];r&&r.segments?i.push(r):r&&t.push(r)}return this.crudDeleteNodes=[],{nodes:t,connectors:i}},o.prototype.raiseAjaxPost=function(e,t){var i=new sf.base.Ajax(t,"POST",!0,"application/json"),r=JSON.stringify(JSON.parse(e));i.send(r).then(),i.onSuccess=function(e){}},o.prototype.getHiddenItems=function(e){if(this.contextMenuModule){this.contextMenuModule.hiddenItems=[];for(var t=0,i=e.items;t<i.length;t++){var r=i[t];if(this.contextMenuModule.ensureItems(r,e.event),r.items&&r.items.length)for(var o=0,n=r.items;o<n.length;o++){var a=n[o];this.contextMenuModule.ensureItems(a,e.event)}}return this.contextMenuModule.hiddenItems}return[]},Ol([sf.base.Property("100%")],o.prototype,"width",void 0),Ol([sf.base.Property("SVG")],o.prototype,"mode",void 0),Ol([sf.base.Property("100%")],o.prototype,"height",void 0),Ol([sf.base.Complex({},vo)],o.prototype,"contextMenuSettings",void 0),Ol([sf.base.Property(e.DiagramConstraints.Default)],o.prototype,"constraints",void 0),Ol([sf.base.Property(e.DiagramTools.Default)],o.prototype,"tool",void 0),Ol([sf.base.Property("Top")],o.prototype,"bridgeDirection",void 0),Ol([sf.base.Property("transparent")],o.prototype,"backgroundColor",void 0),Ol([sf.base.Complex({},ad)],o.prototype,"snapSettings",void 0),Ol([sf.base.Complex({},ld)],o.prototype,"rulerSettings",void 0),Ol([sf.base.Complex({},ed)],o.prototype,"pageSettings",void 0),Ol([sf.base.Complex({},wl)],o.prototype,"serializationSettings",void 0),Ol([sf.base.Collection([],js)],o.prototype,"nodes",void 0),Ol([sf.base.Property()],o.prototype,"drawingObject",void 0),Ol([sf.base.Collection([],wr)],o.prototype,"connectors",void 0),Ol([sf.base.Property([])],o.prototype,"basicElements",void 0),Ol([sf.base.Complex({},Ti)],o.prototype,"tooltip",void 0),Ol([sf.base.Complex({},vd)],o.prototype,"dataSourceSettings",void 0),Ol([sf.base.Property()],o.prototype,"addInfo",void 0),Ol([sf.base.Property()],o.prototype,"historyManager",void 0),Ol([sf.base.Property()],o.prototype,"nodeTemplate",void 0),Ol([sf.base.Property()],o.prototype,"annotationTemplate",void 0),Ol([sf.base.Property()],o.prototype,"userHandleTemplate",void 0),Ol([sf.base.Property()],o.prototype,"getNodeDefaults",void 0),Ol([sf.base.Property()],o.prototype,"nodeDefaults",void 0),Ol([sf.base.Property()],o.prototype,"getConnectorDefaults",void 0),Ol([sf.base.Property()],o.prototype,"connectorDefaults",void 0),Ol([sf.base.Property()],o.prototype,"setNodeTemplate",void 0),Ol([sf.base.Property()],o.prototype,"getDescription",void 0),Ol([sf.base.Property()],o.prototype,"getCustomProperty",void 0),Ol([sf.base.Property()],o.prototype,"getCustomTool",void 0),Ol([sf.base.Property()],o.prototype,"getCustomCursor",void 0),Ol([sf.base.Collection([],Sl)],o.prototype,"customCursor",void 0),Ol([sf.base.Property()],o.prototype,"updateSelection",void 0),Ol([sf.base.Complex({},Al)],o.prototype,"diagramSettings",void 0),Ol([sf.base.Complex({},Ys)],o.prototype,"selectedItems",void 0),Ol([sf.base.Complex({},td)],o.prototype,"scrollSettings",void 0),Ol([sf.base.Complex({},xd)],o.prototype,"layout",void 0),Ol([sf.base.Complex({},yo)],o.prototype,"commandManager",void 0),Ol([sf.base.Event()],o.prototype,"dataLoaded",void 0),Ol([sf.base.Event()],o.prototype,"dragEnter",void 0),Ol([sf.base.Event()],o.prototype,"dragLeave",void 0),Ol([sf.base.Event()],o.prototype,"dragOver",void 0),Ol([sf.base.Event()],o.prototype,"click",void 0),Ol([sf.base.Event()],o.prototype,"historyChange",void 0),Ol([sf.base.Event()],o.prototype,"historyStateChange",void 0),Ol([sf.base.Event()],o.prototype,"doubleClick",void 0),Ol([sf.base.Event()],o.prototype,"textEdit",void 0),Ol([sf.base.Event()],o.prototype,"scrollChange",void 0),Ol([sf.base.Event()],o.prototype,"selectionChange",void 0),Ol([sf.base.Event()],o.prototype,"sizeChange",void 0),Ol([sf.base.Event()],o.prototype,"connectionChange",void 0),Ol([sf.base.Event()],o.prototype,"sourcePointChange",void 0),Ol([sf.base.Event()],o.prototype,"targetPointChange",void 0),Ol([sf.base.Event()],o.prototype,"propertyChange",void 0),Ol([sf.base.Event()],o.prototype,"positionChange",void 0),Ol([sf.base.Event()],o.prototype,"keyUp",void 0),Ol([sf.base.Event()],o.prototype,"keyDown",void 0),Ol([sf.base.Event()],o.prototype,"animationComplete",void 0),Ol([sf.base.Event()],o.prototype,"rotateChange",void 0),Ol([sf.base.Event()],o.prototype,"collectionChange",void 0),Ol([sf.base.Event()],o.prototype,"fixedUserHandleClick",void 0),Ol([sf.base.Event()],o.prototype,"onUserHandleMouseDown",void 0),Ol([sf.base.Event()],o.prototype,"onUserHandleMouseUp",void 0),Ol([sf.base.Event()],o.prototype,"onUserHandleMouseEnter",void 0),Ol([sf.base.Event()],o.prototype,"onUserHandleMouseLeave",void 0),Ol([sf.base.Event()],o.prototype,"segmentCollectionChange",void 0),Ol([sf.base.Event()],o.prototype,"onImageLoad",void 0),Ol([sf.base.Event()],o.prototype,"expandStateChange",void 0),Ol([sf.base.Event()],o.prototype,"created",void 0),Ol([sf.base.Event()],o.prototype,"mouseEnter",void 0),Ol([sf.base.Event()],o.prototype,"mouseLeave",void 0),Ol([sf.base.Event()],o.prototype,"mouseOver",void 0),Ol([sf.base.Event()],o.prototype,"contextMenuOpen",void 0),Ol([sf.base.Event()],o.prototype,"contextMenuBeforeItemRender",void 0),Ol([sf.base.Event()],o.prototype,"contextMenuClick",void 0),Ol([sf.base.Event()],o.prototype,"commandExecute",void 0),Ol([sf.base.Collection([],cl)],o.prototype,"layers",void 0),Ol([sf.base.Event()],o.prototype,"drop",void 0),o}(sf.base.Component),Bl=function(){function t(e){this.diagram=e}return t.prototype.exportDiagram=function(e){var t,i,r,o="data",n=[],a=e.margin||{},s=e&&e.region?e.region:"Content",h=e&&e.mode?e.mode:"Download",d=this.getDiagramBounds(s,e);e.bounds&&(i=!0,d.x=e.bounds.x?e.bounds.x:d.x,d.y=e.bounds.y?e.bounds.y:d.y,d.width=e.bounds.width||d.width,d.height=e.bounds.height||d.height),a={top:void 0!==a.top?a.top:25,bottom:void 0!==a.bottom?a.bottom:25,right:void 0!==a.right?a.right:25,left:void 0!==a.left?a.left:25};this.diagram.nodes;"PageSettings"!==s&&(d.x-=a.left,d.y-=a.top,d.width+=a.left+a.right,d.height+=a.top+a.bottom);var l=e.fileName||"diagram";if("SVG"!==e.format){if(null!==(o=this.setCanvas(e,d,a,h,i,s,l)))return o}else{t=e.format,e.bounds=d,e.margin=a;var c=r=this.diagramAsSvg(e,a);if("Data"===h)return sf.base.isBlazor()&&"SVG"===e.format?(new XMLSerializer).serializeToString(c):r;var p=(new XMLSerializer).serializeToString(c);n.push(p)}if("Download"===h&&null!==o)for(var g=0;g<n.length;g++){var u=new Blob([n[g]],{type:"application/octet-stream"});if("msie"===sf.base.Browser.info.name)window.navigator.msSaveOrOpenBlob(u,l+"."+t);else{var f=hh("a",{download:l+"."+t}),m=URL.createObjectURL(u);f.href=m;var y=document.createEvent("MouseEvents");y.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(y)}}return null},t.prototype.setCanvas=function(e,t,i,r,o,n,a){var s;e.bounds=t,e.region=n;this.setScaleValueforCanvas(e,t);var h,d=this.diagramAsCanvas({bounds:t,margin:i,region:n,scaleX:e.scaleX,scaleY:e.scaleY,scaleOffsetX:e.scaleOffsetX,scaleOffsetY:e.scaleOffsetY},o);return h=s="JPG"===e.format?d.toDataURL("image/jpeg"):d.toDataURL(),"Data"===r?s:(this.canvasMultiplePage(e,d,i,h,a),null)},t.prototype.canvasMultiplePage=function(e,t,i,r,o){var n=this,a=[],s=e.format||"JPG";if(e.multiplePage){if(e.pageHeight=e.pageHeight?e.pageHeight:this.diagram.pageSettings.height,e.pageWidth=e.pageWidth?e.pageWidth:this.diagram.pageSettings.width,e.pageHeight=e.pageHeight?e.pageHeight:t.width,e.pageWidth=e.pageWidth?e.pageWidth:t.height,i=e.margin||{},e.pageOrientation&&("Landscape"===e.pageOrientation&&e.pageHeight>e.pageWidth||"Portrait"===e.pageOrientation&&e.pageWidth>e.pageHeight)){var h=e.pageWidth;e.pageWidth=e.pageHeight,e.pageHeight=h}e.margin={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right};var d=hh("img",{id:this.diagram.element.id+"_printImage",src:r});d.onload=function(){a=n.getMultipleImage(d,e,!0),n.exportImage(a,o,s,r)}}else a=[r],this.exportImage(a,o,s,r)},t.prototype.exportImage=function(e,t,i,r){for(var o=[],n=e instanceof HTMLElement?0:e.length,a=0;a<n;a++){for(var s=e[a].replace(/^data:[a-z]*;,/,"").split(","),h=atob(s[1]),d=new ArrayBuffer(h.length),l=new Uint8Array(d),c=0;c<h.length;c++)l[c]=h.charCodeAt(c);o.push(d)}for(var p=function(e){var r=new Blob([o[e]],{type:"application/octet-stream"});if("msie"===sf.base.Browser.info.name)window.navigator.msSaveOrOpenBlob(r,t+"."+i);else{var n=hh("a",{download:t+"."+i}),a=URL.createObjectURL(r);n.href=a;var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),setTimeout((function(){n.dispatchEvent(s)}),5*(e+1))}},g=0;g<o.length;g++)p(g)},t.prototype.getObjectsBound=function(e){for(var t,i=0,r=this.diagram.nodes;i<r.length;i++){var o=r[i];o.visible&&(("SVG"===e.format||o instanceof je||o instanceof Yi)&&("SVG"!==e.format||o instanceof Yi)||(t=t?t.uniteRect(o.wrapper.outerBounds):o.wrapper.outerBounds))}for(var n=0,a=this.diagram.connectors;n<a.length;n++){var s=a[n];s.visible&&(t=t?t.uniteRect(s.wrapper.outerBounds):s.wrapper.outerBounds)}return t||new b(0,0,0,0)},t.prototype.getDiagramBounds=function(e,t){var i=this.getObjectsBound(t),r=i.left,o=i.top,n=i.right-i.left,a=i.bottom-i.top;"Content"!==e&&(this.diagram.pageSettings&&this.diagram.pageSettings.multiplePage?(r=i.left,o=i.top,this.diagram.pageSettings.width&&(r=Math.floor(r/this.diagram.pageSettings.width)*this.diagram.pageSettings.width,n=Math.ceil(i.right/this.diagram.pageSettings.width)*this.diagram.pageSettings.width-r),this.diagram.pageSettings.height&&(o=Math.floor(o/this.diagram.pageSettings.height)*this.diagram.pageSettings.height,a=Math.ceil(i.bottom/this.diagram.pageSettings.height)*this.diagram.pageSettings.height-o),0===i.width&&null!==this.diagram.pageSettings.width&&(n=this.diagram.pageSettings.width),0===i.height&&null!==this.diagram.pageSettings.height&&(a=this.diagram.pageSettings.height)):(this.diagram.pageSettings.width&&(r=0,n=this.diagram.pageSettings.width),this.diagram.pageSettings.height&&(o=0,a=this.diagram.pageSettings.height)));var s=new b;return s.x=r,s.y=o,s.width=n,s.height=a,s},t.prototype.setScaleValueforCanvas=function(e,t){var i="scaleX";e[i]=1,e.scaleY=1,e.scaleOffsetX=0,e.scaleOffsetY=0,e.pageHeight=e.pageHeight||this.diagram.pageSettings.height,e.pageWidth=e.pageWidth||this.diagram.pageSettings.width;var r=e.pageOrientation||this.diagram.pageSettings.orientation;if(r||(r="Portrait"),"Portrait"===r){if(e.pageWidth>e.pageHeight){var o=e.pageHeight;e.pageHeight=e.pageWidth,e.pageWidth=o}}else if(e.pageHeight>e.pageWidth){o=e.pageWidth;e.pageWidth=e.pageHeight,e.pageHeight=o}e.pageWidth&&e.pageHeight&&!e.multiplePage&&(e.stretch="Meet");var n=e.pageHeight||t.height,a=e.pageWidth||t.width;"Stretch"!==e.stretch&&"Meet"!==e.stretch&&"Slice"!==e.stretch||(e[i]=a/t.width,e.scaleY=n/t.height,"Meet"===e.stretch?(e[i]=e.scaleY=Math.min(e[i],e.scaleY),e.scaleOffsetY=(e.pageHeight-t.height*e[i])/2,e.scaleOffsetX=(e.pageWidth-t.width*e[i])/2):"Slice"===e.stretch&&(e[i]=e.scaleY=Math.max(e[i],e.scaleY)),t.width=a,t.height=n),t.x*=e[i],t.y*=e.scaleY},t.prototype.diagramAsSvg=function(e,t){var i=this.diagram.createSvg(this.diagram.element.id+"_diagram_svg",e.bounds.width,e.bounds.height);document.body.appendChild(i);var r=dh("g",{id:this.diagram.element.id+"_pageBackground"}),o=e&&e.region?e.region:"Content",n=this.getDiagramBounds(o,e),a=n.x,s=n.y,h=n.width,d=n.height;i.appendChild(r);var l={x:String(a),y:String(s),width:String(h),height:String(d)};fh(r,l),this.setTransform(r,e.bounds,t);var c=document.getElementById(this.diagram.element.id+"gradient_pattern");c&&i.appendChild(c),l={x:String(a),y:String(s),width:String(h+t.left+t.right),height:String(d+t.top+t.bottom)};var p=document.getElementById(this.diagram.element.id+"_backgroundImageLayer").cloneNode(!0);fh(p,l),i.appendChild(p),this.setTransform(p,n,t);var g=document.getElementById(this.diagram.element.id+"_backgroundLayerrect").cloneNode(!0);if(fh(g,l),i.appendChild(g),this.setTransform(g,n,t),"SVG"===this.diagram.mode){var u=void 0,f=void 0,m=qs(this.diagram.element.id);for(i.appendChild(m.getElementById(this.diagram.diagramLayer.id).cloneNode(!0)),f=0;f<i.childNodes.length;f++)(u=i.childNodes[f]).id===this.diagram.element.id+"_diagramLayer"&&this.setTransform(u,n,t)}else{r=dh("g",{id:this.diagram.element.id+"_diagramLayer"}),i.appendChild(r),this.setTransform(r,e.bounds,t);var y=new qh("",null,!0),v=sh(this.diagram.element.id);this.diagram.renderDiagramElements(i,y,v,!1)}return document.body.removeChild(i),i},t.prototype.setTransform=function(e,t,i){e.setAttribute("transform","translate("+(-t.x+i.left)+", "+(-t.y+i.top)+")")},t.prototype.diagramAsCanvas=function(e,t){var i=e.bounds,r=e.margin,o=e&&e.region?e.region:"Content",n=this.getDiagramBounds(o,e),a=this.diagram.pageSettings.background.color,s=Fh.createCanvas(this.diagram.element.id+"_diagram",e.bounds.width,e.bounds.height),h=s.getContext("2d");h.translate(-i.x,-i.y),h.save(),h.fillStyle="transparent"===this.diagram.pageSettings.background.color?"white":this.diagram.pageSettings.background.color,i="Content"===o?n:i,h.fillRect(i.x,i.y,i.width,i.height);var d=this.diagram.pageSettings.background;if(d&&d.source){n=this.getDiagramBounds(o,e);var l=new Image;l.src=d.source;var c=n.width/l.width,p=n.height/l.height,g=n.x,u=n.y,f=n.width,m=n.height,y=this.isImageExportable(d);if("None"!==d.scale&&"None"!==d.align){var v="Meet"===d.scale?Math.min(c,p):Math.max(c,p);f=v*l.width,m=v*l.height,d.align.indexOf("xmid")>-1?g+=(n.width-f)/2:d.align.indexOf("xmax")>-1&&(g=g+n.width-f),d.align.indexOf("ymid")>-1?u+=(n.height-m)/2:d.align.indexOf("ymax")>-1&&(u=u+n.height-m),"none"!==this.diagram.pageSettings.background.color&&"transparent"!==this.diagram.pageSettings.background.color||(h.fillStyle="white",h.fillRect(n.x*e.scaleX,n.y*e.scaleY,n.width*e.scaleX,n.height*e.scaleY)),y&&h.drawImage(l,g,u,v*l.width,v*l.height)}else y&&h.drawImage(l,g,u,n.width,n.height)}else h.fillStyle="transparent"===a?"white":a,h.fillRect(n.x*e.scaleX-r.left,n.y*e.scaleY-r.top,n.width*e.scaleX+r.left+r.right,e.scaleY*n.height+r.top+r.bottom);var b=this.diagram.pageSettings.background.color,w=this.diagram.pageSettings.width;w&&(h.strokeStyle="none"===b?"transparent":b,h.lineWidth=w,h.strokeRect(n.x*e.scaleX,n.y*e.scaleY,n.width*e.scaleX,n.height*e.scaleY)),h.restore();var x=sh(this.diagram.element.id),C=new qh("",null,!1);return this.updateObjectValue(e.scaleX,e.scaleOffsetX,e.scaleOffsetY,!0),this.diagram.renderDiagramElements(s,C,x,!1,!0),this.updateObjectValue(e.scaleX,e.scaleOffsetX,e.scaleOffsetY,!1),s},t.prototype.updateWrapper=function(e,t,i,r,o){if(e&&e.length>0)for(var n=0;n<e.length;n++)e[n].children&&this.updateWrapper(e[n].children,t,i,r,o),e[n].exportScaleValue.x=t,e[n].exportScaleValue.y=t,e[n].exportScaleOffset.x=i,e[n].exportScaleOffset.y=r,e[n].isExport=o},t.prototype.updateObjectValue=function(e,t,i,r){for(var o,n=0;n<this.diagram.nodes.length;n++)o=this.diagram.nodes[n].wrapper,this.updateWrapper(o.children,e,t,i,r),o.exportScaleValue.x=e,o.exportScaleValue.y=e,o.exportScaleOffset.x=t,o.exportScaleOffset.y=i,o.isExport=r;for(var a=0;a<this.diagram.connectors.length;a++){o=this.diagram.connectors[a].wrapper;for(var s=0;s<o.children.length;s++)o.children[s].isExport=r,r&&(o.children[s].exportScaleValue.x=e,o.children[s].exportScaleValue.y=e,o.children[s].exportScaleOffset.x=t,o.children[s].exportScaleOffset.y=i)}},t.prototype.isImageExportable=function(e){var t,i=!0;if(e.source)try{var r=(t=Fh.createCanvas(this.diagram.element.id+"temp_canvas",100,100)).getContext("2d");r.save();var o=new Image;o.src=e.source,r.drawImage(o,0,0,100,100),r.restore(),t.toDataURL()}catch(e){i=!1}return i},t.prototype.getPrintCanvasStyle=function(e,t){var r=0,o=0,n=new i;if(r=e.width,o=e.height,(t.pageHeight||t.pageWidth)&&(o=t.pageHeight?t.pageHeight:o,r=t.pageWidth?t.pageWidth:r),t.pageOrientation&&("Landscape"===t.pageOrientation&&o>r||"Portrait"===t.pageOrientation&&r>o)){var a=r;r=o,o=a}return n.height=o,n.width=r,n},t.prototype.getMultipleImage=function(e,t,i){var r=[],o=hh("div",{}),n=this.getPrintCanvasStyle(e,t),a=t.margin,s=a.left,h=a.top,d=a.right,l=a.bottom,c=0,p=n.width+c,g=n.height+0,u=0,f=0;if(t&&t.multiplePage){o.style.height="auto",o.style.width="auto";var m=e.height,y=e.width,v=0,b=0,w=void 0,x=0,C=0,S=void 0,P=void 0;do{do{x=n.width,C=n.height,u+n.width>=y&&(x=y-u),f+n.height>=m&&(C=m-f),(S=(P=Fh.createCanvas(this.diagram.element.id+"_multiplePrint",n.width,n.height)).getContext("2d")).drawImage(e,c+u+s,0+f+h,x-d-s,C-l-h,0+s,0+h,x-d-s,C-l-h),u+n.width>=y&&(u-=u-y),w=P.toDataURL(),S.restore(),u+=p,i?r.push(w):this.printImage(o,w,v+""+b,p+"px;",g+"px;"),v++}while(u<y);b++,v=c=u=0,f+n.height>=m&&(f-=f-m),f+=g}while(f<m)}else{var T=this.getPrintCanvasStyle(e,t),A=T.width,z=T.height;(S=(P=Fh.createCanvas(this.diagram.element.id+"_diagram",A,z)).getContext("2d")).drawImage(e,0+s,0+h,e.width-(d+s),e.height-(h+l),0+s,0+h,A-(d+s),z-(h+l));w=P.toDataURL();S.restore(),i?r.push(w):this.printImage(o,w,0)}return i?r:o},t.prototype.printImage=function(e,t,i,r,o){var n={class:"e-diagram-print-page",style:"width:"+r+"height:"+o},a=hh("img",n),s=hh("div",n);yh(a,n={id:this.diagram.element.id+"_multiplePrint_img"+i,style:"float:left",src:t}),s.appendChild(a),e.appendChild(s)},t.prototype.print=function(e){e.mode="Data";var t=this.exportDiagram(e);this.printImages(t,e)},t.prototype.printImages=function(e,t){var i=this,r={id:this.diagram.element.id+"_printImage",src:e};t.margin={top:0,bottom:0,right:0,left:0};var o=hh("img",r);o.onload=function(){var e=i.getMultipleImage(o,t),r=window.open("");null!=r&&e instanceof HTMLElement&&(r.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page{page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}</style><title></title></head>"),r.document.write('<BODY onload="setTimeout(function(){window.print();}, 100)">'),r.document.write("<center>"+e.innerHTML+"</center>"),r.document.close())}},t.prototype.getDiagramContent=function(t){var i=document.getElementById(this.diagram.element.id+"content"),r=i.scrollLeft,o=i.scrollTop,n=this.diagram.scrollSettings.currentZoom,a=this.diagram.scroller.horizontalOffset,s=this.diagram.scroller.verticalOffset,h=Number(String(this.diagram.width).split("%")[0])?i.clientWidth:Number(String(this.diagram.width).split("px")[0]),d=Number(String(this.diagram.height).split("%")[0])?i.clientHeight:Number(String(this.diagram.height).split("px")[0]),l=this.getDiagramBounds("",{});this.diagram.scroller.zoom(1/n);var c,p;c=l.x,p=l.y,this.diagram.scroller.transform={tx:-c,ty:-p,scale:this.diagram.scroller.currentZoom},this.diagram.scroller.horizontalOffset=-c,this.diagram.scroller.verticalOffset=-p,this.diagram.scroller.setSize(),this.diagram.setSize(l.width,l.height);var g=this.diagram.snapSettings.constraints;this.diagram.snapSettings.constraints=this.diagram.snapSettings.constraints&~e.SnapConstraints.ShowLines,this.diagram.dataBind(),this.diagram.clearSelection(),t=t||document.styleSheets;for(var u="",f=0;f<t.length;f++)(t[f].href||"string"==typeof t[f])&&(u+="<link href='"+(t[f].href||t[f])+"' rel='stylesheet' />");var m=document.getElementById(this.diagram.element.id+"content").innerHTML;return m=(m=u+"<body style=\"margin: 0px; padding: 0px\"><div style='margin-left:0px;margin-top:0px;margin-right:0px;margin-bottom:0px;'>"+m+"</div></body>").replace(/ transform: t/g," -webkit-transform: t"),this.diagram.setSize(h,d),this.diagram.scroller.zoom(n/this.diagram.scrollSettings.currentZoom),this.diagram.snapSettings.constraints=g,this.diagram.dataBind(),r||o?this.diagram.setOffset(r,o):(this.diagram.scroller.transform={tx:a/this.diagram.scroller.currentZoom,ty:s/this.diagram.scroller.currentZoom,scale:this.diagram.scroller.currentZoom},this.diagram.scroller.horizontalOffset=a,this.diagram.scroller.verticalOffset=s),this.diagram.renderSelector(!1),Va()?m.replace("url("+location.protocol+"//"+location.host+location.pathname+"#diagram_pattern ","url(#diagram_pattern)"):m},t.prototype.exportImages=function(e,t){var i=this,r=t&&t.region?t.region:"Content",o=t.margin||{};o={top:isNaN(o.top)?0:o.top,bottom:isNaN(o.bottom)?0:o.bottom,left:isNaN(o.left)?0:o.left,right:isNaN(o.right)?0:o.right};var n=this.getDiagramBounds(r,{});t.bounds&&(n.x=isNaN(t.bounds.x)?n.x:t.bounds.x,n.y=isNaN(t.bounds.y)?n.y:t.bounds.y,n.width=t.bounds.width||n.width,n.height=t.bounds.height||n.height);var a=document.createElement("img");yh(a,{src:e});var s=this;a.onload=function(){var r=Fh.createCanvas(s.diagram.element.id+"innerImage",n.width+(o.left+o.right),n.height+(o.top+o.bottom)),h=r.getContext("2d");if(h.fillStyle=s.diagram.pageSettings.background.color,h.fillRect(0,0,n.width+(o.left+o.right),n.height+(o.top+o.bottom)),h.drawImage(a,0,0,n.width,n.height,o.left,o.top,n.width,n.height),e=r.toDataURL(),t.printOptions)s.printImages(e,t);else{h.restore();var d=t.fileName||"diagram";i.canvasMultiplePage(t,r,o,e,d)}}},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"PrintandExport"},t}(),Ll=function(){function e(){this.dataTable={}}return e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"DataBinding"},e.prototype.initData=function(e,t){var i,r=e.dataManager||e.dataSource||{};(i=r.data||r.json||(r.dataSource?r.dataSource.json:void 0))&&0===i.length&&r.dataSource.data&&(i=r.dataSource.data),i&&i.length&&(this.applyDataSource(e,i,t),t.trigger("dataLoaded",{diagram:sf.base.isBlazor()?null:_a(t)}))},e.prototype.initSource=function(e,t){var i,r=this,o=e,n=e;if(o.dataManager instanceof sf.data.DataManager||o.dataSource instanceof sf.data.DataManager){var a=(n.dataManager||n.dataSource).defaultQuery||new sf.data.Query;(e.dataManager||e.dataSource).executeQuery(a).then((function(o){i=o.result,t.isDestroyed||(t.protectPropertyChange(!0),r.applyDataSource(e,i,t),t.refreshDiagram(),t.protectPropertyChange(!1),t.trigger("dataLoaded",{diagram:sf.base.isBlazor()?null:_a(t)}))}))}},e.prototype.applyDataSource=function(e,t,i){var o,n,a;this.dataTable={};var s,h,d=[],l=[];if(void 0!==t){for(var c=0;c<t.length;c++)void 0===(o=t[c])[e.parentId]||null===o[e.parentId]||"object"!==r(o[e.parentId])?void 0!==d[o[e.parentId]]?d[o[e.parentId]].items.push(o):d[o[e.parentId]]={items:[o]}:d=this.updateMultipleRootNodes(o,d,e,t),e.root===o[e.id]&&(n={items:[o]});if(n)l.push(n);else for(var p=0,g=Object.keys(d);p<g.length;p++){var u=g[p];u&&"undefined"!==u&&"''"!==u&&"null"!==u||l.push(d[u])}for(var f=0;f<l.length;f++)for(var m=0;m<l[f].items.length;m++)s=l[f].items[m],a=this.applyNodeTemplate(e,s,i),i.nodes.push(a),this.dataTable[s[e.id]]=a,void 0!==(h=d[a.data[e.id]])&&this.renderChildNodes(e,h,a.id,d,i)}this.dataTable=null},e.prototype.updateMultipleRootNodes=function(e,t,i,r){for(var o,n=e[i.parentId],a=0;a<n.length;a++)t[o=n[a]]?t[o].items.push(e):t[o]={items:[e]};return t},e.prototype.applyNodeTemplate=function(e,t,i){var r={id:xh(),data:t},o=Wh(e.doBinding);o&&o(r,t,i);var n=new js(i,"nodes",r,!0);if(Ln(n,r,i.nodeDefaults),e.dataMapSettings)for(var a=void 0,s=[],h=[],d=0;d<e.dataMapSettings.length;d++){if(-1!==e.dataMapSettings[d].property.indexOf(".")){h=this.splitString(e.dataMapSettings[d].property);for(var l=0;l<h.length;l++)-1!==h[l].indexOf("[")&&(a=h[l].indexOf("["),s=h[l].split("["));if(a)if(h[2])n[s[0]][h[0].charAt(a+1)][h[1]][h[2]]=t[e.dataMapSettings[d].field];else{var c=t[e.dataMapSettings[d].field];n[s[0]][h[0].charAt(a+1)][h[1]]=c}else h[2]?n[h[0]][h[1]][h[2]]=t[e.dataMapSettings[d].field]:n[h[0]][h[1]]=t[e.dataMapSettings[d].field]}else{var p=e.dataMapSettings[d].property;n[p=p.charAt(0).toLowerCase()+p.slice(1)]=t[e.dataMapSettings[d].field]}a=0,s=[],h=[]}return this.collectionContains(n,i,e.id,e.parentId)?this.dataTable[t[e.id]]:n},e.prototype.splitString=function(e){var t=[];t=e.split(".");for(var i=0;i<t.length;i++)t[i]=t[i].charAt(0).toLowerCase()+t[i].slice(1);return t},e.prototype.renderChildNodes=function(e,t,i,r,o){for(var n,a,s,h=0;h<t.items.length;h++){n=t.items[h],s=this.applyNodeTemplate(e,n,o);var d=!1;this.collectionContains(s,o,e.id,e.parentId)?d=!0:(this.dataTable[n[e.id]]=s,o.nodes.push(s)),this.containsConnector(o,i,s.id)||o.connectors.push(this.applyConnectorTemplate(i,s.id,o)),d||void 0!==(a=r[s.data[e.id]])&&this.renderChildNodes(e,a,s.id,r,o)}},e.prototype.containsConnector=function(e,t,i){if(""!==t&&""!==i)for(var r=0;r<e.connectors.length;r++){var o=e.connectors[r];if(void 0!==o&&o.sourceID===t&&o.targetID===i)return!0}return!1},e.prototype.collectionContains=function(e,t,i,r){var o=this.dataTable[e.data[i]];return void 0!==o&&o.data[i]===e.data[i]&&o.data[r]===e.data[r]},e.prototype.applyConnectorTemplate=function(e,t,i){var r={id:xh(),sourceID:e,targetID:t},o=new wr(i,"connectors",r,!0);return Ln(o,r,i.connectorDefaults),o},e}(),Ml=function(e,t,i,r){return new(i||(i=Promise))((function(o,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function s(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){e.done?o(e.value):new i((function(t){t(e.value)})).then(a,s)}h((r=r.apply(e,t||[])).next())}))},kl=function(e,t){var i,r,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,r=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},Rl={content:".e-diagramcontent",copy:"e-copy",paste:"e-paste",undo:"e-undo",redo:"e-redo",cut:"e-cut",selectAll:"e-selectall",grouping:"e-grouping",group:"e-group",unGroup:"e-ungroup",bringToFront:"e-bringfront",sendToBack:"e-sendback",moveForward:"e-bringforward",sendBackward:"e-sendbackward",order:"e-order"},Nl=function(){function e(e,t){this.defaultItems={},this.disableItems=[],this.hiddenItems=[],this.localeText=this.setLocaleKey(),this.parent=e,this.serviceLocator=t,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on("initial-load",this.render,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("initial-load",this.render)},e.prototype.render=function(){if(this.l10n=this.serviceLocator.getService("localization"),!sf.base.isBlazor()){this.element=hh("ul",{id:this.parent.element.id+"_contextMenu"}),this.parent.element.appendChild(this.element);var e="#"+this.parent.element.id;this.contextMenu=new sf.navigations.ContextMenu({items:this.getMenuItems(),enableRtl:this.parent.enableRtl,enablePersistence:this.parent.enablePersistence,locale:this.parent.locale,target:e,select:this.contextMenuItemClick.bind(this),beforeOpen:this.contextMenuBeforeOpen.bind(this),onOpen:this.contextMenuOpen.bind(this),beforeItemRender:this.BeforeItemRender.bind(this),onClose:this.contextMenuOnClose.bind(this),cssClass:"e-diagram-menu",animationSettings:{effect:"None"}}),this.contextMenu.appendTo(this.element)}},e.prototype.getMenuItems=function(){var e=[],t=[],i=[];if(!this.parent.contextMenuSettings.showCustomMenuOnly){for(var r=0,o=this.getDefaultItems();r<o.length;r++){var n=o[r];-1!==n.toLocaleLowerCase().indexOf("group")?"grouping"!==n.toLocaleLowerCase()&&i.push(this.buildDefaultItems(n)):-1!==n.toLocaleLowerCase().indexOf("order")?"order"!==n.toLocaleLowerCase()&&t.push(this.buildDefaultItems(n)):e.push(this.buildDefaultItems(n))}var a;if(i.length>0)(a=this.buildDefaultItems("grouping")).items=i,e.push(a);if(t.length>0)(a=this.buildDefaultItems("order")).items=t,e.push(a)}if(this.parent.contextMenuSettings.items)for(var s=0,h=this.parent.contextMenuSettings.items;s<h.length;s++){var d=h[s];e.push(d)}return e},e.prototype.contextMenuOpen=function(){this.isOpen=!0},e.prototype.BeforeItemRender=function(e){this.parent.trigger("contextMenuBeforeItemRender",e)},e.prototype.contextMenuItemClick=function(e){document.getElementById(this.parent.element.id+"content").focus(),this.parent.trigger("contextMenuClick",e);var t=this.getKeyFromId(e.item.id);if(!e.cancel)switch(t){case"cut":this.parent.cut();break;case"copy":this.parent.copy();break;case"undo":this.parent.undo();break;case"redo":this.parent.redo();break;case"paste":this.parent.paste();break;case"selectAll":this.parent.selectAll();break;case"group":this.parent.group();break;case"unGroup":this.parent.unGroup();break;case"bringToFrontOrder":this.parent.bringToFront();break;case"moveForwardOrder":this.parent.moveForward();break;case"sendToBackOrder":this.parent.sendToBack();break;case"sendBackwardOrder":this.parent.sendBackward()}},e.prototype.contextMenuOnClose=function(e){e.items.length>0&&e.items[0].parentObj instanceof sf.navigations.ContextMenu&&this.updateItemStatus()},e.prototype.getLocaleText=function(e){return this.l10n.getConstant(this.localeText[e])},e.prototype.updateItemStatus=function(){this.contextMenu.showItems(this.hiddenItems,!0),this.contextMenu.enableItems(this.disableItems,!1,!0),this.hiddenItems=[],this.disableItems=[],this.isOpen=!1},e.prototype.ensureItems=function(e,t){var i=this.getKeyFromId(e.id);this.defaultItems[i];-1!==this.getDefaultItems().indexOf(i)&&e.target&&(t||this.parent.checkMenu)&&!this.ensureTarget(e)&&this.hiddenItems.push(e.id)},e.prototype.refreshItems=function(){this.updateItems(),this.contextMenu.refresh()},e.prototype.updateItems=function(){for(var e=!0,t=0;t<this.parent.contextMenuSettings.items.length;t++){for(var i=this.parent.contextMenuSettings.items[t],r=0;r<this.contextMenu.items.length;r++)this.contextMenu.items[r].text===this.parent.contextMenuSettings.items[t].text&&(e=!1);e&&this.contextMenu.insertAfter([i],this.contextMenu.items[this.contextMenu.items.length-1].text)}},e.prototype.contextMenuBeforeOpen=function(e){return Ml(this,void 0,void 0,(function(){var t,i,r,o,n,a,s,h,d,l;return kl(this,(function(c){switch(c.label){case 0:for(this.parent.checkMenu||-1===window.navigator.userAgent.indexOf("Linux")&&-1===window.navigator.userAgent.indexOf("X11")||(this.parent.checkMenu=e.cancel=!0),this.parent.checkMenu&&(this.hiddenItems=[]),(t=e).hiddenItems=[],i=0,r=e.items;i<r.length;i++)if(l=r[i],this.ensureItems(l,e.event),l.items.length)for(o=0,n=l.items;o<n.length;o++)a=n[o],this.ensureItems(a,e.event);return this.eventArgs=e.event,sf.base.isBlazor()?[4,this.parent.trigger("contextMenuOpen",t)]:[3,2];case 1:return"string"==typeof(t=c.sent()||t)&&(t=JSON.parse(t)),[3,3];case 2:this.parent.trigger("contextMenuOpen",t),c.label=3;case 3:for(s=!0,this.hiddenItems=this.hiddenItems.concat(t.hiddenItems),this.contextMenu.enableItems(this.disableItems,!1,!0),h=this,d=0;d<e.items.length;d++)l=e.items[d],h.hiddenItems.indexOf(l.id)>-1&&h.contextMenu.hideItems([l.id],!0);for(d=0;d<h.contextMenu.items.length;d++)l=h.contextMenu.items[d],-1===h.hiddenItems.indexOf(l.id)&&(s=!1,h.contextMenu.showItems([l.id],!0));return s&&(t.cancel=s,this.hiddenItems=[]),this.parent.selectedItems.nodes.length&&this.parent.selectedItems.nodes[0].isPhase&&(e.cancel=!0),[2]}}))}))},e.prototype.ensureTarget=function(e){var t=this.parent.selectedItems.nodes.length+this.parent.selectedItems.connectors.length,i=!1;switch(this.getKeyFromId(e.id)){case"undo":i=!(!this.parent.historyManager||!this.parent.historyManager.canUndo);break;case"redo":i=!(!this.parent.historyManager||!this.parent.historyManager.canRedo);break;case"paste":i=!!this.parent.commandHandler.clipboardData.clipObject;break;case"selectAll":i=!!(this.parent.nodes.length+this.parent.connectors.length);break;case"grouping":i=!!(t>1||this.parent.selectedItems.nodes[0]&&this.parent.selectedItems.nodes[0].children&&this.parent.selectedItems.nodes[0].children.length>1);break;case"group":i=t>1;break;case"unGroup":i=!!(this.parent.selectedItems.nodes[0]&&this.parent.selectedItems.nodes[0].children&&this.parent.selectedItems.nodes[0].children.length>1);break;case"cut":case"copy":case"order":case"bringToFrontOrder":case"moveForwardOrder":case"sendToBackOrder":case"sendBackwardOrder":i=!!t}return i},e.prototype.destroy=function(){sf.base.isBlazor()||(this.contextMenu.destroy(),sf.base.remove(this.element)),this.removeEventListener()},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.generateID=function(e){return this.parent.element.id+"_contextMenu_"+e},e.prototype.getKeyFromId=function(e){return e.replace(this.parent.element.id+"_contextMenu_","")},e.prototype.buildDefaultItems=function(e){var t;switch(e){case"copy":t={target:Rl.content,iconCss:Rl.copy};break;case"cut":t={target:Rl.content,iconCss:Rl.cut};break;case"paste":t={target:Rl.content,iconCss:Rl.paste};break;case"undo":t={target:Rl.content,iconCss:Rl.undo};break;case"redo":t={target:Rl.content,iconCss:Rl.redo};break;case"grouping":t={target:Rl.content};break;case"group":t={target:Rl.content,iconCss:Rl.group};break;case"unGroup":t={target:Rl.content,iconCss:Rl.unGroup};break;case"order":t={target:Rl.content,iconCss:Rl.order};break;case"bringToFrontOrder":t={target:Rl.content,iconCss:Rl.bringToFront};break;case"moveForwardOrder":t={target:Rl.content,iconCss:Rl.moveForward};break;case"sendToBackOrder":t={target:Rl.content,iconCss:Rl.sendToBack};break;case"sendBackwardOrder":t={target:Rl.content,iconCss:Rl.sendBackward};break;case"selectAll":t={target:Rl.content}}return this.defaultItems[e]={text:this.getLocaleText(e),id:this.generateID(e),target:t.target,iconCss:t.iconCss?"e-icons "+t.iconCss:""},this.defaultItems[e]},e.prototype.getDefaultItems=function(){return["copy","cut","paste","undo","redo","selectAll","grouping","group","unGroup","order","bringToFrontOrder","moveForwardOrder","sendToBackOrder","sendBackwardOrder"]},e.prototype.setLocaleKey=function(){return{copy:"Copy",cut:"Cut",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"SelectAll",grouping:"Grouping",group:"Group",unGroup:"UnGroup",order:"Order",bringToFrontOrder:"BringToFront",moveForwardOrder:"MoveForward",sendToBackOrder:"SendToBack",sendBackwardOrder:"SendBackward"}},e}(),jl=function(){function t(){this.annotationObjects={}}return Object.defineProperty(t.prototype,"textAnnotationConnectors",{get:function(){for(var e=[],t=0,i=Object.keys(this.annotationObjects);t<i.length;t++)for(var r=i[t],o=this.annotationObjects[r],n=0,a=Object.keys(o);n<a.length;n++){var s=a[n];e.push(o[s].connector)}return e},enumerable:!0,configurable:!0}),t.prototype.getTextAnnotationConn=function(e){var t=[];if("Bpmn"===e.shape.type&&0!==e.shape.annotations.length)for(var i=this.annotationObjects[e.id],r=0,o=Object.keys(i);r<o.length;r++){var n=o[r];t.push(i[n].connector)}return t},t.prototype.getSize=function(e,t){var r=new i(e.width,e.height);if(void 0===r.width||void 0===r.height){if(t instanceof Me||(r.width=r.width||50,r.height=r.height||50),t.actualSize.width&&t.actualSize.height)return t.actualSize;t.measure(new i),r.width=r.width||t.desiredSize.width,r.height=r.height||t.desiredSize.height,void 0!==e.maxWidth&&(r.width=Math.min(r.width,e.maxWidth)),void 0!==e.maxHeight&&(r.height=Math.min(r.height,e.maxHeight)),void 0!==e.minWidth&&(r.width=Math.max(r.width,e.minWidth)),void 0!==e.minHeight&&(r.height=Math.max(r.height,e.minHeight))}return r},t.prototype.initBPMNContent=function(e,t,i){var r=(sf.base.isBlazor(),t.shape),o=sf.base.isBlazor()?t.shape.bpmnShape:t.shape.shape;if("Event"===o&&(e=this.getBPMNEventShape(t,r.event)),"Gateway"===o&&(e=this.getBPMNGatewayShape(t)),"DataObject"===o&&(e=this.getBPMNDataObjectShape(t)),"Message"!==o&&"DataSource"!==o||(e=this.getBPMNShapes(t)),"Activity"===o&&(e=this.getBPMNActivityShape(t)),"TextAnnotation"===o&&(e=this.renderBPMNTextAnnotation(i,t,e)),r.annotations.length>0){for(var n=0;n<r.annotations.length&&r.annotations[n].text;n++)e.children.push(this.getBPMNTextAnnotation(t,i,r.annotations[n],e));e.style.strokeDashArray="2 2 6 2"}return e},t.prototype.getBPMNShapes=function(t){var i=new Me;this.setStyle(i,t),0!=(t.constraints&e.NodeConstraints.Shadow)&&(i.shadow=t.shadow);var r=Hl(sf.base.isBlazor()?t.shape.bpmnShape:t.shape.shape);return i.data=r,i.id=t.id+"_"+(sf.base.isBlazor()?t.shape.bpmnShape:t.shape.shape),void 0!==t.width&&void 0!==t.height&&(i.width=t.width,i.height=t.height),i},t.prototype.getBPMNGatewayShape=function(e){var t=new Te,i=new Me;i.id=e.id+"_0_gateway",i.offsetX=e.offsetX,i.offsetY=e.offsetY,i.data="M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z",this.setStyle(i,e);var r=new Me;r.id=e.id+"_1_gatewayType",r.style.opacity=e.style.opacity,r.style.strokeColor=e.style.strokeColor,r.horizontalAlignment="Center",r.verticalAlignment="Center",r.relativeMode="Object";var o=e.shape.gateway,n=_l(o.type);"EventBased"===o.type||"ExclusiveEventBased"===o.type||"ParallelEventBased"===o.type?r.style.fill="white":r.style.fill="black",r.data=n,t.style.fill="transparent",t.style.strokeColor="transparent",t.style.strokeWidth=0,t.children=[i,r];var a=this.getSize(e,i);return this.setSizeForBPMNGateway(e.shape.gateway,t,a.width,a.height),t},t.prototype.getBPMNDataObjectShape=function(e){var t=new Te,i=e.shape.dataObject,r=new Me;r.id=e.id+"_0_dataobj",r.data="M29.904,5 L7.853,5 L7.853,45 L42.147,45 L42.147,17.242,L29.932,5,L29.932,17.242,L42.147,17.242";var o=this.getSize(e,r);r.width=o.width,r.height=o.height,this.setStyle(r,e);var n=new Me;n.id=e.id+"_1_type",n.width=25,n.height=20,n.margin.left=5,n.margin.top=5,n.data="M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z",n.style.opacity=e.style.opacity;var a=new Me;switch(a.id=e.id+"_2_collection",a.width=7.5,a.height=15,a.style.fill="black",a.visible=!0,a.horizontalAlignment="Center",a.verticalAlignment="Bottom",a.relativeMode="Object",a.style.opacity=e.style.opacity,a.data="M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z",i.type){case"None":n.visible=!1;break;case"Input":n.style.fill="white";break;case"Output":n.style.fill="black"}return!1===i.collection&&(a.visible=!1),t.style.fill="transparent",t.style.strokeColor="transparent",t.style.strokeWidth=0,t.children=[r,n,a],t},t.prototype.getBPMNTaskShape=function(e){var t=e.shape.activity.task,i=new Te,r=new be;r.cornerRadius=10;var o=this.getSize(e,r);r.id=e.id+"_0_task",r.width=o.width,r.height=o.height,this.setStyle(r,e),void 0!==t.call&&!0===t.call&&(r.style.strokeWidth=4),i.width=o.width,i.height=o.height;var n,a=this.getTaskChildCount(e),s=12*a,h=o.width/2-s;n=1===a?h+8:h+8*(a-1);var d=new Me;"Receive"===t.type||"Send"===t.type?(d.width=18,d.height=16):(d.width=20,d.height=20),d.id=e.id+"_1_tasktType",d.margin.left=5,d.margin.top=5;var l=Vl(t.type);if(d.data=l,d.style.fill="transparent",d.style.opacity=e.style.opacity,i.style.fill="transparent",i.style.strokeColor="transparent",i.style.strokeWidth=0,i.children=[r,d],"Service"===t.type){var c=new Me;c.id=e.id+"_1_taskTypeService",c.data=l,c.margin.left=d.margin.left+9,c.margin.top=d.margin.top+9,c.style.fill="white",c.style.opacity=e.style.opacity,i.children.push(c)}var p=t.loop,g=new Me,u=Xl(p);g.data=u,g.style.fill="black",g.visible="None"!==p,1===a&&(n=h+9),g.margin.left=n,!0===g.visible&&(n+=20),g.width=12,g.height=12,g.margin.bottom=5,g.id=e.id+"_2_loop",g.horizontalAlignment="Left",g.verticalAlignment="Bottom",g.setOffsetWithRespectToBounds(0,1,"Fraction"),g.relativeMode="Point",g.style.fill="transparent",d.style.opacity=e.style.opacity,i.children.push(g);var f=new Me;return f=this.getBPMNCompensationShape(e,f),!0===t.compensation?f.visible=!0:f.visible=!1,1===a&&(n=h+9),f.margin.left=n-3,n+=18,i.children.push(f),i},t.prototype.getBPMNEventShape=function(e,t,i,r){var o,n,a,s,h=new Te;r=r||e.id;var d="M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",l=e.shape.event;if((!sf.base.isBlazor()&&"Event"===e.shape.shape||sf.base.isBlazor()&&"Event"===e.shape.bpmnShape)&&(o=l.event,n=l.trigger),a=t.width,s=t.height,i)a=a||20,s=s||20;else if(void 0===t.width||void 0===t.height){var c=new Me;c.data=d;var p=this.getSize(e,c);a=p.width,s=p.height}var g=e.shape.activity;if(!sf.base.isBlazor()&&"Activity"===e.shape.shape||sf.base.isBlazor()&&"Activity"===e.shape.bpmnShape){g.subProcess;o=t.event,n=t.trigger}var u=new Me;u.data=d,u.id=r+"_0_event",u.width=a,u.height=s,u.horizontalAlignment="Center",u.verticalAlignment="Center",u.relativeMode="Object",this.setStyle(u,e);var f=new Me;f.data=d,f.id=r+"_1_event",f.style.gradient=e.style.gradient,f.horizontalAlignment="Center",f.verticalAlignment="Center",f.relativeMode="Object",f.style.strokeColor=e.style.strokeColor,f.style.opacity=e.style.opacity;var m=new Me,y=Wl(n);switch(m.data=y,m.id=r+"_2_trigger",m.horizontalAlignment="Center",m.verticalAlignment="Center",m.relativeMode="Object",m.style.strokeColor=e.style.strokeColor,m.style.opacity=e.style.opacity,o){case"Start":f.visible=!1;break;case"NonInterruptingStart":u.style.strokeDashArray="2 3",f.visible=!1;break;case"Intermediate":u.style.fill="white",u.style.gradient=null;break;case"NonInterruptingIntermediate":u.style.fill="white",u.style.gradient=null,u.style.strokeDashArray="2 3",f.style.strokeDashArray="2 3";break;case"ThrowingIntermediate":case"End":u.style.fill="End"!==o?"white":"black",u.style.gradient=null,m.style.fill="black",m.style.strokeColor="white"}return h.style.fill="transparent",h.style.strokeColor="transparent",h.style.strokeWidth=0,h.children=[u,f,m],this.setSizeForBPMNEvents(l,h,a,s),h},t.prototype.setEventVisibility=function(e,t){var i=e.shape.event.event,r=t[0],o=t[1];t[2];switch(i){case"Start":o.visible=!1;break;case"NonInterruptingStart":r.style.strokeDashArray="2 3",o.visible=!1}},t.prototype.setSubProcessVisibility=function(e){var t=e.shape.activity.subProcess,i=t.events.length,r="Transaction"===e.shape.activity.subProcess.type?2:0,o=e.wrapper.children[0].children[0];if(!1===t.adhoc&&(o.children[3+r+i].visible=!1),!1===t.compensation&&(o.children[4+r+i].visible=!1),i>0)for(var n=0;n<i;n++)this.setEventVisibility(e,o.children[2+n].children)},t.prototype.getBPMNSubProcessShape=function(t){var i,r,o,n=new Te,a=new Me,s=(new Te,new Me),h=t.shape.activity,d=h.subProcess,l=this.getSubprocessChildCount(t),c=new be;c.id=t.id+"_0_Subprocess",c.style.fill="transparent",c.cornerRadius=10;var p=this.getSize(t,c);c.width=p.width,c.height=p.height,n.children=[c],"Transaction"===h.subProcess.type&&this.getBPMNSubProcessTransaction(t,t.shape,n);var g=12*l,u=p.width/2;o=1===l?u-6:u-g/2-4*(l-1)/2,this.setStyle(c,t),0!=(t.constraints&e.NodeConstraints.Shadow)&&(n.shadow=t.shadow);var f=new Me;if(f.id=t.id+"_0_collapsed",f.width=12,f.height=12,f.style.fill="black",f.style.strokeColor=t.style.strokeColor,f.margin.bottom=5,f.horizontalAlignment="Left",f.verticalAlignment="Bottom",f.setOffsetWithRespectToBounds(0,1,"Fraction"),f.relativeMode="Point",f.data=Hl("collapsedShape"),f.margin.left=o,!0!==d.collapsed||d.processes?f.visible=!1:f.visible=!0,!0===f.visible&&(o+=18),n.children.push(f),"Event"===d.type){c.style.strokeWidth=1,c.style.strokeDashArray="2 2",i=d.events;for(var m=0;m<i.length;m++)r=i[m],this.getBPMNSubEvent(r,t,n)}1===l&&(o=u+8),(s=this.getBPMNSubProcessLoopShape(t)).margin.left=o,!0===s.visible&&(o+=16),n.children.push(s),c.id=t.id+"_boundary","Default"===d.boundary&&(c.style.strokeWidth=1,c.style.strokeDashArray="1 0"),"Call"===d.boundary&&(c.style.strokeWidth=4,c.style.strokeDashArray="1 0"),"Event"===d.boundary&&(c.style.strokeWidth=1,c.style.strokeDashArray="2 2"),1===l&&(o=u+8),(a=this.getBPMNAdhocShape(t,a,d)).margin.left=o,!0===a.visible&&(o+=16),n.children.push(a);var y=new Me;return!0===d.compensation?y.visible=!0:y.visible=!1,1===l&&(o=u+8),(y=this.getBPMNCompensationShape(t,y)).margin.left=o,!0===y.visible&&(o+=16),n.children.push(y),n.style.strokeColor="transparent",n.style.strokeWidth=0,n.style.fill="transparent",n},t.prototype.getBPMNSubEvent=function(e,t,i,r){i.children=i.children||[];var o=this.getBPMNEventShape(t,e,!0,r);this.getBPMNSubprocessEvent(t,o,e),o.id=r||t.id+"_subprocessEvents",o.width=e.width||20,o.height=e.height||20,o.setOffsetWithRespectToBounds(e.offset.x,e.offset.y,"Fraction"),o.relativeMode="Point",o.margin=e.margin,o.horizontalAlignment=e.horizontalAlignment,o.verticalAlignment=e.verticalAlignment,o.style.fill="transparent",o.style.strokeColor="transparent",o.style.strokeWidth=0,i.children.push(o)},t.prototype.getBPMNSubProcessTransaction=function(e,t,i){var r=i.children[0].width,o=i.children[0].height,n=new be;n.margin={left:3,right:0,top:3,bottom:0},n.id=e.id+"_0_Subprocess_innnerRect",n.cornerRadius=10,n.width=r-6,n.height=o-6,i.children.push(n);var a=new Te;a.id=e.id+"_transaction_events",a.style.gradient=e.style.gradient;var s=t.activity.subProcess.transaction;this.getBPMNSubEvent(s.success,e,a,e.id+"_success"),this.getBPMNSubEvent(s.cancel,e,a,e.id+"_cancel"),this.getBPMNSubEvent(s.failure,e,a,e.id+"_failure"),this.updateDiagramContainerVisibility(a.children[0],s.success.visible),this.updateDiagramContainerVisibility(a.children[1],s.cancel.visible),this.updateDiagramContainerVisibility(a.children[2],s.failure.visible),a.float=!0,a.width=r,a.height=o,a.style.fill=a.style.strokeColor="transparent",i.children.push(a)},t.prototype.getBPMNSubProcessLoopShape=function(e){var t,i,r=e.shape.activity,o=new Me;return i=Xl(t=r.subProcess.loop),o.visible="None"!==t,o.id=e.id+"_loop",o.data=i,o.style.fill="black",o.width=12,o.height=12,o.horizontalAlignment="Left",o.verticalAlignment="Bottom",o.setOffsetWithRespectToBounds(0,1,"Fraction"),o.relativeMode="Point",o.margin.bottom=5,o.style.fill="transparent",o.style.strokeColor=e.style.strokeColor,o},t.prototype.drag=function(e,t,r,o){var n=o.nameTable[e.processId];e.margin.top+r>=0&&o.nodePropertyChange(e,{},{margin:{top:e.margin.top+r}}),e.margin.left+t>=0&&o.nodePropertyChange(e,{},{margin:{left:e.margin.left+t}});var a=this.getChildrenBound(n,e.id,o);this.updateSubProcessess(a,e,o),n.wrapper.measure(new i(void 0,void 0)),n.wrapper.arrange(n.wrapper.desiredSize),o.refreshCanvasLayers(),o.updateSelector(),this.updateDocks(e,o)},t.prototype.dropBPMNchild=function(e,t,r){if(t&&"Bpmn"===t.shape.type&&"Bpmn"===e.shape.type&&(!sf.base.isBlazor()&&"TextAnnotation"!==t.shape.shape||sf.base.isBlazor()&&"TextAnnotation"!==t.shape.bpmnShape)){var o=r.nameTable[e.id].shape.activity.subProcess;if(r.currentSymbol&&"Bpmn"===e.shape.type&&!o.collapsed)return void(t.processId=e.id);if(o.processes=o.processes||[],o.processes&&-1===o.processes.indexOf(t.id)&&!o.collapsed){o.processes.push(t.id);var n=Ah(t),a=r.nameTable[t.id].wrapper,s=r.nameTable[e.id].wrapper;a.margin.top=a.offsetY-a.actualSize.height/2-(e.offsetY-e.actualSize.height/2),a.margin.left=a.offsetX-a.actualSize.width/2-(e.offsetX-e.actualSize.width/2),a.margin.top=a.margin.top<0?0:a.margin.top,a.margin.left=a.margin.left<0?0:a.margin.left,r.nameTable[t.id].processId=e.id,s.children.push(r.nameTable[t.id].wrapper);var h=this.getChildrenBound(e,t.id,r);this.updateSubProcessess(h,t,r),s.measure(new i(void 0,void 0)),s.arrange(s.desiredSize),r.refreshCanvasLayers(),r.updateSelector();for(var d=[],l=(d=d.concat(t.outEdges,t.inEdges)).length-1;l>=0;l--)-1===r.bpmnModule.textAnnotationConnectors.indexOf(r.nameTable[d[l]])&&r.remove(r.nameTable[d[l]]);var c={type:"PositionChanged",undoObject:{nodes:[n]},redoObject:{nodes:[Ah(t)]},category:"Internal"};r.addHistoryEntry(c),"SVG"===r.mode&&t.zIndex<e.zIndex&&(r.updateProcesses(t),this.updateSubprocessNodeIndex(t,r,e)),this.updateDocks(t,r)}}},t.prototype.updateIndex=function(e,t){var i=t,r=e.getIndex(i,i.id);e.nodes.splice(Number(r),1),i.zIndex=e.nodes[e.nodes.length-1].zIndex+1,e.nodes.push(i)},t.prototype.updateSubprocessNodeIndex=function(e,t,i){if(e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length>0)for(var r=0;r<e.shape.activity.subProcess.processes.length;r++){this.updateIndex(t,e);var o=e.shape.activity.subProcess.processes[r];if(t.nameTable[o].shape.activity.subProcess.processes.length>0)this.updateSubprocessNodeIndex(t.nameTable[o],t,i);else{var n=t.nameTable[e.shape.activity.subProcess.processes[r]];this.updateIndex(t,n)}}else this.updateIndex(t,e)},t.prototype.updateDocks=function(e,t){if("Bpmn"===e.shape.type&&e.shape.activity.subProcess.processes&&!e.shape.activity.subProcess.collapsed)for(var r=0,o=e.shape.activity.subProcess.processes;r<o.length;r++){var n=o[r],a=t.nameTable[n];a&&(t.updateConnectorEdges(a),a.wrapper.measure(new i(a.wrapper.width,a.wrapper.height)),a.wrapper.arrange(a.wrapper.desiredSize),a.shape.activity.subProcess.processes&&a.shape.activity.subProcess.processes.length&&this.updateDocks(a,t))}},t.prototype.removeBpmnProcesses=function(e,t){var i=t.nameTable[e.processId];if("Bpmn"===e.shape.type&&e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length>0)for(var r=(o=e.shape.activity.subProcess.processes).length-1;r>=0;r--)t.remove(t.nameTable[o[r]]);if(i){t.removeDependentConnector(e);var o=i.shape.activity.subProcess.processes;this.removeChildFromBPMN(i.wrapper,e.id);var n=o.indexOf(e.id);o.splice(n,1)}},t.prototype.removeChildFromBPMN=function(e,t){for(var i=0,r=e.children;i<r.length;i++){var o=r[i];o.id===t?e.children.splice(e.children.indexOf(o),1):o.children&&this.removeChildFromBPMN(o,t)}},t.prototype.removeProcess=function(e,t){var i=t.nameTable[e];if(i){var r=t.nameTable[i.processId];if(r&&"Bpmn"===r.shape.type){var o=r.shape.activity.subProcess.processes;t.removeDependentConnector(i),this.removeChildFromBPMN(r.wrapper,e);var n=o.indexOf(e);o.splice(n,1),i.processId="",t.refreshDiagramLayer(),t.updateSelector()}}},t.prototype.addProcess=function(e,t,r){e.id=e.id||xh();var o=e.id,n=r.nameTable[o];n||r.add(e),e.processId=t;var a=r.nameTable[t],s=a.shape.activity.subProcess;if(n&&a&&"Bpmn"===a.shape.type&&"Bpmn"===n.shape.type&&s.processes){n.processId=t;var h=a.shape.activity.subProcess.processes;if(h.indexOf(o)<0&&h.push(o),a.wrapper.children.push(n.wrapper),a.wrapper.measure(new i),a.wrapper.arrange(a.wrapper.desiredSize),r.bpmnModule.updateDocks(a,r),r.refreshDiagramLayer(),"SVG"===r.mode&&n.shape&&n.shape.activity&&!n.shape.activity.subProcess.processes)Ks(t+"_groupElement").appendChild(Ks(e.id+"_groupElement"))}},t.prototype.getChildrenBound=function(e,t,i){var r,o=e.shape.activity.subProcess.processes;if(o&&o.length)for(var n=0,a=o;n<a.length;n++){var s=a[n];t!==s&&(r=r?i.nameTable[s].wrapper.bounds.uniteRect(r):i.nameTable[s].wrapper.bounds)}return r||i.nameTable[t].wrapper.bounds},t.prototype.updateSubProcessess=function(e,t,i){var r,o,n,a,s=i.nameTable[t.processId],h={x:.5,y:.5};s.wrapper.bounds.left+t.margin.left+t.width>s.wrapper.bounds.right&&(n=!0),s.wrapper.bounds.top+t.margin.top+t.height>s.wrapper.bounds.bottom&&(a=!0),n&&(h.x=0),a&&(h.y=0);var d=s.wrapper.actualSize;n&&(r=(t.wrapper.margin.left+t.wrapper.bounds.width)/d.width),a&&(o=(t.wrapper.margin.top+t.wrapper.bounds.height)/d.height),(r>0||o>0)&&i.commandHandler.scale(i.nameTable[t.processId],r||1,o||1,h)},t.prototype.getBPMNCompensationShape=function(e,t){return t.id=e.id+"_0_compensation",t.width=12,t.height=12,t.margin.bottom=5,t.style.fill="transparent",t.style.strokeColor=e.style.strokeColor,t.horizontalAlignment="Left",t.verticalAlignment="Bottom",t.relativeMode="Object",t.data="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127  c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z",t},t.prototype.getBPMNActivityShape=function(e){var t,i=new Te,r=e.shape.activity,o=r.activity,n=r.subProcess;r.activity;return"Task"===o&&(t=this.getBPMNTaskShape(e)),"SubProcess"===o&&n&&(t=this.getBPMNSubProcessShape(e)),t.id=o+e.id,i.children=[t],i.style.fill="transparent",i.style.strokeColor="transparent",i.style.strokeWidth=0,i},t.prototype.getBPMNSubprocessEvent=function(e,t,i){var r,o;if(0!==i.annotations.length)for(var n=0;n<i.annotations.length;n++){var a=i.annotations[n];(r=e.initAnnotationWrapper(a)).width=i.width,r.height=i.height,t.children.push(r)}if(0!==i.ports.length)for(n=0;n<i.ports.length;n++){var s=i.ports[n];o=e.initPortWrapper(s),t.children.push(o)}},t.prototype.getBPMNAdhocShape=function(e,t,i){return t.id=e.id+"_0_adhoc",t.width=12,t.height=8,t.style.fill="black",t.style.strokeColor=e.style.strokeColor,t.margin.bottom=5,t.horizontalAlignment="Left",t.verticalAlignment="Bottom",t.relativeMode="Object",t.data="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z",i&&!0===i.adhoc?t.visible=!0:t.visible=!1,t},t.prototype.getBPMNTextAnnotation=function(t,i,r,o){r.id=r.id||xh(),r.nodeId=t.id;var n=new Te,a=new Me,s=new Se;a.id=t.id+"_"+r.id+"_path",a.width=r.width,a.height=r.height,a.relativeMode="Object",s.id=t.id+"_"+r.id+"_text",s.content=r.text;var h=t.style;s.style={fontSize:h.fontSize,italic:h.italic,gradient:null,opacity:h.opacity,bold:h.bold,textWrapping:h.textWrapping,color:h.color,fill:"white",fontFamily:h.fontFamily,whiteSpace:h.whiteSpace,textOverflow:"Wrap",strokeColor:"none",strokeWidth:0,strokeDashArray:h.strokeDashArray,textAlign:h.textAlign,textDecoration:h.textDecoration},s.horizontalAlignment="Center",s.verticalAlignment="Center",s.relativeMode="Object",s.margin={left:5,right:5,top:5,bottom:5},n.offsetX=t.offsetX+r.length*Math.cos(r.angle*(Math.PI/180)),n.offsetY=t.offsetY+r.length*Math.sin(r.angle*(Math.PI/180)),n.float=!0,n.transform=e.Transform.Self,n.id=t.id+"_textannotation_"+r.id,n.style.strokeColor="transparent",n.margin={left:10,right:10,top:10,bottom:10},n.relativeMode="Object",n.rotateAngle=0,n.children=[a,s];var d=new js(t.shape,"annotations",{id:n.id,shape:{type:"Bpmn",shape:"TextAnnotation"}},!0);d.ports=[{id:a.id+"_port",shape:"Square",offset:{x:0,y:.5}}],d.offsetX=n.offsetX,d.offsetY=n.offsetY,d.text=r.text,d.angle=r.angle,d.length=r.length,d.width=r.width,d.height=r.height,d.wrapper=n,n.children.push(d.initPortWrapper(d.ports[0]));var l=new b(0,0,0,0),c=t.width||t.minWidth||0,p=t.height||t.minHeight||0;void 0!==c&&void 0!==p&&(l=new b(t.offsetX-c/2,t.offsetY-p/2,c,p)),this.setAnnotationPath(l,n,{x:d.offsetX,y:d.offsetY},d,r.length,r.angle);var g={id:t.id+"_"+r.id+"_connector",constraints:e.ConnectorConstraints.Default&~(e.ConnectorConstraints.DragTargetEnd|e.ConnectorConstraints.Drag),sourceID:t.id,targetID:n.id,targetDecorator:{shape:"None"}},u=new wr(t.shape,"annotations",g,!0);u.targetPortID=d.ports[0].id,u.init(i),u.wrapper.float=!1,u.wrapper.transform=e.Transform.Self,o.children.push(u.wrapper),u.zIndex=1e4;var f=this.annotationObjects[t.id];f||(f={}),f[r.id]||(f[r.id]={});return f[r.id].node=d,f[r.id].connector=u,this.annotationObjects[t.id]=f,i.initObject(d,void 0,!1),d.zIndex=1e4,n},t.prototype.renderBPMNTextAnnotation=function(e,t,i){t.id=t.id||xh();var r=new Te,o=new Me,n=new Se;o.id="_"+t.id+"_path",o.width=t.width,o.height=t.height,o.relativeMode="Object",n.id=t.id+"_text",n.content=t.shape.annotation.text;var a=t.style;n.style={fontSize:a.fontSize,italic:a.italic,gradient:null,opacity:a.opacity,bold:a.bold,textWrapping:a.textWrapping,color:a.color,fill:"white",fontFamily:a.fontFamily,whiteSpace:a.whiteSpace,textOverflow:"Wrap",strokeColor:"none",strokeWidth:0,strokeDashArray:a.strokeDashArray,textAlign:a.textAlign,textDecoration:a.textDecoration},n.horizontalAlignment="Left",n.verticalAlignment="Center",n.relativeMode="Object",n.margin={left:5,right:5,top:5,bottom:5},r.offsetX=t.offsetX+t.shape.annotation.length*Math.cos(t.shape.annotation.angle*(Math.PI/180)),r.offsetY=t.offsetY+t.shape.annotation.length*Math.sin(t.shape.annotation.angle*(Math.PI/180)),r.float=!0,r.id=t.id+"_textannotation_"+t.id,r.style.strokeColor="transparent",r.margin={left:10,right:10,top:10,bottom:10},r.relativeMode="Object",r.rotateAngle=0,r.children=[o,n];var s=new js(t.shape,"annotations",{id:r.id,shape:{type:"Bpmn",shape:"TextAnnotation"}},!0);s.ports=[{id:o.id+"_port",shape:"Square",offset:{x:0,y:.5}}],s.offsetX=r.offsetX,s.offsetY=r.offsetY,s.shape&&s.shape.annotation&&(s.text=t.shape.annotation.text,s.angle=t.shape.annotation.angle,s.length=t.shape.annotation.length),s.width=t.width,s.height=t.height,s.wrapper=r,r.children.push(s.initPortWrapper(s.ports[0]));var h=new b(0,0,0,0),d=t.width||0,l=t.height||0;return void 0!==d&&void 0!==l&&(h=new b(t.offsetX-d/2,t.offsetY-l/2,d,l)),this.setAnnotationPath(h,r,{x:s.offsetX,y:s.offsetY},s,t.length,t.angle),r},t.prototype.getTextAnnotationWrapper=function(e,t){if(e&&"Bpmn"===e.shape.type){if("TextAnnotation"===(sf.base.isBlazor()?e.shape.bpmnShape:e.shape.shape))return e.wrapper.children[1];if(this.annotationObjects[e.id]&&this.annotationObjects[e.id][t]){var i=this.annotationObjects[e.id][t].node;return this.getTextAnnotationWrapper(i,t)}}return null},t.prototype.addAnnotation=function(e,t,r){var o=e.wrapper.children[0],n=e.shape;t.nodeId=e.id;var a=new As(n,"annotations",t,!0);return n.annotations.push(a),o.children.push(this.getBPMNTextAnnotation(e,r,t,o)),e.wrapper.measure(new i),e.wrapper.arrange(e.wrapper.desiredSize),this.annotationObjects[e.id][t.id].connector},t.prototype.clearAnnotations=function(e,t){var i=e.shape;if(i.annotations.length)for(var r=i.annotations.length-1;r>=0;r--){var o=i.annotations[r];this.removeAnnotationObjects(e,o,t)}delete this.annotationObjects[e.id]},t.prototype.checkAndRemoveAnnotations=function(e,t){if("Bpmn"===e.shape.type)if(!sf.base.isBlazor()&&"TextAnnotation"===e.shape.shape||sf.base.isBlazor()&&"TextAnnotation"===e.shape.bpmnShape)for(var i=e.id.split("_"),r=i[i.length-1],o=i[i.length-3]||i[0],n=t.nameTable[o],a=n.shape,s=0,h=a.annotations;s<h.length;s++){var d=h[s];if(d.id===r)if(-1!==a.annotations.indexOf(d))return t.removeDependentConnector(e),this.removeAnnotationObjects(n,d,t),!0}else e.shape.annotations&&e.shape.annotations.length&&this.clearAnnotations(e,t);return!1},t.prototype.removeAnnotationObjects=function(t,i,r){var o=t.shape,n=o.annotations.indexOf(i);if(-1!==n){if(!(r.diagramActions&e.DiagramAction.UndoRedo||r.diagramActions&e.DiagramAction.Group)){var a={type:"CollectionChanged",changeType:"Remove",undoObject:Ah(i),redoObject:Ah(i),category:"Internal"};r.addHistoryEntry(a)}o.annotations.splice(n,1);var s=this.annotationObjects[t.id];if(s&&s[i.id]){var h=s[i.id].node,d=s[i.id].connector;r.removeElements(h),r.removeElements(d);var l=t.wrapper.children[0];n=l.children.indexOf(h.wrapper),l.children.splice(n,1),n=l.children.indexOf(d.wrapper),l.children.splice(n,1),r.removeFromAQuad(h),r.removeFromAQuad(d),delete r.nameTable[h.id],delete r.nameTable[d.id],delete s[i.id]}}},t.prototype.setAnnotationPath=function(e,t,i,r,o,n){var s,h,d=this.getAnnotationPathAngle(i,e),l="",c=t.children[0],p=t.children[2],g=t.children[1];c.horizontalAlignment="Stretch",c.verticalAlignment="Stretch",g.margin.left=g.margin.right=5,g.margin.top=g.margin.bottom=5,0===d?(l="M10,20 L0,20 L0,0 L10,0",c.width=10,c.horizontalAlignment="Left",p.setOffsetWithRespectToBounds(0,.5,"Fraction"),g.margin.top=g.margin.bottom=10,s=e.middleRight,h={x1:e.right,y1:e.top,x2:e.right,y2:e.bottom}):180===d?(l="M0,0 L10,0 L10,20 L0,20",c.width=10,c.horizontalAlignment="Right",p.setOffsetWithRespectToBounds(1,.5,"Fraction"),g.margin.top=g.margin.bottom=10,s=e.middleLeft,h={x1:e.left,y1:e.top,x2:e.left,y2:e.bottom}):90===d?(l="M20,10 L20,0 L0,0 L0,10",c.height=10,c.verticalAlignment="Top",p.setOffsetWithRespectToBounds(.5,0,"Fraction"),g.margin.left=g.margin.right=10,s=e.bottomCenter,h={x1:e.right,y1:e.bottom,x2:e.left,y2:e.bottom}):(l="M0,0 L0,10 L20,10 L20,0",c.height=10,c.verticalAlignment="Bottom",p.setOffsetWithRespectToBounds(.5,1,"Fraction"),g.margin.left=g.margin.right=10,s=e.topCenter,h={x1:e.right,y1:e.top,x2:e.left,y2:e.top});var u=e.center;s=Dt(h,[u,a.transform(i,n,Math.max(e.width,e.height))],0,u),c.data=l,void 0!==o&&void 0!==n&&(s=a.transform(s,n,o),t.offsetX=r.offsetX=s.x,t.offsetY=r.offsetY=s.y)},t.prototype.isBpmnTextAnnotation=function(e,t){if(this.annotationObjects){var i=e.parentId,r=e.id,o=t.nameTable[i];return o&&"Bpmn"===o.shape.type&&this.annotationObjects[i]&&this.annotationObjects[i][r]?o:null}return null},t.prototype.updateTextAnnotationContent=function(e,t,r,o){var n=t.parentId,a=t.id;if(this.annotationObjects[n]&&this.annotationObjects[n][a])for(var s=0,h=e.shape.annotations;s<h.length;s++){var d=h[s];if(d.id===a){d.text=r;var l=this.annotationObjects[n][a].node.wrapper.children[1];l.content=r,l.visible=!0,e.wrapper.measure(new i),e.wrapper.arrange(e.wrapper.desiredSize)}}},t.prototype.updateQuad=function(e,t){var i,r=e.shape.annotations;if(r&&r.length>0)for(var o=0;o<r.length;o++)i=this.annotationObjects[e.id][r[o].id].node,t.updateQuad(i)},t.prototype.updateTextAnnotationProp=function(e,t,i){if("Bpmn"===e.shape.type){var r=e.shape.annotations;if(r&&r.length>0)for(var o=0;o<e.wrapper.children[0].children.length;o++)for(var n=0;n<r.length;n++){var s=e.wrapper.children[0].children[o].id.split("_");if(s[s.length-1]===r[n].id){var h=this.annotationObjects[e.id][r[n].id].node,d=this.annotationObjects[e.id][r[n].id].connector,l=(Ht(d.targetPoint,e.wrapper.bounds,e.wrapper.bounds),d.sourcePoint);l={x:d.sourcePoint.x+e.offsetX-t.offsetX,y:d.sourcePoint.y+e.offsetY-t.offsetY},l=a.transform(l,r[n].angle,r[n].length),e.wrapper.children[0].children[o].offsetX=h.offsetX=l.x,e.wrapper.children[0].children[o].offsetY=h.offsetY=l.y,i.updateQuad(h)}}}},t.prototype.getSubprocessChildCount=function(e){var t=0,i=e.shape.activity.subProcess,r=i.loop;return void 0!==r&&"None"!==r&&t++,void 0!==i.compensation&&!0===i.compensation&&t++,void 0!==i.collapsed&&!0===i.collapsed&&t++,void 0!==i.adhoc&&!0===i.adhoc&&t++,t},t.prototype.getTaskChildCount=function(e){var t=0,i=e.shape.activity.task;return void 0!==i.compensation&&!0===i.compensation&&t++,void 0!==i.loop&&"None"!==i.loop&&t++,t},t.prototype.setStyle=function(t,i){t.style.fill=i.style.fill,t.style.strokeColor=i.style.strokeColor,t.style.strokeWidth=i.style.strokeWidth,t.style.strokeDashArray=i.style.strokeDashArray,t.style.opacity=i.style.opacity,t.style.gradient=i.style.gradient,0!=(i.constraints&e.NodeConstraints.Shadow)&&(t.shadow=i.shadow)},t.prototype.updateBPMN=function(e,t,i,r){var o=e.shape||{},n=i.wrapper.children[0],a=i.shape.shape||i.shape.bpmnShape,s=void 0!==e.width||void 0!==e.height;if((sf.base.isBlazor()&&"Gateway"===o.bpmnShape||"Gateway"===o.shape)&&o.gateway)i.wrapper.children[0]=this.getBPMNGatewayShape(i);else if((sf.base.isBlazor()&&"DataObject"===o.bpmnShape||"DataObject"===o.shape)&&o.dataObject)i.wrapper.children[0]=this.getBPMNDataObjectShape(i);else if((sf.base.isBlazor()&&"Activity"===o.bpmnShape||"Activity"===o.shape)&&o.activity)i.wrapper.children[0]=this.getBPMNActivityShape(i);else if((sf.base.isBlazor()&&"Event"===o.bpmnShape||"Event"===i.shape.bpmnShape||"Event"===o.shape)&&o.event){var h=o.event;i.wrapper.children[0]=this.getBPMNEventShape(i,h)}else sf.base.isBlazor()&&"Message"===o.bpmnShape||"Message"===o.shape||sf.base.isBlazor()&&"DataSource"===o.bpmnShape||"DataSource"===o.shape?i.wrapper.children[0]=this.getBPMNShapes(i):void 0!==o.gateway||"Gateway"===a&&s?this.updateBPMNGateway(i,e):void 0!==o.dataObject||"DataObject"===a&&s?this.updateBPMNDataObject(i,e,t):void 0!==o.activity||"Activity"===a&&s?this.updateBPMNActivity(i,e,t,r):(void 0!==o.event||"Event"===a&&s)&&this.updateBPMNEvent(i,e,t);if(i.wrapper.children[0].id=i.wrapper.children[0].id||n.id,e.style&&(ia(e.style,n instanceof xe?!sf.base.isBlazor()&&"Activity"===i.shape.shape||sf.base.isBlazor()&&"Activity"===i.shape.bpmnShape?n.children[0].children[0]:n.children[0]:n),e.style&&e.style.strokeColor&&n.children.length>0))if((!sf.base.isBlazor()&&"Activity"===i.shape.shape||sf.base.isBlazor()&&"Activity"===i.shape.bpmnShape)&&"SubProcess"===i.shape.activity.activity){var d=n.children[0];this.updateBPMNStyle(d,e.style.strokeColor)}else(!sf.base.isBlazor()&&"Gateway"===i.shape.shape||sf.base.isBlazor()&&"Gateway"===i.shape.bpmnShape||!sf.base.isBlazor()&&"Event"===i.shape.shape||sf.base.isBlazor()&&"Event"===i.shape.bpmnShape)&&this.updateBPMNStyle(n,e.style.strokeColor)},t.prototype.updateBPMNStyle=function(e,t){for(var i=0;i<e.children.length;i++){ia({strokeColor:t},e.children[i])}},t.prototype.updateBPMNGateway=function(e,t){var i=e.shape,r=e.wrapper.children[0];if(i){ia(e.style,r.children[0]);var o=_l(i.gateway.type);r.children[1].data=o}void 0===t.width&&void 0===t.height||this.setSizeForBPMNGateway(e.shape.gateway,r,t.width||e.width,t.height||e.height)},t.prototype.updateBPMNDataObject=function(e,t,i){var r=t.shape,o=e.wrapper.children[0];if(r){var n=o.children[1],a=o.children[2];if(void 0!==t.style&&(ia(t.style,o.children[0]),n.style.opacity=e.style.opacity,a.style.opacity=e.style.opacity),r.dataObject){switch(r.dataObject.type){case"None":n.visible=!1;break;case"Input":n.style.fill="white";break;case"Output":n.style.fill="black"}"None"===i.shape.dataObject.type&&(n.visible=!0),void 0!==t.shape.dataObject.collection&&(a.visible=r.dataObject.collection)}}void 0===t.width&&void 0===t.height||this.setSizeForBPMNDataObjects(e.shape.dataObject,o,t.width||e.width,t.height||e.height)},t.prototype.getEvent=function(e,t,i,r,o,n){switch(i){case"Start":o.visible=!1,r.style.strokeDashArray="",n.style.fill="white",n.style.strokeColor="black",r.style.fill="white";break;case"NonInterruptingStart":r.style.strokeDashArray="2 3",n.style.fill="white",r.style.fill="white",n.style.strokeColor="black",o.visible=!1;break;case"Intermediate":r.style.strokeDashArray="",r.style.fill="white",o.style.strokeDashArray="",r.style.gradient=null,n.style.fill="white",n.style.strokeColor="black",this.updateEventVisibility(t,o);break;case"NonInterruptingIntermediate":r.style.fill="white",r.style.gradient=null,n.style.fill="white",n.style.strokeColor="black",r.style.strokeDashArray="2 3",o.style.strokeDashArray="2 3",this.updateEventVisibility(t,o);break;case"ThrowingIntermediate":case"End":r.style.fill="End"!==i?"white":"black",r.style.strokeDashArray="",o.style.strokeDashArray="",r.style.gradient=null,n.style.fill="black",this.updateEventVisibility(t,o),n.style.strokeColor=e.style.fill}},t.prototype.updateEventVisibility=function(e,t){e.shape.activity&&e.shape.activity.subProcess&&e.shape.activity.subProcess.events&&void 0!==e.shape.activity.subProcess.events[0]&&void 0!==e.shape.activity.subProcess.events[0].event?"NonInterruptingStart"!==e.shape.activity.subProcess.events[0].event&&"Start"!==e.shape.activity.subProcess.events[0].event||(t.visible=!0):void 0!==e.shape.event&&("NonInterruptingStart"!==e.shape.event.event&&"Start"!==e.shape.event.event||(t.visible=!0))},t.prototype.updateBPMNEvent=function(e,t,i){var r,o=t.shape,n=e.wrapper.children[0];if(o){var a=n.children[0],s=n.children[1],h=n.children[2];void 0!==t.style&&(ia(e.style,n.children[0]),void 0===t.style.opacity&&void 0===t.style.strokeColor||(s.style.opacity=e.style.opacity,s.style.strokeColor=e.style.strokeColor));var d=o.event.event;r=o.event.trigger,void 0!==d&&this.getEvent(e,i,d,a,s,h),void 0!==r&&this.updateBPMNEventTrigger(e,t)}void 0===t.width&&void 0===t.height&&void 0===r||this.setSizeForBPMNEvents(e.shape.event,n,t.width||e.width,t.height||e.height)},t.prototype.updateBPMNEventTrigger=function(e,t){var i=e.shape,r=e.wrapper.children[0].children[2];r.canMeasurePath=!0,!t.style||void 0===t.style.strokeColor&&void 0===t.style.opacity||ia(e.style,r);var o=Wl(i.event.trigger);r.data=o},t.prototype.updateBPMNActivity=function(e,t,i,r){var o=t.shape,n=e.wrapper.children[0],a=this.getSize(e,n.children[0].children[0]);if(o){var s=i.shape.activity.activity,h=e.shape.activity.activity;if("SubProcess"!==s&&"Task"!==s||"SubProcess"!==h&&"Task"!==h){if("Task"===h&&void 0!==o.activity.task){this.updateBPMNActivityTask(e,t);var d=this.getTaskChildCount(e),l=void 0,c=12*d,p=a.width/2-c;l=1===d?p+8:p+8*(d-1),void 0!==o.activity.task.loop&&this.updateBPMNActivityTaskLoop(e,t,l,d,p,2)}"SubProcess"===h&&void 0!==o.activity.subProcess&&this.updateBPMNActivitySubProcess(e,t,i,r)}else r.removeElements(e),e.wrapper.children[0]=this.getBPMNActivityShape(e);this.setSizeForBPMNActivity(e.shape.activity,n,t.width||a.width,t.height||a.height,e)}void 0===t.width&&void 0===t.height||this.setSizeForBPMNActivity(e.shape.activity,n,t.width||a.width,t.height||a.height,e)},t.prototype.updateBPMNActivityTask=function(e,t){for(var i=t.shape,r=e.wrapper.children[0].children[0],o=i.activity.task,n=0;n<r.children.length;n++){if(r.children[n].id===e.id+"_1_taskTypeService")r.children.splice(n,1),(s=document.getElementById(e.id+"_1_taskTypeService")).parentNode.removeChild(s)}if("Receive"===o.type||"Send"===o.type?r.children[1].height=14:r.children[1].height=20,void 0!==o.type){var a=Vl(o.type);if(r.children[1].data=a,"Service"===o.type){for(n=0;n<r.children.length;n++){var s;if(r.children[n].id===e.id+"_1_tasktType")r.children.splice(n,1),(s=document.getElementById(e.id+"_1_tasktType")).parentNode.removeChild(s)}var h=new Me;h.id=e.id+"_1_tasktType",h.margin.left=5,h.margin.top=5,h.data=a,h.style.fill="transparent",h.style.opacity=e.style.opacity,h.width=20,h.height=20,r.children.splice(1,0,h);var d=new Me;d.id=e.id+"_1_taskTypeService",d.data=a,d.margin.left=r.children[1].margin.left+9,d.margin.top=r.children[1].margin.top+9,d.style.fill="white",d.style.opacity=e.style.opacity,r.children.splice(2,0,d)}}void 0!==i.activity.task.call&&(!1!==i.activity.task.call?r.children[0].style.strokeWidth=4:r.children[0].style.strokeWidth=1),void 0!==i.activity.task.compensation&&(!0===i.activity.task.compensation?r.children[3].visible=!0:r.children[3].visible=!1)},t.prototype.updateBPMNActivityTaskLoop=function(e,t,i,r,o,n){var a,s,h=t.shape,d=e.wrapper.children[0].children[0],l=h.activity,c=0;if(void 0!==l.subProcess){var p=l.subProcess;c="Transaction"===l.subProcess.type?2:0,s=Xl(a=p.loop),d.children[2+c].data=s,d.children[2+c].visible="None"!==a}else void 0!==l.task&&void 0!==l.task.loop&&(s=Xl(l.task.loop),d.children[2].data=s,d.children[2].visible="None"!==l.task.loop);this.updateChildMargin(d,r,o,i,n+c)},t.prototype.updateChildMargin=function(e,t,i,r,o){if(1===t)for(var n=o;n<e.children.length;n++)2!==n&&!0===e.children[n].visible&&(e.children[n].margin.left=r,r=i+8);else{r=i+8*(t-1);for(n=o;n<e.children.length;n++)2!==n&&!0===e.children[n].visible&&(e.children[n].margin.left=r,r+=20)}},t.prototype.updateBPMNActivitySubProcess=function(e,t,i,r){var o,n=t.shape,a=e.wrapper.children[0],s=this.getSize(e,a.children[0].children[0]),h=n.activity.subProcess,d=this.getSubprocessChildCount(e),l=12*d,c=s.width/2-l;o=1===d?c+8:c+8*(d-1),ia(e.style,a.children[0].children[0]),void 0!==h.events&&this.updateBPMNSubProcessEvent(e,t,i,r),void 0!==h.adhoc&&this.updateBPMNSubProcessAdhoc(e,i,h,o,d,c),void 0!==h.boundary&&this.updateBPMNSubProcessBoundary(e,h),void 0!==h.collapsed&&this.updateBPMNSubProcessCollapsed(e,i,h,o,d,c,r),void 0!==h.compensation&&this.updateBPMNSubProcessCompensation(e,i,h,o,d,c),void 0!==h.loop&&this.updateBPMNSubProcessLoop(e,i,h,o,d,c),void 0!==h.transaction&&this.updateBPMNSubProcessTransaction(e,t,i,r)},t.prototype.updateBPMNSubProcessEvent=function(e,t,i,r){for(var o=t.shape,n=e.wrapper.children[0],a=n.children[0],s=(n.children[0].children.length,o.activity.subProcess),h=0,d=Object.keys(s.events);h<d.length;h++){var l=d[h],c=Number(l),p=a.children[c+2],g=e.shape.activity.subProcess.events[c];this.updateBPMNSubEvent(e,s.events[c],g,p,t,i,r)}},t.prototype.updateBPMNSubEvent=function(e,t,i,r,o,n,a){var s,h,d=e.wrapper.children[0],l=o.shape,c=r.children[0],p=r.children[1],g=r.children[2];if(o.style&&(void 0===o.style.strokeColor&&void 0===o.style.opacity||(d.children[0].children[1].style.strokeColor=o.style.strokeColor,d.children[0].children[1].style.opacity=o.style.opacity)),void 0!==l.activity.subProcess&&(s=t.event,h=t.trigger),void 0!==s&&this.getEvent(o,n,s,c,p,g),void 0!==h){o.style&&ia(o.style,d.children[0]);var u=Wl(h);r.children[2].data=u}if(void 0===t.height&&void 0===t.width||this.getEventSize(t,r),void 0!==t.id&&(r.id=t.id),void 0!==t.margin&&(r.margin=t.margin),void 0!==t.horizontalAlignment&&(r.horizontalAlignment=t.horizontalAlignment),void 0!==t.verticalAlignment&&(r.verticalAlignment=t.verticalAlignment),void 0!==t.offset&&(r.setOffsetWithRespectToBounds(i.offset.x,i.offset.y,"Fraction"),r.relativeMode="Point"),void 0!==t.annotations){var f=void 0,m=d.children[0].children[2];r.children[3]&&r.children.length>3&&(f=r.children[3],a.updateAnnotation(t.annotations[0],f,m))}if(void 0!==t.ports){var y=void 0,v=d.children[0].children[2];r.children[4]&&r.children.length>4&&(y=r.children[4],a.updatePort(t.ports[0],y,v))}void 0!==t.visible&&this.updateDiagramContainerVisibility(r,t.visible)},t.prototype.updateBPMNSubProcessTransaction=function(e,t,i,r){var o,n=t.shape.activity.subProcess.transaction,a=e.wrapper.children[0].children[0].children[2];void 0!==n.success&&(o=e.shape.activity.subProcess.transaction.success,this.updateBPMNSubEvent(e,n.success,o,a.children[0],t,i,r)),void 0!==n.cancel&&(o=e.shape.activity.subProcess.transaction.cancel,this.updateBPMNSubEvent(e,n.cancel,o,a.children[1],t,i,r)),void 0!==n.failure&&(o=e.shape.activity.subProcess.transaction.failure,this.updateBPMNSubEvent(e,n.failure,o,a.children[2],t,i,r));for(var s=0,h=e.outEdges;s<h.length;s++){var d=h[s],l=r.nameTable[d];switch(l.sourcePortID){case"success":n.success&&void 0!==n.success.visible&&r.connectorPropertyChange(l,{},{sourcePortID:"success"});break;case"cancel":n.cancel&&void 0!==n.cancel.visible&&r.connectorPropertyChange(l,{},{sourcePortID:"cancel"});break;case"failure":n.failure&&void 0!==n.failure.visible&&r.connectorPropertyChange(l,{},{sourcePortID:"failure"})}}},t.prototype.getEventSize=function(e,t){void 0!==e.height&&(t.height=e.height,t.children[0].height=e.height,t.children[1].height=.85*e.height,t.children[2].height=.54*e.height),void 0!==e.width&&(t.width=e.width,t.children[0].width=e.width,t.children[1].width=.85*e.width,t.children[2].width=.54*e.width)},t.prototype.updateBPMNSubProcessAdhoc=function(e,t,i,r,o,n){e.shape;var a=e.wrapper.children[0].children[0],s="Transaction"===e.shape.activity.subProcess.type?2:0;!1===i.adhoc?a.children[3+s].visible=!1:a.children[3+s].visible=!0,this.updateChildMargin(a,o,n,r,3+s)},t.prototype.updateBPMNSubProcessBoundary=function(e,t){e.shape;var i=e.wrapper.children[0].children[0].children[0];"Default"===t.boundary&&(i.style.strokeWidth=1,i.style.strokeDashArray="1 0"),"Call"===t.boundary&&(i.style.strokeWidth=4,i.style.strokeDashArray="1 0"),"Event"===t.boundary&&(i.style.strokeWidth=1,i.style.strokeDashArray="2 2")},t.prototype.updateElementVisibility=function(e,t,i){if(e.shape.activity.subProcess.processes&&e.shape.activity.subProcess.processes.length>0)for(var r=e.shape.activity.subProcess.processes,o=r.length-1;o>=0;o--){var n=i.nameTable[r[o]];n.visible=t,i.updateElementVisibility(n.wrapper,n,t),t&&((!sf.base.isBlazor()&&"Event"===n.shape.shape||sf.base.isBlazor()&&"Event"===n.shape.bpmnShape)&&this.setEventVisibility(n,n.wrapper.children[0].children),"SubProcess"===n.shape.activity.activity&&this.setSubProcessVisibility(n));for(var a=n.inEdges.concat(n.outEdges),s=a.length-1;s>=0;s--){var h=i.nameTable[a[s]];h.visible=t,i.updateElementVisibility(h.wrapper,h,t)}}t&&((!sf.base.isBlazor()&&"Event"===e.shape.shape||sf.base.isBlazor()&&"Event"===e.shape.bpmnShape)&&this.setEventVisibility(e,e.wrapper.children[0].children),"SubProcess"===e.shape.activity.activity&&this.setSubProcessVisibility(e),"Task"===e.shape.activity.activity&&(!sf.base.isBlazor()&&"Activity"===e.shape.shape||sf.base.isBlazor()&&"Activity"===e.shape.bpmnShape)&&"None"===e.shape.activity.subProcess.loop&&(e.wrapper.children[0].children[0].children[3].visible=!1))},t.prototype.updateBPMNSubProcessCollapsed=function(e,t,i,r,o,n,a){var s=e.shape.activity.subProcess.events.length,h=e.wrapper.children[0].children[0],d="Transaction"===e.shape.activity.subProcess.type?3:1;!1===i.collapsed?(this.updateElementVisibility(e,!0,a),h.children[d+s].visible=!1):(this.updateElementVisibility(e,!1,a),h.children[d+s].visible=!0),this.updateChildMargin(h,o,n,r,3+s)},t.prototype.updateBPMNSubProcessCompensation=function(e,t,i,r,o,n){var a=e.wrapper.children[0].children[0],s="Transaction"===e.shape.activity.subProcess.type?2:0;!1===i.compensation?a.children[4+s].visible=!1:a.children[4+s].visible=!0,this.updateChildMargin(a,o,n,r,4+s)},t.prototype.updateBPMNSubProcessLoop=function(e,t,i,r,o,n){this.updateBPMNActivityTaskLoop(e,e,r,o,n,1)},t.prototype.updateBPMNConnector=function(e,t,i,r){var o=i.shape;return void 0!==o.sequence&&(e=this.getSequence(e,t,i,r)),void 0!==o.association&&(e=this.getAssociation(e,t,i,r)),void 0!==o.message&&(e=this.getMessage(e,t,i,r)),e},t.prototype.getSequence=function(t,i,r,o){if("Normal"===r.shape.sequence&&(o.connectorPropertyChange(t,i,{type:"Straight",targetDecorator:{shape:"Arrow",style:{fill:"black"}}}),t.wrapper.children[3].visible=!1),"Default"===r.shape.sequence){o.connectorPropertyChange(t,i,{type:"Straight",targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"None"}});var n=new Me,a=(new Me,void 0);n=t.getSegmentElement(t,n);for(var s=t.intermediatePoints,h=0;h<s.length-1;h++)length+=t.distance(s[h],s[h+1]),a=t.findPath(s[h],s[h+1]);t.wrapper.children[3].data=a[0],t.wrapper.children[3].id=t.id+"_"+r.shape.sequence,t.wrapper.children[3].offsetX=a[1].x,t.wrapper.children[3].offsetY=a[1].y,t.wrapper.children[3].rotateAngle=45,t.wrapper.children[3].transform=e.Transform.Self}return"Conditional"===r.shape.sequence&&(o.connectorPropertyChange(t,i,{type:"Straight",targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"Diamond",width:20,height:10,style:{fill:"white"}}}),t.wrapper.children[3].visible=!1),t},t.prototype.getAssociation=function(e,t,i,r){return"Default"===i.shape.association&&r.connectorPropertyChange(e,t,{type:"Straight",style:{strokeDashArray:"None"},targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"None"}}),"Directional"===i.shape.association&&r.connectorPropertyChange(e,t,{type:"Straight",style:{strokeDashArray:"2 2"},targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"None"}}),"BiDirectional"===i.shape.association&&r.connectorPropertyChange(e,t,{type:"Straight",style:{strokeDashArray:"2 2"},targetDecorator:{shape:"Arrow",style:{fill:"black"}},sourceDecorator:{shape:"Arrow",width:5,height:10,style:{fill:"white"}}}),e},t.prototype.getMessage=function(t,i,r,o){var n,s;if("Default"===i.shape.message){if(void 0!==r.shape.message){if("InitiatingMessage"===r.shape.message||"NonInitiatingMessage"===r.shape.message){var h=new Me;h=t.getSegmentElement(t,h);for(var d=t.intermediatePoints,l=0;l<d.length-1;l++){length+=t.distance(d[l],d[l+1]);var c=.5*length;length>=c&&(n=Tt(d[l],d[l+1]),s=a.transform(d[l],n,c))}}t.wrapper.children[3].id=t.id+"_"+r.shape.message,t.wrapper.children[3].width=25,t.wrapper.children[3].height=15,t.wrapper.children[3].data="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",t.wrapper.children[3].horizontalAlignment="Center",t.wrapper.children[3].verticalAlignment="Center",t.wrapper.children[3].transform=e.Transform.Self,t.wrapper.children[3].style.fill="NonInitiatingMessage"===r.shape.message?"lightgrey":"white",t.wrapper.children[3].offsetX=s.x,t.wrapper.children[3].offsetY=s.y}}else"NonInitiatingMessage"===i.shape.message&&"InitiatingMessage"===i.shape.message||("Default"!==r.shape.message?t.wrapper.children[3].style.fill="NonInitiatingMessage"===r.shape.message?"lightgrey":"white":t.wrapper.children[3].visible=!1);return t},t.prototype.setSizeForBPMNEvents=function(e,t,i,r){t.children[0].width=i,t.children[0].height=r;var o=t.children[1];o.width=.85*i,o.height=.85*r;var n=t.children[2];"Message"===e.trigger?(n.width=.54*i,n.height=.4*r):(n.width=.5*i,n.height=.5*r)},t.prototype.updateAnnotationDrag=function(e,t,i,r){var o=e.id.split("_");if("textannotation"===o[1])for(var n=void 0,s=0;s<e.inEdges.length;s++){var h=t.nameTable[e.inEdges[s]];h&&(n=t.nameTable[h.sourceID]);var d={x:e.offsetX+i,y:e.offsetY+r},l=h.sourcePoint,c=a.findLength(d,l),p=a.findAngle(l,d);if(n.shape.annotations)for(var g=0;g<n.shape.annotations.length;g++)if(n.shape.annotations[g].id===o[o.length-1])return n.shape.annotations[g].length=c,n.shape.annotations[g].angle=p,this.setAnnotationPath(n.wrapper.bounds,e.wrapper,d,e),!1}return!!e.processId&&(this.drag(e,i,r,t),!0)},t.prototype.getAnnotationPathAngle=function(e,t){var i=0;switch(Ht(e,t,t)){case"Right":i=0;break;case"Left":i=180;break;case"Bottom":i=90;break;case"Top":i=270}return i},t.prototype.setSizeForBPMNGateway=function(e,t,i,r){t.children[0].width=i,t.children[0].height=r,t.children[1].width=.45*i,t.children[1].height=.45*r},t.prototype.setSizeForBPMNDataObjects=function(e,t,i,r){t.children[0].width=i,t.children[0].height=r},t.prototype.setSizeForBPMNActivity=function(e,t,i,r,o){t.children[0].width=i,t.children[0].height=r,t.children[0].children[0].width=i,t.children[0].children[0].height=r,"Transaction"===e.subProcess.type&&(t.children[0].children[1].width=Math.max(i-6,1),t.children[0].children[1].height=Math.max(r-6,1),t.children[0].children[2].width=i,t.children[0].children[2].height=r);var n,a,s=new be,h=this.getSize(o,s),d=12*(a="Task"===e.activity?this.getTaskChildCount(o):this.getSubprocessChildCount(o)),l=(i||h.width)/2;n=1===a?l-6:l-d/2-4*(a-1)/2;for(var c=0;c<t.children[0].children.length;c++)t.children[0].children[c].visible&&(t.children[0].children[c].id.indexOf("_loop")>-1||t.children[0].children[c].id.indexOf("_0_compensation")>-1||t.children[0].children[c].id.indexOf("_0_adhoc")>-1||t.children[0].children[c].id.indexOf("_0_collapsed")>-1)&&(t.children[0].children[c].margin.left=n,n+=t.children[0].children[c].actualSize.width+4)},t.prototype.updateDiagramContainerVisibility=function(e,t){if(e instanceof xe)for(var i=0;i<e.children.length;i++)this.updateDiagramContainerVisibility(e.children[i],t);e.visible=t},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"Bpmn"},t}();function Hl(e){return Yl[e.toString()]}function Wl(e){return Ul[e.toString()]}function _l(e){return Gl[e.toString()]}function Vl(e){return Fl[e.toString()]}function Xl(e){return Zl[e.toString()]}var Yl={Event:"M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",Message:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z",DataSource:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8",SubProcess:"M100,100 h200 a20,20 0 0 1 20,20 v200 a20,20 0 0 1 -20,20 h-200 a20,20 0 0 1 -20,-20 v-200 a20,20 0 0 1 20,-20 z",collapsedShape:"M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z"},Ul={Message:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",Timer:"M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z",Error:"M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z",Escalation:"M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ",Cancel:"M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z",Compensation:"M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ",Conditional:"M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85",Link:"M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z",Signal:"M 50 50 H 0 L 25.0025 0 L 50 50 Z",Terminate:"M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50",Multiple:"M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z",Parallel:"M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"},Gl={None:"",Exclusive:"M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z",Inclusive:"M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z",Parallel:"M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z",Complex:"M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z",EventBased:"M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z",ExclusiveEventBased:"M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z",ParallelEventBased:"M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"},Fl={None:"",Service:"M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.890.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535-1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z",Receive:"M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z",Send:"M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z",InstantiatingReceive:"M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z",Manual:"M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322",BusinessRule:"M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322v -4.923 h 12.667 v 4.923 H 19.177 Z",User:"M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61-3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 ZM 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626-0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.7841.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.0030.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153-0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81",Script:"M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709-1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"},Zl={None:"",Standard:"M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z",ParallelMultiInstance:"M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ",SequenceMultiInstance:"M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5L 55.375,82.5 L 40.375,82.5 Z"},ql=function(){function t(){}return t.prototype.updateBridging=function(t,i){var r,o=[];if(t.bridges=[],function(t,i){return t.constraints&e.ConnectorConstraints.Bridging?t.constraints&e.ConnectorConstraints.Bridging:t.constraints&e.ConnectorConstraints.InheritBridging?i.constraints&e.DiagramConstraints.Bridging:0}(t,i)){var n=this.getPoints(t);r=b.toBounds(n);for(var a=t.bridgeSpace,s=i.bridgeDirection,h=-1,d=i.connectors,l=0;l<d.length;l++){var c=d[l];if(t&&c&&t.id!==c.id){var p=this.getPoints(c),g=b.toBounds(p);if(this.intersectsRect(r,g)){var u=this.intersect(n,p,!1,s,!0);if(u.length>0)for(var f=0;f<u.length;f++){var m=0,y=0,v=0,w=this.getLengthAtFractionPoint(t,u[f]);if(-1!==w.pointIndex){m=w.lengthFractionIndex,w.fullLength,y=w.segmentIndex,v=w.pointIndex;var x=this.getPointAtLength(m-a/2,n),C=this.getPointAtLength(m+a/2,n);this.isEmptyPoint(C)&&(C=x);var S=void 0,P=t.sourcePoint;S="Straight"===t.type?t.targetPoint:t.intermediatePoints[v];var T=this.angleCalculation(P,S);if(o.length){var A,z=t.sourcePoint,O=Math.abs(this.lengthCalculation(z,C)),I=-1;h=-1;for(var D=0;D<o[y].bridges.length;D++){h++;var E=o[y].bridges[D];if(O<Math.abs(this.lengthCalculation(z,E.endPoint))){I=h;break}}if(I>=0)(A=this.createSegment(x,C,T,s,v,t,i)).target=c.id,o[y].bridges.splice(I,0,A),o[y].bridges.join(),o[y].bridgeStartPoint.splice(I,0,x),o[y].bridgeStartPoint.join(),o[y].segmentIndex=y;else(A=this.createSegment(x,C,T,s,v,t,i)).target=c.id,o[y].bridges.push(A),o[y].bridgeStartPoint.push(x),o[y].segmentIndex=y}else if(!isNaN(x.x)&&!isNaN(x.y)&&!this.isEmptyPoint(C)){var B=this.createSegment(x,C,T,s,v,t,i),L={bridges:[],bridgeStartPoint:[],segmentIndex:y};B.target=c.id;var M=[];M.push(x),[].push(C),o[y]=L,o[y].bridges.push(B),o[y].bridgeStartPoint=M,o[y].segmentIndex=y}}}}}}0!==o.length&&this.firstBridge(o,t,a)}},t.prototype.firstBridge=function(e,t,i){for(var r=0;r<e.length;r++){for(var o=e[r],n=1;n<o.bridges.length;n++)if(a.findLength(o.bridges[n].endPoint,o.bridges[n-1].endPoint)<i){o.bridges[n-1].endPoint=o.bridges[n].endPoint;var s=o.bridges[n-1],h=this.createBridgeSegment(s.startPoint,s.endPoint,s.angle,i,s.sweep);o.bridges[n-1].path=h,o.bridges.splice(n,1),o.bridgeStartPoint.splice(n,1),n--}t.sourcePoint;for(var d=0;d<o.bridges.length;d++){(s=o.bridges[d]).endPoint,t.bridges.push(s)}}},t.prototype.createSegment=function(e,t,i,r,o,n,a){var s={angle:0,endPoint:{x:0,y:0},target:"",path:"",segmentPointIndex:-1,startPoint:{x:0,y:0},sweep:1,rendered:!1},h=this.sweepDirection(i,r,n,a),d=this.createBridgeSegment(e,t,i,n.bridgeSpace,h);return s.path=d,s.startPoint=e,s.endPoint=t,s.angle=i,s.segmentPointIndex=o,s.sweep=h,s},t.prototype.createBridgeSegment=function(e,t,i,r,o){return"A "+r/2+" "+r/2+" "+i+" , 1 "+o+" "+t.x+","+t.y},t.prototype.sweepDirection=function(e,t,i,r){var o,n=Math.abs(e);switch(t){case"Top":case"Bottom":o=1,n>=0&&n<=90&&(o=0);break;case"Left":case"Right":o=1,e<0&&e>=-180&&(o=0)}return"Right"!==t&&"Bottom"!==t||(o=0===o?1:0),o},t.prototype.getPointAtLength=function(e,t){for(var i,r=0,o={x:0,y:0},n=0;n<t.length;n++){var s=t[n];if(i){var h=this.lengthCalculation(i,s);if(r+h>e){var d=e-r,l=a.findAngle(i,s),c=d*Math.cos(l*Math.PI/180),p=d*Math.sin(l*Math.PI/180);o={x:i.x+c,y:i.y+p};break}r+=h,i=s}else i=s}return o},t.prototype.getPoints=function(e){var t=[];if(e.intermediatePoints&&("Straight"===e.type||"Orthogonal"===e.type))for(var i=0;i<e.intermediatePoints.length;i++)t.push(e.intermediatePoints[i]);return t},t.prototype.intersectsRect=function(e,t){return t.x<e.x+e.width&&e.x<t.x+t.width&&t.y<e.y+e.height&&e.y<t.y+t.height},t.prototype.intersect=function(e,t,i,r,o){i&&t.length>=2&&(t.splice(0,1),t.splice(0,1));for(var n=[],a=0;a<e.length-1;a++){var s=this.inter1(e[a],e[a+1],t,o,r);if(s.length>0)for(var h=0;h<s.length;h++)n.push(s[h]);i&&t.length>=1&&t.splice(0,1)}return n},t.prototype.inter1=function(e,t,i,r,o){for(var n=[],a=0;a<i.length-1;a++){var s=Nn(e,t,i[a],i[a+1]);if(!this.isEmptyPoint(s)){var h=this.angleCalculation(e,t),d=this.angleCalculation(i[a],i[a+1]);switch(h=this.checkForHorizontalLine(h),d=this.checkForHorizontalLine(d),o){case"Left":case"Right":h>d&&n.push(s);break;case"Top":case"Bottom":h<d&&n.push(s)}h===d&&r&&n.push(s)}}return n},t.prototype.checkForHorizontalLine=function(e){var t=Math.abs(e);return t>90?180-t:t},t.prototype.isEmptyPoint=function(e){return 0===e.x&&0===e.y},t.prototype.getLengthAtFractionPoint=function(e,t){for(var i=100,r=-1,o=0,n=-1,s=0,h=0,d=e.sourcePoint,l=d,c=[],p=0;p<e.intermediatePoints.length;p++){var g=e.intermediatePoints[p];c.push(g)}for(var u=0;u<c.length;u++){var f=c[u],m=this.getSlope(f,d,t,e);m<i&&(i=m,h=o+this.lengthCalculation(t,l),n=s,r=u),o+=a.findLength(f,d),d=f,l=f}return s++,{lengthFractionIndex:h,fullLength:o,segmentIndex:n,pointIndex:r}},t.prototype.getSlope=function(e,t,i,r){var o=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),a=(i.y-e.y)/(t.y-e.y),s=(i.x-e.x)/(t.x-e.x);if(!isFinite(a)||!isFinite(s)||isNaN(a)||isNaN(s)){if(e.x===t.x){if(e.y===t.y)return 1e4;if(e.y>i.y&&i.y>t.y||e.y<i.y&&i.y<t.y)return Math.abs(e.x-i.x)}else if(e.y===t.y&&(e.x>i.x&&i.x>t.x||e.x<i.x&&i.x<t.x))return Math.abs(e.y-i.y)}else if((e.x>=i.x&&i.x>=t.x||e.x<=i.x&&i.x<=t.x||o<3)&&(e.y>=i.y&&i.y>=t.y||e.y<=i.y&&i.y<=t.y||n<3))return Math.abs(a-s);return 1e4},t.prototype.angleCalculation=function(e,t){var i=e.x-t.x,r=e.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},t.prototype.lengthCalculation=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"Bridging"},t}(),Kl=function(){function t(e){this.line=[],this.diagram=e}return t.prototype.canSnap=function(){return 0!=(this.diagram.snapSettings.constraints&(e.SnapConstraints.SnapToObject|e.SnapConstraints.SnapToLines))},t.prototype.getWrapperObject=function(t,i){if(t.nodes&&t.nodes.length>0&&(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToLines||this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject))for(var r=0;r<t.nodes.length;r++)return("SwimLane"===t.nodes[r].shape.type||t.nodes[r].isLane||""!==t.nodes[r].parentId&&i[t.nodes[r].parentId]&&i[t.nodes[r].parentId].isLane)&&i.helper?i.helper.wrapper:t.wrapper;return t.wrapper},t.prototype.snapPoint=function(t,i,r,o,n,a,s){var h=this.diagram.snapSettings,d=this.diagram.scroller.currentZoom,l={x:0,y:0},c=Th(this.getWrapperObject(i,t.nameTable)),p={snapped:!1,offset:0},g={snapped:!1,offset:0};if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject){var u=document.createElementNS("http://www.w3.org/2000/svg","g");u.setAttribute("id","_SnappingLines"),u.setAttribute("shapeRendering","crispEdges"),this.getAdornerLayerSvg().appendChild(u),this.snapObject(t,i,u,p,g,n,a===s)}var f=c.x+n.x,m=c.y+n.y,y=c.x+c.width+n.x,v=c.y+c.height+n.y,b=h.verticalGridlines.scaledIntervals,w=this.round(y,b,d),x=this.round(f,b,d);b=h.horizontalGridlines.scaledIntervals;var C=this.round(m,b,d),S=this.round(v,b,d),P=c.x+c.width,T=c.y+c.height;return p.snapped?this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject?l.x=p.offset:l.x=s.x-a.x:this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToVerticalLines?Math.abs(n.x)>=1&&(r?Math.abs(w-P)>Math.abs(x-c.x)?l.x+=x-c.x:l.x+=w-P:Math.abs(w-P)<Math.abs(x-c.x)?l.x+=w-P:l.x+=x-c.x):l.x=s.x-a.x,g.snapped?l.y=g.offset:this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToHorizontalLines?Math.abs(n.y)>=1&&(o?Math.abs(S-T)>Math.abs(C-c.y)?l.y+=C-c.y:l.y+=S-T:Math.abs(S-T)<Math.abs(C-c.y)?l.y+=S-T:l.y+=C-c.y):l.y=s.y-a.y,l},t.prototype.round=function(e,t,i){i=1===i?Math.pow(2,Math.floor(Math.log(i)/Math.log(2))):i;var r=0,o=0;for(o=0;o<t.length;o++)r+=t[o];var n=e%(r/=i),a=Math.floor(Math.abs(e)/r)*r;if(a!==e)if(e>=0)for(o=0;o<t.length;o++){if(n<=t[o]/i)return a+(n<t[o]/(2*i)?0:t[o]/i);a+=t[o]/i,n-=t[o]/i}else for(a*=-1,o=t.length-1;o>=0;o--){if(Math.abs(n)<=t[o]/i)return a-(Math.abs(n)<t[o]/(2*i)?0:t[o]/i);a-=t[o]/i,n+=t[o]/i}return e},t.prototype.snapObject=function(e,t,i,r,o,n,a){var s,h,d,l=null,c=this.diagram.scroller,p=this.diagram.snapSettings,g=[],u=[],f=[],m=[],y=Th(this.getWrapperObject(t,e.nameTable)),v=e.scroller.currentZoom,w=-c.horizontalOffset,x=-c.verticalOffset,C=p.snapObjectDistance/v,S=new b(0,0,c.viewPortWidth,c.viewPortHeight),P=new b(w/v,y.y-C-5,S.width/v,y.height+2*C+10),T=new b(y.x-C-5,x/v,y.width+2*C+10,S.height/v);S=new b(w/v,x/v,S.width/v,S.height/v);var A,z,O,I=this.findNodes(e.spatialSearch,t,T,S),D=e.nameTable;for(A=0;A<I.length;A++)z=I[A],this.canBeTarget(e,z)&&(this.diagram.nameTable[z.id]instanceof wr||!this.canConsider(D,t,z)||((O=z.bounds).height+O.y<n.y+y.y?f.push({obj:z,distance:Math.abs(y.y+n.y-O.y-O.height)}):O.y>y.y+n.y+y.height&&m.push({obj:z,distance:Math.abs(y.y+n.y+y.height-O.y)}),(null==l||l>Math.abs(O.y-y.y-n.y))&&(Math.abs(O.x+O.width/2-(y.x+y.width/2+n.x))<=C?(h=this.createSnapObject(O,y,"centerX"),l=Math.abs(O.y-y.y)):Math.abs(O.x+O.width-(y.x+y.width+n.x))<=C?(h=this.createSnapObject(O,y,"right"),l=Math.abs(O.y-y.y)):Math.abs(O.x-(y.x+n.x))<=C?(h=this.createSnapObject(O,y,"left"),l=Math.abs(O.y-y.y)):Math.abs(O.x-(y.x+y.width+n.x))<=C?(h=this.createSnapObject(O,y,"rightLeft"),l=Math.abs(O.y-y.y)):Math.abs(O.x+O.width-(y.x+n.x))<=C&&(h=this.createSnapObject(O,y,"leftRight"),l=Math.abs(O.y-y.y)))));I=this.findNodes(e.spatialSearch,t,P,S);for(var E=0;E<I.length;E++)z=I[E],this.canBeTarget(e,z)&&(this.diagram.nameTable[z.id]instanceof wr||!this.canConsider(D,t,z)||((O=z.bounds).x+O.width<y.x+n.x&&(g[g.length]={obj:z,distance:Math.abs(y.x+n.x-O.x-O.width)}),O.x>y.x+n.x+y.width&&(u[u.length]={obj:z,distance:Math.abs(y.x+n.x+y.width-O.x)}),(null==s||s>Math.abs(O.x-y.x-n.x))&&(Math.abs(O.y+O.height/2-(y.y+y.height/2+n.y))<=C?(d=this.createSnapObject(O,y,"centerY"),s=Math.abs(O.x-y.x)):Math.abs(O.y-y.y-n.y)<=C?(d=this.createSnapObject(O,y,"top"),s=Math.abs(O.x-y.x)):Math.abs(O.y+O.height-(y.y+y.height+n.y))<=C?(d=this.createSnapObject(O,y,"bottom"),s=Math.abs(O.x-y.x)):Math.abs(O.y+O.height-y.y-n.y)<=C?(d=this.createSnapObject(O,y,"topBottom"),s=Math.abs(O.x-y.x)):Math.abs(O.y-(y.y+y.height+n.y))<=C&&(d=this.createSnapObject(O,y,"bottomTop"),s=Math.abs(O.x-y.x)))));this.createGuidelines(e,h,d,i,r,o,a),r.snapped||this.createHSpacingLines(e,i,t,g,u,r,o,a,n,C),o.snapped||this.createVSpacingLines(e,i,t,f,m,r,o,a,n,C)},t.prototype.snapConnectorEnd=function(t){var i=this.diagram.snapSettings,r=this.diagram.scroller.currentZoom;return i.constraints&e.SnapConstraints.SnapToLines&&(t.x=this.round(t.x,i.verticalGridlines.scaledIntervals,r),t.y=this.round(t.y,i.horizontalGridlines.scaledIntervals,r)),t},t.prototype.canBeTarget=function(e,t){return t=this.diagram.nameTable[t.id],!zd(this.diagram,t,!1)},t.prototype.snapSize=function(e,t,i,r,o,n,a,s){var h,d,l,c,p=this.diagram.snapSettings,g=this.diagram.scroller,u=Th(a.wrapper),f=e.nameTable,m=[],y=[],v=e.scroller.currentZoom,w=-g.horizontalOffset,x=-g.verticalOffset,C=p.snapObjectDistance/v,S=new b(0,0,g.viewPortWidth,g.viewPortHeight),P=new b(w/v,(u.y-5)/v,S.width/v,(u.height+10)/v),T=new b((u.x-5)/v,x/v,(u.width+10)/v,S.height/v);S=new b(w/v,x/v,S.width/v,S.height/v);var A,z,O,I=[],D=this.findNodes(e.spatialSearch,a,T,S,I);for(A=0;A<D.length;A++)z=D[A],!this.canConsider(f,a,z)||this.diagram.nameTable[z.id]instanceof wr||(O=z.bounds,(null==h||h>Math.abs(O.y-u.y))&&(t.left?Math.abs(u.x+o-O.x)<=C?(l=this.createSnapObject(O,u,"left"),h=Math.abs(O.y-u.y)):Math.abs(u.x+o-O.x-O.width)<=C&&(l=this.createSnapObject(O,u,"leftRight"),h=Math.abs(O.y-u.y)):t.right&&(Math.abs(u.x+o+u.width-O.x-O.width)<=C?(l=this.createSnapObject(O,u,"right"),h=Math.abs(O.y-u.y)):Math.abs(u.x+o+u.width-O.x)<=C&&(l=this.createSnapObject(O,u,"rightLeft"),h=Math.abs(O.y-u.y)))));D=this.findNodes(e.spatialSearch,a,P,S);for(var E=0;E<D.length;E++){var B=D[E];if(this.canConsider(f,a,B)&&!(this.diagram.nameTable[B.id]instanceof wr)){var L=B.bounds;(null==d||d>Math.abs(L.x-u.x))&&(i.top?Math.abs(u.y+n-L.y)<=C?(c=this.createSnapObject(L,u,"top"),d=Math.abs(L.x-u.x)):Math.abs(u.y+n-L.y-L.height)<=C&&(c=this.createSnapObject(L,u,"topBottom"),d=Math.abs(L.x-u.x)):i.bottom&&(Math.abs(u.y+u.height+n-L.y-L.height)<=C?(c=this.createSnapObject(L,u,"bottom"),d=Math.abs(L.x-u.x)):Math.abs(u.y+u.height+n-L.y)<=C&&(c=this.createSnapObject(L,u,"bottomTop"),d=Math.abs(L.x-u.x))))}}for(A=0;A<I.length;A++)if(z=I[A],this.canConsider(f,a,z)){var M=z.bounds,k=t.left?-o:o,R=Math.abs(u.width+k-M.width),N=void 0;R<=C&&(N=t.left?-M.width+u.width:M.width-u.width,m[m.length]={source:z,difference:R,offset:N}),k=i.top?-n:n;var j=Math.abs(u.height+k-M.height);j<=C&&(N=i.top?-M.height+u.height:M.height-u.height,y[y.length]={source:z,difference:j,offset:N})}if(!e.getTool)this.createGuidelines(e,l,c,r,t,i,s);!t.snapped&&m.length>0&&(t.left||t.right)&&this.addSameWidthLines(e,r,m,t,s,a),!i.snapped&&y.length>0&&(i.top||i.bottom)&&this.addSameHeightLines(e,r,y,i,s,a)},t.prototype.snapTop=function(t,i,r,o,n,a,s,h){var d,l=n;i.top=!0,t.left=t.right=!1;var c=this.diagram.scroller.currentZoom;if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject&&!a.rotateAngle&&(d=h.y-h.height*a.pivot.y+n-(a.offsetY-a.height*a.pivot.y),this.snapSize(this.diagram,t,i,r,o,d,this.diagram.selectedItems,s)),i.snapped)l=n-d+i.offset;else if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToHorizontalLines){var p=h.y-h.height*a.pivot.y,g=p+n;l=this.round(g,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,c)-p}return l},t.prototype.snapRight=function(t,i,r,o,n,a,s,h){var d,l=o;t.right=!0,i.top=i.bottom=!1;var c=this.diagram.scroller.currentZoom;if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject&&!a.rotateAngle&&(d=h.x+h.width*(1-a.pivot.x)+o-(a.offsetX+a.width*(1-a.pivot.x)),this.snapSize(this.diagram,t,i,r,d,n,this.diagram.selectedItems,s)),t.snapped)l=o-d+t.offset;else if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToVerticalLines){var p=h.x+h.width*(1-a.pivot.x),g=p+o;l=this.round(g,this.diagram.snapSettings.verticalGridlines.scaledIntervals,c)-p}return l},t.prototype.snapLeft=function(t,i,r,o,n,a,s,h){var d=o,l=0;t.left=!0,i.top=i.bottom=!1;var c=this.diagram.scroller.currentZoom;if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject&&!a.rotateAngle&&(l=h.x-h.width*a.pivot.x+o-(a.offsetX-a.width*a.pivot.x),this.snapSize(this.diagram,t,i,r,l,n,this.diagram.selectedItems,s)),t.snapped)d=o-l+t.offset;else if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToVerticalLines){var p=h.x-h.width*a.pivot.x,g=p+o;d=this.round(g,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,c)-p}return d},t.prototype.snapBottom=function(t,i,r,o,n,a,s,h){var d=n;i.bottom=!0,t.left=t.right=!1;var l=this.diagram.scroller.currentZoom,c=0;this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject&&!a.rotateAngle&&(c=h.y+h.height*(1-a.pivot.y)+n-(a.offsetY+a.height*(1-a.pivot.y)),this.snapSize(this.diagram,t,i,r,o,c,this.diagram.selectedItems,s));Th(a instanceof Se||a instanceof Yi?a:a.wrapper);if(i.snapped)d=n-c+i.offset;else if(this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToHorizontalLines){var p=h.y+h.height*(1-a.pivot.y),g=p+n;d=this.round(g,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,l)-p}return d},t.prototype.createGuidelines=function(e,t,i,r,o,n,a){return t&&(o.offset=t.offsetX,o.snapped=!0,a||(t.type,this.renderAlignmentLines(t.start,t.end,r,e.scroller.transform))),i&&(n.offset=i.offsetY,n.snapped=!0,a||(i.type,this.renderAlignmentLines(i.start,i.end,r,e.scroller.transform))),r},t.prototype.renderAlignmentLines=function(e,t,i,r){e={x:(e.x+r.tx)*r.scale,y:(e.y+r.ty)*r.scale},t={x:(t.x+r.tx)*r.scale,y:(t.y+r.ty)*r.scale};var o={stroke:"#07EDE1",strokeWidth:1,startPoint:{x:e.x,y:e.y},endPoint:{x:t.x,y:t.y},fill:"#07EDE1",dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:xh()},n=0;for(this.line.push(o),n=0;n<this.line.length;n++)this.diagram.diagramRenderer.drawLine(i,this.line.pop())},t.prototype.createHSpacingLines=function(e,t,i,r,o,n,a,s,h,d){var l=0;this.sortByDistance(r,"distance",!0),this.sortByDistance(o,"distance",!0);var c,p,g,u,f=[],m=Th(i.wrapper);if(r.length>0&&(f[f.length]=r[0],l=(c=r[0].obj.bounds).y,r.length>1?(g=r[1].obj.bounds,u=c.x-g.x-g.width,Math.abs(u-r[0].distance)<=d?l=this.findEquallySpacedNodesAtLeft(r,u,l,f):u=r[0].distance):u=r[0].distance),this.sortByDistance(f,"distance"),f[f.length]={obj:i,distance:0},l=m.y<l||!l?m.y:l,o.length>0){var y=void 0;if(l=(p=o[0].obj.bounds).y<l?p.y:l,o.length>1&&(y=(g=o[1].obj.bounds).x-p.x-p.width),r.length>0)if(Math.abs(o[0].distance-r[0].distance)<=d){var v=Math.abs(o[0].distance-r[0].distance)/2;o[0].distance<r[0].distance?u-=v:u+=v,f[f.length]=o[0]}else 1===r.length&&(c=void 0,f.splice(0,1),f[f.length]=o[0],u=y);else u=y,f[f.length]=o[0];o.length>1&&p.x+p.width<g.x&&(l=this.findEquallySpacedNodesAtRight(o,y,l,f,d))}if(f.length>2){this.addHSpacingLines(e,t,f,s,l);var b=0;s&&(b=h.x),c?n.offset=u-Math.abs(m.x+b-c.x-c.width)+b:p&&(n.offset=Math.abs(m.x+m.width+b-p.x)-u+b),n.snapped=!0}},t.prototype.createVSpacingLines=function(e,t,i,r,o,n,a,s,h,d){var l=0;this.sortByDistance(r,"distance",!0),this.sortByDistance(o,"distance",!0);var c,p,g,u,f,m=[],y=Th(i.wrapper);if(r.length>0&&(m[m.length]=r[0],l=(c=r[0].obj.bounds).x+c.width,r.length>1?(g=r[1].obj.bounds,u=c.y-g.y-g.height,Math.abs(u-r[0].distance)<=d?l=this.findEquallySpacedNodesAtTop(r,u,l,m):u=r[0].distance):u=r[0].distance),this.sortByDistance(m,"distance"),m[m.length]={obj:i,distance:0},l=y.x+y.width>l||!l?y.x+y.width:l,o.length>0){if(l=(p=o[0].obj.bounds).x+p.width>l?p.x+p.width:l,o.length>1&&(f=(g=o[1].obj.bounds).y-p.y-p.height),r.length>0)if(Math.abs(o[0].distance-r[0].distance)<=d){var v=Math.abs(o[0].distance-r[0].distance)/2;o[0].distance<r[0].distance?u-=v:u+=v,m[m.length]=o[0]}else 1===r.length&&(c=void 0,m.splice(0,1),m[m.length]=o[0],u=f);else u=f,m[m.length]=o[0];o.length>1&&g.y>p.y+p.height&&(l=this.findEquallySpacedNodesAtBottom(o,f,l,m,d))}if(m.length>2){this.addVSpacingLines(e,t,m,s,l);var b=0;s&&(b=h.y),c?a.offset=u-Math.abs(y.y+b-c.y-c.height)+b:p&&(a.offset=Math.abs(y.y+y.height+b-p.y)-u+b),a.snapped=!0}},t.prototype.addHSpacingLines=function(e,t,i,r,o){var n,a,s;if(!r)for(n=0;n<i.length-1;n++){var h=i[n].obj instanceof Ys?Th(i[n].obj.wrapper):i[n].obj.bounds,d=i[n+1].obj instanceof Ys?Th(i[n+1].obj.wrapper):i[n+1].obj.bounds;a={x:h.x+h.width,y:o-15},s={x:d.x,y:o-15},this.renderSpacingLines(a,s,t,this.getAdornerLayerSvg(),e.scroller.transform)}},t.prototype.addVSpacingLines=function(e,t,i,r,o){var n,a;if(!r)for(var s=0;s<i.length-1;s++){var h=i[s].obj instanceof Ys?Th(i[s].obj.wrapper):i[s].obj.bounds,d=i[s+1].obj instanceof Ys?Th(i[s+1].obj.wrapper):i[s+1].obj.bounds;n={x:o+15,y:h.y+h.height},a={x:o+15,y:d.y},this.renderSpacingLines(n,a,t,this.getAdornerLayerSvg(),e.scroller.transform)}},t.prototype.addSameWidthLines=function(e,t,i,r,o,n){this.sortByDistance(i,"offset");var a,s,h,d=Th(n.wrapper),l=i[0],c=l.source.bounds,p=[];for(p.push(i[0]),h=1;h<i.length;h++)i[h].source.bounds.width===c.width&&p.push(i[h]);if(!o)for(a={x:d.x+l.offset,y:d.y-15},s={x:d.x+d.width+l.offset,y:d.y-15},this.renderSpacingLines(a,s,t,this.getAdornerLayerSvg(),e.scroller.transform),h=0;h<p.length;h++)a={x:(d=p[h].source.bounds).x,y:d.y-15},s={x:d.x+d.width,y:d.y-15},this.renderSpacingLines(a,s,t,this.getAdornerLayerSvg(),e.scroller.transform);r.offset=l.offset,r.snapped=!0},t.prototype.addSameHeightLines=function(e,t,i,r,o,n){this.sortByDistance(i,"offset");var a,s,h,d=Th(n.wrapper),l=i[0],c=l.source.bounds,p=[];for(p.push(i[0]),h=0;h<i.length;h++)i[h].source.bounds.height===c.height&&p.push(i[h]);if(!o)for(a={x:d.x+d.width+15,y:d.y+l.offset},s={x:d.x+d.width+15,y:d.y+l.offset+d.height},this.renderSpacingLines(a,s,t,this.getAdornerLayerSvg(),e.scroller.transform),h=0;h<p.length;h++)a={x:(d=p[h].source.bounds).x+d.width+15,y:d.y},s={x:d.x+d.width+15,y:d.y+d.height},this.renderSpacingLines(a,s,t,this.getAdornerLayerSvg(),e.scroller.transform);r.offset=l.offset,r.snapped=!0},t.prototype.renderSpacingLines=function(e,t,i,r,o){var n,a,s=new Me,h={};e={x:(e.x+o.tx)*o.scale,y:(e.y+o.ty)*o.scale},t={x:(t.x+o.tx)*o.scale,y:(t.y+o.ty)*o.scale},e.x===t.x?(n="M"+(e.x-5)+" "+(e.y+5)+"L"+e.x+" "+e.y+"L"+(e.x+5)+" "+(e.y+5)+"zM"+(t.x-5)+" "+(t.y-5)+" L"+t.x+" "+t.y+" L"+(t.x+5)+" "+(t.y-5)+"z",a={startPoint:{x:e.x-8,y:e.y-1},endPoint:{x:e.x+8,y:e.y-1},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:xh()},s.data=n,h.data=s.data,h.angle=0,h.pivotX=0,h.pivotY=0,h.x=0,h.y=0,h.height=0,h.width=1,h.id=xh(),this.diagram.diagramRenderer.drawPath(i,h),this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),a={startPoint:{x:t.x-8,y:t.y+1},endPoint:{x:t.x+8,y:t.y+1},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:this.getAdornerLayerSvg().id+"spacing"},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())):(n="M"+(e.x+5)+" "+(e.y+5)+" L"+e.x+" "+e.y+" L"+(e.x+5)+" "+(e.y-5)+"zM"+(t.x-5)+" "+(t.y-5)+" L"+t.x+" "+t.y+" L"+(t.x-5)+" "+(t.y+5)+"z",s.data=n,h.data=n,h.angle=0,h.pivotX=0,h.pivotY=0,h.x=0,h.y=0,h.height=0,h.width=1,h.id=xh(),this.diagram.diagramRenderer.drawPath(i,h),a={visible:!0,opacity:1,id:xh(),startPoint:{x:e.x-1,y:e.y-8},endPoint:{x:e.x-1,y:e.y+8},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"0",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),a={width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:xh(),startPoint:{x:t.x+1,y:t.y-8},endPoint:{x:t.x+1,y:t.y+8},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"0"},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())),a={startPoint:{x:e.x,y:e.y},endPoint:{x:t.x,y:t.y},stroke:"#07EDE1",strokeWidth:1,fill:"#07EDE1",dashArray:"0",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:xh()},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())},t.prototype.createSnapObject=function(e,t,i){var r;switch(i){case"left":r={start:{x:e.x,y:Math.min(e.y,t.y)},end:{x:e.x,y:Math.max(e.y+e.height,t.y+t.height)},offsetX:e.x-t.x,offsetY:0,type:"sideAlign"};break;case"right":r={type:"sideAlign",start:{x:e.x+e.width,y:Math.min(e.y,t.y)},offsetX:e.x+e.width-t.x-t.width,offsetY:0,end:{x:e.x+e.width,y:Math.max(e.y+e.height,t.y+t.height)}};break;case"top":r={offsetY:e.y-t.y,offsetX:0,type:"sideAlign",start:{x:Math.min(e.x,t.x),y:e.y},end:{x:Math.max(e.x+e.width,t.x+t.width),y:e.y}};break;case"bottom":r={type:"sideAlign",offsetY:e.y+e.height-t.y-t.height,offsetX:0,end:{x:Math.max(e.x+e.width,t.x+t.width),y:e.y+e.height},start:{x:Math.min(e.x,t.x),y:e.y+e.height}};break;case"topBottom":r={start:{x:Math.min(e.x,t.x),y:e.y+e.height},end:{x:Math.max(e.x+e.width,t.x+t.width),y:e.y+e.height},offsetY:e.y+e.height-t.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":r={start:{x:Math.min(e.x,t.x),y:e.y},end:{x:Math.max(e.x+e.width,t.x+t.width),y:e.y},offsetY:e.y-t.y-t.height,offsetX:0,type:"sideAlign"};break;case"leftRight":r={start:{x:e.x+e.width,y:Math.min(e.y,t.y)},end:{x:e.x+e.width,y:Math.max(e.y+e.height,t.y+t.height)},offsetX:e.x+e.width-t.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":r={start:{x:e.x,y:Math.min(e.y,t.y)},end:{x:e.x,y:Math.max(e.y+e.height,t.y+t.height)},offsetX:e.x-t.x-t.width,offsetY:0,type:"sideAlign"};break;case"centerX":r={start:{x:e.x+e.width/2,y:Math.min(e.y,t.y)},end:{x:e.x+e.width/2,y:Math.max(e.y+e.height,t.y+t.height)},offsetX:e.x+e.width/2-(t.x+t.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":r={start:{x:Math.min(e.x,t.x),y:e.y+e.height/2},end:{x:Math.max(e.x+e.width,t.x+t.width),y:e.y+e.height/2},offsetY:e.y+e.height/2-(t.y+t.height/2),offsetX:0,type:"centerAlign"}}return r},t.prototype.snapAngle=function(e,t){var i=this.diagram.snapSettings.snapAngle,r=t%(i||0);return r>=i/2?t+i-r:t-r},t.prototype.canConsider=function(e,t,i){return!this.diagram.selectedItems.nodes.length||this.diagram.selectedItems.nodes[0].id!==i.id},t.prototype.findNodes=function(e,t,i,r,o){for(var n,a,s=[],h=e.findQuads(o?r:i),d=0;d<h.length;d++){var l=h[d];if(l.objects.length>0)for(var c=0;c<l.objects.length;c++)n=l.objects[c],this.diagram.nameTable[n.id]instanceof wr||!n.visible||"SwimLane"===this.diagram.nameTable[n.id].shape.type||this.diagram.nameTable[n.id].isLane||this.diagram.nameTable[n.id].isPhase||this.diagram.nameTable[n.id].isHeader||"helper"==n.id||(a=Th(n),-1===s.indexOf(n)&&this.intersectsRect(i,a)&&s.push(n),o&&o.indexOf(n)&&this.intersectsRect(r,a)&&o.push(n))}return s},t.prototype.intersectsRect=function(e,t){return t.x<e.x+e.width&&e.x<t.x+t.width&&t.y<e.y+e.height&&e.y<t.y+t.height},t.prototype.getAdornerLayerSvg=function(){return this.diagram.diagramRenderer.adornerSvgLayer},t.prototype.removeGuidelines=function(e){var t=this.getAdornerLayerSvg().getElementById("_SnappingLines"),i=this.getAdornerLayerSvg().getElementById("pivotLine");t&&t.parentNode.removeChild(t),i&&i.parentNode.removeChild(i)},t.prototype.sortByDistance=function(e,t,i){var r,o,n;if(i)for(r=0;r<e.length;r++)for(o=r+1;o<e.length;o++)e[r][t]>e[o][t]&&(n=e[r],e[r]=e[o],e[o]=n);else for(r=0;r<e.length;r++)for(o=r+1;o<e.length;o++)e[r][t]<e[o][t]&&(n=e[r],e[r]=e[o],e[o]=n)},t.prototype.findEquallySpacedNodesAtLeft=function(e,t,i,r){var o,n,a,s;for(s=1;s<e.length&&(o=e[s-1].obj.bounds,n=e[s].obj.bounds,a=o.x-n.x-n.width,Math.abs(a-t)<=1);s++)r[r.length]=e[s],n.y<i&&(i=n.y);return i},t.prototype.findEquallySpacedNodesAtRight=function(e,t,i,r,o){var n,a,s,h,d=e[0].distance;if(Math.abs(t-d)<=o)for(var l=0;l<e.length-1&&(n=e[l].obj,a=e[l+1].obj.bounds,s=n.bounds,h=a.x-s.x-s.width,Math.abs(h-t)<=1);l++)r[r.length]=e[l+1],s.y<i&&(i=s.y);return i},t.prototype.findEquallySpacedNodesAtTop=function(e,t,i,r){for(var o,n,a,s=1;s<e.length&&(o=e[s-1].obj.bounds,n=e[s].obj.bounds,a=o.y-n.y-n.height,Math.abs(a-t)<=1);s++)r[r.length]=e[s],n.x+n.width>i&&(i=n.x+n.width);return i},t.prototype.findEquallySpacedNodesAtBottom=function(e,t,i,r,o){var n,a,s,h,d=e[0].distance;if(Math.abs(t-d)<=o)for(var l=0;l<e.length-1&&(n=e[l].obj,a=e[l+1].obj.bounds,s=n.bounds,h=a.y-s.y-s.height,Math.abs(h-t)<=1);l++)r[r.length]=e[l+1],s.x+s.width>i&&(i=s.x+s.width);return i},t.prototype.getLayer=function(){var t;return this.diagram.snapSettings.constraints&e.SnapConstraints.SnapToObject&&((t=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id","_SnappingLines"),t.setAttribute("shapeRendering","crispEdges"),this.getAdornerLayerSvg().appendChild(t)),t},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"Snapping"},t}(),Ql=function(){function t(){this.groupUndo=!1,this.childTable=[],this.historyCount=0,this.hasGroup=!1,this.groupCount=0}return t.prototype.initHistory=function(e){e.historyManager={canRedo:!1,canUndo:!1,currentEntry:null,push:e.addHistoryEntry.bind(e),undo:Function,redo:Function,startGroupAction:e.startGroupAction.bind(e),endGroupAction:e.endGroupAction.bind(e),canLog:null,undoStack:[],redoStack:[],stackLimit:e.historyManager?e.historyManager.stackLimit:void 0}},t.prototype.addHistoryEntry=function(e,t){var i=null;if(t.historyManager.canLog&&!0===t.historyManager.canLog(e).cancel)return;if(t.historyManager&&t.historyManager.canUndo&&t.historyManager.currentEntry&&((i=t.historyManager.currentEntry).next?i.previous&&(i.next.previous=null,i.next=e,e.previous=i):(i.next=e,e.previous=i)),t.historyManager.currentEntry=e,t.historyManager.stackLimit){if("StartGroup"===e.type||"EndGroup"===e.type){var r="EndGroup"===e.type;this.setEntryLimit(r)}this.hasGroup||0!==this.groupCount||(this.historyCount<t.historyManager.stackLimit?this.historyCount++:this.applyLimit(t.historyManager.currentEntry,t.historyManager.stackLimit,t))}this.getHistoryList(t),t.historyManager.canUndo=!0,t.historyManager.canRedo=!1},t.prototype.applyLimit=function(e,t,i,r){if(e&&e.previous){if("StartGroup"===e.type||"EndGroup"===e.type){var o="StartGroup"===e.type;this.setEntryLimit(o)}this.hasGroup||0!==this.groupCount||t--,0===t?(r&&this.limitHistoryStack(e.previous,i),i.historyManager.stackLimit<this.historyCount&&(this.historyCount=i.historyManager.stackLimit),delete e.previous):e.previous&&this.applyLimit(e.previous,t,i,r)}this.groupCount=0},t.prototype.clearHistory=function(e){var t=e.historyManager;t.currentEntry=void 0,t.canUndo=!1,t.canRedo=!1,this.historyCount=0,this.groupCount=0,e.historyManager.undoStack=[],e.historyManager.redoStack=[]},t.prototype.setEntryLimit=function(e){e?this.groupCount--:this.groupCount++,this.hasGroup=e?!e:e},t.prototype.limitHistoryStack=function(e,t){"StartGroup"!==e.type&&"EndGroup"!==e.type&&(this.removeFromStack(t.historyManager.undoStack,e),this.removeFromStack(t.historyManager.redoStack,e)),e.previous&&this.limitHistoryStack(e.previous,t)},t.prototype.removeFromStack=function(e,t){if(e.length)for(var i=0;i<=e.length;i++)if(e[i].undoObject===t.undoObject&&e[i].redoObject===t.redoObject){e.splice(i,1);break}},t.prototype.undo=function(t){var i=this.getUndoEntry(t),r=0;if(i)if("Internal"===i.category)"EndGroup"===i.type?(r++,this.groupUndo=!0,sf.base.isBlazor()&&(t.blazorActions|=e.BlazorAction.GroupingInProgress)):this.undoEntry(i,t),this.groupUndo&&(this.undoGroupAction(i,t,r),this.groupUndo=!1);else{sf.base.isBlazor()||t.historyManager.undo(i);var o={entryType:"undo",oldValue:i.undoObject,newValue:i.redoObject};sf.base.isBlazor()&&(o={entryType:"undo",oldValue:this.getHistoryChangeEvent(i.undoObject,i.blazorHistoryEntryType),newValue:this.getHistoryChangeEvent(i.redoObject,i.blazorHistoryEntryType)}),t.triggerEvent(e.DiagramEvent.historyStateChange,o)}},t.prototype.getHistoryChangeEvent=function(e,t){var i={};switch(t){case"Node":i.node=e;break;case"Connector":i.connector=e;break;case"Selector":i.selector=e;break;case"Diagram":i.diagram=e;break;case"ShapeAnnotation":i.shapeAnnotation=e;break;case"PathAnnotation":i.pathAnnotation=e;break;case"PortObject":i.pointPortModel=e;break;case"Object":i.object=e}return i},t.prototype.getHistoryList=function(e){var t,i,r=[],o=[],n=e.historyManager.currentEntry;for(n=e.historyManager.currentEntry,e.historyManager.canUndo||0===e.historyManager.undoStack.length?this.getHistroyObject(r,n):this.getHistroyObject(o,n);n&&n.previous;)t=n.previous,this.getHistroyObject(r,t),n=n.previous;for(n=e.historyManager.currentEntry;n&&n.next;)i=n.next,this.getHistroyObject(o,i),n=n.next;e.historyManager.undoStack=r,e.historyManager.redoStack=o},t.prototype.getHistroyObject=function(e,t){t&&"StartGroup"!==t.type&&"EndGroup"!==t.type&&e.push({redoObject:t.redoObject?t.redoObject:null,undoObject:t.undoObject?t.undoObject:null,type:t.type?t.type:null,category:t.category?t.category:null})},t.prototype.undoGroupAction=function(e,t,i){for(;0!==i;)this.undoEntry(e,t),"StartGroup"===(e=this.getUndoEntry(t)).type?i--:"EndGroup"===e.type&&i++;i=0},t.prototype.undoEntry=function(t,r){var o,n;if("PropertyChanged"!==t.type&&"CollectionChanged"!==t.type&&"LabelCollectionChanged"!==t.type&&(o=t.undoObject,n=t.undoObject),"StartGroup"!==t.type&&"EndGroup"!==t.type&&r.historyManager.undoStack.length>0){var a=r.historyManager.undoStack.splice(0,1);r.historyManager.redoStack.splice(0,0,a[0]),n=t.undoObject}switch(r.protectPropertyChange(!0),r.diagramActions|=e.DiagramAction.UndoRedo,sf.base.isBlazor()&&t.previous&&"StartGroup"===t.previous.type&&(r.blazorActions&=~e.BlazorAction.GroupingInProgress),t.type){case"PositionChanged":case"Align":case"Distribute":this.recordPositionChanged(o,r);break;case"SizeChanged":case"Sizing":this.recordSizeChanged(o,r,t);break;case"RotationChanged":this.recordRotationChanged(o,r,t);break;case"ConnectionChanged":this.recordConnectionChanged(o,r);break;case"PropertyChanged":this.recordPropertyChanged(t,r,!1);break;case"CollectionChanged":if(t&&t.next&&"AddChildToGroupNode"===t.next.type&&"Insert"===t.next.changeType){var s=r.getObject(t.next.undoObject.id);r.insertValue(Ah(s),!0)}if(t.isUndo=!0,this.recordCollectionChanged(t,r),t.isUndo=!1,t&&t.next&&"AddChildToGroupNode"===t.next.type&&"Insert"===t.next.changeType)(s=r.getObject(t.next.undoObject.id)).wrapper.measure(new i),s.wrapper.arrange(s.wrapper.desiredSize),r.updateDiagramObject(s);break;case"LabelCollectionChanged":t.isUndo=!0,this.recordLabelCollectionChanged(t,r),t.isUndo=!1;break;case"PortCollectionChanged":t.isUndo=!0,this.recordPortCollectionChanged(t,r),t.isUndo=!1;break;case"Group":this.unGroup(t,r);break;case"UnGroup":this.group(t,r);break;case"SegmentChanged":this.recordSegmentChanged(o,r);break;case"PortPositionChanged":this.recordPortChanged(t,r,!1);break;case"AnnotationPropertyChanged":this.recordAnnotationChanged(t,r,!1);break;case"ChildCollectionChanged":this.recordChildCollectionChanged(t,r,!1);break;case"StackChildPositionChanged":this.recordStackPositionChanged(t,r,!1);break;case"RowHeightChanged":this.recordGridSizeChanged(t,r,!1,!0);break;case"ColumnWidthChanged":this.recordGridSizeChanged(t,r,!1,!1);break;case"LanePositionChanged":this.recordLanePositionChanged(t,r,!1);break;case"LaneCollectionChanged":case"PhaseCollectionChanged":t.isUndo=!0,this.recordLaneOrPhaseCollectionChanged(t,r,!1),t.isUndo=!1;break;case"SendToBack":case"SendForward":case"SendBackward":case"BringToFront":this.recordOrderCommandChanged(t,r,!1);break;case"AddChildToGroupNode":this.recordAddChildToGroupNode(t,r,!1)}if(r.diagramActions&=~e.DiagramAction.UndoRedo,r.protectPropertyChange(!1),r.historyChangeTrigger(t,"Undo"),n){var h=this.checkNodeObject(n,r);if(h){var d=Wh(r.updateSelection);d&&d(h,r)}}},t.prototype.checkNodeObject=function(e,t){var i;if(e.id)i=t.nameTable[e.id];else if(e.nodes&&e.nodes.length>0||e.connectors&&e.connectors.length>0)for(var r=0,o=e.nodes.length>0?e.nodes:e.connectors;r<o.length;r++)i=o[r],i=t.nameTable[i.id];else{var n=e.nodes?e.nodes:e.connectors;if(n)for(var a=0,s=Object.keys(n);a<s.length;a++){var h=s[a],d=Number(h);i=e.nodes?t.nodes[d]:t.connectors[d]}}return i},t.prototype.group=function(e,t){t.add(e.undoObject)},t.prototype.unGroup=function(e,t){e.redoObject=Ah(e.undoObject);var i=e.undoObject;t.commandHandler.unGroup(i)},t.prototype.ignoreProperty=function(e){return"zIndex"===e||"wrapper"===e||"parentObj"===e||"controlParent"===e},t.prototype.getProperty=function(e,t){for(var i=0,r=Object.keys(t);i<r.length;i++){var o=r[i];this.ignoreProperty(o)||(t[o]instanceof Object?this.getProperty(e[o],t[o]):e[o]=t[o])}},t.prototype.recordLaneOrPhaseCollectionChanged=function(e,t,i){var r=e.redoObject,o=e.undoObject;if("Remove"===(e.isUndo?"Insert"===e.changeType?"Remove":"Insert":e.changeType))t.remove(r);else if(r.isPhase){var n=t.nameTable[r.parentId];t.addPhases(n,[o])}else{var a=tn(n=t.nameTable[r.parentId],r);t.addLanes(n,[o],a)}t.clearSelection()},t.prototype.recordAnnotationChanged=function(e,t,i){var r=i?e.redoObject:e.undoObject;if(t.canEnableBlazorObject){var o=Ah(t.nameTable[r.id]);t.insertValue(o,o instanceof js)}var n=va(r,e.objectId),a=t.commandHandler.getAnnotationChanges(t.nameTable[r.id],n),s=t.nameTable[r.id],h=va(s,e.objectId);h.offset=n.offset,h.margin=n.margin,h.width=n.width,h.height=n.height,h.rotateAngle=n.rotateAngle,h.margin=n.margin,s instanceof js?t.nodePropertyChange(s,{},a):t.connectorPropertyChange(s,{},a)},t.prototype.recordChildCollectionChanged=function(e,t,i){var r=i?e.redoObject:e.undoObject,o=t.nameTable[r.parentId],n=t.nameTable[r.id];o?Mo(t,o,n,!i,"AddNodeToLane"===e.historyAction):(n.parentId&&((o=t.nameTable[n.parentId]).children.splice(o.children.indexOf(n.id),1),o.wrapper.children.splice(o.wrapper.children.indexOf(n.wrapper),1)),""!==r.parentId&&((o=t.nameTable[r.parentId]).children.push(r.id),o.wrapper.children.push(n.wrapper)),n.parentId=r.parentId,t.removeElements(n),t.updateDiagramObject(n))},t.prototype.recordStackPositionChanged=function(e,t,r){var o=r?e.redoObject:e.undoObject;if(o.source){var n=t.nameTable[o.source.parentId];n&&(o.target?(n.wrapper.children.splice(o.targetIndex,1),n.wrapper.children.splice(o.sourceIndex,0,o.source.wrapper)):void 0!==o.sourceIndex?(t.nameTable[o.source.id]||t.add(o.source),n.wrapper.children.splice(o.sourceIndex,0,t.nameTable[o.source.id].wrapper),t.nameTable[o.source.id].parentId=n.id):(n.wrapper.children.splice(n.wrapper.children.indexOf(t.nameTable[o.source.id].wrapper),1),t.nameTable[o.source.id].parentId=""),r&&"UmlClassifier"===n.shape.type&&t.remove(o.source),n.wrapper.measure(new i),n.wrapper.arrange(n.wrapper.desiredSize),t.updateDiagramObject(n),t.updateSelector())}},t.prototype.recordGridSizeChanged=function(e,t,i,r){var o=i?e.redoObject:e.undoObject,n=i?e.undoObject:e.redoObject;if(o.parentId){var a=t.nameTable[o.parentId],s=t.nameTable[o.id],h=a.wrapper.bounds.x,d=a.wrapper.bounds.y;if("SwimLane"===a.shape.type){var l=a.wrapper.children[0],c=a.shape.padding;en(t,n,a,o),r?(l.updateRowHeight(o.rowIndex,o.wrapper.actualSize.height,!0,c),a.height=a.wrapper.height=l.height):(l.updateColumnWidth(o.columnIndex,o.wrapper.actualSize.width,!0,c),a.width=a.wrapper.width=l.width,o.isPhase&&(s.maxWidth=s.wrapper.maxWidth=o.wrapper.actualSize.width)),Go(a);var p=h-a.wrapper.bounds.x,g=d-a.wrapper.bounds.y;t.drag(a,p,g),t.clearSelection(),t.updateDiagramObject(a)}}},t.prototype.recordLanePositionChanged=function(e,t,i){var r=i?e.redoObject:e.undoObject;if(r.source){var o=t.nameTable[r.source.parentId];o&&"SwimLane"===o.shape.type&&($o(t,r.target,r.source),t.clearSelection())}},t.prototype.recordPortChanged=function(e,t,i){var r=i?e.redoObject.nodes[0]:e.undoObject.nodes[0];if(t.canEnableBlazorObject){var o=Ah(t.nameTable[r.id]);t.insertValue(o,!0)}var n=ba(r,e.objectId),a=t.commandHandler.getPortChanges(t.nameTable[r.id],n),s=t.nameTable[r.id];ba(s,e.objectId).offset=n.offset,t.nodePropertyChange(s,{},a),s.parentId&&t.updateConnectorEdges(t.nameTable[s.parentId])},t.prototype.recordPropertyChanged=function(t,i,r){var o=t.redoObject,n=t.undoObject;if(sf.base.isBlazor())for(var a=0,s=Object.keys(n);a<s.length;a++){var h=void 0;switch(s[a]){case"nodes":for(var d=0,l=Object.keys(n.nodes);d<l.length;d++){var c=l[d];i.canEnableBlazorObject&&(h=Ah(i.nodes[Number(c)]),i.insertValue(h,!0))}break;case"connectors":for(var p=0,g=Object.keys(n.connectors);p<g.length;p++){c=g[p];i.canEnableBlazorObject&&(h=Ah(i.connectors[Number(c)]),i.insertValue(h,!1))}}}this.getProperty(i,r?o:n),r?i.onPropertyChanged(o,n):i.onPropertyChanged(n,o),i.diagramActions=i.diagramActions|e.DiagramAction.UndoRedo},t.prototype.recordOrderCommandChanged=function(t,i,r){var o=t.redoObject,n=t.undoObject;i.commandHandler.orderCommands(r,r?o:n,t.type),i.diagramActions=i.diagramActions|e.DiagramAction.UndoRedo},t.prototype.recordAddChildToGroupNode=function(e,t,i){var r=t.nameTable[e.undoObject.id],o=t.nameTable[e.objectId];i&&"Insert"===e.changeType&&t.addChildToGroup(r,o.id)},t.prototype.recordSegmentChanged=function(e,t){var i,r=0;if(e.connectors&&e.connectors.length>0)for(r=0;r<e.connectors.length;r++)i=e.connectors[r],this.segmentChanged(i,t)},t.prototype.segmentChanged=function(e,t){var i=t.nameTable[e.id];i.segments=e.segments,t.commandHandler.updateEndPoint(i)},t.prototype.recordPositionChanged=function(e,t){var i,r,o=0;if(e.nodes&&e.nodes.length>0)for(o=0;o<e.nodes.length;o++)i=e.nodes[o],this.positionChanged(i,t);if(e.connectors&&e.connectors.length>0)for(o=0;o<e.connectors.length;o++)r=e.connectors[o],this.connectionChanged(r,t)},t.prototype.positionChanged=function(e,t){var i=t.nameTable[e.id];if(e.processId&&!i.processId&&t.addProcess(e,e.processId),!e.processId&&i.processId&&t.removeProcess(e.id),i.processId){var r=e.margin.left-i.margin.left,o=e.margin.top-i.margin.top;t.drag(i,r,o)}else{if(i.parentId){var n=t.nameTable[i.parentId];n.isLane&&(e.wrapper.offsetX=e.width/2+(n.wrapper.bounds.x+e.margin.left),e.wrapper.offsetY=e.height/2+(n.wrapper.bounds.y+e.margin.top))}r=e.wrapper.offsetX-i.offsetX,o=e.wrapper.offsetY-i.offsetY;t.drag(i,r,o)}t.bpmnModule&&t.bpmnModule.updateDocks(i,t)},t.prototype.recordSizeChanged=function(e,t,i){var r,o,n=0;if(e&&e.nodes&&e.nodes.length>0)for(n=0;n<e.nodes.length;n++)if((o=e.nodes[n]).children&&!o.container)for(var a=t.commandHandler.getAllDescendants(o,[]),s=0;s<a.length;s++){var h=i.childTable[a[s].id];Ea(h)===js?(this.sizeChanged(h,t,i),this.positionChanged(h,t)):this.connectionChanged(h,t,i)}else this.sizeChanged(o,t),this.positionChanged(o,t);if(e&&e.connectors&&e.connectors.length>0){var d=e.connectors;for(n=0;n<d.length;n++)r=d[n],this.connectionChanged(r,t)}},t.prototype.sizeChanged=function(e,t,i){var r=t.nameTable[e.id],o=e.wrapper.actualSize.width/r.wrapper.actualSize.width,n=e.wrapper.actualSize.height/r.wrapper.actualSize.height;i&&i.childTable&&(i.childTable[e.id]=Ah(r)),t.scale(r,o,n,{x:e.wrapper.offsetX/r.wrapper.offsetX,y:e.wrapper.offsetY/r.wrapper.offsetY})},t.prototype.recordRotationChanged=function(e,t,i){var r,o,n=0,a=t.selectedItems;if(a.rotateAngle=e.rotateAngle,a&&a.wrapper&&(a.wrapper.rotateAngle=e.rotateAngle),e&&e.nodes&&e.nodes.length>0)for(n=0;n<e.nodes.length;n++)r=e.nodes[n],this.rotationChanged(r,t),this.positionChanged(r,t);if(e&&e.connectors&&e.connectors.length>0)for(n=0;n<e.connectors.length;n++)o=e.connectors[n],this.connectionChanged(o,t)},t.prototype.rotationChanged=function(e,t){var i=t.nameTable[e.id];t.rotate(i,e.rotateAngle-i.rotateAngle)},t.prototype.recordConnectionChanged=function(e,t){var i=e.connectors[0];i.sourceID&&t.nameTable[i.sourceID]&&t.insertValue(t.nameTable[i.sourceID],!0),i.targetID&&t.nameTable[i.targetID]&&t.insertValue(t.nameTable[i.targetID],!0),this.connectionChanged(i,t)},t.prototype.connectionChanged=function(e,t,i){var r,o=t.nameTable[e.id];e.sourcePortID!==o.sourcePortID&&(t.removePortEdges(t.nameTable[o.sourceID],o.sourcePortID,o.id,!1),o.sourcePortID=e.sourcePortID,t.connectorPropertyChange(o,{},{sourcePortID:e.sourcePortID})),e.targetPortID!==o.targetPortID&&(t.removePortEdges(t.nameTable[o.targetID],o.targetPortID,o.id,!0),o.targetPortID=e.targetPortID,t.connectorPropertyChange(o,{},{targetPortID:e.targetPortID})),e.sourceID!==o.sourceID&&(""===e.sourceID?pa((r=t.nameTable[o.sourceID]).outEdges,e.id):((r=t.nameTable[e.sourceID]).outEdges.push(e.id),t.updatePortEdges(r,e,!1)),o.sourceID=e.sourceID,t.connectorPropertyChange(o,{},{sourceID:e.sourceID})),e.targetID!==o.targetID&&(""===e.targetID?pa((r=t.nameTable[o.targetID]).inEdges,e.id):((r=t.nameTable[e.targetID]).inEdges.push(e.id),t.updatePortEdges(r,e,!0)),o.targetID=e.targetID,t.connectorPropertyChange(o,{},{targetID:e.targetID})),i&&i.childTable&&(i.childTable[e.id]=Ah(o));var n=e.sourcePoint.x-o.sourcePoint.x,a=e.sourcePoint.y-o.sourcePoint.y;0===n&&0===a||t.dragSourceEnd(o,n,a);var s=e.targetPoint.x-o.targetPoint.x,h=e.targetPoint.y-o.targetPoint.y;0===s&&0===h||t.dragTargetEnd(o,s,h),t.updateSelector(),"SVG"!==t.mode&&t.refreshDiagramLayer()},t.prototype.recordCollectionChanged=function(e,t){var i=e.undoObject;if(e&&e.changeType){if("Remove"===(e.isUndo?"Insert"===e.changeType?"Remove":"Insert":e.changeType))i.nodeId?t.remove(t.nameTable[i.nodeId+"_textannotation_"+i.id]):(t.remove(i),t.clearSelectorLayer());else{if(t.clearSelectorLayer(),i.parentId){var r=t.nameTable[i.parentId];r?t.addChild(r,i):t.add(i)}else i.nodeId?t.addTextAnnotation(i,t.nameTable[i.nodeId]):t.nameTable[i.id]||(i&&i.shape&&"SwimLane"===i.shape.type&&e.isUndo&&cn(i,void 0,void 0,void 0,void 0,!0),t.add(i));i.processId&&t.nameTable[i.processId]&&t.addProcess(i,i.processId)}"SVG"!==t.mode&&t.refreshDiagramLayer()}},t.prototype.recordLabelCollectionChanged=function(e,t){var i=e.undoObject,r=e.redoObject,o=t.nameTable[r.id];if(e&&e.changeType){"Remove"===(e.isUndo?"Insert"===e.changeType?"Remove":"Insert":e.changeType)?(t.removeLabels(o,[i]),t.clearSelectorLayer()):(t.clearSelectorLayer(),t.addLabels(o,[i])),"SVG"!==t.mode&&t.refreshDiagramLayer()}},t.prototype.recordPortCollectionChanged=function(e,t){var i=e.undoObject,r=e.redoObject,o=t.nameTable[r.id];if(e&&e.changeType){"Remove"===(e.isUndo?"Insert"===e.changeType?"Remove":"Insert":e.changeType)?(t.removePorts(o,[i]),t.clearSelectorLayer()):(t.clearSelectorLayer(),t.addPorts(o,[i])),"SVG"!==t.mode&&t.refreshDiagramLayer()}},t.prototype.redo=function(t){var i=this.getRedoEntry(t),r=0;if(i)if("Internal"===i.category)"StartGroup"===i.type?(r++,this.groupUndo=!0,sf.base.isBlazor()&&(t.blazorActions|=e.BlazorAction.GroupingInProgress)):this.redoEntry(i,t),this.groupUndo&&(this.redoGroupAction(i,t,r),this.groupUndo=!1);else{sf.base.isBlazor()||t.historyManager.redo(i);var o={entryType:"redo",oldValue:i.redoObject,newValue:i.undoObject};sf.base.isBlazor()&&(o={entryType:"redo",oldValue:this.getHistoryChangeEvent(i.redoObject,i.blazorHistoryEntryType),newValue:this.getHistoryChangeEvent(i.undoObject,i.blazorHistoryEntryType)}),t.triggerEvent(e.DiagramEvent.historyStateChange,o)}},t.prototype.redoGroupAction=function(e,t,i){for(;0!==i;)this.redoEntry(e,t),"EndGroup"===(e=this.getRedoEntry(t)).type?i--:"StartGroup"===e.type&&i++;i=0},t.prototype.redoEntry=function(t,i){var r,o;if("PropertyChanged"!==t.type&&"CollectionChanged"!==t.type&&(r=t.redoObject,o=t.redoObject),i.diagramActions|=e.DiagramAction.UndoRedo,"StartGroup"!==t.type&&"EndGroup"!==t.type&&i.historyManager.redoStack.length>0){var n=i.historyManager.redoStack.splice(0,1);i.historyManager.undoStack.splice(0,0,n[0]),o=t.redoObject}switch(i.protectPropertyChange(!0),sf.base.isBlazor()&&t.next&&"EndGroup"===t.next.type&&(i.blazorActions&=~e.BlazorAction.GroupingInProgress),t.type){case"PositionChanged":case"Align":case"Distribute":this.recordPositionChanged(r,i);break;case"SizeChanged":case"Sizing":this.recordSizeChanged(r,i,t);break;case"RotationChanged":this.recordRotationChanged(r,i,t);break;case"ConnectionChanged":this.recordConnectionChanged(r,i);break;case"PropertyChanged":this.recordPropertyChanged(t,i,!0);break;case"CollectionChanged":this.recordCollectionChanged(t,i);break;case"LabelCollectionChanged":this.recordLabelCollectionChanged(t,i);break;case"PortCollectionChanged":this.recordPortCollectionChanged(t,i);break;case"Group":this.group(t,i);break;case"UnGroup":this.unGroup(t,i);break;case"SegmentChanged":this.recordSegmentChanged(r,i);break;case"PortPositionChanged":this.recordPortChanged(t,i,!0);break;case"AnnotationPropertyChanged":this.recordAnnotationChanged(t,i,!0);break;case"ChildCollectionChanged":this.recordChildCollectionChanged(t,i,!0);break;case"StackChildPositionChanged":this.recordStackPositionChanged(t,i,!0);break;case"RowHeightChanged":this.recordGridSizeChanged(t,i,!0,!0);break;case"ColumnWidthChanged":this.recordGridSizeChanged(t,i,!0,!1);break;case"LanePositionChanged":this.recordLanePositionChanged(t,i,!0);break;case"LaneCollectionChanged":case"PhaseCollectionChanged":this.recordLaneOrPhaseCollectionChanged(t,i,!0);break;case"SendToBack":case"SendForward":case"SendBackward":case"BringToFront":this.recordOrderCommandChanged(t,i,!0);break;case"AddChildToGroupNode":this.recordAddChildToGroupNode(t,i,!0)}if(i.protectPropertyChange(!1),i.diagramActions&=~e.DiagramAction.UndoRedo,i.historyChangeTrigger(t,"Redo"),o){var a=this.checkNodeObject(o,i);if(a){var s=Wh(i.updateSelection);s&&s(a,i)}}},t.prototype.getUndoEntry=function(e){var t,i=null,r=e.historyManager;return r.canUndo&&(i=r.currentEntry,(t=r.currentEntry.previous)?(r.currentEntry=t,r.canRedo||(r.canRedo=!0)):(r.canRedo=!0,r.canUndo=!1)),i},t.prototype.getRedoEntry=function(e){var t,i=null,r=e.historyManager;return r.canRedo&&((t=r.currentEntry.previous||r.canUndo?r.currentEntry.next:r.currentEntry)&&(r.currentEntry=t,r.canUndo||(r.canUndo=!0),t.next||(r.canRedo=!1,r.canUndo=!0)),i=r.currentEntry),i},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"UndoRedo"},t}(),Jl=function(){function t(){this.protectChange=!1}return t.prototype.expand=function(t,i,r,o){var n=this,a={},s=0;if(o.realActions=o.realActions|e.RealAction.AnimationClick,a[0]=setInterval((function(){return s++,n.layoutAnimation(i,a,6===s,o,r)}),20),r.isExpanded){var h=.2;this.protectChange=o.isProtectedOnChange,o.protectPropertyChange(!1);var d={};t&&(this.updateOpacity(r,h,o),d[0]=setInterval((function(){o.allowServerDataBinding=!1,h<=1?n.updateOpacity(r,h,o):clearInterval(d[0]),h+=.2,o.allowServerDataBinding=!0}),20))}},t.prototype.layoutAnimation=function(t,i,r,o,n){if(!r)for(var a=0;a<t.objects.length;a++){var s=o.nameTable[t.objects[a].id];s.offsetX+=t.objects[a].differenceX/5,s.offsetY+=t.objects[a].differenceY/5}if(r){clearInterval(i[0]),o.realActions=o.realActions&~e.RealAction.AnimationClick,o.refreshCanvasLayers(),o.protectPropertyChange(!0),o.triggerEvent(e.DiagramEvent.animationComplete,void 0),o.organizationalChartModule.isAnimation=!1,o.layout.fixedNode="",o.protectPropertyChange(this.protectChange);var h={element:_a(Ah(n)),state:!!n.isExpanded};o.triggerEvent(e.DiagramEvent.expandStateChange,h),o.lineRoutingModule&&o.constraints&e.DiagramConstraints.LineRouting&&o.resetSegments()}},t.prototype.updateOpacity=function(e,t,i){for(var r=0;r<e.outEdges.length;r++){var o=i.nameTable[e.outEdges[r]],n=i.nameTable[o.targetID];o.style.opacity=t;for(var a=0;a<o.wrapper.children.length;a++)o.wrapper.children[a].style.opacity=t,n.style.opacity=t,n.wrapper instanceof xe&&i.updateNodeProperty(n.wrapper,void 0,t);this.updateOpacity(n,t,i)}},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"LayoutAnimate"},t}(),$l=function(){function t(){this.size=20,this.intermediatePoints=[],this.gridCollection=[],this.startArray=[],this.targetGridCollection=[],this.sourceGridCollection=[],this.considerWalkable=[]}return t.prototype.lineRouting=function(e){var t=e.connectors.length;if(this.renderVirtualRegion(e),t>0)for(var i=0;i<t;i++){var r=e.connectors[i];"Orthogonal"===r.type&&r.visible&&this.refreshConnectorSegments(e,r,!0)}},t.prototype.renderVirtualRegion=function(e,t){var i=this.size;(e.spatialSearch.pageTop<0||e.spatialSearch.pageLeft<0)&&(i=this.size+this.size/2);var r=e.spatialSearch.pageRight+i,o=e.spatialSearch.pageBottom+i,n=e.spatialSearch.pageLeft-i,a=e.spatialSearch.pageTop-i;if(n=n<0?n-20:0,a=a<0?a-20:0,t&&(this.width!==r-n||this.height!==o-a||this.diagramStartX!==n||this.diagramStartY!==a)||void 0===t){this.width=r-n,this.height=o-a,this.diagramStartX=n,this.diagramStartY=a,this.gridCollection=[],this.noOfRows=this.width/this.size,this.noOfCols=this.height/this.size;for(var s=this.size,h=this.diagramStartX<0?this.diagramStartX:0,d=this.diagramStartY<0?this.diagramStartY:0,l=0;l<this.noOfCols;l++){for(var c=0;c<this.noOfRows;c++){0===l&&this.gridCollection.push([0]);var p={x:h,y:d,width:s,height:s,gridX:c,gridY:l,walkable:!0,tested:void 0,nodeId:[]};this.gridCollection[c][l]=p,h+=s}h=this.diagramStartX<0?this.diagramStartX:0,d+=s}}var g=this.findNodes(e.nodes);this.updateNodesInVirtualRegion(g)},t.prototype.findNodes=function(e){for(var t,i=[],r=0;r<e.length;r++)"SwimLane"===(t=e[r]).shape.type||t.isLane||t.isPhase||t.isHeader||!t.visible||i.push(t);return i},t.prototype.updateNodesInVirtualRegion=function(e){for(var t=this.size,i=this.diagramStartX<0?this.diagramStartX:0,r=this.diagramStartY<0?this.diagramStartY:0,o=0;o<this.noOfCols;o++){for(var n=0;n<this.noOfRows;n++){var a=this.gridCollection[n][o],s=new b(i,r,this.size,this.size),h=void 0,d=void 0;for(a.walkable=!0,a.tested=void 0,a.nodeId=[],d=0;d<e.length;d++)e[d].wrapper.bounds&&(h=this.intersectRect(s,e[d].wrapper.bounds)),h&&(a.nodeId.push(e[d].id),a.walkable=!1,""!==e[d].parentId&&(a.parentNodeId=e[d].parentId));i+=t}i=this.diagramStartX<0?this.diagramStartX:0,r+=t}},t.prototype.intersectRect=function(e,t){return!(t.left>=e.right||t.right<=e.left||t.top>=e.bottom||t.bottom<=e.top)},t.prototype.findEndPoint=function(e,t,i){var r,o;if(t&&""!==e.sourcePortID||!t&&""!==e.targetPortID){o=Ht(r=t?{x:e.sourcePortWrapper.offsetX,y:e.sourcePortWrapper.offsetY}:{x:e.targetPortWrapper.offsetX,y:e.targetPortWrapper.offsetY},void 0,t?e.sourceWrapper.bounds:e.targetWrapper.bounds);var n=t?e.sourcePortWrapper.bounds:e.targetPortWrapper.bounds;r=i?"Top"===o?{x:n.topCenter.x,y:n.topCenter.y}:"Left"===o?{x:n.middleLeft.x,y:n.middleLeft.y}:"Right"===o?{x:n.middleRight.x,y:n.middleRight.y}:{x:n.bottomCenter.x,y:n.bottomCenter.y}:{x:n.center.x,y:n.center.y}}else r=t&&this.startNode||!t&&this.targetNode?t?{x:this.startNode.wrapper.offsetX,y:this.startNode.wrapper.offsetY}:{x:this.targetNode.wrapper.offsetX,y:this.targetNode.wrapper.offsetY}:t?{x:e.sourcePoint.x,y:e.sourcePoint.y}:{x:e.targetPoint.x,y:e.targetPoint.y};return r},t.prototype.refreshConnectorSegments=function(t,i,r){var o,n,a,s,h,d,l,c,p,g,u,f=i.sourceID,m=i.targetID,y=i.sourcePortID,v=i.targetPortID;if(function(t,i){var r=0;return t.constraints&e.ConnectorConstraints.LineRouting?r=t.constraints&e.ConnectorConstraints.LineRouting:t.constraints&e.ConnectorConstraints.InheritLineRouting&&(r=i.constraints&e.DiagramConstraints.LineRouting),r}(i,t)){this.startNode=t.nameTable[f],this.targetNode=t.nameTable[m],this.intermediatePoints=[],this.startArray=[],this.targetGridCollection=[],this.sourceGridCollection=[],this.startGrid=void 0,this.targetGrid=void 0;for(var w=0;w<this.noOfCols;w++)for(var x=0;x<this.noOfRows;x++)this.gridCollection[x][w].tested=this.gridCollection[x][w].parent=void 0,this.gridCollection[x][w].previousDistance=this.gridCollection[x][w].afterDistance=void 0,this.gridCollection[x][w].totalDistance=void 0;o=this.findEndPoint(i,!0),n=this.findEndPoint(i,!1);for(w=0;w<this.noOfRows;w++)for(x=0;x<this.noOfCols;x++){a=this.gridCollection[w][x];var C=new b(a.x,a.y,a.width,a.height);if(!C.containsPoint(o)||this.startGrid||-1===a.nodeId.indexOf(f)&&""!==f||(this.startGrid=(y&&this.startGrid,a)),!C.containsPoint(n)||this.targetGrid||-1===a.nodeId.indexOf(m)&&""!==m||(this.targetGrid=(v&&this.targetGrid,a)),!y&&this.startNode){var S=this.startNode.wrapper.bounds;C.containsPoint(S.topCenter)&&!s&&(s=a),C.containsPoint(S.middleLeft)&&!d&&(d=a),C.containsPoint(S.middleRight)&&!l&&(l=a),C.containsPoint(S.bottomCenter)&&!h&&(h=a)}if(!v&&this.targetNode){S=this.targetNode.wrapper.bounds;C.containsPoint(S.topCenter)&&!p&&(p=a),C.containsPoint(S.middleLeft)&&!u&&(u=a),C.containsPoint(S.middleRight)&&!c&&(c=a),C.containsPoint({x:S.bottomCenter.x,y:S.bottomCenter.y})&&!g&&(g=a)}}this.findEdgeBoundary(y,d,l,s,h,!0),this.findEdgeBoundary(v,u,c,p,g,!1),this.startGrid.totalDistance=0,this.startGrid.previousDistance=0,this.intermediatePoints.push({x:this.startGrid.gridX,y:this.startGrid.gridY}),this.startArray.push(this.startGrid),this.checkObstacles(i,t,u,c,p,g);e:for(;this.startArray.length>0;){var P=this.startArray.pop();for(w=0;w<this.targetGridCollection.length;w++){var T=this.targetGridCollection[w];if(P.gridX===T.gridX&&P.gridY===T.gridY){if(this.getIntermediatePoints(P),this.updateConnectorSegments(t,this.intermediatePoints,this.gridCollection,i,r)){this.considerWalkable=[];break e}this.targetGridCollection.splice(this.targetGridCollection.indexOf(T),1),P=this.startArray.pop()}}this.findPath(P)}}},t.prototype.checkChildNodes=function(e,t){var i=!1,r=!1;if(e.nodeId.length>=1&&!t)for(var o=0;o<e.nodeId.length;o++){for(var n=e.nodeId[o],a=0;a<e.nodeId.length;a++)this.targetNode.parentId===e.nodeId[a]&&(r=!0);i=!r&&this.targetNode.id===n}else 1===e.nodeId.length&&(i=!0);return i},t.prototype.findEdgeBoundary=function(e,t,i,r,o,n){var a,s=n?this.sourceGridCollection:this.targetGridCollection;if(!e&&(n?this.startNode:this.targetNode)){for(var h=t.gridX;h<=i.gridX;h++)a=this.gridCollection[h][t.gridY],(this.checkChildNodes(a,n)&&(h===t.gridX||h===i.gridX)||h!==t.gridX&&h!==i.gridX)&&s.push(a);for(h=r.gridY;h<=o.gridY;h++)a=this.gridCollection[r.gridX][h],(this.checkChildNodes(a,n)&&(h===r.gridY||h===o.gridY)||h!==r.gridY&&h!==o.gridY)&&-1===s.indexOf(a)&&s.push(a)}else s.push(n?this.startGrid:this.targetGrid)},t.prototype.checkObstacles=function(e,t,i,r,o,n){var a,s=this.findNearestNeigbours(this.startGrid,this.gridCollection,!0);0===s.length&&(""!==e.sourcePortID?"Top"===(a=Ht({x:e.sourcePortWrapper.offsetX,y:e.sourcePortWrapper.offsetY},void 0,e.sourceWrapper.bounds))?this.resetGridColl(this.startGrid,"top",!0):"Right"===a?this.resetGridColl(this.startGrid,"right",!0):"Bottom"===a?this.resetGridColl(this.startGrid,"bottom",!0):this.resetGridColl(this.startGrid,"left",!0):(this.resetGridColl(this.startGrid,"top",!0),this.resetGridColl(this.startGrid,"right",!0),this.resetGridColl(this.startGrid,"bottom",!0),this.resetGridColl(this.startGrid,"left",!0)));0===(s=this.findNearestNeigbours(this.targetGrid,this.gridCollection,!1)).length&&(""!==e.targetPortID?"Top"===(a=Ht({x:e.targetPortWrapper.offsetX,y:e.targetPortWrapper.offsetY},void 0,e.targetWrapper.bounds))?this.resetGridColl(this.targetGrid,"top",!0):"Right"===a?this.resetGridColl(this.targetGrid,"right",!0):"Bottom"===a?this.resetGridColl(this.targetGrid,"bottom",!0):this.resetGridColl(this.targetGrid,"left",!0):(this.resetGridColl(this.targetGrid,"top",!1),this.resetGridColl(this.targetGrid,"right",!1),this.resetGridColl(this.targetGrid,"bottom",!1),this.resetGridColl(this.targetGrid,"left",!1)));if(this.targetGridCollection.length>0&&this.targetGridCollection[0].nodeId.length>1)for(var h=0;h<=1;h++){for(var d=this.targetGridCollection[h].gridX,l=this.targetGridCollection[h].gridY,c=this.targetGridCollection[h].nodeId,p=void 0,g=0;g<c.length;g++)if(this.targetNode.id!=c[g]){p=c[g];break}var u=void 0,f=void 0,m=void 0;t.nameTable[this.targetNode.id]&&(u=t.nameTable[this.targetNode.id].wrapper),t.nameTable[p]&&(f=t.nameTable[p].wrapper),u&&f&&(m=this.contains(f.bounds,u.bounds));for(var y=void 0,v=0;v<c.length;v++)this.targetNode.parentId===c[v]&&(y=!0);if(!this.gridCollection[d][l].walkable&&m&&!y){var b=void 0,w=void 0;b=this.getEndvalue(i,"left"),w=i.gridX-b.gridX,this.changeValue(i,w,"left"),w=(b=this.getEndvalue(r,"right")).gridX-r.gridX,this.changeValue(r,w,"right"),b=this.getEndvalue(o,"top"),w=o.gridY-b.gridY,this.changeValue(o,w,"top"),b=this.getEndvalue(n,"bottom"),w=n.gridY-b.gridY,this.changeValue(n,w,"top")}}},t.prototype.contains=function(e,t){return e.left<=t.left&&e.right>=t.right&&e.top<=t.top&&e.bottom>=t.bottom},t.prototype.getEndvalue=function(e,t){return this.gridCollection[e.gridX][e.gridY].walkable?e:"left"===t?this.getEndvalue(this.gridCollection[e.gridX-1][e.gridY],t):"right"===t?this.getEndvalue(this.gridCollection[e.gridX+1][e.gridY],t):"top"===t?this.getEndvalue(this.gridCollection[e.gridX][e.gridY-1],t):"bottom"===t?this.getEndvalue(this.gridCollection[e.gridX][e.gridY+1],t):e},t.prototype.changeValue=function(e,t,i){var r;e.walkable||this.considerWalkable.push(e);for(var o=0;o<=t;o++)"left"===i?r=this.gridCollection[e.gridX-o][e.gridY]:"right"===i?r=this.gridCollection[e.gridX+o][e.gridY]:"top"===i?r=this.gridCollection[e.gridX][e.gridY-o]:"bottom"===i&&(r=this.gridCollection[e.gridX][e.gridY+o]),r.walkable||this.considerWalkable.push(r)},t.prototype.getIntermediatePoints=function(e){var t;for(this.intermediatePoints=[];e;)this.intermediatePoints.push({x:e.gridX,y:e.gridY}),e=e.parent;this.intermediatePoints.reverse(),this.intermediatePoints[0].x===this.intermediatePoints[1].x?this.intermediatePoints[0].y<this.intermediatePoints[1].y?(t=this.neigbour(this.startGrid,"bottom",void 0,!0),this.intermediatePoints[0].y+=t-1):(t=this.neigbour(this.startGrid,"top",void 0,!0),this.intermediatePoints[0].y-=t-1):this.intermediatePoints[0].x<this.intermediatePoints[1].x?(t=this.neigbour(this.startGrid,"right",void 0,!0),this.intermediatePoints[0].x+=t-1):(t=this.neigbour(this.startGrid,"left",void 0,!0),this.intermediatePoints[0].x-=t-1)},t.prototype.updateConnectorSegments=function(e,t,i,r,o){var n,a,s,h,d,l,c,p,g,u=[],f=[],m=r.targetWrapper,y=r.sourceWrapper,v=this.findEndPoint(r,!0);""===r.targetPortID&&r.targetWrapper||(a=this.findEndPoint(r,!1,!0));for(var b=0;b<t.length;b++)s=(d=i[t[b].x][t[b].y]).x+d.width/2,h=d.y+d.height/2,f.push({x:s,y:h}),b>=1&&(p=f[f.length-2].x!==f[f.length-1].x?f[f.length-2].x>f[f.length-1].x?"Left":"Right":f[f.length-2].y>f[f.length-1].y?"Top":"Bottom"),b>=2&&g===p&&f.splice(f.length-2,1),g=p;for(var w=0;w<f.length-1;w++)f[w].x!==f[w+1].x?(0===w&&""===r.sourcePortID&&y&&(v=f[w].x>f[w+1].x?y.bounds.middleLeft:y.bounds.middleRight),w===f.length-2&&""===r.targetPortID&&m&&(a=f[w].x>f[w+1].x?m.bounds.middleRight:m.bounds.middleLeft),0===w&&v&&(f[w].x=v.x,f[w].y=f[w+1].y=v.y),w===f.length-2&&a&&(a.x-f[w+1].x<0&&Math.abs(a.x-f[w].x)<r.targetDecorator.width+1&&(f[w].x=f[w-1].x-=this.size/2),a.x-f[w+1].x>0&&Math.abs(a.x-f[w].x)<r.targetDecorator.width+1&&(f[w].x=f[w-1].x+=this.size/2),f[w+1].x=a.x,f[w].y=f[w+1].y=a.y)):(0===w&&y&&(v=f[w].y>f[w+1].y?y.bounds.topCenter:y.bounds.bottomCenter),w===f.length-2&&""===r.targetPortID&&m&&(a=f[w].y>f[w+1].y?m.bounds.bottomCenter:m.bounds.topCenter),0===w&&v&&(f[w].y=v.y,f[w].x=f[w+1].x=v.x),w===f.length-2&&a&&(a.y-f[w+1].y<0&&Math.abs(a.y-f[w].y)<r.targetDecorator.height+1&&(f[w].y=f[w-1].y-=this.size/2),a.y-f[w+1].y>0&&Math.abs(a.y-f[w].y)<r.targetDecorator.width+1&&(f[w].y=f[w-1].y+=this.size/2),f[w+1].y=a.y,f[w].x=f[w+1].x=a.x));for(w=0;w<f.length-1;w++)f[w].x!==f[w+1].x?f[w].x>f[w+1].x?(l="Left",c=f[w].x-f[w+1].x):(l="Right",c=f[w+1].x-f[w].x):f[w].y>f[w+1].y?(l="Top",c=f[w].y-f[w+1].y):(l="Bottom",c=f[w+1].y-f[w].y),n={type:"Orthogonal",length:c,direction:l},u.push(n);var x=u[u.length-1];return 1===u.length&&(x.length-=20),x.length<10&&2===u.length&&(u.pop(),u[0].length-=20,x=u[0]),(("Top"===x.direction||"Bottom"===x.direction)&&x.length>r.targetDecorator.height+1||("Right"===x.direction||"Left"===x.direction)&&x.length>r.targetDecorator.width+1)&&(r.segments=u,o&&e.connectorPropertyChange(r,{},{type:"Orthogonal",segments:u}),!0)},t.prototype.findPath=function(e){for(var t,i=[],r=this.findNearestNeigbours(e,this.gridCollection,!0),o=0;o<r.length;o++)if(null!==(t=this.findIntermediatePoints(r[o].gridX,r[o].gridY,e.gridX,e.gridY,this.targetGrid.gridX,this.targetGrid.gridY))){var n=this.gridCollection[t.x][t.y],a=this.octile(Math.abs(t.x-e.gridX),Math.abs(t.y-e.gridY)),s=e.previousDistance+a;n.previousDistance&&!(n.previousDistance>s)||t.x===e.gridX&&t.y===e.gridY||(i.push(t),n.previousDistance=s,n.afterDistance=n.afterDistance||this.manhattan(Math.abs(t.x-this.targetGrid.gridX),Math.abs(t.y-this.targetGrid.gridY)),n.totalDistance=n.previousDistance+n.afterDistance,n.parent=e)}if(i.length>0)for(o=0;o<i.length;o++){n=this.gridCollection[i[o].x][i[o].y];-1===this.startArray.indexOf(n)&&this.startArray.push(n)}this.sorting(this.startArray)},t.prototype.sorting=function(e){for(var t=!1;!t;){t=!0;for(var i=1;i<e.length;i+=1)if(e[i-1].totalDistance<e[i].totalDistance){t=!1;var r=e[i-1];e[i-1]=e[i],e[i]=r}}return e},t.prototype.octile=function(e,t){var i=Math.SQRT2-1;return t>e?i*e+t:i*t+e},t.prototype.manhattan=function(e,t){return e+t},t.prototype.findNearestNeigbours=function(e,t,i){var r=[],o=e.parent;if(o){var n=(e.gridX-o.gridX)/Math.max(Math.abs(e.gridX-o.gridX),1),a=(e.gridY-o.gridY)/Math.max(Math.abs(e.gridY-o.gridY),1);0!==n?(this.isWalkable(e.gridX,e.gridY-1,!0)&&-1===this.sourceGridCollection.indexOf(t[e.gridX][e.gridY-1])&&r.push(t[e.gridX][e.gridY-1]),this.isWalkable(e.gridX,e.gridY+1,!0)&&this.sourceGridCollection.indexOf(t[e.gridX][e.gridY+1])&&r.push(t[e.gridX][e.gridY+1]),this.isWalkable(e.gridX+n,e.gridY,!0)&&-1===this.sourceGridCollection.indexOf(t[e.gridX+n][e.gridY])&&r.push(t[e.gridX+n][e.gridY])):0!==a&&(this.isWalkable(e.gridX-1,e.gridY,!0)&&-1===this.sourceGridCollection.indexOf(t[e.gridX-1][e.gridY])&&r.push(t[e.gridX-1][e.gridY]),this.isWalkable(e.gridX+1,e.gridY,!0)&&-1===this.sourceGridCollection.indexOf(t[e.gridX+1][e.gridY])&&r.push(t[e.gridX+1][e.gridY]),this.isWalkable(e.gridX,e.gridY+a,!0)&&-1===this.sourceGridCollection.indexOf(t[e.gridX][e.gridY+a])&&r.push(t[e.gridX][e.gridY+a]))}else this.neigbour(e,"top",r,i),this.neigbour(e,"right",r,i),this.neigbour(e,"bottom",r,i),this.neigbour(e,"left",r,i);return r},t.prototype.neigbour=function(e,t,i,r){for(var o,n=1;n>0;){var a="top"===t||"bottom"===t?e.gridX:"left"===t?e.gridX-n:e.gridX+n,s="right"===t||"left"===t?e.gridY:"top"===t?e.gridY-n:e.gridY+n;if((o=this.gridCollection[a][s])&&(r&&-1===this.sourceGridCollection.indexOf(o)||!r&&-1===this.targetGridCollection.indexOf(o)))return i&&this.isWalkable(a,s)&&i.push(o),n;if(!(a>0&&s>0))break;n++}return null},t.prototype.resetGridColl=function(e,t,i){for(var r,o=1;o>0;){var n="top"===t||"bottom"===t?e.gridX:"left"===t?e.gridX-o:e.gridX+o,a="right"===t||"left"===t?e.gridY:"top"===t?e.gridY-o:e.gridY+o;if((r=this.gridCollection[n][a])&&(i&&-1===this.sourceGridCollection.indexOf(r)||!i&&-1===this.targetGridCollection.indexOf(r))){if(this.isWalkable(n,a))break;var s=this.gridCollection[n][a];this.considerWalkable.push(s)}if(!(n>0&&a>0))break;"top"===t||"left"===t?o--:o++}return null},t.prototype.isWalkable=function(e,t,i){if(e>=0&&e<this.noOfRows&&t>=0&&t<this.noOfCols){var r=this.gridCollection[e][t];if(r&&(r.walkable||(1===r.nodeId.length||2===r.nodeId.length&&r.parentNodeId||-1!==this.considerWalkable.indexOf(r))&&(-1!==this.sourceGridCollection.indexOf(r)||-1!==this.targetGridCollection.indexOf(r)||-1!==this.considerWalkable.indexOf(r)))&&(i&&!r.parent||!i))return!0}return!1},t.prototype.findIntermediatePoints=function(e,t,i,r,o,n){for(var a=e-i,s=t-r,h=e,d=t,l=0;l<this.targetGridCollection.length;l++)if(e===this.targetGridCollection[l].gridX&&t===this.targetGridCollection[l].gridY)return{x:e,y:t};if(!this.isWalkable(e,t))return null;var c=this.gridCollection[e][t];if(c.tested)return{x:e,y:t};if(c.tested=!0,0!==a&&(a=a>0?1:-1,this.isWalkable(h,d-1)&&!this.isWalkable(h-a,d-1)||this.isWalkable(h,d+1)&&!this.isWalkable(h-a,d+1)))return{x:e,y:t};if(0!==s){if(s=s>0?1:-1,this.isWalkable(h-1,d)&&!this.isWalkable(h-1,d-s)||this.isWalkable(h+1,d)&&!this.isWalkable(h+1,d-s))return{x:e,y:t};if(this.findIntermediatePoints(h+1,d,h,d,o,n)||this.findIntermediatePoints(h-1,d,h,d,o,n))return{x:e,y:t}}return this.findIntermediatePoints(h+a,d+s,h,d,o,n)},t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"LineRouting"},t}(),ec=function(){function e(){}return e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"LineDistribution"},e.prototype.initLineDistribution=function(e,t){var i="Bottom";if(this.diagram=t,"DifferentPoint"===t.layout.connectionPointOrigin||t.layout.enableRouting){var r="Top";"BottomToTop"===e.orientation?(i="Top",r="Bottom"):"RightToLeft"===e.orientation?(i="Left",r="Right"):"LeftToRight"===e.orientation&&(i="Right",r="Left");var o=t.nodes;if(o.length>0)for(var n=0;n<o.length;n++){var a=t.nameTable[o[n].id];this.addDynamicPortandDistrrbuteLine(e,a,i,r,t)}}},e.prototype.ObstacleSegment=function(e){return e.direction=Ha(e.startpt,e.endpt),e.distance=a.findLength(e.startpt,e.endpt),e.orientation="Left"===e.direction||"Right"===e.direction?"horizontal":"vertical",e.id=e.id,"horizontal"===e.orientation?(e.coord=e.startpt.y,"Left"===e.direction?(e.start=e.endpt.x,e.end=e.startpt.x):(e.start=e.startpt.x,e.end=e.endpt.x)):(e.coord=e.startpt.x,"Top"===e.direction?(e.start=e.endpt.y,e.end=e.startpt.y):(e.start=e.startpt.y,e.end=e.endpt.y)),e},e.prototype.distributeLines=function(e,t){for(var i="LeftToRight"===e.orientation||"RightToLeft"===e.orientation,r=(i?e.horizontalSpacing:e.verticalSpacing)-8-10,o=[],n=[],s=t.connectors,h=0;h<s.length;h++){for(var d=s[h],l=[],c=0;c<d.segments.length;c++)for(var p=d.segments[c],g=0;g<p.points.length;g++){var u=p.points[g];0!==l.length&&a.equals(u,l[l.length-1])||l.push(u)}for(var f=[],m=1;m<l.length;m++){var y=this.ObstacleSegment({startpt:l[m-1],endpt:l[m],id:d.id});f.push(y)}var v={wrapper:d,segments:f},b=[];if(i)for(c=0;c<v.segments.length;c++){"vertical"===(y=v.segments[c]).orientation&&b.push(y)}else for(var c=0;c<v.segments.length;c++){"horizontal"===(y=v.segments[c]).orientation&&b.push(y)}for(m=0;m<b.length;m++){var w=b[m];this.containsValue(o,w.coord)||o.push({key:w.coord,value:[]});var x=void 0;for(g=0;g<o.length;g++){c=o[g].key;if(Number(c)===w.coord){x=g;break}}o[x].value.push(w)}n.push(v)}for(var C=[],S=0;S<o.length;S++){var P=o[S],T=P.value;T.sort();var A=void 0;A=[];x=0;var z=Number.MIN_VALUE;A.push([]);for(var O=0;O<T.length;O++){w=T[O];!(A[x].length>0)||z>=w.start?(A[x].push(w),z=Math.max(z,A[x][A[x].length-1].end)):(x++,A.push([]),A[x].push(w),z=A[x][A[x].length-1].end)}for(O=0;O<A.length;O++){var I=A[O],D=[];for(m=0;m<I.length;m++){(M=I[m]).start&&D.push(M)}var E=i?"Bottom":"Right",B=[];for(m=0;m<D.length;m++){(M=D[m]).direction===E&&B.push(M)}var L=[];for(m=0;m<D.length;m++){var M;(M=D[m]).direction!==E&&L.push(M)}var k=[];if(B.length>0){var R=B[0].start;for(m=0;m<L.length;)L[m].end>R?(k.push(L[m]),L.splice(m,1)):m++}var N=[];N=this.updateSegmentRow(k,N);var j=[];j=[],j=this.updateSegmentRow(L,j),B.reverse(),j=this.updateSegmentRow(B,j),N[N.length-1].length>0||N.splice(N.length-1,1),j[j.length-1].length>0||j.splice(j.length-1,1);var H=[];if(k.length>0&&(D[0].direction===k[0].direction||D[D.length-1].direction===k[k.length-1].direction)){H=j;for(var W=0;W<N.length;W++){var _=N[W];H[H.length]=_}}else{H=N;for(W=0;W<j.length;W++){_=j[W];H[H.length]=_}}if(H.length>1){var V=1;"BottomToTop"!==e.orientation&&"RightToLeft"!==e.orientation||(V=-1);var X=P.key-V*r/2,Y=r/H.length;for(h=0;h<H.length;h++){var U=X+h*Y*V;for(W=0;W<H[h].length;W++){(w=H[h][W]).coord=U,this.containsValue(C,w.coord)||C.push({key:w.coord,value:[]});var G=void 0;for(g=0;g<C.length;g++){if(C[g].key===w.coord){G=g;break}}C[G].value.push(w)}}}}}for(S=0;S<n.length;S++){for(v=n[S],l=[],h=0;h<v.segments.length;h++)0===h?l.push(this.getObstacleStartPoint(v.segments[h])):i?"vertical"===v.segments[h].orientation&&(l[l.length-1]=this.getObstacleStartPoint(v.segments[h])):i||"horizontal"===v.segments[h].orientation&&(l[l.length-1]=this.getObstacleStartPoint(v.segments[h])),l.push(this.getObstacleEndPoint(v.segments[h]));v.wrapper.obstaclePointCollection=[];for(m=0;m<l.length;m++){var F=l[m];(0===m||m>0&&!a.equals(F,l[m-1]))&&v.wrapper.obstaclePointCollection.push(this.getPointvalue(F.x,F.y))}this.resetConnectorPoints(v.wrapper,t)}},e.prototype.inflate=function(e,t,i){return e.x-=t,e.y-=i,e.width+=2*t,e.height+=2*i,e},e.prototype.updateConnectorPoints=function(e,t,i,r,o){var n=r,s="LeftToRight"===o||"RightToLeft"===o,h=e;if(h.length>2){var d=a.transform(h[0],a.findAngle(h[0],h[1]),t),l=a.transform(d,a.findAngle(h[1],h[2]),a.findLength(h[1],h[2]));if(h.splice(1,2,d,l),null!=i){var c=h.length,p=a.transform(h[c-1],a.findAngle(h[c-1],h[c-2]),t);for(h.splice(c-1,0,p);2<h.length-2;)h.splice(2,1);var g=i;this.inflate(n,n.width,n.height);var u=[];u[0]=this.getPointvalue(g.x,n.y),u[1]=this.getPointvalue(g.x,n.y+n.height);var f=[];f[0]=this.getPointvalue(n.x,h[1].y),f[1]=this.getPointvalue(n.x+n.width,h[1].y);var m=[];m[0]=this.getPointvalue(n.x,p.y),m[1]=this.getPointvalue(n.x+n.width,p.y),s&&(u[0]=this.getPointvalue(n.x,g.y),u[1]=this.getPointvalue(n.x+n.width,g.y),f[0]=this.getPointvalue(h[1].x,n.y),f[1]=this.getPointvalue(h[1].x,n.y+n.height),m[0]=this.getPointvalue(p.x,n.y),f[1]=this.getPointvalue(p.x,n.y+n.height));var y=[Nn(u[0],u[1],f[0],f[1])],v=[Nn(u[0],u[1],m[0],m[1])];v.length>0&&h.splice(2,0,v[0]),y.length>0&&h.splice(2,0,y[0])}}for(var b=1;b<h.length-1;)a.equals(h[b-1],h[b])||a.findAngle(h[b-1],h[b])===a.findAngle(h[b],h[b+1])?h.splice(b,1):b++;return h},e.prototype.resetConnectorPoints=function(e,t){var i="obstaclePointCollection";if(e.segments[0].points&&e.segments[0].points.length>0&&e[i]){var r=e;r.sourcePoint=e[i][0],r.targetPoint=e[i][e[i].length-1];var o=void 0;o=[];for(var n=0;n<e[i].length-1;n++){var a=e[i][n],s=e[i][n+1],h=Wa(a,s),d=Ha(a,s);n===e[i].length-2&&("RightToLeft"===t.layout.orientation&&"Left"===d||"LeftToRight"===t.layout.orientation&&"Right"===d||"TopToBottom"===t.layout.orientation&&"Bottom"===d||"BottomToTop"===t.layout.orientation&&"Top"===d)&&(h/=2);var l=new hr(e,"segments",{type:"Orthogonal"},!0);l.length=h,l.direction=d,o.push(l)}r.segments=o,r.type="Orthogonal",t.connectorPropertyChange(r,{},{type:"Orthogonal",segments:r.segments})}},e.prototype.getObstacleEndPoint=function(e){return"horizontal"===e.orientation?"Left"===e.direction?this.getPointvalue(e.start,e.coord):this.getPointvalue(e.end,e.coord):"Top"===e.direction?this.getPointvalue(e.coord,e.start):this.getPointvalue(e.coord,e.end)},e.prototype.getObstacleStartPoint=function(e){return"horizontal"===e.orientation?"Left"===e.direction?this.getPointvalue(e.end,e.coord):this.getPointvalue(e.start,e.coord):"Top"===e.direction?this.getPointvalue(e.coord,e.end):this.getPointvalue(e.coord,e.start)},e.prototype.updateSegmentRow=function(e,t){var i=0;t.length>0||(t[0]=[]);for(var r=0;r<e.length;r++)for(var o=e[r];i<t.length;){if(i===t.length-1&&(t[i+1]=[]),!(t[i].length>0)||t[i][t[i].length-1].end<o.start){t[i].push(o);break}i++}return t},e.prototype.portOffsetCalculation=function(e,t,i,r){"Top"===i&&(e.offset={x:(r+1)*(1/(t+1)),y:0}),"Bottom"===i&&(e.offset={x:(r+1)*(1/(t+1)),y:1}),"Left"===i&&(e.offset={x:0,y:(r+1)*(1/(t+1))}),"Right"===i&&(e.offset={x:1,y:(r+1)*(1/(t+1))})},e.prototype.addDynamicPortandDistrrbuteLine=function(e,t,i,r,o){if(t.ports&&t.ports.length>0){var n=t.ports;o.removePorts(t,n)}t.ports;var a=t.outEdges,s=t.inEdges;this.initPort(a,o,t,i,!1),this.initPort(s,o,t,r,!0)},e.prototype.initPort=function(e,t,i,r,o){for(var n=0;n<=e.length-1;n++){var a=t.nameTable[e[n]];a.obstaclePointCollection=[];var s=ba(i,o?a.targetPortID:a.sourcePortID),h=r;void 0===s&&((s=new Ve(i,"ports","",!0)).id=xh()+"_LineDistribution",o?a.targetPortID=s.id:a.sourcePortID=s.id),this.portOffsetCalculation(s,e.length,h,n),i.ports.push(s);var d=i.initPortWrapper(i.ports[i.ports.length-1]);i.wrapper.children.push(d),t.connectorPropertyChange(a,o?{targetPortID:""}:{sourcePortID:""},o?{targetPortID:s.id}:{sourcePortID:s.id})}},e.prototype.shiftMatrixCells=function(e,t,i,r,o){if(0!==e){for(var n=o.matrix[t.level].value,a=n.indexOf(t),s=a;s<n.length;s++)n[s].offset+=e;if(i)if(t.visitedChildren.length>0)this.shiftMatrixCells(e,t.visitedChildren[0],!0,t,o);else{s=1;for(var h=null;a+s<n.length;){var d=n[a+s];if(null!=r&&this.containsValue(d.visitedParents,r)){if(!(d.visitedChildren.length>0)){s++;continue}h=d}break}null!=h&&this.shiftMatrixCells(e,h.visitedChildren[0],!0,h,o)}}},e.prototype.arrangeMatrix=function(e,t,i){var r=i.model.layout,o="LeftToRight"===r.orientation||"RightToLeft"===r.orientation?r.verticalSpacing:r.horizontalSpacing,n=i.matrix[e.level].value,a=n.indexOf(e);if(e.visitedParents.length>0&&(1===e.visitedParents.length&&(e.initialOffset=e.offset),a+1<n.length&&n[a+1].visitedParents.length>0&&!this.containsValue(e.visitedParents,t)))return e.visitedParents.push(t),void t.ignoredChildren.push(e);if(e.children.length>0){for(var s=0;s<e.children.length;s++){var h=e.children[s];this.containsValue(e.visitedChildren,h)||(this.arrangeMatrix(h,e,i),e.visitedChildren.push(h))}if(e.visitedChildren.length>0){var d=e.visitedChildren.slice();for(s=0;s<e.ignoredChildren.length;s++)d.splice(0,1),e.visitedChildren.splice(0,1);if(d.length>0){var l=e.visitedChildren[0],c=e.visitedChildren[e.visitedChildren.length-1],p=(l.offset-l.size/2+(c.offset+c.size/2))/2;p<e.offset?this.shiftMatrixCells(e.offset-p,l,!0,e,i):p>e.offset&&this.shiftMatrixCells(p-e.offset,e,!1,null,i)}}}else{var g=e.offset;if(a>0){var u=n[a-1];g=u.offset+u.size/2+o+e.size/2}this.shiftMatrixCells(g-e.offset,e,!1,null,i)}this.containsValue(e.visitedParents,t)||e.visitedParents.push(t)},e.prototype.getFixedTerminalPoint=function(){return null},e.prototype.setAbsoluteTerminalPoint=function(e,t,i){t?(null==i.absolutePoints&&(i.absolutePoints=[]),0===i.absolutePoints.length?i.absolutePoints.push(e):i.absolutePoints[0]=e):null==i.absolutePoints?(i.absolutePoints=[],i.absolutePoints.push(null),i.absolutePoints.push(e)):1===i.absolutePoints.length?i.absolutePoints.push(e):i.absolutePoints[i.absolutePoints.length-1]=e},e.prototype.updateFixedTerminalPoint=function(e,t){this.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(),t,e)},e.prototype.updateFixedTerminalPoints=function(e,t){this.updateFixedTerminalPoint(e,!0),this.updateFixedTerminalPoint(e,!1)},e.prototype.updatePoints=function(e,t){if(null!=e){var i=[];i.push(e.absolutePoints[0]);for(var r=0;r<t.length;r++)if(null!=t[r]){var o=t[r];i.push(o)}var n=e.absolutePoints;i.push(n[n.length-1]),e.absolutePoints=i}},e.prototype.updateFloatingTerminalPoint=function(e,t,i,r){this.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(e,t,i,r),r,e)},e.prototype.getNextPoint=function(e,t,i){var r=e.absolutePoints,o=null;if(null!=r&&r.length>=2){var n=r.length;o=r[i?Math.min(1,n-1):Math.max(0,n-2)]}return o},e.prototype.getCenterX=function(e){return e.offsetX?e.offsetX+e.width:e.x+e.width},e.prototype.getCenterY=function(e){return e.offsetY?e.offsetY+e.height:e.y+e.height},e.prototype.getPerimeterBounds=function(e){return e.wrapper.outerBounds},e.prototype.getPerimeterFunction=function(e,t,i){var r=this.getCenterX(e),o=this.getCenterY(e),n=t.x-r,a=t.y-o,s=Math.atan2(a,n),h=this.getPointvalue(0,0),d=Math.PI,l=Math.PI/2-s,c=Math.atan2(e.height,e.width);return s<-d+c||s>d-c?(h.x=e.x,h.y=o-e.width*Math.tan(s)/2):s<-c?(h.y=e.y,h.x=r-e.height*Math.tan(l)/2):s<c?(h.x=e.x+e.width,h.y=o+e.width*Math.tan(s)/2):(h.y=e.y+e.height,h.x=r+e.height*Math.tan(l)/2),i&&(t.x>=e.x&&t.x<=e.x+e.width?h.x=t.x:t.y>=e.y&&t.y<=e.y+e.height&&(h.y=t.y),t.x<e.x?h.x=e.x:t.x>e.x+e.width&&(h.x=e.x+e.width),t.y<e.y?h.y=e.y:t.y>e.y+e.height&&(h.y=e.y+e.height)),h},e.prototype.getPerimeterPoint=function(e,t,i){var r=null;if(null!=e&&null!=t){var o=this.getPerimeterBounds(e);(o.width>0||o.height>0)&&(r=this.getPointvalue(t.x,t.y),r=this.getPerimeterFunction(o,r,i))}return r},e.prototype.getFloatingTerminalPoint=function(e,t,i,r){t=t;var o=this.getNextPoint(e,i,r);return this.getPerimeterPoint(t,o,1)},e.prototype.updateFloatingTerminalPoints=function(e,t,i){var r=e.absolutePoints,o=r[0];null==r[r.length-1]&&null!=i&&this.updateFloatingTerminalPoint(e,i,t,!1),null==o&&null!=t&&this.updateFloatingTerminalPoint(e,t,i,!0)},e.prototype.getConnectorPoints=function(e,t){this.updateFixedTerminalPoints(e,t),this.updatePoints(e,e.geometry.points),this.updateFloatingTerminalPoints(e,t.nameTable[e.sourceID],t.nameTable[e.targetID]),e.absolutePoints[0].y=e.sourcePoint.y,e.absolutePoints[e.absolutePoints.length-1].y=e.targetPoint.y},e.prototype.adjustSegmentPoints=function(e,t,i){"TopToBottom"!==i.layout.orientation&&"BottomToTop"!==i.layout.orientation||(e[0].x=t[0].x,e[1].x=t[1].x,e[e.length-1].x=t[t.length-1].x,e[e.length-2].x=t[t.length-2].x,"TopToBottom"===i.layout.orientation?(e[e.length-2].y=e[e.length-1].y-i.layout.verticalSpacing/2,e[1].y=e[0].y+i.layout.verticalSpacing/2):(e[1].y=e[0].y-i.layout.verticalSpacing/2,e[e.length-2].y=e[e.length-1].y+i.layout.verticalSpacing/2),e[2].y=e[1].y,e[e.length-3].y=e[e.length-2].y),"RightToLeft"!==i.layout.orientation&&"LeftToRight"!==i.layout.orientation||(e[0]=t[0],e[1]=t[1],e[e.length-1]=t[t.length-1],e[e.length-2]=t[t.length-2],"RightToLeft"===i.layout.orientation&&(e[1].x=e[0].x-i.layout.verticalSpacing/2),"LeftToRight"===i.layout.orientation&&(e[1].x=e[0].x+i.layout.verticalSpacing/2),e[2].x=e[1].x,"RightToLeft"===i.layout.orientation&&(e[e.length-2].x=e[e.length-1].x+i.layout.verticalSpacing/2),"LeftToRight"===i.layout.orientation&&(e[e.length-2].x=e[e.length-1].x-i.layout.verticalSpacing/2),e[e.length-3].x=e[e.length-2].x)},e.prototype.updateConnectorSegmentPoints=function(e,t){if(e.length>1)if("TopToBottom"===t.layout.orientation||"BottomToTop"===t.layout.orientation)for(var i=1;i<e.length-1;i+=2)e[i].y===e[i+1].y||"TopToBottom"!==t.layout.orientation&&"BottomToTop"!==t.layout.orientation||(e[i+1].y=e[i].y);else{var r=!1;for(i=e.length-1;i>1;i=i-=2)"RightToLeft"===t.layout.orientation||"LeftToRight"===t.layout.orientation?r?(e[i-2].x=e[i-1].x,r=!1):(e[i-1].x=e[i-2].x,r=!0):e[i+1].x=e[i].x}},e.prototype.updateConnectorSegmentPoint=function(e,t){for(var i=[],r=0;r<e.absolutePoints.length-1;r++){var o=e.absolutePoints[r],n=e.absolutePoints[r+1],a=Wa(o,n),s=Ha(o,n);r===e.absolutePoints.length-2&&("TopToBottom"===t.layout.orientation&&"Bottom"===s||"RightToLeft"===t.layout.orientation&&"Left"===s||"LeftToRight"===t.layout.orientation&&"Right"===s||"BottomToTop"===t.layout.orientation&&"Top"===s)&&(a/=2);var h=new hr(e,"segments",{type:"Orthogonal"},!0);h.length=a,h.direction=s,i.push(h)}e.segments=i,e.type="Orthogonal",t.connectorPropertyChange(e,{},{type:"Orthogonal",segments:e.segments})},e.prototype.resetConnectorSegments=function(e){for(var t=e.segments,i=t.length;i>1;i--)t.splice(i-1,1)},e.prototype.resetRoutingSegments=function(e,t,i){if(e.levelSkip){this.getConnectorPoints(e,t);var r=e.absolutePoints;this.updateConnectorSegmentPoints(r,t),this.adjustSegmentPoints(r,i,t),this.updateConnectorSegmentPoint(e,t)}},e.prototype.arrangeElements=function(e,t){var i=e.model.layout,r="LeftToRight"===t.orientation||"RightToLeft"===t.orientation?i.verticalSpacing:i.horizontalSpacing;this.groupLayoutCells(e),this.createMatrixCells(e);for(var o=0;o<e.matrix.length;o++)for(var n=e.matrix[o].key,a=e.matrix[n].value,s=1;s<a.length;s++){var h=a[s],d=a[s-1];h.offset+=d.offset+d.size/2+r+h.size/2}for(o=0;o<e.matrix[0].value.length;o++){var l=e.matrix[0].value[o];this.arrangeMatrix(l,null,e)}for(var c=0;c<e.matrix.length;c++){var p=e.matrix[c].value;for(s=0;s<p.length;s++){if((h=p[s]).visitedParents.length>1){var g=h.visitedParents[0],u=h.visitedParents[h.visitedParents.length-1],f=this.findParentVertexCellGroup(g),m=this.findParentVertexCellGroup(u);g!==f&&f.offset<g.offset&&(g=f),u!==m&&m.offset>u.offset&&(u=f);var y=(g.offset+u.offset)/2,v=h.initialOffset,b=h.offset;b!==v&&(y>=v&&y<=b?this.translateMatrixCells(y-h.offset,h):y<v&&this.translateMatrixCells(v-h.offset,h))}}}this.setXYforMatrixCell(e)},e.prototype.findParentVertexCellGroup=function(e){return e.cells[0]?e:e.parents.length>0?this.findParentVertexCellGroup(e.parents[0]):e},e.prototype.setXYforMatrixCell=function(e){for(var t=e.model.layout,i="LeftToRight"===t.orientation||"RightToLeft"===t.orientation,r=i?t.verticalSpacing:t.horizontalSpacing,o=0;o<e.matrix.length;o++)for(var n=e.matrix[o].value,a=0;a<n.length;a++)for(var s=n[a],h=s.offset-s.size/2,d=0;d<s.cells.length;d++){var l=s.cells[d],c=this.getType(l.type);if("internalVertex"===c){var p=l,g=p.cell.geometry.width,u=p.cell.geometry.height;p.cell.geometry=i?new b(e.rowOffset[s.level]-g/2,h,g,u):new b(h,e.rowOffset[s.level]-u/2,g,u),h+=(i?u:g)+r}else if("internalEdge"===c){var f=l,m=s.visitedParents[0];if(m)for(var y=0;y<m.visitedChildren.length;y++){for(var v=m.visitedChildren[y],w=[],x=0;x<v.cells.length;x++){var C=v.cells[x];"internalVertex"===this.getType(C.type)&&w.push(C)}if(w.length>0)break}for(x=0;x<f.edges.length;x++){var S=f.edges[x],P=this.getPointvalue(h+.5,e.rowOffset[s.level]);if(i&&(P=this.getPointvalue(e.rowOffset[s.level],h+.5)),this.containsValue(this.getEdgeMapper(),S)){var T=void 0;for(y=0;y<this.getEdgeMapper().length;y++)if(this.getEdgeMapper()[y].key===S){T=y;break}this.getEdgeMapper()[T].value.push(P)}h+=6}h+=r}}},e.prototype.getEdgeMapper=function(){return this.edgeMapper},e.prototype.setEdgeMapper=function(e){this.edgeMapper.push(e)},e.prototype.translateMatrixCells=function(e,t){if(0!==e&&(t.offset+=e,t.visitedChildren.length>0))for(var i=0;i<t.visitedChildren.length;i++){var r=t.visitedChildren[i];this.translateMatrixCells(e,r)}},e.prototype.groupLayoutCells=function(e){for(var t=e.model.ranks,i=t.length-1;i>=0;i--){for(var r=[],o=0;o<t[i].length;o++){var n=t[i][o];"internalVertex"===this.getType(n.type)&&r.push(t[i][o])}for(var a=[],s=0;s<t[i].length;s++){n=t[i][s];"internalEdge"===this.getType(n.type)&&a.push(n)}for(;r.length>1;){for(var h=r[0],d=this.selectIds(h.connectsAsTarget,!0),l=this.selectIds(h.connectsAsSource,!1);r.length>1;){var c=r[1],p=this.selectIds(c.connectsAsTarget,!0),g=this.selectIds(c.connectsAsSource,!1),u=this.compareLists(d,p),f=this.compareLists(l,g);if(!u||!f)break;this.updateMutualSharing(r[0],c.id),this.updateMutualSharing(r[1],h.id),r.splice(1,1)}r.splice(0,1)}for(;a.length>1;){var m=a[0],y=m.source,v=m.target;if(null!=y.identicalSibiling){for(var b=[],w=0;w<a.length;w++){var x=a[w];x.target===v&&b.push(x)}for(w=0;w<b.length;w++){var C=b[w];this.containsValue(y.identicalSibiling,C.source.id)&&(C.source.identicalSibiling=null)}m.source.identicalSibiling=null}a.splice(0,1)}}},e.prototype.getType=function(e){return"internalVertex"===e?"internalVertex":"internalEdge"},e.prototype.selectIds=function(e,t){for(var i=[],r=0;r<e.length;r++){var o=e[r];t?i.push(o.source.id):i.push(o.target.id)}return i},e.prototype.compareLists=function(e,t){var i=e.slice(),r=t.slice();if(i.length===r.length){if(0===i.length)return!0;for(var o=!0,n=0;n<r.length;n++)for(var a=r[n],s=n;s<i.length;s++)if(i[s]!==a){o=!1;break}return o}return!1},e.prototype.updateMutualSharing=function(e,t){null!=e.identicalSibiling||(e.identicalSibiling=[]),e.identicalSibiling.push(t)},e.prototype.matrixCellGroup=function(e){return e.level=e.level,e.parents=e.parents,e.children=e.children,e.visitedChildren=e.visitedChildren,e.visitedParents=e.visitedParents,e.ignoredChildren=e.ignoredChildren,e.cells=e.cells,e.offset=e.offset,e.initialOffset=e.initialOffset,e},e.prototype.getPointvalue=function(e,t){return{x:Number(e)||0,y:Number(t)||0}},e.prototype.containsValue=function(e,t){for(var i=0;i<e.length;i++)if(e[i].key===t||e[i]===t)return!0;return!1},e.prototype.createMatrixCells=function(e){for(var t=e.model.layout,i="LeftToRight"===t.orientation||"RightToLeft"===t.orientation,r=i?t.verticalSpacing:t.horizontalSpacing,o=i?t.horizontalSpacing:t.verticalSpacing,n=e.model.ranks,a=[],s=-o,h=n.length-1;h>=0;h--){var d=0,l=n.length-1-h,c=n[h].slice(),p=[];e.matrix.push({key:l,value:p});var g=[];for(a.push({index:l,value:g});c.length>0;){var u=c[0],f=this.matrixCellGroup({level:l,parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],cells:[],size:0,offset:0,initialOffset:0});p.push(f);var m=this.getType(u.type);if("internalVertex"===m){if(f.cells.push(u),null!=u.identicalSibiling)for(var y=0;y<c.length;y++){var v=c[y];if("internalVertex"===this.getType(v.type)&&this.containsValue(u.identicalSibiling,v.id)&&(f.cells.push(v),f.cells.length>u.identicalSibiling.length))break}for(y=0;y<f.cells.length;y++){v=f.cells[y];if("internalVertex"===this.getType(v.type)){var b=v.cell.geometry;if(f.size+=i?b.height:b.width,d=Math.max(d,i?b.width:b.height),g.push({key:v.id,value:f}),v.connectsAsTarget.length>0)for(var w=0;w<v.connectsAsTarget.length;w++){var x=v.connectsAsTarget[w],C=null;if(this.containsValue(a[l-1].value,x.ids)?C=x.ids:this.containsValue(a[l-1].value,x.source.id)&&(C=x.source.id),null!=C){for(var S=a[l-1].value,P=void 0,T=0;T<S.length;T++)if(S[T].key===C){P=S[T].value;break}this.containsValue(f.parents,P)||f.parents.push(P),this.containsValue(P.children,f)||P.children.push(f)}}c.reverse(),c.pop(),c.reverse()}}f.size+=(f.cells.length-1)*r}else if("internalEdge"===m){f.cells.push(u);for(y=0;y<f.cells.length;y++){var A=f.cells[y];if("internalEdge"===this.getType(A.type)&&null!=A.edges){var z=-5;for(w=0;w<A.edges.length;w++)z+=6;f.size+=z}g.push({key:A.ids,value:f});C=null;if(this.containsValue(a[l-1].value,A.ids)?C=A.ids:this.containsValue(a[l-1].value,A.source.id)&&(C=A.source.id),null!=C){var O=a[l-1].value;for(P=void 0,T=0;T<O.length;T++)if(O[T].key===C){P=O[T].value;break}this.containsValue(f.parents,P)||f.parents.push(P),this.containsValue(P.children,f)||P.children.push(f)}c.reverse(),c.pop(),c.reverse()}f.size+=(f.cells.length-1)*r}}e.rowOffset.push(s+d/2+o),s+=d+o}},e.prototype.updateLayout=function(e,t,i,r,o,n){var a=(e.x-t.width)/2-t.x,s=(e.y-t.height)/2-t.y;a=Math.round(a),s=Math.round(s);for(var h=[],d=new b(t.x+a,t.y+s,t.width,t.height),l=i.margin,c="RightToLeft"===r.orientation||"LeftToRight"===r.orientation?r.horizontalSpacing:r.verticalSpacing,p=0;p<o.length;p++){var g=o[p];if(null!=g.outEdges&&g.outEdges.length>0)for(var u=g.outEdges.length,f=0;f<u;f++){if((B=n[g.outEdges[f]]).pointCollection=[],u>1){for(var m=c/2,y=null,v=void 0,w=this.getEdgeMapper(),x=0;x<w.length;x++)if(w[x].key===B){v=x;break}if(w[v].value.length>0){var C=w[v].value[0],S=C.x+l.left,P=C.y+l.top,T=S,A=P;"BottomToTop"===r.orientation?A=t.height-P:"RightToLeft"===r.orientation&&(T=t.width-S),T+=a,A+=s,y=this.getPointvalue(T,A)}for(var z=[],O=0;O<B.segments.length;O++){var I=B.segments[O].points;for(var D in I)z.push(I[D])}z=this.updateConnectorPoints(z,m,y,d,r.orientation);for(var E=0;E<z.length;E++){I=z[E];B.pointCollection.push(this.getPointvalue(I.x,I.y))}this.resetConnectorPoints(B,this.diagram)}h.push(B)}if(null!=g.inEdges&&g.inEdges.length>1)for(u=g.inEdges.length,w=this.getEdgeMapper(),f=0;f<u;f++){var B=n[g.inEdges[f]];if(this.containsValue(h,B)||(B.pointCollection=[]),u>1){m=c/2,y=null,v=void 0,x=void 0;for(x=0;x<w.length;x++)if(w[x].key===B){v=x;break}if(w[v].value.length>0&&!this.containsValue(h,B)){var L=w[x].value[0],M=L.x+l.left,k=L.y+l.top;T=M,A=k;"BottomToTop"===r.orientation?A=t.height-k:"RightToLeft"===r.orientation&&(T=t.width-M),T+=a,A+=s,y=this.getPointvalue(T,A)}for(z=[],E=0;E<B.segments.length;E++){I=B.segments[E].points;for(var D in I)z.push(I[D])}z.reverse(),(z=this.updateConnectorPoints(z,m,y,d,i.orientation)).reverse(),B.pointCollection=[];for(E=0;E<z.length;E++){I=z[E];B.pointCollection.push(this.getPointvalue(I.x,I.y))}this.resetConnectorPoints(B,this.diagram)}}}},e}(),tc=function(){function t(){this.isAnimation=!1}return t.prototype.destroy=function(){},t.prototype.getModuleName=function(){return"OrganizationalChart"},t.prototype.updateLayout=function(e,t,i,r,o,n){var a={type:i.type,nameTable:t,anchorX:0,anchorY:0,firstLevelNodes:[],centerNode:null,levels:[],maxLevel:0,graphNodes:{},orientation:i.orientation,horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,verticalAlignment:i.verticalAlignment,horizontalAlignment:i.horizontalAlignment,fixedNode:i.fixedNode,getLayoutInfo:Wh(i.getLayoutInfo),layoutInfo:i.layoutInfo,margin:i.margin,bounds:i.bounds,objects:[],root:i.root};return this.doLayout(a,e,r,o,n),a},t.prototype.doLayout=function(e,t,i,r,o){var n,a,s=[];for(e.nameTable[e.root]&&e.firstLevelNodes.push(e.nameTable[e.root]),a=0;a<t.length;a++)if(!((n=t[a]).excludeFromLayout||((e.graphNodes[n.id]=this.setUpLayoutInfo(e,n)).tree.hasSubTree=!1,e.nameTable[e.root]||n.inEdges&&n.inEdges.length))){n.parentId||n.processId||s.push(n),n.data&&String(n.data[r])===e.root&&e.firstLevelNodes.push(n)}for(0===e.firstLevelNodes.length&&(e.firstLevelNodes=s),a=0;a<e.firstLevelNodes.length;a++)n=e.firstLevelNodes[a],this.updateEdges(e,n,1,o,t);if(e.firstLevelNodes.length>0){e.rootNode=e.firstLevelNodes[0];var h=0,d=0,l=void 0,c=void 0,p=void 0,g=void 0,u=void 0;for(a=0;a<e.firstLevelNodes.length;a++){u=this.updateTree(e,h,d,e.firstLevelNodes[a],0,e.firstLevelNodes[a-1]);var f=e.graphNodes[e.firstLevelNodes[a].id];u.y=Math.min(u.y,f.y),u.x=Math.min(u.x,f.x),-1!==e.orientation.indexOf("Left")?d=u.right+e.horizontalSpacing:h=u.right+e.horizontalSpacing,0===a?(l=u.x,g=u.y,p=u.right,c=u.bottom):(l=Math.min(l,u.x),g=Math.min(g,u.y),p=Math.max(p,u.right),c=Math.max(c,u.bottom))}for(this.updateAnchor(e,{x:l,y:g,right:p,bottom:c},i),a=0;a<e.firstLevelNodes.length;a++)this.updateNodes(e,e.firstLevelNodes[a],0);for(a=0;a<e.firstLevelNodes.length;a++)this.updateConnectors(e,e.firstLevelNodes[a],1)}},t.prototype.getBounds=function(e){var t=e.offsetX-e.actualSize.width*e.pivot.x,i=e.offsetY-e.actualSize.height*e.pivot.y;return new b(t,i,e.actualSize.width,e.actualSize.height)},t.prototype.updateTree=function(e,t,i,r,o,n,a){var s,h,d={},l=this.getDimensions(e,r,t,i,o);d=e.graphNodes[r.id],e.maxLevel=Math.max(e.maxLevel,o),s=o;var c=this.hasChild(e,r);if(c||d.tree.assistants.length){var p=void 0,g=void 0,u=void 0,f=void 0,m=void 0,y=void 0;y=l.y+l.height+e.verticalSpacing,d.tree.assistants.length&&(s=(h=this.setDepthSpaceForAssitants(e,r,y,l.height,o,e.verticalSpacing)).level,y=h.bottom),d.tree.assistants.length||"Horizontal"===d.tree.orientation||(y=l.y+l.height+e.verticalSpacing/2),d.tree.children.length&&(p="Horizontal"!==d.tree.orientation||"Balanced"===d.tree.type&&1!==d.tree.children.length?"Balanced"===d.tree.type?this.updateHorizontalTreeWithMultipleRows(e,r,n,l.x,y,s):this.updateVerticalTree(e,r,l.x,y,s,a):this.updateHorizontalTree(e,r,n,l.x,y,s)),d.y&&d.y>l.y||(d.y=l.y),d.mid&&(t=d.mid),d.tree.assistants.length&&(m=void 0!==t?t:l.x,f=this.setBreadthSpaceForAssistants(e,r,l,m,y,o),c||(t=((g=p=f).x+g.right)/2-l.width/2,p=g),u=f?f.canMoveBy:void 0),d.x=t,d.translate||(d.treeWidth=p.right-p.x);var v={layout:e,shape:r,shapeBounds:{x:t,y:l.y,right:t+l.width,bottom:l.y+l.height},treeBounds:p,dim:l,level:o};return this.translateSubTree(v,u,void 0!==n,a),d.firstChild&&"string"!=typeof d.firstChild&&(d.firstChild.x+=d.subTreeTranslation),r.treeBounds=p,p}return r.treeBounds=this.updateLeafNode(e,r,n,l,o,a),r.treeBounds},t.prototype.updateLeafNode=function(e,t,i,r,o,n){var a=e.graphNodes[t.id];a.x=r.x,a.y&&a.y>r.y||(a.y=r.y,a.maxLevel=Math.max(o,a.maxLevel||0));var s={x:r.x,y:r.y,right:r.x+r.width,bottom:r.y+r.height};a.maxLevel=Math.max(a.maxLevel||0,o);var h={layout:e,shape:t,shapeBounds:s,treeBounds:s,dim:r,level:o};return this.translateSubTree(h,void 0,void 0!==i,n),{x:a.x,y:a.y,right:a.x+r.width,bottom:a.y+r.height}},t.prototype.setUpLayoutInfo=function(e,t){var i={subTreeTranslation:0};return"OrganizationalChart"===e.type?i.tree={orientation:"Vertical",type:"Alternate",offset:20,enableRouting:!0}:i.tree={orientation:"Horizontal",type:"Center",enableRouting:!0},i.tree.children=[],i.tree.assistants=[],i.tree.level=0,i.translate=!0,i},t.prototype.translateSubTree=function(e,t,i,r){var o=e.layout,n=e.shape,a=e.shapeBounds,s=e.treeBounds,h=e.level,d=e.dim,l=o.graphNodes[n.id],c=o.nameTable[l.firstChild?l.firstChild.child:l.tree.children[0]],p=c?o.graphNodes[c.id]:null,g=this.hasChild(o,n),u=this.findIntersectingLevels(o,a,h,l.actualLevel),f=this.findIntersectingLevels(o,s,h,l.actualLevel),m=[];u.length&&l.translate?(l.intersect=u,this.spaceLeftFromPrevSubTree(o,n,a),l.canMoveBy=l.diff,void 0!==t&&(l.canMoveBy=Math.min(t,l.canMoveBy)),c&&void 0!==p.canMoveBy&&(p.canMoveBy>=l.canMoveBy&&(l.translated=!0),l.canMoveBy=Math.min(l.canMoveBy,p.canMoveBy)),i&&(l.x-=l.canMoveBy,l.subTreeTranslation-=l.canMoveBy,g&&(this.shiftSubordinates(o,f,l.canMoveBy),s.x=Math.min(s.x,l.x),s.right=Math.max(s.right,l.x+d.width),s.bottom=Math.max(s.bottom,l.y+d.height),s.x-=l.canMoveBy,s.right-=l.canMoveBy),c&&p.canMoveBy>l.canMoveBy?l.canMoveBy=p.canMoveBy-l.canMoveBy:c&&void 0!==l.canMoveBy&&(l.canMoveBy=0))):(g&&(s.x=Math.min(s.x,a.x),s.right=Math.max(s.right,a.x+d.width),s.bottom=Math.max(s.bottom,l.y+d.height)),l.translate||(l.canMoveBy=0,l.subTreeTranslation=0)),r||(a={x:l.x,y:d.y,right:l.x+d.width,bottom:d.y+d.height},m.push({rBounds:a}),this.updateRearBounds(o,n,m,h))},t.prototype.updateRearBounds=function(e,t,i,r,o){var n,a,s,h,d=!0,l={};t&&(o=(l=e.graphNodes[t.id]).intersect,d=!l.tree.children.length&&!l.tree.assistants.length);var c=i[0].rBounds,p=i[i.length-1].rBounds;if(o&&o.length){for(h=(n=e.levels[o[0]].rBounds).bottom,n.y<c.y&&(n.bottom=c.y,i.splice(0,0,{rBounds:n})),h>p.bottom?i.push({rBounds:{x:n.x,right:n.right,y:c.bottom,bottom:h}}):(n=e.levels[o[o.length-1]].rBounds,d&&n.bottom>p.bottom&&(n.y=p.bottom,i.push({rBounds:n}))),a=o[0],s=i.length-1;s>=0;s--)e.levels.splice(a,0,i[s]);a+=i.length,e.levels.splice(a,o.length)}else for(a=this.findLevel(e,i[i.length-1].rBounds,r),s=i.length-1;s>=0;s--)e.levels.splice(a,0,i[s])},t.prototype.shiftSubordinates=function(e,t,i){var r;if(0!==i)for(r=0;r<t.length;r++)e.levels[t[r]].rBounds&&(e.levels[t[r]].rBounds.x-=i,e.levels[t[r]].rBounds.right-=i)},t.prototype.setDepthSpaceForAssitants=function(e,t,i,r,o,n){var a,s,h,d,l=e.graphNodes[t.id],c={};for(d=i,s=0;s<l.tree.assistants.length;s++)(c=e.graphNodes[l.tree.assistants[s]])&&(c.tree.children=c.tree.assistants=[],c.y=i,a=(h=e.nameTable[l.tree.assistants[s]]).actualSize.height,-1!==e.orientation.indexOf("Left")&&(a=h.actualSize.width),d=i+a+n/2,e.maxLevel=o+1,s%2==1&&s!==l.tree.assistants.length-1&&(i=d,o++));return{level:e.maxLevel,bottom:i+a+n}},t.prototype.setBreadthSpaceForAssistants=function(e,t,i,r,o,n){var a,s,h,d,l,c,p,g={},u=e.graphNodes[t.id],f=n,m={x:0,y:0,right:0,bottom:0};for(d=0;d<u.tree.assistants.length;d++)(g=e.graphNodes[u.tree.assistants[d]])&&(a=(h=e.nameTable[u.tree.assistants[d]]).actualSize.width,-1!==e.orientation.indexOf("Left")&&(a=h.actualSize.height),l=d%2==0?r+i.width/2-20-a:r+i.width/2+20,s=this.updateTree(e,l,g.y,e.nameTable[u.tree.assistants[d]],f+1),this.hasChild(e,t)||(0===d?m=s:this.uniteRects(m,s)),d%2==0&&g.prevBounds&&(c=void 0===c?g.canMoveBy:Math.min(c,g.canMoveBy)),d%2!=1&&d!==u.tree.assistants.length-1||(p=this.findIntersectingLevels(e,s,f+1),this.updateRearBounds(e,null,[{rBounds:s}],f+1,p),f++));return m&&(m.canMoveBy=c),m},t.prototype.getDimensions=function(e,t,i,r,o){var n,a;if(n=t.actualSize.width,a=t.actualSize.height,-1!==e.orientation.indexOf("Left")){if(!o){var s=i;i=r,r=s}a=t.actualSize.width,n=t.actualSize.height}return{x:i,y:r,width:n,height:a}},t.prototype.hasChild=function(e,t){var i=e.graphNodes[t.id];return i?i.tree.children&&i.tree.children.length:0},t.prototype.updateHorizontalTree=function(e,t,i,r,o,n){var a=this.getDimensions(e,t,r,o,n),s={},h=(s=e.graphNodes[t.id]).tree.type,d=n,l=0;l=r;var c,p,g,u,f,m,y,v,b,w,x,C,S,P,T=o;e.levels.slice(0,e.levels.length);if(this.hasChild(e,t)){var A=-1!==e.orientation.indexOf("Left");for(C=0;C<s.tree.children.length;C++){c=(g=e.nameTable[s.tree.children[C]]).actualSize.width,p=g.actualSize.height,f=A?p:c,m=A?c:p;e.levels[d+1]&&e.levels[d+1].rBounds;if(u=this.updateTree(e,l,T,g,d+1,e.nameTable[s.tree.children[C-1]]),S=e.graphNodes[g.id],s.maxLevel=Math.max(s.maxLevel||0,S.maxLevel||0),v={x:S.x,y:S.y,right:S.x+f,bottom:S.y+m},0===C&&(y={x:Math.min(S.x,u.x),y:Math.min(S.y,u.y),right:u.right,bottom:u.bottom},P=S),x?(x.x=v.x,x.y=v.y,v.right>x.right&&(x.right=v.right),x.bottom=v.bottom):x=v,0===C&&(s.firstChild={x:S.x,canMoveBy:S.canMoveBy,child:g.id}),this.hasChild(e,g))if(!s.firstChild||s.firstChild.x>=S.firstChild.x){S.firstChild&&s.firstChild.canMoveBy<S.canMoveBy&&(w=s.firstChild.canMoveBy,S.canMoveBy=w,e.graphNodes[s.firstChild.child].canMoveBy=w,s.firstChild.canMoveBy=w);var z=void 0!==w?w:S.canMoveBy;s.firstChild={x:S.firstChild.x,canMoveBy:z,child:g.id}}else S.firstChild&&S.translated&&s.firstChild.canMoveBy>S.canMoveBy&&(s.firstChild.canMoveBy=e.graphNodes[s.firstChild.child].canMoveBy=S.canMoveBy);b=b?Math.max(S.maxLevel,b):S.maxLevel,this.uniteRects(y,u),l=0!==C&&!this.hasChild(e,g)&&S.subTreeTranslation<0?u.right-S.subTreeTranslation+e.horizontalSpacing:u.right+e.horizontalSpacing}isNaN(void 0)||(P.canMoveBy=void 0),s.mid=(P.x+x.right)/2-a.width/2,"Left"===h?s.mid=v.right-a.width:"Right"===h&&(s.mid=r)}return y},t.prototype.updateHorizontalTreeWithMultipleRows=function(e,t,i,r,o,n){var a,s,h,d,l,c,p,g,u,f,m,y=this.getDimensions(e,t,r,o,n),v=e.graphNodes[t.id],b=(v.tree.type,n),w=r,x=o,C=(e.levels.slice(0,e.levels.length),0);if(this.hasChild(e,t)){var S=-1!==e.orientation.indexOf("Left"),P=void 0,T=this.splitChildrenInRows(e,t),A=5===v.tree.children.length&&3===T[0].length,z=[],O=[];A?O=T:this.splitRows(T,z,O);var I={leftTree:z,rows:T,rightTree:O,dimensions:y},D=this.updateLeftTree(e,I,t,r,x,b);l=I.bounds;var E=void 0,B=(D||0)+(void 0!==D?e.horizontalSpacing/2:0);void 0!==D&&(v.mid=B-y.width/2,E=D+e.horizontalSpacing),x=o;var L=void 0;for(L=[],u=0;u<O.length;u++)for(w=T[u].length%2==1&&u===O.length-1||A?r:E||r,0!==u&&(x=L[u-1].bottom+e.verticalSpacing),g=0;g<O[u].length;g++)c=(a=e.nameTable[O[u][g]]).actualSize.width,p=a.actualSize.height,d=S?p:c,(s=e.graphNodes[a.id]).actualLevel=b+1+u,0===g&&z[u]&&z[u].length&&(s.translate=!1),A&&1===u&&(0===g&&f+d+e.horizontalSpacing<=m&&(P=!0,w=f-d/2),P&&1===g&&(w=m-d/2)),h=this.updateTree(e,w,x,a,b+1,e.nameTable[O[u][g-1]]),A&&g<=2&&0===u&&1===g&&(f=h.x-e.horizontalSpacing/2,m=h.x+d+e.horizontalSpacing/2),0===g?L[u]={x:h.x,y:h.y,right:h.right,bottom:h.bottom}:this.uniteRects(L[u],h),l||(l={x:L[u].x,y:L[u].y,right:L[u].right,bottom:L[u].bottom}),this.uniteRects(l,L[u]),w=h.right+e.horizontalSpacing,(!v.firstChild||(u===O.length-1&&T[u].length%2==1||A)&&0===g&&void 0!==s.canMoveBy&&C>s.canMoveBy)&&(C=Math.min(C,s.canMoveBy||0),v.firstChild={x:s.x,child:a.id,canMoveBy:s.canMoveBy}),I.leftCenter=f,I.rightCenter=m,I.align=P,I.level=b,I.rightBounds=L,this.alignRowsToCenter(e,u,t,I,E)}return l},t.prototype.updateLeftTree=function(e,t,i,r,o,n){for(var a,s,h,d,l,c=t.leftTree,p=e.graphNodes[i.id],g=[],u=-1!==e.orientation.indexOf("Left"),f=0;f<c.length&&c[f].length;f++){a=r,g[f-1]&&(o=g[f-1].bottom+e.verticalSpacing);for(var m=0;m<c[f].length;m++){var y=e.nameTable[c[f][m]],v=(u?y.actualSize.height:y.actualSize.width,u?y.actualSize.width:y.actualSize.height,e.graphNodes[y.id]);v.actualLevel=n+1+f,d=this.updateTree(e,a,o,y,n+1,e.nameTable[c[f][m-1]]),0===m?g[f]={x:d.x,y:d.y,right:d.right,bottom:d.bottom}:this.uniteRects(g[f],d),0===f&&0===m?(s=v.canMoveBy,p.firstChild={x:v.x,child:y.id,canMoveBy:v.canMoveBy}):0===m&&void 0!==v.canMoveBy&&s>v.canMoveBy&&(s=Math.min(s,v.canMoveBy||0),p.firstChild={x:v.x,child:y.id,canMoveBy:v.canMoveBy}),a=d.right+e.horizontalSpacing}h=0===f?g[f].right:Math.max(h,g[f].right)}for(f=0;f<c.length&&c[f].length;f++){if(h!==g[f].right){var b=h-g[f].right;for(m=0;m<c[f].length;m++){e.nameTable[c[f][m]];e.graphNodes[c[f][m]].x+=b}}0===f?l={x:g[0].x,y:g[0].y,right:g[0].right,bottom:g[0].bottom}:this.uniteRects(l,g[f])}return t.bounds=l,h},t.prototype.alignRowsToCenter=function(e,t,i,r,o){var n,a,s,h=e.graphNodes[i.id],d=r.rows,l=r.rightTree,c=r.leftCenter,p=r.rightCenter,g=r.align,u=r.rightBounds,f=r.dimensions,m=r.level,y=5===h.tree.children.length&&3===d[0].length;if(y&&1===t&&(n=u[0].right-u[0].x>=u[1].right-u[1].x?0:1),t===d.length-1&&(d[t].length%2==1||y&&1===t)){a=l[t][Math.floor(l[t].length/2)];var v=e.nameTable[a],b=e.graphNodes[a].x,w=e.graphNodes[a].y,x=this.getDimensions(e,v,b,w,m+1);s=void 0,!g&&y?(1===n&&(t=0),s=(u[n].x+u[n].right)/2-(u[t].x+u[t].right)/2,0===t&&(h.mid+=s)):y||void 0===o||(s=o-e.horizontalSpacing/2-(b+x.width/2)),void 0!==s&&this.updateRearBoundsOfTree(e,l[t],s,f),y&&(h.mid=(p+c)/2+(0===t?s:0)-f.width/2),void 0===h.mid&&e.graphNodes[a]&&(h.mid=b),g=!1,t++}},t.prototype.updateRearBoundsOfTree=function(e,t,i,r){for(var o=0;o<t.length;o++){var n=e.graphNodes[t[o]];if(n.x+=i,n.canMoveBy+=i,o===t.length-1){var a={x:n.x,y:n.y,right:n.x+r.width,bottom:n.y+r.height},s=this.findIntersectingLevels(e,a,n.actualLevel);this.updateRearBounds(e,null,[{rBounds:a}],n.actualLevel,s)}}},t.prototype.splitRows=function(e,t,i){for(var r=0;r<e.length;r++){t[r]=[],i[r]=[];var o=void 0;if(o=e[r].length,e[r].length%2!=1){o=Math.ceil(e[r].length/2);for(var n=0;n<o;n++)t[r].push(e[r][n])}for(var a=t[r].length;a<e[r].length;a++)i[r].push(e[r][a])}},t.prototype.updateVerticalTree=function(e,t,i,r,o,n){var a,s,h,d,l,c,p,g,u,f,m,y,v,b,w=e.graphNodes[t.id],x=e.nameTable[w.tree.children[0]],C=-1!==e.orientation.indexOf("Left"),S="Left"===w.tree.type?-1:0,P=i,T=r,A=o,z=[],O=[];for(m=0;m<w.tree.children.length;m++){if("Alternate"===w.tree.type&&(v=m%2==0&&w.tree.children.length>2?"Left":"Right",S=m%2==0&&w.tree.children.length>2?-1:0),P=i+this.findOffset(e,t,w,v),a=e.nameTable[w.tree.children[m]],d=C?a.actualSize.height:a.actualSize.width,l=C?a.actualSize.width:a.actualSize.height,h=this.updateTree(e,P+S*d,T,a,o+1,void 0,!0),g={x:(s=e.graphNodes[a.id]).x,y:s.y,right:s.x+d,bottom:s.y+l},0===m?(this.uniteRects(h,g),p=h):this.uniteRects(p,h),!s.prevBounds||"Alternate"===w.tree.type&&m%2==1&&w.tree.children.length>2||(b=void 0!==b?Math.min(s.canMoveBy,b):s.canMoveBy),w.maxLevel=Math.max(w.maxLevel||0,s.maxLevel||0),"Alternate"===w.tree.type&&w.tree.children.length>2&&m%2==0?(0!==m&&(T=c.bottom+e.verticalSpacing/2),O.push({rBounds:g}),s.levelBounds&&(O=O.concat(s.levelBounds))):(T="Alternate"===w.tree.type&&w.tree.children.length>2?Math.max(h.bottom,c.bottom)+e.verticalSpacing/2:h.bottom+e.verticalSpacing/2,o=w.maxLevel,z.push({rBounds:g}),f?this.uniteRects(f,g):f={x:s.x,y:s.y,right:s.x+d,bottom:s.y+l},s.levelBounds&&(z=z.concat(s.levelBounds))),0===m&&(w.firstChild={x:s.x,canMoveBy:s.canMoveBy,child:a.id}),this.hasChild(e,a))if(!w.firstChild||w.firstChild.x>=s.firstChild.x){if(s.firstChild&&w.firstChild.canMoveBy<s.canMoveBy){var I=w.firstChild.canMoveBy;s.canMoveBy=I,e.graphNodes[w.firstChild.child].canMoveBy=I,w.firstChild.canMoveBy=I}w.firstChild={x:s.firstChild.x,canMoveBy:void 0!==b?b:s.canMoveBy,child:a.id}}else s.firstChild&&s.translated&&w.firstChild.canMoveBy>s.canMoveBy&&(w.firstChild.canMoveBy=e.graphNodes[w.firstChild.child].canMoveBy=s.canMoveBy);c=g}return n?w.levelBounds=z:("Alternate"===w.tree.type&&w.tree.children.length>2&&(u={x:O[0].rBounds.x,y:O[0].rBounds.y,right:O[O.length-1].rBounds.right,bottom:O[O.length-1].rBounds.bottom},y=this.findIntersectingLevels(e,u,A+1),this.updateRearBounds(e,null,O,A+1,y)),y=this.findIntersectingLevels(e,f||p,A+1),this.updateRearBounds(e,null,f?z:[{rBounds:p}],A+1,y)),isNaN(b)||(e.graphNodes[x.id].canMoveBy=b),w.childBounds=p,w.mid=i,p},t.prototype.splitChildrenInRows=function(e,t){var i,r=e.graphNodes[t.id];i=4;var o,n=[];o=r.tree.children.length;var a=this.extend(r.tree.children);if(r.tree.rows){r.tree.children.length;var s=r.tree.rows;i=s%2==0?s:s-1}else 3===r.tree.children.length||4===r.tree.children.length?i=2:5===r.tree.children.length&&(i=3);for(;o>0;)n[n.length]=a.splice(0,i),(o-=i)<i&&(o%2==0?i=o:1!==o&&(i=o-1),o<i&&(i=o));return n},t.prototype.extend=function(e){var t,i=[];for(t=0;t<e.length;t++)i[t]=e[t];return i},t.prototype.findOffset=function(e,t,i,r){var o=0,n=-1!==e.orientation.indexOf("Left")?t.actualSize.height:t.actualSize.width,a=r||i.tree.type;switch(o=i.tree.offset||20,"Alternate"===i.tree.type&&o>=e.horizontalSpacing&&(o=e.horizontalSpacing/2),a){case"Left":o=n/2-o;break;case"Right":o+=n/2}return o},t.prototype.uniteRects=function(e,t){e.x=Math.min(e.x,t.x),e.right=Math.max(e.right,t.right),e.bottom=Math.max(e.bottom,t.bottom)},t.prototype.spaceLeftFromPrevSubTree=function(e,t,i){for(var r,o,n=e.graphNodes[t.id],a=e.horizontalSpacing,s=0;s<n.intersect.length;s++)o=e.levels[n.intersect[s]].rBounds,r=i.x-(o.right+a),(void 0===n.diff||r<n.diff)&&(n.diff=r,n.prevBounds=e.levels[n.intersect[s]].rBounds)},t.prototype.findIntersectingLevels=function(e,t,i,r){var o={x:t.x,y:t.y,right:t.right,bottom:t.bottom};o.y-=e.verticalSpacing/2,o.bottom+=e.verticalSpacing/2;var n,a,s=[];a=void 0!==r?r:i,n=e.levels[a]?e.levels[a].rBounds:null;do{if(n&&(o.y<n.y&&o.bottom>n.y||o.y<n.bottom&&n.bottom<o.bottom||o.y>=n.y&&o.bottom<=n.bottom||o.y<n.y&&o.bottom>n.bottom)){s.splice(0,0,a)}else if(n&&n.bottom<o.y)break;a--,n=e.levels[a]?e.levels[a].rBounds:null}while(a>=0);a=(void 0!==r?r:i)+1,n=e.levels[a]?e.levels[a].rBounds:null;do{if(n&&(o.y<n.y&&o.bottom>n.y||o.y<n.bottom&&n.bottom<o.bottom||o.y>=n.y&&o.bottom<=n.bottom||o.y<n.y&&o.bottom>n.bottom))s.push(a);else if(n&&n.y>o.bottom)break;a++,n=e.levels[a]?e.levels[a].rBounds:null}while(a<=e.levels.length);return s},t.prototype.findLevel=function(e,t,i){var r,o,n=t;for(r=0,o=e.levels[r]?e.levels[r].rBounds:null;r<e.levels.length;){if(o&&n.bottom<o.y)return r;r++,o=e.levels[r]?e.levels[r].rBounds:null}return r},t.prototype.getParentNode=function(e,t){return e.nameTable[e.nameTable[t.inEdges[0]].sourceID]},t.prototype.updateEdges=function(t,i,r,o,n){var a,s=t.graphNodes[i.id];if(i.outEdges&&i.outEdges.length&&(i.isExpanded||o===e.DiagramAction.Render))for(a=0;a<i.outEdges.length;a++){var h=t.nameTable[t.nameTable[i.outEdges[a]].targetID];h&&!h.excludeFromLayout&&(-1===s.tree.children.indexOf(h.id)&&s.tree.children.push(h.id),h.outEdges&&h.outEdges.length&&h.isExpanded&&(s.tree.hasSubTree=!0),this.updateEdges(t,h,r+1,o,n))}s.tree.level=r,s.tree.hasSubTree&&(s.tree.orientation="Horizontal",s.tree.type="Center"),(t.getLayoutInfo||t.layoutInfo)&&"OrganizationalChart"===t.type&&(t.getLayoutInfo?t.getLayoutInfo(i,s.tree):Mn(s.tree,t.layoutInfo,n,i),"Balanced"===s.tree.type&&s.tree.hasSubTree&&(s.tree.type="Center",s.tree.orientation="Horizontal")),t.level&&"Alternate"!==s.tree.type&&r>=t.level&&(s.tree.hasSubTree=!1)},t.prototype.updateAnchor=function(e,t,i){var r,o,n=0,a=0,s=0,h=0,d=new b(0,0,i.x,i.y),l=e.bounds?e.bounds:d,c=e.orientation;if(e.fixedNode){n=(o=e.nameTable[e.fixedNode]).actualSize.width,a=o.actualSize.height,e.anchorX=o.offsetX,e.anchorY=o.offsetY;var p=o.pivot;for(e.anchorX+="RightToLeft"===e.orientation?n*p.x:-n*p.x,e.anchorY+="BottomToTop"===e.orientation?a*p.y:-a*p.y,r=o,s=0;r.inEdges.length;)r=this.getParentNode(e,r),s+=e.graphNodes[r.id].subTreeTranslation||0;-1!==e.orientation.indexOf("Left")?(h=e.graphNodes[o.id].y,"LeftToRight"===c?e.anchorX-=h:e.anchorX+=h,e.anchorY-=e.graphNodes[o.id].x+s):(h=e.graphNodes[o.id].y,e.anchorX-=e.graphNodes[o.id].x+s,"TopToBottom"===c?e.anchorY-=h:e.anchorY+=h)}else if("TopToBottom"===c||"BottomToTop"===c){switch(e.horizontalAlignment){case"Left":e.anchorX=l.x-t.x+e.margin.left;break;case"Right":e.anchorX=l.x+l.width-e.margin.right-t.right;break;case"Auto":case"Center":e.anchorX=l.x+l.width/2-(t.x+t.right)/2}switch(e.verticalAlignment){case"Auto":case"Top":var g;g=l.y+e.margin.top,e.anchorY="TopToBottom"===c?g:t.bottom+g;break;case"Bottom":var u;u=l.y+l.height-e.margin.bottom,e.anchorY="TopToBottom"===c?u-t.bottom:u;break;case"Center":var f=void 0;f=l.y+l.height/2,e.anchorY="TopToBottom"===e.orientation?f-(t.y+t.bottom)/2:f+(t.y+t.bottom)/2}}else{switch(e.horizontalAlignment){case"Auto":case"Left":var m;m=l.x+e.margin.left,e.anchorX="LeftToRight"===c?m:t.bottom+m;break;case"Right":var y;y=l.x+l.width-e.margin.right,e.anchorX="LeftToRight"===c?y-t.bottom:y;break;case"Center":f=void 0;f=l.width/2+l.x,e.anchorX="LeftToRight"===e.orientation?f-(t.y+t.bottom)/2:f+(t.y+t.bottom)/2}switch(e.verticalAlignment){case"Top":e.anchorY=l.y+e.margin.top-t.x;break;case"Auto":case"Center":e.anchorY=l.y+l.height/2-(t.right+t.x)/2;break;case"Bottom":e.anchorY=l.y+l.height-e.margin.bottom-t.right}}},t.prototype.updateConnectors=function(e,t,i){var r,o,n,a=e.graphNodes[t.id];if(t.outEdges.length)for(r=0;r<t.outEdges.length;r++)if((n=e.nameTable[t.outEdges[r]]).points=[],o=e.nameTable[n.targetID],n.visible){if(n.visited=!0,e.getConnectorSegments)e.getConnectorSegments(n);else a&&-1!==a.tree.children.indexOf(n.targetID)&&(n.segments=[],"OrganizationalChart"===e.type&&"Orthogonal"===n.type&&this.updateSegments(e,n,t,o,r));o&&(o.isExpanded||this.hasChild(e,o))&&this.updateConnectors(e,o,i+1)}if(a&&a.tree.assistants.length)for(r=0;r<a.tree.assistants.length;r++)o=e.nameTable[a.tree.assistants[r]],n=e.nameTable[o.inEdges[0]],this.get3Points(e,t,o,n),(o.isExpanded||this.hasChild(e,o))&&this.updateConnectors(e,o,i+1)},t.prototype.updateSegments=function(e,t,i,r,o){var n=e.graphNodes[i.id];n.tree.assistants.length?this.updateSegmentsForHorizontalOrientation(e,i,r,t):"Horizontal"===n.tree.orientation&&"Balanced"===n.tree.type?this.updateSegmentsForBalancedTree(e,t,i,r,o):"Horizontal"===n.tree.orientation?this.updateSegmentsForHorizontalOrientation(e,i,r,t):n.tree.offset<5?this.get5Points(e,i,r,t):this.get3Points(e,i,r,t)},t.prototype.updateSegmentsForBalancedTree=function(e,t,i,r,o){var n,a=e.graphNodes[i.id];if(5===a.tree.children.length&&o>2){n=a.tree.children[1],isNaN(e.graphNodes[n].treeWidth)&&(e.graphNodes[n].treeWidth=e.nameTable[n].actualSize.width);var s=3!==o?1:-1;if(-1!==e.orientation.indexOf("Left"))e.nameTable[n].offsetY-e.graphNodes[n].treeWidth/2-e.verticalSpacing*s/2;else e.nameTable[n].offsetX,e.graphNodes[n].treeWidth,e.horizontalSpacing;this.getSegmentsForMultipleRows(e,i,r,t)}else a.tree.children.length>5?o<4||o<a.tree.rows?this.getSegmentsForMultipleRows(e,i,r,t):this.updateSegmentsForHorizontalOrientation(e,i,r,t):4===a.tree.children.length?o<2||o<a.tree.rows?this.getSegmentsForMultipleRows(e,i,r,t):this.updateSegmentsForHorizontalOrientation(e,i,r,t):this.getSegmentsForMultipleRows(e,i,r,t)},t.prototype.get3Points=function(e,t,i,r){var o=[],n=this.getBounds(t),a=this.getBounds(i);if(-1!==e.orientation.indexOf("Top")){var s=0===e.orientation.indexOf("Top")?n.bottomCenter:n.topCenter,h=t.offsetX>i.offsetX?a.middleRight:a.middleLeft;o.push(s,{x:n.bottomCenter.x,y:h.y},h)}else{s=0===e.orientation.indexOf("Left")?n.middleRight:n.middleLeft,h=t.offsetY>i.offsetY?a.bottomCenter:a.topCenter;o.push(s,{x:a.bottomCenter.x,y:n.middleRight.y},h)}this.getSegmentsFromPoints(o,r)},t.prototype.get5Points=function(e,t,i,r){var o,n,a,s,h=[],d=this.getBounds(t),l=this.getBounds(i);-1!==e.orientation.indexOf("Top")?(o=t.offsetY<i.offsetY?d.bottomCenter:d.topCenter,s=e.verticalSpacing/4*(t.offsetY<i.offsetY?1:-1),a=e.horizontalSpacing/2*(t.offsetX>i.offsetX?1:-1),n=t.offsetX>i.offsetX?l.middleRight:l.middleLeft,h.push(o,{x:o.x,y:o.y+s},{x:n.x+a,y:o.y+s},{x:n.x+a,y:n.y},n)):(o=t.offsetX>i.offsetX?d.middleLeft:d.middleRight,n=t.offsetY>i.offsetY?l.bottomCenter:l.topCenter,a=e.horizontalSpacing/4*(t.offsetX<i.offsetX?1:-1),s=e.verticalSpacing/2*(t.offsetY>i.offsetY?1:-1),h.push(o,{x:o.x+a,y:o.y},{x:o.x+a,y:o.y+s},{x:n.x,y:o.y+s},n)),this.getSegmentsFromPoints(h,r)},t.prototype.getSegmentsFromPoints=function(e,t){for(var i,r=[],o=0;o<e.length-2;o++)(i=new hr(t,"segments",{type:"Orthogonal"},!0)).direction=a.direction(e[o],e[o+1]),i.length=a.distancePoints(e[o],e[o+1]),r.push(i);t.segments=r},t.prototype.getSegmentsForMultipleRows=function(e,t,i,r){var o,n,s=[],h=this.getBounds(i),d=this.getBounds(t);switch(e.orientation){case"TopToBottom":o={x:d.bottomCenter.x,y:d.bottomCenter.y+e.verticalSpacing/4},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(d.bottomCenter,o),n.length=a.distancePoints(d.bottomCenter,o),s.push(n);break;case"BottomToTop":o={x:d.bottomCenter.x,y:d.topCenter.y-e.verticalSpacing/4},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(d.topCenter,o),n.length=a.distancePoints(d.topCenter,o),s.push(n);break;case"LeftToRight":if(o={x:d.middleRight.x+e.verticalSpacing/4,y:d.middleRight.y},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(d.middleRight,o),n.length=a.distancePoints(d.middleRight,o),s.push(n),h.center.y!==d.center.y){var l={x:d.middleRight.x+e.verticalSpacing/4,y:h.middleLeft.y};(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(o,l),n.length=a.distancePoints(o,l),s.push(n)}break;case"RightToLeft":if(o={x:d.middleLeft.x-e.verticalSpacing/4,y:d.middleRight.y},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(d.middleLeft,o),n.length=a.distancePoints(d.middleLeft,o),s.push(n),h.center.y!==d.center.y){var c={x:d.middleLeft.x-e.verticalSpacing/4,y:h.middleLeft.y};(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(c,c),n.length=a.distancePoints(c,c),s.push(n)}}r.segments=s},t.prototype.updateSegmentsForHorizontalOrientation=function(e,t,i,r){var o,n,s=[],h=this.getBounds(t),d=this.getBounds(i);switch(e.orientation){case"TopToBottom":o={x:h.bottomCenter.x,y:d.topCenter.y-e.verticalSpacing/2},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(h.bottomCenter,o),n.length=a.distancePoints(h.bottomCenter,o),s.push(n);break;case"BottomToTop":o={x:h.topCenter.x,y:d.bottomCenter.y+e.verticalSpacing/2},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(h.topCenter,o),n.length=a.distancePoints(h.topCenter,o),s.push(n);break;case"LeftToRight":if(o={x:d.middleLeft.x-e.verticalSpacing/2,y:h.middleRight.y},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(h.middleRight,o),n.length=a.distancePoints(h.middleRight,o),s.push(n),d.center.y!==h.center.y){var l={x:d.middleLeft.x-e.verticalSpacing/2,y:d.middleLeft.y};(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(o,l),n.length=a.distancePoints(o,l),s.push(n)}break;case"RightToLeft":if(o={x:d.middleRight.x+e.verticalSpacing/2,y:h.middleRight.y},(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(h.middleLeft,o),n.length=a.distancePoints(h.middleLeft,o),s.push(n),d.center.y!==h.center.y){var c={x:d.middleRight.x+e.verticalSpacing/2,y:d.middleLeft.y};(n=new hr(r,"segments",{type:"Orthogonal"},!0)).direction=a.direction(o,c),n.length=a.distancePoints(o,c),s.push(n)}}return r.segments=s,[]},t.prototype.updateNodes=function(e,t,i,r,o,n){var a,s,h,d,l,c;if(t&&!t.excludeFromLayout){h=t.actualSize.width,d=t.actualSize.height,l=e.anchorX,c=e.anchorY,"LeftToRight"===e.orientation?(l+=e.graphNodes[t.id].y+h/2,c+=e.graphNodes[t.id].x+i+d/2):"RightToLeft"===e.orientation?(l-=e.graphNodes[t.id].y+h/2,c+=e.graphNodes[t.id].x+i+d/2):"TopToBottom"===e.orientation?(l+=e.graphNodes[t.id].x+i+h/2,c+=e.graphNodes[t.id].y+d/2):(l+=e.graphNodes[t.id].x+i+h/2,c-=e.graphNodes[t.id].y+d/2),e.graphNodes&&(l+=o=o||0,c+=n=n||0,this.isAnimation||(t.offsetX=l,t.offsetY=c));var p={id:t.id,differenceX:l-t.offsetX,differenceY:c-t.offsetY};e.objects.push(p);var g=[];if(this.hasChild(e,t))for(a=0;a<e.graphNodes[t.id].tree.children.length;a++)s=e.nameTable[e.graphNodes[t.id].tree.children[a]],this.updateNodes(e,s,i+(e.graphNodes[t.id].subTreeTranslation||0),r,o,n),g.push(s);if(e.graphNodes[t.id].tree.assistants.length)for(a=0;a<e.graphNodes[t.id].tree.assistants.length;a++)s=e.nameTable[e.graphNodes[t.id].tree.assistants[a]],this.updateNodes(e,s,i+(e.graphNodes[t.id].subTreeTranslation||0),null,o,n)}},t}(),ic=function(){function e(){this.isAnimation=!1}return e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"MindMapChart"},e.prototype.updateLayout=function(e,t,i,r,o,n){var a=this.checkRoot(e,i,o,n,t);if(a)i.fixedNode=a;else for(var s=0,h=e;s<h.length;s++){if(!((m=h[s]).excludeFromLayout||m.inEdges&&m.inEdges.length)){i.fixedNode=m.id;break}}var d=t[i.fixedNode],l=this.findFirstLevelNodes(d,i,t),c=[],p=[],g=Wh(i.getBranch);g=g||Wh(this.getBranch);for(var u=0,f=l;u<f.length;u++){var m,y=g(m=f[u],l);"Left"===(y=m&&m.branch?m.branch:y)?c.push(m):p.push(m)}var v=new b(0,0,r.x,r.y);t[i.fixedNode].offsetX=v.x+v.width/2,t[i.fixedNode].offsetY=v.y+v.height/2,c.length&&this.updateMindMapBranch(e,p,t,i,r,o,"Left"),p.length&&this.updateMindMapBranch(e,c,t,i,r,o,"Right")},e.prototype.checkRoot=function(e,t,i,r,o){for(var n=0,a=e;n<a.length;n++){var s=a[n];if(!s.excludeFromLayout){if(s.data&&(s.data[i].toString()===r||s.data[i].toString()===t.root))return s.id;if(!s.data&&s.id===t.root)return s.id}}return""},e.prototype.updateMindMapBranch=function(e,t,i,r,o,n,a){var s={type:"HierarchicalTree",horizontalSpacing:r.verticalSpacing,verticalSpacing:r.horizontalSpacing,verticalAlignment:r.verticalAlignment,horizontalAlignment:r.horizontalAlignment,fixedNode:r.fixedNode,getLayoutInfo:Wh(r.getLayoutInfo),layoutInfo:r.layoutInfo,margin:r.margin,root:r.fixedNode};s.orientation="Left"===a?"LeftToRight":"RightToLeft",this.excludeFromLayout(t,i,!0),(new tc).updateLayout(e,i,s,o,n),this.excludeFromLayout(t,i,!1)},e.prototype.getBranch=function(e,t){return t.indexOf(e)%2==0?"Left":"Right"},e.prototype.excludeFromLayout=function(e,t,i){for(var r=0,o=e;r<o.length;r++){t[o[r].id].excludeFromLayout=i}},e.prototype.findFirstLevelNodes=function(e,t,i){var r=[];if(e&&e.outEdges.length)for(var o=0,n=e.outEdges;o<n.length;o++){var a=n[o];r.push(i[i[a].targetID])}return r},e}(),rc=function(){function e(){}return e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"RadialTree"},e.prototype.updateLayout=function(e,t,i,r){var o={type:i.type,nameTable:t,anchorX:0,anchorY:0,firstLevelNodes:[],centerNode:null,levels:[],maxLevel:0,graphNodes:{},layoutNodes:[],orientation:i.orientation,horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,verticalAlignment:i.verticalAlignment,horizontalAlignment:i.horizontalAlignment,fixedNode:i.fixedNode,margin:i.margin,bounds:i.bounds,objects:[],root:i.root};this.doLayout(o,e,t,r)},e.prototype.doLayout=function(e,t,i,r){for(var o,n=0;n<t.length;n++)(o=t[n]).excludeFromLayout||(e.graphNodes[o.id]=this.setUpLayoutInfo(e,o),o.inEdges&&o.inEdges.length||e.firstLevelNodes.push(o));e.root&&i[e.root]?e.centerNode=i[e.root]:e.firstLevelNodes.length&&(e.centerNode=e.firstLevelNodes[0],e.root=e.centerNode.id),e.centerNode&&(this.updateEdges(e,e.centerNode,0,i),this.depthFirstAllignment(e,e.centerNode,0,0),this.populateLevels(e),this.transformToCircleLayout(e),this.updateAnchor(e,r),this.updateNodes(e,e.centerNode,i))},e.prototype.updateEdges=function(e,t,i,r){var o=e.graphNodes[t.id];e.layoutNodes.push(o),o.level=i,o.visited=!0,e.maxLevel=Math.max(e.maxLevel,i);for(var n=0;n<t.outEdges.length;n++){var a=r[r[t.outEdges[n]].targetID];a.excludeFromLayout||a.visited||(o.children.push(a),this.updateEdges(e,a,i+1,r))}},e.prototype.depthFirstAllignment=function(e,t,i,r){var o,n=e.graphNodes[t.id];if(n.children.length){r+=300;for(var a=0;a<n.children.length;a++)i=(o=this.depthFirstAllignment(e,n.children[a],i,r)).x,r=o.y;n.children=n.children.sort((function(t,i){return e.graphNodes[t.id].x-e.graphNodes[i.id].x}));var s=e.graphNodes[n.children[0].id].min,h=e.graphNodes[n.children[n.children.length-1].id].max;if(n.x=s+(h-s)/2,i=h+e.horizontalSpacing,n.segmentOffset=h+e.horizontalSpacing,n.x-=n.width/2,n.y-=n.height/2,n.min=s,n.max=h,n.x<s&&n.visited){n.x=s,i=n.x+n.width/2-(h-s)/2,n.visited=!1;for(a=0;a<n.children.length;a++)o=this.depthFirstAllignment(e,n.children[a],i,r);n.visited=!0,i=n.x+n.width+e.horizontalSpacing}i=i<(h=e.graphNodes[n.children[n.children.length-1].id].segmentOffset)?h:i,r-=300,n.y=r}else n.x=i,n.y=r,n.min=i,n.max=i+n.width,i+=n.width+e.horizontalSpacing;return{x:i,y:r}},e.prototype.populateLevels=function(e){var t=[],i=Math.min.apply(Math,e.layoutNodes.map((function(e){return e.x}))),r=Math.max.apply(Math,e.layoutNodes.map((function(t){return t.x+t.width+e.horizontalSpacing})))-i;e.levels=[];for(var o=function(o){var n={};t=(t=e.layoutNodes.filter((function(e){return e.level===o?e:null}))).sort((function(e,t){return e.x-t.x})),n.min=t[0].x,n.max=t[t.length-1].x+t[t.length-1].width+e.horizontalSpacing,n.actualCircumference=0,n.height=0;for(var a=0;a<t.length;a++)t[a].height>n.height&&(n.height=t[a].height),n.actualCircumference+=Math.max(t[a].width,t[a].height),a!==t.length-1&&(n.actualCircumference+=e.horizontalSpacing);n.circumference=n.max-n.min,n.actualCircumference<n.circumference&&(n.circumference=(n.circumference+n.actualCircumference)/2),n.radius=n.circumference/(2*Math.PI)+n.height,n.nodes=[],o>1&&e.levels[o-1].radius+e.levels[o-1].height>=n.radius&&(n.radius=e.levels[o-1].radius+e.levels[o-1].height);for(var s=0;s<t.length;s++)t[s].ratio=Math.abs(t[s].x+t[s].width/2-i)/r,n.nodes.push(t[s]);e.levels.push(n)},n=0;n<=e.maxLevel;n++)o(n)},e.prototype.transformToCircleLayout=function(e){var t=e.graphNodes[e.centerNode.id];t.x=0,t.y=0;for(var i=1;i<e.levels.length;i++)for(var r=0;r<e.levels[i].nodes.length;r++){var o=e.levels[i].nodes[r];o.x=Math.cos(360*o.ratio*Math.PI/180)*(e.levels[i].radius+e.verticalSpacing*i),o.y=Math.sin(360*o.ratio*Math.PI/180)*(e.levels[i].radius+e.verticalSpacing*i),e.anchorX=Math.min(e.anchorX,o.x),e.anchorY=Math.min(e.anchorY,o.y)}},e.prototype.updateAnchor=function(e,t){e.anchorX=e.centerNode.offsetX||t.x/2,e.anchorY=e.centerNode.offsetY||t.y/2},e.prototype.updateNodes=function(e,t,i){var r=e.graphNodes[t.id],o=r.x+e.anchorX,n=r.y+e.anchorY;t.offsetX+=o,t.offsetY+=n;for(var a=0;a<r.children.length;a++){var s=r.children[a];this.updateNodes(e,i[s.id],i)}},e.prototype.setUpLayoutInfo=function(e,t){var i={};return i.name=t.id,i.x=0,i.y=0,i.min=0,i.max=0,i.width=t.actualSize.width,i.height=t.actualSize.height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i},e}(),oc=function(){function e(e){this.velocityX=0,this.velocityY=0,this.nodes=[],this.graphNode=e;var t=sc(this.graphNode);this.location=t.center,this.nodes=[],e.treeInfo.parents||(e.treeInfo.parents=[]),e.treeInfo.children||(e.treeInfo.children=[]),this.nodes=e.treeInfo.parents.concat(e.treeInfo.children)}return e.prototype.applyChanges=function(){this.graphNode.treeInfo.center=this.location},e}(),nc=function(){function e(){this.cdCOEF=.442,this.cfMAXVELOCITY=50,this.cnMAXITERACTION=1e3,this.cnSPRINGLENGTH=100,this.mszMaxForceVelocity={width:this.cfMAXVELOCITY,height:this.cfMAXVELOCITY},this.springLength=0,this.springFactor=this.cdCOEF,this.maxIteration=this.cnMAXITERACTION,this.springLength=this.cnSPRINGLENGTH}return e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"SymmetricalLayout"},e.prototype.doGraphLayout=function(e){var t=this.selectedNode;t.treeInfo.Bounds=e.getModelBounds(e.nodes);var i=t.treeInfo.GraphNodes,r=this.convertGraphNodes(i),o=r.length;o=Math.min(this.maxIteration,o*o*o),this.preLayoutNodes(r,t.treeInfo.Bounds);for(var n=0,a=o;n<a;n++)this.makeSymmetricLayout(r),this.appendForces(r);this.resetGraphPosition(r,t)},e.prototype.preLayoutNodes=function(e,t){for(var i=Math.max(t?t.width:25,t?t.height:25),r=i/2,o=i/2,n=2*Math.PI/e.length,a=n,s=0;s<e.length;s++){var h=e[s];this.getForceNode(h).location={x:r+i*Number(Math.cos(a).toFixed(2)),y:o+i*Number(Math.sin(a).toFixed(2))},a-=n}},e.prototype.doLayout=function(e){this.selectedNode=e.selectedNode,this.doGraphLayout(e)},e.prototype.makeSymmetricLayout=function(e){for(var t,i,r=0;r<e.length;r++){for(var o=e[r],n=(t=this.getForceNode(o)).nodes,a=0;a<n.length;a++){hc((u=n[a]).id,e)&&this.calcNodesForce(t,this.getForceNode(u))}for(var s=0,h=n.length;s<h&&!(h<2);s++){var d=this.getForceNode(n[s]),l=s+1>=h?this.getForceNode(n[0]):this.getForceNode(n[s+1]),c=360/n.length/2*Math.PI/180,p=2*this.springLength*Math.sin(c);this.calcRelatesForce(d,l,p)}for(var g=0;g<e.length;g++){var u;hc((u=e[g]).id,n)||u.id===o.id||(i=this.getForceNode(u),this.updateNeigbour(t,i))}}},e.prototype.appendForces=function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i],o=(t=this.getForceNode(r)).location;o.x+=Math.min(t.velocityX,this.mszMaxForceVelocity.width),o.y+=Math.min(t.velocityY,this.mszMaxForceVelocity.height),t.velocityX=0,t.velocityY=0,t.location=o}},e.prototype.resetGraphPosition=function(e,t){for(var i,r={width:Number.MAX_VALUE,height:Number.MAX_VALUE},o=null,n=0;n<e.length;n++){i=e[n];var a={x:(o=this.getForceNode(i)).location.x-i.actualSize.width/2,y:o.location.y-i.actualSize.height/2};r.width=Math.min(r.width,a.x),r.height=Math.min(r.height,a.y)}for(n=0;n<e.length;n++){i=e[n],(a=(o=this.getForceNode(i)).location).x-=r.width-(t.treeInfo.location?t.treeInfo.location.x:0),a.y-=r.height-(t.treeInfo.location?t.treeInfo.location.y:0),o.location=a,o.applyChanges()}},e.prototype.convertGraphNodes=function(e){for(var t=[],i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];if(e[o]){var n=e[o],a=new oc(n);n.treeInfo.tag=a,t.push(n)}}return t},e.prototype.getForceNode=function(e){return e.treeInfo.tag},e.prototype.updateNeigbour=function(e,t){if(null!=t&&null!=e){var i=this.pointDistance(e.location,t.location),r=this.lineAngle(e.location,t.location),o=.9*this.springLength;i<o&&this.calcForce(i,o,r,t)}},e.prototype.lineAngle=function(e,t){var i=0,r=t.x-e.x,o=t.y-e.y;return 0===r?i=o<=0?3*Math.PI/2:Math.PI/2:0===o?i=r<0?Math.PI:0:(i=Math.atan(o/r),r<0&&o>0||r<0&&o<0?i=Math.PI+i:r>0&&o<0&&(i=2*Math.PI+i)),i},e.prototype.pointDistance=function(e,t){var i=0,r=t.x-e.x,o=t.y-e.y,n=r*r+o*o;return n>0&&(i=Math.sqrt(n)),i},e.prototype.calcRelatesForce=function(e,t,i){var r=this.pointDistance(e.location,t.location),o=this.lineAngle(e.location,t.location);r<i&&this.calcForce(r,i,o,t)},e.prototype.updateLayout=function(e,t,i,r,o,n){(new ac).updateLayout(e,t,i,r,o,n)},e.prototype.calcNodesForce=function(e,t){var i=this.pointDistance(e.location,t.location),r=this.lineAngle(e.location,t.location);(i>this.springLength||i<this.springLength)&&this.calcForce(i,this.springLength,r,t)},e.prototype.calcForce=function(e,t,i,r){var o=r.nodes.length,n=e-t,a=this.springFactor/(o*o)*Math.sqrt(o);if(0!==n){var s=n*a,h=Math.cos(i)*s,d=Math.sin(i)*s;r.velocityX-=h,r.velocityY-=d}},e}(),ac=function(){function e(){this.visitedStack=[],this.cycleEdgesCollection=[],this.graphObjects=[],this.passedNodes=[]}return e.prototype.updateLayout=function(e,t,i,r,o,n){this.nameTable=r,this.nodes=e,this.connectors=t;var a=e;a.length>0&&(this.mhelperSelectedNode=Ah(a[0]));for(var s=0,h=e;s<h.length;s++){var d=f=h[s];d.treeInfo={},d.treeInfo.graphType="Node",this.graphObjects.push(d)}for(var l=0,c=t;l<c.length;l++){var p=c[l];p.treeInfo={},p.treeInfo.graphType="Connector",this.graphObjects.push(p)}this.updateLayout1(this.graphObjects,i);for(var g=this.getModelBounds(a),u=0;u<a.length;u++){var f=a[u],m=(n.x-g.width)/2,y=o.margin||{};y.left=y.left||0,y.right=y.right||0,y.top=y.top||0,y.bottom=y.bottom||0,o.margin.left&&(y.left=o.margin.left),o.margin.top&&(y.top=o.margin.top);var v=f.treeInfo.tag.location.x-(f.offsetX-f.actualSize.width/2)-g.x+m+y.left,b=f.treeInfo.tag.location.y-(f.offsetY-f.actualSize.height/2)-g.y+y.top;f.offsetX+=v,f.offsetY+=b,delete f.treeInfo}return!0},e.prototype.getModelBounds=function(e){e=e.slice();for(var t,i=null,r=null,o=0;o<e.length;o++){var n=sc(t=e[o]);i=new b(t.treeInfo.tag?t.treeInfo.tag.location.x:n.x,t.treeInfo.tag?t.treeInfo.tag.location.y:n.y,t.actualSize.width,t.actualSize.height),r=r?r.uniteRect(i):i}return r},e.prototype.updateLayout1=function(e,t){this.detectCyclesInGraph(e);var i=e.length;if(i>0){for(var r=[],o=[],n=[],a=0;a<e.length;a++){var s=e[a];void 0===s.treeInfo.isCycleEdge&&(s.treeInfo.isCycleEdge=!1),"Connector"!==s.treeInfo.graphType||s.treeInfo.isCycleEdge?"Connector"===s.treeInfo.graphType?r.push(s):n.push(s):o.push(s)}for(o=o.concat(n),o=r.concat(o);i>this.dictionaryLength(this.passedNodes);)if(this.getNodesToPosition(o),null!=this.selectedNode){t.doLayout(this),this.selectedNode=null,this.visitedStack=[];for(var h=0,d=this.cycleEdgesCollection;h<d.length;h++){d[h].treeInfo.isCycleEdge=!1}}this.passedNodes=null,this.selectedNode=null}return!1},e.prototype.getNodesToPosition=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(!hc(i.id,this.passedNodes)){i&&this.selectNodes(i);break}}},e.prototype.selectNodes=function(e){var t=e;"Connector"===e.treeInfo.graphType?this.exploreGraphEdge(e):null!=t&&this.addNode(e,"passed")&&(this.addNode(e,"selected"),this.isConnectedToAnotherNode(t)?(this.selectedNode={treeInfo:{}},this.selectedNode.treeInfo.LeftMargin=10,this.selectedNode.treeInfo.TopMargin=10,this.selectConnectedNodes(t)):this.selectedNode=e)},e.prototype.selectConnectedNodes=function(e){var t=this.selectedNode;t.treeInfo.GraphNodes||(t.treeInfo.GraphNodes={});var i=e;if(null!=i&&this.addNode(i,"passed")){var r=i.id;if(this.dictionaryContains(t.treeInfo.GraphNodes,i)){var o=t.treeInfo.GraphNodes[r];o.treeInfo.Added&&(o.treeInfo.Added=!1,this.getConnectedRelatives(o),this.exploreRelatives(e))}else{var n=this.addGraphNode(i);this.getConnectedRelatives(n),this.exploreRelatives(e)}}},e.prototype.exploreRelatives=function(e){this.exploreRelatives1(e,"Parents"),this.exploreRelatives1(e,"Children")},e.prototype.exploreRelatives1=function(e,t){var i=[];"Parents"===t?i=e.inEdges:"Children"===t&&(i=e.outEdges);for(var r=0;r<i.length;r++){var o=this.nameTable[i[r]];if(this.addNode(o,"passed")){var n=this.nameTable[o.sourceID],a=this.nameTable[o.targetID];"Parents"===t&&null!=n&&hc(n.id,this.nodes)?this.selectConnectedNodes(this.nameTable[o.sourceID]):"Children"===t&&null!=a&&hc(a.id,this.nodes)&&this.selectConnectedNodes(this.nameTable[o.targetID])}}},e.prototype.getConnectedRelatives=function(e){this.getConnectedParents(e),this.getConnectedChildren(e)},e.prototype.dictionaryContains=function(e,t){for(var i=Object.keys(e),r=0;r<i.length;r++)if(i[r]===t.id)return!0;return!1},e.prototype.dictionaryLength=function(e){return Object.keys(e).length},e.prototype.getConnectedChildren=function(e){for(var t=this.selectedNode,i=e,r=0;r<i.outEdges.length;r++){var o=this.nameTable[i.outEdges[r]];if(!o.treeInfo.isCycleEdge){var n=this.nameTable[o.targetID];if(hc(n.id,this.nodes)&&null!=n&&n.visible){var a=void 0;this.dictionaryContains(t.treeInfo.GraphNodes,n)?a=t.treeInfo.GraphNodes[n.id]:(a=this.addGraphNode(n)).treeInfo.Added=!0,e.treeInfo.children||(e.treeInfo.children=[]),a.treeInfo.parents||(a.treeInfo.parents=[]),this.setNode(a.treeInfo.parents,e),this.findNode(e.treeInfo.children,a.id)<0&&e.treeInfo.children.push(a)}}}},e.prototype.getConnectedParents=function(e){for(var t=this.selectedNode,i=e,r=0;r<i.inEdges.length;r++){var o=this.nameTable[i.inEdges[r]];if(!o.treeInfo.isCycleEdge){var n=this.nameTable[o.sourceID];if(hc(n.id,this.nodes)&&null!=n&&n.visible){var a=void 0;this.dictionaryContains(t.treeInfo.GraphNodes,n)?a=t.treeInfo.GraphNodes[n.id]:(a=this.addGraphNode(n)).treeInfo.Added=!0,e.treeInfo.parents||(e.treeInfo.parents=[]),a.treeInfo.children||(a.treeInfo.children=[]),this.setNode(a.treeInfo.children,e),this.findNode(e.treeInfo.parents,a.id)<0&&e.treeInfo.parents.push(a)}}}},e.prototype.setNode=function(e,t){var i=this.findNode(e,t.id);i>=0&&i<e.length?e[i]=t:e.push(t)},e.prototype.findNode=function(e,t){var i=-1;if(null!=e&&""!==t)for(var r=0,o=e.length;r<o;r++){var n=e[r];if("string"==typeof n&&n===t){i=r;break}if(null!=n&&n.id===t){i=r;break}}return i},e.prototype.addGraphNode=function(e){var t=this.selectedNode;t.treeInfo.GraphNodes||(t.treeInfo.GraphNodes={});var i=e;if(null!=t){t.treeInfo.GraphNodes[i.id]=i;var r=this.mhelperSelectedNode;null!=r&&e.id===r.id&&(this.mhelperSelectedNode=i)}return i},e.prototype.isConnectedToAnotherNode=function(e){var t=!1;return e.inEdges.concat(e.outEdges).length>0&&(null!=e.inEdges&&e.inEdges.length>0&&(t=this.searchEdgeCollection(e.inEdges,"FromNode")),!t&&null!=e.outEdges&&e.outEdges.length>0&&(t=this.searchEdgeCollection(e.outEdges,"ToNode"))),t},e.prototype.searchEdgeCollection=function(e,t){for(var i=!1,r=0;r<e.length-1;r++){var o=this.nameTable[e[r]];if(this.addNode(o,"passed")&&(!o.treeInfo.isCycleEdge&&("FromNode"===t&&null!=this.nameTable[o.sourceID]||"ToNode"===t&&null!=this.nameTable[o.targetID]))){i=!0;break}}return i},e.prototype.exploreGraphEdge=function(e){var t=e;if(null!=t&&!t.treeInfo.isCycleEdge&&this.addNode(e,"passed")){this.addNode(e,"selected");var i=this.nameTable[t.sourceID],r=this.nameTable[t.targetID];null!=i?this.selectNodes(i):null!=r?this.selectNodes(r):this.selectedNode=e}},e.prototype.addNode=function(e,t){var i=e;return"passed"!==t&&i.visible||this.dictionaryContains(this.passedNodes,i)||(this.passedNodes[i.id]=i),!!i.visible},e.prototype.detectCyclesInGraph=function(e){for(var t=[],i=[],r=0;r<e.length;r++)"Connector"!==e[r].treeInfo.graphType&&t.push(e[r]);if(t.length>0)for(i.push(t[0]),this.visitedStack.push(t[0]);i.length>0;){var o=i[i.length-1],n=this.getUnVisitedChildNodes(o);if(n.length>0){var a=n[0],s=n[n.length-1];hc(a.id,this.visitedStack)?(s.treeInfo.isCycleEdge=!0,this.cycleEdgesCollection.push(s)):(i.push(a),this.visitedStack.splice(0,0,a))}else i.pop()}},e.prototype.getUnVisitedChildNodes=function(e){var t=[];if(e.outEdges.length>0){for(var i=0;i<e.outEdges.length;i++){var r=this.nameTable[e.outEdges[i]];if(!hc(r.id,this.visitedStack)){var o=this.nameTable[r.targetID];return null!=o&&t.push(o),t.push(r),this.visitedStack.splice(0,0,r),t}}return t}return t},e}();function sc(e){var t=e.offsetX-e.actualSize.width*e.pivot.x,i=e.offsetY-e.actualSize.height*e.pivot.y;return new b(t,i,e.actualSize.width,e.actualSize.height)}function hc(e,t){for(var i=0;i<t.length;i++)if(t[i].id===e)return!0;return!1}var dc,lc,cc=function(){function e(){}return e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"ComplexHierarchicalTree"},e.prototype.doLayout=function(e,t,i,r,o){(new pc).doLayout(e,t,i,r,o)},e.prototype.getLayoutNodesCollection=function(e){for(var t,i=[],r=0;r<e.length;r++)(t=e[r]).inEdges.length+t.outEdges.length>0&&!t.parentId&&!t.processId&&i.push(t);return i},e}(),pc=function(){function e(){this.nameTable={},this.crossReduction=new uc,this.previousEdgeOffset=6,this.previousEdgeDistance=5,this.jettyPositions={},this.rankBottomY=null,this.limitX=null,this.rankTopY=null,this.parallelEdgeSpacing=10,this.minEdgeJetty=12}return e.prototype.createVertex=function(e,t,i,r,o,n){return{value:t,geometry:{x:i,y:r,width:o,height:n},name:t,vertex:!0,inEdges:e.inEdges.slice(),outEdges:e.outEdges.slice()}},e.prototype.getEdges=function(e){var t=[];if(e){for(var i=0;e.inEdges.length>0&&i<e.inEdges.length;i++)t.push(this.nameTable[e.inEdges[i]]);for(i=0;e.outEdges.length>0&&i<e.outEdges.length;i++)t.push(this.nameTable[e.outEdges[i]])}return t},e.prototype.findRoots=function(e){for(var t=[],i=null,r=-1e5,o=0,n=Object.keys(e);o<n.length;o++){for(var a=e[n[o]],s=this.getEdges(a),h=0,d=0,l=0;l<s.length;l++){this.getVisibleTerminal(s[l],!0).name===a.name?h++:d++}0===d&&h>0&&t.push(a);var c=h-d;c>r&&(r=c,i=a)}return 0===t.length&&null!=i&&t.push(i),t},e.prototype.getVisibleTerminal=function(e,t){var i=this.nameTable[e.targetID];t&&(i=this.nameTable[e.sourceID]);for(var r=0;r<this.vertices.length;r++)if(this.vertices[r].name===i.id)return this.vertices[r];return null},e.prototype.traverse=function(e,t,i,r,o,n){if(null!=e){var a=e.name;if(null==n||null!=n[a]){null==r[a]&&(r[a]=e),null!=n&&delete n[a];for(var s=this.getEdges(e),h=[],d=0;d<s.length;d++)h[d]=this.getVisibleTerminal(s[d],!0)===e;for(d=0;d<s.length;d++)if(!t||h[d]){for(var l=this.getVisibleTerminal(s[d],!h[d]),c=1,p=0;p<s.length;p++)if(p!==d){var g=h[p];this.getVisibleTerminal(s[p],!g)===l&&(g?c++:c--)}c>=0&&(r=this.traverse(l,t,s[d],r,o,n))}}else if(null==r[a])for(d=0;d<o.length;d++){var u=o[d];if(null!=u[a]){for(var f=0,m=Object.keys(u);f<m.length;f++){var y=m[f];r[y]=u[y]}return o.splice(d,1),r}}}return r},e.prototype.getModelBounds=function(e){e=e.slice();for(var t=null,i=null,r=0;r<e.length;r++)if(t=e[r].geometry,i){var o=Math.max(i.x+i.width,t.x+t.width),n=Math.max(i.y+i.height,t.y+t.height);i.x=Math.min(i.x,t.x),i.y=Math.min(i.y,t.y),i.width=o-i.x,i.height=n-i.y}else i={x:t.x,y:t.y,width:t.width,height:t.height};return i},e.prototype.doLayout=function(e,t,i,r,o){this.nameTable=t;var n,a=i.enableRouting,s={horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,orientation:i.orientation,marginX:i.margin.left,marginY:i.margin.top,enableLayoutRouting:a};o&&(o.edgeMapper=[]);var h=[];this.vertices=[];for(var d={},l=0;l<e.length;l++){var c=this.createVertex(e[l],e[l].id,0,0,e[l].actualSize.width,e[l].actualSize.height);if(this.vertices.push(c),(e[l].inEdges.length>0||e[l].outEdges.length>0)&&h.push(e[l]),d[c.name]=c,o)for(var p=e[l].outEdges.slice(),g=0;g<p.length;g++){var u=t[p[g]];o.setEdgeMapper({key:u,value:[]})}}var f=[],m=this.findRoots(d);for(l=0;l<m.length;l++){var y={};f.push(y),this.traverse(m[l],!0,null,y,f,d)}var v,b={marginX:0,marginY:0},w=[],x=!1;for(l=0;l<f.length;l++){y=f[l];for(var C=0,S=Object.keys(y);C<S.length;C++){var P=S[C];w.push(y[P])}("Linear"===i.arrangement&&l===f.length-1||a)&&(x=!0),n=new gc(this,w,m,s),this.cycleStage(n),this.layeringStage(n),o&&"DifferentPoint"===i.connectionPointOrigin||x?(v=this.matrixModel({model:n,matrix:[],rowOffset:[]}),o.arrangeElements(v,i)):"Nonlinear"===i.arrangement&&(this.crossingStage(n),b=this.placementStage(n,b.marginX,b.marginY),w=[])}var T=this.getModelBounds(this.vertices);this.updateMargin(i,s,T,r);for(l=0;l<this.vertices.length;l++){if(_=this.vertices[l]){var A=this.nameTable[_.name];A.offsetX=0,A.offsetY=0;var z=_.geometry.x-(A.offsetX-A.actualSize.width/2)+s.marginX,O=_.geometry.y-(A.offsetY-A.actualSize.height/2)+s.marginY,I=z,D=O;"BottomToTop"===s.orientation?(a&&(_.geometry.y=T.height-O-A.actualSize.height/2),D=T.height-O):"RightToLeft"===s.orientation&&(I=T.width-z),A.offsetX+=I-A.offsetX,A.offsetY+=D-A.offsetY}}if(!x)for(l=0;l<this.vertices.length;l++)this.isNodeOverLap(this.nameTable[this.vertices[l].name],i);if((o&&"DifferentPoint"===i.connectionPointOrigin||a)&&o.updateLayout(r,T,i,s,h,t),a){for(var E={},B=void 0,L=0;L<v.matrix.length;L++){B=v.matrix[L].value;for(var M=0;M<B.length;M++)for(var k=B[M],R=0;R<k.cells.length;R++){var N=k.cells[R];if("internalVertex"===this.getType(N.type)){var j=N;E[j.id]=j}}}this.updateRankValuess(n);l=0;for(var H=Object.keys(E);l<H.length;l++){P=H[l];this.setVertexLocationValue(E[P],i.orientation,T)}this.localEdgeProcessing(n,E),this.assignRankOffset(n),this.updateEdgeSetXYValue(n);var W=this.getValues(n.edgeMapper);for(l=0;l<W.length;l++){if(W[l].x.length>0)for(g=0;g<W[l].x.length;g++)"RightToLeft"!==i.orientation&&"LeftToRight"!==i.orientation?W[l].x[g]=W[l].x[g]+s.marginX:(i.orientation,W[l].x[g]=W[l].x[g]+i.verticalSpacing/2);this.setEdgePosition(W[l],n,s)}for(L=0;L<this.vertices.length;L++){var _;(_=this.vertices[L]).outEdges.length>1&&this.updateMultiOutEdgesPoints(_)}}},e.prototype.setEdgeXY=function(e,t,i,r){if(e&&t.source.id){for(var o=void 0,n=void 0,a=0;a<e.length;a++)for(var s=0;s<e[a].length;s++)e[a][s].id!==t.target.id&&e[a][s].id!==t.source.id||(e[a][s].id===t.target.id&&void 0===o&&(o=a),e[a][s].id===t.source.id&&void 0===n&&(n=a));for(var h=void 0,d=o;d<=n;d++)void 0===h&&(h=this[d+"_RankOffset"]),void 0!==h&&h<this[d+"_RankOffset"]&&(h=this[d+"_RankOffset"]);void 0===this.edges&&(this.edges={}),this.edges[t.ids[0]]={x:t.x,y:0};var l=this.resetOffsetXValue(h,i/10);t.x[r-t.minRank-1]=l;for(s=0;s<t.edges.length;s++)t.edges[s].levelSkip=!0}},e.prototype.resetOffsetXValue=function(e,t){for(var i=0,r=Object.keys(this.edges);i<r.length;i++)for(var o=r[i],n=this.edges[o].x,a=0;a<n.length;a++){var s=void 0;if(this.edges[o].x[a]===e)return s=e+t,s=this.resetOffsetXValue(s,t)}return e},e.prototype.setEdgePosition=function(e,t,i){var r=0;if(101207!==e.temp[0]){void 0===e.maxRank&&(e.maxRank=-1),void 0===e.minRank&&(e.minRank=-1);var o=e.maxRank,n=e.minRank;o===n&&(o=e.source.maxRank,n=e.target.minRank);var a=0,s=this.jettyPositions[e.ids[0]];void 0===e.isReversed?e.isReversed=!1:e.isReversed=!0;var h=e.isReversed?e.target.cell:e.source.cell,d=!1;"TopToBottom"===t.layout.orientation||"LeftToRight"===t.layout.orientation?("TopToBottom"===t.layout.orientation&&(d=!1),"LeftToRight"===t.layout.orientation&&(d=(e.isReversed,!1))):e.isReversed||(d=!0);for(var l=0;l<e.edges.length;l++){var c=e.edges[l],p=this.getVisibleTerminal(c,!0),g=[],u=e.isReversed;if(p!==h&&(u=!u),null!=s){var f=u?2:0,m=u?d?this.rankBottomY[n]:this.rankTopY[n]:d?this.rankTopY[o]:this.rankBottomY[o],y=s[4*a+1+f];u!==d&&(y=-y),"TopToBottom"!==i.orientation&&"BottomToTop"!==i.orientation||(m+=y);var v=s[4*a+f];"TopToBottom"===i.orientation||"BottomToTop"===i.orientation?g.push(this.getPointvalue(v,m+i.marginY)):"LeftToRight"===i.orientation?g.push(this.getPointvalue(m+y,v+i.marginY)):g.push(this.getPointvalue(m,v+i.marginY))}var b=e.x.length-1,w=-1,x=-1,C=e.maxRank-1;u&&(b=0,w=e.x.length,x=1,C=e.minRank+1);for(var S=b;e.maxRank!==e.minRank&&S!==w;S+=x){var P=e.x[S]+r,T=(this.rankTopY[C]+this.rankBottomY[C+1])/2,A=(this.rankTopY[C-1]+this.rankBottomY[C])/2;if(u){var z=T;T=A,A=z}"TopToBottom"===i.orientation||"BottomToTop"===i.orientation?(g.push(this.getPointvalue(P,T+i.marginY)),g.push(this.getPointvalue(P,A+i.marginY))):(g.push(this.getPointvalue(T,P+i.marginY)),g.push(this.getPointvalue(A,P+i.marginY))),this.limitX=Math.max(this.limitX,P),C+=x}if(null!=s){f=u?2:0;var O=u?d?this.rankTopY[o]:this.rankBottomY[o]:d?this.rankBottomY[n]:this.rankTopY[n];y=s[4*a+3-f];u!==d&&(y=-y);m=O-y,v=s[4*a+2-f];"TopToBottom"===i.orientation||"BottomToTop"===i.orientation?g.push(this.getPointvalue(v,m+i.marginY)):g.push(this.getPointvalue(m,v+i.marginY))}this.setEdgePoints(c,g,t),r=0===r?this.parallelEdgeSpacing:r>0?-r:-r+this.parallelEdgeSpacing,a++}e.temp[0]=101207}},e.prototype.getPointvalue=function(e,t){return{x:Number(e)||0,y:Number(t)||0}},e.prototype.updateEdgeSetXYValue=function(e){if(e.layout.enableLayoutRouting){var t=!1;"LeftToRight"!==e.layout.orientation&&"RightToLeft"!==e.layout.orientation||(t=!0);for(var i=0;i<e.ranks.length;i++)for(var r=e.ranks[i],o=0;o<r.length;o++){var n=r[o];if(n.edges&&n.edges.length>0){var a=e.layout.horizontalSpacing>0?e.layout.horizontalSpacing/2:15,s=!0;n.minRank!==i-1&&n.maxRank!==i-1&&(s=!1),s&&this.setXY(n,i,void 0,!!t,e.ranks,a)}}}},e.prototype.getPreviousLayerConnectedCells=function(e,t){if(null==t.previousLayerConnectedCells){t.previousLayerConnectedCells=[],t.previousLayerConnectedCells[0]=[];for(var i=0;i<t.connectsAsSource.length;i++){var r=t.connectsAsSource[i];-1===r.minRank||r.minRank===e-1?t.previousLayerConnectedCells[0].push(r.target):t.previousLayerConnectedCells[0].push(r)}}return t.previousLayerConnectedCells[0]},e.prototype.compare=function(e,t){if(null!=e&&null!=t){if(t.weightedValue>e.weightedValue)return-1;if(t.weightedValue<e.weightedValue)return 1}return 0},e.prototype.localEdgeProcessing=function(e,t){for(var i=0;i<e.ranks.length;i++)for(var r=e.ranks[i],o=0;o<r.length;o++){var n=r[o];if(this.crossReduction.isVertex(n))for(var a=this.getPreviousLayerConnectedCells(i,n),s=i-1,h=0;h<2;h++){if(s>-1&&s<e.ranks.length&&null!=a&&a.length>0){for(var d=[],l=0;l<a.length;l++){var c=this.weightedCellSorter(a[l],this.getX(s,a[l]));d.push(c)}d.sort(this.compare),n.width=t[n.id].cell.geometry.width,n.height=t[n.id].cell.geometry.height;var p=void 0;"TopToBottom"===e.layout.orientation||"BottomToTop"===e.layout.orientation?(n.x[0]=t[n.id].cell.geometry.x+t[n.id].cell.geometry.width/2,p=n.x[0]-n.width/2+t[n.id].cell.geometry.height/2):(n.x[0]=t[n.id].cell.geometry.y,p=n.x[0]);var g=p+n.width,u=0,f=[];for(l=0;l<d.length;l++){var m=d[l].cell,y=void 0;if(this.crossReduction.isVertex(m)){y=0===h?n.connectsAsSource:n.connectsAsTarget;for(var v=0;v<y.length;v++)y[v].source!==m&&y[v].target!==m||(u+=y[v].edges.length,f.push(y[v]))}else u+=m.edges.length,f.push(m)}var b=(u+1)*this.previousEdgeDistance;n.width>b+2*this.previousEdgeDistance&&(p+=this.previousEdgeDistance,g-=this.previousEdgeDistance);var w=(g-p)/u,x=p+w/2,C=this.minEdgeJetty-this.previousEdgeOffset;for(l=0;l<f.length;l++){var S=f[l].edges.length;void 0===this.jettyPositions&&(this.jettyPositions={});var P=this.jettyPositions[f[l].ids[0]];null==P&&(P=[],this.jettyPositions[f[l].ids[0]]=P),l<u/2?C+=this.previousEdgeOffset:l>u/2&&(C-=this.previousEdgeOffset);for(var T=0;T<S;T++)P[4*T+2*h]=x,x+=w,P[4*T+2*h+1]=C}}a=this.getNextLayerConnectedCells(i,n),s=i+1}}},e.prototype.updateMultiOutEdgesPoints=function(e){for(var t=0;t<e.outEdges.length/2;t++){var i=this.nameTable[e.outEdges[t]];this.nameTable[e.outEdges[e.outEdges.length-(t+1)]].geometry.points[0].y=i.geometry.points[0].y}},e.prototype.getNextLayerConnectedCells=function(e,t){if(null==t.nextLayerConnectedCells){t.nextLayerConnectedCells=[],t.nextLayerConnectedCells[0]=[];for(var i=0;i<t.connectsAsTarget.length;i++){var r=t.connectsAsTarget[i];-1===r.maxRank||r.maxRank===e+1?t.nextLayerConnectedCells[0].push(r.source):t.nextLayerConnectedCells[0].push(r)}}return t.nextLayerConnectedCells[0]},e.prototype.getX=function(e,t){return this.crossReduction.isVertex(t)?t.x[0]:this.crossReduction.isVertex(t)?0:t.x[e-t.minRank-1]||t.temp[e-t.minRank-1]},e.prototype.getGeometry=function(e){return e.geometry},e.prototype.setEdgePoints=function(e,t,i){if(null!=e){var r=this.getGeometry(e);if(null!=t)for(var o=0;o<t.length;o++)t[o].x=t[o].x,t[o].y=t[o].y;r.points=t,e.geometry=r}},e.prototype.assignRankOffset=function(e){if(e)for(var t=0;t<e.ranks.length;t++)this.rankCoordinatesAssigment(t,e)},e.prototype.rankCoordinatesAssigment=function(e,t){for(var i,r=t.ranks[e],o=t.layout.horizontalSpacing,n=0;n<r.length;n++)void 0===this[e+"_RankOffset"]&&(this[e+"_RankOffset"]=0),i=r[n].x[0],this[e+"_RankOffset"]<i&&(this[e+"_RankOffset"]=i+r[n].width/2+o)},e.prototype.getType=function(e){return"internalVertex"===e?"internalVertex":"internalEdge"},e.prototype.updateRankValuess=function(e){this.rankTopY=[],this.rankBottomY=[];for(var t=0;t<e.ranks.length;t++)this.rankTopY[t]=Number.MAX_VALUE,this.rankBottomY[t]=-Number.MAX_VALUE},e.prototype.setVertexLocationValue=function(e,t,i){var r,o=e.cell.geometry;"TopToBottom"===t||"BottomToTop"===t?(o.x,r=o.y):(o.y,r=o.x),"RightToLeft"===t?(o.y,r=i.width-o.x-o.height,this.rankBottomY[e.minRank]=Math.max(this.rankBottomY[e.minRank],r),this.rankTopY[e.minRank]=Math.min(this.rankTopY[e.minRank],r+o.height)):(this.rankTopY[e.minRank]=Math.min(this.rankTopY[e.minRank],r),this.rankBottomY[e.minRank]=Math.max(this.rankBottomY[e.minRank],r+o.height))},e.prototype.matrixModel=function(e){return e.model=e.model,e.matrix=e.matrix||[],e.rowOffset=e.rowOffset||[],e},e.prototype.calculateRectValue=function(e){var t={x:0,y:0,right:0,bottom:0,height:0,width:0};return t.x=e.offsetX-e.actualSize.width/2,t.right=e.offsetX+e.actualSize.width/2,t.y=e.offsetY-e.actualSize.height/2,t.bottom=e.offsetY+e.actualSize.height/2,t},e.prototype.isNodeOverLap=function(e,t){for(var i={x:0,y:0,right:0,bottom:0,height:0,width:0},r=0;r<this.vertices.length;r++){var o={x:0,y:0,width:0,height:0},n=this.nameTable[this.vertices[r].value];e.id!==n.id&&0!==n.offsetX&&0!==n.offsetY&&(i=this.calculateRectValue(e),o=this.calculateRectValue(n),this.isIntersect(o,i,t)&&("TopToBottom"===t.orientation||"BottomToTop"===t.orientation?e.offsetX+=t.horizontalSpacing:e.offsetY+=t.verticalSpacing,this.isNodeOverLap(e,t)))}},e.prototype.isIntersect=function(e,t,i){return!(Math.floor(e.right+i.horizontalSpacing)<=Math.floor(t.x)||Math.floor(e.x-i.horizontalSpacing)>=Math.floor(t.right)||Math.floor(e.y-i.verticalSpacing)>=Math.floor(t.bottom)||Math.floor(e.bottom+i.verticalSpacing)<=Math.floor(t.y))},e.prototype.updateMargin=function(e,t,i,r){var o={x:0,y:0,width:r.x,height:r.y},n=i.x,a=i.y,s=i.x+i.width,h=i.y+i.height,d=e.bounds?e.bounds:o;if("TopToBottom"===t.orientation||"BottomToTop"===t.orientation){switch(e.horizontalAlignment){case"Auto":case"Left":t.marginX=d.x-n+e.margin.left;break;case"Right":t.marginX=d.x+d.width-e.margin.right-s;break;case"Center":t.marginX=d.x+d.width/2-(n+s)/2}switch(e.verticalAlignment){case"Top":var l=d.y+e.margin.top;t.marginY="TopToBottom"===t.orientation?l:-l;break;case"Bottom":var c=d.y+d.height-e.margin.bottom;t.marginY="TopToBottom"===t.orientation?c-h:-(c-h);break;case"Auto":case"Center":var p=d.y+d.height/2;t.marginY="TopToBottom"===t.orientation?p-(a+h)/2:(a+h)/2-p}}else{switch(e.horizontalAlignment){case"Auto":case"Left":var g=d.x+e.margin.left;t.marginX="LeftToRight"===t.orientation?g:-g;break;case"Right":var u;u=d.x+d.width-e.margin.right,t.marginX="LeftToRight"===t.orientation?u-s:s-u;break;case"Center":p=void 0;p=d.width/2+d.x,t.marginX="LeftToRight"===t.orientation?p-(a+h)/2:(n+s)/2-p}switch(e.verticalAlignment){case"Top":t.marginY=d.y+e.margin.top-n;break;case"Auto":case"Center":t.marginY=d.y+d.height/2-(a+h)/2;break;case"Bottom":t.marginY=d.y+d.height-e.margin.bottom-h}}},e.prototype.placementStage=function(e,t,i){var r=this.coordinateAssignment(t,i,parent,e);return r.model=e,r.widestRankValue=null,this.placementStageExecute(r),{marginX:r.marginX+e.layout.horizontalSpacing,marginY:r.marginY+e.layout.verticalSpacing}},e.prototype.coordinateAssignment=function(e,t,i,r){var o={};return"TopToBottom"===r.layout.orientation||"BottomToTop"===r.layout.orientation?(o.horizontalSpacing=r.layout.horizontalSpacing,o.verticalSpacing=r.layout.verticalSpacing):(o.horizontalSpacing=r.layout.verticalSpacing,o.verticalSpacing=r.layout.horizontalSpacing),o.orientation="north",o.marginX=o.marginX=e,o.marginY=o.marginY=t,o},e.prototype.calculateWidestRank=function(e,t,i){var r=!1;"LeftToRight"!==e.model.layout.orientation&&"RightToLeft"!==e.model.layout.orientation||(r=!0);var o=-e.verticalSpacing,n=0;e.rankSizes=[],e.rankOffset=[];for(var a=i.maxRank;a>=0;a--){for(var s=0,h=i.ranks[a],d=r?e.marginY:e.marginX,l=0;l<h.length;l++){var c=h[l];if(this.crossReduction.isVertex(c)){var p=c;if(p.cell&&(p.cell.inEdges||p.cell.outEdges)){var g=this.nameTable[p.cell.name];p.width=g.actualSize.width,p.height=g.actualSize.height,s=Math.max(s,r?p.width:p.height)}}else if(c){var u=c,f=1;null!=u.edges&&(f=u.edges.length),c.width=10*(f-1)}r&&(c.height||(c.height=0)),d+=(r?c.height:c.width)/2,this.setXY(c,a,d,!!r),this.setTempVariable(c,a,d),(d+=(r?c.height:c.width)/2+e.horizontalSpacing)>e.widestRankValue&&(e.widestRankValue=d,e.widestRank=a),e.rankSizes[a]=d}e.rankOffset[a]=o;var m=s/2+n/2+e.verticalSpacing;n=s,"north"===e.orientation||"west"===e.orientation?o+=m:o-=m;for(l=0;l<h.length;l++){var y=h[l];this.setXY(y,a,o,!r)}}},e.prototype.setTempVariable=function(e,t,i){this.crossReduction.isVertex(e)?e.temp[0]=i:e.temp[t-e.minRank-1]=i},e.prototype.setXY=function(e,t,i,r,o,n){e&&e.cell?e.cell.inEdges||e.cell.outEdges?r?e.y[0]=i:e.x[0]=i:r?e.y[t-e.minRank-1]=i:e.x[t-e.minRank-1]=i:this.setEdgeXY(o,e,n,t)},e.prototype.rankCoordinates=function(e,t,i,r){var o=!1;"LeftToRight"!==e.model.layout.orientation&&"RightToLeft"!==e.model.layout.orientation||(o=!0);for(var n=r.ranks[t],a=0,s=(o?e.marginY:e.marginX)+(e.widestRankValue-e.rankSizes[t])/2,h=0;h<n.length;h++){var d=n[h];if(this.crossReduction.isVertex(d)){var l=this.nameTable[d.cell.name];d.width=l.actualSize.width,d.height=l.actualSize.height,a=Math.max(a,d.height)}else{var c=d,p=1;null!=c.edges&&(p=c.edges.length),o?d.height=10*(p-1):d.width=10*(p-1)}var g=(o?d.height:d.width)/2;s+=g,this.setXY(d,t,s,!!o),this.setTempVariable(d,t,s),s+=g+e.horizontalSpacing}},e.prototype.initialCoords=function(e,t,i){this.calculateWidestRank(e,t,i);for(var r=e.widestRank;r>=0;r--)r<i.maxRank&&this.rankCoordinates(e,r,t,i);for(r=e.widestRank+1;r<=i.maxRank;r++)r>0&&this.rankCoordinates(e,r,t,i)},e.prototype.isAncestor=function(e,t){if(null!=t&&null!=e.hashCode&&null!=t.hashCode&&e.hashCode.length<t.hashCode.length){if(e.hashCode===t.hashCode)return!0;if(null==e.hashCode||null==e.hashCode)return!1;for(var i=0;i<e.hashCode.length;i++)if(e.hashCode[i]!==t.hashCode[i])return!1;return!0}return!1},e.prototype.weightedCellSorter=function(e,t){var i={};return i.cell=e||null,i.weightedValue=t||0,i.visited=!1,i.rankIndex=null,i},e.prototype.minNode=function(e,t){for(var i=[],r={map:{}},o=[],n=0;n<=t.maxRank;n++){o[n]=t.ranks[n];for(var a=0;a<o[n].length;a++){var s=o[n][a],h=this.weightedCellSorter(s,n);h.rankIndex=a,h.visited=!0,i.push(h),t.setDictionaryForSorter(r,s,h,!0)}}for(var d=10*i.length,l=0;i.length>0&&l<=d;){var c=i.shift(),p=c.cell,g=c.weightedValue,u=c.rankIndex,f=this.crossReduction.getConnectedCellsOnLayer(p,g),m=this.crossReduction.getConnectedCellsOnLayer(p,g,!0),y=f.length,v=m.length,b=this.medianXValue(e,f,g+1),w=this.medianXValue(e,m,g-1),x=y+v,C=this.crossReduction.getTempVariable(p,g),S=C;x>0&&(S=(b*y+w*v)/x),1===y&&1===v?S=w*v/v:1===y&&(S=b*y/y);var P=!1,T=void 0;if(S<C-1)if(0===u)T=S,P=!0;else{var A=o[g][u-1],z=this.crossReduction.getTempVariable(A,g);(z=z+A.width/2+e.intraCellSpacing+p.width/2)<S?(T=S,P=!0):z<this.crossReduction.getTempVariable(p,g)-1&&(T=z,P=!0)}else if(S>C+1){if(u===o[g].length-1)T=S,P=!0;else{var O=o[g][u+1],I=this.crossReduction.getTempVariable(O,g);(I=I-O.width/2-e.intraCellSpacing-p.width/2)>S?(T=S,P=!0):I>this.crossReduction.getTempVariable(p,g)+1&&(T=I,P=!0)}}P&&(this.setTempVariable(p,g,T),this.updateNodeList(i,r,f,t),this.updateNodeList(i,r,m,t)),this.crossReduction.isVertex(c.cell)&&(c.visited=!1),l++}},e.prototype.updateNodeList=function(e,t,i,r){for(var o=0;o<i.length;o++){var n=i[o],a=r.getDictionaryForSorter(t,n);null!=a&&!1===a.visited&&(a.visited=!0,e.push(a))}},e.prototype.medianXValue=function(e,t,i){if(0===t.length)return 0;for(var r=[],o=0;o<t.length;o++)r[o]=this.crossReduction.getTempVariable(t[o],i);if(r.sort((function(e,t){return e-t})),t.length%2==1)return r[Math.floor(t.length/2)];var n=t.length/2;return(r[n-1]+r[n])/2},e.prototype.placementStageExecute=function(e){var t=!1;"LeftToRight"!==e.model.layout.orientation&&"RightToLeft"!==e.model.layout.orientation||(t=!0),e.jettyPositions={};var i=e.model;t?e.currentYDelta=0:e.currentXDelta=0,this.initialCoords(e,{model:i},i),this.minNode(e,i);var r=1e8;e.maxIterations||(e.maxIterations=8);for(var o=0;o<e.maxIterations;o++){if((t?e.currentYDelta:e.currentXDelta)<r){for(var n=0;n<i.ranks.length;n++)for(var a=i.ranks[n],s=0;s<a.length;s++){var h=a[s];this.setXY(h,n,this.crossReduction.getTempVariable(h,n),!!t)}r=t?e.currentYDelta:e.currentXDelta}t?e.currentYDelta=0:e.currentXDelta=0}this.setCellLocations(e,i)},e.prototype.setCellLocations=function(e,t){for(var i=this.getValues(t.vertexMapper),r=0;r<i.length;r++)this.setVertexLocation(e,i[r])},e.prototype.garphModelsetVertexLocation=function(e,t,i,r){var o=t.geometry,n=null;return null!=o&&(n={x:i,y:r,width:o.width,height:o.height},o.x===i&&o.y===r||(t.geometry=n)),n},e.prototype.setVertexLocation=function(e,t){var i=!1;"LeftToRight"!==e.model.layout.orientation&&"RightToLeft"!==e.model.layout.orientation||(i=!0);var r=t.cell,o=t.x[0]-t.width/2,n=t.y[0]-t.height/2;this.garphModelsetVertexLocation(e,r,o,n),i?(e.marginY||(e.marginY=0),e.marginY=Math.max(e.marginY,n+t.height)):(e.marginX||(e.marginX=0),e.marginX=Math.max(e.marginX,o+t.width))},e.prototype.getValues=function(e){var t=[];if(e.map)for(var i=0,r=Object.keys(e.map);i<r.length;i++){var o=r[i];t.push(e.map[o])}return t},e.prototype.crossingStage=function(e){this.crossReduction.execute(e)},e.prototype.layeringStage=function(e){this.initialRank(e),this.fixRanks(e)},e.prototype.initialRank=function(e){for(var t=e.startNodes,i=e.getDictionaryValues(e.vertexMapper),r=t.slice();t.length>0;){for(var o=(c=t[0]).connectsAsTarget,n=c.connectsAsSource,a=!0,s=1e8,h=0;h<o.length;h++){if(5270620!==(u=o[h]).temp[0]){a=!1;break}var d=u.source;s=Math.min(s,d.temp[0]-1)}if(a){if(c.temp[0]=s,e.maxRank||(e.maxRank=1e8),e.maxRank=Math.min(e.maxRank,s),null!=n)for(h=0;h<n.length;h++){(u=n[h]).temp[0]=5270620,-1===(d=u.target).temp[0]&&(t.push(d),d.temp[0]=-2)}t.shift()}else{var l=t.shift();if(t.push(c),l===c&&1===t.length)break}}for(h=0;h<i.length;h++)i[h].temp[0]-=e.maxRank;for(h=0;h<r.length;h++)for(var c,p=0,g=(o=(c=r[h]).connectsAsSource,0);g<o.length;g++){var u;d=(u=o[g]).target;c.temp[0]=Math.max(p,d.temp[0]+1),p=c.temp[0]}e.maxRank=1e8-e.maxRank},e.prototype.fixRanks=function(e){e.fixRanks()},e.prototype.cycleStage=function(e){var t={};e.startNodes=[];for(var i=e.getDictionaryValues(e.vertexMapper),r=[],o=0;o<i.length;o++)i[o].temp[0]=-1,r[i[o].id]=i[o];var n=null;if(null!=e.roots){var a=e.roots;n=[];for(o=0;o<a.length;o++)n[o]=e.getDictionary(e.vertexMapper,a[o]),null!=n[o]&&e.startNodes.push(n[o])}e.visit("removeParentConnection",n,!0,null,{seenNodes:t,unseenNodes:r});var s=e.clone(t,null,!0);e.visit("removeNodeConnection",r,!0,s,{seenNodes:t,unseenNodes:r})},e.prototype.remove=function(e,t){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),e},e.prototype.invert=function(e,t){var i=e.source;e.source=e.target,e.target=i,e.isReversed=!e.isReversed},e.prototype.getEdgesBetween=function(e,t,i){i=null!=i&&i;for(var r=this.getEdges(e),o=[],n=0;n<r.length;n++){var a=this.getVisibleTerminal(r[n],!0),s=this.getVisibleTerminal(r[n],!1);(a===e&&s===t||!i&&a===t&&s===e)&&o.push(r[n])}return o},e}(),gc=function(){function e(e,t,i,r){this.multiObjectIdentityCounter=0,this.dfsCount=0,this.hierarchicalUtil=new pc,this.roots=i,this.vertexMapper={map:{}};var o=[];this.layout=r,this.maxRank=1e8,this.edgeMapper={map:{}},this.hierarchicalLayout=e,this.createInternalCells(e,t,o,r);for(var n=0;n<t.length;n++){for(var a=o[n].connectsAsSource,s=0;s<a.length;s++){var h=a[s],d=h.edges;if(null!=d&&d.length>0){var l=d[0],c=e.getVisibleTerminal(l,!1),p=this.getDictionary(this.vertexMapper,c);o[n]===p&&(c=e.getVisibleTerminal(l,!0),p=this.getDictionary(this.vertexMapper,c)),null!=p&&o[n]!==p&&(h.target=p,0===p.connectsAsTarget.length&&(p.connectsAsTarget=[]),p.connectsAsTarget.indexOf(h)<0&&p.connectsAsTarget.push(h))}}o[n].temp[0]=1}}return e.prototype.resetEdge=function(e){var t={x:0,y:0,width:0,height:0,relative:!0};return e.geometry=t,e},e.prototype.createInternalCells=function(e,t,i,r){for(var o=0;o<t.length;o++){i[o]={x:[],y:[],temp:[],cell:t[o],id:t[o].name,connectsAsTarget:[],connectsAsSource:[],type:"internalVertex"},this.setDictionary(this.vertexMapper,t[o],i[o]);var n=e.getEdges(t[o]);i[o].connectsAsSource=[];for(var a=0;a<n.length;a++){var s=e.getVisibleTerminal(n[a],!1);if(s!==t[o]){var h=e.getEdgesBetween(t[o],s,!1),d=e.getEdgesBetween(t[o],s,!0);if(null!=h&&h.length>0&&2*d.length>=h.length){var l={x:[],y:[],temp:[],edges:h,ids:[]};if(r.enableLayoutRouting)for(var c=0;c<h.length;c++){var p=h[c];this.setDictionary(this.edgeMapper,void 0,l,p.id),this.resetEdge(p)}l.source=i[o];for(var g=0;g<h.length;g++)l.ids.push(h[g].id);l.source=i[o],i[o].connectsAsSource||(i[o].connectsAsSource=[]),i[o].connectsAsSource.indexOf(l)<0&&i[o].connectsAsSource.push(l)}}}i[o].temp[0]=0}},e.prototype.fixRanks=function(){var e=[];this.ranks=[];for(var t=0;t<this.maxRank+1;t++)e[t]=[],this.ranks[t]=e[t];var i=null;if(null!=this.roots){var r=this.roots;i=[];for(t=0;t<r.length;t++){var o=r[t],n=this.getDictionary(this.vertexMapper,o);i[t]=n}}this.visit("updateMinMaxRank",i,!1,null,{seenNodes:null,unseenNodes:null,rankList:e})},e.prototype.updateMinMaxRank=function(e,t,i){var r=i.parent,o=i.root,n=i.edge,a=i.rankList;if((o.maxRank||0===o.maxRank||(o.maxRank=-1),o.minRank||0===o.minRank||(o.minRank=-1),0===t&&o.maxRank<0&&o.minRank<0&&(a[o.temp[0]].push(o),o.maxRank=o.temp[0],o.minRank=o.temp[0],o.temp[0]=a[o.maxRank].length-1),null!=r&&null!=n)&&r.maxRank-o.maxRank>1){n.maxRank=r.maxRank,n.minRank=o.maxRank,n.temp=[],n.x=[],n.y=[];for(var s=n.minRank+1;s<n.maxRank;s++)a[s].push(n),this.hierarchicalUtil.setTempVariable(n,s,a[s].length-1)}},e.prototype.setDictionary=function(e,t,i,r){if(r){n=e.map[r];return e.map[r]=i,n}var o=t.name,n=e.map[o];return e.map[o]=i,n},e.prototype.setDictionaryForSorter=function(e,t,i,r){var o=t.id,n=e.map[o];return e.map[o]=i,n},e.prototype.getDictionary=function(e,t){this.multiObjectIdentityCounter||0===this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=t.name;return i?e.map[i]:t.layoutObjectId?e.map[t.layoutObjectId]:(t.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,t.layoutObjectId)},e.prototype.getDictionaryForSorter=function(e,t){this.multiObjectIdentityCounter||0===this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=t.id;return i?e.map[i]:t.layoutObjectId?e.map[t.layoutObjectId]:(t.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,t.layoutObjectId)},e.prototype.getDictionaryValues=function(e){for(var t=[],i=0,r=Object.keys(e.map);i<r.length;i++){var o=r[i];t.push(e.map[o])}return t},e.prototype.visit=function(e,t,i,r,o){if(null!=t){for(var n=0;n<t.length;n++){var a=t[n];null!=a&&(null==r&&(r=new Object),o.parent=null,o.root=a,o.edge=null,i?(a.hashCode=[],a.hashCode[0]=this.dfsCount,a.hashCode[1]=n,this.extendedDfs(e,r,n,0,o)):this.depthFirstSearch(e,r,0,o))}this.dfsCount++}},e.prototype.depthFirstSearch=function(e,t,i,r){var o=r.root;if(null!=o){var n=o.id;if(null==t[n]){t[n]=o,this.updateConnectionRank(e,i,0,r);for(var a=o.connectsAsSource.slice(),s=0;s<a.length;s++){var h=a[s],d=h.target;r.parent=o,r.root=d,r.edge=h,this.depthFirstSearch(e,t,i+1,r)}}else this.updateConnectionRank(e,i,1,r)}},e.prototype.updateConnectionRank=function(e,t,i,r){var o=r.parent,n=r.root,a=r.edge;if("removeParentConnection"===e||"removeNodeConnection"===e){var s="removeNodeConnection"===e;this.removeConnectionEdge(o,n,a,t,r,s)}"updateMinMaxRank"===e&&this.updateMinMaxRank(t,i,r)},e.prototype.removeConnectionEdge=function(e,t,i,r,o,n){var a=o.seenNodes,s=o.unseenNodes;this.hierarchicalUtil.isAncestor(t,e)&&(this.hierarchicalUtil.invert(i,0),this.hierarchicalUtil.remove(i,e.connectsAsSource),n?(t.connectsAsSource.push(i),e.connectsAsTarget.push(i),this.hierarchicalUtil.remove(i,t.connectsAsTarget)):(e.connectsAsTarget.push(i),this.hierarchicalUtil.remove(i,t.connectsAsTarget),t.connectsAsSource.push(i))),a[t.id]=t,delete s[t.id]},e.prototype.extendedDfs=function(e,t,i,r,o){var n=o.parent,a=o.root;o.edge;if(null!=a){if(null!=n&&(null==a.hashCode||a.hashCode[0]!==n.hashCode[0])){var s=n.hashCode.length+1;a.hashCode=n.hashCode.slice(),a.hashCode[s-1]=i}var h=a.id;if(null==t[h]){t[h]=a,this.updateConnectionRank(e,r,0,o);for(var d=a.connectsAsSource.slice(),l=0;l<d.length;l++){var c=d[l],p=c.target;o.parent=a,o.root=p,o.edge=c,this.extendedDfs(e,t,l,r+1,o)}}else this.updateConnectionRank(e,r,1,o)}},e.prototype.clone=function(e,t,i){if(i=null!=i&&i,null!=e&&"function"==typeof e.constructor){for(var o=e.constructor(),n=0,a=Object.keys(e);n<a.length;n++){var s=a[n];"layoutObjectId"!==s&&(null==t||t.indexOf(s)<0)&&(i||"object"!==r(e[s]))&&(o[s]=e[s])}return o}return null},e}(),uc=function(){function e(){}return e.prototype.calculateCrossings=function(e){for(var t=e.ranks.length,i=0,r=1;r<t;r++)i+=this.calculateRankCrossing(r,e);return i},e.prototype.getTempVariable=function(e,t){return e?this.isVertex(e)?e.temp[0]:e.temp[t-e.minRank-1]:0},e.prototype.calculateRankCrossing=function(e,t){for(var i=0,r=t.ranks[e],o=t.ranks[e-1],n=[],a=0;a<r.length;a++){for(var s=r[a],h=this.getTempVariable(s,e),d=this.getConnectedCellsOnLayer(s,e,!0),l=[],c=0;c<d.length;c++){var p=d[c],g=this.getTempVariable(p,e-1);l.push(g)}l.sort((function(e,t){return e-t})),n[h]=l}var u=[];for(a=0;a<n.length;a++)u=u.concat(n[a]);for(var f=1;f<o.length;)f<<=1;var m=2*f-1;f-=1;var y=[];for(a=0;a<m;++a)y[a]=0;for(a=0;a<u.length;a++){var v=u[a]+f;for(++y[v];v>0;)v%2&&(i+=y[v+1]),++y[v=v-1>>1]}return i},e.prototype.execute=function(e){this.nestedBestRanks=[];for(var t=0;t<e.ranks.length;t++)this.nestedBestRanks[t]=e.ranks[t].slice();var i=0,r=this.calculateCrossings(e);for(t=0;t<24&&i<2;t++){this.weightedMedian(t,e);var o=this.calculateCrossings(e);if(o<r){r=o,i=0;for(var n=0;n<this.nestedBestRanks.length;n++)for(var a=e.ranks[n],s=0;s<a.length;s++){var h=a[s],d=this.nestedBestRanks[n][h.temp[0]],l=!0;h.edges&&d&&!d.edges&&(l=!1),d&&l&&(this.nestedBestRanks[n][h.temp[0]]=h)}}else{i++;for(n=0;n<this.nestedBestRanks.length;n++)for(a=e.ranks[n],s=0;s<a.length;s++){h=a[s];this.setTempVariable(h,n,s)}}if(0===r)break}var c=[],p=[];for(t=0;t<e.maxRank+1;t++)p[t]=[],c[t]=p[t];for(t=0;t<this.nestedBestRanks.length;t++)for(n=0;n<this.nestedBestRanks[t].length;n++)p[t].push(this.nestedBestRanks[t][n]);e.ranks=c},e.prototype.isVertex=function(e){return!(!e||!e.cell||!e.cell.inEdges&&!e.cell.outEdges)},e.prototype.weightedMedian=function(e,t){var i=e%2==0;if(i)for(var r=t.maxRank-1;r>=0;r--)this.medianRank(r,i);else for(r=1;r<t.maxRank;r++)this.medianRank(r,i)},e.prototype.getConnectedCellsOnLayer=function(e,t,i){void 0===i&&(i=!1);var r="nextLayerConnectedCells",o="connectsAsTarget";if(i&&(r="previousLayerConnectedCells",o="connectsAsSource"),e){if(this.isVertex(e)){if(null==e[r]){e[r]=[],e[r][0]=[];for(var n=0;n<e[o].length;n++){var a=e[o][n];void 0===a.maxRank&&(a.maxRank=-1),-1===a.maxRank||(i?a.minRank===t-1:a.maxRank===t+1)?e[r][0].push(i?a.target:a.source):e[r][0].push(a)}}return e[r][0]}if(null==e[r]){e[r]=[];for(n=0;n<e.temp.length;n++)e[r][n]=[],n===(i?0:e.temp.length-1)?e[r][n].push(i?e.target:e.source):e[r][n].push(e)}return e[r][t-e.minRank-1]}return null},e.prototype.medianValue=function(e,t){for(var i=[],r=0,o=0;o<e.length;o++){var n=e[o];i[r++]=this.getTempVariable(n,t)}if(i.sort((function(e,t){return e-t})),r%2==1)return i[Math.floor(r/2)];if(2===r)return(i[0]+i[1])/2;var a=r/2,s=i[a-1]-i[0],h=i[r-1]-i[a];return(i[a-1]*h+i[a]*s)/(s+h)},e.prototype.setTempVariable=function(e,t,i){e&&(e.temp[0]=i)},e.prototype.medianRank=function(e,t){for(var i=this.nestedBestRanks[e].length,r=[],o=[],n=0;n<i;n++){var a=this.nestedBestRanks[e][n],s={medianValue:0};s.cell=a;var h=void 0,d=void 0;d=t?e+1:e-1,null!=(h=t?this.getConnectedCellsOnLayer(a,e):this.getConnectedCellsOnLayer(a,e,!0))&&0!==h.length?(s.medianValue=this.medianValue(h,d),r.push(s)):o[this.getTempVariable(a,e)]=!0}r.sort(this.compare);for(n=0;n<i;n++)if(null==o[n]&&r.length>0){a=r.shift().cell;this.setTempVariable(a,e,n)}},e.prototype.compare=function(e,t){if(null!=e&&null!=t){if(t.medianValue>e.medianValue)return-1;if(t.medianValue<e.medianValue)return 1}return 0},e}(),fc=(dc=function(e,t){return(dc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}dc(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),mc=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},yc=function(e){var t=e;return t.sourcePoint||t.targetPoint||t.sourceID||t.targetID||t.sourcePortID||t.targetPortID||t.sourceDecorator||t.targetDecorator?wr:(e.shape&&(e.shape instanceof ls||e.shape.type),js)},vc=function(e){function t(t,i,r,o){return e.call(this,t,i,r,o)||this}return fc(t,e),mc([sf.base.Property("")],t.prototype,"id",void 0),mc([sf.base.Property()],t.prototype,"height",void 0),mc([sf.base.Property(!0)],t.prototype,"expanded",void 0),mc([sf.base.Property("")],t.prototype,"iconCss",void 0),mc([sf.base.Property("")],t.prototype,"title",void 0),mc([sf.base.CollectionFactory(yc)],t.prototype,"symbols",void 0),t}(sf.base.ChildProperty),bc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fc(t,e),mc([sf.base.Property()],t.prototype,"width",void 0),mc([sf.base.Property()],t.prototype,"height",void 0),t}(sf.base.ChildProperty),wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fc(t,e),mc([sf.base.Property()],t.prototype,"width",void 0),mc([sf.base.Property()],t.prototype,"height",void 0),mc([sf.base.Complex({},a)],t.prototype,"offset",void 0),t}(sf.base.ChildProperty),xc=function(t){function r(e,i){var r,o,n=t.call(this,e,i)||this;n.symbolTable={},n.childTable={},n.info="info",n.oldObject=null,n.laneTable={},n.isExpand=!1,n.isExpandMode=!1,n.isMethod=!1,n.paletteid=88123,n.checkOnRender=!1,n.helper=function(e){var t,i=n.selectedSymbol&&n.selectedSymbol.id||e.sender.target.id.split("_container")[0],r=n.symbolTable[i];return r&&n.selectedSymbol&&(n.selectedSymbols=n.selectedSymbol.id===r.id?r:n.selectedSymbol,(t=n.getSymbolPreview(n.selectedSymbols,e.sender,n.element)).setAttribute("paletteId",n.element.id)),t};for(var a=0;n&&n.palettes&&a<n.palettes.length;a++)for(var s=0;s<n.palettes[a].symbols.length;s++)r=n.palettes[a].symbols[s],o=e.palettes[a].symbols[s],r&&"UmlActivity"===r.shape.type&&On(o,r),(n.nodeDefaults||n.connectorDefaults)&&Ln(r,o,r instanceof js?n.nodeDefaults:n.connectorDefaults);return n}return fc(r,t),r.prototype.onPropertyChanged=function(e,t){for(var i=!1,r=0,o=Object.keys(e);r<o.length;r++){switch(o[r]){case"width":this.element.style.width=this.width.toString();break;case"height":this.element.style.height=this.height.toString();break;case"symbolPreview":break;case"symbolWidth":case"symbolHeight":case"getSymbolInfo":i=!this.isReact;break;case"enableSearch":if(e.enableSearch&&!sf.base.isBlazor())this.createTextbox();else{var n=document.getElementById(this.element.id+"_search");n&&n.parentNode.removeChild(n)}break;case"palettes":for(var a=0,s=Object.keys(e.palettes);a<s.length;a++){var h=s[a],d=Number(h);if(sf.base.isBlazor()||this.accordionElement.items[d]||(this.accordionElement.items[d]={header:e.palettes[d].title||"",expanded:e.palettes[d].expanded,iconCss:e.palettes[d].iconCss||""}),e.palettes[d].height)document.getElementById(this.palettes[d].id+"_content").style.height=e.palettes[d].height+"px";void 0!==e.palettes[d].iconCss&&(sf.base.isBlazor()||(this.accordionElement.items[d].iconCss=e.palettes[d].iconCss||"",i=!0)),void 0===e.palettes[d].expanded||sf.base.isBlazor()||(this.palettes[d].isInteraction?this.palettes[d].isInteraction=!1:(this.accordionElement.items[d].expanded=e.palettes[d].expanded,this.isExpand=!0),this.isExpandMode||this.isMethod||this.isExpand||(this.isExpand=!0)),sf.base.isBlazor()&&null!==e.palettes[d].symbols&&(i=!0),sf.base.isBlazor()&&null===e.palettes[d].symbols&&this.updateBlazorProperties(e)}break;case"enableAnimation":sf.base.isBlazor()||(this.enableAnimation?this.accordionElement.animation={expand:{duration:400},collapse:{duration:400}}:this.accordionElement.animation={expand:{duration:0},collapse:{duration:0}});break;case"expandMode":sf.base.isBlazor()||(this.accordionElement.expandMode=this.expandMode,i=!0,this.isExpandMode=!0);break;case"allowDrag":this.allowDrag=e.allowDrag,this.allowDrag?(this.initDraggable(),this.draggable.helper=this.helper):this.draggable.helper=function(){return null}}}if(i&&this.refreshPalettes(),this.isExpand&&!i){this.refresh(),this.isExpand=!1;for(var l=0;l<this.palettes.length;l++){var c=this.palettes[l].id;window[c]&&window[c].length>1&&(window[c][1].parentNode.removeChild(window[c][1]),window[c][1]=null)}}this.isMethod=!1},r.prototype.updateBlazorProperties=function(e){if(window&&window.Blazor){var t={methodName:"UpdateBlazorProperties",paletteobj:{palette:e.palettes}};window.sfBlazor.updateBlazorProperties(t,this)}},r.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},r.prototype.preRender=function(){var e=this;if(""===this.element.id){var t=document.getElementsByClassName("e-symbolpalette").length;this.element.id="symbolpalette_"+this.paletteid+"_"+t}if(this.element.style.overflow="auto",this.element.style.height=this.height.toString(),this.element.style.width=this.width.toString(),this.enableSearch&&!sf.base.isBlazor()&&this.createTextbox(),!sf.base.isBlazor()){var i=hh("div",{id:this.element.id+"_container"});this.accordionElement=new sf.navigations.Accordion({expandMode:this.expandMode}),this.enableAnimation||(this.accordionElement.animation={expand:{duration:0},collapse:{duration:0}}),this.accordionElement.created=function(){e.checkOnRender=!0},this.accordionElement.expanded=function(t){var i=e.accordionElement.items.indexOf(t.item),r=e.allowServerDataBinding;e.allowServerDataBinding=!1,e.palettes[i].expanded=t.isExpanded,e.palettes[i].isInteraction=!0,e.allowServerDataBinding=r},this.accordionElement.expanding=function(t){if(e.checkOnRender){var i={element:t.element,content:t.content,index:t.index,cancel:!1,isExpanded:t.isExpanded,palette:e.palettes[t.index]};e.trigger("paletteExpanding",i),t.cancel=i.cancel}},this.element.appendChild(i)}window.measureElement&&(window.measureElement=null),vh(),this.unWireEvents(),this.wireEvents()},r.prototype.render=function(){this.diagramRenderer=new qh(this.element.id,new Zh,!1),this.svgRenderer=new qh(this.element.id,new Zh,!0),this.updatePalettes(),sf.base.isBlazor()||this.accordionElement.appendTo("#"+this.element.id+"_container"),this.renderComplete(),sf.base.isBlazor()&&this.element.classList.remove("e-symbolpalette-hidden")},r.prototype.getModuleName=function(){return"SymbolPalette"},r.prototype.requiredModules=function(){var e=[];return e.push({member:"Bpmn",args:[]}),e},r.prototype.destroy=function(){if(this.allowDrag){this.draggable.destroy(),this.unWireEvents(),this.notify("destroy",{}),t.prototype.destroy.call(this);var e=document.getElementById(this.element.id+"_container");if(e){this.element.removeChild(e);if(window.measureElement){window.measureElement.usageCount-=1;window.measureElementCount--,0===window.measureElementCount&&(window.measureElement.parentNode.removeChild(window.measureElement),window.measureElement=null)}}(e=document.getElementById(this.element.id+"_search"))&&e.parentNode.removeChild(e),this.element.classList.remove("e-symbolpalette")}},r.prototype.addPalettes=function(e){for(var t,i=0;i<e.length;i++){var r=this.allowServerDataBinding;this.isProtectedOnChange=!0,this.allowServerDataBinding=!1,t=new vc(this,"palettes",e[i],!0),this.palettes.push(t),this.initSymbols(t),this.allowServerDataBinding=r,this.isProtectedOnChange=!1,this.renderPalette(t)}this.bulkChanges={},sf.base.isBlazor()||this.accordionElement.refresh()},r.prototype.removePalette=function(e){for(var t=0;t<this.palettes.length;t++)if(this.palettes[t].id===e){this.palettes.splice(t,1),sf.base.isBlazor()||this.accordionElement.items.splice(t,1);break}},r.prototype.removePalettes=function(e){var t=this.allowServerDataBinding;this.allowServerDataBinding=!1;for(var i=0;i<e.length;i++)this.removePalette(e[i]);sf.base.isBlazor()||this.accordionElement.refresh(),this.allowServerDataBinding=t},r.prototype.initSymbols=function(e){for(var t=[],i=0,r=0,o=0,n=e.symbols;o<n.length;o++){if("SwimLane"===(S=n[o]).shape.type){var a=S,s=S.shape,h="Horizontal"===s.orientation;if(s.isLane){i=h?this.symbolHeight-this.symbolHeight/2:this.symbolHeight-this.symbolHeight/4,r=h?this.symbolWidth-this.symbolWidth/4:this.symbolWidth-this.symbolWidth/2,this.laneTable[S.id]={height:i,width:r};var d=s.lanes[0].header,l=s.lanes[0].style,c=d.style,p={id:"header"+xh(),shape:{type:"Basic",shape:"Rectangle"},width:h?d.width:a.width,height:h?a.height:d.height,style:c,annotations:[{content:d.annotation.content}]};p.offsetX=p.width/2,p.offsetY=p.height/2,this.addPaletteItem(e.id,p);var g={id:"lane"+xh(),shape:{type:"Basic",shape:"Rectangle"},width:h?a.width-d.width:a.width,height:h?a.height:a.height-d.height,style:l};g.offsetX=h?p.width+g.width/2:g.width/2,g.offsetY=h?g.height/2:p.height+g.height/2,this.addPaletteItem(e.id,g),a.children=[p.id,g.id]}else s.isPhase&&(i=a.height?a.height:this.symbolHeight,r=a.width?a.width:this.symbolWidth,S.shape.type="Path",S.shape.data=h?"M0,0 L"+r+",0":"M0,0 L0,"+r)}if(S instanceof js){var u=Wh(this.getNodeDefaults);u&&u(S,this)}else if(S instanceof wr){var f=Wh(this.getConnectorDefaults);f&&f(S,this)}this.symbolTable[S.id]=S,S instanceof js&&S.children&&t.push(S)}for(var m=0;m<t.length;m++)for(var y=void 0,v=0;v<t[m].children.length;v++)(y=this.symbolTable[t[m].children[v]])&&(this.childTable[y.id]=y,y.parentId=t[m].id);for(var b=0,w=e.symbols;b<w.length;b++){(S=w[b])instanceof js&&S.children||this.prepareSymbol(S)}for(var x=0,C=t;x<C.length;x++){var S=C[x];this.prepareSymbol(S)}},r.prototype.renderPalette=function(e){var t=sf.base.isBlazor()?"overflow:auto;":"display:none;overflow:auto;";e.height&&(t+="height:"+e.height+"px");var i,r=document.getElementById(e.id);if(sf.base.isBlazor()&&null!=r?(i=hh("div",{id:e.id+"_content",style:t,class:"e-remove-palette"}),r.appendChild(i)):(i=hh("div",{id:e.id,style:t,class:"e-remove-palette"}),this.element.appendChild(i)),!sf.base.isBlazor()){var o={header:e.title,expanded:e.expanded,content:"#"+e.id,iconCss:e.iconCss};this.accordionElement.items.push(o)}this.renderSymbols(e,i)},r.prototype.addPaletteItem=function(e,t,i){t=Ah(t);for(var r=0;r<this.palettes.length;r++){var o=this.palettes[r];if(-1!==o.id.indexOf(e)){for(var n=[void 0,o,"symbols",{},!0],a=new(Function.prototype.bind.apply(yc(t),n)),s=0;s<Object.keys(t).length;s++){var h=this.allowServerDataBinding;this.allowServerDataBinding=!1,a[Object.keys(t)[s]]=t[Object.keys(t)[s]],this.allowServerDataBinding=h}Ln(a,t,a instanceof js?this.nodeDefaults:this.connectorDefaults),o.symbols.push(a);var d=this.allowServerDataBinding;if(this.allowServerDataBinding=!1,this.prepareSymbol(a),this.allowServerDataBinding=d,this.symbolTable[a.id]=a,i)this.childTable[a.id]=a;else{var l=void 0;(l=sf.base.isBlazor()?document.getElementById(o.id+"_content"):document.getElementById(o.id))&&l.appendChild(this.getSymbolContainer(a,l))}break}}},r.prototype.removePaletteItem=function(e,t){for(var i,r=0;r<this.palettes.length;r++){var o=this.palettes[r];if(-1!==o.id.indexOf(e))for(var n=0,a=o.symbols;n<a.length;n++){var s=a[n];if(-1!==s.id.indexOf(t)){var h=o.symbols.indexOf(s);if(o.symbols.splice(h,1),s.children)for(var d=s.children,l=0;l<d.length;l++)delete this.symbolTable[d[l]];delete this.symbolTable[s.id];var c=document.getElementById(s.id+"_container");c.parentNode.removeChild(c),i=!0;break}}if(i)break}},r.prototype.prepareSymbol=function(e){var t,r,o,n,a,s=new Ja,h=e,d=new Te,l=e instanceof js?e.initContainer():null;l&&!l.children&&(l.children=[]);var c=Wh(this.getSymbolTemplate);if(c&&(a=c(e)),a||(h.children?a=this.getContainer(h,l):(a=e.init(this),e instanceof js&&e.parentId&&l.children.push(a))),!e.parentId){var p={width:this.symbolWidth,height:this.symbolHeight},g=Wh(this.getSymbolInfo);if(g?p=g(e):sf.base.isBlazor()&&(p=this.getBlazorSymbolInfo(e,p)),p=p||this.symbolInfo||{},e.shape&&e.shape.isPhase&&(p.width=p.width||this.symbolWidth,p.height=p.height||this.symbolHeight),a.relativeMode="Object",a.horizontalAlignment=a.verticalAlignment="Center",d.style.strokeColor=d.style.fill="none",d.children=[a],a.measure(new i),a.arrange(a.desiredSize),t=p.width=p.width||(void 0!==h.width?a.actualSize.width:void 0)||this.symbolWidth,o=p.height=p.height||(void 0!==h.height?a.actualSize.height:void 0)||this.symbolHeight,void 0!==t&&void 0!==o){var u=t,f=o,m=!!e.shape.isPhase;void 0!==this.symbolWidth?u=this.symbolWidth-this.symbolMargin.left-this.symbolMargin.right:t+=h.style.strokeWidth,void 0!==this.symbolHeight?f=this.symbolHeight-this.symbolMargin.top-this.symbolMargin.bottom:o+=h.style.strokeWidth,p.description&&""!==p.description.text&&(f-=20),r=u/(!m&&a.width||t),n=f/(!m&&a.height||o),p.fit&&(r=u/p.width,n=f/p.height),t=u,o=f,r=n=Math.min(r,n),d.width=t,d.height=o,a.width=p.width,a.height=p.height,this.scaleSymbol(e,d,r,n,t,o)}else{var y=void 0;e instanceof wr&&(y=Wt(e)),a.width=e.width||y?y.width:a.actualSize.width,a.height=e.height||y?y.height:a.actualSize.height}e.wrapper=s,s.children=[d],a.pivot=s.pivot={x:0,y:0},s.id=a.id+"_symbol",s.style.fill=s.style.strokeColor="transparent",e instanceof js?(s.offsetX=e.style.strokeWidth/2,s.offsetY=e.style.strokeWidth/2):(s.offsetX=.5,s.offsetY=.5),this.getSymbolDescription(p,t,s),s.measure(new i),s.arrange(s.desiredSize),p.width=p.width||a.actualSize.width,p.height=p.height||a.actualSize.height,e[this.info]=p}e.parentId&&(l.measure(new i(h.width,h.height)),l.arrange(l.desiredSize))},r.prototype.getBlazorSymbolInfo=function(e,t){var i=e.symbolInfo;return i&&(t.description=i.description||this.symbolInfo.description,t.fit=i.fit||this.symbolInfo.fit,t.height=i.height||this.symbolInfo.height,t.width=i.width||this.symbolInfo.width,t.tooltip=i.tooltip||this.symbolInfo.tooltip,t.template=i.template||this.symbolInfo.template),t},r.prototype.getContainer=function(e,t){var r;t.measureChildren=!1;var o=e.children;t.children=[];for(var n=0;n<o.length;n++)this.symbolTable[o[n]]&&t.children.push(this.symbolTable[o[n]].wrapper);return t.measure(new i(e.width,e.height)),t.arrange(t.desiredSize),0===t.bounds.x&&0===t.bounds.y||(Pa(e,(r=t.bounds).x,r.y,this.symbolTable,!1,this),t=this.getContainer(e,t)),t},r.prototype.getSymbolDescription=function(e,t,i){if(e&&e.description&&e.description.text){var r=new Se;e.description.overflow=e.description.overflow||"Ellipsis",e.description.wrap=e.description.wrap||"WrapWithOverflow",r.id=i.id+"_text",r.content=e.description.text,r.width=t,r.height=20,r.style.strokeColor="transparent",r.style.fill="transparent",r.style.strokeWidth=0,r.style.textWrapping=e.description.wrap,r.style.textOverflow=e.description.overflow,r.margin={left:0,right:0,top:0,bottom:5},i.children.push(r)}},r.prototype.renderSymbols=function(e,t){for(var i=0,r=e.symbols;i<r.length;i++){var o=r[i];o.parentId||this.getSymbolContainer(o,t)}},r.prototype.getSymbolPreview=function(e,t,i){var r,o,n;this.allowServerDataBinding=!1;var a=e.wrapper.children[0].desiredSize.width+e.style.strokeWidth,s=e.wrapper.children[0].desiredSize.height+e.style.strokeWidth,h=e.wrapper.children[0].children[0],d=e.previewSize;if(e&&(d.width||d.height)||void 0!==this.symbolPreview.width||void 0!==this.symbolPreview.height){a=(d.width||this.symbolPreview.width||a)-e.style.strokeWidth,s=(d.height||this.symbolPreview.height||s)-e.style.strokeWidth,o=a/h.actualSize.width,n=s/h.actualSize.height,o=n=Math.min(o,n);var l=h.actualSize.width*o,c=h.actualSize.height*n;e.wrapper.children[0].width=a,e.wrapper.children[0].height=s,this.measureAndArrangeSymbol(h,e instanceof js),this.scaleSymbol(e,e.wrapper.children[0],o,n,l,c,!0),a=l,s=c}var p={x:h.offsetX,y:h.offsetY};h.offsetX=h.offsetY=e.style.strokeWidth/2,h.pivot={x:0,y:0},this.measureAndArrangeSymbol(h,e instanceof js);var g,u=hh("div",{draggable:"true",class:"e-dragclone",style:"pointer-events:none"});document.body.appendChild(u);var f="margin:5px;";if("Native"===e.shape.type){r=dh("svg",{id:e.id+"_preview",width:Math.ceil(a)+1,height:Math.ceil(s)+1});var m=dh("g",{id:e.id+"_g"});r.appendChild(m),u.appendChild(r),this.svgRenderer.renderElement(h,m,void 0,void 0,r)}else if("HTML"===e.shape.type)g=this.getHtmlSymbol(e,r,u,s,a,!0);else if(e.children&&e.children.length>0&&Bn(e,"HTML",this.childTable))g=this.getGroupParent(e,r,u,e.wrapper.actualSize.height,e.wrapper.actualSize.width,!0);else{r=Fh.createCanvas(e.id+"_preview",2*(Math.ceil(a)+e.style.strokeWidth+1),2*(Math.ceil(s)+e.style.strokeWidth+1)),u.appendChild(r),"Basic"===e.shape.type||"Flow"===e.shape.type?f+="transform: scale(0.5) translate(-"+r.width/2+"px, -"+r.height/2+"px);":f+="transform:scale(0.5);",r.setAttribute("transform-origin","0 0");var y=2;e instanceof wr&&(y=1.9),r.getContext("2d").setTransform(y,0,0,y,0,0),this.diagramRenderer.renderElement(h,r,void 0)}return mh(g&&("HTML"===e.shape.type||e.children&&e.children.length>0)?g:r,f),h.offsetX=p.x,h.offsetY=p.y,this.allowServerDataBinding=!0,u},r.prototype.measureAndArrangeSymbol=function(t,r){t.children&&!r&&(t.children[0].transform=e.Transform.Self),t.measure(new i),t.arrange(t.desiredSize),t.children&&(t.children[0].transform=e.Transform.Parent)},r.prototype.updateSymbolSize=function(e,t,r){var o=e.wrapper.children[0].children[0],n=e.style.strokeWidth;o.width=(t||o.width)-(n+1),o.height=(r||o.height)-(n+1),e.wrapper.measure(new i),e.wrapper.arrange(e.wrapper.desiredSize)},r.prototype.getSymbolContainer=function(e,t,i){var r,o,n,a=this.symbolTable[e.id][this.info],s=this.getSymbolSize(e,a),h=s.width+1,d=s.height+1,l=hh("div",{id:e.id+"_container",style:"width:"+h+"px;height:"+d+"px;float:left;overflow:hidden",title:a.tooltip?a.tooltip:e.id});if(t.appendChild(l),"Native"===e.shape.type)r=dh("svg",{id:e.id,width:Math.ceil(e.wrapper.actualSize.width)+1,height:Math.ceil(e.wrapper.actualSize.height)+1}),o=dh("g",{id:e.id+"_g"}),r.appendChild(o),l.appendChild(r),this.updateSymbolSize(e),this.svgRenderer.renderElement(e.wrapper,o,void 0,void 0,r);else if("HTML"===e.shape.type)n=this.getHtmlSymbol(e,r,l,e.wrapper.actualSize.height,e.wrapper.actualSize.width,!1);else if(e.children&&e.children.length>0&&Bn(e,"HTML",this.childTable))n=this.getGroupParent(e,r,l,e.wrapper.actualSize.height,e.wrapper.actualSize.width,!1);else{r=Fh.createCanvas(e.id,Math.ceil(2*(e.wrapper.actualSize.width+e.style.strokeWidth))+1,Math.ceil(2*(e.wrapper.actualSize.height+e.style.strokeWidth))+1),l.appendChild(r);var c=2;e instanceof wr&&(c=1.9),r.getContext("2d").setTransform(c,0,0,c,0,0),this.diagramRenderer.renderElement(e.wrapper,o||r,void 0,void 0,void 0,void 0,!0,void 0,!0)}if(!i){var p=e.wrapper.actualSize.width+e.style.strokeWidth,g=e.wrapper.actualSize.height+e.style.strokeWidth,u="pointer-events:none;transform-origin:0 0;overflow:hidden;";return e.shape.isPhase?"Horizontal"===e.shape.orientation?u+="margin-left:"+Math.max(this.symbolMargin.left,(h-p)/2)+"px;margin-top:"+s.height/2+"px;":u+="margin-left:"+s.width/2+"px;margin-top:"+Math.max(this.symbolMargin.top,(d-g)/2)+"px;":u+="margin-left:"+Math.max(this.symbolMargin.left,(h-p)/2)+"px;margin-top:"+Math.max(this.symbolMargin.top,(d-g)/2)+"px;",r instanceof HTMLCanvasElement&&(u+="transform:scale(.5,.5);"),mh(n&&("HTML"===e.shape.type||e.children&&e.children.length>0)?n:r,u),l.classList.add("e-symbol-draggable"),l}return r},r.prototype.getGroupParent=function(e,t,i,r,o,n){var a=hh("div",{id:e.id+(n?"_html_div_preview":"_html_div")}),s=hh("div",{id:e.id+(n?"_htmlLayer_preview":"_htmlLayer"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute",class:"e-html-layer"}),h=hh("div",{id:e.id+(n?"_htmlLayer_div_preview":"_htmlLayer_div"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute"});return s.appendChild(h),a.appendChild(s),t=Fh.createCanvas(n?e.id+"_preview":e.id,Math.ceil(o)+1,Math.ceil(r)+1),a.appendChild(t),i.appendChild(a),this.diagramRenderer.renderElement(e.wrapper.children[0].children[0],t,s),a},r.prototype.getHtmlSymbol=function(e,t,i,r,o,n){var a=hh("div",{id:e.id+(n?"_html_div_preview":"_html_div")}),s=hh("div",{id:e.id+(n?"_htmlLayer_preview":"_htmlLayer"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute",class:"e-html-layer"}),h=hh("div",{id:e.id+(n?"_htmlLayer_div_preview":"_htmlLayer_div"),style:"width:"+Math.ceil(o+1)+"px;height:"+Math.ceil(r+1)+"px;position:absolute"});return s.appendChild(h),a.appendChild(s),t=Fh.createCanvas(e.id,Math.ceil(2*(e.wrapper.actualSize.width+e.style.strokeWidth))+1,Math.ceil(2*(e.wrapper.actualSize.height+e.style.strokeWidth))+1),i.appendChild(t),t.getContext("2d").setTransform(2,0,0,2,0,0),a.appendChild(t),i.appendChild(a),this.diagramRenderer.renderElement(e.wrapper.children[0].children[0],t,s),a},r.prototype.getSymbolSize=function(e,t){var r=e.wrapper.actualSize.width,o=e.wrapper.actualSize.height;return this.symbolWidth||this.symbolHeight?(r=this.symbolWidth,o=Math.max(this.symbolHeight,o)):(r+=this.symbolMargin.left+this.symbolMargin.right+e.style.strokeWidth,o+=this.symbolMargin.top+this.symbolMargin.bottom+e.style.strokeWidth),new i(r,o)},r.prototype.getMousePosition=function(e){var t,i,r;if(-1!==e.type.indexOf("touch")){var o=(r=e).changedTouches[0].clientY,n=r.changedTouches[0].clientX;t=o-this.element.offsetTop,i=n-this.element.offsetLeft}else t=e.clientY-this.element.offsetTop,i=e.clientX-this.element.offsetLeft;return{x:i,y:t}},r.prototype.mouseMove=function(e,t){!this.highlightedSymbol||this.selectedSymbol&&this.selectedSymbol.id+"_container"===this.highlightedSymbol.id||(this.highlightedSymbol.classList.remove("e-symbol-hover"),this.highlightedSymbol.style.backgroundColor="",this.highlightedSymbol=null);var i=e.target.id.split("_container")[0];if(this.symbolTable[i]){var r=document.getElementById(i+"_container");r.classList.add("e-symbol-hover"),this.highlightedSymbol=r}e.preventDefault()},r.prototype.mouseUp=function(e){if(this.isMethod=!0,e&&e.target)if("iconSearch"===e.srcElement.id){var t=document.getElementById("iconSearch");t.classList.contains("e-clear-searchtext")&&(t.className="e-input-group-icon e-search e-icons",document.getElementById("textEnter").value="",sf.base.isBlazor()&&document.getElementById(this.element.id+"_search_content").classList.add("e-symbolpalette-search-hidden"),this.searchPalette(""))}else{var i=e.target.id.split("_container")[0];if(i&&this.selectedSymbol){var r={oldValue:this.oldObject,newValue:i};this.trigger("paletteSelectionChange",r),this.oldObject=i,e.preventDefault()}else""!==this.oldObject&&(this.oldObject="")}},r.prototype.keyUp=function(e){var t=this;if(this.enableSearch){var i=this;document.getElementById("iconSearch").className="e-input-group-icon e-clear-searchtext e-icons",sf.base.isBlazor()&&e.target instanceof HTMLInputElement&&(""===e.target.value?document.getElementById(this.element.id+"_search_content").classList.add("e-symbolpalette-search-hidden"):document.getElementById(this.element.id+"_search_content").classList.remove("e-symbolpalette-search-hidden")),!e||"Enter"!==e.key&&13!==e.keyCode?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.target instanceof HTMLInputElement&&(i.searchPalette(e.target.value),t.timer=null)}),500)):e.target instanceof HTMLInputElement&&this.searchPalette(e.target.value)}},r.prototype.mouseDown=function(e){var t=e.target.id.split("_container")[0];if(this.selectedSymbol){var i,r=document.getElementById(this.selectedSymbol.id+"_container");t!==this.selectedSymbol.id&&r&&r.classList.remove("e-symbol-selected"),(i=document.getElementById(this.selectedSymbol.id+"_container"))&&(i.style.backgroundColor=""),this.selectedSymbol=null}this.symbolTable[t]&&((i=document.getElementById(t+"_container")).classList.add("e-symbol-selected"),this.selectedSymbol=this.symbolTable[t],e.preventDefault())},r.prototype.keyDown=function(e){if(e&&"Escape"===e.key){var t=this.draggable.helperElement;t&&t.parentNode&&(t.parentNode.removeChild(t),this.draggable.intDestroy())}},r.prototype.initDraggable=function(){this.allowDrag&&(this.draggable=new sf.base.Draggable(this.element,{dragTarget:".e-symbol-draggable",helper:this.helper,dragStart:this.dragStart,preventDefault:!1,dragStop:this.dragStop,drag:function(e){var t=lh(e.target,"e-droppable");if(t&&t.classList.contains("e-diagram")){t.ej2_instances[0].droppable.over(e)}},cursorAt:{left:this.symbolPreview.offset.x,top:this.symbolPreview.offset.y}}))},r.prototype.dragStart=function(e){var t=this.helper[0];t&&t.setAttribute("paletteId",this.element.id),sf.base.isBlazor()&&e.bindEvents(e.dragElement)},r.prototype.dragStop=function(e){lh(e.target,"e-diagram")||sf.base.remove(e.helper)},r.prototype.scaleSymbol=function(e,t,r,o,n,a,s){if(e instanceof wr){var h=e.wrapper;e.wrapper=t.children[0];for(var d=e.scale(r,o,n,a,t.children[0]),l=n/2-t.children[0].children[0].offsetX+d.x/2,c=a/2-t.children[0].children[0].offsetY+d.y/2,p=0,g=t.children[0].children;p<g.length;p++){var u=g[p];u.offsetX+=l,u.offsetY+=c,u.staticSize=!1}e.wrapper=h}else if("Bpmn"===e.shape.type&&this.bpmnModule){h=e.wrapper;e.wrapper=t,t.children[0].width=n,t.children[0].height=a,this.bpmnModule.updateBPMN({width:n,height:a},e,e,null),e.wrapper=h}else if(e.children){var f,m,y=e.children;if(!s)for(var v=void 0,b=void 0,w=0;w<y.length;w++)(b=t.children[0].children[w])&&(b.children[0].children&&this.measureChild(b),v=this.symbolTable[b.id],b.width=v.width,b.height=v.height,b.measure(new i),b.arrange(b.children[0].desiredSize));if(f=n/t.children[0].desiredSize.width,m=a/t.children[0].desiredSize.height,t.children[0].measure(new i),t.children[0].arrange(t.children[0].desiredSize),!s){var x=void 0;for(w=0;w<y.length;w++)(x=t.children[0].children[w])&&(x.children[0].children&&this.scaleChildren(x,f,m,e),this.scaleGroup(x,f,m,e))}if(s){var C=void 0,S=void 0;for(x=void 0,w=0;w<y.length;w++)C=n/e.wrapper.children[0].desiredSize.width,S=a/e.wrapper.children[0].desiredSize.height,(x=t.children[0].children[w])&&(x.children[0].children&&this.scaleChildren(x,C,S,e,!0),this.scaleGroup(x,C,S,e,!0));e.wrapper.children[0].measure(new i),e.wrapper.children[0].arrange(e.wrapper.children[0].desiredSize)}}else Sa(t.children[0],r,o,t)},r.prototype.scaleChildren=function(e,t,i,r,o){for(var n,a=0;a<e.children.length;a++)(n=e.children[a]).children[0].children?this.scaleChildren(n,t,i,r,o):this.scaleGroup(n,t,i,r,o)},r.prototype.measureChild=function(e){for(var t,r,o=0;o<e.children.length;o++)(t=e.children[o]).children[0].children?this.measureChild(t):(r=this.symbolTable[t.id],t.width=r.width,t.height=r.height,t.measure(new i),t.arrange(t.children[0].desiredSize))},r.prototype.scaleGroup=function(e,t,r,o,n){e.width=e.width*t,e.height=e.height*r,e.offsetX=n?e.offsetX*t-o.style.strokeWidth:e.offsetX*t+o.style.strokeWidth/2,e.offsetY=n?e.offsetY*r-o.style.strokeWidth:e.offsetY*r+o.style.strokeWidth/2,e.measure(new i),e.arrange(e.children[0].desiredSize)},r.prototype.refreshPalettes=function(){sf.base.isBlazor()||(this.accordionElement.items=[]),function(e,t){var i;for(i=t?document.getElementById(t).getElementsByClassName(e):document.getElementsByClassName(e);i.length>0;)i[0].parentNode.removeChild(i[0])}("e-remove-palette",this.element.id),this.updatePalettes(),sf.base.isBlazor()||this.accordionElement.dataBind()},r.prototype.updatePalettes=function(){for(var e=0;e<this.palettes.length;e++){var t=this.palettes[e];this.initSymbols(t),this.renderPalette(t)}},r.prototype.createTextbox=function(){var e=hh("div",{id:this.element.id+"_search"});mh(e,"backgroundColor:white;height:30px"),e.className="e-input-group",this.element.appendChild(e);var t=hh("input",{});t.placeholder="Search Shapes",t.id="textEnter",mh(t,"width:100%;height:auto"),t.className="e-input",e.appendChild(t);var i=hh("span",{id:"iconSearch",className:"e-input-group-icon e-search e-icons"});e.appendChild(i)},r.prototype.getFilterSymbol=function(e){for(var t=[],i=0;i<e.length;i++)for(var r=0;r<this.ignoreSymbolsOnSearch.length;r++)this.ignoreSymbolsOnSearch[r]!==e[i].id&&t.push(e[0]);return t},r.prototype.searchPalette=function(e){var t,i=[],r=document.getElementById("SearchPalette");if(r)for(var o=r.children.length-1;o>=0;o--)r.removeChild(r.children[o]);for(var n=0;n<this.palettes.length;n++)for(var a=this.palettes[n],s=0;s<a.symbols.length;s++){var h=a.symbols[s];""!==e&&-1!==h.id.toLowerCase().indexOf(e.toLowerCase())&&i.push(h)}var d=Wh(this.filterSymbols);if(d&&(i=d(i)||[]),this.ignoreSymbolsOnSearch&&this.ignoreSymbolsOnSearch.length>0&&(i=this.getFilterSymbol(i)),r||sf.base.isBlazor()||(r=t=this.createSearchPalette(t)),i.length>0)for(var l=0,c=i;l<c.length;l++){var p=c[l];this.getSymbolContainer(p,r)}else if(""!==e){var g=hh("div",{id:"EmptyDiv",style:"text-align:center;font-style:italic"});g.innerHTML="No Items To Display",r.appendChild(g)}else{if(document.getElementById("iconSearch").className="e-input-group-icon e-search e-icons",!sf.base.isBlazor()){this.accordionElement.removeItem(0);var u=document.getElementById("SearchPalette");u&&u.remove()}}},r.prototype.createSearchPalette=function(e){e=hh("div",{id:"SearchPalette",style:"display:none;overflow:auto;"}),this.element.appendChild(e);return this.accordionElement.addItem({header:"Search Results",expanded:!0,content:"#SearchPalette"},0),e},r.prototype.wireEvents=function(){var e=sf.base.Browser.touchStartEvent,t=sf.base.Browser.touchEndEvent,i=sf.base.Browser.touchMoveEvent;sf.base.EventHandler.add(this.element,e,this.mouseDown,this),sf.base.EventHandler.add(this.element,i,this.mouseMove,this),sf.base.EventHandler.add(this.element,t,this.mouseUp,this),sf.base.EventHandler.add(this.element,"keyup",this.keyUp,this),sf.base.EventHandler.add(document,"keydown",this.keyDown,this),this.initDraggable()},r.prototype.unWireEvents=function(){var e=sf.base.Browser.touchStartEvent,t=sf.base.Browser.touchEndEvent,i=sf.base.Browser.touchMoveEvent;sf.base.EventHandler.remove(this.element,e,this.mouseDown),sf.base.EventHandler.remove(this.element,i,this.mouseMove),sf.base.EventHandler.remove(this.element,t,this.mouseUp),sf.base.EventHandler.remove(this.element,"keyup",this.keyUp),sf.base.EventHandler.remove(document,"keydown",this.keyDown)},mc([sf.base.Property("S")],r.prototype,"accessKey",void 0),mc([sf.base.Property("100%")],r.prototype,"width",void 0),mc([sf.base.Property("100%")],r.prototype,"height",void 0),mc([sf.base.Collection([],vc)],r.prototype,"palettes",void 0),mc([sf.base.Property()],r.prototype,"getSymbolInfo",void 0),mc([sf.base.Property({fit:!0})],r.prototype,"symbolInfo",void 0),mc([sf.base.Property()],r.prototype,"filterSymbols",void 0),mc([sf.base.Property()],r.prototype,"ignoreSymbolsOnSearch",void 0),mc([sf.base.Property()],r.prototype,"getSymbolTemplate",void 0),mc([sf.base.Property()],r.prototype,"symbolWidth",void 0),mc([sf.base.Property()],r.prototype,"symbolHeight",void 0),mc([sf.base.Complex({left:10,right:10,top:10,bottom:10},ne)],r.prototype,"symbolMargin",void 0),mc([sf.base.Property(!0)],r.prototype,"allowDrag",void 0),mc([sf.base.Complex({},wc)],r.prototype,"symbolPreview",void 0),mc([sf.base.Complex({},bc)],r.prototype,"symbolDragSize",void 0),mc([sf.base.Property(!1)],r.prototype,"enableSearch",void 0),mc([sf.base.Property(!0)],r.prototype,"enableAnimation",void 0),mc([sf.base.Property("Multiple")],r.prototype,"expandMode",void 0),mc([sf.base.Event()],r.prototype,"paletteSelectionChange",void 0),mc([sf.base.Event()],r.prototype,"paletteExpanding",void 0),mc([sf.base.Property()],r.prototype,"getNodeDefaults",void 0),mc([sf.base.Property()],r.prototype,"nodeDefaults",void 0),mc([sf.base.Property()],r.prototype,"getConnectorDefaults",void 0),mc([sf.base.Property()],r.prototype,"connectorDefaults",void 0),r}(sf.base.Component),Cc=(lc=function(e,t){return(lc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}lc(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Sc=function(e,t,i,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Pc=function(t){function r(e,i){var r=t.call(this,e,i)||this;return r.mode="Canvas",r.id="overview",r.actionName="",r.startPoint=null,r.currentPoint=null,r.prevPoint=null,r.scale=null,r.inAction=!1,r.viewPortRatio=1,r.horizontalOffset=0,r.verticalOffset=0,r.model={},r.event=!0,r.overviewid=88123,r.model={width:r.width,height:r.height},r}return Cc(r,t),r.prototype.onPropertyChanged=function(e,t){for(var i=0,r=Object.keys(e);i<r.length;i++){switch(r[i]){case"sourceID":this.setParent(e.sourceID);break;case"width":case"height":this.renderCanvas(),this.setParent(this.sourceID)}}},r.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},r.prototype.preRender=function(){if(""===this.element.id){var e=document.getElementsByClassName("e-overview").length;this.element.id="overview_"+this.overviewid+"_"+e}this.element.style.background="transparent",this.unWireEvents(),this.wireEvents()},r.prototype.render=function(){this.diagramRenderer=new qh(this.element.id,new Zh,!1),this.renderCanvas(),this.setParent(this.sourceID),this.renderComplete()},r.prototype.getSizeValue=function(e){return e.toString().indexOf("px")>0||e.toString().indexOf("%")>0?e.toString():e.toString()+"px"},r.prototype.renderCanvas=function(e){var t=document.getElementById(this.element.id+"_canvas");t||(t=hh("div",{}),this.element.appendChild(t)),yh(t,{id:this.element.id+"_canvas",class:"drawing",style:"position:relative; height:"+this.getSizeValue(this.model.height)+"; width:"+this.getSizeValue(this.model.width)+";style:-ms-touch-action: none;touch-action: none;"}),this.element.setAttribute("tabindex",String(0)),this.element.style.overflow="hidden",this.element.style.height=String(this.model.height),this.element.style.width=String(this.model.width),this.canvas=t},r.prototype.setParent=function(e){var t=document.getElementById(e);if(this.parent){var i=this.parent;this.parent=null,i.setOverview(null,this.element.id),this.removeDocument(this)}this.parent=this.getDiagram(t,"ej2_instances"),this.parent&&this.parent.setOverview(this)},r.prototype.getDiagram=function(e,t){for(var i,r=e[t].length,o=0;o<r;o++)if(ch(e[t][o].element,"e-diagram")){i=e[t][o];break}return i},r.prototype.unWireEvents=function(){var e=sf.base.Browser.touchStartEvent,t=sf.base.Browser.touchMoveEvent,i=sf.base.Browser.isPointer?"pointerleave":"mouseleave",r=sf.base.Browser.touchEndEvent;sf.base.EventHandler.remove(this.element,e,this.mouseDown),sf.base.EventHandler.remove(this.element,t,this.mouseMove),sf.base.EventHandler.remove(this.element,r,this.mouseUp),sf.base.EventHandler.remove(this.element,i,this.documentMouseUp),sf.base.EventHandler.remove(window,"resize",this.windowResize);var o=document.getElementById(this.sourceID+"content");o&&sf.base.EventHandler.remove(o,"scroll",this.scrolled)},r.prototype.wireEvents=function(){var e=sf.base.Browser.touchStartEvent,t=sf.base.Browser.touchEndEvent,i=sf.base.Browser.touchMoveEvent,r=sf.base.Browser.isPointer?"pointerleave":"mouseleave";sf.base.EventHandler.add(this.element,e,this.mouseDown,this),sf.base.EventHandler.add(this.element,i,this.mouseMove,this),sf.base.EventHandler.add(this.element,t,this.mouseUp,this),sf.base.EventHandler.add(this.element,r,this.documentMouseUp,this),sf.base.EventHandler.add(window,"resize",this.windowResize,this);var o=document.getElementById(this.sourceID+"content");o&&sf.base.EventHandler.add(o,"scroll",this.scrolled,this)},r.prototype.renderDocument=function(e){e.canvas=this.canvas;var t=document.getElementById(this.canvas.id+"_svg");t&&t.parentNode.removeChild(t);var i=dh("svg",{id:this.canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",class:"overview_svg"});this.svg=i,e.svg=i,e.canvas.appendChild(i);var r=document.getElementById(this.element.id),o=r.clientWidth,n=r.clientHeight,a=r.getBoundingClientRect(),s=window.screenX<0?-1*window.screenX:window.screenX,h=window.screenY<0?-1*window.screenY:window.screenY;if(0===o){var d=Math.floor(window.innerWidth-s-Math.floor(a.left));o=d>0?d:Math.floor(window.innerWidth)}if(0===n){var l=Math.floor(window.innerHeight-h-Math.floor(a.top));n=l>0?l:Math.floor(window.innerHeight)}o>0&&(i.setAttribute("width",String(o)),this.model.height=n),n>0&&(i.setAttribute("height",String(n)),this.model.width=o),e.diagramLayerDiv||(e.diagramLayerDiv=hh("div",{}),e.diagramLayer=Fh.createCanvas(this.element.id+"_diagramLayer",this.model.width,this.model.height),e.diagramLayer.setAttribute("style","position:absolute; left:0px;  top:0px "),e.diagramLayerDiv.appendChild(e.diagramLayer),e.canvas.appendChild(e.diagramLayerDiv));var c={id:this.element.id+"_diagramLayer_div",style:"width:"+this.model.width+"px; height:"+this.model.height+"px;position:absolute;top:0px;left:0px"};yh(e.diagramLayerDiv,c),this.renderHtmlLayer(e.canvas),this.renderNativeLayer(e.canvas,e),this.addOverviewRectPanel(e)},r.prototype.removeDocument=function(e){var t=document.getElementById(this.canvas.id+"_svg");this.canvas.removeChild(t);var i=document.getElementById(this.element.id+"_htmlLayer");this.canvas.removeChild(i);var r=document.getElementById(this.element.id+"_diagramLayer_div");this.canvas.removeChild(r),e.diagramLayerDiv=null,e.diagramLayer=null},r.prototype.renderHtmlLayer=function(e){var t=hh("div",{id:this.element.id+"_htmlLayer",class:"e-html-layer",style:"pointer-events:none;position:absolute;top:0px;left:0px;"}),i=hh("div",{id:this.element.id+"_htmlLayer_div",style:"position:absolute;top:0px;left:0px;"});return t.appendChild(i),e.appendChild(t),t},r.prototype.renderNativeLayer=function(e,t){if(!document.getElementById(this.element.id+"_nativeLayer_svg")){var i=this.parent.createSvg(this.element.id+"_nativeLayer_svg",this.model.width,this.model.height),r=dh("g",{id:this.element.id+"_nativeLayer"});i.appendChild(r),t.diagramLayerDiv.appendChild(i),fh(i,{class:"e-native-layer"})}},r.prototype.addOverviewRectPanel=function(e){var t=document.getElementById(this.canvas.id+"_overviewsvg");t&&t.parentNode.removeChild(t),t=dh("svg",{id:this.canvas.id+"_overviewsvg",class:"overviewsvg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute;left:0px;top:0px; aria-label:Specifies overview",width:this.model.width,height:this.model.height}),e.canvas.appendChild(t);var i=dh("g",{id:this.element.id+"_overviewlayer",style:"pointer-events:none"});t.appendChild(i);var r=dh("rect",{fill:"transparent",width:"100%",height:"100%",class:"overviewbackrect",id:this.canvas.id+"overviewbackrect"});r.setAttribute("style"," pointer-events: none; "),i.appendChild(r);var o=dh("g",{id:this.canvas.id+"overviewhandle",style:"pointer-events:all"});i.appendChild(o);var n=dh("rect",{id:this.canvas.id+"overviewrect",fill:"transparent"});o.appendChild(n),this.renderOverviewCorner("left",o),this.renderOverviewCorner("right",o),this.renderOverviewCorner("top",o),this.renderOverviewCorner("bottom",o),this.renderOverviewCorner("topleft",o),this.renderOverviewCorner("topright",o),this.renderOverviewCorner("bottomleft",o),this.renderOverviewCorner("bottomright",o)},r.prototype.renderOverviewCorner=function(e,t){this.svg;var i,r=dh(i="top"===e||"bottom"===e||"right"===e||"left"===e?"rect":"circle",{id:this.canvas.id+"visible"+e});t.appendChild(r);var o=dh(i,{id:this.canvas.id+e,class:"overviewresizer",fill:"transparent"});t.appendChild(o)},r.prototype.updateOverviewRectangle=function(){var e=this.currentPoint.x-this.prevPoint.x,t=this.currentPoint.y-this.prevPoint.y,r=new i;r.width=0,r.height=0;var o=0,n=0;switch(this.resizeDirection){case"left":r.width-=e,r.height-=e/this.viewPortRatio,o=e,n=e/this.viewPortRatio,n/=2;break;case"right":r.width+=e,r.height+=e/this.viewPortRatio,n=e/this.viewPortRatio,n/=-2;break;case"top":r.height-=t,r.width-=t*this.viewPortRatio,n=t,o=t*this.viewPortRatio,o/=2;break;case"bottom":r.height+=t,r.width+=t*this.viewPortRatio,o=t*this.viewPortRatio,o/=-2;break;case"topleft":Math.abs(t)>Math.abs(e)?e=t*this.viewPortRatio:t=e/this.viewPortRatio,r.width-=e,r.height-=t,o=e,n=t;break;case"topright":Math.abs(t)>Math.abs(e)?e=-t*this.viewPortRatio:t=-e/this.viewPortRatio,n=t,r.width+=e,r.height-=t;break;case"bottomleft":Math.abs(t)>Math.abs(e)?e=-t*this.viewPortRatio:t=-e/this.viewPortRatio,o=e,r.width-=e,r.height+=t;break;case"bottomright":Math.abs(t)>Math.abs(e)?e=t*this.viewPortRatio:t=e/this.viewPortRatio,r.width+=e,r.height+=t}this.updateHelper(o,n,r,void 0,void 0)},r.prototype.updateHelper=function(e,t,i,r,o){var n,a,s,h,d,l=this.element.getElementsByTagName("svg")[2].getElementById("helper");i?(n=(s=l.getBBox()).x+e,a=s.y+t,r=s.width+i.width,o=s.height+i.height):(h=this.currentPoint.x>this.startPoint.x?this.currentPoint.x-this.prevPoint.x:this.prevPoint.x-this.currentPoint.x,d=this.currentPoint.y>this.startPoint.y?this.currentPoint.y-this.prevPoint.y:this.prevPoint.y-this.currentPoint.y,Math.abs(d)>Math.abs(h)?h=this.viewPortRatio*d:d=h/this.viewPortRatio,s=l.getBBox(),n=this.startPoint.x>this.currentPoint.x?s.x-h:s.x,a=this.startPoint.y>this.currentPoint.y?s.y-d:s.y,r=s.width+h,o=s.height+d);fh(this.helper,{id:this.helper.id,x:n,y:a,width:Math.max(0,r),height:Math.max(0,o)})},r.prototype.updateOverviewrect=function(e,t,i,r){yh(document.getElementById(this.canvas.id+"overviewrect"),{x:e,y:t,width:Math.max(1,i),height:Math.max(1,r)}),this.updateOverviewCorner("top",e+8,t+1,Math.max(0,i-16),2),this.updateOverviewCorner("bottom",e+8,t+r+3,Math.max(0,i-16),2),this.updateOverviewCorner("left",e-2,t+11,2,Math.max(0,r-16)),this.updateOverviewCorner("right",e+i,t+11,2,Math.max(0,r-16)),this.updateOverviewCorner("topleft",e,t+3,5,5),this.updateOverviewCorner("topright",e+i,t+3,5,5),this.updateOverviewCorner("bottomleft",e,t+r+3,5,5),this.updateOverviewCorner("bottomright",e+i,t+r+3,5,5)},r.prototype.updateOverviewCorner=function(e,t,i,r,o){var n,a,s="visible"+e;"top"===e||"bottom"===e||"right"===e||"left"===e?(n={x:t,y:i,width:r,height:o,fill:"#ED1C24"},a={x:t-2,y:i-2,width:2===r?4:r,height:2===o?4:o}):(n={cx:t,cy:i,r:4,fill:"#ED1C24"},a={cx:t,cy:i,r:6,fill:"transparent"}),yh(document.getElementById(this.canvas.id+s),n),yh(document.getElementById(this.canvas.id+e),a)},r.prototype.translateOverviewRectangle=function(){Number(this.model.width),Number(this.model.height);var e=this.currentPoint.x-this.prevPoint.x,t=this.currentPoint.y-this.prevPoint.y,i=this.element.getElementsByClassName("overviewsvg")[0].getElementById(this.canvas.id+"overviewrect").getBBox(),r=i.x+e,o=i.y+t,n=i.width,a=i.height;this.updateOverviewrect(r,o,n,a),this.updateParentView(this.parent.scroller.currentZoom,r,o,n,a,null)},r.prototype.renderOverviewRect=function(e,t,i,r){var o=Number(this.model.width),n=Number(this.model.height),a=i/o*this.contentWidth,s=r/n*this.contentHeight,h=Math.max(this.parent.scroller.viewPortWidth/a,this.parent.scroller.viewPortHeight/s);if(h>=.25&&h<=30){this.updateParentView(h,e,t,i,r,{x:0,y:0});var d=this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom,!0);if(this.helper){var l=this.element.getElementsByTagName("rect")[10].getBBox();d.x=l.x,d.y=l.y}this.updateOverviewrect(d.x,d.y,d.width,d.height)}},r.prototype.scrollOverviewRect=function(e,t,i,r){if(!this.actionName||r){var o=Number(this.model.width),n=Number(this.model.height),a=Math.min(this.contentWidth/o,this.contentHeight/n),s=new b,h=s.x=e/i/a,d=s.y=t/i/a,l=s.width=this.parent.scroller.viewPortWidth/i/a,c=s.height=this.parent.scroller.viewPortHeight/i/a;if(r){var p=new b;return p.x=h,p.y=d,p.width=l,p.height=c,p}this.updateOverviewrect(-h,-d,l,c)}return null},r.prototype.updateParentView=function(t,i,r,o,n,a){var s,h,d=Number(this.model.width),l=Number(this.model.height),c=i*(this.contentWidth/d)*t,p=r*(this.contentHeight/l)*t;this.parent.scroller.getPageBounds();1===t&&"pan"!==this.actionName||(s=-c-this.parent.scroller.horizontalOffset,h=-p-this.parent.scroller.verticalOffset),this.parent.setBlazorDiagramProps(!0),this.parent.realActions|=e.RealAction.OverViewAction,"scale"===this.actionName||"draw"===this.actionName?this.parent.scroller.zoom(t/this.parent.scroller.currentZoom,s,h,a):sf.base.isBlazor()?this.parent.scroller.zoom(1,s,h,a):this.parent.pan(s,h,a)},r.prototype.updateHtmlLayer=function(e){var t=sh(e.element.id),i=this.parent.scroller.getPageBounds(!0),r=i.width,o=i.height,n=Math.max(r,this.parent.scroller.viewPortWidth),a=Math.max(o,this.parent.scroller.viewPortHeight/this.parent.scroller.currentZoom),s=Math.min(Number(this.model.width)/n,Number(this.model.height)/a);t.style.transform="scale("+s+") translate("+this.parent.scroller.transform.tx+"px,"+this.parent.scroller.transform.ty+"px)"},r.prototype.updateView=function(e){var t=this.parent.scroller.getPageBounds(),i=this.parent.scroller.viewPortWidth/this.parent.scroller.currentZoom,r=this.parent.scroller.viewPortHeight/this.parent.scroller.currentZoom,o=0,n=0;this.parent.scroller.currentZoom<1&&i>t.width&&r>t.height&&(o=(i-t.width)/2,n=(r-t.height)/2);var a=t.width,s=t.height,h=Number(this.model.width),d=Number(this.model.height),l=Math.max(a,this.parent.scroller.viewPortWidth),c=Math.max(s,this.parent.scroller.viewPortHeight/this.parent.scroller.currentZoom);this.contentWidth=l=Math.max(l,h/d*c),this.contentHeight=c=Math.max(c,d/h*l);var p=Math.min(h/l,d/c),g=document.getElementById(this.element.id+"_htmlLayer");g.style.webkitTransform="scale("+p+") translate("+-t.x+"px,"+-t.y+"px)",g.style.transform="scale("+p+") translate("+(-t.x+o)+"px,"+(-t.y+n)+"px)",document.getElementById(this.element.id+"_overviewlayer").setAttribute("transform","translate("+-t.x*p+","+-t.y*p+")"),this.horizontalOffset=t.x*p,this.verticalOffset=t.y*p;var u=document.getElementById(this.element.id+"_diagramLayer"),f=ah(this.element.id),m=u.getContext("2d"),y=Number(this.model.width)/this.contentWidth,v=Number(this.model.height)/this.contentHeight;y=Math.min(y,v),f.setAttribute("transform","translate(0,0),scale("+y+")"),m.setTransform(y,0,0,y,0,0),m.fillStyle="red",this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom)},r.prototype.scrolled=function(e){if(this.event){var t=this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom,!0);this.updateOverviewrect(-t.x,-t.y,t.width,t.height)}},r.prototype.updateCursor=function(e){if(ch(e.target,"overviewresizer"))switch(e.target.id){case this.canvas.id+"left":this.canvas.style.cursor="w-resize";break;case this.canvas.id+"right":this.canvas.style.cursor="e-resize";break;case this.canvas.id+"top":this.canvas.style.cursor="n-resize";break;case this.canvas.id+"bottom":this.canvas.style.cursor="s-resize";break;case this.canvas.id+"topleft":this.canvas.style.cursor="nw-resize";break;case this.canvas.id+"topright":this.canvas.style.cursor="ne-resize";break;case this.canvas.id+"bottomleft":this.canvas.style.cursor="sw-resize";break;case this.canvas.id+"bottomright":this.canvas.style.cursor="se-resize"}else this.canvas.style.cursor="default"},r.prototype.mouseMove=function(e){if(this.event=!1,this.updateCursor(e),this.currentPoint=this.mousePosition(e),this.actionName)switch(this.actionName){case"draw":this.inAction||this.startPoint.x===this.currentPoint.x&&this.startPoint.y===this.currentPoint.y||(this.initHelper(),this.inAction=!0),this.inAction&&this.updateHelper();break;case"scale":this.inAction||(this.initHelper(),this.inAction=!0),this.updateOverviewRectangle();break;case"pan":(this.startPoint.x!==this.currentPoint.x||this.startPoint.y===this.currentPoint.y||this.inAction)&&(this.inAction=!0,this.translateOverviewRectangle())}this.prevPoint=this.currentPoint},r.prototype.documentMouseUp=function(e){this.inAction=!1,this.actionName="",this.helper&&(this.helper.parentNode.removeChild(this.helper),this.helper=null),this.event=!0,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="all"},r.prototype.windowResize=function(e){var t=this;return this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout((function(){var e=document.getElementById(t.element.id).getBoundingClientRect();t.model.width=e.width>0?e.width:t.model.width,t.model.height=e.height>0?e.height:t.model.height,t.renderCanvas(),t.setParent(t.sourceID)}),10),!1},r.prototype.mouseDown=function(e){if(e.target.id===this.canvas.id+"_overviewsvg"&&(this.actionName="draw"),e.target.id===this.canvas.id+"overviewrect"&&(this.actionName="pan"),ch(e.target,"overviewresizer"))switch(this.actionName="scale",e.target.id){case this.canvas.id+"left":this.resizeDirection="left";break;case this.canvas.id+"right":this.resizeDirection="right";break;case this.canvas.id+"top":this.resizeDirection="top";break;case this.canvas.id+"bottom":this.resizeDirection="bottom";break;case this.canvas.id+"topleft":this.resizeDirection="topleft";break;case this.canvas.id+"topright":this.resizeDirection="topright";break;case this.canvas.id+"bottomleft":this.resizeDirection="bottomleft";break;case this.canvas.id+"bottomright":this.resizeDirection="bottomright"}this.startPoint=this.prevPoint=this.mousePosition(e),this.viewPortRatio=this.parent.scroller.viewPortWidth/this.parent.scroller.viewPortHeight,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="none"},r.prototype.mouseUp=function(e){if(this.currentPoint=this.mousePosition(e),this.actionName)if(this.startPoint.x!==this.currentPoint.x||this.startPoint.y!==this.currentPoint.y){if("pan"===this.actionName);else if(this.helper){var t=this.element.getElementsByTagName("rect")[10].getBBox();this.resizeDirection=this.resizeDirection||"";var i=t.x,r=t.y,o=t.width,n=t.height;"topleft"===this.resizeDirection||"topright"===this.resizeDirection||"bottomleft"===this.resizeDirection||this.resizeDirection;this.renderOverviewRect(i,r,o,n)}}else if(e.target.id===this.canvas.id+"_overviewsvg"||"helper"===e.target.id){o=(t=this.element.getElementsByTagName("svg")[2].getElementById(this.canvas.id+"overviewrect").getBBox()).width,n=t.height;this.inAction=!0,this.actionName="pan",this.renderOverviewRect(this.currentPoint.x-o/2,this.currentPoint.y-n/2,o,n),this.inAction=!1}this.helper&&(this.helper.parentNode.removeChild(this.helper),this.helper=null),this.actionName="",this.startPoint=null,this.currentPoint=null,this.prevPoint=null,this.helper=null,this.viewPortRatio=1,this.resizeDirection="",this.inAction=!1,this.event=!0,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="all"},r.prototype.initHelper=function(){var e=this.element.getElementsByTagName("svg")[2],t=this.startPoint.x,i=this.startPoint.y,r=1,o=1;if("scale"===this.actionName){var n=e.getElementById(this.canvas.id+"overviewrect").getBBox();t=n.x,i=n.y,r=n.width,o=n.height}var a=dh("rect",{id:"helper",x:t,y:i,width:r,height:o,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"});e.getElementById(this.element.id+"_overviewlayer").appendChild(a),this.helper=a},r.prototype.mousePosition=function(e){var t,i,r;if(-1!==e.type.indexOf("touch")){var o=(t=e).changedTouches[0].clientX,n=t.changedTouches[0].clientY;i=o-this.element.offsetLeft,r=n-this.element.offsetTop}else i=e.clientX,r=e.clientY;var a=this.element.getBoundingClientRect();return i-=a.left,r-=a.top,{x:i+this.horizontalOffset,y:r+this.verticalOffset}},r.prototype.destroy=function(){if(this.unWireEvents(),this.notify("destroy",{}),t.prototype.destroy.call(this),document.getElementById(this.element.id)){this.element.classList.remove("e-overview");var e=document.getElementById(this.element.id+"_canvas");e&&this.element.removeChild(e)}this.parent.views.splice(this.parent.views.indexOf(this.element.id),1),this.diagramLayerDiv=null,this.canvas=null,this.parent=null},r.prototype.getModuleName=function(){return"Overview"},Sc([sf.base.Property("100%")],r.prototype,"width",void 0),Sc([sf.base.Property("100%")],r.prototype,"height",void 0),Sc([sf.base.Property("")],r.prototype,"sourceID",void 0),Sc([sf.base.Event()],r.prototype,"created",void 0),r}(sf.base.Component);return El.Inject(tc,ic,rc,cc,Ll,Kl,Bl,jl,nc,ql,Ql,Jl,Nl,$l,al,Ci,ec),xc.Inject(jl),e.Diagram=El,e.PrintAndExport=Bl,e.Size=i,e.Rect=b,e.Matrix=w,e.identityMatrix=x,e.transformPointByMatrix=C,e.transformPointsByMatrix=S,e.rotateMatrix=P,e.scaleMatrix=T,e.translateMatrix=A,e.multiplyMatrix=z,e.Point=a,e.contextMenuClick="contextMenuClick",e.contextMenuOpen="contextMenuOpen",e.contextMenuBeforeItemRender="contextMenuBeforeItemRender",e.Thickness=oe,e.Margin=ne,e.Shadow=ae,e.Stop=se,e.Gradient=he,e.DiagramGradient=de,e.LinearGradient=le,e.RadialGradient=ce,e.ShapeStyle=pe,e.StrokeStyle=ge,e.TextStyle=ue,e.DiagramShapeStyle=fe,e.DiagramElement=be,e.PathElement=Me,e.ImageElement=Re,e.TextElement=Se,e.Container=xe,e.Canvas=Te,e.GridPanel=wo,e.RowDefinition=xo,e.ColumnDefinition=Co,e.GridRow=So,e.GridCell=Po,e.StackPanel=Ja,e.findConnectorPoints=at,e.swapBounds=mt,e.findAngle=Tt,e.findPoint=At,e.getIntersection=Ot,e.getIntersectionPoints=Dt,e.orthoConnection2Segment=Mt,e.getPortDirection=Ht,e.getOuterBounds=Wt,e.getOppositeDirection=_t,e.processPathData=s,e.parsePathData=h,e.getRectanglePath=d,e.getPolygonPath=l,e.pathSegmentCollection=c,e.transformPath=p,e.updatedSegment=g,e.scalePathData=u,e.splitArrayCollection=f,e.getPathString=m,e.getString=y,e.randomId=xh,e.getIndex=Ch,e.templateCompiler=Sh,e.cornersPointsBeforeRotation=Ph,e.getBounds=Th,e.cloneObject=Ah,e.getInternalProperties=zh,e.cloneArray=Oh,e.extendObject=Ih,e.extendArray=Dh,e.textAlignToString=Eh,e.wordBreakToString=Bh,e.bBoxText=Lh,e.middleElement=Mh,e.overFlow=kh,e.whiteSpaceToString=Rh,e.rotateSize=Nh,e.rotatePoint=jh,e.getOffset=Hh,e.getFunction=Wh,e.completeRegion=xn,e.findNodeByName=Cn,e.findObjectType=Sn,e.setSwimLaneDefaults=Pn,e.getSpaceValue=Tn,e.getInterval=An,e.setPortsEdges=zn,e.setUMLActivityDefaults=On,e.setConnectorDefaults=In,e.findNearestPoint=Dn,e.isDiagramChild=En,e.groupHasType=Bn,e.updateDefaultValues=Ln,e.updateLayoutValue=Mn,e.isPointOverConnector=kn,e.intersect3=Rn,e.intersect2=Nn,e.getLineSegment=jn,e.getPoints=Hn,e.getTooltipOffset=Wn,e.initfixedUserHandlesSymbol=Vn,e.sort=Xn,e.getAnnotationPosition=Yn,e.getOffsetOfConnector=Un,e.getAlignedPosition=Gn,e.alignLabelOnSegments=Fn,e.getBezierDirection=Zn,e.removeChildNodes=qn,e.serialize=Qn,e.deserialize=ea,e.upgrade=ta,e.updateStyle=ia,e.updateHyperlink=oa,e.updateShapeContent=na,e.updateShape=aa,e.updateContent=sa,e.updateUmlActivityNode=ha,e.getUMLFinalNode=da,e.getUMLActivityShapes=la,e.removeGradient=ca,e.removeItem=pa,e.updateConnector=ga,e.getUserHandlePosition=ua,e.canResizeCorner=fa,e.canShowCorner=ma,e.checkPortRestriction=ya,e.findAnnotation=va,e.findPort=ba,e.getInOutConnectPorts=wa,e.findObjectIndex=xa,e.getObjectFromCollection=Ca,e.scaleElement=Sa,e.arrangeChild=Pa,e.insertObject=Ta,e.getElement=Aa,e.getCollectionChangeEventArguements=Oa,e.getDropEventArguements=Ia,e.getPoint=Da,e.getObjectType=Ea,e.flipConnector=Ba,e.updatePortEdges=La,e.alignElement=Ma,e.cloneSelectedObjects=ka,e.updatePathElement=Ra,e.checkPort=Na,e.findPath=ja,e.getConnectorDirection=Ha,e.findDistance=Wa,e.cloneBlazorObject=_a,e.checkBrowserInfo=Va,e.canMeasureDecoratorPath=Xa,e.getPreviewSize=Ya,e.getSymbolSize=Ua,e.CanvasRenderer=Fh,e.DiagramRenderer=qh,e.DataBinding=Ll,e.getBasicShape=Ae,e.getPortShape=qe,e.getDecoratorShape=Ke,e.getIconShape=Qe,e.getFlowShape=et,e.Hyperlink=Ue,e.Annotation=Ge,e.ShapeAnnotation=Fe,e.PathAnnotation=Ze,e.Port=_e,e.PointPort=Ve,e.menuClass=Rl,e.DiagramContextMenu=Nl,e.Shape=ls,e.Path=cs,e.Native=ps,e.Html=gs,e.Image=us,e.Text=fs,e.BasicShape=ms,e.FlowShape=ys,e.BpmnGateway=vs,e.BpmnDataObject=bs,e.BpmnTask=ws,e.BpmnEvent=xs,e.BpmnSubEvent=Cs,e.BpmnTransactionSubProcess=Ss,e.BpmnSubProcess=Ps,e.BpmnActivity=Ts,e.BpmnAnnotation=As,e.BpmnShape=zs,e.UmlActivityShape=Os,e.MethodArguments=Is,e.UmlClassAttribute=Ds,e.UmlClassMethod=Es,e.UmlClass=Bs,e.UmlInterface=Ls,e.UmlEnumerationMember=Ms,e.UmlEnumeration=ks,e.UmlClassifierShape=Rs,e.DiagramShape=Ns,e.Node=js,e.Header=Hs,e.Lane=Ws,e.Phase=_s,e.SwimLane=Vs,e.ChildContainer=Xs,e.Selector=Ys,e.BpmnDiagrams=jl,e.getBpmnShapePathData=Hl,e.getBpmnTriggerShapePathData=Wl,e.getBpmnGatewayShapePathData=_l,e.getBpmnTaskShapePathData=Vl,e.getBpmnLoopShapePathData=Xl,e.Decorator=er,e.Vector=tr,e.ConnectorShape=ir,e.ActivityFlow=rr,e.BpmnFlow=or,e.ConnectorSegment=nr,e.StraightSegment=ar,e.BezierSegment=sr,e.OrthogonalSegment=hr,e.DiagramConnectorSegment=dr,e.getDirection=lr,e.isEmptyVector=cr,e.getBezierPoints=pr,e.getBezierBounds=gr,e.bezierPoints=ur,e.MultiplicityLabel=mr,e.ClassifierMultiplicity=yr,e.RelationShip=vr,e.DiagramConnectorShape=br,e.Connector=wr,e.ConnectorBridging=ql,e.Snapping=Kl,e.UndoRedo=Ql,e.DiagramTooltip=Ti,e.initTooltip=Ai,e.updateTooltip=Ii,e.LayoutAnimation=Jl,e.SymbolSize=ji,e.SymbolPaletteInfo=Hi,e.FixedUserHandle=Fi,e.NodeFixedUserHandle=Zi,e.ConnectorFixedUserHandle=qi,e.UserHandle=so,e.ToolBase=_d,e.SelectTool=Vd,e.FixedUserHandleTool=Xd,e.ConnectTool=Yd,e.MoveTool=Ud,e.RotateTool=Gd,e.ResizeTool=Fd,e.NodeDrawingTool=Zd,e.ConnectorDrawingTool=qd,e.TextDrawingTool=Kd,e.ZoomPanTool=Qd,e.ExpandTool=Jd,e.LabelTool=$d,e.PolygonDrawingTool=el,e.PolyLineDrawingTool=tl,e.LabelDragTool=il,e.LabelResizeTool=rl,e.LabelRotateTool=ol,e.DiagramEventHandler=sl,e.CommandHandler=ul,e.findToolToActivate=Cd,e.findPortToolToActivate=Sd,e.contains=Pd,e.hasSelection=Td,e.hasSingleConnection=Ad,e.isSelected=zd,e.getCursor=Od,e.ConnectorEditing=al,e.updateCanvasBounds=Ao,e.removeChildInContainer=zo,e.findBounds=Oo,e.createHelper=Io,e.renderContainerHelper=Do,e.checkParentAsContainer=Eo,e.checkChildNodeInContainer=Bo,e.addChildToContainer=Mo,e.updateLaneBoundsAfterAddChild=Ro,e.renderStackHighlighter=No,e.moveChildInStack=jo,e.LineRouting=$l,e.LineDistribution=ec,e.CrudAction=md,e.ConnectionDataSource=yd,e.DataSource=vd,e.Gridlines=nd,e.SnapSettings=ad,e.KeyGesture=fo,e.Command=mo,e.CommandManager=yo,e.ContextMenuSettings=vo,e.CustomCursorAction=Sl,e.DataMappingItems=gd,e.BlazorAnimation=bi,e.BlazorTooltip=Ci,e.Layout=xd,e.MindMap=ic,e.HierarchicalTree=tc,e.RadialTree=rc,e.GraphForceNode=oc,e.SymmetricLayout=nc,e.GraphLayoutManager=ac,e.ComplexHierarchicalTree=cc,e.Palette=vc,e.SymbolDragSize=bc,e.SymbolPreview=wc,e.SymbolPalette=xc,e.Ruler=Sr,e.Overview=Pc,e},sfBlazor.modules.diagram="diagrams.Diagram",sfBlazor.modules.symbolpalette="diagrams.SymbolPalette",sfBlazor.modules.overview="diagrams.Overview",sf.diagrams=sf.diagrams({})}});