!function(e){var t={};function l(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.m=e,l.c=t,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(s,n,function(t){return e[t]}.bind(null,n));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="_content/Syncfusion.Blazor/scripts/",l(l.s="./bundles/querybuilder.js")}({"./bundles/querybuilder.js":function(e,t,l){"use strict";l.r(t);l("./modules/querybuilder.js")},"./modules/querybuilder.js":function(e,t){function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.sf=window.sf||{};var s=function(e){"use strict";var t,s=(t=function(e,l){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(e,l)},function(e,l){function s(){this.constructor=e}t(e,l),e.prototype=null===l?Object.create(l):(s.prototype=l.prototype,new s)}),n=function(e,t,s,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(i=(a<3?r(i):a>3?r(t,s,i):r(t,s))||i);return a>3&&i&&Object.defineProperty(t,s,i),i},r=function(e,t,l,s){return new(l||(l=Promise))((function(n,r){function a(e){try{o(s.next(e))}catch(e){r(e)}}function i(e){try{o(s.throw(e))}catch(e){r(e)}}function o(e){e.done?n(e.value):new l((function(t){t(e.value)})).then(a,i)}o((s=s.apply(e,t||[])).next())}))},a=function(e,t){var l,s,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(r){return function(i){return function(r){if(l)throw new TypeError("Generator is already executing.");for(;a;)try{if(l=1,s&&(n=2&r[0]?s.return:r[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,r[1])).done)return n;switch(s=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,s=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){a.label=r[1];break}if(6===r[0]&&a.label<n[1]){a.label=n[1],n=r;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(r);break}n[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],s=0}finally{l=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}},i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),n([sf.base.Property(null)],t.prototype,"field",void 0),n([sf.base.Property(null)],t.prototype,"label",void 0),n([sf.base.Property(null)],t.prototype,"type",void 0),n([sf.base.Property(null)],t.prototype,"values",void 0),n([sf.base.Property(null)],t.prototype,"operators",void 0),n([sf.base.Property()],t.prototype,"ruleTemplate",void 0),n([sf.base.Property(null)],t.prototype,"template",void 0),n([sf.base.Property({isRequired:!0,min:0,max:Number.MAX_VALUE})],t.prototype,"validation",void 0),n([sf.base.Property(null)],t.prototype,"format",void 0),n([sf.base.Property(null)],t.prototype,"step",void 0),n([sf.base.Property(null)],t.prototype,"value",void 0),n([sf.base.Property(null)],t.prototype,"category",void 0),t}(sf.base.ChildProperty),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),n([sf.base.Property(null)],t.prototype,"condition",void 0),n([sf.base.Collection([],t)],t.prototype,"rules",void 0),n([sf.base.Property(null)],t.prototype,"field",void 0),n([sf.base.Property(null)],t.prototype,"label",void 0),n([sf.base.Property(null)],t.prototype,"type",void 0),n([sf.base.Property(null)],t.prototype,"operator",void 0),n([sf.base.Property(null)],t.prototype,"value",void 0),n([sf.base.Property(!1)],t.prototype,"not",void 0),t}(sf.base.ChildProperty),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),n([sf.base.Property(!0)],t.prototype,"ruleDelete",void 0),n([sf.base.Property(!0)],t.prototype,"groupInsert",void 0),n([sf.base.Property(!0)],t.prototype,"groupDelete",void 0),t}(sf.base.ChildProperty),d=function(e){function t(t,l){var s=e.call(this,t,l)||this;return s.isReadonly=!0,s.fields={text:"label",value:"field"},s.updatedRule={not:!1,condition:"and"},s.isLocale=!1,sf.dropdowns.MultiSelect.Inject(sf.dropdowns.CheckBoxSelection),s}return s(t,e),t.prototype.getPersistData=function(){return this.addOnPersist(["rule"])},t.prototype.reset=function(){this.isImportRules=!1;var e=this.element.querySelector(".e-group-body");e.innerHTML="",this.enableNotCondition&&sf.base.removeClass(this.element.querySelectorAll(".e-qb-toggle"),"e-active-toggle"),e.appendChild(this.createElement("div",{attrs:{class:"e-rule-list"}})),this.levelColl[this.element.id+"_group0"]=[0],this.rule={condition:"and",not:!1,rules:[]},this.disableRuleCondition(e.parentElement)},t.prototype.getWrapper=function(){return this.element},t.prototype.getModuleName=function(){return"query-builder"},t.prototype.initialize=function(){if(this.dataColl.length){var e=Object.keys(this.dataColl[0]),t=[],s=[],n=void 0,r=!1,a=!1,i=void 0,o={isRequired:!0,min:0,max:Number.MAX_VALUE};if(this.columns.length){this.columnSort();for(var u=0,d=(p=this.columns).length;u<d;u++)this.updateCustomOperator(p[u]),p[u].type||(e.indexOf(p[u].field)>-1&&("string"===(n=l(i=this.dataColl[0][p[u].field]))?a=!isNaN(Date.parse(i)):"object"===n&&(a=i instanceof Date&&!isNaN(i.getTime()),n="string"),p[u].type=n,a=!1),n="string"),p[u].validation||(p[u].validation=o),p[u].category?r=!0:p[u].category=this.l10n.getConstant("OtherFields"),s.indexOf(p[u].category)<0&&s.push(p[u].category),p[u].operators&&!this.isLocale||(p[u].operators=this.customOperators[p[u].type+"Operator"]);r&&(s.length>1||s[0]!==this.l10n.getConstant("OtherFields"))&&(this.fields={text:"label",value:"field",groupBy:"category"})}else{for(u=0,d=e.length;u<d;u++)"string"===(n=l(i=this.dataColl[0][e[u]]))?a=!isNaN(Date.parse(i)):"object"===n&&(a=i instanceof Date&&!isNaN(i.getTime()),n="string"),t[u]={field:e[u],label:e[u],type:a?"date":n,validation:o},a=!1,t[u].operators=this.customOperators[t[u].type+"Operator"];this.columns=t}}else if(this.columns.length){var p;for(u=0,d=(p=this.columns).length;u<d;u++)p[u].category?this.fields={text:"label",value:"field",groupBy:"category"}:p[u].category=this.l10n.getConstant("OtherFields"),this.updateCustomOperator(p[u]),p[u].operators&&!this.isLocale||(p[u].operators=this.customOperators[p[u].type+"Operator"])}},t.prototype.updateCustomOperator=function(e){if(e.operators)for(var t=function(t){var s=Object.keys(e.operators[t]).indexOf("sqlOperator");if(s>-1){var n=e.operators[t],r=Object.keys(n),a=r.map((function(e){return n[e]})).join(",").split(","),i=r.indexOf("value");l.operators[a[i]]=a[s]}},l=this,s=0;s<e.operators.length;s++)t(s)},t.prototype.focusEventHandler=function(e){this.target=e.target},t.prototype.clickEventHandler=function(e){var t,l,s=this,n=e.target;if(this.isImportRules=!1,"SPAN"===n.tagName&&(n=n.parentElement),n.className.indexOf("e-collapse-rule")>-1){var r=new sf.base.Animation({duration:1e3,delay:0});this.element.querySelectorAll(".e-summary-content").length<1&&this.renderSummary();var a=document.getElementById(this.element.id+"_summary_content"),i=a.querySelector(".e-summary-text");r.animate(".e-query-builder",{name:"SlideLeftIn"}),(u=this.element.querySelector(".e-group-container")).style.display="none",i.textContent=this.getSqlFromRules(this.rule),a.style.display="block",i.style.height=i.scrollHeight+"px"}if("BUTTON"===n.tagName&&n.className.indexOf("e-qb-toggle")<0){if(n.className.indexOf("e-removerule")>-1)this.actionButton=n,this.deleteRule(n);else if(n.className.indexOf("e-deletegroup")>-1)this.actionButton=n,this.deleteGroup(sf.base.closest(n,".e-group-container"));else if(n.className.indexOf("e-edit-rule")>-1){if((r=new sf.base.Animation({duration:1e3,delay:0})).animate(".e-query-builder",{name:"SlideLeftIn"}),document.getElementById(this.element.id+"_summary_content").style.display="none",this.element.querySelectorAll(".e-group-container").length<1){this.addGroupElement(!1,this.element,this.rule.condition);var o=sf.base.extend({},this.rule,{},!0);this.setGroupRules(o),this.renderSummaryCollapse()}else{var u;(u=this.element.querySelector(".e-group-container")).querySelectorAll(".e-collapse-rule").length<1&&this.renderSummaryCollapse(),u.style.display="block"}}}else if("LABEL"===n.tagName&&n.parentElement.className.indexOf("e-btn-group")>-1||n.className.indexOf("e-qb-toggle")>-1){var d=sf.base.closest(n,".e-group-container"),p=n.getAttribute("for"),c=void 0;p&&(c=document.getElementById(p).getAttribute("value")),l=d.id.replace(this.element.id+"_","");var h=this.getGroup(l),f=void 0;if(this.enableNotCondition)if(n.className.indexOf("e-qb-toggle")>-1){var m=d.getElementsByClassName("e-qb-toggle")[0];m.className.indexOf("e-active-toggle")>-1?(sf.base.removeClass([m],"e-active-toggle"),f=!1):(sf.base.addClass([m],"e-active-toggle"),f=!0),c=h.condition}else f=h.not;t={groupID:l,cancel:!1,type:"condition",value:c.toLowerCase()},this.enableNotCondition&&(t={groupID:l,cancel:!1,type:"condition",value:c.toLowerCase(),not:f}),this.isImportRules?this.beforeSuccessCallBack(t,n):this.trigger("beforeChange",t,(function(e){s.beforeSuccessCallBack(e,n)}))}this.target=n},t.prototype.beforeSuccessCallBack=function(e,t){if(!e.cancel){var l=sf.base.closest(t,".e-group-container"),s=l.id.replace(this.element.id+"_",""),n=this.getValidRules(this.rule),r=this.getParentGroup(l);r.condition=e.value,this.enableNotCondition&&(r.not=e.not),this.isImportRules||this.trigger("change",{groupID:s,type:"condition",value:r.condition}),this.filterRules(n,this.getValidRules(this.rule),"condition")}},t.prototype.selectBtn=function(e,t){"beforeOpen"===t.name?this.showButtons.groupInsert?sf.base.removeClass([t.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):sf.base.addClass([t.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):t.element.children[0].className.indexOf("e-addrule")>-1?this.addRuleElement(sf.base.closest(e,".e-group-container"),{}):t.element.children[0].className.indexOf("e-addgroup")>-1&&this.addGroupElement(!0,sf.base.closest(e,".e-group-container"),"",!0)},t.prototype.appendRuleElem=function(e,t,l,s,n,r){var a,i,o,u=e.querySelector(".e-rule-list");if("change"===l?a=e.querySelector("#"+s):((a=this.createElement("div",{attrs:{class:"e-rule-container"}})).setAttribute("id",e.id+"_rule"+this.ruleIdCounter),u.appendChild(a),this.ruleIdCounter++),t&&t.ruleTemplate){o={requestType:"template-initialize",ruleID:a.id,action:n,fields:this.fields,rule:r},this.trigger("actionBegin",o),this.ruleTemplateFn=this.templateParser(t.ruleTemplate);var d=this.element.id+t.field;o.fields=this.fields,o.columns=this.columns,o.operators=this.getOperators(r.field),o.operatorFields={text:"key",value:"value"},(i=this.ruleTemplateFn(o,this,"Template",d)[0]).className+=" e-rule-field"}else i=this.ruleElem.querySelector(".e-rule-field").cloneNode(!0);return a.appendChild(i),a},t.prototype.addRuleElement=function(e,t,l,s,n,r){var a=this;if(e){var i={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"insertRule"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addRuleSuccessCallBack(i,e,t,l,s,n,r)):this.trigger("beforeChange",i,(function(i){a.addRuleSuccessCallBack(i,e,t,l,s,n,r)}))}},t.prototype.addRuleSuccessCallBack=function(e,t,l,s,n,r,a){var i,o,u,d,p=this.element.className.indexOf("e-device")>-1?"250px":"200px",c=l&&l.field?this.getColumn(l.field):s||this.columns[0],h={label:"",field:"",type:"",operator:""};if(!e.cancel){if(c&&c.ruleTemplate){this.selectedColumn=c,o=this.selectedColumn.operators,h={label:c.label,field:c.field,type:c.type,operator:o[0].value};var f=Object.keys(l).length?l:h,m={requestType:"template-create",action:"insert-rule",ruleID:(d=this.appendRuleElem(t,c,n,r,"field",f)).id,fields:this.fields,rule:f};this.trigger("actionBegin",m)}else{(d=this.appendRuleElem(t,c,n,r,"field")).querySelector(".e-filter-input").setAttribute("id",d.id+"_filterkey");var g=d.querySelector("button");if(this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode)g.textContent=this.l10n.getConstant("Remove"),sf.base.addClass([g],"e-flat"),sf.base.addClass([g],"e-primary");else sf.base.addClass([g],"e-round"),sf.base.addClass([g],"e-icon-btn"),new sf.popups.Tooltip({content:this.l10n.getConstant("DeleteRule")}).appendTo(g),g=this.createElement("span",{attrs:{class:"e-btn-icon e-icons e-delete-icon"}}),d.querySelector("button").appendChild(g)}"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?d.className="e-rule-container e-vertical-mode":d.className="e-rule-container e-horizontal-mode",d.previousElementSibling&&d.previousElementSibling.className.indexOf("e-rule-container")>-1&&(d.className.indexOf("e-joined-rule")<0&&(d.className+=" e-joined-rule"),d.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(d.previousElementSibling.className+=" e-prev-joined-rule")),d.previousElementSibling&&d.previousElementSibling.className.indexOf("e-group-container")>-1&&d.className.indexOf("e-separate-rule")<0&&(d.className+=" e-separate-rule"),this.isImportRules||this.updateAddedRule(t,l,h,a),(!c||c&&!c.ruleTemplate)&&((u=new sf.dropdowns.DropDownList({dataSource:this.columns,fields:this.fields,placeholder:this.l10n.getConstant("SelectField"),popupHeight:this.columns.length>5?p:"auto",change:this.changeField.bind(this),value:l?l.field:null})).appendTo("#"+d.id+"_filterkey"),this.selectedColumn=u.getDataByValue(u.value),Object.keys(l).length&&this.changeRule(l,{element:u.element,itemData:this.selectedColumn})),i=d.id.replace(this.element.id+"_",""),this.isImportRules||this.trigger("change",{groupID:t.id.replace(this.element.id+"_",""),ruleID:i,type:"insertRule"})}},t.prototype.updateAddedRule=function(e,t,l,s){for(var n=sf.base.closest(e,".e-group-container"),r=this.getParentGroup(n),a=sf.base.closest(e,".e-rule-container"),i=0;a&&null!==a.previousElementSibling;)a=a.previousElementSibling,i++;s?r.rules[i]=t:Object.keys(t).length?r.rules.push({field:t.field,type:t.type,label:t.label,operator:t.operator,value:t.value}):r.rules.push(l),this.disableRuleCondition(e,r)},t.prototype.changeRuleTemplate=function(e,t,l,s){var n=this.selectedColumn.operators;if(!e.ruleTemplate){var r=sf.base.closest(t,".e-rule-container").id;if(this.previousColumn&&this.previousColumn.ruleTemplate&&sf.base.detach(t.closest("#"+r).querySelector(".e-rule-field")),e){var a={field:e.field,label:e.label,operator:n[0].value,value:""};this.addRuleElement(this.element.querySelector(".e-group-container"),a,e,"change",r,!0)}}},t.prototype.renderToolTip=function(e){var t=new sf.popups.Tooltip({content:this.l10n.getConstant("ValidationMessage"),position:"BottomCenter",cssClass:"e-querybuilder-error"});t.appendTo(e),t.open(e)},t.prototype.validateFields=function(){var e=!0;if(this.allowValidation){var t,l=void 0,s=void 0,n=void 0,r=[],a=void 0,i=void 0,o=void 0,u=void 0,d=void 0,p=this.element.querySelectorAll(".e-rule-container"),c=void 0;for(l=0,t=p.length;l<t;l++)if(a=sf.base.closest(p[l],".e-group-container"),d=this.getParentGroup(a),i=0,n=u=p[l],o=sf.base.getComponent(p[l].querySelector(".e-rule-field input.e-control"),"dropdownlist"),this.selectedColumn=o.getDataByValue(o.value),c=!sf.base.isNullOrUndefined(o.index)&&this.selectedColumn.validation,s=u.querySelector(".e-rule-field input.e-control"),c&&c.isRequired){for(;n&&null!==n.previousElementSibling;)n=n.previousElementSibling,i++;if(s=u.querySelector(".e-rule-field input.e-control"),d.rules[i].field||(s.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(s.parentElement),e=!1),s=u.querySelector(".e-rule-operator input.e-control"),d.rules[i].operator||(s.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(s.parentElement),e=!1),d.rules[i].value instanceof Array&&(r=d.rules[i].value),sf.base.isNullOrUndefined(d.rules[i].value)||""===d.rules[i].value||d.rules[i].value instanceof Array&&r.length<1){var h=u.querySelectorAll(".e-rule-value input.e-control");e=!1;for(var f=0,m=h.length;f<m;f++){var g=h[f],y=void 0;g.parentElement.className.indexOf("e-searcher")>-1?(y=sf.base.closest(g,".e-multi-select-wrapper")).className.indexOf("e-tooltip")<0&&this.renderToolTip(y):h[f].parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(h[f].parentElement),f++}}}else o.element&&sf.base.isNullOrUndefined(o.index)&&(s.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(s.parentElement),e=!1)}return e},t.prototype.refreshLevelColl=function(){this.levelColl={};var e=this.element.querySelector(".e-group-container");this.levelColl[e.id]=[0];var t={groupElement:e,level:[0]};this.refreshLevel(t)},t.prototype.refreshLevel=function(e){var t,l,s=e.groupElement.querySelector(".e-rule-list").children,n=e.groupElement,r=s.length,a=0;for(l=0;l<r;l++)(t=s[l]).className.indexOf("e-group-container")>-1&&(e.level.push(a),this.levelColl[t.id]=e.level.slice(),a++,e.groupElement=t,e=this.refreshLevel(e));var i=sf.base.closest(n,".e-rule-list");return e.groupElement=i?sf.base.closest(i,".e-group-container"):n,e.level=this.levelColl[e.groupElement.id].slice(),e},t.prototype.groupTemplate=function(){var e,t,l,s,n,r,a,i,o;return e=this.createElement("div",{attrs:{class:"e-group-container"}}),l=this.createElement("div",{attrs:{class:"e-group-header"}}),t=this.createElement("div",{attrs:{class:"e-group-body"}}),s=this.createElement("div",{attrs:{class:"e-rule-list"}}),e.appendChild(l),t.appendChild(s),e.appendChild(t),n=this.createElement("div",{attrs:{class:"e-lib e-btn-group"}}),this.enableNotCondition&&(r=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}}),n.appendChild(r)),(r=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-and",value:"AND"}})).setAttribute("checked","true"),n.appendChild(r),a=this.createElement("label",{attrs:{class:"e-lib e-btn e-btngroup-and-lbl e-small"},innerHTML:this.l10n.getConstant("AND")}),n.appendChild(a),r=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-or",value:"OR"}}),n.appendChild(r),a=this.createElement("label",{attrs:{class:"e-lib e-btn e-btngroup-or-lbl e-small"},innerHTML:this.l10n.getConstant("OR")}),n.appendChild(a),l.appendChild(n),i=this.createElement("div",{attrs:{class:"e-group-action"}}),o=this.createElement("button",{attrs:{type:"button",class:"e-add-btn"}}),i.appendChild(o),l.appendChild(i),e},t.prototype.ruleTemplate=function(){var e,t,l,s,n,r;return e=this.createElement("div"),n=this.createElement("div",{attrs:{class:"e-rule-field"}}),l=this.createElement("div",{attrs:{class:"e-rule-filter"}}),t=this.createElement("input",{attrs:{type:"text",class:"e-filter-input"}}),l.appendChild(t),n.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-operator"}}),n.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-value"}}),n.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-value-delete"}}),r=this.showButtons.ruleDelete?"e-removerule e-rule-delete e-css e-btn e-small":"e-removerule e-rule-delete e-css e-btn e-small e-button-hide",s=this.createElement("button",{attrs:{class:r}}),l.appendChild(s),n.appendChild(l),e.appendChild(n),e},t.prototype.addGroupElement=function(e,t,l,s){var n=this,r={groupID:t.id.replace(this.element.id+"_",""),cancel:!1,type:"insertGroup"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addGroupSuccess(r,e,t,l,s)):this.trigger("beforeChange",r,(function(r){n.addGroupSuccess(r,e,t,l,s)}))},t.prototype.addGroupSuccess=function(e,t,l,s,n){if(!e.cancel&&this.element.querySelectorAll(".e-group-container").length<=this.maxGroupCount){var r=l,a=void 0,i=this.groupElem.cloneNode(!0);i.setAttribute("id",this.element.id+"_group"+this.groupIdCounter),this.groupIdCounter++;var o=i.querySelector(".e-btngroup-and"),u=i.querySelector(".e-btngroup-or"),d=i.querySelector(".e-btngroup-and-lbl"),p=i.querySelector(".e-btngroup-or-lbl"),c=i.querySelector(".e-qb-toggle");if(o.setAttribute("id",this.element.id+"_and"+this.btnGroupId),u.setAttribute("id",this.element.id+"_or"+this.btnGroupId),o.setAttribute("name",this.element.id+"_and"+this.btnGroupId),u.setAttribute("name",this.element.id+"_and"+this.btnGroupId),d.setAttribute("for",this.element.id+"_and"+this.btnGroupId),p.setAttribute("for",this.element.id+"_or"+this.btnGroupId),this.btnGroupId++,t){var h=this.showButtons.groupDelete?"e-deletegroup":"e-deletegroup e-button-hide";a=this.createElement("button",{attrs:{class:h}}),new sf.buttons.Button({iconCss:"e-icons e-delete-icon",cssClass:"e-small e-round"}).appendTo(a),new sf.popups.Tooltip({content:this.l10n.getConstant("DeleteGroup")}).appendTo(a),sf.base.rippleEffect(a,{selector:".deletegroup"}),i.querySelector(".e-group-action").appendChild(a);for(var f=r.querySelector(".e-rule-list"),m=f.children,g=0,y=0,v=m.length;y<v;y++)m[y].className.indexOf("e-group-container")>-1&&(g+=1);f.appendChild(i);var b=this.levelColl[r.id].slice(0);b.push(g),this.levelColl[i.id]=b,this.isImportRules||(this.addGroups([],r.id.replace(this.element.id+"_","")),n&&this.addRuleElement(i,{}))}else r.appendChild(i),this.levelColl[i.id]=[0];if(this.enableNotCondition)new sf.buttons.Button({content:this.l10n.getConstant("NOT"),cssClass:"e-btn e-small"}).appendTo(c),i.querySelector(".e-btngroup-and-lbl").classList.add("e-not"),this.updatedRule&&this.updatedRule.not&&sf.base.addClass([c],"e-active-toggle");this.updatedRule=null;var C=i.querySelector(".e-add-btn");if(new sf.splitbuttons.DropDownButton({items:this.items,cssClass:"e-round e-small e-caret-hide e-addrulegroup",iconCss:"e-icons e-add-icon",beforeOpen:this.selectBtn.bind(this,C),select:this.selectBtn.bind(this,C)}).appendTo(C),!this.isImportRules){var S=r.id.replace(this.element.id+"_",""),x=i.id.replace(this.element.id+"_","");this.trigger("change",{groupID:S,type:"insertGroup",childGroupID:x})}}},t.prototype.notifyChange=function(e,t,l){for(var s=sf.base.closest(t,".e-group-container"),n=this.getParentGroup(s),r=sf.base.closest(t,".e-rule-container"),a=0;r&&null!==r.previousElementSibling;)r=r.previousElementSibling,a++;var i=n.rules[a],o=this.getColumn(i.field),u=this.getFormat(o.format);if("date"===o.type)if(e instanceof Date)e=this.intl.formatDate(e,u);else if(e instanceof Array)for(var d=0;d<e.length;d++)e[d]instanceof Date&&(e[d]=this.intl.formatDate(e[d],u));if(o.ruleTemplate)this.templateChange(t,e,l);else{var p=sf.base.closest(t,".e-rule-value").querySelectorAll(".e-template"),c=sf.base.closest(t,".e-rule-container").querySelector(".e-filter-input"),h=sf.base.getComponent(c,"dropdownlist");o=h.getDataByValue(h.value);for(var f=[],m=(d=0,p.length);d<m;d++)"date"===o.type&&e[d]instanceof Date?f.push(this.intl.formatDate(e[d],u)):f=e;this.updateRules(t,p.length>1?f:e)}},t.prototype.templateChange=function(e,t,l){for(var s=sf.base.closest(e,".e-group-container"),n=this.getParentGroup(s),r=sf.base.closest(e,".e-rule-container"),a=0;r&&null!==r.previousElementSibling;)r=r.previousElementSibling,a++;var i,o=n.rules[a];"field"===l?this.selectedColumn=this.getColumn(t):o&&(this.selectedColumn=this.getColumn(o.field)),this.previousColumn=this.getColumn(o.field);var u=this.getValidRules(this.rule);this.selectedColumn&&(i=this.selectedColumn.operators?this.selectedColumn.operators:this.customOperators[this.selectedColumn.type+"Operator"]);var d,p=["in","notin","between","notbetween"];switch(l){case"field":o.field=t,o.label=this.selectedColumn.label,o.type=this.selectedColumn.type,o.value="",o.operator=i[0].value;break;case"operator":d=o.operator,o.operator=t,p.indexOf(o.operator)>-1?o.value=[]:p.indexOf(d)>-1&&(o.value="");break;case"value":o.value=t}if(this.changeRuleTemplate(this.selectedColumn,e,o,l),this.filterRules(u,this.getValidRules(this.rule),l),this.selectedColumn&&this.selectedColumn.ruleTemplate&&("field"===l||"operator"===l)){var c=sf.base.closest(e,".e-rule-container");this.destroyControls(c,!0),sf.base.detach(c.querySelector(".e-rule-field"));var h=this.appendRuleElem(sf.base.closest(c,".e-group-container"),this.selectedColumn,"change",c.id,l,o);"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?h.className="e-rule-container e-vertical-mode":h.className="e-rule-container e-horizontal-mode",h.previousElementSibling&&h.previousElementSibling.className.indexOf("e-rule-container")>-1&&(h.className.indexOf("e-joined-rule")<0&&(h.className+=" e-joined-rule"),h.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(h.previousElementSibling.className+=" e-prev-joined-rule")),h.previousElementSibling&&h.previousElementSibling.className.indexOf("e-group-container")>-1&&h.className.indexOf("e-separate-rule")<0&&(h.className+=" e-separate-rule");var f={requestType:"template-create",action:l,ruleID:c.id,fields:this.fields,rule:o};this.trigger("actionBegin",f)}},t.prototype.changeValue=function(e,t){var l,s,n,r=this;t.event?n=t.event.target:n=t.element;(n.className.indexOf("e-day")>-1||n.className.indexOf("e-cell")>-1)&&(n=t.element);var a=sf.base.closest(n,".e-group-container"),i=sf.base.closest(n,".e-rule-container");l=a&&a.id.replace(this.element.id+"_",""),s=i.id.replace(this.element.id+"_","");var o,u,d,p=t;if(p.element&&p.element.className.indexOf("e-datepicker")>-1&&(n=p.element),n.className.indexOf("e-radio")>-1)if(u=parseInt(n.id.split("valuekey")[1],0),d=sf.base.getComponent(sf.base.closest(n,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist"),this.selectedColumn=d.getDataByValue(d.value),this.selectedColumn.values)o=this.selectedColumn.values[u];else{o=[!0,!1][u]}else o=n.className.indexOf("e-multiselect")>-1?sf.base.getComponent(n,"multiselect").value:t.value;"input"===t.name&&this.immediateModeDelay?(window.clearInterval(this.timer),this.timer=window.setInterval((function(){r.filterValue(l,s,o,e,n)}),this.immediateModeDelay)):this.filterValue(l,s,o,e,n)},t.prototype.filterValue=function(e,t,l,s,n){var r=this,a={groupID:e,ruleID:t,value:l,cancel:!1,type:"value"};window.clearInterval(this.timer),this.isImportRules?this.changeValueSuccessCallBack(a,n,s,e,t):this.trigger("beforeChange",a,(function(l){r.changeValueSuccessCallBack(l,n,s,e,t)}))},t.prototype.changeValueSuccessCallBack=function(e,t,l,s,n){e.cancel||(this.updateRules(t,e.value,l),this.isImportRules||this.trigger("change",{groupID:s,ruleID:n,value:e.value,cancel:!1,type:"value"}))},t.prototype.changeField=function(e){if(e.isInteracted){var t=this.getColumn(e.value);if(t&&t.ruleTemplate)this.templateChange(e.element,t.field,"field");else{for(var l=sf.base.closest(e.element,".e-group-container"),s=this.getParentGroup(l),n=sf.base.closest(e.element,".e-rule-container"),r=0;n&&null!==n.previousElementSibling;)n=n.previousElementSibling,r++;this.changeRule(s.rules[r],e)}}},t.prototype.changeRule=function(e,t){if(t.itemData){var l=sf.base.closest(t.element,".e-rule-filter"),s=sf.base.getComponent(t.element,"dropdownlist"),n=sf.base.closest(t.element,".e-group-container").id.replace(this.element.id+"_","");this.changeFilter(l,s,n,e,{},t)}},t.prototype.changeFilter=function(e,t,l,s,n,r){var a=this;if(e){this.selectedColumn=t.getDataByValue(t.value);var i;i={groupID:l,ruleID:sf.base.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),selectedField:t.value,cancel:!1,type:"field"},this.isImportRules?this.fieldChangeSuccess(i,n,e,s,r):this.trigger("beforeChange",i,(function(t){a.fieldChangeSuccess(t,n,e,s,r)}))}else{var o=sf.base.closest(r.element,".e-rule-operator");this.changeOperator(e,o,t,l,s,n,r)}},t.prototype.changeOperator=function(e,t,l,s,n,r,a){var i,o=this;t?(i={groupID:s,ruleID:sf.base.closest(t,".e-rule-container").id.replace(this.element.id+"_",""),selectedIndex:l.index,cancel:!1,type:"operator"},this.isImportRules?this.operatorChangeSuccess(i,e,r,n,a):this.trigger("beforeChange",i,(function(t){o.operatorChangeSuccess(t,e,r,n,a)}))):this.changeRuleValues(e,n,r,a)},t.prototype.fieldChangeSuccess=function(e,t,l,s,n){for(var r=sf.base.closest(l,".e-rule-container"),a=sf.base.closest(n.element,".e-rule-operator"),i=sf.base.closest(n.element,".e-group-container").id.replace(this.element.id+"_",""),o=sf.base.getComponent(n.element,"dropdownlist"),u=r.querySelectorAll(".e-tooltip.e-input-group"),d=0;d<u.length;d++)sf.base.getComponent(u[d],"tooltip").destroy();e.cancel||(t.type=this.selectedColumn.type,r.querySelector(".e-template")&&(s.value="")),this.changeOperator(l,a,o,i,s,t,n)},t.prototype.operatorChangeSuccess=function(e,t,s,n,r){if(!e.cancel){var a=sf.base.closest(r.element,".e-rule-operator"),i=a.nextElementSibling,o=sf.base.getComponent(r.element,"dropdownlist"),u=n.operator?n.operator.toString().toLowerCase():"";s.operator=o.value.toString();var d=s.operator.toLowerCase();if(s.operator.toLowerCase().indexOf("between")>-1||s.operator.toLowerCase().indexOf("in")>-1&&s.operator.toLowerCase().indexOf("contains")<0?(t=a.previousElementSibling,s.type=n.type,(s.operator.toLowerCase().indexOf("in")<0||u.indexOf("in")<0)&&(n.value=[])):"object"===l(n.value)&&null!=n.value&&(n.value=n.value.length>0?n.value[0]:""),r.previousItemData){var p=r.previousItemData.value.toString().toLowerCase();(p.indexOf("between")>-1||(p.indexOf("in")>-1||p.indexOf("null")>-1||p.indexOf("empty")>-1)&&p.indexOf("contains")<0)&&(t=a.previousElementSibling,s.type=n.type)}if(u.indexOf("in")>-1&&u.indexOf("in")<5&&d.indexOf("in")>-1&&d.indexOf("in")<5&&(t=null),s.operator.indexOf("null")>-1||s.operator.indexOf("empty")>-1){var c=a.parentElement.querySelector(".e-rule-value");sf.base.removeClass([c],"e-show"),sf.base.addClass([c],"e-hide")}i&&i.querySelector(".e-template")&&(t=a.previousElementSibling),this.changeRuleValues(t,n,s,r)}},t.prototype.changeRuleValues=function(e,t,l,s){var n,r,a,i=sf.base.closest(s.element,".e-rule-operator");if(e)if(i=e.nextElementSibling,sf.base.addClass([i],"e-operator"),i.childElementCount){n=sf.base.getComponent(i.querySelector(".e-dropdownlist"),"dropdownlist"),l.operator=n.value;var o=s.itemData;this.renderValues(i,o,s.previousItemData,!0,t,l,s.element)}else{var u=sf.base.closest(i,".e-rule-container").id;a=this.createElement("input",{attrs:{type:"text",id:u+"_operatorkey"}}),i.appendChild(a),this.selectedColumn.operators?r=this.selectedColumn.operators:s.itemData&&(r=this.customOperators[this.selectedColumn.type+"Operator"]);var d=this.element.className.indexOf("e-device")>-1?"250px":"200px",p=r[0].value;p=t&&""!==t.operator?t.operator:p,new sf.dropdowns.DropDownList({dataSource:r,fields:{text:"key",value:"value"},placeholder:this.l10n.getConstant("SelectOperator"),popupHeight:r.length>5?d:"auto",change:this.changeField.bind(this),index:0,value:p}).appendTo("#"+u+"_operatorkey"),l.operator=t&&""!==t.operator?t.operator:r[0].value,this.isImportRules&&(l.type=this.selectedColumn.type,l.operator=t.operator),this.renderValues(i,this.selectedColumn,s.previousItemData,!1,t,l,s.element)}this.isImportRules||this.updateRules(s.element,s.item)},t.prototype.destroyControls=function(e,t){var l,s,n=t?e:e.nextElementSibling;l=n.querySelectorAll("input.e-control"),s=n.querySelectorAll("div.e-control:not(.e-handle)");for(var r,a=this.columns,i=0,o=l.length;i<o;i++){if(l[i].classList.contains("e-textbox"))sf.base.getComponent(l[i],"textbox").destroy(),sf.base.detach(n.querySelector("input#"+l[i].id));else if(l[i].classList.contains("e-dropdownlist"))sf.base.getComponent(l[i],"dropdownlist").destroy();else if(l[i].classList.contains("e-radio"))sf.base.getComponent(l[i],"radio").destroy();else if(l[i].classList.contains("e-numerictextbox"))sf.base.getComponent(l[i],"numerictextbox").destroy(),sf.base.detach(n.querySelector("input#"+l[i].id));else if(l[i].classList.contains("e-datepicker"))sf.base.getComponent(l[i],"datepicker").destroy();else if(l[i].classList.contains("e-multiselect"))sf.base.getComponent(l[i],"multiselect").destroy();else if(l[i].className.indexOf("e-template")>-1)for(var u=l[i].className,d=0,p=a.length;d<p;d++)if(a[d].template&&u.indexOf(a[d].field)>-1){this.templateDestroy(a[d],l[i].id);break}document.getElementById(l[i].id)&&sf.base.detach(l[i])}for(i=0,o=s.length;i<o;i++){if(s[i].className.indexOf("e-template")>-1)for(u=s[i].className,d=0,p=a.length;d<p;d++)if(a[d].template&&u.indexOf(a[d].field)>-1){this.templateDestroy(a[d],s[i].id);break}sf.base.detach(s[i])}for(i=0,o=(r=n.querySelectorAll(".e-template:not(.e-control)")).length;i<o;i++)sf.base.detach(r[i])},t.prototype.templateDestroy=function(e,t){var l=e.template.destroy;if(e.template&&e.template.destroy){var s;s=sf.base.closest(document.getElementById(t),".e-rule-field").querySelectorAll(".e-template"),"string"==typeof l?(l=sf.base.getValue(l,window))({field:e.field,elementId:t,elements:s}):e.template.destroy({field:e.field,elementId:t,elements:s})}},t.prototype.getValues=function(e){var t,l={},s=[],n=this.dataColl,r=e.split(".");if(this.dataColl[1])for(var a=0,i=n.length;a<i;a++){var o={};if(r.length>1)for(var u=n[a],d=void 0,p=0,c=r.length;p<c;p++)d=r[p],r.length===p+1?(t=u[d],Number(u[d])===u[d]&&u[d]%1!=0&&(t=u[d].toString())):u=u[d];else t=n[a][e],Number(n[a][e])===n[a][e]&&n[a][e]%1!=0&&(t=n[a][e].toString());t in l||(l[t]=1,r.length>1?this.createNestedObject(o,r,t):o[e]=t,s.push(o))}return s},t.prototype.createNestedObject=function(e,t,l){for(var s,n=t.length-1,r=0;r<n;++r)(s=t[r])in e||(e[s]={}),e=e[s];e[t[n]]=l},t.prototype.getDistinctValues=function(e,t){for(var l={},s=[],n=0,r=e.length;n<r;n++){var a=e[n][t];Number(e[n][t])===e[n][t]&&e[n][t]%1!=0&&(a=e[n][t].toString());var i={};a in l||(l[a]=1,i[t]=a,s.push(i))}return s},t.prototype.renderMultiSelect=function(e,t,l,s,n){var r,a=!1,i=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(e.field)>-1&&(a=!0,r=this.getDistinctValues(this.dataColl,e.field)),!this.dataColl.length&&n.length&&(i=!0);var o=new sf.dropdowns.MultiSelect({dataSource:i?n:a?r:this.dataManager,query:new sf.data.Query([e.field]),fields:{text:e.field,value:e.field},placeholder:this.l10n.getConstant("SelectValue"),value:s,mode:"CheckBox",width:"100%",change:this.changeValue.bind(this,l),close:this.closePopup.bind(this,l),actionBegin:this.multiSelectOpen.bind(this,t+"_valuekey"+l)});o.appendTo("#"+t+"_valuekey"+l),this.updateRules(o.element,s,0)},t.prototype.multiSelectOpen=function(e,t){if(this.dataSource instanceof sf.data.DataManager){var l=document.getElementById(e),s=sf.base.getComponent(sf.base.closest(l,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist");this.selectedColumn=s.getDataByValue(s.value);var n=this.selectedColumn.field,r=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(n)>-1&&(r=!0),r||(t.cancel=!0,sf.base.isBlazor()?this.bindBlazorMultiSelectData(l,n):this.bindMultiSelectData(l,n))}},t.prototype.bindBlazorMultiSelectData=function(e,t){return r(this,void 0,void 0,(function(){return a(this,(function(l){switch(l.label){case 0:return[4,this.getMultiSelectData(e,t)];case 1:return l.sent(),[2]}}))}))},t.prototype.bindMultiSelectData=function(e,t){this.getMultiSelectData(e,t)},t.prototype.getMultiSelectData=function(e,t){var l,s=this,n=new sf.data.Deferred,r=this.dataManager.executeQuery((new sf.data.Query).select(t)),a=sf.base.getComponent(e,"multiselect");a.hideSpinner(),this.createSpinner(sf.base.closest(e,".e-multi-select-wrapper").parentElement),sf.popups.showSpinner(sf.base.closest(e,".e-multi-select-wrapper").parentElement),r.then((function(n){l=n.actual&&n.actual.result?n.actual.result:n.result,s.dataColl=sf.base.extend(s.dataColl,l,[],!0),a.dataSource=s.getDistinctValues(s.dataColl,t),sf.popups.hideSpinner(sf.base.closest(e,".e-multi-select-wrapper").parentElement)})).catch((function(e){n.reject(e)}))},t.prototype.createSpinner=function(e){var t=this.createElement("span",{attrs:{class:"e-qb-spinner"}});e.appendChild(t),sf.popups.createSpinner({target:t,width:sf.base.Browser.isDevice?"16px":"14px"})},t.prototype.closePopup=function(e,t){var l=document.getElementById(t.popup.element.id.replace("_popup","")),s=sf.base.getComponent(l,"multiselect").value;this.updateRules(l,s,e)},t.prototype.processTemplate=function(e,t,l,s){var n,r=sf.base.closest(e,".e-rule-container"),a=r.querySelectorAll(".e-template");n=sf.base.getComponent(r.querySelector(".e-rule-filter .e-filter-input"),"dropdownlist");var i=this.getColumn(n.value);a.length<2?t.template&&"string"==typeof t.template.write?sf.base.getValue(t.template.write,window)({elements:a[0],values:l.value,operator:s.operator,field:i.field,dataSource:i.values}):t.template&&t.template.write&&t.template.write({elements:a[0],values:l.value,operator:s.operator,field:i.field,dataSource:i.values}):t.template&&"string"==typeof t.template.write?sf.base.getValue(t.template.write,window)({elements:a,values:l.value,operator:s.operator,field:i.field,dataSource:i.values}):t.template&&t.template.write&&t.template.write({elements:a,values:l.value,operator:s.operator,field:i.field,dataSource:i.values})},t.prototype.getItemData=function(e){var t=sf.base.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist");return this.getColumn(t.value)},t.prototype.setDefaultValue=function(e,t,l){var s=this.getItemData(e);if(sf.base.isNullOrUndefined(s.value))return l?t?[0,0]:0:t?[]:"";if(t){if(!(s.value instanceof Array))return[s.value]}else if(s.value instanceof Array)return s.value[0];return s.value},t.prototype.renderStringValue=function(e,t,l,s,n){var r,a,i=this.getItemData(e);if(a=this.isImportRules||this.isPublic?t.value:this.setDefaultValue(e,!1,!1),"in"!==l&&"notin"!==l||!this.dataColl.length&&!i.values){"in"!==l&&"notin"!==l||(a=(r=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1)).join(","));var o=new sf.inputs.TextBox({placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,s)});o.appendTo("#"+e+"_valuekey"+s),o.value=a,o.dataBind()}else r=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(i,e,s,r,i.values),"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?n.style.width="100%":(n.style.width=null,n.style.minWidth="200px")},t.prototype.renderNumberValue=function(e,t,l,s,n,r,a){var i=this.getItemData(e),o=this.isImportRules||this.isPublic?t.value:this.setDefaultValue(e,!1,!0);if("in"!==l&&"notin"!==l||!this.dataColl.length&&!i.values)if("in"===l||"notin"===l){var u=(o=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1)).join(","),d=new sf.inputs.TextBox({placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,s)});d.appendTo("#"+e+"_valuekey"+s),d.value=u,d.dataBind()}else{var p=sf.base.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist"),c=(r=this.getColumn(p.value)).validation&&r.validation.min?r.validation.min:0,h=r.validation&&r.validation.max?r.validation.max:Number.MAX_VALUE,f=r.format?r.format:"n";a>1&&t&&(o=t.value[s]?t.value[s]:this.setDefaultValue(e,!0,!0)),new sf.inputs.NumericTextBox({value:o instanceof Array?o[s]:o,format:f,min:c,max:h,width:"100%",step:r.step?r.step:1,change:this.changeValue.bind(this,s)}).appendTo("#"+e+"_valuekey"+s)}else o=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(i,e,s,o,i.values),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?n.style.width="100%":(n.style.minWidth="200px",n.style.width=null)},t.prototype.processValueString=function(e,t){var l=[],s=e.split(",");if("string"===t)return s;for(var n=0,r=s.length;n<r;n++)l.push(Number(s[n]));return l},t.prototype.parseDate=function(e,t){var l,s;if(t){var n=this.intl.getDateParser({skeleton:"full",type:"dateTime"});l=this.getFormat(t),s=n(e),sf.base.isNullOrUndefined(s)&&(s=this.intl.parseDate(e,l))}else s=new Date(e);return s},t.prototype.renderControls=function(e,t,l,s){if(sf.base.addClass([e.parentElement.querySelector(".e-rule-value")],"e-value"),sf.base.removeClass([e.parentElement.querySelector(".e-rule-value")],"e-hide"),sf.base.addClass([e.parentElement.querySelector(".e-rule-value")],"e-show"),t.template)this.processTemplate(e,t,l,s);else{var n;n="boolean"===s.type?this.selectedColumn.values?this.selectedColumn.values.length:2:s.operator&&s.operator.toString().toLowerCase().indexOf("between")>-1?2:1;var r,a=sf.base.closest(e,".e-rule-container").id,i=void 0;if(r=s.operator.toString(),e.className.indexOf("e-rule-operator")>-1||e.className.indexOf("e-rule-filter")>-1){i=e.parentElement.querySelector(".e-rule-value"),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?i.style.width="100%":"in"!==r&&"notin"!==r&&(i.style.width="200px");for(var o=0;o<n;o++)switch(s.type){case"string":this.renderStringValue(a,l,r,o,i);break;case"number":this.renderNumberValue(a,l,r,o,i,t,n);break;case"boolean":this.processBoolValues(t,l,a,o);break;case"date":var u=new Date,d=void 0,p=void 0,c=t.format,h=void 0,f=this.l10n.getConstant("SelectValue");if(t.value&&(u=t.value instanceof Date?t.value:t.value instanceof Number?new Date(t.value):this.parseDate(t.value,t.format)),(this.isImportRules||this.isPublic)&&l&&l.value&&(p=this.getColumn(l.field),d=n>1?l.value[o]:l.value,u=this.parseDate(d,p.format),c=p.format),c){var m=this.getFormat(c);h=m.skeleton?new sf.calendars.DatePicker({locale:this.getLocale(),value:u,placeholder:f,format:m,change:this.changeValue.bind(this,o)}):new sf.calendars.DatePicker({value:u,locale:this.getLocale(),placeholder:f,format:m.format,change:this.changeValue.bind(this,o)})}else h=new sf.calendars.DatePicker({locale:this.getLocale(),value:u,placeholder:f,change:this.changeValue.bind(this,o)});h.appendTo("#"+a+"_valuekey"+o),l.value||this.updateRules(document.getElementById(a+"_valuekey"+o),u)}}}},t.prototype.processBoolValues=function(e,t,l,s){var n,r,a=!1;if(sf.base.isNullOrUndefined(t.type)&&e&&(t.type=e.type),e.values){var i=e.values;"boolean"!==t.type||sf.base.isNullOrUndefined(t.value)?e.value?a=i[s].toLowerCase()===e.value.toString().toLowerCase():0===s&&(a=!0):a=i[s].toLowerCase()===t.value.toString().toLowerCase(),r=n=i[s]}else{i=[!0,!1];"boolean"!==t.type||sf.base.isNullOrUndefined(t.value)?e.value?a=i[s].toString().toLowerCase()===e.value.toString().toLowerCase():0===s&&(a=!0):a=i[s].toString().toLowerCase()===t.value.toString().toLowerCase(),n=i[s].toString(),r=i[s]}var o=new sf.buttons.RadioButton({label:n,name:l+"default",checked:a,value:n,change:this.changeValue.bind(this,s)});o.appendTo("#"+l+"_valuekey"+s),a&&this.updateRules(o.element,r,0)},t.prototype.getOperatorIndex=function(e,t){var l,s=e.dataSource.length;for(l=0;l<s;l++)if(t.operator===e.dataSource[l].value)return l;return 0},t.prototype.renderValues=function(e,t,l,s,n,r,a){var i=document.getElementById(a.id.replace("operatorkey","filterkey")),o=sf.base.getComponent(i,"dropdownlist");if(s){var u=sf.base.getComponent(e.querySelector("input"),"dropdownlist");t.operators?(u.value=null,u.dataBind(),u.dataSource=t.operators,u.index=this.getOperatorIndex(u,n),u.value=r.operator=u.dataSource[u.index].value,u.dataBind()):t.type&&(u.value=null,u.dataBind(),u.dataSource=this.customOperators[t.type+"Operator"],u.index=this.getOperatorIndex(u,n),u.value=r.operator=u.dataSource[u.index].value,u.dataBind())}var d=r.operator.toString();if(!(d.indexOf("null")>-1||d.indexOf("empty")>-1)){var p=sf.base.closest(e,".e-rule-container").id;l&&l.template&&(this.templateDestroy(l,p+"_valuekey0"),sf.base.isBlazor()?l.field!==t.field&&(sf.base.blazorTemplates[this.element.id+l.field]=[],sf.base.resetBlazorTemplate(this.element.id+l.field,"Template"),sf.base.detach(e.nextElementSibling.querySelector(".e-blazor-template"))):sf.base.detach(e.nextElementSibling.querySelector("#"+p+"_valuekey0"))),s&&(sf.base.isBlazor()&&!l.template?this.destroyControls(e):sf.base.isBlazor()||this.destroyControls(e));var c=this.getColumn(o.value);if(t.template=c.template,t.template){if(sf.base.isBlazor()&&t.field){this.columnTemplateFn=this.templateParser(t.template);var h=this.element.id+t.field,f=this.columnTemplateFn(t,this,"Template",h);e.nextElementSibling.appendChild(f[0]),sf.base.updateBlazorTemplate(h,"Template",c,!1)}sf.base.addClass([e.nextElementSibling],"e-template-value"),t.template=c.template;var m=void 0;if(t.template&&"string"==typeof t.template.create?m=sf.base.getValue(t.template.create,window)({field:c.field,operator:t.value||d}):t.template&&t.template.create&&(m=t.template.create({field:c.field,operator:t.value||d})),m instanceof Element)m.id=p+"_valuekey0",sf.base.addClass([m],"e-template"),sf.base.addClass([m],"e-"+c.field),e.nextElementSibling.appendChild(m);else if(m instanceof Array){sf.base.addClass(m,"e-template");for(var g=0,y=m.length;g<y;g++)m[g].id=p+"_valuekey"+g,e.nextElementSibling.appendChild(m[g])}var v=e.parentElement.querySelector(".e-rule-value");this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?v.style.width="100%":v.style.width="200px"}else{sf.base.removeClass([e.nextElementSibling],"e-template-value");var b=1;b="boolean"===r.type?this.selectedColumn.values?this.selectedColumn.values.length:2:d&&d.toLowerCase().indexOf("between")>-1?2:1;for(g=0;g<b;g++){m=void 0;m=this.createElement("input",{attrs:{type:"text",id:p+"_valuekey"+g}}),e.nextElementSibling.appendChild(m)}}this.renderControls(e,t,n,r)}},t.prototype.updateValues=function(e,t){var l=1;e.className.indexOf("e-template")>-1&&(l=3);var s=e.className.split(" e-")[l],n=parseInt(e.id.slice(-1),2);switch(s){case"textbox":case"dropdownlist":t.value=sf.base.getComponent(e,s).value;break;case"radio":var r=sf.base.getComponent(e,s);r.checked&&("boolean"==typeof t.value?t.value="true"===r.value:this.getColumn(t.field).values?t.value=r.value:t.value="true"===r.value),r.refresh();break;case"numerictextbox":t.operator.indexOf("between")>-1?("string"==typeof t.value&&(t.value=[]),t.value[n]=sf.base.getComponent(e,s).value):t.value=sf.base.getComponent(e,s).value;break;case"datepicker":var a=this.getColumn(t.field),i=this.getFormat(a.format),o=sf.base.getComponent(e,s).value;t.operator.indexOf("between")>-1?("string"==typeof t.value&&(t.value=[]),t.value[n]=o):sf.base.isNullOrUndefined(i.format)&&o?t.value=this.intl.formatDate(o):t.value=o?this.intl.formatDate(o,i):"";break;case"multiselect":t.value=sf.base.getComponent(e,s).value}},t.prototype.updateRules=function(e,t,l){for(var s,n,r,a=sf.base.closest(e,".e-group-container"),i=this.getParentGroup(a),o=sf.base.closest(e,".e-rule-container"),u=0,d=a.id.replace(this.element.id+"_",""),p=this.getValidRules(this.rule);o&&null!==o.previousElementSibling;)o=o.previousElementSibling,u++;var c=i.rules[u].operator.toString();if(r=(o=sf.base.closest(e,".e-rule-container")).id.replace(this.element.id+"_",""),sf.base.closest(e,".e-rule-filter")){s=sf.base.getComponent(e,"dropdownlist");var h=this.getColumn(s.value);this.isImportRules||i.rules[u].field.toLowerCase()===h.field.toLowerCase()||(!o.querySelectorAll(".e-template")&&!(c.indexOf("null")>-1)||c.indexOf("empty")>-1)&&(i.rules[u].value=""),this.selectedColumn=s.getDataByValue(s.value),i.rules[u].field=this.selectedColumn.field,i.rules[u].type=this.selectedColumn.type,i.rules[u].label=this.selectedColumn.label;var f=sf.base.closest(e,".e-rule-filter"),m=f.nextElementSibling.querySelector("input.e-control");c=sf.base.getComponent(m,"dropdownlist").value.toString(),i.rules[u].operator=c;var g=f.nextElementSibling.nextElementSibling,y=g.querySelectorAll("input.e-control");y.length<1&&(y=g.querySelectorAll(".e-template"));for(var v=0;v<y.length;v++)y[v]||(y[v]=f.nextElementSibling.nextElementSibling.querySelector("div.e-control")),y[v]||(y[v]=f.nextElementSibling.nextElementSibling.querySelector(".e-template")),n={groupID:d,ruleID:r,value:i.rules[u].field,type:"field"},c.indexOf("null")>-1||c.indexOf("empty")>-1?i.rules[u].value=null:this.updateValues(y[v],i.rules[u]);this.isImportRules||this.trigger("change",n),this.allowValidation&&i.rules[u].field&&e.parentElement.className.indexOf("e-tooltip")>-1&&sf.base.getComponent(e.parentElement,"tooltip").destroy(),this.filterRules(p,this.getValidRules(this.rule),"field")}else if(sf.base.closest(e,".e-rule-operator")){s=sf.base.getComponent(e,"dropdownlist"),i.rules[u].operator=s.value.toString();var b=void 0;e.parentElement;b=o.querySelectorAll(".e-rule-value input.e-control"),n={groupID:d,ruleID:r,value:s.value,type:"operator"},this.allowValidation&&i.rules[u].operator&&e.parentElement.className.indexOf("e-tooltip")>-1&&sf.base.getComponent(e.parentElement,"tooltip").destroy(),b.length>1&&!(b[0].className.indexOf("e-template")>-1)&&(i.rules[u].value=[]);for(var C=0;C<b.length;C++)i.rules[u].operator.indexOf("null")>-1||i.rules[u].operator.indexOf("empty")>-1?i.rules[u].value=null:b[C].classList.contains("e-template")||this.updateValues(b[C],i.rules[u]);this.isImportRules||this.trigger("change",n),this.filterRules(p,this.getValidRules(this.rule),"operator")}else sf.base.closest(e,".e-rule-value")&&(this.ruleValueUpdate(e,t,i,u,a,o,l),this.filterRules(p,this.getValidRules(this.rule),"value"))},t.prototype.filterRules=function(e,t,l){JSON.stringify({condition:e.condition,not:e.not,rule:e.rules})!==JSON.stringify({condition:t.condition,not:t.not,rule:t.rules})&&(this.isImportRules||this.trigger("ruleChange",{previousRule:e,rule:t,type:l}))},t.prototype.ruleValueUpdate=function(e,t,l,s,n,r,a){var i,o,u=["in","between","notin","notbetween"];if(l.rules[s].operator&&(o=l.rules[s].operator.toString().toLowerCase()),null!==t){if(e.className.indexOf("e-multiselect")>-1&&"number"===l.rules[s].type&&!(e.className.indexOf("e-template")>-1)){for(var d=[],p=t,c=0,h=p.length;c<h;c++)"string"==typeof p[c]&&d.push(parseFloat(p[c]));d.length&&(t=d)}if(e.classList.contains("e-blazor-template")||e.className.indexOf("e-template")>-1)l.rules[s].value=t,i={groupID:n.id,ruleID:r.id,value:l.rules[s].value,type:"value"},this.isImportRules||this.trigger("change",i);else if(e.className.indexOf("e-spin")>-1||e.className.indexOf("e-numeric")>-1)u.indexOf(o)>-1?l.rules[s].value[a]=t:l.rules[s].value=t;else if(e.className.indexOf("e-radio")>-1)l.rules[s].value=t;else if(e.className.indexOf("e-multiselect")>-1)l.rules[s].value=t;else if(e.className.indexOf("e-textbox")>-1)"in"===o||"notin"===o?(l.rules[s].type,l.rules[s].value=this.processValueString(t,l.rules[s].type)):l.rules[s].value=t;else if(e.className.indexOf("e-datepicker")>-1){var f=sf.base.getInstance(r.querySelector(".e-rule-filter input"),sf.dropdowns.DropDownList),m=this.getFormat(this.getColumn(f.value).format);m.type&&(u.indexOf(o)>-1?("string"==typeof l.rules[s].value&&(l.rules[s].value=[]),l.rules[s].value[a]=this.intl.formatDate(t,m)):l.rules[s].value=this.intl.formatDate(t,m))}this.validatValue(l,s,r)}else e.className.indexOf("e-datepicker")>-1&&(u.indexOf(o)>-1?("string"==typeof l.rules[s].value&&(l.rules[s].value=[]),l.rules[s].value[a]=""):l.rules[s].value="")},t.prototype.validatValue=function(e,t,l){if(this.allowValidation&&e.rules[t].value){var s=l.querySelectorAll(".e-rule-value .e-control");s[0].className.indexOf("e-tooltip")>-1?sf.base.getComponent(s[0],"tooltip").destroy():s[0].parentElement.className.indexOf("e-tooltip")>-1&&sf.base.getComponent(s[0].parentElement,"tooltip").destroy(),s[1]&&s[1].parentElement.className.indexOf("e-tooltip")>-1&&sf.base.getComponent(s[1].parentElement,"tooltip").destroy()}},t.prototype.getFormat=function(e){var t;return e?"string"==typeof e?(t={type:"dateTime",format:e},"short"===e&&(t.skeleton=e)):t={type:"dateTime",skeleton:e.skeleton}:t={type:"dateTime",skeleton:"yMd"},t},t.prototype.findGroupByIdx=function(e,t,l){var s=t.rules,n=[];if(!l){for(var r=0,a=s.length;r<a;r++)(t=s[r]).rules&&n.push(t);return n[e]}return t},t.prototype.destroy=function(){if(this.element){var t,l,s,n;for(e.prototype.destroy.call(this),s=(t=this.element.querySelectorAll(".e-addrulegroup")).length,l=0;l<s;l++)sf.base.getComponent(t[l],"dropdown-btn").destroy(),sf.base.detach(t[l]);for(n=this.element.querySelectorAll(".e-rule-filter .e-control.e-tooltip"),l=0;l<n.length;l++)sf.base.getComponent(n[l],"tooltip").destroy();for(s=(t=this.element.querySelectorAll(".e-rule-filter .e-control:not(.e-tooltip)")).length,l=0;l<s;l++)sf.base.getComponent(t[l],"dropdownlist").destroy(),sf.base.detach(t[l]);for(n=this.element.querySelectorAll(".e-rule-operator .e-control.e-tooltip"),l=0;l<n.length;l++)sf.base.getComponent(n[l],"tooltip").destroy();for(s=(t=this.element.querySelectorAll(".e-rule-operator .e-control:not(.e-tooltip)")).length,l=0;l<s;l++)sf.base.getComponent(t[l],"dropdownlist").destroy(),sf.base.detach(t[l]);for(n=this.element.querySelectorAll(".e-rule-value .e-control.e-tooltip"),l=0;l<n.length;l++)sf.base.getComponent(n[l],"tooltip").destroy();this.isImportRules=!1,this.unWireEvents(),this.levelColl[this.element.id+"_group0"]=[0],this.element.innerHTML="",sf.base.classList(this.element,[],["e-rtl","e-responsive","e-device"])}},t.prototype.addRules=function(e,t){t=this.element.id+"_"+t,this.isPublic=!0;for(var l=0,s=e.length;l<s;l++)this.addRuleElement(document.getElementById(t),e[l]);this.isPublic=!1},t.prototype.addGroups=function(e,t){t=this.element.id+"_"+t;var l=document.getElementById(t),s=this.getParentGroup(l);if(e.length){this.isPublic=!0;for(var n=0,r=e.length;n<r;n++)this.updatedRule={condition:e[n].condition,not:e[n].not},this.importRules(e[n],l);this.isPublic=!1}else{var a="and",i=!1;this.updatedRule&&(a=this.updatedRule.condition,i=this.updatedRule.not),this.enableNotCondition?s.rules.push({condition:a,not:i,rules:[]}):s.rules.push({condition:a,rules:[]})}var o=l.querySelector(".e-btngroup-and"),u=l.querySelector(".e-btngroup-or");o.disabled&&(o.removeAttribute("disabled"),o.checked=!0,u.removeAttribute("disabled"))},t.prototype.initWrapper=function(){if(this.isInitialLoad=!0,this.cssClass&&sf.base.addClass([this.element],this.cssClass),this.enableRtl&&sf.base.addClass([this.element],"e-rtl"),this.width&&(this.element.style.width=this.width),this.height&&(this.element.style.height=this.height),this.rule.rules.length?this.isImportRules=!0:this.addGroupElement(!1,this.element),sf.base.Browser.isDevice||"Vertical"===this.displayMode?(sf.base.Browser.isDevice&&(this.element.style.width="100%",this.element.classList.add("e-device")),sf.base.removeClass(this.element.querySelectorAll(".e-rule-container"),"e-horizontal-mode"),sf.base.addClass(this.element.querySelectorAll(".e-rule-container"),"e-vertical-mode"),this.displayMode="Vertical"):this.displayMode="Horizontal",this.summaryView)this.isImportRules?this.renderSummary():this.renderSummaryCollapse();else{if(this.columns.length&&this.isImportRules){this.addGroupElement(!1,this.element,this.rule.condition);var e=sf.base.extend({},this.rule,{},!0);this.setGroupRules(e)}else this.columns.length&&this.addRuleElement(this.element.querySelector(".e-group-container"),{});this.notGroupRtl(),this.readonly&&this.enableReadonly();for(var t=this.element.querySelectorAll("label.e-btn"),l=void 0,s=0;s<t.length;s++)l=t.item(s),sf.base.rippleEffect(l,{selector:".e-btn"})}},t.prototype.renderSummary=function(){var e=this.createElement("div",{attrs:{class:"e-summary-content",id:this.element.id+"_summary_content"}}),t=this.createElement("textarea",{attrs:{class:"e-summary-text",readonly:"true"},styles:"max-height:500px"}),l=this.createElement("button",{attrs:{class:"e-edit-rule e-css e-btn e-small e-flat e-primary"}}),s=this.createElement("div",{attrs:{class:"e-summary-btndiv"}});e.appendChild(t),t.textContent=this.getSqlFromRules(this.rule),l.textContent=this.l10n.getConstant("Edit"),s.appendChild(l),e.appendChild(s),this.element.appendChild(e)},t.prototype.renderSummaryCollapse=function(){var e=this.createElement("div",{attrs:{class:"e-collapse-rule e-icons",title:this.l10n.getConstant("SummaryViewTitle")}});this.element.querySelector(".e-group-header").appendChild(e)},t.prototype.columnSort=function(){"descending"===this.sortDirection.toLowerCase()?this.columns=new sf.data.DataManager(this.columns).executeLocal((new sf.data.Query).sortByDesc("field")):"ascending"===this.sortDirection.toLowerCase()&&(this.columns=new sf.data.DataManager(this.columns).executeLocal((new sf.data.Query).sortBy("field")))},t.prototype.onChangeNotGroup=function(){if(this.element.innerHTML="",this.groupIdCounter=0,this.enableNotCondition){if(this.enableNotCondition){var e=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}});this.groupElem.querySelector(".e-btn-group").insertBefore(e,this.groupElem.querySelector(".e-btngroup-and"))}}else this.groupElem.querySelector(".e-qb-toggle").remove();this.rule=this.checkNotGroup(this.rule),this.initWrapper()},t.prototype.notGroupRtl=function(){this.enableRtl?sf.base.addClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl"):sf.base.removeClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl")},t.prototype.checkNotGroup=function(e){var t;if(e.rules)for(var l=0;l<e.rules.length;l++)t=e.rules[l],t=this.checkNotGroup(t),e.rules[l]=t;return sf.base.isNullOrUndefined(e.not)?this.enableNotCondition&&!sf.base.isNullOrUndefined(e.condition)&&(e.not=!1):(this.enableNotCondition&&(e.not=!1),delete e.not),e},t.prototype.onPropertyChanged=function(e,t){for(var l=0,s=Object.keys(e);l<s.length;l++){switch(s[l]){case"summaryView":var n=this.element.querySelector(".e-group-container"),r=this.element.querySelector(".e-summary-content");e.summaryView?(n.style.display="none",this.element.querySelectorAll(".e-summary-content").length<1?(this.renderSummary(),r=this.element.querySelector(".e-summary-content")):this.element.querySelector(".e-summary-text").textContent=this.getSqlFromRules(this.rule),r.style.display="block"):(n.querySelectorAll(".e-collapse-rule").length>-1&&this.renderSummaryCollapse(),n.style.display="block",r.style.display="none");break;case"displayMode":this.refresh();break;case"showButtons":e.showButtons.ruleDelete?sf.base.removeClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"):sf.base.addClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"),e.showButtons.groupDelete?sf.base.removeClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide"):sf.base.addClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide");break;case"cssClass":t.cssClass&&sf.base.removeClass([this.element],t.cssClass.split(" ")),e.cssClass&&sf.base.addClass([this.element],e.cssClass.split(" "));break;case"enableRtl":e.enableRtl?(sf.base.addClass([this.element],"e-rtl"),this.notGroupRtl()):(sf.base.removeClass([this.element],"e-rtl"),this.notGroupRtl());break;case"enablePersistence":this.enablePersistence=e.enablePersistence;break;case"dataSource":this.dataSource=e.dataSource,this.refresh();break;case"columns":if(sf.base.isBlazor()){for(var a=Object.keys(e.columns).toString(),i=e.columns[a].values;!this.target.classList.contains("e-blazor-template");)this.target=this.target.parentElement;this.updateRules(this.target,i)}else this.columns=e.columns;this.columnSort();break;case"sortDirection":this.sortDirection=e.sortDirection,this.columnSort();break;case"maxGroupCount":this.maxGroupCount=e.maxGroupCount;break;case"height":this.height=e.height,this.element.style.height=this.height;break;case"rule":this.rule=e.rule,e.rule=this.getRuleCollection(this.rule,!1);break;case"width":this.width=e.width,this.element.style.width=this.width;break;case"locale":this.locale=e.locale,this.intl=new sf.base.Internationalization(this.locale),this.isLocale=!0,this.refresh(),this.isLocale=!1;break;case"enableNotCondition":this.onChangeNotGroup();break;case"readonly":this.isReadonly=e.readonly,this.enableReadonly()}}},t.prototype.preRender=function(){this.element.id=this.element.id||sf.base.getUniqueID("ej2-querybuilder"),this.defaultLocale={StartsWith:"Starts With",EndsWith:"Ends With",Contains:"Contains",Equal:"Equal",NotEqual:"Not Equal",LessThan:"Less Than",LessThanOrEqual:"Less Than Or Equal",GreaterThan:"Greater Than",GreaterThanOrEqual:"Greater Than Or Equal",Between:"Between",NotBetween:"Not Between",In:"In",NotIn:"Not In",Remove:"REMOVE",SelectField:"Select a field",SelectOperator:"Select operator",DeleteRule:"Remove this condition",DeleteGroup:"Delete group",AddGroup:"Add Group",AddCondition:"Add Condition",Edit:"EDIT",ValidationMessage:"This field is required",SummaryViewTitle:"Summary View",OtherFields:"Other Fields",AND:"AND",OR:"OR",NOT:"NOT",SelectValue:"Enter Value",IsEmpty:"Is Empty",IsNotEmpty:"Is Not Empty",IsNull:"Is Null",IsNotNull:"Is Not Null"},this.l10n=new sf.base.L10n("querybuilder",this.defaultLocale,this.locale),this.intl=new sf.base.Internationalization(this.locale),this.groupIdCounter=0,this.ruleIdCounter=0,this.btnGroupId=0,this.isImportRules=!1,this.parser=[],this.customOperators={stringOperator:[{value:"startswith",key:this.l10n.getConstant("StartsWith")},{value:"endswith",key:this.l10n.getConstant("EndsWith")},{value:"contains",key:this.l10n.getConstant("Contains")},{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")},{value:"isempty",key:this.l10n.getConstant("IsEmpty")},{value:"isnotempty",key:this.l10n.getConstant("IsNotEmpty")}],dateOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],booleanOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],numberOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"between",key:this.l10n.getConstant("Between")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"notbetween",key:this.l10n.getConstant("NotBetween")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")}]},this.operators={equal:"=",notequal:"!=",greaterthan:">",greaterthanorequal:">=",lessthan:"<",in:"IN",notin:"NOT IN",lessthanorequal:"<=",startswith:"LIKE",endswith:"LIKE",between:"BETWEEN",notbetween:"NOT BETWEEN",contains:"LIKE",isnull:"IS NULL",isnotnull:"IS NOT NULL",isempty:"IS EMPTY",isnotempty:"IS NOT EMPTY",notstartswith:"NOT LIKE",notendswith:"NOT LIKE",notcontains:"NOT LIKE"},this.fields||(this.fields={text:"label",value:"field"})},t.prototype.render=function(){if(this.levelColl={},this.items=[{text:this.l10n.getConstant("AddGroup"),iconCss:"e-icons e-add-icon e-addgroup"},{text:this.l10n.getConstant("AddCondition"),iconCss:"e-icons e-add-icon e-addrule"}],this.ruleElem=this.ruleTemplate(),this.groupElem=this.groupTemplate(),!sf.base.isBlazor()){var e=[{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}],t=[{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}];this.customOperators.stringOperator=this.customOperators.stringOperator.concat(e),this.customOperators.numberOperator=this.customOperators.numberOperator.concat(t)}this.dataSource instanceof sf.data.DataManager?(this.dataManager=this.dataSource,this.executeDataManager((new sf.data.Query).take(1))):(this.dataManager=new sf.data.DataManager(this.dataSource),this.dataColl=this.dataManager.executeLocal(new sf.data.Query),this.initControl()),this.renderComplete()},t.prototype.templateParser=function(e){if(e)try{if(document.querySelectorAll(e).length)return sf.base.compile(document.querySelector(e).innerHTML.trim())}catch(t){return sf.base.compile(e)}},t.prototype.executeDataManager=function(e){var t=this,l=this.dataManager.executeQuery(e),s=new sf.data.Deferred;l.then((function(e){e.actual&&e.actual.result?t.dataColl=e.actual.result:t.dataColl=e.result,t.initControl()})).catch((function(e){s.reject(e)}))},t.prototype.initControl=function(){this.initialize(),this.initWrapper(),this.wireEvents()},t.prototype.wireEvents=function(){var e=this.getWrapper();sf.base.EventHandler.add(e,"click",this.clickEventHandler,this),sf.base.EventHandler.add(e,"focusout",this.focusEventHandler,this),sf.base.EventHandler.add(e,"focusin",this.focusEventHandler,this),sf.base.EventHandler.add(this.element,"keydown",this.keyBoardHandler,this)},t.prototype.unWireEvents=function(){var e=this.getWrapper();sf.base.EventHandler.remove(e,"click",this.clickEventHandler),sf.base.EventHandler.remove(e,"focusout",this.focusEventHandler),sf.base.EventHandler.remove(e,"focusin",this.focusEventHandler),sf.base.EventHandler.remove(this.element,"keydown",this.keyBoardHandler)},t.prototype.getParentGroup=function(e,t){for(var l=e instanceof Element?this.levelColl[e.id]:this.levelColl[e],s=t?l.length-1:l.length,n=this.rule,r=0;r<s;r++)n=this.findGroupByIdx(l[r],n,0===r);return n},t.prototype.deleteGroup=function(e){var t=this,l={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"deleteGroup"};this.isImportRules?this.deleteGroupSuccessCallBack(l,e):this.trigger("beforeChange",l,(function(l){t.deleteGroupSuccessCallBack(l,e)}))},t.prototype.deleteGroupSuccessCallBack=function(e,t){if(!e.cancel){this.actionButton&&sf.base.getComponent(this.actionButton,"tooltip").destroy();var l=t,s=this.getParentGroup(l,!0),n=0,r=void 0,a=void 0,i=this.getValidRules(this.rule),o=l.nextElementSibling,u=l.previousElementSibling,d=l.querySelectorAll(".e-group-container"),p=l.querySelectorAll(".e-tooltip");for(a=p.length,r=0;r<a;r++)sf.base.getComponent(p[r],"tooltip").destroy();for(r=0,a=d.length;r<a;r++)delete this.levelColl[d[r].id];for(;null!==l.previousElementSibling;)l=l.previousElementSibling,n++;o&&o.className.indexOf("e-separate-rule")>-1&&(sf.base.removeClass([o],"e-separate-rule"),sf.base.addClass([o],"e-joined-rule"),u&&u.className.indexOf("e-rule-container")>-1&&sf.base.addClass([u],"e-prev-joined-rule")),s.rules.splice(n,1),delete this.levelColl[e.groupID];var c=l.parentElement.parentElement.parentElement;sf.base.detach(t),this.refreshLevelColl(),this.disableRuleCondition(c,s),this.isImportRules||this.trigger("change",e),this.filterRules(i,this.getValidRules(this.rule),"deleteGroup")}},t.prototype.deleteRule=function(e){var t=this,l={groupID:sf.base.closest(e,".e-group-container").id.replace(this.element.id+"_",""),ruleID:sf.base.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),cancel:!1,type:"deleteRule"};this.isImportRules?this.deleteRuleSuccessCallBack(l,e):this.trigger("beforeChange",l,(function(l){t.deleteRuleSuccessCallBack(l,e)}))},t.prototype.deleteRuleSuccessCallBack=function(e,t){if(!e.cancel){this.actionButton&&this.actionButton.className.indexOf("e-tooltip")>-1&&sf.base.getComponent(this.actionButton,"tooltip").destroy();var l=sf.base.closest(t,".e-group-container"),s=this.getParentGroup(l),n=sf.base.closest(t,".e-rule-container"),r=this.getValidRules(this.rule),a=n,i=n.nextElementSibling,o=n.previousElementSibling,u=0,d=n.querySelectorAll(".e-tooltip"),p=void 0,c=d.length;for(p=0;p<c;p++)sf.base.getComponent(d[p],"tooltip").destroy();for(;null!==n.previousElementSibling;)n=n.previousElementSibling,u++;s.rules.splice(u,1),(!o||o.className.indexOf("e-rule-container")<0)&&i&&sf.base.removeClass([i],"e-joined-rule"),(!i||i.className.indexOf("e-rule-container")<0)&&o&&sf.base.removeClass([o],"e-prev-joined-rule"),sf.base.detach(a),s.rules[0]&&s.rules[0].rules||this.disableRuleCondition(l,s),this.isImportRules||this.trigger("change",e),this.filterRules(r,this.getValidRules(this.rule),"deleteRule")}},t.prototype.setGroupRules=function(e){this.reset(),this.groupIdCounter=1,this.ruleIdCounter=0,this.isImportRules=!0,this.rule=e,e=this.getRuleCollection(this.rule,!1),this.importRules(this.rule,this.element.querySelector(".e-group-container"),!0),this.isImportRules=!1},t.prototype.keyBoardHandler=function(e){(this.readonly&&38===e.keyCode||40===e.keyCode||13===e.keyCode)&&e.preventDefault()},t.prototype.disableRuleCondition=function(e,t){if(!this.readonly){var l=e.querySelector(".e-rule-list").childElementCount,s=e.querySelector(".e-btngroup-and"),n=e.querySelector(".e-btngroup-or");l>1?(s.disabled=!1,n.disabled=!1,(n.nextElementSibling.classList.contains("e-btn-disable")||s.nextElementSibling.classList.contains("e-btn-disable"))&&(n.nextElementSibling.classList.remove("e-btn-disable"),s.nextElementSibling.classList.remove("e-btn-disable")),t&&"or"===t.condition?n.checked=!0:s.checked=!0):(s.checked=!1,s.disabled=!0,n.checked=!1,n.disabled=!0,t&&(n.nextElementSibling.classList.add("e-btn-disable"),s.nextElementSibling.classList.add("e-btn-disable")))}},t.prototype.getValidRules=function(e){e||(e=this.getRules());var t=e.condition,l=e.not,s=sf.base.extend([],e.rules,[],!0);return this.getRuleCollection({condition:t,rules:s,not:l},!0)},t.prototype.getRuleCollection=function(e,t){var l;if(e.rules&&e.rules.length&&(Object.keys(e.rules[0]).length>6||t))for(var s=e.rules.length,n=0;n<s;n++)l=e.rules[n],l=this.getRuleCollection(l,t),e.rules[n]=l,Object.keys(l).length<1&&t&&(e.rules.splice(n,1),n--,s--);if(e.condition||""===e.condition)e=this.enableNotCondition?{condition:e.condition,rules:e.rules,not:e.not}:{condition:e.condition,rules:e.rules};else if(e.operator&&(e.operator.toString().indexOf("null")>-1||e.operator.toString().indexOf("empty")>-1)&&(e.value=null),""!==e.field&&""!==e.operator&&""!==e.value){var r=e.custom;e={label:e.label,field:e.field,operator:e.operator,type:e.type,value:e.value},r&&(e.custom=r)}else e={};return e},t.prototype.setRules=function(e){var t=sf.base.extend({},e,{},!0);this.setGroupRules(t)},t.prototype.getRules=function(){return this.enableNotCondition?{condition:this.rule.condition,rules:this.rule.rules,not:this.rule.not}:{condition:this.rule.condition,rules:this.rule.rules}},t.prototype.getRule=function(e){var t,l,s=0;e instanceof HTMLElement?t=sf.base.closest(e,".e-rule-container"):(l=this.element.id+"_"+e,t=document.getElementById(l));for(var n=sf.base.closest(t,".e-group-container"),r=this.getParentGroup(n);null!==t.previousElementSibling;)t=t.previousElementSibling,s++;return r.rules[s]},t.prototype.getGroup=function(e){e instanceof Element&&e.className.indexOf("e-group-container")<1&&(e=sf.base.closest(e,".e-group-container"));var t=e instanceof Element?e.id:this.element.id+"_"+e,l=this.getParentGroup(t);return this.enableNotCondition?{rules:l.rules,condition:l.condition,not:l.not}:{rules:l.rules,condition:l.condition}},t.prototype.deleteGroups=function(e){var t,l,s=e.length;for(t=0;t<s;t++)l=this.element.id+"_"+e[t],this.deleteGroup(document.getElementById(l))},t.prototype.getFilteredRecords=function(){var e,t=this.getPredicate(this.getValidRules(this.rule));if(e=sf.base.isNullOrUndefined(t)?new sf.data.Query:(new sf.data.Query).where(t),sf.base.isBlazor()){var l=new sf.data.UrlAdaptor,s=new sf.data.DataManager({url:"",adaptor:new sf.data.UrlAdaptor}),n=l.processQuery(s,e),r=JSON.parse(n.data);return Object.keys(r).length?r:null}return this.dataManager.executeQuery(e)},t.prototype.deleteRules=function(e){var t,l,s=e.length;for(t=0;t<s;t++)l=this.element.id+"_"+e[t],this.deleteRule(document.getElementById(l))},t.prototype.getDataManagerQuery=function(e){for(var t=this.getPredicate(e),l=[],s=0,n=Object.keys(this.columns);s<n.length;s++)l.push(this.columns[s].field);return e.rules.length?(new sf.data.Query).select(l).where(t):(new sf.data.Query).select(l)},t.prototype.getPredicate=function(e){var t,l,s,n,r=e.rules,a=!1,i=["notcontains","notstartswith","notendswith"];if(!r)return t;for(var o=0,u=r.length;o<u;o++){if(a=!1,Object.keys(r[o]).indexOf("rules")>-1&&r[o].rules)(l=this.getPredicate(r[o]))&&(t=t?"and"===e.condition?t.and(l):t.or(l):l);else if(r[o].operator.length){var d=r[o].operator.toLowerCase(),p=!1,c=["equal","notequal","greaterthan","lessthanorequal"];if("string"===r[o].type&&(a=!this.matchCase),"date"===r[o].type&&c.indexOf(d)>-1&&(a=!0),n=this.getColumn(r[o].field),"date"!==r[o].type||r[o].value instanceof Array)d.indexOf("null")>-1||d.indexOf("empty")>-1?r[o].value=null:s=r[o].value;else{var h=this.getFormat(n.format);s=this.getDate(r[o].value,h),c.indexOf(d)>-1&&(p=!0)}if(0===o){if(p||(d.indexOf("in")>-1||d.indexOf("between")>-1||d.indexOf("null")>-1||d.indexOf("empty")>-1)&&d.indexOf("contains")<0)t=p?this.datePredicate(r[o],s):this.arrayPredicate(r[o]);else""!==(f=s)&&i.indexOf(d)<0&&(t=new sf.data.Predicate(r[o].field,r[o].operator,s,a))}else{if(i.indexOf(d)>-1)continue;if(p||(d.indexOf("in")>-1||d.indexOf("between")>-1||d.indexOf("null")>-1||d.indexOf("empty")>-1)&&d.indexOf("contains")<0)t=p?this.datePredicate(r[o],s,t,e.condition):this.arrayPredicate(r[o],t,e.condition);else if("and"===e.condition){var f=s;t&&""!==f?t=t.and(r[o].field,r[o].operator,s,a):""!==f&&(t=new sf.data.Predicate(r[o].field,r[o].operator,s,a))}else{f=s;t&&""!==f?t=t.or(r[o].field,r[o].operator,s,a):""!==f&&(t=new sf.data.Predicate(r[o].field,r[o].operator,s,a))}}}}return t},t.prototype.getLocale=function(){var e=sf.base.isBlazor()?".dates.days.short":".dates.calendars.gregorian.days.format.short",t=this.locale,l=sf.base.isBlazor()?"":"main.";return sf.base.getValue(l+""+this.locale+e,sf.base.cldrData)||(t="en"),t},t.prototype.getColumn=function(e){e=e.split(".")[0];for(var t,l=this.columns,s=0,n=l.length;s<n;s++)l[s].field===e&&(t=l[s]);return t},t.prototype.getOperators=function(e){return this.getColumn(e).operators},t.prototype.datePredicate=function(e,t,l,s){var n,r=new Date(t.getTime()),a=new Date(r.setDate(r.getDate()+1));switch(e.operator){case"equal":n=(n=new sf.data.Predicate(e.field,"greaterthanorequal",t)).and(e.field,"lessthan",a);break;case"notequal":n=(n=new sf.data.Predicate(e.field,"lessthan",t)).or(e.field,"greaterthanorequal",a);break;case"greaterthan":n=new sf.data.Predicate(e.field,"greaterthanorequal",a);break;case"lessthanorequal":n=new sf.data.Predicate(e.field,"lessthan",a)}return n&&(l?"and"===s?l=l.and(n):"or"===s&&(l=l.or(n)):l=n),l},t.prototype.arrayPredicate=function(e,t,l){var s,n,r=e.value,a=e.operator.toString(),i=e.value,o=this.getColumn(e.field);if(s=this.getFormat(o.format),a.indexOf("null")>-1||a.indexOf("empty")>-1)switch(a){case"isnull":n=new sf.data.Predicate(e.field,"isnull",i);break;case"isnotnull":n=new sf.data.Predicate(e.field,"notnull",i);break;case"isempty":n=new sf.data.Predicate(e.field,"equal","");break;case"isnotempty":n=new sf.data.Predicate(e.field,"notequal","")}if(!(a.indexOf("null")>-1||a.indexOf("empty")>-1))for(var u=0,d=r.length;u<d;u++)if(""!==r[u])if(0===u)switch(a){case"between":n="date"===o.type?new sf.data.Predicate(e.field,"greaterthanorequal",this.getDate(r[u],s)):new sf.data.Predicate(e.field,"greaterthanorequal",r[u]);break;case"notbetween":n="date"===o.type?new sf.data.Predicate(e.field,"lessthan",this.getDate(r[u],s)):new sf.data.Predicate(e.field,"lessthan",r[u]);break;case"in":n=new sf.data.Predicate(e.field,"equal",r[u]);break;case"notin":n=new sf.data.Predicate(e.field,"notequal",r[u])}else switch(e.operator){case"between":if("date"===o.type){var p=this.getDate(r[u],s),c=new Date(p.setDate(p.getDate()+1));n=n.and(e.field,"lessthan",c)}else n=n.and(e.field,"lessthanorequal",r[u]);break;case"notbetween":n="date"===o.type?n.or(e.field,"greaterthan",this.getDate(r[u],s)):n.or(e.field,"greaterthan",r[u]);break;case"in":n=n.or(e.field,"equal",r[u]);break;case"notin":n=n.and(e.field,"notequal",r[u])}return n&&(t?"and"===l?t=t.and(n):"or"===l&&(t=t.or(n)):t=n),t},t.prototype.getDate=function(e,t){var l=this.intl.parseDate(e,t);return e.indexOf(":")>-1&&(e.indexOf("/")<0||e.indexOf(",")<0)&&l.setDate((new Date).getDate()),l},t.prototype.importRules=function(e,t,l){if(l){if(e.rules.length>1){var s=t.querySelector(".e-btngroup-or"),n=t.querySelector(".e-btngroup-and");s.disabled=!1,n.disabled=!1,"or"===e.condition?s.checked=!0:n.checked=!0}else this.disableRuleCondition(t);if(this.enableNotCondition){var r=t.querySelector(".e-qb-toggle");e.not?sf.base.addClass([r],"e-active-toggle"):sf.base.removeClass([r],"e-active-toggle")}}else t=this.renderGroup(e.condition,t);var a=e.rules;if(!sf.base.isNullOrUndefined(a))for(var i=0,o=a.length;i<o;i++){var u=Object.keys(a[i]);!sf.base.isNullOrUndefined(a[i].rules)&&u.indexOf("rules")>-1?(t=this.renderGroup(a[i].condition,t),t=this.importRules(a[i],t,!0)):this.renderRule(a[i],t)}return(t=sf.base.closest(t,".e-rule-list"))&&(t=sf.base.closest(t,".e-group-container")),t},t.prototype.renderGroup=function(e,t){this.addGroupElement(!0,t,e);var l=t.querySelectorAll(".e-group-container");return l[l.length-1]},t.prototype.renderRule=function(e,t){t.className.indexOf("e-group-container")>-1?this.addRuleElement(t,e):this.addRuleElement(t.querySelector(".e-group-container"),e)},t.prototype.enableReadonly=function(){for(var e=this.element.querySelectorAll(".e-dropdownlist, .e-numerictextbox, .e-textbox, .e-datepicker, .e-multiselect .e-lib, .e-radio"),t=0;t<e.length;t++){if(e[t].classList.contains("e-dropdownlist"))sf.base.getInstance(e[t],sf.dropdowns.DropDownList).readonly=this.isReadonly;else if(e[t].classList.contains("e-numerictextbox")){sf.base.getInstance(e[t],sf.inputs.NumericTextBox).readonly=this.isReadonly}else if(e[t].classList.contains("e-textbox")){sf.base.getInstance(e[t],sf.inputs.TextBox).readonly=this.isReadonly}else if(e[t].classList.contains("e-datepicker")){sf.base.getInstance(e[t],sf.calendars.DatePicker).readonly=this.isReadonly}else if(e[t].classList.contains("e-multiselect")){sf.base.getInstance(e[t],sf.dropdowns.MultiSelect).readonly=this.isReadonly}else if(e[t].classList.contains("e-radio")){sf.base.getInstance(e[t],sf.buttons.RadioButton).checked||(this.isReadonly?e[t].parentElement.style.display="none":e[t].parentElement.style.display="inherit")}}var l=this.element.querySelectorAll(".e-deletegroup"),s=this.element.querySelectorAll(".e-addrulegroup"),n=this.element.querySelectorAll(".e-removerule");!this.isReadonly&&this.ruleElem.classList.contains("e-readonly")&&this.ruleElem.classList.remove("e-readonly");var r=[l,s,n];for(t=0;t<r.length;t++)r[t].forEach((function(e){e.classList.contains("e-readonly")?e.classList.remove("e-readonly"):e.classList.add("e-readonly")}));this.enableBtnGroup()},t.prototype.enableBtnGroup=function(){var e=this,t=this.element.querySelectorAll(".e-btngroup-and-lbl, .e-btngroup-or-lbl, .e-qb-toggle"),l=!1;t.forEach((function(t){!t.classList.contains("e-qb-toggle")||t.classList.contains("e-active-toggle")||t.classList.contains("e-readonly")?t.classList.contains("e-qb-toggle")&&t.classList.contains("e-not-readonly")?t.classList.remove("e-not-readonly"):t.classList.contains("e-qb-toggle")&&t.classList.contains("e-readonly")?t.classList.remove("e-readonly"):t.classList.contains("e-active-toggle")?(t.classList.add("e-not-readonly"),l=!0):t.previousElementSibling.checked||t.classList.contains("e-readonly")?(t.classList.remove("e-readonly"),l?"AND"===t.textContent?t.classList.add("e-readonly-and"):t.classList.add("e-readonly-or"):("AND"===t.textContent&&e.isReadonly?(t.classList.remove("e-not"),t.classList.add("e-readonly-and")):(e.enableNotCondition&&t.classList.add("e-not"),t.classList.remove("e-readonly-and")),"OR"===t.textContent&&e.isReadonly?t.classList.add("e-readonly-or-not"):t.classList.remove("e-readonly-or-not"))):t.classList.contains("e-btn-disable")||t.classList.add("e-readonly"):(t.classList.add("e-readonly"),l=!1)}))},t.prototype.getSqlString=function(e,t,l){var s=!1;l||""===l?l+="(":(l="",s=!0);var n=e.condition;e.not&&(l+=s?"NOT (":" NOT (");for(var r=0,a=e.rules.length;r<a;r++){if(e.rules[r].rules)l=this.getSqlString(e.rules[r],t,l);else{var i=e.rules[r],o="";if(i.value instanceof Array)if(i.operator.toString().indexOf("between")>-1)"date"===i.type?o+='"'+i.value[0]+'" AND "'+i.value[1]+'"':o+=i.value[0]+" AND "+i.value[1];else if("string"==typeof i.value[0]){o+='("'+i.value[0]+'"';for(var u=1,d=i.value.length;u<d;u++)o+=',"'+i.value[u]+'"';o+=")"}else o+="("+i.value+")";else i.operator.toString().indexOf("startswith")>-1?o+='("'+i.value+'%")':i.operator.toString().indexOf("endswith")>-1?o+='("%'+i.value+'")':i.operator.toString().indexOf("contains")>-1?o+='("%'+i.value+'%")':"number"===i.type||"boolean"==typeof i.value?o+=i.value:o+='"'+i.value+'"';i.operator.toString().indexOf("null")>-1||i.operator.toString().indexOf("empty")>-1?(t&&(i.field="`"+i.field+"`"),l+=i.field+" "+this.operators[i.operator]):(t&&(i.field="`"+i.field+"`"),l+=i.field+" "+this.operators[i.operator]+" "+o)}r!==a-1&&(l+=" "+n.toUpperCase()+" ")}return s||(l+=")"),e.not&&(l+=")"),l},t.prototype.setRulesFromSql=function(e){e=e.replace(/`/g,"");var t=this.getRulesFromSql(e);this.setRules({condition:t.condition,not:t.not,rules:t.rules})},t.prototype.getRulesFromSql=function(e){this.parser=[],this.sqlParser(e),this.rule={condition:"and",not:!1,rules:[]};var t=this.processParser(this.parser,this.rule,[0]);return this.enableNotCondition?{condition:t.condition,not:t.not,rules:t.rules}:{condition:t.condition,rules:t.rules}},t.prototype.getSqlFromRules=function(e,t){return e||(e=this.getValidRules()),e=this.getRuleCollection(e,!1),this.getSqlString(this.getValidRules(e),t).replace(/"/g,"'")},t.prototype.sqlParser=function(e){var t,l=0;do{t=e.slice(l),l+=this.parseSqlStrings(t)}while(""!==t);return this.parser},t.prototype.parseSqlStrings=function(e){for(var t,l,s=["=","!=","<=",">=","<",">"],n=["AND","OR","NOT"],r=["IN","NOT IN","LIKE","NOT LIKE","BETWEEN","NOT BETWEEN","IS NULL","IS NOT NULL","IS EMPTY","IS NOT EMPTY"],a=0,i=s.length;a<i;a++)if(t=/^\w+$/.test(s[a])?"\\b":"",new RegExp("^("+s[a]+")"+t,"ig").exec(e))return this.parser.push(["Operators",s[a].toLowerCase()]),s[a].length;var o=this.parser[this.parser.length-1];if(!o||o&&"Literal"!==o[0])for(a=0,i=n.length;a<i;a++)if(t=/^\w+$/.test(n[a])?"\\b":"",new RegExp("^("+n[a]+")"+t,"ig").exec(e))return this.parser.push(["Conditions",n[a].toLowerCase()]),n[a].length;for(a=0,i=r.length;a<i;a++)if(t=/^\w+$/.test(r[a])?"\\b":"",new RegExp("^("+r[a]+")"+t,"ig").exec(e))return this.parser.push(["SubOperators",r[a].toLowerCase()]),r[a].length;return/^\(/.exec(e)?(this.parser.push(["Left","("]),1):/^\)/.exec(e)?(this.parser.push(["Right",")"]),1):/^`?([a-z_][a-z0-9_]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)?(l=/^`?([a-z_][a-z0-9_]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)[1],this.parser.push(["Literal",l]),l.length):/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)?(l=/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)[0],this.parser.push(["String",l]),l.length):/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)?(l=/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)[0],this.parser.push(["DoubleString",l]),l.length):/^[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):/^-?[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^-?[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):1},t.prototype.getOperator=function(e,t){return 0===e.indexOf("%")&&"%"===e[e.length-1]?"not like"===t?"notcontains":"contains":0!==e.indexOf("%")&&e.indexOf("%")===e.length-1?"not like"===t?"notstartswith":"startswith":0===e.indexOf("%")&&e.indexOf("%")!==e.length-1?"not like"===t?"notendswith":"endswith":{"=":"equal","!=":"notequal","<":"lessthan",">":"greaterthan","<=":"lessthanorequal",">=":"greaterthanorequal",in:"in","not in":"notin",between:"between","not between":"notbetween","is empty":"isempty","is null":"isnull","is not null":"isnotnull","is not empty":"isnotempty"}[t]},t.prototype.getTypeFromColumn=function(e){for(var t=this.columns,l=0;l<t.length;l++)if(t[l].field===e.field){e.type=t[l].type;break}return e.type},t.prototype.processParser=function(e,t,l){for(var s,n,r,a,i,o,u,d,p,c,h=[],f=[],m=0,g=e.length;m<g;m++)if("Literal"===e[m][0]){if(r={label:e[m][1],field:e[m][1]},"SubOperators"===e[m+1][0]){for(e[m+1][1].indexOf("null")>-1||e[m+1][1].indexOf("empty")>-1?(r.operator=this.getOperator(" ",e[m+1][1]),r.value=null,r.type=this.getTypeFromColumn(r)):r.operator=this.getOperator(e[m+3][1].replace(/'/g,""),e[m+1][1]),c=e[m+1][1],s=++m+1,n=g,s=m+1;s<n;s++){if("Right"===e[s][0]){m=s;break}if(c.indexOf("null")>-1||c.indexOf("empty")>-1)break;if(c.indexOf("like")>-1&&"String"===e[s][0])r.value=e[s][1].replace(/'/g,"").replace(/%/g,""),r.type="string";else if(c.indexOf("between")>-1){if("Literal"===e[s][0]||"Left"===e[s][0])break;"Number"===e[s][0]?h.push(Number(e[s][1])):"String"===e[s][0]&&f.push(e[s][1].replace(/'/g,""))}else"Number"===e[s][0]?h.push(Number(e[s][1])):"String"===e[s][0]&&f.push(e[s][1].replace(/'/g,""));r.type=this.getTypeFromColumn(r)}c.indexOf("like")<0&&("Number"===e[s-1][0]?(r.value=h,r.type="number"):"String"===e[s-1][0]?(r.value=f,r.type="string"):c.indexOf("between")>-1&&"Conditions"===e[s-1][0]&&(r.value=h,r.type="number"),h=[],f=[],r.type=this.getTypeFromColumn(r))}else"Operators"===e[m+1][0]&&(r.operator=this.getOperator(e[m+2][1],e[m+1][1]),"Number"===e[m+2][0]?(r.type="number",r.value=Number(e[m+2][1])):(r.type="string",r.value=e[m+2][1].replace(/'/g,"")),r.type=this.getTypeFromColumn(r));t.rules.push(r)}else{if("Left"===e[m][0]){if("Left"!==e[0][0]&&"not"===e[m-1][1])continue;for(this.parser=e.splice(m+1,g-(m+1)),a=this.enableNotCondition?{condition:"and",rules:[],not:!1}:{condition:"and",rules:[]},p=0,o=t.rules.length,i=0;i<o;i++)t.rules[i].rules&&p++;return l.push(p),t.rules.push(a),a=this.processParser(this.parser,a,l),t}if("Conditions"===e[m][0])"not"===e[m][1]?t.not=!0:t.condition=e[m][1];else if("Right"===e[m][0]){for(this.parser=e.splice(m+1,g-(m+1)),l.pop(),t=this.rule,d=l.length,u=0;u<d;u++)t=this.findGroupByIdx(l[u],t,0===u);return this.processParser(this.parser,t,l)}}return t},t.prototype.isBlazor=function(){return-1!==Object.keys(window).indexOf("ejsInterop")},n([sf.base.Event()],t.prototype,"created",void 0),n([sf.base.Event()],t.prototype,"actionBegin",void 0),n([sf.base.Event()],t.prototype,"beforeChange",void 0),n([sf.base.Event()],t.prototype,"change",void 0),n([sf.base.Event()],t.prototype,"ruleChange",void 0),n([sf.base.Property({ruleDelete:!0,groupInsert:!0,groupDelete:!0})],t.prototype,"showButtons",void 0),n([sf.base.Property(!1)],t.prototype,"summaryView",void 0),n([sf.base.Property(!1)],t.prototype,"allowValidation",void 0),n([sf.base.Property([])],t.prototype,"columns",void 0),n([sf.base.Property("")],t.prototype,"cssClass",void 0),n([sf.base.Property([])],t.prototype,"dataSource",void 0),n([sf.base.Property("Horizontal")],t.prototype,"displayMode",void 0),n([sf.base.Property(!1)],t.prototype,"enablePersistence",void 0),n([sf.base.Property("Default")],t.prototype,"sortDirection",void 0),n([sf.base.Property(5)],t.prototype,"maxGroupCount",void 0),n([sf.base.Property("auto")],t.prototype,"height",void 0),n([sf.base.Property("auto")],t.prototype,"width",void 0),n([sf.base.Property(!1)],t.prototype,"matchCase",void 0),n([sf.base.Property(0)],t.prototype,"immediateModeDelay",void 0),n([sf.base.Property(!1)],t.prototype,"enableNotCondition",void 0),n([sf.base.Property(!1)],t.prototype,"readonly",void 0),n([sf.base.Complex({condition:"and",rules:[]},o)],t.prototype,"rule",void 0),t=n([sf.base.NotifyPropertyChanges],t)}(sf.base.Component);return e.Columns=i,e.Rule=o,e.ShowButtons=u,e.QueryBuilder=d,e};sfBlazor.modules.querybuilder="querybuilder.QueryBuilder",sfBlazor.loadDependencies(sfBlazor.dependencyJson.querybuilder,(function(){sf.querybuilder=sf.base.extend({},sf.querybuilder,s({}))}))}});