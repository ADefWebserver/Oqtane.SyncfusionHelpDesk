!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="_content/Syncfusion.Blazor/scripts/",r(r.s="./bundles/spreadsheet.js")}({"./bundles/spreadsheet.js":function(e,t,r){"use strict";r.r(t);r("./modules/spreadsheet.js")},"./modules/spreadsheet.js":function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.sf=window.sf||{},window.sf.spreadsheet=function(e){"use strict";function t(e){var t,r=[];return(e=-1===(e=e.indexOf("!")>-1?e.split("!")[1]:e).indexOf(":")?e+":"+e:e).split(":").forEach((function(e){t=n(e),r.push(t[0]),r.push(t[1])})),r}function n(e){return[parseInt(e.match(/\d+/)[0],10)-1,i(e.match(/[A-Z]+/i)[0].toUpperCase())]}function i(e){for(var t=0,r=(e=e.split("").reverse().join("")).length-1;r>=0;r--)t+=(e[r].charCodeAt(0)-64)*Math.pow(26,r);return t-1}function a(e,t){return o(t+1)+(e+1)}function s(e){return a(e[0],e[1])+":"+(sf.base.isNullOrUndefined(e[2])?a(e[0],e[1]):a(e[2],e[3]))}function o(e){return e/26>1?o(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function l(e){return t(h(e))}function h(e){return e.split("!")[1]||e}function d(e){return e.name+"!"+e.selectedRange}function p(e,t){return{sheetIndex:t.indexOf("!")>-1?xt(e,It(t)):e.activeSheetIndex,indices:l(t)}}function c(e){var t=e.slice();return e[0]>e[2]&&u(t,0,2),e[1]>e[3]&&u(t,1,3),t}function u(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function f(e){return e[0]===e[2]&&e[1]===e[3]}function g(e,t,r,n,i){return new m(e,t,r,n,i)}var m=function(){function e(e,t,r,n,i){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=r,this.workerData=n,i&&(this.preventCallback=!0),this.initWorker()}return e.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},e.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)},e.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},e.prototype.onError=function(e){throw this.terminate(),e.message||e},e.prototype.getFnCode=function(){var e,t,n="",i="",a=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?i="function "+this.workerTask.toString():(i=this.workerTask.toString(),a=!0),n+="self.workerTask = "+i+"; \n";else if("object"===r(this.workerTask))for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?i="function "+this.workerTask[t[e]].toString():(i=this.workerTask[t[e]].toString(),a=!0),n+=(0===e?"self.workerTask":t[e])+"= "+i+"; \n";return n+="self.onmessage = "+(a?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},e.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},e.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},e}();function v(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var r=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(y(r,n));return r/i+"/"+n/i}function y(e,t){return e=Number(e),(t=Number(t))?y(t,e%t):e}function C(e){return(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1),new Date(864e5*(e-1)+new Date("01/01/1900").getTime())}function b(e,t){var r=new Date("01/01/1900"),n=S(e)?e:new Date(e),i=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),a=(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())-i)/864e5;return t?a:parseInt(a.toString(),10)+2}function S(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function x(e){return e-parseFloat(e)>=0}function w(e,t,r){var n=sf.base.getDefaultDateObject(),i=n.dateTimeFormats.availableFormats,a={dateObj:null,isCustom:!1,type:""};if("string"==typeof e&&(e=e.toUpperCase()),r&&(a.dateObj=t.parseDate(e,{format:r}),a.dateObj&&(a.type=e.toString().indexOf(":")>-1?"time":"datetime",a.isCustom=!0)),sf.base.isNullOrUndefined(a.dateObj)){for(var s=0,o=Object.keys(n.dateFormats);s<o.length;s++){var l=o[s];if(a.dateObj=t.parseDate(e,{format:n.dateFormats[l],skeleton:l}),a.dateObj){a.type="date",a.isCustom=!1;break}}if(sf.base.isNullOrUndefined(a.dateObj))for(var h=0,d=Object.keys(i);h<d.length;h++){l=d[h];if(a.dateObj=t.parseDate(e,{format:i[l],skeleton:l}),a.dateObj){if(a.type=e.toString().indexOf(":")>-1?"time":"datetime","time"===a.type){var p=a.dateObj.toLocaleTimeString();a.dateObj=new Date("01/01/1900 "+p)}a.isCustom=!0;break}}if(sf.base.isNullOrUndefined(a.dateObj))for(var c=0,u=Object.keys(n.timeFormats);c<u.length;c++){l=u[c];if(a.dateObj=t.parseDate(e,{format:n.timeFormats[l],skeleton:l}),a.dateObj){p=a.dateObj.toLocaleTimeString();a.dateObj=new Date("01/01/1900 "+p),a.type="time",a.isCustom=!1;break}}}return"#DIV/0!"===e||a.dateObj||"Invalid Date"===new Date(e).toString()||(a.dateObj=new Date(e)),a}function I(e){return e&&/^\d*\.?\d*$/.test(e)?parseFloat(e):e}var E="setCellFormat",R="applyCellFormat",k="workbookFormulaOperation",A="gotoHandler",F="ShowDialog",T="setMerge",O=function(){function e(e){this.parent=e,this.localeObj=sf.base.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}return e.prototype.numberFormatting=function(e){var r=this.parent.activeSheetIndex;e.range&&e.range.indexOf("!")>-1&&(r=xt(this.parent,e.range.split("!")[0]));for(var n,i=this.parent.sheets[r],a=t(e.range?e.range.indexOf("!")>-1?e.range.split("!")[1]:e.range:i.selectedRange),s=a[0];s<=a[2];s++)for(var o=a[1];o<=a[3];o++)ht(s,o,i,{format:e.format},!0),n=lt(s,o,i,!0),this.getFormattedCell({type:D(n.format),value:n.value,format:n.format,rowIndex:s,colIndex:o,sheetIndex:r,cell:n})},e.prototype.getFormattedCell=function(e){var r=sf.base.isNullOrUndefined(e.value)?"":e.value,n=this.parent.sheets[sf.base.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex],i=t(n.activeCell),a=Number(e.sheetIndex)?Number(e.sheetIndex):this.parent.activeSheetIndex,s=e.cell?e.cell:lt(i[0],i[1],n),o=!1,l=sf.base.getNumberDependable(this.parent.locale,"USD");if(""===e.format||"General"===e.format){s=s||{};var h={value:e.value,rowIndex:i[0],colIndex:i[1],sheetIndex:this.parent.activeSheetIndex,updatedVal:e.value,isDate:!1,isTime:!1};this.checkDateFormat(h),h.isDate?(o=!0,s.value=e.value=h.updatedVal,s.format=e.format=N("ShortDate")):h.isTime&&(o=!0,s.value=e.value=h.updatedVal,s.format=e.format=N("Time"))}e.type=e.format?D(e.format):"General";var d=this.processFormats(e,r,o,s);return this.parent.getActiveSheet().id-1===a&&this.parent.notify("refreshCellElem",{isRightAlign:d.rightAlign,result:d.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:l,value:e.value||""}),!e.onLoad&&(e.rowIndex>n.usedRange.rowIndex||e.colIndex>n.usedRange.colIndex)&&this.parent.setUsedRange(e.rowIndex,e.colIndex),e.formattedText=d.fResult||e.value,e.isRightAlign=d.rightAlign,e.curSymbol=l,e.formattedText},e.prototype.processFormats=function(e,t,r,n){var i,a=new sf.base.Internationalization,s=sf.base.getNumberDependable(this.parent.locale,"USD");if(e.format=e.format?e.format:"General",""!==t)switch(e.type){case"General":t=(i=this.autoDetectGeneralFormat({args:e,currencySymbol:s,fResult:t,intl:a,isRightAlign:r,curCode:"USD",cell:n,rowIdx:Number(e.rowIdx),colIdx:Number(e.colIdx)})).fResult,r=i.isRightAlign;break;case"Number":x(t)&&(t=this.applyNumberFormat(e,a),r=!0);break;case"Currency":x(t)&&(t=this.currencyFormat(e,a),r=!0);break;case"Percentage":x(t)&&(t=this.percentageFormat(e,a),r=!0);break;case"Accounting":x(t)&&(t=this.accountingFormat(e,a),r=!0);break;case"ShortDate":r=!!(t=this.shortDateFormat(e,a));break;case"LongDate":r=!!(t=this.longDateFormat(e,a));break;case"Time":r=!!(t=this.timeFormat(e,a));break;case"Fraction":x(t)&&(t=this.fractionFormat(e),r=!0);break;case"Scientific":x(t)&&(t=this.scientificFormat(e),r=!0);break;case"Text":r=!1}return{fResult:t,rightAlign:r}},e.prototype.autoDetectGeneralFormat=function(e){if(x(e.fResult)&&(e.args.format&&""!==e.args.format&&(e.args.format.toString().indexOf("%")>-1?e.fResult=this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?e.fResult=this.currencyFormat(e.args,e.intl):e.fResult=this.applyNumberFormat(e.args,e.intl)),"General"===e.args.format&&e.fResult&&e.fResult.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args)),e.isRightAlign=!0),!sf.base.isNullOrUndefined(e.fResult)){var t=e.fResult.toString();t.indexOf("%")>-1&&""!==t.split("%")[0]&&""===t.split("%")[1].trim()&&"NaN"!==Number(t.split("%")[0].split(this.groupSep).join("")).toString()&&!this.parent.isEdit?(e.args.value=Number(t.split("%")[0].split(this.groupSep).join("")),e.cell.format=e.args.format=N("Percentage"),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),ht(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0):t.indexOf(e.currencySymbol)>-1&&""!==t.split(e.currencySymbol)[1]&&"NaN"!==Number(t.split(e.currencySymbol)[1].split(this.groupSep).join("")).toString()&&!this.parent.isEdit&&(e.args.value=Number(t.split(e.currencySymbol)[1].split(this.groupSep).join("")),e.cell.format=e.args.format=N("Currency"),e.fResult=this.currencyFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),ht(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0)}return{isRightAlign:e.isRightAlign,fResult:e.fResult}},e.prototype.findSuffix=function(e,t){var r=e.length-t.length;return e.substr(0,r<0?0:r)+t},e.prototype.applyNumberFormat=function(e,t){e.format=this.isCustomFormat(e.format.toString());var r=e.format.toString().split(";");return Number(e.value)>=0?e.format=r[0]:e.format=sf.base.isNullOrUndefined(r[1])?r[0]:r[1].split("*").join(" "),t.formatNumber(Number(e.value),{format:e.format})},e.prototype.isCustomFormat=function(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),e=(e=""===e?N("Number"):e).toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")},e.prototype.currencyFormat=function(e,t){e.format=""===e.format?N("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var r=e.format.toString().split(";");return Number(e.value)>=0?e.format=r[0]:e.format=sf.base.isNullOrUndefined(r[1])?r[0]:r[1].split("*").join(" "),t.formatNumber(Number(e.value),{format:e.format,currency:"USD"})},e.prototype.percentageFormat=function(e,t){return e.format=""===e.format?N("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})},e.prototype.accountingFormat=function(e,t){e.format=""===e.format?N("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var r=sf.base.getNumberDependable(this.parent.locale,"USD"),n=e.format.split(";");return Number(e.value)>=0?e.format=n[0]:e.format=n[1].split("*").join(" "),0===Number(e.value)?r+"- ":t.formatNumber(Number(e.value),{format:e.format,currency:"USD"}).split("-").join("")},e.prototype.shortDateFormat=function(e,t){var r,n=C(e.value),i=""===e.format||"General"===e.format?N("ShortDate"):e.format.toString();return i===N("ShortDate")?(i="M/d/yy",r={type:"date",skeleton:"yMd"}):r={type:"date",format:i},t.formatDate(n,r)},e.prototype.longDateFormat=function(e,t){var r=C(e.value),n=""===e.format||"General"===e.format?N("LongDate"):e.format.toString();return n===N("LongDate")&&(n="EEEE, MMMM d, y"),t.formatDate(r,{type:"date",format:n})},e.prototype.timeFormat=function(e,t){if(sf.base.isNullOrUndefined(e.value))return"";sf.base.isNullOrUndefined(e.value.toString().split(this.decimalSep)[1])||(e.value=parseFloat("1"+this.decimalSep+e.value.toString().split(this.decimalSep)[1])||e.value);var r=C(e.value),n=""===e.format||"General"===e.format?N("Time"):e.format.toString();return n===N("Time")&&(n="h:mm:ss a"),t.formatDate(r,{type:"time",skeleton:"medium",format:n})},e.prototype.scientificFormat=function(e){e.format=""===e.format?N("Scientific"):e.format;var t=e.format.split("+")[1],r=this.findDecimalPlaces(e.format,"Scientific"),n=Number(e.value).toExponential(r);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(t,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+ +this.findSuffix(t,n.split("e-")[1])),n},e.prototype.fractionFormat=function(e){e.format=""===e.format?N("Fraction"):e.format;var t,r="";return e.value.toString().indexOf(this.decimalSep)>-1&&x(e.value)?(r=e.value.toString().split(this.decimalSep)[0],t=v(Number(e.value)),0===Number(r)?" "+t:r+" "+t):r},e.prototype.findDecimalPlaces=function(e,t){switch(t){case"Scientific":var r=e.toUpperCase().indexOf("E"),n=e.indexOf(this.decimalSep);if(r>-1)return e.substring(n+1,r).length}return 2},e.prototype.checkDateFormat=function(e){var t,r,n=new sf.base.Internationalization,i=sf.base.isNullOrUndefined(e.value)?"":e.value.toString(),a=lt(e.rowIndex,e.colIndex,kt(this.parent,sf.base.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex));r=this.checkCustomDateFormat(i),i&&(i.indexOf("/")>-1||i.indexOf("-")>0||i.indexOf(":")>-1)&&"Invalid"!==r&&(((i=r)&&i.indexOf("/")>-1||i.indexOf("-")>0||i.indexOf(":")>-1)&&(t=w(i,n,a&&a.format),sf.base.isNullOrUndefined(t.dateObj)||"Invalid Date"===t.dateObj.toString()||(a=a||{},i=b(t.dateObj,i.indexOf(":")>-1).toString(),a.format&&""!==a.format||("time"===t.type?a.format=N("Time"):a.format=N("ShortDate")),e.isDate="date"===t.type||"datetime"===t.type,e.isTime="time"===t.type,e.dateObj=t.dateObj)),e.updatedVal=i)},e.prototype.checkCustomDateFormat=function(e){var t=e.indexOf("/")>-1?e.split("/"):e.indexOf("-")>0?e.split("-"):"",r=["jan","feb","mar","apr","may","jun","jul","aug","sep","sept","oct","nov","dec"];return 2===t.length?r.indexOf(t[0].toLowerCase())>-1&&Number(t[1])<=31?"01-"+t[0]+"-"+t[1]:r.indexOf(t[1].toLowerCase())>-1&&Number(t[0])<=31||Number(t[0])<=31&&Number(t[1])<=12||Number(t[1])<=31&&Number(t[0])<=12?t[0]+"-"+t[1]+"-"+(new Date).getFullYear():Number(t[0])<=12&&Number(t[1])<=9999&&Number(t[1])>=1900?"01-"+t[0]+"-"+t[1]:"Invalid":e},e.prototype.formattedBarText=function(e){var t=D(e.cell?e.cell.format:""),r=new sf.base.Internationalization,n=e.value,i="ShortDate"===t&&e.cell&&e.cell.format?e.cell.format:N("ShortDate"),a=N("Time");switch(t){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:t,value:e.value,format:i},r);break;case"Time":e.value=this.shortDateFormat({type:t,value:e.value,format:i},r)+" "+this.timeFormat({type:t,value:e.value,format:a},r)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=n)},e.prototype.addEventListener=function(){this.parent.on("applyNumber",this.numberFormatting,this),this.parent.on("getFormattedCell",this.getFormattedCell,this),this.parent.on("checkDateFormat",this.checkDateFormat,this),this.parent.on("getFormattedBarText",this.formattedBarText,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applyNumber",this.numberFormatting),this.parent.off("getFormattedCell",this.getFormattedCell),this.parent.off("checkDateFormat",this.checkDateFormat),this.parent.off("getFormattedBarText",this.formattedBarText))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookNumberFormat"},e}();function N(e){var t="General";switch(e.split(" ").join("")){case"Number":t="0.00";break;case"Currency":t="$#,##0.00";break;case"Accounting":t='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":t="mm-dd-yyyy";break;case"LongDate":t="dddd, mmmm dd, yyyy";break;case"Time":t="h:mm:ss AM/PM";break;case"Percentage":t="0.00%";break;case"Fraction":t="# ?/?";break;case"Scientific":t="0.00E+00";break;case"Text":t="@"}return t}function D(e){var t="General";switch(e){case"0.00":case'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-':case'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-':t="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);[Red]($#,##0.00)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":t="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':t="Accounting";break;case"mm-dd-yyyy":case"dd-mm-yyyy":case"dd-mm-yy":case"mm-dd-yy":case"dd/MM/yyyy":case"yyyy-MM-dd":t="ShortDate";break;case"dddd, mmmm dd, yyyy":t="LongDate";break;case"h:mm:ss AM/PM":t="Time";break;case"0.00%":case"0%":t="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":t="Fraction";break;case"0.00E+00":t="Scientific";break;case"@":t="Text"}return t}var L,B=function(){function e(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler,this),this.parent.on("dataSourceChanged",this.dataSourceChangedHandler,this),this.parent.on("dataChanged",this.dataChangedHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler),this.parent.off("dataSourceChanged",this.dataSourceChangedHandler),this.parent.off("dataChanged",this.dataChangedHandler))},e.prototype.updateSheetFromDataSourceHandler=function(e){var r,n,i,a,s,o,l,h,d,p,c=this,u=[],f=[],g=new sf.data.Deferred;if(e.promise=g.promise,e.sheet&&e.sheet.ranges.length)for(var m=function(m){var y=e.indexes[0],C=e.indexes[2],b=e.sheet.ranges[m];h=t(b.startCell)[0],o=b.dataSource instanceof sf.data.DataManager?b.dataSource:b.dataSource?new sf.data.DataManager(b.dataSource):new sf.data.DataManager,s=s||o.dataSource.url,e.sheet.isLocalData=!o.dataSource.url,h<=y?y-=h:h<=C?(C-=h,y=0):y=-1,b.showFieldAsHeader&&0!==y&&(y-=1);var S=!1,x=0;v.initRangeInfo(b);var w=v.getMaxCount(b);if(p=v.getLoadedInfo(y,C,b),y=p.unloadedRange[0],C=p.unloadedRange[1],b.info.insertRowRange&&(b.info.insertRowRange.forEach((function(e){x+=e[1]-e[0]+1})),y-=x,C-=x),y>w?S=!0:C>w&&(C=w),v.requestedInfo.push({deferred:g,indexes:e.indexes,isNotLoaded:p.isNotLoaded}),y>=0&&p.isNotLoaded&&!S){f[m]=y,u[m]=!1;var I=(b.query?b.query:new sf.data.Query).clone();o.executeQuery(I.range(y,C>=w?C:C+1).requiresCount()).then((function(s){if(c.parent&&!c.parent.isDestroyed){if(a=s.result&&s.result.result?s.result.result:s.result,i=t(b.startCell),h=i[0],d=i[1],a.length){if(b.info.count||(w=s.count,b.info.count=s.count),n=Object.keys(a[0]),b.info.fldLen||(b.info.fldLen=n.length,b.info.flds=n),b.info.insertColumnRange){var o=0;b.info.insertColumnRange.forEach((function(e){for(var t=e[0];t<=e[1];t++)t<=d?n.splice(0,0,"emptyCell"+o):n.splice(t-d,0,"emptyCell"+o),o++}))}0===f[m]&&b.showFieldAsHeader&&(l=h+f[m]+x,n.forEach((function(t,n){(r=lt(l,d+n,e.sheet,!0))?r.value||t.includes("emptyCell")||(r.value=t):e.sheet.rows[h+f[m]].cells[d+n]=t.includes("emptyCell")?{}:{value:t}}))),a.forEach((function(t,i){l=h+f[m]+i+(b.showFieldAsHeader?1:0)+x;for(var a=0;a<n.length;a++)(r=lt(l,d+a,e.sheet,!0))?r.value||n[a].includes("emptyCell")||ht(l,d+a,e.sheet,c.getCellDataFromProp(t[n[a]]),!0):e.sheet.rows[l].cells[d+a]=n[a].includes("emptyCell")?{}:c.getCellDataFromProp(t[n[a]]),c.checkDataForFormat({args:e,cell:r,colIndex:d+a,rowIndex:l,i:i,j:a,k:m,range:b,sRanges:f,value:t[n[a]]})}))}else n=[];if(e.sheet.usedRange.rowIndex=Math.max(h+(w||s.count)+(b.showFieldAsHeader?1:0)+x-1,e.sheet.usedRange.rowIndex),e.sheet.usedRange.colIndex=Math.max(d+n.length-1,e.sheet.usedRange.colIndex),x?(p=c.getLoadedInfo(y,C,b),y=p.unloadedRange[0],C=p.unloadedRange[1],y>w&&(p.isNotLoaded=!1),p.isNotLoaded&&(C>w&&(C=w),b.info.loadedRange.push([y,C]))):b.info.loadedRange.push([y,C]),u[m]=!0,-1===u.indexOf(!1)){if(C+h<h+b.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(m);var g={sheet:e.sheet,indexes:[0,0,e.sheet.usedRange.rowIndex,e.sheet.usedRange.colIndex],promise:new Promise((function(e,t){e(void 0)})),rangeSettingCount:e.rangeSettingCount};c.updateSheetFromDataSourceHandler(g),g.promise.then((function(){"workbook"!==c.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||c.parent.notify("created",null))}))}c.checkResolve(e.indexes)}}}))}else 0===m&&-1===u.indexOf(!1)&&v.checkResolve(e.indexes)},v=this,y=e.sheet.ranges.length-1;y>=0;y--)m(y);else g.resolve()},e.prototype.checkResolve=function(e){var t,r,n=0;this.requestedInfo.forEach((function(i,a){((r=JSON.stringify(i.indexes)===JSON.stringify(e))||t)&&(0===a?(i.deferred.resolve(),n++,t=!0):!t||!i.isLoaded&&i.isNotLoaded?r&&t?(i.deferred.resolve(),n++):r?i.isLoaded=!0:t=!1:(i.deferred.resolve(),n++))})),this.requestedInfo.splice(0,n)},e.prototype.getCellDataFromProp=function(e){var t={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?t.formula=e.formula:e.value&&("string"==typeof e.value&&(0===e.value.indexOf("http://")||0===e.value.indexOf("https://")||0===e.value.indexOf("ftp://")||0===e.value.indexOf("www."))?t.hyperlink=e.value:t.value=e.value):$e(e)?t.formula=e:"string"==typeof e&&(0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("ftp://")||0===e.indexOf("www."))?t.hyperlink=e:t.value=e,t},e.prototype.checkDataForFormat=function(e){if(""!==e.value){var t={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1};this.parent.notify("checkDateFormat",t),t.isDate?e.cell?(e.cell.format=N("ShortDate"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=N("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal):t.isTime&&(e.cell?(e.cell.format=N("Time"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=N("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal))}},e.prototype.getLoadedInfo=function(e,t,r){var n=!0;return r.info.loadedRange.forEach((function(r){r[0]<=e&&e<=r[1]?r[0]<=t&&t<=r[1]?n=!1:e=r[1]+1:r[0]<=t&&t<=r[1]&&(t=r[0]-1)})),{isNotLoaded:n,unloadedRange:[e,t]}},e.prototype.getMaxCount=function(e){if(e.query)for(var t=e.query.queries,r=0;r<t.length;r++)if("onTake"===t[r].fn)return Math.min(t[r].e.nos,e.info.count||t[r].e.nos);return e.info.count},e.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},e.prototype.dataSourceChangedHandler=function(e){var t,r=this,i=this.parent.sheets[e.sheetIdx],a=i.ranges[e.rangeIdx];if(a&&(this.checkRangeHasChanges(i,e.rangeIdx)||!a.info)){var s=a.showFieldAsHeader,o=n(a.startCell);a.info&&(a.info.loadedRange.forEach((function(e){for(var r=e[0];r<=e[1]&&r<a.info.count+(s?1:0);r++)if(t=i.rows[r+o[0]])for(var n=o[1];n<o[1]+a.info.fldLen;n++)t.cells&&t.cells[n]&&delete t.cells[n]})),a.info=null);var l=this.parent.viewport,h=[l.topIndex,l.leftIndex,l.bottomIndex,l.rightIndex],d={sheet:i,indexes:h,promise:new Promise((function(e,t){e(void 0)}))};this.updateSheetFromDataSourceHandler(d),d.promise.then((function(){r.parent.notify("updateView",{indexes:h})}))}},e.prototype.checkRangeHasChanges=function(e,t){if(this.parent.isAngular){return e.changedRangeIdx===parseInt(t,10)&&(delete e.changedRangeIdx,!0)}return!0},e.prototype.dataChangedHandler=function(e){var t,r,i,s,o,l,h,d=this,p=[{}],c=this.parent.activeSheetIndex,u=this.parent.sheets[c];u.ranges.forEach((function(f,g){if(f.dataSource){var m=void 0;if(s=n(f.startCell),i=s.concat([s[0]+f.info.count+(f.showFieldAsHeader?0:-1),s[1]+f.info.fldLen-1]),"Row"===e.modelType?e.insertType?(o=(f.showFieldAsHeader||"above"!==e.insertType?i[0]<e.index:i[0]<=e.index)&&i[2]>=e.index,h=[e.index],o||i[2]+1===e.index&&"below"===e.insertType?(m=!0,f.info.count+=e.model.length):i[0]>=e.index&&(f.startCell=a(s[0]+e.model.length,s[1]))):(o=i[0]<=e.startIndex&&i[2]>=e.startIndex,t="delete"):(h=n(e.sheetIdx>-1?e.address:e.address.split("!")[1]),o=(f.showFieldAsHeader?i[0]+1:i[0])<=h[0]&&i[2]>=h[0]&&i[1]<=h[1]&&i[3]>=h[1]),o||m){if("Row"!==e.modelType||e.insertType){t=m?"add":"edit";for(var v=function(e){p[e]={},f.info.flds.forEach((function(t,n){r=lt(h[0],s[1]+n,u),p[e][t]=r&&r.value||null}))},y=0;y<(m?e.model.length:1);y++)v(y)}else e.deletedModel.forEach((function(e,t){p[t]={},f.info.flds.forEach((function(n,i){e.cells?(r=e.cells[s[1]+i],p[t][n]=r&&r.value||null):p[t][n]=null})),f.info.count-=1})),l={count:e.deletedModel.length,index:e.endIndex};d.parent.trigger("dataSourceChanged",{data:p,action:t,rangeIndex:g,sheetIndex:c})}else l&&l.count&&i[0]>l.index&&(f.startCell=a(s[0]-l.count,s[1]))}}))},e.prototype.getModuleName=function(){return"dataBind"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]},e}(),H="editOperation",M="click",P="keyUp",_="keyDown",U="contextmenuBeforeOpen",V="cut",j="paste",q="hideShow",z="autoFitRowsColumns",W="actionComplete",G="actionBegin",Y="renderGotoDlgt",X="renderFindDlg",K="replaceHandler",$=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.open=function(e){var t=this;if(this.parent.allowOpen)if(e.jsonObject)this.fetchSuccess(e.jsonObject);else{var r=new FormData;if(e.file){r.append("file",e.file);var n={file:e.file||null,cancel:!1,requestData:{method:"POST",body:r}};this.parent.trigger("beforeOpen",n),this.parent.notify(G,{eventArgs:n,action:"beforeOpen"}),n.cancel||fetch(this.parent.openUrl,n.requestData).then((function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})})).then((function(e){return t.fetchSuccess(e)})).catch((function(e){return t.fetchFailure(e)}))}else this.parent.isOpen=!1}},e.prototype.fetchFailure=function(e){sf.base.isUndefined(e.status)&&sf.base.isUndefined(e.statusText)&&(e.statusText="Improper response"),this.parent.notify("openFailure",e),this.parent.isOpen=!1},e.prototype.fetchSuccess=function(e){var t=("string"==typeof e?JSON.parse(e):e).Workbook;["UnsupportedFile","InvalidUrl"].indexOf(t)>-1?this.parent.notify("openSuccess",{context:this,data:t}):(this.updateModel(t),this.parent.notify("openSuccess",{context:this,data:t}),this.parent.isOpen=!1)},e.prototype.updateModel=function(e){this.parent.notify(k,{action:"unRegisterSheet"}),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify("sheetsDestroyed",{}),e.activeSheetIndex=e.activeSheetIndex||0,this.setSelectAllRange(e.sheets),this.parent.setProperties({sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[]},!0),Tt(this.parent),this.parent.notify("sheetCreated",null),this.parent.notify(k,{action:"registerSheet",isImport:!0}),this.parent.notify(k,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null)},e.prototype.setSelectAllRange=function(e){e.forEach((function(e){if(e.selectedRange){var r=t(e.selectedRange),n=(sf.base.isUndefined(e.rowCount)?100:e.rowCount)-1,i=(sf.base.isUndefined(e.colCount)?100:e.colCount)-1;65535===r[2]&&(r[2]=n),255===r[3]&&(r[3]=i),65535===r[0]&&(r[0]=n),255===r[1]&&(r[1]=i),e.selectedRange=s(r)}}))},e.prototype.addEventListener=function(){this.parent.on("workbookOpen",this.open.bind(this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("workbookOpen",this.open.bind(this))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookOpen"},e}(),Z=function(){function e(e){this.parent=e}return e.prototype.processSheet=function(e,t){return[t,JSON.parse(e,(function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t}))]},e.prototype.processSave=function(e,t,r){var n,i=new FormData,a=Object.keys(t);for(i.append("JSONData",JSON.stringify(e)),n=0;n<a.length;n++)i.append(a[n],t[a[n]]);for(a=Object.keys(r),n=0;n<a.length;n++)i.append(a[n],r[a[n]]);fetch(t.url,{method:"POST",body:i}).then((function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})})).then((function(e){new Promise((function(t){var r=new FileReader;r.onload=function(){var n=r.result.toString();if(n.indexOf("data:text/plain;base64,")>-1||n.indexOf("data:text/html;base64,")>-1||n.indexOf("data:application/json;base64,")>-1){var i=void 0;if((n=(n=n.replace("data:text/plain;base64,","")).replace("data:text/html;base64,","")).indexOf("data:application/json;base64,")>-1?(n=n.replace("data:application/json;base64,",""),i=atob(n).split(".")):i=atob(n).split(/(\r\n|\n|\r)/gm),i.length){var a=i[0].length>1&&'"'===i[0][0]?i[0].split('"')[1]+".":i[0];postMessage({dialog:a})}}else postMessage(e);t(r.result)},r.readAsDataURL(e)}))})).catch((function(e){postMessage({error:e.message})}))},e}(),J=(L=function(e,t){return(L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}L(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Q=function(e){function t(t){var r=e.call(this,t)||this;return r.isProcessCompleted=!1,r.saveJSON={},r.isFullPost=!1,r.needBlobData=!1,r.customParams=null,r.addEventListener(),r}return J(t,e),t.prototype.getModuleName=function(){return"workbookSave"},t.prototype.destroy=function(){this.removeEventListener(),this.parent=null},t.prototype.addEventListener=function(){this.parent.on("beginSave",this.initiateSave,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("beginSave",this.initiateSave)},t.prototype.initiateSave=function(e){var t=e.saveSettings;this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.updateBasicSettings(),this.processSheets()},t.prototype.updateBasicSettings=function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t},t.prototype.processSheets=function(){for(var e=0,t=this.parent.sheets.length;e<t;)g(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[e]),e]),e++},t.prototype.updateSheet=function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},t.prototype.getSheetLength=function(e){var t=0;return e.forEach((function(e){e&&t++})),t},t.prototype.save=function(e){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify("onSave",t),t.cancel||(this.isFullPost?this.initiateFullPostSave():g(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams],!0)),this.saveJSON={}},t.prototype.updateSaveResult=function(e){var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"===r(e)&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"===r(e)&&e.dialog?this.parent.notify("saveError",{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e,this.saveSettings.fileName),this.parent.trigger("saveComplete",t),this.parent.notify("saveCompleted",t)},t.prototype.ClientFileDownload=function(e,t){var r=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),n=URL.createObjectURL(e);r.href=n,document.body.appendChild(r),r.click(),URL.revokeObjectURL(n),document.body.removeChild(r)},t.prototype.initiateFullPostSave=function(){var e,t=Object.keys(this.saveSettings),r=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),n=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(n.value=JSON.stringify(this.saveJSON),r.appendChild(n),e=0;e<t.length;e++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}})).value=this.saveSettings[t[e]],r.appendChild(n);for(t=Object.keys(this.customParams),e=0;e<t.length;e++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}})).value=this.customParams[t[e]],r.appendChild(n);document.body.appendChild(r),r.submit(),sf.base.detach(r),this.parent.notify("saveCompleted",{})},t.prototype.getStringifyObject=function(e,t){return void 0===t&&(t=[]),JSON.stringify(e,(function(e,n){return t.indexOf(e)>-1?void 0:n&&"object"===r(n)&&n.hasOwnProperty("properties")?n.properties:null!==n?n:void 0}))},t.prototype.getFileNameWithExtension=function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),r=e.lastIndexOf(".");return r>-1&&(e=e.substr(0,r)),e+t},t.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},t}(Z),ee=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"calc-common"},e}();function te(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM-yyyy":case"MMM yyyy":e="yMMM";break;case"MM-dd-yyyy":case"dd-MM-yyyy":case"dd-MM-yy":case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;default:e=""}return e}function re(e){var t=[];return e.includeBasicFormulas&&t.push({member:"basic-formulas",args:[e]}),t}function ne(e,t){for(var r=t,n=e.replace(/\[/g,".").replace(/\]/g,"").split("."),i=0;i<n.length&&!sf.base.isUndefined(r);i++)r=r[n[i]];return r}function ie(e,t,r){var n,i,a=e.replace(/\[/g,".").replace(/\]/g,"").split("."),s=r||{},o=s,l=a.length;for(n=0;n<l;n++)i=a[n],n+1===l?o[i]=void 0===t?{}:t:sf.base.isNullOrUndefined(o[i])&&(o[i]={}),o=o[i];return s}var ae,se,oe=function(){function e(e){this.loadedModules=[],this.parent=e}return e.prototype.inject=function(e,t){var r=e.length;if(0!==r){this.loadedModules.length&&this.clearUnusedModule(e);for(var n=0;n<r;n++)for(var i=e[n],a=0,s=t;a<s.length;a++){var o=s[a],l=i.member;if(o.prototype.getModuleName()===i.member&&!this.isModuleLoaded(l)){var h=this.createInstance(o,i.args),d=this.getMemberName(l);i.isProperty?ie(d,o,this.parent):ie(d,h,this.parent);var p=i;p.member=d,this.loadedModules.push(p)}}}else this.clean()},e.prototype.createInstance=function(e,t){var r=t;return r.unshift(void 0),new(Function.prototype.bind.apply(e,r))},e.prototype.clean=function(){for(var e=0,t=this.loadedModules;e<t.length;e++){var r=t[e];r.isProperty||ne(r.member,this.parent).destroy()}this.loadedModules=[]},e.prototype.clearUnusedModule=function(e){for(var t=this,r=e.map((function(e){return t.getMemberName(e.member)})),n=0,i=this.loadedModules.filter((function(e){return-1===r.indexOf(e.member)}));n<i.length;n++){var a=i[n];a.isProperty||ne(a.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(a),1),this.deleteObject(this.parent,a.member)}},e.prototype.getMemberName=function(e){return e[0].toLowerCase()+e.substring(1)+"Module"},e.prototype.deleteObject=function(e,t){delete e[t]},e.prototype.isModuleLoaded=function(e){for(var t=0,r=this.loadedModules;t<r.length;t++){if(r[t].member===this.getMemberName(e))return!0}return!1},e}();(ae=e.CommonErrors||(e.CommonErrors={}))[ae.na=0]="na",ae[ae.value=1]="value",ae[ae.ref=2]="ref",ae[ae.divzero=3]="divzero",ae[ae.num=4]="num",ae[ae.name=5]="name",ae[ae.null=6]="null",(se=e.FormulasErrorsStrings||(e.FormulasErrorsStrings={}))[se.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",se[se.reservedWord_And=1]="reservedWord_And",se[se.reservedWord_Xor=2]="reservedWord_Xor",se[se.reservedWord_If=3]="reservedWord_If",se[se.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",se[se.reservedWord_Else=5]="reservedWord_Else",se[se.reservedWord_Not=6]="reservedWord_Not",se[se.invalid_char_in_number=7]="invalid_char_in_number",se[se.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",se[se.mismatched_parentheses=8]="mismatched_parentheses",se[se.unknown_formula_name=9]="unknown_formula_name",se[se.requires_a_single_argument=10]="requires_a_single_argument",se[se.requires_3_args=11]="requires_3_args",se[se.invalid_Math_argument=12]="invalid_Math_argument",se[se.requires_2_args=13]="requires_2_args",se[se.bad_index=14]="bad_index",se[se.too_complex=15]="too_complex",se[se.circular_reference=16]="circular_reference",se[se.missing_formula=17]="missing_formula",se[se.improper_formula=18]="improper_formula",se[se.invalid_expression=19]="invalid_expression",se[se.cell_empty=20]="cell_empty",se[se.bad_formula=21]="bad_formula",se[se.empty_expression=22]="empty_expression",se[se.virtual_mode_required=23]="virtual_mode_required",se[se.mismatched_tics=24]="mismatched_tics",se[se.wrong_number_arguments=25]="wrong_number_arguments",se[se.invalid_arguments=26]="invalid_arguments",se[se.iterations_do_not_converge=27]="iterations_do_not_converge",se[se.calculation_overflow=29]="calculation_overflow",se[se.already_registered=28]="already_registered",se[se.missing_sheet=30]="missing_sheet",se[se.cannot_parse=31]="cannot_parse",se[se.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator";var le,he=function(){function t(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Returns the value in required format."}],this.isConcat=!1,this.parent=e,this.init()}return t.prototype.init=function(){for(var e,t=0;t<this.formulas.length;t++)e=sf.base.getValue("Compute"+this.formulas[t].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[t].formulaName.toUpperCase(),e,this.formulas[t].category,this.formulas[t].description)},t.prototype.addFormulaCollection=function(e,t,r,n){this.parent.libraryFormulas={fName:e,handler:t,category:r,description:n}},t.prototype.ComputeSUM=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var n,i,a=0;if(!sf.base.isNullOrUndefined(t))for(var s=t,o=0;o<s.length;o++){var l=s[o].toString();if(l.indexOf(":")>-1&&this.parent.isCellReference(l))for(var h=this.parent.getCellCollection(l.split(this.parent.tic).join("")),d=0;d<h.length;d++){if(n=this.parent.getValueFromArg(h[d]),this.parent.getErrorStrings().indexOf(n)>-1)return n;sf.base.isNullOrUndefined(n[0])||isNaN(this.parent.parseFloat(n))||(a+=this.parent.parseFloat(n))}else{if(s[o].split(this.parent.tic).join("")===this.parent.trueValue&&(s[o]="1"),s[o].split(this.parent.tic).join("")===this.parent.falseValue&&(s[o]="0"),i=this.parent.getValueFromArg(s[o].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(sf.base.isNullOrUndefined(i)||isNaN(this.parent.parseFloat(i)))continue;i.length>0&&(a+=this.parent.parseFloat(i+""))}}return a},t.prototype.ComputeINT=function(){for(var t,r,n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];return(!sf.base.isNullOrUndefined(i)&&1!==i.length||""===i[0])&&(t=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]),""!==i[0]&&1===i.length&&(n=(t=i[0]).indexOf('"'),t=(t=t.indexOf('"')>-1?t.replace('"',""):t).indexOf('"')>-1?t.replace('"',""):t,t="TRUE"===(t=this.parent.getValueFromArg(t)).toUpperCase()?"1":"FALSE"===t?"0":t,r=this.parent.parseFloat(t),r=Math.floor(r)),isNaN(r)&&(t=n>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]),r||t},t.prototype.ComputeTODAY=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(r&&""!==r[0])t=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];else{var i=new Date(Date.now());t=i.getFullYear()+"/"+this.parent.calculateDate((i.getMonth()+1).toString())+"/"+this.parent.calculateDate(i.getDate().toString())}return t},t.prototype.ComputeSUMPRODUCT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n,i=0,a=0,s=null,o=t,l=0;l<o.length;++l){var h=o[l];if(h.startsWith(this.parent.tic)||!this.parent.isCellReference(h)){var d=this.parent.getValueFromArg(h);return n=d.indexOf('"'),this.parent.getErrorStrings().indexOf(d)>-1?d:n>-1?0:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]}var p=h.indexOf(":"),c=this.parent.rowIndex(h.substr(0,p)),u=this.parent.rowIndex(h.substr(p+1));if(!(-1!==c||-1===u)==(-1===c||-1!==u))return this.parent.getErrorStrings()[e.CommonErrors.name];var f=this.parent.colIndex(h.substr(0,p)),g=this.parent.colIndex(h.substr(p+1));if(null===s)for(a=(u-c+1)*(g-f+1),s=[],p=0;p<a;++p)s[p]=1;p=0;for(var m=c;m<=u;++m)for(var v=f;v<=g;++v){var y=""+this.parent.convertAlpha(v)+m,C=this.parent.getValueFromArg(y);if(isNaN(parseFloat(C)))s[p]=0;else{if(isNaN(s[p]))return this.parent.getErrorStrings()[e.CommonErrors.name];s[p]=s[p]*parseFloat(C)}p++}}for(p=0;p<a;++p)i+=s[p];return i},t.prototype.ComputeROUNDUP=function(){for(var t,r,n,i,a,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var l=s.length;if(!sf.base.isNullOrUndefined(s)&&l>2&&(t=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]),1===l&&""!==s[0])a=s[0].indexOf('"'),n="TRUE"===(n=(n=s[0].indexOf('"')>-1?s[0].replace('"',""):s[0]).indexOf('"')>-1?n.replace('"',""):n).toUpperCase()?"1":"FALSE"===n?"0":n,n=this.parent.getValueFromArg(n),(r=this.parent.parseFloat(n))>0?r+=.4999999999:r<0&&(r-=.4999999999),t=(r=this.parent.parseFloat(r.toFixed(0))).toString();else if(2===l&&""!==s[0]&&""!==s[1]){a=s[0].indexOf('"')>-1?s[0].indexOf('"'):s[1].indexOf('"')>-1?s[1].indexOf('"'):-1,n=(n=s[0].indexOf('"')>-1?s[0].replace('"',""):s[0]).indexOf('"')>-1?n.replace('"',""):n,i=(i=s[1].indexOf('"')>-1?s[1].replace('"',""):s[1]).indexOf('"')>-1?i.replace('"',""):i,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n,i="TRUE"===i.toUpperCase()?"1":"FALSE"===i?"0":i,n=this.parent.getValueFromArg(n),i=this.parent.getValueFromArg(i);var h=Math.ceil(this.parent.parseFloat(i));r=this.parent.parseFloat(n),h>0?(r>0?r+=.4999999999/Math.pow(10,h):r<0&&(r-=.4999999999/Math.pow(10,h)),t=(r=this.parent.parseFloat(r.toFixed(h))).toFixed(h),isNaN(r)&&(t=h.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name])):(r>0?r=r/Math.pow(10,-h)+.49999:r<0&&(r=r/Math.pow(10,-h)-.49999),t=(r=this.parent.parseFloat(r.toFixed(0))*Math.pow(10,-h)).toString(),isNaN(r)&&(t=h.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:t=this.parent.getErrorStrings()[e.CommonErrors.name]))}else t=a>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];return t},t.prototype.ComputeCOUNT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var n,i,a,s=t,o=0,l=0;l<s.length;l++)if((n=s[l]).indexOf(":")>-1&&this.parent.isCellReference(n)){i=this.parent.getCellCollection(n.split(this.parent.tic).join(""));for(var h=0;h<i.length;h++)a=this.parent.getValueFromArg(i[h]),isNaN(this.parent.parseFloat(a))||n.length>0&&""!==n&&" "!==n&&o++}else n=n.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(n)))||n.length>0&&""!==n&&" "!==n&&o++;return o},t.prototype.ComputeDATE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var n=t;if(3!==n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i=0;i<n.length;++i)n[i]=this.parent.getValueFromArg(n[i]);n[0]="TRUE"===n[0].split(this.parent.tic).join("")?"1":"FALSE"===n[0].split(this.parent.tic).join("")?"0":n[0],n[1]="TRUE"===n[1].split(this.parent.tic).join("")?"1":"FALSE"===n[1].split(this.parent.tic).join("")?"0":n[1],n[2]="TRUE"===n[2].split(this.parent.tic).join("")?"1":"FALSE"===n[2].split(this.parent.tic).join("")?"0":n[2];var a=this.parent.parseFloat(n[0].split(this.parent.tic).join("")),s=this.parent.parseFloat(n[1].split(this.parent.tic).join("")),o=this.parent.parseFloat(n[2].split(this.parent.tic).join("")),l=0;if(isNaN(a)||isNaN(s)||isNaN(o))return this.parent.getErrorStrings()[e.CommonErrors.value].toString();if(a<0)return this.parent.getErrorStrings()[e.CommonErrors.num].toString();for(;s>12;)s-=12,a++;if(0===(l=this.parent.getSerialDateFromDate(a,s,o)))return this.parent.getErrorStrings()[e.CommonErrors.num].toString();var h=this.parent.fromOADate(l);return"Invalid Date"!==h.toString()?h.getFullYear()+"/"+this.parent.calculateDate((h.getMonth()+1).toString())+"/"+this.parent.calculateDate(h.getDate().toString()):l.toString()},t.prototype.ComputeFLOOR=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var n,i,a=t,s=a.length,o=a[1].split(this.parent.tic).join(""),l=[];if(2!==s)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(l.push(n=this.parent.parseFloat(this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")))),a[1]=o===this.parent.trueValue?"1":o===this.parent.falseValue?"0":a[1],l.push(i=this.parent.parseFloat(this.parent.getValueFromArg(a[1].split(this.parent.tic).join("")))),n>0&&i<0)return this.parent.getErrorStrings()[e.CommonErrors.num];if(n>0&&0===i)return this.parent.getErrorStrings()[e.CommonErrors.divzero];for(var h=0;h<a.length;h++)if(a[h].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return isNaN(n)?this.parent.getErrorStrings()[e.CommonErrors.name]:Math.floor(n/i)*i},t.prototype.ComputeCEILING=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var n,i,a=t,s=[],o=a.length,l=a[1].split(this.parent.tic).join("");if(2!==o)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(s.push(n=this.parent.parseFloat(this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")))),a[1]=l===this.parent.trueValue?"1":l===this.parent.falseValue?"0":a[1],s.push(i=this.parent.parseFloat(this.parent.getValueFromArg(a[1].split(this.parent.tic).join("")))),n>0&&i<0)return this.parent.getErrorStrings()[e.CommonErrors.num];for(var h=0;h<a.length;h++)if(a[h].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return isNaN(n)?this.parent.getErrorStrings()[e.CommonErrors.name]:0===i?0:Math.ceil(n/i)*i},t.prototype.ComputeDAY=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t;if(sf.base.isNullOrUndefined(i)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(i.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var a=this.parent.getValueFromArg(i[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(a))?(a=a,n=this.parent.parseDate(a),"[object Date]"===Object.prototype.toString.call(n)&&(n=n.getDate()),n):this.parent.getErrorStrings()[e.CommonErrors.name]},t.prototype.ComputeIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(this.parent.getErrorStrings().indexOf(t[0])>0)return t[0];var n,i,a=t;if(a.length>3||1===a.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(a.length<=3){if(n=this.parent.getValueFromArg(a[0]),this.parent.getErrorStrings().indexOf(n)>-1)return n;if(n===this.parent.trueValue||this.parent.parseFloat(n)>0||this.parent.parseFloat(n)<0)i=this.parent.getValueFromArg(a[1]);else{if(n!==this.parent.falseValue&&0!==this.parent.parseFloat(n))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.requires_3_args];if(sf.base.isNullOrUndefined(a[2]))return this.parent.falseValue;i=this.parent.getValueFromArg(a[2])}}return i.indexOf(this.parent.tic)>-1?i.split(this.parent.tic).join(""):i},t.prototype.ComputeIFERROR=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var n,i=t;return 2!==i.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(n=this.parent.getValueFromArg(i[0]))===this.parent.trueValue||n===this.parent.falseValue?n:(n[0]===this.parent.arithMarker&&(n=n.replace(this.parent.arithMarker," ")),"#"===(n=this.parent.getValueFromArg(n).toUpperCase().split(this.parent.tic).join(""))[0]||n.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(n)>-1?this.parent.getValueFromArg(i[1]).split(this.parent.tic).join(""):n)},t.prototype.ComputePRODUCT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var n,i,a,s=1,o=!0;if(!sf.base.isNullOrUndefined(t))for(var l=t,h=0;h<l.length;h++){var d=l[h];if(d.indexOf(":")>-1&&this.parent.isCellReference(d))for(var p=this.parent.getCellCollection(d),c=0;c<p.length;c++){if(n=this.parent.getValueFromArg(p[c].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,a=this.parent.parseFloat(n),isNaN(a)||n.length>0&&(s*=a,o=!1)}else{if(i=this.parent.getValueFromArg(l[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,a=this.parent.parseFloat(i),isNaN(a)||i.length>0&&(s*=a,o=!1),this.parent.getErrorStrings().indexOf(i)>-1)return i}}return o?"0":s.toString()},t.prototype.ComputeDAYS=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(sf.base.isNullOrUndefined(r)&&1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;i[0].split(this.parent.tic).join("")===this.parent.trueValue&&(i[0]="1"),i[0].split(this.parent.tic).join("")===this.parent.falseValue&&(i[0]="0");var a=this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")),s=this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""));if(s=""===s||null==s?new Date(Date.parse("1899-12-31")).toDateString():s,"#"===(a=""===a||null==a?new Date(Date.parse("1899-12-31")).toDateString():a)[0])return a;if("#"===s[0])return s;var o=this.parent.intToDate(a),l=this.parent.intToDate(s);return"#"===o.toString()[0]?o.toString():"#"===l.toString()[0]?l.toString():"[object Date]"!==Object.prototype.toString.call(o)||"[object Date]"!==Object.prototype.toString.call(l)?this.parent.getErrorStrings()[e.CommonErrors.value]:(t=Math.ceil(o.getTime()-l.getTime())/864e5,Math.round(t))},t.prototype.ComputeCHOOSE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(t.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var n=t;if(n[0].indexOf(":")>-1&&this.parent.isCellReference(n[0])){if(1!==(o=this.parent.getCellCollection(n[0])).length)return this.parent.getErrorStrings()[e.CommonErrors.value];n[0]=o[0]}var i=this.parent.getValueFromArg(n[0]);if(this.parent.getErrorStrings().indexOf(i)>-1)return i;var a,s=this.parent.parseFloat(this.parent.getValueFromArg(n[0].split(this.parent.tic).join("")));if(s<1)return this.parent.getErrorStrings()[e.CommonErrors.value];if(s=Math.floor(s),sf.base.isNullOrUndefined(n[s]))return this.parent.getErrorStrings()[e.CommonErrors.value];if(""===(a=n[s])&&(a="0"),a.indexOf(":")>-1&&this.parent.isCellReference(a)){var o;if(1!==(o=this.parent.getCellCollection(n[0].split(this.parent.tic).join(""))).length)return this.parent.getErrorStrings()[e.CommonErrors.value];n[0]=o[0]}return this.parent.getValueFromArg(a).split(this.parent.tic).join("")},t.prototype.ComputeSUMIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0])||n[2]&&n[2].indexOf(":")<0&&!this.parent.isCellReference(n[2]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(n.length>3||n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:i[0]},t.prototype.ComputeABS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t,a="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(""===i[0].toString().split(this.parent.tic).join("").trim()||i[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];if(this.parent.isCellReference(i[0])){if(""===(a=this.parent.getValueFromArg(i[0])))return this.parent.getErrorStrings()[e.CommonErrors.name];if(n=this.parent.parseFloat(a),isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}else if(n=this.parent.parseFloat(i[0]),isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.name];return Math.abs(n)},t.prototype.ComputeAVERAGE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var n=t,i=0;i<n.length;i++)if(n[i].indexOf(":")>-1&&n[i].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return this.parent.calculateAvg(n)},t.prototype.ComputeAVERAGEIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];var i=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:this.parent.parseFloat(i[0])/this.parent.parseFloat(i[1])},t.prototype.ComputeCONCATENATE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var n=t,i="",a="",s=0;s<n.length;s++){if(n[s].indexOf(":")>-1&&this.parent.isCellReference(n[s])){if(!this.isConcat)return this.parent.getErrorStrings()[e.CommonErrors.value];for(var o=this.parent.getCellCollection(n[s]),l=0;l<o.length;l++)i+=a=this.parent.getValueFromArg(o[l])}else{if(1===n.length&&n[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[e.CommonErrors.name];i+=a=this.parent.getValueFromArg(n[s])}if(this.parent.getErrorStrings().indexOf(a)>-1)return a}return i.split(this.parent.tic).join("")},t.prototype.ComputeCONCAT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},t.prototype.ComputeMAX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"max")},t.prototype.ComputeMIN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"min")},t.prototype.ComputeRAND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===t.length&&""===t[0]&&(t.length=0),t.length>0?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:Math.random().toString()},t.prototype.ComputeAND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"and")},t.prototype.ComputeOR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"or")},t.prototype.ComputeFIND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var n=t;if(n.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.removeTics(this.parent.getValueFromArg(n[0])),a=this.parent.removeTics(this.parent.getValueFromArg(n[1]));if(this.parent.getErrorStrings().indexOf(i)>-1||this.parent.getErrorStrings().indexOf(a)>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];var s,o=1;if(3===n.length){if(o=this.parent.removeTics(this.parent.getValueFromArg(n[2])),this.parent.getErrorStrings().indexOf(o)>-1)return o;o=this.parent.parseFloat(o),isNaN(o)&&(o=1)}return o<=0||o>a.length||(s=a.indexOf(i,o-1))<0?this.parent.getErrorStrings()[e.CommonErrors.value]:(Number(s)+Number(1)).toString()},t.prototype.ComputeINDEX=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t,i=n.length;if(sf.base.isNullOrUndefined(t)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(i>3)return this.parent.getErrorStrings()[e.CommonErrors.ref];var a="",s=[];if(i>2)for(var o=0;o<i;o++){if(this.parent.isCellReference(n[o])&&n[o].indexOf(":")<0)return this.parent.getErrorStrings()[e.CommonErrors.ref];this.parent.isCellReference(n[o])&&(s[o]=n[o])}if(a=n[0],n[1]=""===n[1]?"1":n[1],n[1]=this.parent.getValueFromArg(n[1]),this.parent.getErrorStrings().indexOf(n[1])>-1)return n[1];if(!sf.base.isNullOrUndefined(n[2])){if(n[2]=""===n[2]?"1":n[2],n[2]=this.parent.getValueFromArg(n[2]),this.parent.getErrorStrings().indexOf(n[2])>-1)return n[2];if("0"===n[2])return this.parent.getErrorStrings()[e.CommonErrors.value]}var l=parseFloat(n[1]);l=isNaN(l)?-1:l;var h=parseFloat(n[2]?n[2]:"1");if(h=isNaN(h)?-1:h,-1===l||-1===h)return this.parent.getErrorStrings()[e.CommonErrors.value];var d=n[0].indexOf(":"),p=this.parent.rowIndex(a.substring(0,d)),c=this.parent.rowIndex(a.substring(d+1)),u=this.parent.colIndex(a.substring(0,d)),f=this.parent.colIndex(a.substring(d+1));if(l>c-p+1||h>f-u+1)return this.parent.getErrorStrings()[e.CommonErrors.ref];l=p+l-1,h=u+h-1;var g=""+this.parent.convertAlpha(h)+l,m=this.parent.getValueFromArg(g);return""===m?0:m},t.prototype.ComputeIFS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(sf.base.isNullOrUndefined(t)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i="",a="",s=0;s<n.length;s++){if((i=this.parent.getValueFromArg(n[s]))!==this.parent.trueValue&&i!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.value];if(i===this.parent.trueValue)return n[s+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(a=this.parent.isCellReference(n[s+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(n[s+1]):n[s+1].indexOf(this.parent.tic)>-1?n[s+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[e.CommonErrors.name],s+=1,a);i===this.parent.falseValue&&(s+=1)}return this.parent.getErrorStrings()[e.CommonErrors.na]},t.prototype.ComputeCOUNTA=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var n,i=t,a=0,s=0;s<i.length;s++)if(i[s].indexOf(":")>-1&&this.parent.isCellReference(i[s])){n=this.parent.getCellCollection(i[s].split(this.parent.tic).join(""));for(var o=0;o<n.length;o++)this.parent.getValueFromArg(n[o]).length>0&&a++}else{var l=this.parent.getValueFromArg(i[s].split(this.parent.tic).join(""));l.length>0&&a++}return a},t.prototype.ComputeAVERAGEA=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(sf.base.isNullOrUndefined(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var n,i,a,s=t,o=0,l=0,h=0;h<s.length;h++){if(s[h].indexOf(":")>-1&&this.parent.isCellReference(s[h])){n=this.parent.getCellCollection(s[h].split(this.parent.tic).join(""));for(var d=0;d<n.length;d++)if((i=this.parent.getValueFromArg(n[d])).toUpperCase()===this.parent.trueValue)i="1";else if(i.toUpperCase()===this.parent.falseValue||""===i)i="0";else{if(this.parent.getErrorStrings().indexOf(i)>-1)return i;i.length>0&&(a=parseFloat(i),o+=i=isNaN(a)?0:a,l+=1)}l=n.length}else{if(s[h]===this.parent.trueValue&&(s[h]="1"),s[h]!==this.parent.falseValue&&""!==s[h]||(s[h]="0"),i=this.parent.getValueFromArg(s[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;i.length>0&&(a=parseFloat(i),o+=i=isNaN(a)?0:a,l+=1)}if(0===l)return this.parent.getErrorStrings()[e.CommonErrors.divzero]}return o/l},t.prototype.ComputeCOUNTIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t;if(sf.base.isNullOrUndefined(t)||""===t[0]||2!==i.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var a,s=0,o=[],l="equal",h=i[1].split(this.parent.tic).join("");if(h.startsWith("<=")?(l="lessEq",h=h.substring(2)):h.startsWith(">=")?(l="greaterEq",h=h.substring(2)):h.startsWith("<>")?(l="notEq",h=h.substring(2)):h.startsWith("<")?(l="less",h=h.substring(1)):h.startsWith(">")?(l="greater",h=h.substring(1)):h.startsWith("=")&&(l="equal",h=h.substring(1)),i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){n=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""));for(var d=0;d<n.length;d++)a=this.parent.getValueFromArg(n[d]),(h.indexOf("*")>-1||h.indexOf("?")>-1)&&(a=this.parent.findWildCardValue(h,a)),o.push(a),o.push(h),this.parent.processLogical(o,l)===this.parent.trueValue&&s++}return s},t.prototype.ComputeSUMIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue)},t.prototype.ComputeTEXT=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];for(var i=r.length,a=0;a<i;a++)t=sf.base.isNullOrUndefined(t)?r[a]:t+","+r[a];var s=t.indexOf(","),o=t.slice(0,s),l=t.slice(t.indexOf('"')+1,t.length),h=l.indexOf('"');if(s>-1&&h!==l.length-1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var d=o,p=l.slice(0,l.length-1),c=new Date(1900,0,1,0,0,0),u=d+","+p,f=new sf.base.Internationalization;if(this.parent.getErrorStrings().indexOf(u)>-1)return u;if(d=this.parent.getValueFromArg(d),""===(p=p.split(this.parent.tic).join("")))return"";""===d&&(p.length>0&&(p.toUpperCase().indexOf("M")>-1||p.toUpperCase().indexOf("D")>-1||p.toUpperCase().indexOf("Y")>-1||p.toUpperCase().indexOf("S")>-1||p.toUpperCase().indexOf("T")>-1)||p.toUpperCase().indexOf("H")>-1)&&(d=c.toString());var g=this.parseDouble(d);if(isNaN(g)&&null!==this.parent.isDate(new Date(d))&&(g=this.parent.toOADate(new Date(d))),c=Date.parse(d.split(this.parent.tic).join("")),!isNaN(g)||!isNaN(c)){if("["===p[0])return this.parent.tic+d+this.parent.tic;if(p.length>0&&(p.toUpperCase().indexOf("M")>-1||p.toUpperCase().indexOf("D")>-1||p.toUpperCase().indexOf("Y")>-1||p.toUpperCase().indexOf("S")>-1||p.toUpperCase().indexOf("T")>-1)||p.toUpperCase().indexOf("H")>-1){var m=(p=(p=p.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),v=!1,y=!1,C=(a=0,0),b=0;for(a=0;a<m.length;){var S=m[a];"s"===S&&"M"===m[C]&&(m[C]="m","M"===m[C-1]&&(m[C-1]="m")),this.parent.isChar(S)?(C=a,"M"===S&&b++):b>1&&b++,"M"===S&&v&&(m[a]="m",y=!0),"h"===S?v=!0:this.parent.isChar(S)&&"M"!==S&&"h"!==S&&!y&&(v=!1,y=!1),a++}p=(p=String(m)).split(",").join("").split("\n").join(" ");var x=this.parent.fromOADate(g);0===g&&(x=c);var w=te(p);if(""===w)return this.parent.getErrorStrings()[e.CommonErrors.name];var I=f.getDateFormat({skeleton:w,type:"date"}),E=I(new Date(x.toString()));d=E}else d=f.formatNumber(g,{format:p})}return d},t.prototype.ComputeCOUNTIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.trueValue)},t.prototype.ComputeAVERAGEIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue,this.parent.trueValue)},t.prototype.ComputeMATCH=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t;if(sf.base.isNullOrUndefined(i)||1===i.length&&""===i[0]||i.length<2||i.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var a=[],s=i[0].split(this.parent.tic).join("");i[2]=sf.base.isNullOrUndefined(i[2])?"1":i[2].split(this.parent.tic).join(""),i[2].split(this.parent.tic).join("")===this.parent.trueValue&&(i[2]="1"),i[2].split(this.parent.tic).join("")===this.parent.falseValue&&(i[2]="0");var o=parseFloat(i[2]);if(-1!==o&&0!==o&&1!==o)return this.parent.getErrorStrings()[e.CommonErrors.na];var l=0,h="";if(i[1].indexOf(":")>-1||this.parent.isCellReference(i[1])){n=this.parent.getCellCollection(i[1].split(this.parent.tic).join(""));for(var d=0;d<n.length;d++)a[d]=this.parent.getValueFromArg(n[d]).split(this.parent.tic).join("");for(var p=0;p<a.length;p++)if(1===o){if(s===a[p])return p+1;s>a[p]&&(h?a[p]>h&&(l=p+1,h=a[p]):(l=p+1,h=a[p]))}else if(0===o){if((s.indexOf("*")>-1||s.indexOf("?")>-1)&&(a[p]=this.parent.findWildCardValue(s,a[p])),s===a[p])return p+1;if(this.parent.parseFloat(s)===this.parent.parseFloat(a[p]))return p+1}else if(-1===o){if(s===a[p])return p+1;s<a[p]&&(h?a[p]<h&&(l=p+1,h=a[p]):(l=p+1,h=a[p]))}}return l||this.parent.getErrorStrings()[e.CommonErrors.na]},t.prototype.ComputeLOOKUP=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;return sf.base.isNullOrUndefined(n)||1===n.length&&""===n[0]||n.length<2||n.length>3?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:this.parent.computeLookup(n)},t.prototype.ComputeVLOOKUP=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;return sf.base.isNullOrUndefined(n)||1===n.length&&""===n[0]||n.length<3||n.length>4?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:this.parent.computeVLookup(n)},t.prototype.ComputeSUBTOTAL=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t,i="";if(n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var a=this.parent.parseFloat(this.parent.getValueFromArg(n[0].split(this.parent.tic).join("")));isNaN(a)&&this.parent.getErrorStrings()[e.CommonErrors.value],(a<1||a>11)&&(a<101||a>111)&&this.parent.getErrorStrings()[e.CommonErrors.value];var s=n.slice(1,n.length);switch(a){case 1:case 101:i=this.ComputeAVERAGE.apply(this,s);break;case 2:case 102:i=this.ComputeCOUNT.apply(this,s);break;case 3:case 103:i=this.ComputeCOUNTA.apply(this,s);break;case 4:case 104:i=this.ComputeMAX.apply(this,s);break;case 5:case 105:i=this.ComputeMIN.apply(this,s);break;case 6:case 106:i=this.ComputePRODUCT.apply(this,s);break;case 7:case 107:i=this.ComputeDAY.apply(this,s);break;case 8:case 108:i=this.ComputeCONCAT.apply(this,s);break;case 9:case 109:i=this.ComputeSUM.apply(this,s);break;case 10:case 110:i=this.ComputeAVERAGEA.apply(this,s);break;case 11:case 111:i=this.ComputeABS.apply(this,s);break;default:i=this.parent.getErrorStrings()[e.CommonErrors.value]}return i},t.prototype.ComputeRADIANS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(""===n[0]||n.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(n[0].indexOf(":")>-1||""===n[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[e.CommonErrors.value];var i=n[0].split(this.parent.tic).join("");n[0]=isNaN(this.parent.parseFloat(i))?n[0]:i;var a=this.parent.getValueFromArg(n[0]),s=this.parent.parseFloat(a);return isNaN(s)?a.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]:Math.PI*s/180},t.prototype.ComputeRANDBETWEEN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,s=t.length;if(2!==s)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var o=0;o<s;o++){if(""===t[o])return this.parent.getErrorStrings()[e.CommonErrors.na];if(t[o].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(t[o].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.value];t[o]=t[o].split(this.parent.tic).join("")}if(a=parseFloat(this.parent.getValueFromArg(t[o])),this.parent.isCellReference(t[o])){if(a=""===this.parent.getValueFromArg(t[o])?0:a,0===o?n=a:i=a,0===n&&0===i)return"0";if(isNaN(a))return this.parent.getErrorStrings()[e.CommonErrors.value]}else{if(isNaN(a))return this.parent.getErrorStrings()[e.CommonErrors.name];0===o?n=a:i=a}}return i<n?this.parent.getErrorStrings()[e.CommonErrors.num]:0===n?Math.floor(Math.random()*(i-(n-1)))+n:i-n==1?Math.round(Math.random()*(i-n)+n):Math.floor(Math.random()*(i-(n-1)))+n},t.prototype.ComputeSLOPE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a=t;if(2!==a.length||""===a[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=this.parent.getCellCollection(a[1].split(this.parent.tic).join("")),o=this.parent.getCellCollection(a[0].split(this.parent.tic).join(""));if(o.length!==s.length)return this.parent.getErrorStrings()[e.CommonErrors.na];if(n=this.getDataCollection(o),(i=this.getDataCollection(s)).indexOf("#NAME?")>-1||n.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];for(var l=0,h=0,d=0,p=0,c=0,u=i.length;c<u;++c)"NaN"!==Number(i[c]).toString()&&"NaN"!==Number(n[c]).toString()&&(l+=Number(i[c])*Number(n[c]),d+=Number(i[c]),p+=Number(n[c]),h+=Number(i[c])*Number(i[c]));l-d*p!=0&&h-d*d!=0||this.parent.getErrorStrings()[e.CommonErrors.divzero];var f=((l-d*p/i.length)/(h-d*d/i.length)).toString();return"NaN"===f?this.parent.getErrorStrings()[e.CommonErrors.divzero]:f},t.prototype.ComputeINTERCEPT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a=t;if(""===a[0]||2!==a.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=this.parent.getCellCollection(a[0].split(this.parent.tic).join("")),o=this.parent.getCellCollection(a[1].split(this.parent.tic).join(""));if(s.length!==o.length)return this.parent.getErrorStrings()[e.CommonErrors.na];if(n=this.getDataCollection(o),i=this.getDataCollection(s),n.indexOf("#NAME?")>-1||i.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];for(var l=0,h=0,d=0,p=n.length;d<p;++d)l+=Number(n[d]),h+=Number(i[d]);l/=n.length,h/=n.length;var c,u=0,f=0;for(d=0,p=n.length;d<p;++d)u+=(c=Number(n[d])-l)*(Number(i[d])-h),f+=c*c;var g=(h-u/f*l).toString();return h-u!=0&&f*l!=0||this.parent.getErrorStrings()[e.CommonErrors.divzero],"NaN"===g?this.parent.getErrorStrings()[e.CommonErrors.divzero]:g},t.prototype.ComputeLN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a=t,s="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(this.parent.isCellReference(a[0])){if(s=this.parent.getValueFromArg(a[0]),(n=this.parent.parseFloat(s))<=0||""===s)return this.parent.getErrorStrings()[e.CommonErrors.num];if(isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}else{if(i=this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")),(n=this.parent.parseFloat(i))<=0||""===n.toString())return this.parent.getErrorStrings()[e.CommonErrors.num];if(isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}return Math.log(n)},t.prototype.ComputeISNUMBER=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a=t;return 0===t.length||t.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:""!==(i=this.parent.isCellReference(a[0])?this.parent.getValueFromArg(a[0]):this.parent.getValueFromArg(a[0].split(this.parent.tic).join(""))).toString()&&(n=this.parent.parseFloat(i),!isNaN(n))},t.prototype.ComputeROUND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,s,o,l=t,h=0,d=0;return 0===t.length||t.length>2?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:1===t.length?(n="TRUE"===l[0].split(this.parent.tic).join("")?"1":"FALSE"===l[0].split(this.parent.tic).join("")?"0":l[0],Math.round(this.parent.parseFloat(n)).toString()):(a=this.parent.getValueFromArg(l[0]),s=""===l[1].split(this.parent.tic).join("")?"0":this.parent.getValueFromArg(l[1].split(this.parent.tic).join("")),a="TRUE"===a.split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a,s="TRUE"===s.split(this.parent.tic).join("")?"1":"FALSE"===s.split(this.parent.tic).join("")?"0":s,""!==a&&""!==s&&(h=this.parent.parseFloat(a),d=this.parent.parseFloat(s),!isNaN(d)&&!isNaN(h)&&d>0?i=h.toFixed(d):(o=Math.pow(10,-d),i=Math.round(h/o)*o)),i.toString())},t.prototype.ComputePOWER=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,s,o=t;return 0===t.length||t.length>2?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(n=this.parent.getValueFromArg(o[0]),i=this.parent.getValueFromArg(o[1]),n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,a=this.parent.parseFloat(n),s=this.parent.parseFloat(i),isNaN(a)||isNaN(s)?this.parent.getErrorStrings()[e.CommonErrors.value]:0===a&&s<0?this.parent.getErrorStrings()[e.CommonErrors.divzero]:0===a&&0===s?this.parent.getErrorStrings()[e.CommonErrors.num]:Math.pow(a,s).toString())},t.prototype.ComputeLOG=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,s,o=t;return 0===t.length||t.length>2?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(n=this.parent.getValueFromArg(o[0]),i=2===t.length?this.parent.getValueFromArg(o[1]):"10",""===n||null===n||""===i||null===i?this.parent.getErrorStrings()[e.CommonErrors.num]:(n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,a=this.parent.parseFloat(n),s=this.parent.parseFloat(i),a<=0||s<=0?this.parent.getErrorStrings()[e.CommonErrors.num]:1===s?this.parent.getErrorStrings()[e.CommonErrors.divzero]:isNaN(a)||isNaN(s)?this.parent.getErrorStrings()[e.CommonErrors.value]:(Math.log(a)/Math.LN10/(Math.log(s)/Math.LN10)).toString()))},t.prototype.ComputeTRUNC=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,s=t,o=0;return 0===t.length||t.length>2?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(2===t.length&&(o="TRUE"===(o=this.parent.getValueFromArg(s[1])).split(this.parent.tic).join("")?"1":"FALSE"===o.split(this.parent.tic).join("")?"0":o,o=this.parent.parseFloat(o)),n="TRUE"===(n=this.parent.getValueFromArg(s[0])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,i=this.parent.parseFloat(n.split(this.parent.tic).join("")),isNaN(i)||isNaN(o)?s[0]===this.parent.tic||this.parent.isCellReference(s[0])||s[1]===this.parent.tic||this.parent.isCellReference(s[1])?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]:(a=Math.pow(10,o),((i<0?-1:1)*Math.floor(a*Math.abs(i))/a).toString()))},t.prototype.ComputeEXP=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a=t;return 0===t.length||t.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(""===(n="TRUE"===(n=this.parent.getValueFromArg(a[0])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n)&&(n="0"),(i=this.parent.parseFloat(n))>709?this.parent.getErrorStrings()[e.CommonErrors.num]:isNaN(i)?a[0]===this.parent.tic||this.parent.isCellReference(a[0])?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]:Math.exp(i).toString())},t.prototype.ComputeGEOMEAN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,s,o=t,l=1,h=0,d=0;if(0===t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(i=0;i<o.length;i++)if(o[i].indexOf(":")>-1){if(o[0]===this.parent.tic)return this.parent.getErrorStrings()[e.CommonErrors.value];for(s=this.parent.getCellCollection(o[i].split(this.parent.tic).join("")),a=0;a<s.length;a++){if(d="TRUE"===(d=this.parent.getValueFromArg(s[a])).split(this.parent.tic).join("")?"1":"FALSE"===d.split(this.parent.tic).join("")?"0":d,(n=this.parent.parseFloat(d))<=0)return this.parent.getErrorStrings()[e.CommonErrors.num];isNaN(n)||(h++,l*=n)}}else if((d=this.parent.getValueFromArg(o[i])).length>0){if(d="TRUE"===d.split(this.parent.tic).join("")?"1":"FALSE"===d.split(this.parent.tic).join("")?"0":d,!this.parent.isCellReference(o[i])&&isNaN(this.parent.parseFloat(d)))return this.parent.getErrorStrings()[e.CommonErrors.name];if((n=this.parent.parseFloat(d))<=0)return this.parent.getErrorStrings()[e.CommonErrors.num];isNaN(n)||(h++,l*=n)}return h>0&&(l=Math.pow(l,1/h)),l.toString()},t.prototype.getDataCollection=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(this.parent.getValueFromArg(e[r]));return t},t.prototype.parseDouble=function(e){var t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t},t.prototype.getModuleName=function(){return"basic-formulas"},t}(),de=function(){function t(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}return t.prototype.parse=function(t,r){if(this.parent.isTextEmpty(t))return t;this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===t[0]&&(t=t.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(t=this.checkForNamedRangeAndKeyValue(t),this.findNamedRange=!1),t=(t=(t=(t=t.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");var n=this.storeStrings(t);t=this.storedStringText;var i=0;if(sf.base.isNullOrUndefined(n)&&(t=t.split(" ").join("")),(t=(t=t.split("=>").join(">=")).split("=<").join("<="))[t.length-1]===this.parent.arithMarker&&this.indexOfAny(t,this.tokens)===t.length-2||(t=t.toUpperCase()),t.indexOf(this.sheetToken)>-1){var a=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=a.sheetNameToParentObject&&a.sheetNameToParentObject.size>0){t[0]!==this.sheetToken.toString()&&(t=this.parent.setTokensForSheets(t));var s=this.parent.getSheetToken(t.split(this.parent.tic).join(this.emptyStr)),o=this.checkScopedRange(t.split('"').join(this.emptyStr).split(this.sheetToken).join(""));sf.base.isNullOrUndefined(s)&&""!==s&&this.parent.namedRanges.size>0&&""!==o&&(t=o)}}t=this.markLibraryFormulas(t);try{t=this.formulaAutoCorrection(t)}catch(n){if(!(d={message:n.message,exception:n,isForceCalculable:n.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",d),this.isFailureTriggered=!0),!d.isForceCalculable||!d.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression];t=this.formulaAutoCorrection(t,d),this.parent.storedData.get(r).formulaText="="+t}if(!this.ignoreBracet)for(i=t.indexOf(")");i>-1;){var l=t.substring(0,i).lastIndexOf("(");if(-1===l)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);if(l===i-1)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.empty_expression]);var h=this.emptyStr;h=this.ignoreBracet?this.parent.substring(t,l,i-l+1):this.parent.substring(t,l+1,i-l-1);try{t=t.substring(0,l)+this.parseSimple(h)+t.substring(i+1)}catch(e){var d=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",d),this.isFailureTriggered=!0);var p="string"==typeof d.exception?d.exception:d.message;return(this.parent.getErrorLine(e)?"":"#"+this.parent.getErrorLine(e)+": ")+p}i=t.indexOf(")")}if(!this.ignoreBracet&&t.indexOf("(")>-1)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);return t=this.parseSimple(t),null!==n&&n.size>0&&(t=this.setStrings(t,n)),t},t.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},t.prototype.formulaAutoCorrection=function(t,r){var n=["*","+","-","/","^","&"],i=[">","=","<"],a=0,s="",o="",l="",h="",d="",p="",c="",u=0;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;if(this.indexOfAny(t,this.specialSym)>-1)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression],!1);for(;a<t.length;)if(((t=t.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+")).indexOf("*-")>-1||t.indexOf("/-")>-1)&&(t="-"+t.split("*-").join("*").split("/-").join("/")),this.parent.isDigit(t[a])&&t.length>a+1&&this.indexOfAny(t[a+1],n)>-1&&t.length>a+2&&!sf.base.isNullOrUndefined(t[a+2])&&this.indexOfAny(t[a+2],n)>-1){if(sf.base.isNullOrUndefined(r))throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression],!0);if(!r.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];this.parent.isDigit(t[a])?(u<1?(p=t[a],l=t[a+1],sf.base.isNullOrUndefined(l)&&(l=this.emptyStr),u+=1,s=s+p+(l="&"===l?"":l)):u<2&&(c=t[a],h=t[a-1],d=t[a+1],u=0,s="-"===h?s+h+c+(d="&"===(d=sf.base.isNullOrUndefined(d)?this.emptyStr:d)?"":d):s+c+(d=sf.base.isNullOrUndefined(d)?this.emptyStr:d)),a+=2):(s="-"===t[a]?s+t[a]:s,a+=1)}else if((this.parent.isDigit(t[a])||t[a]===this.parent.rightBracket||this.parent.storedData.has(t[a].toUpperCase()))&&(sf.base.isNullOrUndefined(t[a+1])||this.indexOfAny(t[a+1],n))>-1)o="&"===(o=sf.base.isNullOrUndefined(t[a+1])?this.emptyStr:t[a+1])?"":o,s="-"===t[a-1]?s+t[a-1]+t[a]+o:s+t[a]+o,a+=2;else if(this.indexOfAny(t[a],i)>-1&&!sf.base.isNullOrUndefined(t[a-1])&&!sf.base.isNullOrUndefined(t[a+1]))s+=t[a],a+=1;else if("q"===t[a])for(;t[a]!==this.parent.leftBracket;)s+=t[a],a+=1;else t[a]===this.parent.leftBracket||t[a]===this.parent.rightBracket||"{"===t[a]||"}"===t[a]||"("===t[a]||")"===t[a]||this.parent.isUpperChar(t[a])||t[a].indexOf(":")>-1||t[a]===this.parent.getParseArgumentSeparator()||"%"===t[a]&&this.parent.isDigit(t[a-1])||t[a]===this.parent.tic||" "===t[a]||"."===t[a]||t[a]===this.sheetToken||"$"===t[a]?(s+=t[a],a+=1):(this.parent.isDigit(t[a])&&(s="-"===t[a-1]?s+t[a-1]+t[a]:s+t[a]),"-"!==t[a]&&"+"!==t[a]||(s=(s+=t[a]).split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==t[a]&&"*"!==t[a]||(s+=t[a]),a+=1);return s=s===this.emptyStr?t:s,this.indexOfAny(s[s.length-1],n)>-1&&(s=s.substring(0,s.length-1)),s=s.split("--").join("-").split("-+").join("-").split("+-").join("-")},t.prototype.checkScopedRange=function(e){var t=this,r=this.emptyStr,n="NaN",i=this.parent.getSheetID(this.parent.grid),a=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var s=e.indexOf(this.sheetToken,1),o=parseInt(e.substr(1,s-1),10);s>1&&!this.parent.isNaN(o)&&(e=e.substring(s+1),i=o)}var l="!"+i.toString()+"!";return null===a||null==a.sheetNameToToken||a.sheetNameToToken.forEach((function(i,s){if(a.sheetNameToToken.get(s).toString()===l){var o=t.emptyStr;t.parent.namedRanges.forEach((function(i,s){o=sf.base.isNullOrUndefined(t.parent.parentObject)?a.sheetNameToToken.get(s).toUpperCase():(t.parent.parentObject.getActiveSheet().name+t.sheetToken+e).toUpperCase(),t.parent.getNamedRanges().has(o)&&(r=t.parent.getNamedRanges().get(o).toUpperCase(),n=r)}))}})),n},t.prototype.storeStrings=function(t){var r,n=0,i=0,a=0,s="",o=null;if(t.indexOf(this.parent.tic)>-1)for(n=t.indexOf(this.parent.tic);n>-1&&t.length>0;){if(null===o&&(o=this.stringsColl),-1===(i=n+1<t.length?t.indexOf(this.parent.tic,n+1):-1))throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_tics]);r=this.parent.substring(t,n,i-n+1),s=this.parent.tic+this.spaceString+a.toString()+this.parent.tic,o=o.set(s,r),t=t.substring(0,n)+s+t.substring(i+1),(n+=s.length)<t.length&&(n=t.indexOf(this.parent.tic,n)),a++}return this.storedStringText=t,o},t.prototype.setStrings=function(e,t){for(var r=0;r<t.size;r++)t.forEach((function(t,r){e=e.split(r).join(t)}));return e},t.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var r=[this.tokenEp,this.tokenEm],n=[this.tokenMultiply,this.tokenDivide],i=[this.tokenAdd,this.tokenSubtract],a=[this.charMultiply,this.charDivide],s=[this.charAdd,this.charSubtract],o=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],h=[this.charEp,this.charEm],d=[this.tokenAnd],p=[this.charAnd],c=[this.charOr],u=[this.tokenOr];return t=this.parseSimpleOperators(t,r,h),t=this.parseSimpleOperators(t,u,c),t=this.parseSimpleOperators(t,n,a),t=this.parseSimpleOperators(t,i,s),t=this.parseSimpleOperators(t,o,l),t=this.parseSimpleOperators(t,d,p)},t.prototype.parseSimpleOperators=function(t,r,n){if(this.parent.getErrorStrings().indexOf(t)>-1)return t;for(var i=t,a=0,s="",o=0;o<n.length;o++)s+=n[o];(i=(i=i.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString()).length>0&&"-"===i[0]?(i="0-"+(i=i.substring(1).split("-").join(this.tokenOr)),i=(i=this.parseSimpleOperators(i,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):i.length>0&&"+"===i[0]?i=i.substring(1):i.length>0&&"+"===i[i.length-1]&&(i=i.substring(0,i.length-1));try{if(this.indexOfAny(i,n)>-1)for(a=this.indexOfAny(i,n);a>-1;){var l="",h="",d=0,p=0,c=i[a]===this.charNOTop,u=0;if(c)d=a;else if(i[u=a-1]===this.parent.arithMarker){if((g=this.findLeftMarker(i.substring(0,u-1)))<0)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(i,g+1,u-g-1),d=g+1}else if(i[u]===this.parent.rightBracket){for(var f=0,g=u-1;g>0&&("q"!==i[g]||0!==f);)"q"===i[g]?f--:i[g]===this.parent.rightBracket&&f++,g--;if(g<0)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(i,g,u-g+1),d=g}else if(i[u]===this.parent.tic[0]){var m=i.substring(0,u-1).lastIndexOf(this.parent.tic);if(m<0)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(i,m,u-m+1),d=m}else{for(var v=!1;u>-1&&(this.parent.isDigit(i[u])||!v&&i[u]===this.parent.getParseDecimalSeparator());)i[u]===this.parent.getParseDecimalSeparator()&&(v=!0),u-=1;if(u>-1&&v&&i[u]===this.parent.getParseDecimalSeparator())throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.number_contains_2_decimal_points]);if(0===(u+=1)||u>0&&!this.parent.isUpperChar(i[u-1]))l="n"+this.parent.substring(i,u,a-u),d=u;else{for(u-=1;u>-1&&(this.parent.isUpperChar(i[u])||this.parent.isDigit(i[u]));)u-=1;if(u>-1&&i[u]===this.sheetToken){for(u-=1;u>-1&&i[u]!==this.sheetToken;)u-=1;u>-1&&i[u]===this.sheetToken&&(u-=1)}if(u>-1&&":"===i[u]){for(u-=1;u>-1&&this.parent.isDigit(i[u]);)u-=1;for(;u>-1&&this.parent.isUpperChar(i[u]);)u-=1;if(u>-1&&i[u]===this.sheetToken){for(u--;u>-1&&i[u]!==this.sheetToken;)u--;u>-1&&i[u]===this.sheetToken&&u--}u+=1,l=this.parent.substring(i,u,a-u),l=this.parent.getCellFrom(l)}else u+=1,l=this.parent.substring(i,u,a-u);this.parent.updateDependentCell(l),d=u}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(l.toUpperCase())||this.parent.storedData.has(l.toUpperCase()))&&(l="n"+this.checkForNamedRangeAndKeyValue(l))}if(a===i.length-1)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.expression_cannot_end_with_an_operator]);var y="u"===i[u=a+1];if(y&&(u+=1),i[u]===this.parent.tic[0]){if((g=i.substring(u+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse];h=this.parent.substring(i,u,g+2),p=g+u+2}else if(i[u]===this.parent.arithMarker){if((g=this.findRightMarker(i.substring(u+1)))<0)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);h=this.parent.substring(i,u+1,g),p=g+u+2}else if("q"===i[u]){for(f=0,g=u+1;g<i.length&&(i[g]!==this.parent.rightBracket||0!==f);)i[g]===this.parent.rightBracket?f++:"q"===i[g]&&f--,g++;if(g===i.length)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse];h=this.parent.substring(i,u,g-u+1),y&&(h="u"+h),p=g+1}else if(this.parent.isDigit(i[u])||i[u]===this.parent.getParseDecimalSeparator()){v=i[u]===this.parent.getParseDecimalSeparator();for(u+=1;u<i.length&&(this.parent.isDigit(i[u])||!v&&i[u]===this.parent.getParseDecimalSeparator());)i[u]===this.parent.getParseDecimalSeparator()&&(v=!0),u+=1;if(u<i.length&&"%"===i[u]&&(u+=1),v&&u<i.length&&i[u]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.number_contains_2_decimal_points];h="n"+this.parent.substring(i,a+1,u-a-1),p=u}else if(this.parent.isUpperChar(i[u])||i[u]===this.sheetToken||"u"===i[u]){if(i[u]===this.sheetToken)for(u+=1;u<i.length&&i[u]!==this.sheetToken;)u+=1;u+=1;for(var C=0,b=!1;u<i.length&&(this.parent.isUpperChar(i[u])||"_"===i[u]||"."===i[u]||"["===i[u]||"]"===i[u]||"#"===i[u]||" "===i[u]||"%"===i[u]||i[u]===this.parent.getParseDecimalSeparator()&&b);)u!==i.length-1&&"["===i[u]&&"["===i[u+1]&&(b=!0),u!==i.length-1&&"]"===i[u]&&"]"===i[u+1]&&(b=!1),u++,C++;var S=u===i.length||!this.parent.isDigit(i[u]);if(C>1){for(;u<i.length&&(this.parent.isUpperChar(i[u])||this.parent.isDigit(i[u])||" "===i[u]||"_"===i[u]);)u++;S=!0}for(;u<i.length&&this.parent.isDigit(i[u]);)u+=1;if(u<i.length&&":"===i[u]){if((u+=1)<i.length&&i[u]===this.sheetToken){for(u++;u<i.length&&i[u]!==this.sheetToken;)u+=1;u<i.length&&i[u]===this.sheetToken&&u++}for(;u<i.length&&this.parent.isUpperChar(i[u]);)u+=1;for(;u<i.length&&this.parent.isDigit(i[u]);)u+=1;u-=1,h=this.parent.substring(i,a+1,u-a),h=this.parent.getCellFrom(h)}else u-=1,h=this.parent.substring(i,a+1,u-a),(y="u"===i[u])&&(h="u"+h);S&&h.startsWith(this.sheetToken)&&(S=!this.parent.isCellReference(h)),S||this.parent.updateDependentCell(h),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(h.toUpperCase())||this.parent.storedData.has(h.toUpperCase()))&&(h="n"+this.checkForNamedRangeAndKeyValue(h)),p=u+1}var x=s.indexOf(i[a]),w=this.parent.arithMarker+l+h+r[x]+this.parent.arithMarker;d>0&&(w=i.substring(0,d)+w),p<i.length&&(w+=i.substring(p)),i=w=w.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),a=this.indexOfAny(i,n)}else if(i.length>0&&(this.parent.isUpperChar(i[0])||i[0]===this.sheetToken)){var I=!0,E=!0,R=!1,k=i.length;for(g=0;g<k;++g)if(i[g]===this.sheetToken){if(g>0&&!R)throw this.parent.getErrorStrings()[e.CommonErrors.ref];for(R=!0,g++;g<k&&this.parent.isDigit(i[g]);)g++;if(g===k||i[g]!==this.sheetToken){I=!1;break}}else{if(!E&&this.parent.isChar(i[g])){I=!1;break}if(!this.parent.isChar(i[g])&&!this.parent.isDigit(i[g])&&i[g]!==this.sheetToken){I=!1;break}E=this.parent.isUpperChar(i[g])}I&&this.parent.updateDependentCell(i)}return i}catch(e){return e}},t.prototype.indexOfAny=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return r;return-1},t.prototype.findLeftMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},t.prototype.findRightMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},t.prototype.parseFormula=function(t,r){if(t.length>0&&t[0]===this.parent.getFormulaCharacter()&&(t=t.substring(1)),t.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[e.CommonErrors.ref];t.length>0&&"+"===t[0]&&(t=t.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,t=this.parse(t.trim(),r),this.isFormulaParsed=!0}catch(e){var n=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",n),this.isFailureTriggered=!0);var i="string"==typeof n.exception?n.exception:n.message;t=(sf.base.isNullOrUndefined(this.parent.getErrorLine(e))?"":"#"+this.parent.getErrorLine(e)+": ")+i,this.isError=!0}return t},t.prototype.markLibraryFormulas=function(t){var r=0,n=t.indexOf(")");if(-1===n)t=this.markNamedRanges(t);else for(;n>-1;){for(var i=0,a=n-1;a>-1&&("("!==t[a]||0!==i);)")"===t[a]?i++:")"===t[a]&&i--,a--;if(-1===a)throw new fe(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);for(var s=a-1;s>-1&&this.parent.isChar(t[s]);)s--;var o=a-s-1,l=this.parent.substring(t,s+1,o);if(o>0&&!sf.base.isNullOrUndefined(this.parent.getFunction(l))){"AREAS"===this.parent.substring(t,s+1,o)?this.ignoreBracet=!0:this.ignoreBracet=!1;var h=this.parent.substring(t,a,n-a+1);try{var d=void 0;h=h.split("(").join("").split(")").join(""),h="("+this.formulaAutoCorrection(h,d)+")"}catch(t){if(!(d={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",d),this.isFailureTriggered=!0,r+=1),d.computeForceCalculate=r>0||d.computeForceCalculate,!d.isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(!d.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];h=h.split("(").join("").split(")").join(""),h="("+this.formulaAutoCorrection(h,d)+")"}h=this.markNamedRanges(h),h=this.swapInnerParens(h),-1===(h=this.addParensToArgs(h)).lastIndexOf(this.parent.getParseArgumentSeparator())&&h.length>2&&"("===h[0]&&")"===h[h.length-1]&&"{"!==h[1]&&"("!==h[1]&&(h=(h=h.substring(0,h.length-1)+"}"+h.substring(h.length-1))[0]+"{"+h.substring(1)),t=t.substring(0,s+1)+"q"+this.parent.substring(t,s+1,o)+h.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+t.substring(n+1)}else{if(o>0)return this.parent.getErrorStrings()[e.CommonErrors.name];var p=this.emptyStr;a>0&&(p=t.substring(0,a)),p=p+"{"+this.parent.substring(t,a+1,n-a-1)+"}",n<t.length&&(p+=t.substring(n+1)),t=p=this.markNamedRanges(p)}n=t.indexOf(")")}return t=t.split("{").join("(").split("}").join(")")},t.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},t.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var r=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===r){if(e.length>2&&"("===e[0]&&")"===e[e.length-1])if("{"!==e[1]&&"("!==e[1])e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1);else{r=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[r+1]&&"}"===e[r-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,r+1)+"{"+e.substr(r+1))}}else for(var i=!0;r>-1;){var a=this.indexOfAny(e.substring(r+1,e.length),t);a>=0?a=r+a+1:-1===a&&")"===e[e.length-1]&&(a=e.length-1),a>0&&"{"!==e[r+1]&&"}"!==e[a-1]&&(e=(e=e.substr(0,a)+"}"+e.substr(a)).substr(0,r+1)+"{"+e.substr(r+1)),r=e.substr(0,r).lastIndexOf(this.parent.getParseArgumentSeparator()),i&&-1===r&&"("===e[0]&&(r=0,i=!1)}return e=e.split("{}").join(this.emptyStr)},t.prototype.lastIndexOfAny=function(e,t){for(var r=e.length-1;r>-1;r--)if(t.indexOf(e[r])>-1)return r;return-1},t.prototype.markNamedRanges=function(e){var t=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],r=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var n=this.indexOfAny(e.substring(r),t);n>-1&&n+r<e.length;){var i=this.emptyStr,a=null;if(this.parent.substring(e,r,n).indexOf("[")>-1?a=this.getTableRange(this.parent.substring(e,r,n)):(this.parent.storedData.has(this.parent.substring(e,r,n))||this.parent.namedRanges.has(this.parent.substring(e,r,n)))&&(a=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,r,n))),sf.base.isNullOrUndefined(a)){if("NaN"!==(i=this.checkScopedRange(this.parent.substring(e,r,n))))this.findNamedRange=!0,a=i;else if(this.parent.substring(e,r,n).startsWith(this.sheetToken.toString()))this.parent.substring(e,r,n).indexOf(this.sheetToken,1);!sf.base.isNullOrUndefined(a)&&this.findNamedRange&&a.indexOf(this.fixedReference)>-1&&(a=a.split(this.fixedReference).join(this.emptyStr))}if(sf.base.isNullOrUndefined(a)||(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),a=this.markLibraryFormulas(a)),sf.base.isNullOrUndefined(a)||a===this.emptyStr)for(r+=n+1;r<e.length&&!this.parent.isUpperChar(e[r])&&e[r]!==this.sheetToken;)r++;else e=e.substring(0,r)+a+e.substring(r+n),r+=a.length+1;for(n=r,r<e.length-1&&"{"===e[r]&&(r+=1),n=this.indexOfAny(e.substring(r),t);0===n&&r<e.length-1;)r++,n=this.indexOfAny(e.substring(r),t);if((-1===n||e.substring(r).indexOf("[")>-1)&&r<e.length){if(a=e.substring(r).indexOf("[")>-1?this.getTableRange(e.substring(r)):this.parent.storedData.has(e.substring(r))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(r)):a:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(r)):a,sf.base.isNullOrUndefined(a)&&"NaN"!==(i=this.checkScopedRange(e.substring(r)))&&(a=i),!sf.base.isNullOrUndefined(a)&&a!==this.emptyStr&&(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),null!=(a=this.markLibraryFormulas(a)))){var s=e.substring(r);e=")"===s[s.length-1]?e.substring(0,r)+a+")":e.substring(0,r)+a,r+=a.toString().length+1}n=r<e.length?this.indexOfAny(e.substring(r),t):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},t.prototype.checkForNamedRangeAndKeyValue=function(e){var t=this.emptyStr;if(e.indexOf("[")>-1){var r=this.getTableRange(e);sf.base.isNullOrUndefined(r)||(this.findNamedRange=!0,e=r)}if("NaN"!==(t=this.checkScopedRange(e)))this.findNamedRange=!0,e=t;else{if(e.indexOf(this.sheetToken)>-1){var n=this.parent.getSheetFamilyItem(this.parent.grid),i=e.split('"').join(this.emptyStr);if(i=i.substr(0,i.indexOf(this.sheetToken)),n.sheetNameToToken.has(i.toUpperCase()))parseInt(n.sheetNameToToken.get(i.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(sf.base.isNullOrUndefined(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e},t.prototype.getTableRange=function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_"));this.emptyStr;return t.toUpperCase()},t.prototype.findNextEndIndex=function(e,t){for(var r=0,n=t,i=!1;!i&&t<e.length;)"["===e[n]?r++:"]"===e[n]&&0===--r&&(i=!0),t++;return t-=n},t}(),pe=(le=function(e,t){return(le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}le(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),ce=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},ue=function(t){function n(e){var r=t.call(this,null,null)||this;r.lFormulas=new Map,r.storedData=new Map,r.keyToRowsMap=new Map,r.rowsToKeyMap=new Map,r.rightBracket=String.fromCharCode(161),r.leftBracket=String.fromCharCode(162),r.sheetToken="!",r.emptyString="",r.leftBrace="{",r.rightBrace="}",r.cell=r.emptyString,r.cellPrefix="!0!A",r.treatEmptyStringAsZero=!1,r.tic='"',r.singleTic="'",r.trueValue="TRUE",r.falseValue="FALSE",r.parseDecimalSeparator=".",r.arithMarker=String.fromCharCode(180),r.arithMarker2=r.arithMarker+r.arithMarker,r.dependentCells=null,r.dependentFormulaCells=null,r.minValue=Number.MIN_SAFE_INTEGER,r.maxValue=Number.MAX_SAFE_INTEGER,r.categoryCollection=["All"],r.dependencyLevel=0,r.refreshedCells=new Map,r.computedValues=null,r.randomValues=new Map,r.isRandomVal=!1,r.randCollection=[],r.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator"],r.errorStrings=null,r.parseArgumentSeparator=",",r.dateTime1900=new Date(1900,0,1,0,0,0),r.isParseDecimalSeparatorChanged=!1,r.isArgumentSeparatorChanged=!1,r.sheetFamilyID=0,r.defaultFamilyItem=null,r.sheetFamiliesList=null,r.modelToSheetID=null,r.tokenCount=0,r.sortedSheetNames=null,r.tempSheetPlaceHolder=String.fromCharCode(133),r.namedRanges=new Map,r.formulaInfoTable=null,r.oaDate=new Date(1899,11,30),r.millisecondsOfaDay=864e5,r.parseDateTimeSeparator="/";var n=new oe(r);return r.includeBasicFormulas&&i.Inject(he),r.injectedModules&&r.injectedModules.length&&n.inject(r.requiredModules(),r.injectedModules),r.parentObject=sf.base.isNullOrUndefined(e)?r:e,r.grid=r.parentObject,r.parser=new de(r),r}var i;return pe(n,t),i=n,Object.defineProperty(n.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})},enumerable:!0,configurable:!0}),n.prototype.getParseArgumentSeparator=function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator},n.prototype.setParseArgumentSeparator=function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0},n.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},n.prototype.setTreatEmptyStringAsZero=function(e){this.treatEmptyStringAsZero=e},n.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},n.prototype.setParseDateTimeSeparator=function(e){this.parseDateTimeSeparator=e},n.prototype.requiredModules=function(){return re(this)},n.Inject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(var r=0;r<e.length;r++)-1===this.prototype.injectedModules.indexOf(e[r])&&this.prototype.injectedModules.push(e[r])},n.prototype.getInjectedModules=function(){return this.injectedModules},n.prototype.onPropertyChanged=function(e,t){},n.prototype.getModuleName=function(){return"calculate"},n.prototype.getFormulaCharacter=function(){return"="},n.prototype.isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},n.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},n.prototype.updateDependentCell=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.cell;if(r!==this.emptyString){if(null!==t.sheetNameToParentObject){var n=t.parentObjectToToken.get(this.grid);-1===r.indexOf(this.sheetToken)&&(r=n+r),-1===e.indexOf(this.sheetToken)&&(e=n+e)}if(this.getDependentCells().has(e)){var i=this.getDependentCells().get(e);i.indexOf(r)<0&&i.push(r)}else this.getDependentCells().set(e,[r]);this.addToFormulaDependentCells(e)}},n.prototype.addToFormulaDependentCells=function(e){var t=this.cell,r=this.getSheetFamilyItem(this.grid);null!=r.sheetNameToParentObject&&-1===t.indexOf(this.sheetToken)&&(t=r.parentObjectToToken.get(this.grid)+t);this.getDependentFormulaCells().has(t)?this.getDependentFormulaCells().get(t).has(e)||this.getDependentFormulaCells().get(t).set(e,e):(this.getDependentFormulaCells().set(t,new Map),this.getDependentFormulaCells().get(t).set(e,e))},n.prototype.getDependentCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentCells&&(e.sheetDependentCells=new Map),e.sheetDependentCells}return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},n.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},n.prototype.getLibraryFormulas=function(){return this.lFormulas},n.prototype.getFunction=function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null},n.prototype.intToDate=function(e){var t=Number(e);return(t=t>0&&t<1?1+t:0===t?1:t)>60&&(t-=1),new Date(864e5*(t-1)+new Date("01/01/1900").getTime())},n.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},n.prototype.getFormula=function(e){return e=e.toUpperCase(),this.storedData.has(e)?this.storedData.get(e).getFormulaText():""},n.prototype.getParseDecimalSeparator=function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator},n.prototype.setParseDecimalSeparator=function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0},n.prototype.getSheetToken=function(t){var r=0,n=this.emptyString;if(r<t.length&&t[r]===this.sheetToken){for(r++;r<t.length&&t[r]!==this.sheetToken;)r++;n=t.substring(0,r+1)}if(r<t.length)return n;throw this.formulaErrorStrings[e.FormulasErrorsStrings.bad_index]},n.prototype.getSheetID=function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var r=t.parentObjectToToken.get(e);r=r.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(r);if(!this.isNaN(n))return n}return-1},n.prototype.parseFloat=function(e){return Number(e)},n.prototype.rowIndex=function(t){var r,n=0,i=!1;if(n<t.length&&t[n]===this.sheetToken){for(n++;n<t.length&&t[n]!==this.sheetToken;)n++;n++}for(;n<t.length&&this.isChar(t[n]);)i=!0,n++;if(r=parseInt(t.substring(n),10),n<t.length&&!this.isNaN(r))return r;if(i)return-1;throw this.formulaErrorStrings[e.FormulasErrorsStrings.bad_index]},n.prototype.colIndex=function(e){var t=0,r=0;if(t<(e=e.toUpperCase()).length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);){r=26*r+e[t].charCodeAt(0)-64,t++}return 0===r?-1:r},n.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings},n.prototype.substring=function(e,t,r){return e.substring(t,r+t)},n.prototype.isChar=function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122},n.prototype.getSheetFamilyItem=function(e){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new me),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);var t=this.modelToSheetID.get(e);return this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new me),this.sheetFamiliesList.get(t)},n.prototype.setKeyValue=function(e,t){e=e.toUpperCase();var r=t.toString().trim();this.storedData.get(e)&&0!==r.indexOf(this.leftBrace)||(this.storedData.set(e,new ge),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==r){var i=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(i)&&this.clearFormulaDependentCells(i)}r.length>0&&r[0]===this.getFormulaCharacter()?n.setFormulaText(r):n.getFormulaValue()!==r&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(r))},n.prototype.clearFormulaDependentCells=function(e){var t=this,r=this.getDependentFormulaCells().get(e);null!=r&&(r.forEach((function(r,n){var i=n,a=t.getDependentCells().get(i);t.arrayRemove(a,e),0===a.length&&t.getDependentCells().delete(i)})),this.getDependentFormulaCells().delete(e))},n.prototype.arrayRemove=function(e,t){var r=e.indexOf(t);return-1!==r&&e.splice(r,1),e},n.prototype.getKeyValue=function(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){var t=this.storedData.get(e),r=t.getFormulaText();if(r.length>0&&r[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),r=r.substring(1);try{t.setParsedFormula(this.parser.parseFormula(r,e))}catch(r){var n={message:r.message,exception:r,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",n),t.setFormulaValue(n.message),this.storedData.get(e).getFormulaValue()}try{t.setFormulaValue(this.computeFormula(t.getParsedFormula()))}catch(e){n={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",n);var i="string"==typeof n.exception?n.exception:n.message;return(sf.base.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+i}}return this.storedData.get(e).getFormulaValue()}return this.emptyString},n.prototype.getNamedRanges=function(){return this.namedRanges},n.prototype.addNamedRange=function(e,t){var r=e.split(this.sheetToken);if(r.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(r[0]))return!1;e=r[0]+this.sheetToken+r[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0},n.prototype.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)},n.prototype.convertAlpha=function(e){for(var t=[],r=0;e>0;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],a=0;a<r;a++)i[r-a-1]=t[a];return i.join("")},n.prototype.getCellCollection=function(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}var t=this.emptyString,r=e.indexOf(this.sheetToken);if(r>-1)for(var n=r+1;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}var i,a,s,o,l=e.indexOf(":");if(l>0&&this.isChar(e[l-1]))for(var h=l-2;h>=0&&this.isDigit(e[h]);)h--;i=this.rowIndex(this.substring(e,0,l)),a=this.rowIndex(this.substring(e,l+1,l+e.length-l-1)),s=this.colIndex(this.substring(e,0,l)),o=this.colIndex(this.substring(e,l+1,l+e.length-l-1)),i>a&&(l=a,a=i,i=l),s>o&&(l=o,o=s,s=l);var d,p=[],c=0;for(l=i;l<=a;l++)for(d=s;d<=o;d++)p[c]=t+this.emptyString+this.convertAlpha(d)+l.toString(),c++;return p},n.prototype.computeFormula=function(t){var r,n,i,a,s=!1;if(this.parser.isError)return t;r=this.parser.isFormulaParsed?t:this.parser.parseFormula(t),this.parser.isFormulaParsed=!1;try{if((n=this.findLastIndexOfq(r))>0&&(s=!0),r!==this.emptyString&&n>-1)for(var o=n+1;o>-1;)if(r[o]===this.rightBracket){var l=r.substring(n,o+1),h=l.split(this.leftBracket)[0].split("q").join(this.emptyString),d=l.substring(l.indexOf(this.leftBracket)+1,l.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());if(this.getLibraryFormulas().get(h.toUpperCase()).isCustom){var p=0,c=[];for(p=0;p<d.length;p++)c.push(this.getValueFromArg(d[p]));d=c}if(i=sf.base.isNullOrUndefined(this.getFunction(h))?this.getErrorStrings()[e.CommonErrors.name]:this.getFunction(h).apply(void 0,d),!s)break;a=this.processNestedFormula(r,l,i);var u=this.findLastIndexOfq(a);0===u&&(s=!1),-1===u&&(i=this.computeValue(a)),n=o=u,r=a}else o++;else this.formulaErrorStrings.indexOf(r)>-1?i=r:r!==this.emptyString&&-1===n&&(i=this.computeValue(r))}catch(e){d={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",d);var f="string"==typeof d.exception?d.exception:d.message;i=(sf.base.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+f}return i},n.prototype.computeSumIfAndAvgIf=function(t){if(sf.base.isNullOrUndefined(t)||t[0]===this.emptyString||0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var r=t,n=0;n<r.length;n++)if(this.isCellReference(r[n])&&sf.base.isNullOrUndefined(r[n].match(/[0-9]/))&&r[n].indexOf("!")<0){var i=r[n].split(":");r[n]=i[0]+"1:"+i[1]+this.spreadSheetUsedRange[0]}var a=r.length;if(2!==a&&3!==a&&0===a)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=r[0],o=r[1].trim();if((o=o.split(this.tic).join(this.emptyString)).length>255)return this.getErrorStrings()[e.CommonErrors.value];o=this.isCellReference(o)?this.getValueFromArg(o):o;var l=this.parser.tokenEqual;o.startsWith("<=")?(l=this.parser.tokenLessEq,o=o.substring(2)):o.startsWith(">=")?(l=this.parser.tokenGreaterEq,o=o.substring(2)):o.startsWith("<>")?(l=this.parser.tokenNotEqual,o=o.substring(2)):o.startsWith("<")?(l=this.parser.tokenLess,o=o.substring(1)):o.startsWith(">")?(l=this.parser.tokenGreater,o=o.substring(1)):o.startsWith("=")&&(l=this.parser.tokenEqual,o=o.substring(1));var h=this.parseFloat(o),d=r[0],p=this.getCellCollection(a>2?r[2]:s),c=this.getCellCollection(d),u=this.getComputeSumIfValue(c,p,o,h,l);return[u[0],u[1]]},n.prototype.computeLookup=function(t){if(0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var r=[],n=[],i=t,a=i.length,s=i[0].split(this.tic).join(this.emptyString),o=i[1],l=2===a?o:i[2],h=this.getCellCollection(i[1]),d=this.getCellCollection(l),p=0;p<h.length;p++)n[p]=this.getValueFromArg(h[p]).split(this.tic).join("");for(var c=n.toString().split(this.getParseArgumentSeparator()),u=this.parseFloat(c[c.sort().length-1]),f=this.parseFloat(c[0]),g=0;g<h.length;g++){if(r[g]=this.getValueFromArg(h[g]).split(this.tic).join(""),s===r[g])return this.getValueFromArg(d[g]).split(this.tic).join("");if(this.parseFloat(s)===this.parseFloat(r[g]))return this.getValueFromArg(d[g]).split(this.tic).join("");if(this.parseFloat(s)<f)return this.getErrorStrings()[e.CommonErrors.na];if(this.parseFloat(s)>u){var m=n.indexOf(u.toString());return this.getValueFromArg(d[m]).split(this.tic).join("")}}if(n.indexOf(s)<0){for(var v=[],y=0;y<c.length;y++)this.parseFloat(s)>this.parseFloat(c[y])&&v.push(c[y]);m=n.indexOf(v[v.length-1]);return this.getValueFromArg(d[m]).split(this.tic).join("")}return this.getErrorStrings()[e.CommonErrors.na]},n.prototype.computeVLookup=function(t){var r=t,n=[],i=r[0].split(this.tic).join("");if(i.indexOf(":")>-1)return this.getErrorStrings()[e.CommonErrors.value];if(this.isCellReference(i)&&(i=this.getValueFromArg(i)),r[1].indexOf(":")<-1)return this.getErrorStrings()[e.CommonErrors.na];var a=[],s="",o="";if(this.isCellReference(r[1])&&(a=this.getCellCollection(r[1]),r[1].indexOf(":")>-1)){for(var l=r[1].indexOf(":"),h=0;h<l;h++){s+=this.isChar(r[1][h])?r[1][h]:""}for(var d=l;d<r[1].length;d++){o+=this.isChar(r[1][d])?r[1][d]:""}}var p=this.colIndex(s)+this.parseFloat(r[2]);if(p>this.colIndex(o))return this.getErrorStrings()[e.CommonErrors.na];if(p===this.colIndex(s))return this.getErrorStrings()[e.CommonErrors.na];var c=this.convertAlpha(p);r[3]=sf.base.isNullOrUndefined(r[3])?this.trueValue:r[3].split(this.tic).join("");var u="";for(h=0;h<a.length;h++)n[h]=this.getValueFromArg(a[h]).split(this.tic).join("");var f=n.toString().split(this.getParseArgumentSeparator()),g=this.parseFloat(f[f.sort().length-1]),m=this.parseFloat(f[0]);for(d=0;d<a.length;d++){if(u=this.getValueFromArg(a[d]),r[3].toUpperCase()===this.trueValue){if(i===u)return this.getValueFromArg(c+d).split(this.tic).join("");if(this.parseFloat(i)===this.parseFloat(u))return this.getValueFromArg(c+d).split(this.tic).join("");if(this.parseFloat(i)<m)return this.getErrorStrings()[e.CommonErrors.na];if(this.parseFloat(i)>g){l=n.indexOf(g.toString());return this.getValueFromArg(c+l).split(this.tic).join("")}}if(r[3]===this.falseValue&&i===u)return this.getValueFromArg(c+d)}return this.getErrorStrings()[e.CommonErrors.na]},n.prototype.findWildCardValue=function(e,t){var r="";if(e.indexOf("?")>-1){var n=e.indexOf("?"),i=e[n-1],a=e[n+1];if(t.indexOf(i)>-1&&t.indexOf(a)>-1){var s=t.indexOf(i);r=t[s]===i&&t[s+2]===a?e:t}else r=t}else if(e.indexOf("*")>-1){n=e.indexOf("*");for(var o="",l="",h=this.falseValue,d=this.falseValue,p=n-1;p>=0;p--)o+=e[p],d=this.trueValue;for(p=n+1;p<e.length;p++)l+=e[p],h=this.trueValue;var c=""===o?-1:t.indexOf(o.split("").reverse().join("")),u=""===l?-1:t.indexOf(l);c>-1||u>-1?d===this.trueValue?r=o.split("").reverse().join("")===t.substr(0,o.length)?e:t:h===this.trueValue&&(r=l===t.substring(t.length-l.length,t.length)?e:t):r=t}return r},n.prototype.getComputeSumIfValue=function(e,t,r,n,i){var a=0,s=0;switch(i){case this.parser.tokenEqual:for(var o=0;o<e.length;o++){var l=this.getValueFromArg(e[o].split(this.tic).join("")),h=this.parseFloat(l);if(l===r&&h===n){var d=this.getValueFromArg(t[o].split(this.tic).join(""));a+=this.parseFloat(d),s+=1}else if(l===r){var p=t[o];p=this.getValueFromArg(p),a=this.parseFloat(p.toString()),s+=1}}break;case this.parser.tokenLess:for(o=0;o<e.length;o++){l=this.getValueFromArg(e[o].split(this.tic).join(""));if((h=this.parseFloat(l))<n){d=this.getValueFromArg(t[o].split(this.tic).join(""));a+=this.parseFloat(d),s+=1}}break;case this.parser.tokenGreater:for(o=0;o<e.length;o++){l=this.getValueFromArg(e[o].split(this.tic).join(""));if((h=this.parseFloat(l))>n){d=this.getValueFromArg(t[o].split(this.tic).join(""));a+=this.parseFloat(d),s+=1}}break;case this.parser.tokenLessEq:for(o=0;o<e.length;o++){l=this.getValueFromArg(e[o].split(this.tic).join(""));if((h=this.parseFloat(l))<=n){d=this.getValueFromArg(t[o].split(this.tic).join(""));a+=this.parseFloat(d),s+=1}}break;case this.parser.tokenGreaterEq:for(o=0;o<e.length;o++){l=this.getValueFromArg(e[o].split(this.tic).join(""));if((h=this.parseFloat(l))>=n){d=this.getValueFromArg(t[o].split(this.tic).join(""));a+=this.parseFloat(d),s+=1}}break;case this.parser.tokenNotEqual:for(o=0;o<e.length;o++){l=this.getValueFromArg(e[o].split(this.tic).join("")),h=this.parseFloat(l);if(l!==r&&h!==n){d=this.getValueFromArg(t[o].split(this.tic).join(""));a+=this.parseFloat(d),s+=1}}}return[a,s]},n.prototype.computeAndOr=function(t,r){var n,i,a="and"===r;if(0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=0,o=t.length;s<o;s++)if(t[s].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[e.CommonErrors.value];for(var l=t,h=0;h<l.length;h++){if(l[h]===this.tic)return this.getErrorStrings()[e.CommonErrors.value];if(l[h].indexOf(":")>-1&&this.isCellReference(l[h]))for(var d=this.getCellCollection(l[h]),p=0;p<d.length;p++){if(this.getErrorStrings().indexOf(d[p])>-1)return d[p];if(d[p][0]===this.tic)return this.getErrorStrings()[e.CommonErrors.name];if(""===(n=this.getValueFromArg(d[p]))&&(n=this.trueValue),this.getErrorStrings().indexOf(n)>-1)return n;i=this.parseFloat(n)}else{if(n=this.getValueFromArg(l[h]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(n)>-1)return n;var c=Date.parse(n.split(this.tic).join(""));if(isNaN(c)){if(n!==this.trueValue&&n!==this.falseValue)return this.getErrorStrings()[e.CommonErrors.value].toString()}else a=!0;i=this.parseFloat(n)}a="and"===r?a&&(n===this.trueValue||!isNaN(i)):a||n===this.trueValue||!isNaN(i)}return a?this.trueValue:this.falseValue},n.prototype.removeTics=function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e},n.prototype.getCellFrom=function(e){var t,r="",n=e.indexOf(":")>-1?e.split(":"):[e],i=n.length-1,a=this.rowIndex(n[0]);if(a===this.rowIndex(n[i])){var s=this.colIndex(n[0]),o=this.colIndex(n[i]),l=this.colIndex(this.cell);l>=s&&l<=o&&(r=ve(l).toString()+a.toString())}else if(this.colIndex(n[0])===this.colIndex(n[i])){t=this.colIndex(n[0]);var h=this.rowIndex(n[i]),d=this.rowIndex(this.cell);d>=a&&d<=h&&(r=ve(t).toString()+d.toString())}return r},n.prototype.computeValue=function(t){try{var r=[],n=0,i="";for(r.length=0;n<t.length;){var a="u"===t[n];if(t[n]!==this.arithMarker){if(this.isDigit(t[n])){for(var s=this.emptyString;n<t.length&&(this.isDigit(t[n])||t[n]===this.parseDecimalSeparator);)s+=t[n],n+=1;r.push(s)}if(t[n]===this.sheetToken){for(i=t[n],n+=1;n<t.length&&t[n]!==this.sheetToken;)i+=t[n],n+=1;n<t.length&&(i+=t[n],n+=1)}else if(this.isUpperChar(t[n])){var o;for(s=this.emptyString;n<t.length&&this.isUpperChar(t[n]);){s+=t[n],n+=1}for(;n<t.length&&this.isDigit(t[n]);){s+=t[n],n+=1}if(n<t.length&&":"===t[n]){if(s+=t[n],(n+=1)<t.length&&t[n]===this.sheetToken)for(s+=t[n],n+=1;n<t.length&&t[n]!==this.sheetToken;)s+=t[n],n+=1;for(;n<t.length&&this.isUpperChar(t[n]);)s+=t[n],n+=1;for(;n<t.length&&this.isDigit(t[n]);)s+=t[n],n+=1;s=i+this.getCellFrom(s)}else s=i+s;if("string"==typeof(o=this.getParentObjectCellValue(s).toString())&&this.getErrorStrings().indexOf(o)>-1)return o;r.push(o)}else if("q"===t[n]){var l=t.substring(n+1).indexOf(this.leftBracket),h=t.substring(n+l+1).indexOf(this.rightBracket);t=this.substring(t,n+l+2,h-1)}else if(t[n]===this.tic[0]){s=t[n].toString();for(n+=1;n<t.length&&t[n]!==this.tic[0];)s+=t[n],n+=1;r.push(s.split(this.tic).join(this.emptyString)),n+=1}else if("%"===t[n]&&r.length>0){var d=r[0],p=this.parseFloat(d);this.isNaN(p)||(r.pop(),r.push((p/100).toString())),n+=1}else if(0===t.substring(n).indexOf(this.trueValue))r.push(this.trueValue),n+=this.trueValue.length;else if(0===t.substring(n).indexOf(this.falseValue))r.push(this.falseValue),n+=this.falseValue.length;else if(t[n]===this.tic[0]||"|"===t[n]){s=t[n].toString();for(n++;n<t.length&&t[n]!==this.tic[0];)s+=t[n],n+=1;r.push(s+this.tic),n+=1}else switch(t[n]){case"#":var c=0;this.getErrorStrings().indexOf(t.substring(n))>-1?(c=-1===t.indexOf("!")||-1===t.substring(n).indexOf("!")?t.indexOf("#N/A")>-1?t.indexOf("#N/A")+4+n:t.indexOf("?")+1+n:t.indexOf("!")+1+n,r.push(this.substring(t,n,c-n))):(c=n+1,r.push(this.substring(t,n,c-n))),n=c;break;case"n":n+=1;s="";if(0===t.substring(n).indexOf("Infinity"))n+=(s="Infinity").length;else{for(("u"===t[n]||a)&&(s="-",a?a=!1:n+=1);n<t.length&&this.isDigit(t[n])||t[n]===this.getParseDecimalSeparator();)s+=t[n],n+=1;if(n<t.length&&"%"===t[n])if(n+=1,""===s){if(r.length>0){d=r[0],p=this.parseFloat(d);this.isNaN(p)||(r.pop(),r.push((p/100).toString()))}}else s=(this.parseFloat(s)/100).toString()}r.push(s);break;case this.parser.tokenAdd:this.getValArithmetic(r,"add"),n+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(r,"sub"),n+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(r,"mul"),n+=1;break;case this.parser.tokenDivide:this.getValArithmetic(r,"div"),n+=1;break;case this.parser.tokenLess:this.processLogical(r,"less"),n+=1;break;case this.parser.tokenGreater:this.processLogical(r,"greater"),n+=1;break;case this.parser.tokenGreaterEq:this.processLogical(r,"greaterEq"),n+=1;break;case this.parser.tokenLessEq:this.processLogical(r,"lessEq"),n+=1;break;case this.parser.tokenNotEqual:this.processLogical(r,"notEq"),n+=1;break;case this.parser.tokenOr:this.processLogical(r,"or"),n+=1;break;case this.parser.tokenAnd:this.processLogical(r,"and"),n+=1;break;case this.parser.tokenEqual:this.processLogical(r,"equal"),n+=1;break;default:return this.getErrorStrings()[e.CommonErrors.value]}}else n+=1}if(0===r.length)return this.emptyString;s=this.emptyString;for(var u=r.length;u>0;){if((s=r.pop()+s)===this.emptyString&&this.isCellReference(t)&&this.getTreatEmptyStringAsZero())return"0";u--}return s}catch(t){if(this.getErrorStrings().indexOf(t)>-1||this.formulaErrorStrings.indexOf(t)>-1)throw t;throw new fe(this.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression])}},n.prototype.getValArithmetic=function(t,r){var n=t.pop();n=n===this.emptyString?"0":n;var i=Number(n);if(isNaN(i))throw n===this.getErrorStrings()[e.CommonErrors.divzero]?this.getErrorStrings()[e.CommonErrors.divzero]:this.getErrorStrings()[e.CommonErrors.value];var a=t.pop();if(a=a===this.emptyString?t.length?t.pop():"0":a,i=Number(a),isNaN(i))throw n===this.getErrorStrings()[e.CommonErrors.divzero]?this.getErrorStrings()[e.CommonErrors.divzero]:this.getErrorStrings()[e.CommonErrors.value];"add"===r&&t.push((Number(a)+Number(n)).toString()),"sub"===r&&t.push((Number(a)-Number(n)).toString()),"mul"===r&&t.push((Number(a)*Number(n)).toString()),"div"===r&&(this.isNaN(this.parseFloat(n))||this.isNaN(this.parseFloat(a))?t.push(this.getErrorStrings()[e.CommonErrors.value]):0===this.parseFloat(n)?t.push(this.getErrorStrings()[e.CommonErrors.divzero]):t.push((Number(a)/Number(n)).toString()))},n.prototype.processLogical=function(e,t){var r,n,i,a,s;return"and"!==t&&"equal"!==t&&(r=e.pop(),n=e.pop(),i=r.indexOf(this.tic)>-1?r:this.parseFloat(r),a=n.indexOf(this.tic)>-1?n:this.parseFloat(n)),"less"===t&&(s=this.isNaN(i)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:a<i?this.trueValue:this.falseValue),"greater"===t&&(s=this.isNaN(i)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:a>i?this.trueValue:this.falseValue),"lessEq"===t&&(s=this.isNaN(i)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:a<=i?this.trueValue:this.falseValue),"greaterEq"===t&&(s=this.isNaN(i)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:a>=i?this.trueValue:this.falseValue),"notEq"===t&&(s=n!==r?this.trueValue:this.falseValue),"and"===t&&(r=e.pop().toString(),n="",e.length>0&&(n=e.pop().toString()),s=(s=this.emptyString+n+r+this.emptyString).split(this.tic).join("")),"equal"===t&&(r=e.pop().toString(),""===(n=e.pop().toString())&&""!==r&&(n="0"),s=r===n?this.trueValue:this.falseValue),"or"===t&&(s=Math.pow(this.parseFloat(a),this.parseFloat(i)).toString()),e.push(s),s},n.prototype.computeStoreCells=function(e){for(var t=e.cellValue,r=e.cellRange,n=e.criteria,i=e.argArray,a=e.isCriteria,s=e.storedCells,o=e.isCountIfS,l=e.countVal,h=a===this.trueValue?s:t,d=[],p=0;p<h.length;p++){var c=[],u=this.getValueFromArg(t[p]),f=void 0,g="";if(f=i[2].split(this.tic).join(this.emptyString),f=this.isCellReference(f)?this.getValueFromArg(f):f,(a=o===this.trueValue?this.trueValue:a)===this.trueValue){var m,v=0,y=0;for(s[p]=o===this.trueValue&&0===l?t[p]:s[p],m=s[p];!this.isDigit(m[v]);)v+=1;if(this.isCellReference(r[l])&&r[l].indexOf(":")>-1){var C=r[l].indexOf(":");for(g=this.substring(r[l],C);!this.isDigit(g[y]);)y+=1}var b=this.substring(m,v),S=this.substring(g,y);g=s[p].split(b).join(S),u=this.getValueFromArg(g),f=o===this.trueValue?n[l].split(this.tic).join(this.emptyString):n[l-1].split(this.tic).join(this.emptyString)}var x="equal";f.startsWith("<=")?(x="lessEq",f=f.substring(2)):f.startsWith(">=")?(x="greaterEq",f=f.substring(2)):f.startsWith("<>")?(x="notEq",f=f.substring(2)):f.startsWith("<")?(x="less",f=f.substring(1)):f.startsWith(">")?(x="greater",f=f.substring(1)):f.startsWith("=")&&(x="equal",f=f.substring(1)),(f.indexOf("*")>-1||f.indexOf("?")>-1)&&(u=this.findWildCardValue(f,u)),c.push(u.toLowerCase()),c.push(f.toLowerCase()),this.processLogical(c,x)===this.trueValue&&(a===this.falseValue?d.push(t[p]):d.push(g))}return s=d,d=[],s},n.prototype.computeIfsFormulas=function(t,r,n){if(sf.base.isNullOrUndefined(t)||""===t[0]||0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=t,a=i.length;if(a<2||a>127)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=[],o=[],l=[],h=0,d=0;d<i.length;d++)i[d].indexOf(":")>-1&&this.isCellReference(i[d])?s.push(i[d]):o.push(i[d]);s=(s=s.toString().split(",,").join(",")).split(this.getParseArgumentSeparator());var p,c,u=[];for(d=0;d<s.length;d++)u.push(this.getCellCollection(s[d]).length);for(var f=0;f<u.length;f++)if(u[f]&&u[f+1]&&u[f]!==u[f+1])return this.getErrorStrings()[e.CommonErrors.value];if(r===this.falseValue){c=this.falseValue;var g={cellValue:p=this.getCellCollection(s[1]),cellRange:s,criteria:o,argArray:i,isCriteria:c,storedCells:l,isCountIfS:r};if(0===(l=this.computeStoreCells(g)).length)return 0}for(d=r===this.trueValue?0:2;d<s.length;d++){c=this.trueValue,c=r===this.trueValue&&0===d?this.falseValue:this.trueValue;g={cellValue:p=this.getCellCollection(s[d]),cellRange:s,criteria:o,argArray:i,isCriteria:c,storedCells:l,isCountIfS:r,countVal:d};if(0===(l=this.computeStoreCells(g)).length)return 0}for(f=0;f<l.length;f++){var m,v="",y=0,C=0;for(m=l[f];!this.isDigit(m[y]);)y+=1;if(this.isCellReference(s[0])&&s[0].indexOf(":")>-1){var b=s[0].indexOf(":");for(v=this.substring(s[0],b);!this.isDigit(v[C]);)C+=1}var S=this.substring(m,y),x=this.substring(v,C);if(p=l[f].split(S).join(x),r===this.trueValue)h+=1;else{var w=this.getValueFromArg(p);h+=parseFloat(""===w?"0":w)}}return n===this.trueValue&&(h/=p.length),h},n.prototype.processNestedFormula=function(e,t,r){this.findLastIndexOfq(e);return e.split(t).join("n"+r)},n.prototype.isNaN=function(e){return"NaN"===e.toString()||"string"==typeof e},n.prototype.fromOADate=function(e){var t=new Date;return t.setTime(e*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),t},n.prototype.getSerialDateFromDate=function(e,t,r){var n=0;e<1900&&(e+=1900);for(var i=!1;!i;){for(;t>12;)e++,t-=12;i=!0;for(var a=new Date(e,t,1,-1).getDate();r>a;)a=new Date(e,t,1,-1).getDate(),t++,r-=a,i=!1;r<1&&(t--,r=(a=new Date(e,t,1,-1).getDate())-r)}var s=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+r.toString());return this.isNaN(s)||(n=this.toOADate(new Date(s))),n},n.prototype.toOADate=function(e){return(e.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay},n.prototype.calculateDate=function(e){return this.parseFloat(e)<10?"0"+e:e},n.prototype.isTextEmpty=function(e){return null===e||""===e},n.prototype.isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},n.prototype.findLastIndexOfq=function(e){return e.lastIndexOf("q")},n.prototype.getValueFromArg=function(t){var r=t=t.trim(),n=this.dateTime1900,i=r;if(sf.base.isNullOrUndefined(r)||this.isTextEmpty(r))return r;if(t[0]===this.tic||t[0]===this.singleTic)return n=this.isDate(t.split(this.tic).join("")),this.isNaN(this.parseFloat(t.split(this.tic).join("")))&&!sf.base.isNullOrUndefined(n)&&!this.isNaN(n.getDate())&&this.dateTime1900<=n?this.toOADate(n).toString():t;if(t=t.split("u").join("-"),!this.isUpperChar(r[0])&&(this.isDigit(r[0])||r[0]===this.getParseDecimalSeparator()||"-"===r[0]||"n"===r[0]))return"n"===r[0]&&(r=r.substring(1)).indexOf('"n')>-1&&(r=r.replace('"n','"')),r;if(-1===this.parser.indexOfAny(r,["+","-","/","*",")",")","{"])&&this.isUpperChar(r[0])||r[0]===this.sheetToken){if(r!==this.trueValue&&r!==this.falseValue&&this.isCellReference(r)){var a=this.getSheetFamilyItem(this.grid);if(null!==a.sheetNameToParentObject&&a.sheetNameToParentObject.size>0&&-1===r.indexOf(this.sheetToken))r=a.parentObjectToToken.get(this.grid)+r}if(r===this.cell){var s=this.getDependentCells().get(r);throw null!=s&&s.indexOf(r)>-1&&this.arrayRemove(s,r),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),this.formulaErrorStrings[e.FormulasErrorsStrings.circular_reference]+r}return i=this.getParentObjectCellValue(r),this.updateDependentCell(r),i.toString()}return this.getErrorStrings().indexOf(t)>-1?t:this.computeValue(i.toString())},n.prototype.isDate=function(e){if("object"===r(e)||null!==Date.parse(e)){var t=new Date(Date.parse(e));return t>=this.dateTime1900?t:null}return null},n.prototype.isValidCellReference=function(e){var t=0,r=0,n=[89,71,69],i=this.emptyString;if(this.namedRanges.has(e))return!1;for(var a=0;a<e.length;a++)this.isChar(e[a])&&t++;if((i=e.substring(0,t)).length<4){for(;r<i.length;){if(sf.base.isNullOrUndefined(i[r])||!(i[r].charCodeAt(0)<n[r])){if(sf.base.isNullOrUndefined(i[r])&&r>0)break;return!1}r++}if(this.parseFloat(e.substring(t,e.length))<1048576)return!0}return!1},n.prototype.parseDate=function(t){if(!this.isNaN(t)){if(t instanceof Date)return new Date(t);var r=parseInt(t,10);return r<0?this.getErrorStrings()[e.CommonErrors.num]:r<=60?new Date(this.dateTime1900.getTime()+864e5*(r-1)):new Date(this.dateTime1900.getTime()+864e5*(r-2))}return"string"!=typeof t||(t=new Date(t),this.isNaN(t))?this.getErrorStrings()[e.CommonErrors.value]:t},n.prototype.isCellReference=function(e){if(e===this.emptyString)return!1;e=e.trim(),e=this.setTokensForSheets(e);var t=this.getSheetToken(e),r=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,i=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var a=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),s=0;s<a.length;s++)if(this.isChar(a[s]))n=!0;else if(this.isDigit(a[s]))i=!0;else{if(":"!==a[s])return!1;n&&i&&(r=!0),n=!1,i=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(r&&n&&i)||!(!(n&&!i||!n&&i)||r):!(!n||!i||-1!==e.indexOf(this.tic))},n.prototype.setTokensForSheets=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.getSortedSheetNames();if(null!=r)for(var n=0;n<r.length;n++){var i=t.sheetNameToToken.get(r[n]);i=i.split(this.sheetToken).join(this.tempSheetPlaceHolder);var a=this.singleTic+"SHEET"+r[n]+this.singleTic+this.sheetToken;-1===e.indexOf(a)&&(a="SHEET"+r[n]+this.sheetToken),e=e.split(a).join(i),a=r[n]+this.sheetToken,e=e.split(a).join(i)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var s=(e=e.replace("!!","!")).split("");s[1]=(parseInt(s[1],10)+1).toString(),e=s.join("")}return e},n.prototype.getParentObjectCellValue=function(t){if(t===this.trueValue||t===this.falseValue)return t;var r=t.lastIndexOf(this.sheetToken),n=0,i=0,a=this.grid,s=this.getSheetFamilyItem(a);if(r>-1&&null!==s.tokenToParentObject)this.grid=s.tokenToParentObject.get(t.substring(0,r+1)),n=this.rowIndex(t),i=this.colIndex(t);else if(-1===r){for(var o=0;o<t.length&&this.isChar(t[o]);)o++;if(o===t.length)return""===(t=t.toLowerCase())?this.getErrorStrings()[e.CommonErrors.value]:this.getErrorStrings()[e.CommonErrors.name];n=this.rowIndex(t),i=this.colIndex(t),s.isSheetMember&&null!=s.parentObjectToToken&&(t=s.parentObjectToToken.get(this.grid)+t)}var l=""===this.cell||null===this.cell?"":this.cell;if(this.cell=t,l===this.cell)throw this.formulaErrorStrings[e.FormulasErrorsStrings.circular_reference];var h=this.getParentCellValue(n,i,this.grid);return this.grid=a,this.cell=l,h},n.prototype.getParentCellValue=function(e,t,r){var n;return void 0!==this.parentObject.getValueRowCol?(n=this.parentObject.getValueRowCol(this.getSheetID(r),e,t),sf.base.isNullOrUndefined(n)?this.emptyString:n.toString()):(""!==(n=this.getValueRowCol(this.getSheetID(r),e,t))&&void 0!==n||(n=""),n)},n.prototype.getValueRowCol=function(e,t,r){var n=this.rowsToKeyMap.get(t).toString(),i=this.getKeyValue(n).toString();if(null!=i&&"%"===i[i.length-1]&&i.length>1){var a=this.parseFloat(i.substring(0,i.length-1));this.isNaN(a)&&(i=(Number(a)/100).toString())}return i},n.prototype.defineFunction=function(e,t){"string"==typeof t&&(t=sf.base.getValue(t,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:t,isCustom:!0})},n.prototype.valueChanged=function(e,t,r,n){var i=e;this.spreadSheetUsedRange=n,this.grid=e;var a=!0,s=!0,o=this.getSheetFamilyItem(i),l=ve(t.getColIndex())+t.getRowIndex().toString();null!==o.sheetNameToParentObject&&o.sheetNameToParentObject.size>0&&(l=o.parentObjectToToken.get(i)+l);var h=t.getValue().toUpperCase();if(h.indexOf("=RAND()")>-1||h.indexOf("RAND()")>-1||h.indexOf("=RANDBETWEEN(")>-1||h.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(l)){var d=this.randCollection.toString();this.randomValues.has(l)?this.randomValues.has(l)&&(h.indexOf("=RAND()")>-1||h.indexOf("RAND()")>-1||h.indexOf("=RANDBETWEEN(")>-1||h.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(l,t.getValue()):t.getValue().toUpperCase()!==this.randomValues.get(l.toUpperCase())&&(this.randomValues.delete(l),d=d.split(l+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+l).join("").split(l).join(""),this.randCollection=d.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(l,t.getValue()),this.randCollection.push(l),this.isRandomVal=!0)}if(t.getValue()&&t.getValue()[0]===this.getFormulaCharacter()){this.cell=l;var p=void 0;if(sf.base.isNullOrUndefined(s)||(s=r),this.getFormulaInfoTable().has(l)){if(p=this.getFormulaInfoTable().get(l),t.getValue()!==p.getFormulaText()||null==p.getParsedFormula()){p.setFormulaText(t.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{p.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(e){p.setFormulaValue(e),s=!1}}if(s){this.parser.isFormulaParsed=!0;var c=this.computeFormula(p.getParsedFormula());a=c!==p.getFormulaValue(),p.setFormulaValue(c)}}else{(p=new ge).setFormulaText(t.getValue()),this.getDependentFormulaCells().has(l)||this.getDependentFormulaCells().set(l,new Map);try{p.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(e){p.setFormulaValue(e),s=!1}s&&p.setFormulaValue(this.computeFormula(p.getParsedFormula())),this.getFormulaInfoTable().has(l),this.getFormulaInfoTable().set(l,p)}s&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(i)+1,p.getFormulaValue(),t.getRowIndex(),t.getColIndex()):this.parentObject.setValueRowCol(this.getSheetID(i)+1,p.getFormulaValue(),t.getRowIndex(),t.getColIndex()))}else this.getFormulaInfoTable().has(l)&&(this.getFormulaInfoTable().delete(l),this.getDependentFormulaCells().has(l)&&this.clearFormulaDependentCells(l));s&&a&&this.getDependentCells().has(l)&&this.getDependentCells().get(l).toString()!==l&&(this.getComputedValue().clear(),this.refresh(l))},n.prototype.getComputedValue=function(){return null===this.computedValues&&(this.computedValues=new Map),this.computedValues},n.prototype.setValueRowCol=function(e,t,r,n){},n.prototype.getSortedSheetNames=function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach((function(e,r){t.push(r),t.sort()})),this.sortedSheetNames=t,this.sortedSheetNames.sort()}return this.sortedSheetNames},n.prototype.getErrorLine=function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null},n.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},n.prototype.computeMinMax=function(t,r){var n,i,a=0;if(sf.base.isNullOrUndefined(t)||0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=0,o=t.length;s<o;s++)if(t[s].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[e.CommonErrors.value];n="max"===r?this.minValue:this.maxValue;var l=t;if(l.length>255)return this.getErrorStrings()[e.CommonErrors.value];for(var h=0;h<l.length;h++)if(l[h].indexOf(":")>-1&&this.isCellReference(l[h]))for(var d=this.getCellCollection(l[h]),p=0;p<d.length;p++){if(i=this.getValueFromArg(d[p]),this.getErrorStrings().indexOf(i)>-1)return i;var c=this.parseFloat(i);""===i||this.isNaN(this.parseFloat(c))?(a+=1)===d.length&&(n=0):n="max"===r?Math.max(n,c):Math.min(n,c)}else{var u;if(u=this.getValueFromArg(l[h]),this.getErrorStrings().indexOf(u)>-1)return u;c=this.parseFloat(u);if(""===u||this.isNaN(this.parseFloat(c))){(a+=1)===i.length&&(n=0);continue}n="max"===r?Math.max(n,c):Math.min(n,c)}return n.toString()},n.prototype.calculateAvg=function(t){for(var r=0,n=t,i=[],a=0,s=0,o=0;o<n.length;o++)if(n[o].indexOf(":")>-1&&this.isCellReference(n[o])){s=0,i=this.getCellCollection(n[o]),a=0;for(var l=0;l<i.length;l++){var h=this.getValueFromArg(i[l]);sf.base.isNullOrUndefined(h)||isNaN(this.parseFloat(h))||(a+=this.parseFloat(h),s+=1)}if(0===s)return this.getErrorStrings()[e.CommonErrors.divzero];r=(a/=s)+r}else{if(n[o].indexOf(this.tic)>-1&&isNaN(parseFloat(n[o].split(this.tic).join(""))))return this.getErrorStrings()[e.CommonErrors.value];0===n[o].length&&(n[o]="1");h=this.getValueFromArg(n[o].split(this.tic).join(""));if(sf.base.isNullOrUndefined(h)||isNaN(this.parseFloat(h)))return this.getErrorStrings()[e.CommonErrors.name];r+=this.parseFloat(h)}return(r/(n.length-0)).toString()},n.prototype.registerGridAsSheet=function(e,t,r){sf.base.isNullOrUndefined(this.modelToSheetID)&&(this.modelToSheetID=new Map),sf.base.isNullOrUndefined(this.modelToSheetID.get(t))&&this.modelToSheetID.set(t,r);var n=this.getSheetFamilyItem(t);n.isSheetMember=!0;var i=e.toUpperCase();if(0===n.parentObjectToToken.size&&(n.parentObjectToToken=new Map),0===n.sheetNameToParentObject.size&&(n.sheetNameToParentObject=new Map),0===n.sheetNameToToken.size&&(n.sheetNameToToken=new Map),0===n.tokenToParentObject.size&&(n.tokenToParentObject=new Map),sf.base.isUndefined(n.sheetNameToParentObject.get(i))){a=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,n.tokenToParentObject.set(a,t),n.parentObjectToToken.set(t,a),n.sheetNameToToken.set(i,a),n.sheetNameToParentObject.set(i,t)}else{var a=n.sheetNameToToken.get(i);n.tokenToParentObject.set(a,t),n.parentObjectToToken.set(t,a)}return e},n.prototype.unregisterGridAsSheet=function(e,t){var r=this.getSheetFamilyItem(t),n=e.toUpperCase();if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.has(n)){r.sheetNameToParentObject.delete(n);var i=r.sheetNameToToken.get(n);r.sheetNameToToken.delete(n),r.tokenToParentObject.delete(i),r.parentObjectToToken.delete(t)}},n.prototype.computeExpression=function(e){var t=this.parser.parseFormula(e);return this.computeFormula(t)},n.prototype.isSheetMember=function(){var e=this.getSheetFamilyItem(this.grid);return!sf.base.isNullOrUndefined(e)&&e.isSheetMember},n.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},n.prototype.refreshRandValues=function(e){var t,r,n,i,a="",s=this.randCollection.toString();this.randomValues.has(e)&&(this.randomValues.delete(e),s=s.split(e+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+e).join("").split(e).join(""),0===this.randomValues.size&&""===s?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=s.split(this.parseArgumentSeparator));for(var o=0;o<this.randomValues.size;o++)t=this.rowIndex(this.randCollection[o]),r=this.colIndex(this.randCollection[o]),a=(parseFloat(this.getSheetToken(this.randCollection[o]).split(this.sheetToken).join(""))+1).toString(),i=this.getSheetFamilyItem(a),this.grid=i.sheetNameToParentObject.get(a),n=this.randomValues.get(this.randCollection[o]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r)},n.prototype.refresh=function(e){if(0===this.dependencyLevel&&this.refreshedCells.clear(),this.getDependentCells().has(e)&&null!==this.getDependentCells().get(e)){var t=this.getSheetFamilyItem(this.grid);this.dependencyLevel=this.dependencyLevel+1;try{var r=this.getDependentCells().get(e),n=void 0;for(n=0;n<r.length;n++){var i=r[n],a=this.getSheetToken(i);a.length&&(this.grid=t.tokenToParentObject.get(a));try{var s=this.rowIndex(i),o=this.colIndex(i),l=this.getFormulaInfoTable().get(i),h=void 0;l&&(this.cell=i,this.getComputedValue().has(i)?h=this.getComputedValue().get(i):(this.parser.isFormulaParsed=!0,h=this.computeFormula(l.getParsedFormula()),this.computedValues.set(i,h)),l.setFormulaValue(h)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,l.getFormulaValue(),s,o):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,l.getFormulaValue(),s,o),this.refreshedCells.has(i)||(this.refreshedCells.set(i,[]),this.refresh(i))}catch(e){continue}}}finally{this.grid=t.tokenToParentObject.get(this.getSheetToken(e)),this.dependencyLevel--,0===this.dependencyLevel&&this.refreshedCells.clear()}}},ce([sf.base.Property(!0)],n.prototype,"includeBasicFormulas",void 0),ce([sf.base.Event()],n.prototype,"onFailure",void 0),n=i=ce([sf.base.NotifyPropertyChanges],n)}(sf.base.Base),fe=function(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t},ge=function(){function e(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return e.prototype.getFormulaText=function(){return this.formulaText},e.prototype.setFormulaText=function(e){this.formulaText=e},e.prototype.getFormulaValue=function(){return this.formulaValue},e.prototype.setFormulaValue=function(e){this.formulaValue=e},e.prototype.getParsedFormula=function(){return this.parsedFormula},e.prototype.setParsedFormula=function(e){this.parsedFormula=e},e}(),me=function(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentCells=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map};function ve(e){for(var t=[],r=0;e>0&&r<9;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],a=0;a<r;a++)i[r-a-1]=t[a];return i.join("")}var ye=function(e,t,r){return this.row=e,this.col=t,this.value=r,this.getRowIndex=function(){return e},this.setRowIndex=function(t){e=t},this.getColIndex=function(){return t},this.setColIndex=function(e){t=e},this.getValue=function(){return r},this.setValue=function(e){e=e},this},Ce=function(){function r(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}return r.prototype.init=function(){this.addEventListener(),this.initCalculate(),this.registerSheet()},r.prototype.destroy=function(){this.removeEventListener(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null},r.prototype.addEventListener=function(){this.parent.on(k,this.performFormulaOperation,this),this.parent.on("aggregateComputation",this.aggregateComputation,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(k,this.performFormulaOperation),this.parent.off("aggregateComputation",this.aggregateComputation))},r.prototype.getModuleName=function(){return"workbookFormula"},r.prototype.initCalculate=function(){this.calculateInstance=new ue(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()},r.prototype.performFormulaOperation=function(e){var t=e.action,r=this.calculateInstance.getLibraryFormulas(),n=Array.from(r.values());switch(t){case"getLibraryFormulas":e.formulaCollection=Array.from(r.keys());break;case"getFormulaCategory":for(var i=["All"],a=1;a<Array.from(r.values()).length;a++)i.indexOf(n[a].category)<0&&i.push(n[a].category);e.categoryCollection=i;break;case"dropDownSelectFormulas":for(a=0;a<Array.from(r.values()).length;a++)e.selectCategory===n[a].category&&(e.formulaCollection[a]=Array.from(r.keys())[a]);break;case"getFormulaDescription":for(a=0;a<Array.from(r.values()).length;a++)e.selectedList===Array.from(r.keys())[a]&&(e.description=n[a].description);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&this.updateSheetInfo();break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount);break;case"refreshCalculate":e.value=this.autoCorrectFormula(e.value,e.rowIndex,e.colIndex),this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex),e.value=e.value?e.value.toString().split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"):e.value;break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"renameUpdation":this.renameUpdation(e.value,e.sheetId);break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.index});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":var s=this.sheetInfo.length;for(a=0;a<s;a++)if(this.sheetInfo[a].index===e.index){e.sheetName=this.sheetInfo[a].sheet,this.sheetInfo.splice(a,1);break}this.calculateInstance.unregisterGridAsSheet((e.index-1).toString(),e.index),this.calculateInstance.tokenCount=this.calculateInstance.tokenCount-1,this.sheetDeletion(e.sheetName,e.index,e.index);break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=ve(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"refreshInsDelFormula":this.refreshInsDelFormula(e.insertArgs);break;case"refreshNamedRange":this.refreshNamedRange(e.insertArgs,t)}},r.prototype.referenceError=function(){return this.calculateInstance.getErrorStrings()[e.CommonErrors.ref]},r.prototype.getSheetInfo=function(){return this.sheetInfo},r.prototype.addCustomFunction=function(e,t){this.calculateInstance.defineFunction(t,e)},r.prototype.updateSheetInfo=function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach((function(t,r){e.sheetInfo.push({visibleName:t.name,sheet:"Sheet"+t.id,index:r})}))},r.prototype.sheetDeletion=function(e,t,r){var n,i,a=this.calculateInstance.getDependentCells(),s=[],o=null,l="";a.forEach((function(e,t){s.push(t)})),this.removeSheetTokenIndex(l,r);for(var h=0;h<s.length;h++)for(var d=this.calculateInstance.getDependentCells().get(s[h]),p=0;p<d.length;p++)o=this.calculateInstance.getFormulaInfoTable().get(d[p]),t=parseInt(d[p].split("!")[1],10)+1,!sf.base.isNullOrUndefined(o)&&t>-1&&(l=o.formulaText).toUpperCase().indexOf(e.toUpperCase())>-1&&(l=l.toUpperCase().split(e.toUpperCase()+this.calculateInstance.sheetToken).join(this.referenceError()),n=this.calculateInstance.rowIndex(d[p]),i=this.calculateInstance.colIndex(d[p]),this.updateDataContainer([n-1,i-1],{value:l,sheetId:t,visible:!1}),this.calculateInstance.refresh(o.getParsedFormula())),e.split("Sheet")[1]===s[h].split("!")[1]&&(this.calculateInstance.getFormulaInfoTable().delete(s[h]),this.calculateInstance.clearFormulaDependentCells(s[h]))},r.prototype.removeSheetTokenIndex=function(e,t){var r=this.calculateInstance.getSheetFamilyItem(this.calculateInstance.grid);return r.sheetNameToToken.delete(t.toString()),r.sheetNameToParentObject.delete(t.toString()),r.parentObjectToToken.delete(t.toString()),r.tokenToParentObject.delete("!"+(t-1).toString()+"!"),e},r.prototype.renameUpdation=function(e,t){var r,n,i,a=this.calculateInstance.getDependentCells(),s=[],o="",l=[],h=!1;a.forEach((function(e,t){s.push(t)}));for(var d=0;d<this.sheetInfo.length;d++)if(this.sheetInfo[d].index===t){this.sheetInfo[d].visibleName=e;break}var p=this.sheetInfo;for(d=0;d<s.length;d++)for(var c=this.calculateInstance.getDependentCells().get(s[d]),u=0;u<c.length;u++){o=this.calculateInstance.getFormulaInfoTable().get(c[u]).formulaText;for(var f=0;f<p.length;f++)if(p[f].visibleName!==p[f].sheet){var g=p[f].sheet.toUpperCase();o.toUpperCase().indexOf(g)>-1&&(o=o.toUpperCase().split(g).join(f+"/"),l.push(f),h=!0)}if(h){for(var m=0;m<l.length;m++)o=o.split(l[m].toString()+"/").join(p[l[m]].visibleName);r=this.calculateInstance.rowIndex(c[u]),n=this.calculateInstance.colIndex(c[u]),i=Et(this.parent,"Sheet"+(parseInt(c[u].split("!")[1],10)+1),this.sheetInfo),this.updateDataContainer([r-1,n-1],{value:o,sheetId:i,visible:!0})}}},r.prototype.updateDataContainer=function(e,t){for(var r,n,i,a=e[0],s=e[1],o=this.parent.sheets.length,l=0;l<o;l++)if(this.parent.sheets[l].id===t.sheetId){r=this.parent.sheets[l].rows;break}sf.base.isNullOrUndefined(t)||(a in r?s in(n=r[a]).cells?((i=n.cells[s]).formula=t.value,i.value=t.visible?i.value:this.referenceError()):n.cells[s]=i={}:(n=r[a]={})[s]=i={})},r.prototype.parseSheetRef=function(e){var t,r=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),n=0,i=this.parent.sheets.length,a=[];a.length=0;var s=this.getSheetInfo(),o='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)';for(n=0;n<i;n++)s[n].sheet!==s[n].visibleName&&(t=new RegExp(s[n].visibleName.replace(r,"\\$&")+o,"gi"),e.match(t)&&(e=e.replace(t,n+"/"),a.push(n)));for(n=0;n<a.length;)t=new RegExp(a[n]+"/"+o,"gi"),e=e.replace(t,s[a[n]].sheet),n++;return e},r.prototype.registerSheet=function(e,t){var r;for(void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);e<t;)r=kt(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(r,r,this.calcID),e++},r.prototype.unRegisterSheet=function(e,t){var r;for(void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length),this.calculateInstance.tokenCount=0;e<t;)r=kt(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(r,r),e++},r.prototype.refreshCalculate=function(e,t,r,n,i){void 0===i&&(i=this.parent.activeSheetIndex);var a=kt(this.parent,i).id+"";if(n){r=this.parseSheetRef(r);var s=new ye(e+1,t+1,r),l=[this.parent.getActiveSheet().usedRange.rowIndex,this.parent.getActiveSheet().usedRange.colIndex];this.calculateInstance.valueChanged(a,s,!0,l);var h=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){var d=void 0,p=void 0,c="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===h.length)for(var u=0;u<this.calculateInstance.randomValues.size;u++){d=this.calculateInstance.rowIndex(h[u]),p=this.calculateInstance.colIndex(h[u]),c=this.calculateInstance.randomValues.get(h[u]),a=(parseFloat(this.calculateInstance.getSheetToken(h[u]).split(this.calculateInstance.sheetToken).join(""))+1).toString();var f=new ye(d,p,c);this.calculateInstance.valueChanged(a,f,!0)}}}else{var g=this.calculateInstance.getSheetFamilyItem(a),m=o(t+1)+(e+1);g.isSheetMember&&!sf.base.isNullOrUndefined(g.parentObjectToToken)&&(m=g.parentObjectToToken.get(a)+m),this.calculateInstance.getFormulaInfoTable().has(m)&&(this.calculateInstance.getFormulaInfoTable().delete(m),this.calculateInstance.getDependentCells().has(m)&&this.calculateInstance.clearFormulaDependentCells(m)),this.calculateInstance.getComputedValue().clear(),this.calculateInstance.refresh(m),this.calculateInstance.refreshRandValues(m)}this.calculateInstance.cell=""},r.prototype.autoCorrectFormula=function(e,t,r){if(!sf.base.isNullOrUndefined(e)){2===(e=e.toString()).split("(").length&&e.indexOf(")")<0&&(e+=")");var n=void 0;0===e.indexOf("=")&&(e=e.slice(1),n=!0);var i=e.match(/</g),a=e.match(/>/g),s=e.match(/=/g);if(i){for(var o="",l=0;l<i.length;l++)o+=i[l];e=e.replace(o,"<")}if(a){for(var h="",d=0;d<a.length;d++)h+=a[d];e=e.replace(h,">")}if(s){for(var p="",c=0;c<s.length;c++)p+=s[c];e=e.split(p).join("=")}e=n?"="+e:e,(i||a||s)&&(lt(t,r,this.parent.getActiveSheet()).formula=e)}return e},r.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,t=0;t<e.length;){var r=e[t],n=this.parseSheetRef(r.refersTo),i=h(n),a=!1,s=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if((i=(i=i.split("$").join("")).split("=").join("")).indexOf(":")>-1){var o=i.split(":");Ze(o[0])&&Ze(o[1])&&(a=!0)}else i.indexOf(":")<0&&Ze(i)&&(a=!0);s&&(a=!1),a?this.addDefinedName(r,!0):(this.removeDefinedName(r.name,r.scope),t--),t++}},r.prototype.addDefinedName=function(e,t){var r,n=!0,i=e.name;if(e.refersTo.indexOf("!")<0){var a=Ot(this.parent);a=-1!==a.indexOf(" ")?"'"+a+"'":a,e.refersTo=a+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var s=e.refersTo,o=this.parseSheetRef(e.refersTo);return e.scope?(r=xt(this.parent,e.scope))>-1&&(i=Ot(this.parent,r)+"!"+i):e.scope="",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?n=!1:(this.calculateInstance.addNamedRange(i,"="===o[0]?o.substr(1):o),"="!==o[0]&&(e.refersTo="="+s),this.parent.definedNames.indexOf(e)<0&&this.parent.definedNames.push(e)),n},r.prototype.removeDefinedName=function(e,t){var r=!1,n=this.getIndexFromNameColl(e,t);if(n>-1){var i=e;if(t){var a=xt(this.parent,t);a&&(i=Ot(this.parent,a)+"!"+e)}this.calculateInstance.removeNamedRange(i),this.parent.definedNames.splice(n,1),r=!0}return r},r.prototype.checkIsNameExist=function(e,t){return this.parent.definedNames.some((function(r){return r.name===e&&(t?r.scope===t:""===r.scope)}))},r.prototype.getIndexFromNameColl=function(e,t){void 0===t&&(t="");var r=-1;return this.parent.definedNames.filter((function(n,i){n.name===e&&n.scope===t&&(r=i)})),r},r.prototype.toFixed=function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e},r.prototype.aggregateComputation=function(e){var r,n,i=this.parent.getActiveSheet(),s=i.selectedRange,o=t(s.split(":")[1]),l=["SUM","AVERAGE","MIN","MAX"],h=[];o[0]+1===i.rowCount&&o[1]+1===i.colCount&&(s="A1:"+a(i.usedRange.rowIndex,i.usedRange.colIndex));var d=t(i.activeCell),p=i.rows[d[0]]&&i.rows[d[0]].cells?i.rows[d[0]].cells[d[1]]:{},c=p?p.format:"",u=this.calculateInstance.getCellCollection(s);for(r=0;r<u.length;r++)if(x(this.calculateInstance.getValueFromArg(u[r]))){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(s),e.Count&&!e.countOnly){for(r=0;r<4;r++){var f={formattedText:n=this.toFixed(this.calculateInstance.getFunction(l[r])(s)),value:n,format:c,onLoad:!0};c&&(this.parent.notify("getFormattedCell",f),n=f.formattedText),h.push(n)}e.Sum=h[0],e.Avg=h[1],e.Min=h[2],e.Max=h[3]}},r.prototype.clearFormula=function(e){this.parent.activeSheetIndex===e.sheetIdx&&(e.rowIdx="Row"===e.type?"insert"===e.status?e.rowIdx>=e.startIdx?e.rowIdx-e.count:e.rowIdx:e.rowIdx+e.count:e.rowIdx,e.colIdx="Column"===e.type?"insert"===e.status?e.colIdx>=e.startIdx?e.colIdx-e.count:e.colIdx:e.colIdx+e.count:e.colIdx);var t="!"+e.sheetIdx+"!"+ve(-1===e.colIdx?e.colIdx+2:e.colIdx+1)+(-1===e.rowIdx?e.rowIdx+2:e.rowIdx+1);this.calculateInstance.getFormulaInfoTable().delete(t),this.calculateInstance.clearFormulaDependentCells(t)},r.prototype.refreshFormula=function(e,r,n,i,a,o){var l,h,d,p,c,u,f,g=e,m=[],v=this.parent.getActiveSheet(),y=[],C=[];if($e(g)){if("delete"===n)for(p=1;p<=r;p++)y.push(a+p);for(C=this.parseFormula(g),p=0;p<C.length;p++)if(c=C[p].trim(),this.calculateInstance.isCellReference(c)){if((f=p&&C[p-1].trim())&&"!"===f[f.length-1]){if((f=f.replace(/['!]/g,""))!==v.name)continue}else if(0===parseInt(f,10)&&void 0===f[f.length-1]&&v.id-1!==o)continue;m=t(c),l="Column"===i?"insert"===n?m[3]+r:m[3]-r:"insert"===n?m[2]+r:m[2]-r,h="Column"===i?"insert"===n?m[1]+r:m[1]-r:"insert"===n?m[0]+r:m[0]-r,h="Column"===i?a>m[1]?m[1]:h:a>m[0]?m[0]:h,l="Column"===i?a>m[3]?m[3]:l:a>m[2]?m[2]:l,d=h>-1?"Column"===i?s([m[0],h,m[2],l]).split(":")[0]:s([h,m[1],l,m[3]]).split(":")[0]:"#REF!","delete"===n&&(u=parseInt("Row"===i?c.replace(/[A-Z]/g,""):c.replace(/[0-9]/g,""),10),y.indexOf(u)>-1&&(d="#REF!")),C[p]=d}g="="+C.join("")}return g},r.prototype.refreshInsDelFormula=function(e){var t,r,n,i,a,s,o=this.parent.sheets.length;for(a=0;a<o;a++){t=e.model.length;for(var l=(n=[0,0,(r=this.parent.sheets[a]).usedRange.rowIndex,r.usedRange.colIndex])[2];l>=n[0];l--)for(var h=n[1];h<=n[3];h++)(i=lt(l,h,r))&&i.formula&&$e(i.formula)&&(this.clearFormula({rowIdx:l,colIdx:h,sheetIdx:a,count:t,status:e.name,type:e.modelType,startIdx:e.startIndex}),s=this.refreshFormula(i.formula,t,e.name,e.modelType,e.startIndex,a),this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[l,h,l,h],value:s,sheetIndex:a}))}},r.prototype.parseFormula=function(e){var t,r,n,i=0,a=[],s=[];for(n=(s=(s=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;i<n;)(t=s[i])?(1===t.length?a.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t):(r=t[0],t.indexOf("!")>0?(this.isUniqueChar(r)&&(a.push(this.getUniqueCharVal(r)),t=t.substr(1)),r=t.indexOf("!")+1,a.push(t.substr(0,r)),a.push(t.substr(r))):this.isUniqueChar(r)?(a.push(this.getUniqueCharVal(r)),a.push(t.substr(1))):a.push(t)),i++):i++;return a},r.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""},r.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e);return t>=129&&t<=142},r.prototype.markSpecialChar=function(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket)).replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},r.prototype.refreshNamedRange=function(e,r){for(var n,i,a,o,l,h,d,p,c,u=!1,f=this.parent.definedNames,g=Object.assign({},f),m=f.length,v=0;v<m;v++){if(n=g[v],i=t(g[v].refersTo.split("!")[1]),p=n.refersTo.split("!")[0].split("=")[1],c=xt(this.parent,p.replace(/'/g,"")),kt(this.parent,c),c===this.parent.activeSheetIndex&&("insert"===e.name?(a=e.model.length,o=e.index,l=e.index+a,"Row"===e.modelType?i[0]>=l||i[0]>=o&&i[2]>=l?(h=[i[0]+a,i[1],i[2]+a,i[3]],u=!0):(i[0]<=o&&i[2]>=o||i[2]>=l)&&(h=[i[0],i[1],i[2]+a,i[3]],u=!0):"Column"===e.modelType&&(i[1]>=l||i[1]>=o&&i[3]>=l?(h=[i[0],i[1]+a,i[2],i[3]+a],u=!0):(i[1]<=o&&i[3]>=o||i[3]>=l)&&(h=[i[0],i[1],i[2],i[3]+a],u=!0))):(a=e.deletedModel.length,o=e.startIndex,l=e.endIndex,"Row"===e.modelType?i[0]>=l||i[0]>=o&&i[2]>=l?(h=[i[0]-a,i[1],i[2]-a,i[3]],u=!0):(i[0]<=o&&i[2]>=o||i[2]>=l)&&(h=[i[0],i[1],i[2]-a,i[3]],u=!0):"Column"===e.modelType&&(i[1]>=l||i[1]>=o&&i[3]>=l?(h=[i[0],i[1]-a,i[2],i[3]-a],u=!0):(i[1]<=o&&i[3]>=o||i[3]>=l)&&(h=[i[0],i[1],i[2],i[3]-a],u=!0))),u)){d=s(h),n.refersTo=p+"!"+d,this.parent.removeDefinedName(n.name,n.scope);var y={action:"addDefinedName",definedName:n,isAdded:!1};this.parent.notify(k,y)}f=g}},r}(),be=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("initiateSort",this.initiateSortHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("initiateSort",this.initiateSortHandler)},e.prototype.initiateSortHandler=function(e){var t=this,i=e.args,a=new sf.data.Deferred,h=this.parent.getActiveSheet(),d=c(l(i.range)),p=i.sortOptions||{sortDescriptors:{},containsHeader:!0},u=!1;if(e.promise=a.promise,d[0]>h.usedRange.rowIndex||d[1]>h.usedRange.colIndex)a.reject(this.parent.serviceLocator.getService(nt).getConstant("SortOutOfRangeError"));else{var f=p.containsHeader;d[0]===d[2]&&(d=this.getSortDataRange(d[0],d[1],h),u=!0,sf.base.isNullOrUndefined(p.containsHeader)&&(f=r(lt(d[0],d[1],h,null,!0).value)!==r(lt(d[0]+1,d[1],h,null,!0).value)||!this.isSameStyle(lt(d[0],d[1],h,null,!0).style,lt(d[0]+1,d[1],h,null,!0).style))),!sf.base.isNullOrUndefined(i.sortOptions)&&!sf.base.isNullOrUndefined(i.sortOptions.containsHeader)||u||sf.base.isNullOrUndefined(lt(d[0],d[1],h))||sf.base.isNullOrUndefined(lt(d[0]+1,d[1],h))||(f=r(lt(d[0],d[1],h).value)!==r(lt(d[0]+1,d[1],h).value));var g,m,v=d[0]=f?d[0]+1:d[0],y=o(n(h.activeCell)[1]+1),C=p.sortDescriptors,b=s(d);ct(this.parent,h.name+"!"+b,!0).then((function(e){var r=new sf.data.DataManager(e),n=new sf.data.Query;if(Array.isArray(C)){C&&0!==C.length||(C=[{field:y}]);for(var s=C.length,l=s-1;l>-1;l--)if(C[s-1].field||(C[s-1].field=y),C[l].field){var c=C[l].sortComparer||t.sortComparer.bind(t,C[l],p.caseSensitive);n.sortBy(C[l].field,c)}}else{C||(C={field:y}),C.field||(C.field=y);c=C.sortComparer||t.sortComparer.bind(t,C,p.caseSensitive);n.sortBy(C.field,c)}r.executeQuery(n).then((function(t){var r,n={};Array.prototype.forEach.call(t.result,(function(t,i){if(t)for(g=d[1],m=d[3],v=parseInt(e[i].__rowIndex,10)-1;g<=m;g++)r=o(g+1),n=t[r],ht(v,g,h,n)}));var s={range:h.name+"!"+b,sortOptions:i.sortOptions};a.resolve(s)}))}))}},e.prototype.isSameStyle=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});for(var r=!0,n=Object.keys(e),i=0;i<n.length;i++){if(e[n[i]]!==t[n[i]]&&this.parent.cellStyle[n[i]]!==e[n[i]]){r=!1;break}r=!0}return r},e.prototype.getSortDataRange=function(e,t,r){for(var n,i,a,s,o,l,h=e,d=e,p=t,c=t,u=1;!s&&lt(e+u,t,r,null,!0).value?d=e+u:s=!0,!a&&lt(e-u,t,r,null,!0).value?h=e-u:a=!0,!a||!s;u++);for(var f=1;;f++){n=p,i=c;for(u=h;u<=d;u++)if(!o&&lt(u,p-1,r,null,!0).value&&(p=n-1),!l&&lt(u,c+1,r,null,!0).value&&(c=i+1),u===d&&(p===n&&(o=!0),c===i&&(l=!0)),l&&o)return[h,p,d,c]}},e.prototype.sortComparer=function(e,t,r,n){var i=e.order||"",a=sf.data.DataUtil.fnSort(i),s={sensitivity:t?"case":"base"};if(r&&n&&("string"==typeof r.value||"string"==typeof n.value)){x(r.value)&&(r.value=I(r.value)),x(n.value)&&(n.value=I(n.value));var o=new Intl.Collator(this.parent.locale,s);return i&&"ascending"!==i.toLowerCase()?-1*o.compare(r.value,n.value):o.compare(r.value,n.value)}return null!==r&&!sf.base.isNullOrUndefined(r.value)||null!==n&&!sf.base.isNullOrUndefined(n.value)?null===r||sf.base.isNullOrUndefined(r.value)?1:null===n||sf.base.isNullOrUndefined(n.value)?-1:a(r?r.value:r,n?n.value:n):-1},e.prototype.getModuleName=function(){return"workbookSort"},e}(),Se=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.filterRange=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on("initiateFilter",this.initiateFilterHandler,this),this.parent.on("clearAllFilter",this.clearAllFilterHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiateFilter",this.initiateFilterHandler),this.parent.off("clearAllFilter",this.clearAllFilterHandler))},e.prototype.initiateFilterHandler=function(e){var t=this,r=e.args,n=new sf.data.Deferred,i=this.parent.getActiveSheet(),a=r.filterOptions||{};if(e.promise=n.promise,this.filterRange=r.range,a.datasource){this.setFilter(a.datasource,a.predicates);var o={range:r.range,filterOptions:a};n.resolve(o)}else{var h=c(l(r.range));if(h[0]>i.usedRange.rowIndex||h[1]>i.usedRange.colIndex)return void n.reject("Select a cell or range inside the used range and try again.");h[0]===h[2]&&h[2]-h[0]==0&&(h[0]=0,h[1]=0,h[3]=i.usedRange.colIndex),h[2]=i.usedRange.rowIndex,h[0]=h[0]+1;var d=s(h);ct(this.parent,i.name+"!"+d,!0,!0).then((function(e){var r=new sf.data.DataManager(e);t.setFilter(r,a.predicates);var i={range:d,filterOptions:a};n.resolve(i)}))}},e.prototype.setFilter=function(e,t){var r=this;if(e&&t){var n=e.dataSource.json,i=new sf.data.Query;t.length&&i.where(sf.data.Predicate.and(t));var a=e.executeLocal(i);n.forEach((function(e,t){e&&r.parent.hideRow(parseInt(e.__rowIndex,10)-1,void 0,a.indexOf(e)<0)}))}},e.prototype.clearAllFilterHandler=function(){if(this.filterRange){var e=n(this.filterRange),t=this.parent.getActiveSheet();this.parent.hideRow(e[0],t.usedRange.rowIndex-1,!1)}},e.prototype.getModuleName=function(){return"workbookFilter"},e}(),xe=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.setImage=function(e){var r,n=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?xt(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,a=t(n),s=i?this.parent.sheets[i]:this.parent.getActiveSheet(),o=lt(a[0],a[1],s),l=e.options;if(o&&o.image){r=o.image;for(var h=0;h<l.length;h++)r.push(l[h])}ht(a[0],a[1],s,{image:o&&o.image?r:l},!0)},e.prototype.addEventListener=function(){this.parent.on("setImage",this.setImage,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("setImage",this.setImage)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookImage"},e}(),we=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("setChart",this.setChartHandler,this),this.parent.on("refreshChart",this.refreshChartData,this),this.parent.on("deleteChartColl",this.deleteChartColl,this),this.parent.on("refreshChartSize",this.refreshChartSize,this),this.parent.on("focusChartBorder",this.focusChartBorder,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("setChart",this.setChartHandler),this.parent.off("refreshChart",this.refreshChartData),this.parent.off("deleteChartColl",this.deleteChartColl),this.parent.off("refreshChartSize",this.refreshChartSize),this.parent.off("focusChartBorder",this.focusChartBorder))},e.prototype.setChartHandler=function(e){var r=0;e.isInitCell=!sf.base.isNullOrUndefined(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!sf.base.isNullOrUndefined(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!sf.base.isNullOrUndefined(e.isPaste)&&e.isPaste;var n=e.chart;if(n.length>0)for(;r<n.length;){if(!1===e.isCut&&document.getElementById(e.chart[r].id)&&(n[r]={range:n[r].range,id:"e_spreadsheet_chart_"+this.parent.chartCount,isSeriesInRows:n[r].isSeriesInRows,theme:n[r].theme,type:n[r].type},n[r].id="e_spreadsheet_chart_"+this.parent.chartCount,e.isIdAvailabe=!1),document.getElementById(e.chart[r].id))return;var i=!!sf.base.isNullOrUndefined(e.isIdAvailabe)||e.isIdAvailabe;if(n[r].theme=n[r].theme||"Material",n[r].type=n[r].type||"Line",n[r].isSeriesInRows=n[r].isSeriesInRows||!1,n[r].range=n[r].range||this.parent.getActiveSheet().selectedRange,n[r].range.indexOf("!")<0&&(n[r].range=this.parent.getActiveSheet().name+"!"+n[r].range),sf.base.isNullOrUndefined(n[r].id)&&(n[r].id="e_spreadsheet_chart_"+this.parent.chartCount,i=!1),n[r].height=n[r].height||290,n[r].width=n[r].width||480,this.parent.notify("initiateChart",{option:n[r],chartCount:this.parent.chartCount,isInitCell:e.isInitCell,isUndoRedo:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(n[r]),i||this.parent.chartCount++,!e.isInitCell||e.isPaste){var a=n[r].range&&n[r].range.indexOf("!")>0?xt(this.parent,n[r].range.split("!")[0]):this.parent.activeSheetIndex,s=e.isPaste?t(e.range):t(n[r].range),o=a?this.parent.sheets[a]:this.parent.getActiveSheet(),l=lt(s[0],s[1],o);l&&l.chart?l.chart.push(n[r]):ht(s[0],s[1],o,{chart:[n[r]]},!0)}r++}},e.prototype.refreshChartData=function(e){for(var r,n=1,i=this.parent.sheets.length+1;n<i;){var a=this.parent.chartColl;if(r=a?a.length:0)for(;r--;){var s=this.parent.chartColl[r],o=Qe(t(s.range),e.rIdx,e.cIdx),l=s.range.indexOf("!")>-1?xt(this.parent,It(s.range)):this.parent.activeSheetIndex;o&&l===this.parent.activeSheetIndex&&this.parent.notify("updateChart",{chart:s})}n++}},e.prototype.refreshChartSize=function(e){for(var t,r=1,n=this.parent.sheets.length+1;r<n;){var i=this.parent.chartColl;if(t=i?i.length:0)for(;t--;){var a=this.parent.chartColl[t];if(!sf.base.isNullOrUndefined(e.overlayEle.querySelector("#"+a.id))){var s=this.parent.element.querySelector("."+a.id),o=sf.base.getComponent(s,"chart");o.height=e.height,o.width=e.width}}r++}},e.prototype.focusChartBorder=function(e){for(var t=0;t<this.parent.chartColl.length;t++){var r=document.getElementById(e.id),n=document.getElementById(this.parent.chartColl[t].id);r&&n&&sf.base.closest(n,"."+r.classList[1])===r&&this.parent.notify("initiateChart",{option:this.parent.chartColl[t],chartCount:this.parent.chartCount,isRefresh:!0})}},e.prototype.deleteChartColl=function(e){for(var t=0;t<this.parent.chartColl.length;t++){var r=document.getElementById(this.parent.chartColl[t].id),n=document.getElementById(e.id);n&&r&&sf.base.closest(r,"."+n.classList[1])===n&&this.parent.chartColl.splice(t,1)}},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookChart"},e}(),Ie=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.format=function(e){var n,i,a=e.range;a&&"string"==typeof a&&a.indexOf("!")>-1?(a=a.split("!")[1],n=this.parent.sheets[xt(this.parent,e.range.split("!")[0])]):n=this.parent.getActiveSheet(),void 0===a&&(a=n.selectedRange);var s="object"!==r(a)&&e.onActionUpdate;if(i={range:a,style:e.style,requestType:"CellFormat"},s&&(this.parent.trigger("beforeCellFormat",i),this.parent.notify("actionBegin",{eventArgs:i,action:"format"}),i.cancel))e.cancel=!0;else{var o,l,h="object"===r(i.range)?i.range:c(t(i.range));if(e.borderType&&(this.setTypedBorder(n,e.style.border,h,e.borderType,e.onActionUpdate),delete e.style.border),void 0!==i.style.borderTop){for(var d=h[1];d<=h[3];d++)this.checkAdjustantBorder(n,"borderBottom",h[0]-1,d),this.checkFullBorder(n,"borderBottom",h[0]-1,d),this.checkFullBorder(n,"borderTop",h[0],d),this.setCellBorder(n,{borderTop:i.style.borderTop},h[0],d,e.onActionUpdate,d===h[3]);delete i.style.borderTop}if(void 0!==i.style.borderBottom){for(d=h[1];d<=h[3];d++)this.checkAdjustantBorder(n,"borderTop",h[2]+1,d),this.checkFullBorder(n,"borderTop",h[2]+1,d),this.checkFullBorder(n,"borderBottom",h[2],d),this.setCellBorder(n,{borderBottom:i.style.borderBottom},h[2],d,e.onActionUpdate,d===h[3]),this.setBottomBorderPriority(n,h[2],d);delete i.style.borderBottom}if(void 0!==i.style.borderLeft){for(d=h[0];d<=h[2];d++)this.checkAdjustantBorder(n,"borderRight",d,h[1]-1),this.checkFullBorder(n,"borderRight",d,h[1]-1),this.checkFullBorder(n,"borderLeft",d,h[1]),this.setCellBorder(n,{borderLeft:i.style.borderLeft},d,h[1],e.onActionUpdate);delete i.style.borderLeft}if(void 0!==i.style.borderRight){for(d=h[0];d<=h[2];d++)this.checkAdjustantBorder(n,"borderLeft",d,h[3]-1),this.checkFullBorder(n,"borderLeft",d,h[3]-1),this.checkFullBorder(n,"borderRight",d,h[3]),this.setCellBorder(n,{borderRight:i.style.borderRight},d,h[3],e.onActionUpdate);delete i.style.borderRight}if(Object.keys(e.style).length)for(d=h[0];d<=h[2];d++)for(var p=h[1];p<=h[3];p++)void 0===l&&(void 0!==i.style.border?(o=i.style.border,i.style.border=void 0,l=!0):l=!1),l&&this.setFullBorder(n,o,h,d,p,e.onActionUpdate),this.setCellStyle(n,d,p,i.style),this.parent.getActiveSheet().id===n.id&&this.parent.notify(R,{style:i.style,rowIdx:d,colIdx:p,lastCell:p===h[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate});l&&(i.style.border=o),this.parent.setUsedRange(h[2],h[3]),e.refreshRibbon&&this.parent.notify("activeCellChanged",null),s&&(i.range=n.name+"!"+a,this.parent.notify("actionComplete",{eventArgs:i,action:"format"}))}},e.prototype.setBottomBorderPriority=function(e,t,r){if(zt(e,t+1)){var n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,r]).borderTop&&(e.rows[t].cells[r].style.bottomPriority=!0)}},e.prototype.setFullBorder=function(e,t,r,n,i,a){var s={};n===r[0]&&(this.checkAdjustantBorder(e,"borderBottom",n-1,i),this.checkFullBorder(e,"borderBottom",n-1,i)),i===r[1]&&(this.checkAdjustantBorder(e,"borderRight",n,i-1),this.checkFullBorder(e,"borderRight",n,i-1)),i===r[3]?(this.checkAdjustantBorder(e,"borderLeft",n,i+1),this.checkFullBorder(e,"borderLeft",n,i+1)):this.checkAdjustantBorder(e,"border",n,i+1),s.borderRight=t,s.borderTop=t,s.borderLeft=t,s.borderBottom=t,this.setCellBorder(e,s,n,i,a,i===r[3]),n===r[2]?(this.checkAdjustantBorder(e,"borderTop",n+1,i),this.checkFullBorder(e,"borderTop",n+1,i),this.setBottomBorderPriority(e,n,i)):this.checkAdjustantBorder(e,"border",n+1,i)},e.prototype.checkAdjustantBorder=function(e,t,r,n){var i={};""!==this.parent.getCellStyleValue([t],[r,n])[t]&&(i[t]=void 0,this.setCellStyle(e,r,n,i))},e.prototype.checkFullBorder=function(e,t,r,n){var i=this.parent.getCellStyleValue(["border"],[r,n]).border;if(""!==i){var a={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach((function(e){e!==t&&(a[e]=i)})),this.setCellStyle(e,r,n,a)}},e.prototype.textDecorationActionUpdate=function(e){var r=this.parent.getActiveSheet(),n={range:r.selectedRange,style:e.style,requestType:"CellFormat"};if(this.parent.trigger("beforeCellFormat",n),this.parent.notify("actionBegin",{eventArgs:n,action:"format"}),n.cancel)e.cancel=!0;else{var i,a=c(t(r.selectedRange)),s=e.style.textDecoration,o=s,l=t(r.activeCell),h=this.parent.getCellStyleValue(["textDecoration"],l).textDecoration,d=!1;"underline"===h?o="underline"===s?"none":"underline line-through":"line-through"===h?o="line-through"===s?"none":"underline line-through":"underline line-through"===h&&(o="underline"===s?"line-through":"underline",d=!0),"none"===o&&(d=!0),this.format({style:{textDecoration:o},range:l,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var p=a[0];p<=a[2];p++)for(var u=a[1];u<=a[3];u++)if(p!==l[0]||u!==l[1]){if(i={},"none"===(h=this.parent.getCellStyleValue(["textDecoration"],[p,u]).textDecoration)){if(d)continue;i.textDecoration=s}else if("underline"===h||"line-through"===h)if(d){if(s!==h)continue;i.textDecoration="none"}else i.textDecoration=s!==h?"underline line-through":s;else if("underline line-through"===h){if(!d)continue;i.textDecoration="underline"===s?"line-through":"underline"}this.format({style:i,range:[p,u,p,u],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}n.range=r.name+"!"+n.range,this.parent.notify("actionComplete",{eventArgs:n,action:"format"})}},e.prototype.setTypedBorder=function(e,t,r,n,i){var a;if("Outer"===n){for(var s=r[1];s<=r[3];s++)this.checkAdjustantBorder(e,"borderBottom",r[0]-1,s),this.checkFullBorder(e,"borderBottom",r[0]-1,s),this.setCellBorder(e,{borderTop:t},r[0],s,i,s===r[3]),this.checkAdjustantBorder(e,"borderTop",r[2]+1,s),this.checkFullBorder(e,"borderTop",r[2]+1,s),this.setCellBorder(e,{borderBottom:t},r[2],s,i,s===r[3]),this.setBottomBorderPriority(e,r[2],s);for(var o=r[0];o<=r[2];o++)this.checkAdjustantBorder(e,"borderRight",o,r[1]-1),this.checkFullBorder(e,"borderRight",o,r[1]-1),this.setCellBorder(e,{borderLeft:t},o,r[1],i),this.checkAdjustantBorder(e,"borderLeft",o,r[3]+1),this.checkFullBorder(e,"borderLeft",o,r[3]+1),this.setCellBorder(e,{borderRight:t},o,r[3],i)}else if("Inner"===n)for(var l=r[0];l<=r[2];l++)for(var h=r[1];h<=r[3];h++){var d={};""!==(a=this.parent.getCellStyleValue(["border"],[l,h]).border)&&(d.border=void 0,h!==r[3]&&h!==r[1]&&l!==r[0]&&l!==r[2]||(l===r[0]&&(d.borderTop=a),l===r[2]&&(d.borderBottom=a),h===r[3]&&(d.borderRight=a),h===r[1]&&(d.borderLeft=a))),h!==r[3]&&(d.borderRight=t),l!==r[0]&&(d.borderTop=t),l!==r[2]&&(d.borderBottom=t),h!==r[1]&&(d.borderLeft=t),this.setCellBorder(e,d,l,h,i,h===r[3])}else if("Vertical"===n)for(l=r[0];l<=r[2];l++)for(h=r[1];h<=r[3];h++){d={borderRight:t,borderLeft:t};h===r[1]&&(this.checkAdjustantBorder(e,"borderRight",l,h-1),this.checkFullBorder(e,"borderRight",l,h-1)),h===r[3]&&(this.checkAdjustantBorder(e,"borderLeft",l,h+1),this.checkFullBorder(e,"borderLeft",l,h+1)),this.setCellBorder(e,d,l,h,i)}else for(l=r[0];l<=r[2];l++)for(h=r[1];h<=r[3];h++){d={borderTop:t,borderBottom:t};l===r[0]&&(this.checkAdjustantBorder(e,"borderBottom",l-1,h),this.checkFullBorder(e,"borderBottom",l-1,h)),this.setCellBorder(e,d,l,h,i,h===r[3]),l===r[2]&&(this.checkAdjustantBorder(e,"borderTop",l+1,h),this.checkFullBorder(e,"borderTop",l+1,h),this.setBottomBorderPriority(e,l,h))}},e.prototype.setCellBorder=function(e,t,r,n,i,a){this.setCellStyle(e,r,n,t),this.parent.getActiveSheet().id===e.id&&this.parent.notify(R,{style:t,rowIdx:r,colIdx:n,onActionUpdate:i,first:"",lastCell:a,isHeightCheckNeeded:!0,manualUpdate:!0})},e.prototype.setCellStyle=function(e,t,r,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[r]||(e.rows[t].cells[r]={}),e.rows[t].cells[r].style||(e.rows[t].cells[r].style={}),Object.assign(e.rows[t].cells[r].style,n,null,!0)},e.prototype.skipHiddenRows=function(e,t){return zt(e,++t)&&(t=this.skipHiddenRows(e,t)),t},e.prototype.addEventListener=function(){this.parent.on(E,this.format,this),this.parent.on("textDecorationUpdate",this.textDecorationActionUpdate,this),this.parent.on("clear",this.clearCellObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(E,this.format),this.parent.off("textDecorationUpdate",this.textDecorationActionUpdate),this.parent.off("clear",this.clearCellObj))},e.prototype.clearCellObj=function(e){for(var t,r,n=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?xt(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,a=kt(this.parent,i),s=l(n),o=s[0],h=s[2];o<=h;o++)for(t=s[1],r=s[3];t<=r;t++){var d=lt(o,t,a);if(d)switch(e.type){case"Clear Formats":delete d.format,delete d.rowSpan,delete d.style,delete d.wrap,delete d.colSpan;break;case"Clear Contents":delete d.value,delete d.formula;break;case"Clear Hyperlinks":delete d.hyperlink;break;case"Clear All":ht(o,t,a,{},!1)}}},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookcellformat"},e}(),Ee=function(){function e(e){this.parent=e,this.localeObj=sf.base.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("workbookEditOperation",this.performEditOperation,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("workbookEditOperation",this.performEditOperation)},e.prototype.getModuleName=function(){return"workbookEdit"},e.prototype.performEditOperation=function(e){switch(e.action){case"updateCellValue":this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly)}},e.prototype.checkDecimalPoint=function(e){if(Number(e)){var t=e.toString().indexOf(this.decimalSep)+1,r=e.toString().substr(t).length<=6;e=r?t<7?e:parseFloat(e).toFixed(0):t>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-t+2)}return e},e.prototype.updateCellValue=function(e,r,n,i){var a;void 0===i&&(i=!1),void 0===n&&(n=this.parent.activeSheetIndex),a="string"==typeof e?t(e):e;var s=kt(this.parent,n);s.rows[a[0]]||(s.rows[a[0]]={},s.rows[a[0]].cells=[]),s.rows[a[0]].cells||(s.rows[a[0]].cells=[]),s.rows[a[0]].cells[a[1]]||(s.rows[a[0]].cells[a[1]]={});var o=lt(a[0],a[1],s);if(i)r&&r.toString().indexOf(this.decimalSep)>-1&&(r=this.checkDecimalPoint(r)),o.value=r;else{var l=$e(r);l||(o.formula="",o.value=I(r));var h={action:"refreshCalculate",value:r,rowIndex:a[0],colIndex:a[1],sheetIndex:n,isFormula:l};if("Text"!==D(o.format)){var d={value:r,rowIndex:a[0],colIndex:a[1],sheetIndex:n,updatedVal:""};this.parent.notify("checkDateFormat",d),!sf.base.isNullOrUndefined(d.updatedVal)&&d.updatedVal.length>0&&(o.value=d.updatedVal)}this.parent.notify(k,h),l&&(o.formula=h.value,r=o.value)}this.parent.setUsedRange(a[0],a[1]),this.parent.allowChart&&this.parent.notify("refreshChart",{cell:o,rIdx:a[0],cIdx:a[1],sheetIdx:n})},e}(),Re=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("setLinkModel",this.setLinkHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("setLinkModel",this.setLinkHandler)},e.prototype.setLinkHandler=function(e){var r,n,i,a,s=e.hyperlink,o=e.cell,l=this.parent.getActiveSheet();if(o&&-1!==o.indexOf("!")){r=o.split("!");for(var h=this.parent.sheets,d=0;d<h.length;d++)h[d].name===r[0]&&(n=d);l=this.parent.sheets[n],o=r[1]}var p=(i=t(o=o||this.parent.getActiveSheet().activeCell))[0],c=i[1];l&&(sf.base.isNullOrUndefined(l.rows[p])&&(l.rows[p]={}),sf.base.isNullOrUndefined(l.rows[p].cells)&&(l.rows[p].cells=[]),sf.base.isNullOrUndefined(l.rows[p].cells[c])&&(l.rows[p].cells[c]={}),"string"==typeof s?(0!==s.indexOf("http://")&&0!==s.indexOf("https://")&&0!==s.indexOf("ftp://")&&(a=s=0===s.toLowerCase().indexOf("www.")?"http://"+s:s),l.rows[p].cells[c].hyperlink=s):(0!==(a=s.address).indexOf("http://")&&0!==a.indexOf("https://")&&0!==a.indexOf("ftp://")&&(a=0===a.toLowerCase().indexOf("www.")?"http://"+a:a),l.rows[p].cells[c].hyperlink={address:a}))},e.prototype.getModuleName=function(){return"workbookHyperlink"},e}(),ke=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insertModel=function(e){var t,r,n,i=this;if(e.model){var a,s,o,l=[];if("number"==typeof e.start){a=e.start,e.end=e.end||a,a>e.end&&(a=e.end,e.end=e.start);for(var h=a;h<=e.end;h++)l.push({})}else e.start?(a=e.start[0].index||0,l=e.start,o=!0):(a=0,l.push({}));if("Row"===e.modelType){if(e.model=e.model,e.model.rows||(e.model.rows=[]),o&&e.model.usedRange.rowIndex>-1&&a>e.model.usedRange.rowIndex)for(h=e.model.usedRange.rowIndex;h<a-1;h++)l.splice(0,0,{});(t=e.model.rows).splice.apply(t,[a,0].concat(l)),a>e.model.usedRange.rowIndex?this.parent.setUsedRange(a+(l.length-1),e.model.usedRange.colIndex,e.model):this.parent.setUsedRange(e.model.usedRange.rowIndex+l.length,e.model.usedRange.colIndex,e.model);var d=a+l.length;for(h=0;h<=e.model.usedRange.colIndex;h++)e.model.rows[d]&&e.model.rows[d].cells&&e.model.rows[d].cells[h]&&void 0!==e.model.rows[d].cells[h].rowSpan&&e.model.rows[d].cells[h].rowSpan<0&&void 0===e.model.rows[d].cells[h].colSpan&&this.parent.notify("insertMerge",{range:[d,h,d,h],insertCount:l.length,insertModel:"Row"})}else if("Column"===e.modelType){e.model=e.model,e.model.columns||(e.model.columns=[]),(r=e.model.columns).splice.apply(r,[a,0].concat(l)),a>e.model.usedRange.colIndex?this.parent.setUsedRange(e.model.usedRange.rowIndex,a+(l.length-1),e.model):this.parent.setUsedRange(e.model.usedRange.rowIndex,e.model.usedRange.colIndex+l.length,e.model),e.model.rows||(e.model.rows=[]);var p=[];e.columnCellsModel||(e.columnCellsModel=[]);for(h=0;h<l.length;h++)p.push(null);s=[];for(h=0;h<=e.model.usedRange.rowIndex;h++){e.model.rows[h]?e.model.rows[h].cells||(e.model.rows[h].cells=[]):e.model.rows[h]={cells:[]},a&&!e.model.rows[h].cells[a-1]&&(e.model.rows[h].cells[a-1]={}),(n=e.model.rows[h].cells).splice.apply(n,[a,0].concat(e.columnCellsModel[h]&&e.columnCellsModel[h].cells?e.columnCellsModel[h].cells:p));d=a+l.length;e.model.rows[h].cells[d]&&void 0!==e.model.rows[h].cells[d].colSpan&&e.model.rows[h].cells[d].colSpan<0&&void 0===e.model.rows[h].cells[d].rowSpan&&s.push({range:[h,d,h,d],insertCount:p.length,insertModel:"Column"})}s.forEach((function(e){i.parent.notify("insertMerge",e)}))}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;var c,u=l;for(h=0;h<u.length;h++)if(u[h].name)for(var f=0;f<this.parent.sheets.length;f++)if(u[h].name===this.parent.sheets[f].name){u.splice(h,1),h--;break}if(!u.length)return;delete l[0].index,this.parent.createSheet(a,l),e.activeSheetIndex?this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),l.forEach((function(e){o&&i.updateRangeModel(e.ranges),c=e.id,i.parent.notify(k,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+c,index:c})}))}var g={action:"refreshNamedRange",insertArgs:{model:l,index:a,modelType:e.modelType,isAction:e.isAction,activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,name:"insert"}},m={action:"refreshInsDelFormula",insertArgs:{model:l,startIndex:e.start,endIndex:e.end,modelType:e.modelType,name:"insert",activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length}};"Sheet"!==e.modelType&&(this.parent.notify(k,g),this.parent.notify(k,m),e.model!==this.parent.getActiveSheet())||this.parent.notify("insert",{model:l,index:a,modelType:e.modelType,isAction:e.isAction,activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,insertType:e.insertType})}},e.prototype.updateRangeModel=function(e){e.forEach((function(e){e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")}))},e.prototype.setInsertInfo=function(e,t,r,n,i){void 0===i&&(i="Row");var a=r=t+(r-1);e.ranges.forEach((function(e){e.info&&t<e.info[n]&&(e.info["insert"+i+"Range"]?e.info["insert"+i+"Range"].push([t,a]):e.info["insert"+i+"Range"]=[[t,a]],e.info[n]+=a-t+1)}))},e.prototype.addEventListener=function(){this.parent.on("insertModel",this.insertModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("insertModel",this.insertModel)},e.prototype.getModuleName=function(){return"workbookinsert"},e}(),Ae=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.deleteModel=function(e){var t=this,r=this.parent.sheets.length;if("Sheet"!==e.modelType||1!==r){var n,i=e.modelType.toLowerCase()+"s";if(e.start=e.start,e.start>e.end){var a=e.start;e.start=e.end,e.end=a}var s,o=[],l=e.end-e.start+1;if("Row"===e.modelType){if(e.model=e.model,e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex),e.model.usedRange.rowIndex-=e.end-e.start+1,e.model.usedRange.rowIndex<0&&(e.model.usedRange.rowIndex=0),e.model!==this.parent.getActiveSheet()&&this.parent.notify("updateUsedRange",{index:e.model.usedRange.rowIndex,update:"row"});var h=e.end+1,d=void 0,p=void 0;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(var c=0;c<=e.model.usedRange.colIndex;c++){if(e.model.rows[e.start].cells[c]&&void 0!==e.model.rows[e.start].cells[c].rowSpan&&e.model.rows[e.start].cells[c].rowSpan<0&&void 0===e.model.rows[e.start].cells[c].colSpan&&(p={range:[e.start,c,e.start,c]},this.parent.notify("activeCellMergedRange",p),p.range=p.range,p.range[2]<=e.end&&((s=lt(p.range[0],c,e.model))&&s.rowSpan>1&&(s.rowSpan-(p.range[2]-e.start+1)>1?ht(p.range[0],c,e.model,{colSpan:s.rowSpan-(p.range[2]-e.start+1)},!0):delete e.model.rows[p.range[0]].cells[c].rowSpan),p=null)),e.model.rows[h]&&e.model.rows[h].cells&&e.model.rows[h].cells[c]&&void 0!==e.model.rows[h].cells[c].rowSpan&&e.model.rows[h].cells[c].rowSpan<0&&void 0===e.model.rows[h].cells[c].colSpan)if(p||(p={range:[h,c,h,c]},this.parent.notify("activeCellMergedRange",p)),d=new Object,p.range=p.range,Object.assign(d,lt(p.range[0],p.range[1],e.model)),d&&d.rowSpan&&(d.rowSpan>1||d.colSpan>1))(f=[])[1]=c,f[3]=d.colSpan>1?c+(d.colSpan-1):c,p.range=p.range,p.range[0]<e.start?(f[0]=f[2]=p.range[0],d.rowSpan-l>1&&(f[2]+=d.rowSpan-l-1)):(f[0]=f[2]=e.start,d.rowSpan-(e.end-p.range[0]+1)>1&&(f[2]+=d.rowSpan-(e.end-p.range[0]+1)-1)),o.push({range:f,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0});p=null}}else if("Column"===e.modelType){if(e.model=e.model,e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex),e.model.usedRange.colIndex-=l,e.model.usedRange.colIndex<0&&(e.model.usedRange.colIndex=0),e.model!==this.parent.getActiveSheet()&&this.parent.notify("updateUsedRange",{index:e.model.usedRange.colIndex,update:"col"}),n=[];for(h=e.end+1,d=void 0,p=void 0,c=0;c<=e.model.usedRange.rowIndex;c++)if(n.push({}),e.model.rows[c]&&e.model.rows[c].cells){if(e.model.rows[c].cells[e.start]&&void 0!==e.model.rows[c].cells[e.start].colSpan&&e.model.rows[c].cells[e.start].colSpan<0&&void 0===e.model.rows[c].cells[e.start].rowSpan&&(p={range:[c,e.start,c,e.start]},this.parent.notify("activeCellMergedRange",p),p.range=p.range,p.range[3]<=e.end)){var u=lt(c,p.range[1],e.model);u&&u.colSpan>1&&(u.colSpan-(p.range[3]-e.start+1)>1?ht(c,p.range[1],e.model,{colSpan:u.colSpan-(p.range[3]-e.start+1)},!0):delete e.model.rows[c].cells[p.range[1]].colSpan),p=null}var f;if(e.model.rows[c].cells[h]&&void 0!==e.model.rows[c].cells[h].colSpan&&e.model.rows[c].cells[h].colSpan<0&&void 0===e.model.rows[c].cells[h].rowSpan)if(p||(p={range:[c,h,c,h]},this.parent.notify("activeCellMergedRange",p)),d=new Object,p.range=p.range,Object.assign(d,lt(p.range[0],p.range[1],e.model)),d&&d.colSpan&&(d.colSpan>1||d.rowSpan>1))(f=[])[0]=c,f[2]=d.rowSpan>1?c+(d.rowSpan-1):c,p.range=p.range,p.range[1]<e.start?(f[1]=f[3]=p.range[1],d.colSpan-l>1&&(f[3]+=d.colSpan-l-1)):(f[1]=f[3]=e.start,d.colSpan-(e.end-p.range[1]+1)>1&&(f[3]+=d.colSpan-(e.end-p.range[1]+1)-1)),o.push({range:f,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0});n[c].cells=e.model.rows[c].cells.splice(e.start,l),p=null}}else if(e.end-e.start==this.parent.sheets.length-1)return;var g=[];for(c=e.start;c<=e.end;c++)e.model[i][e.start]?(g.push(e.model[i][e.start]),e.model[i].splice(e.start,1)):g.push({}),c===e.start&&(g[0].index=e.start);o.forEach((function(e){t.parent.notify(T,e)}));var m={action:"refreshNamedRange",insertArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,isAction:e.isAction,deletedModel:g,deletedCellsModel:n,activeSheetIndex:this.parent.activeSheetIndex,name:"delete"}},v={action:"refreshInsDelFormula",insertArgs:{model:g,startIndex:e.start,endIndex:e.end,modelType:e.modelType,name:"delete",activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length}};this.parent.notify(k,m),this.parent.notify(k,v),"Sheet"!==e.modelType&&e.model!==this.parent.getActiveSheet()||this.parent.notify("delete",{startIndex:e.start,endIndex:e.end,modelType:e.modelType,isAction:e.isAction,deletedModel:g,deletedCellsModel:n,activeSheetIndex:this.parent.activeSheetIndex})}},e.prototype.setDeleteInfo=function(e,t,r,n){void 0===n&&(n="Row");var i=t-e+1,a=[];this.parent.getActiveSheet().ranges.forEach((function(s){s.info&&e<s.info[r]&&(s.info["delete"+n+"Range"]?s.info["delete"+n+"Range"].push([e,t]):s.info["delete"+n+"Range"]=[[e,t]],s.info[r]-=i,s.info["insert"+n+"Range"]&&(s.info["insert"+n+"Range"]=a))}))},e.prototype.addEventListener=function(){this.parent.on("deleteModel",this.deleteModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("deleteModel",this.deleteModel)},e.prototype.getModuleName=function(){return"workbookdelete"},e}(),Fe=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("setValidation",this.addValidationHandler,this),this.parent.on("removeValidation",this.removeValidationHandler,this),this.parent.on("addHighlight",this.addHighlightHandler,this),this.parent.on("removeHighlight",this.removeHighlightHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("setValidation",this.addValidationHandler),this.parent.off("removeValidation",this.removeValidationHandler),this.parent.off("addHighlight",this.addHighlightHandler),this.parent.off("removeHighlight",this.removeHighlightHandler))},e.prototype.addValidationHandler=function(e){this.ValidationHandler(e.rules,e.range,!1)},e.prototype.removeValidationHandler=function(e){this.ValidationHandler(e.rules,e.range,!0)},e.prototype.ValidationHandler=function(e,r,n){for(var i,a=kt(this.parent,this.parent.getAddressInfo(r).sheetIndex),s=t(r=r||a.selectedRange),o=s[0];o<=s[2];o++){a.rows[o]||qt(a,o,{});for(var l=s[1];l<=s[3];l++)if(a.rows[o].cells&&a.rows[o].cells[l]||ht(o,l,a,{}),i=a.rows[o].cells[l],n){if(i.validation){delete i.validation;var h=this.parent.getCellStyleValue(["backgroundColor","color"],[o,l]);this.parent.notify(R,{style:h,rowIdx:o,colIdx:l})}}else i.validation={type:e.type,operator:e.operator,value1:"List"===e.type&&e.value1.length>256?e.value1.substring(0,255):e.value1,value2:e.value2,ignoreBlank:e.ignoreBlank,inCellDropDown:e.inCellDropDown}}},e.prototype.addHighlightHandler=function(e){this.InvalidDataHandler(e.range,!1)},e.prototype.removeHighlightHandler=function(e){this.InvalidDataHandler(e.range,!0)},e.prototype.InvalidDataHandler=function(e,r){for(var n,i,a=this.parent.getActiveSheet(),s=(e=e||a.selectedRange)?t(e):[],o=e?s[0]:0,l=e?s[2]:a.rows.length;o<=l;o++)if(a.rows[o])for(var h=e?s[1]:0,d=e?s[3]:a.rows[o].cells.length;h<=d;h++)if(a.rows[o].cells[h]){i=(n=a.rows[o].cells[h]).value?n.value:"";var p=[o,h],c=this.parent.activeSheetIndex;if(n.validation&&this.parent.allowDataValidation){this.parent.notify("isValidation",{value:i,range:p,sheetIdx:c,isCell:!1});var u=this.parent.allowDataValidation;if(this.parent.allowDataValidation=!0,!u)if(r){if(r){var f=this.parent.getCellStyleValue(["backgroundColor","color"],[o,h]);this.parent.notify(R,{style:f,rowIdx:o,colIdx:h})}}else this.parent.notify(R,{style:{backgroundColor:"#ffff00",color:"#ff0000"},rowIdx:o,colIdx:h})}}},e.prototype.getModuleName=function(){return"workbookDataValidation"},e}(),Te=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("findNext",this.findNext,this),this.parent.on("findPrevious",this.findPrevious,this),this.parent.on("replace",this.replace,this),this.parent.on("replaceAll",this.replaceAll,this),this.parent.on("count",this.totalCount,this),this.parent.on("findAllValues",this.findAllValues,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("findNext",this.findNext),this.parent.off("findPrevious",this.findPrevious),this.parent.off("replace",this.replace),this.parent.off("replaceAll",this.replaceAll),this.parent.off("count",this.totalCount),this.parent.off("findAllValues",this.findAllValues))},e.prototype.findNext=function(e){var t,r,i,a=this.parent.sheets,s=(e.sheetIndex,a[this.parent.activeSheetIndex]),o=n(s.activeCell),l=s.usedRange,h=l.colIndex,d=e.value.toString(),p=0,c=l.rowIndex,u=t=o[1],f=r=o[0];s.rows[r]&&(s.rows[r].cells[t]&&(s.rows[r].cells[t].format?i=this.parent.getDisplayText(s.rows[r].cells[t]).toString():s.rows[r].cells[t].value&&(i=s.rows[r].cells[t].value.toString())));if(i){var g=i.toLowerCase(),m=i.indexOf(e.value)>-1,v=g.indexOf(e.value.toString().toLowerCase())>-1;(d===i||d===g||m||v)&&("By Column"===e.searchBy?r++:t++,p++)}(o[0]>s.usedRange.rowIndex||o[1]>s.usedRange.colIndex)&&(o[0]>s.usedRange.rowIndex&&o[1]<=s.usedRange.colIndex?(r=0,t=o[1]):o[0]<=s.usedRange.rowIndex&&o[1]>s.usedRange.colIndex?(r=o[0],t=0):(r=0,t=0));var y={rowIndex:r,colIndex:t,usedRange:l,endRow:c,endColumn:h,startRow:f,mode:e.mode,loopCount:0,count:p,args:e,val:void 0,stringValue:d,sheetIndex:this.parent.activeSheetIndex,startColumn:u,sheets:a};"By Row"===e.searchBy&&this.findNxtRow(y),"By Column"===e.searchBy&&this.findNxtCol(y)},e.prototype.findNxtRow=function(e){var t,r=e.sheets[e.sheetIndex],i=this.parent.sheets.length,a=n(r.activeCell);for(e.colIndex>=e.usedRange.colIndex+1&&(e.colIndex=0,e.rowIndex++),e.rowIndex;e.rowIndex<=e.endRow+1;e.rowIndex++){if(e.rowIndex>e.endRow){if("Workbook"===e.mode){var s=this.parent.activeSheetIndex;if(e.sheetIndex++,i===e.sheetIndex&&(e.sheetIndex=0),s===e.sheetIndex&&0===e.count)return void this.parent.notify(F,null);t=(r=e.sheets[e.sheetIndex]).usedRange,a=n(r.activeCell),e.rowIndex=0,e.colIndex=0,e.endColumn=t.colIndex,e.endRow=t.rowIndex}if(0===e.colIndex&&e.rowIndex>e.endRow)if(0===a[0]&&0===a[1]||a[0]>r.usedRange.rowIndex||a[1]>r.usedRange.colIndex){if(0===e.count)return void this.parent.notify(F,null)}else(0!==a[0]&&0!==a[1]||0!==a[0]||0!==a[1])&&(e.startColumn=0,e.startRow=0,e.endColumn=e.usedRange.colIndex,e.endRow=a[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++)}if(e.count>0&&e.usedRange.rowIndex<e.rowIndex&&(e.rowIndex=0,0===e.rowIndex&&(e.colIndex=0)),r.rows[e.rowIndex]){var o=r.rows[e.rowIndex];for(e.colIndex;e.colIndex<=e.endColumn;e.colIndex++){if(o)if(o.cells[e.colIndex])if(this.nextCommon(e))return}if(e.colIndex>e.endColumn&&(e.colIndex=0),e.loopCount>0&&a[0]===e.rowIndex)return void this.parent.notify(F,null)}}0!==e.count||this.parent.notify(F,null)},e.prototype.findNxtCol=function(e){var t,r=e.sheets[e.sheetIndex],i=n(r.activeCell),a=this.parent.sheets.length;for(e.rowIndex>=e.usedRange.rowIndex&&(e.rowIndex=0,e.colIndex++),e.colIndex;e.colIndex<=e.usedRange.colIndex+1;e.colIndex++){if(e.colIndex>=e.endColumn+1&&"Workbook"===e.mode){if(t=this.parent.activeSheetIndex,e.sheetIndex++,a===e.sheetIndex&&(e.sheetIndex=0),t===e.sheetIndex&&0===e.count)return void this.parent.notify(F,null);r=e.sheets[e.sheetIndex],e.usedRange=r.usedRange,i=n(r.activeCell),e.colIndex=0,e.rowIndex=0,e.endColumn=e.usedRange.colIndex,e.endRow=e.usedRange.rowIndex}if(e.colIndex>=e.endColumn+1&&(e.colIndex=0),e.rowIndex>e.endRow&&0===e.colIndex)if(0===i[0]&&0===i[1]||i[1]>r.usedRange.rowIndex||i[0]>r.usedRange.colIndex){if(0===e.count)return void this.parent.notify(F,null)}else(0!==i[1]||0!==i[0]||0!==i[1]&&0!==i[0])&&(e.startRow=0,e.startColumn=0,e.endRow=i[0],e.endColumn=e.usedRange.colIndex,e.colIndex=e.startColumn,e.rowIndex=e.startRow,e.loopCount++);if(e.count>0&&e.usedRange.colIndex+1<e.colIndex&&(e.colIndex=0,e.rowIndex=0),e.rowIndex>=e.endRow&&(e.rowIndex=0),e.colIndex<=e.usedRange.colIndex){for(e.rowIndex;e.rowIndex<=e.usedRange.rowIndex;e.rowIndex++){if(r.rows[e.rowIndex])if(r.rows[e.rowIndex].cells[e.colIndex])if(this.nextCommon(e))return}if(e.loopCount>0&&i[1]===e.colIndex)return void this.parent.notify(F,null)}}0!==e.count||this.parent.notify(F,null)},e.prototype.nextCommon=function(e){var t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){var r=t.rows[e.rowIndex].cells[e.colIndex];if(r&&r.value){var n=t.rows[e.rowIndex].cells[e.colIndex];if(n){var i=void 0;if(n.format)i=this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex]);else i=t.rows[e.rowIndex].cells[e.colIndex].value.toString();if(e.args.isCSen&&e.args.isEMatch){if(i===e.stringValue){var s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var o=i.indexOf(e.args.value)>-1;if(i===e.stringValue||o){s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=i.toString().toLowerCase(),e.val===e.stringValue){s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=i.toString().toLowerCase();o=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var l=e.val.indexOf(e.args.value)>-1;if(e.val===e.stringValue||i===e.stringValue||o||i===e.stringValue||l){s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}}}}return!1},e.prototype.findPrevious=function(e){var t,r=this.parent.sheets,i=e.sheetIndex,a=r[i],s=n(a.activeCell),o=0,l=a.usedRange.rowIndex,h=a.usedRange.colIndex,d=e.value.toString(),p=s[1],c=s[0],u=p,f=c;a.rows[c]&&(a.rows[c].cells[p]&&(a.rows[c].cells[p].format?t=this.parent.getDisplayText(a.rows[c].cells[p]).toString():a.rows[c].cells[p].value&&(t=a.rows[c].cells[p].value.toString())));if(t){var g=t.toLowerCase(),m=t.indexOf(e.value)>-1,v=g.indexOf(e.value.toString().toLowerCase())>-1;(d===t||d===g||m||v)&&("By Row"===e.searchBy&&p--,"By Column"===e.searchBy&&c--,o++)}(s[0]>a.usedRange.rowIndex||s[1]>a.usedRange.colIndex)&&(s[0]>a.usedRange.rowIndex&&s[1]<=a.usedRange.colIndex?(c=a.usedRange.rowIndex,p=s[1]):s[0]<=a.usedRange.rowIndex&&s[1]>a.usedRange.colIndex?(c=s[0],p=a.usedRange.colIndex):(c=a.usedRange.rowIndex,p=a.usedRange.colIndex));var y={rowIndex:c,colIndex:p,endRow:l,endColumn:h,startRow:f,loopCount:0,count:o,args:e,val:void 0,stringValue:d,sheets:r,sheetIndex:i,startColumn:u};"By Row"===e.searchBy&&this.findPreRow(y),"By Column"===e.searchBy&&this.findPreCol(y)},e.prototype.findPreRow=function(e){var t,r=e.sheets[e.sheetIndex],i=this.parent.sheets.length,a=!1,s=n(r.activeCell);for(-1===e.colIndex&&(e.colIndex=e.endColumn,e.rowIndex--),e.rowIndex;e.rowIndex>=-1;e.rowIndex--){if(e.rowIndex<0&&e.colIndex<0){if("Workbook"===e.args.mode){var o=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=i-1),o===e.sheetIndex&&0===e.count)return void this.parent.notify(F,null);t=(r=e.sheets[e.sheetIndex]).usedRange,s=n(r.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}a=this.commonCondition(e,s)}if(!a&&("Workbook"!==e.args.mode&&e.count>0&&-1===e.rowIndex&&(e.rowIndex=e.endRow),-1===e.rowIndex&&(e.rowIndex=r.usedRange.rowIndex,e.colIndex=r.usedRange.colIndex),r.rows[e.rowIndex])){for(-1===e.colIndex&&(e.colIndex=r.usedRange.colIndex),e.colIndex;e.colIndex>=0;e.colIndex--){if(r.rows[e.rowIndex])if(r.rows[e.rowIndex].cells[e.colIndex])if(this.prevCommon(e))return}if(e.loopCount>0&&s[0]===e.rowIndex)return void this.parent.notify(F,null)}}a||0!==e.count||this.parent.notify(F,null)},e.prototype.findPreCol=function(e){var t,r=e.sheets[e.sheetIndex],i=this.parent.sheets.length,a=!1,s=n(r.activeCell);for(e.colIndex;e.colIndex>=-1;e.colIndex--){if(e.rowIndex<0&&e.colIndex<0){if("Workbook"===e.args.mode){var o=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=i-1),o===e.sheetIndex&&0===e.count)return void this.parent.notify(F,null);t=(r=e.sheets[e.sheetIndex]).usedRange,s=n(r.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}a=this.commonCondition(e,s)}if(!a)for(e.count>0&&e.colIndex<0&&(e.colIndex=e.endColumn),e.rowIndex<0&&(e.rowIndex=r.usedRange.rowIndex),e.colIndex<-1&&(e.colIndex=r.usedRange.colIndex,e.rowIndex--),r.rows[e.rowIndex]&&r.rows[e.rowIndex].cells[e.colIndex]&&-1===e.rowIndex&&(e.rowIndex=r.usedRange.rowIndex),e.rowIndex;e.rowIndex>=0;e.rowIndex--){if(r.rows[e.rowIndex])if(r.rows[e.rowIndex].cells[e.colIndex])if(this.prevCommon(e))return;if(e.loopCount>0&&s[1]===e.colIndex)return void this.parent.notify(F,null)}}a||0!==e.count||this.parent.notify(F,null)},e.prototype.commonCondition=function(e,t){var r,n=e.sheets[e.sheetIndex];return t[0]!==e.endRow&&t[1]!==e.endColumn||t[0]!==e.endRow||t[1]!==e.endColumn?(e.startColumn=n.usedRange.colIndex,e.startRow=n.usedRange.rowIndex,e.endColumn=0,e.endRow=t[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++,r=!1):(t[0]===n.usedRange.rowIndex&&t[1]===n.usedRange.colIndex||t[0]>n.usedRange.rowIndex||t[1]>n.usedRange.colIndex)&&(this.parent.notify(F,null),r=!0),r},e.prototype.prevCommon=function(e){var t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){var r=t.rows[e.rowIndex].cells[e.colIndex];if(r&&r.value){var n=t.rows[e.rowIndex].cells[e.colIndex];if(n){var i=void 0;if(n.format)i=this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex]);else i=t.rows[e.rowIndex].cells[e.colIndex].value.toString();if(e.args.isCSen&&e.args.isEMatch){if(i===e.stringValue){var s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var o=i.indexOf(e.args.value)>-1;if(i===e.stringValue||o){s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=i.toString().toLowerCase(),e.val===e.stringValue){s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=i.toString().toLowerCase();o=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var l=e.val.indexOf(e.args.value)>-1;if(i===e.stringValue||i===e.stringValue||o||e.val===e.stringValue||l){s=t.name+"!"+a(e.rowIndex,e.colIndex);return this.parent.notify(A,{address:s}),e.count++,!0}}}}}return!1},e.prototype.replace=function(e){if(this.parent.getActiveSheet().isProtected)this.parent.notify("editAlert",null);else{var t=this.parent.getActiveSheet(),r=n(t.activeCell),i=t.rows[r[0]].cells[r[1]].value.toString(),s=i.indexOf(e.value)>-1,o=i.toLowerCase().indexOf(e.value.toString().toLowerCase())>-1,l=i.toString().toLowerCase();i===e.value||s||l===e.value||o||(e.findOpt="next",this.findNext(e)),this.parent.getActiveSheet();var h,d=n(t.activeCell),p=t.activeCell,c=t.rows[d[0]].cells[d[1]],u=t.rows[d[0]].cells[d[1]].format,f=t.name+"!"+a(d[0],d[1]);if(u)h=this.parent.getDisplayText(t.rows[d[0]].cells[d[1]]).toString();else h=t.rows[d[0]].cells[d[1]].value.toString();var g={undoRedoOpt:"before",address:f,compareVal:h};this.parent.notify("findUndoRedo",g);var m=h.toLowerCase(),v=h.indexOf(e.value)>-1,y=m.indexOf(e.value)>-1;if(e.value===h||e.value===m){t.rows[d[0]].cells[d[1]].value=e.replaceValue,this.parent.updateCell(c,p);var C={address:f,compareVal:e.replaceValue,undoRedoOpt:"after"};this.parent.notify("findUndoRedo",C)}else if(v){var b=h.replace(e.value,e.replaceValue);t.rows[d[0]].cells[d[1]].value=b,this.parent.updateCell(c,p);var S={address:f,compareVal:e.replaceValue,undoRedoOpt:"after"};this.parent.notify("findUndoRedo",S)}else if(y){var x=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),w=h.replace(x,e.replaceValue);t.rows[d[0]].cells[d[1]].value=w,this.parent.updateCell(c,p);var I={address:f,compareVal:e.replaceValue,undoRedoOpt:"after"};this.parent.notify("findUndoRedo",I)}}},e.prototype.replaceAll=function(e){for(var t,r=0,n=this.parent.sheets[r],i=n.usedRange.rowIndex,s=0,o=0,l=n.usedRange.colIndex,h=0,d=[];o<=i;o++)if(h>l&&o===i&&"Workbook"===e.mode&&(r++,(n=this.parent.sheets[r])&&(h=0,o=0,l=n.usedRange.colIndex,i=n.usedRange.rowIndex,n=n)),n&&n.rows[o]){var p=n.rows[o];for(h===l+1&&(h=0);h<=l;h++){var c=n.rows[o].cells[h];if(p&&p.cells[h]&&p.cells[h].value){var u=n.rows[o].cells[h];if(u){var f=void 0;if(u.format)f=this.parent.getDisplayText(n.rows[o].cells[h]).toString();else f=n.rows[o].cells[h].value.toString();if(e.isCSen&&e.isEMatch)f===e.value&&(n.rows[o].cells[h].value=e.replaceValue,t=n.name+"!"+a(o,h),this.parent.updateCell(c,t),d.push(t),s++);else if(e.isCSen&&!e.isEMatch){var g=f.indexOf(e.value)>-1;if(f===e.value||g){var m=f.replace(e.value,e.replaceValue);n.rows[o].cells[h].value=m,t=n.name+"!"+a(o,h),this.parent.updateCell(c,t),d.push(t),s++}}else if(!e.isCSen&&e.isEMatch){(v=f.toString().toLowerCase())===e.value&&(n.rows[o].cells[h].value=e.replaceValue,t=n.name+"!"+a(o,h),this.parent.updateCell(c,t),d.push(t),s++)}else if(!e.isCSen&&!e.isEMatch){g=(v=f.toString().toLowerCase()).indexOf(e.value.toString().toLowerCase())>-1;var v,y=v.indexOf(e.value)>-1;if(f===e.value||g||v===e.value||f===e.value||y){var C=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig");m=f.replace(C,e.replaceValue);n.rows[o].cells[h].value=m,t=n.name+"!"+a(o,h),this.parent.updateCell(c,t),d.push(t),s++}}}}}}var b={undoRedoOpt:"beforeReplaceAll",Collection:d,replaceValue:e.value};this.parent.notify("findUndoRedo",b),b={undoRedoOpt:"afterReplaceAll",Collection:d,replaceValue:e.replaceValue},this.parent.notify("findUndoRedo",b);var S=s;this.parent.notify("replaceAllDialog",{count:S,replaceValue:e.replaceValue})},e.prototype.totalCount=function(e){for(var t=this.parent.sheets[0],r=t.usedRange.rowIndex,i=0,a=0,s=t.usedRange.colIndex,o=0;a<=r;a++)if(t.rows[a]){var l=t.rows[a];for(o===s+1&&(o=0);o<=s;o++)if(l&&l.cells[o]&&l.cells[o].value){var h=t.rows[a].cells[o];if(h){var d=void 0;if(h.format)d=this.parent.getDisplayText(t.rows[a].cells[o]).toString();else d=h.value.toString();if(e.isCSen&&e.isEMatch)d===e.value&&i++;else if(e.isCSen&&!e.isEMatch){var p=d.indexOf(e.value)>-1;(d===e.value||p)&&i++}else if(!e.isCSen&&e.isEMatch){(f=d.toString().toLowerCase())===e.value&&i++}else if(!e.isCSen&&!e.isEMatch){p=(f=d.toString().toLowerCase()).indexOf(e.value.toString().toLowerCase())>-1;var c=f.indexOf(e.value)>-1;(f===e.value||d===e.value||p||d===e.value||c)&&i++}}}}var u=i;if((i=u-(this.requiredCount(e)-1))>u&&(i=u),0!==i){var f,g=n(t.activeCell);-1===(f=this.parent.getDisplayText(t.rows[g[0]].cells[g[1]]).toString().toLowerCase()).indexOf(e.value.toString().toLowerCase())&&(i-=1)}e.findCount=i+" of "+u},e.prototype.requiredCount=function(e){for(var t=this.parent.activeSheetIndex,r=this.parent.sheets[t],i=n(r.activeCell),a=r.usedRange.rowIndex,s=0,o=i[0],l=r.usedRange.colIndex,h=i[1];o<=a;o++)if(r.rows[o]){var d=r.rows[o];for(h===l+1&&(h=0);h<=l;h++)if(d&&d.cells[h]&&d.cells[h].value&&r.rows[o].cells[h]){var p=void 0;if(r.rows[o].cells[h].format)p=this.parent.getDisplayText(r.rows[o].cells[h]).toString();else p=r.rows[o].cells[h].value.toString();if(e.isCSen&&!e.isEMatch){var c=p.indexOf(e.value)>-1;(p===e.value||c)&&s++}else if(e.isCSen&&e.isEMatch)p===e.value&&s++;else if(!e.isCSen&&e.isEMatch){(u=p.toString().toLowerCase())===e.value&&s++}else if(!e.isCSen&&!e.isEMatch){var u=p.toString().toLowerCase(),f=e.value.toString().toLowerCase(),g=(c=u.indexOf(f)>-1,u.indexOf(e.value)>-1);(p===e.value||u===f||c||u===e.value||g)&&s++}}}return s},e.prototype.findAllValues=function(e){for(var t,r=e.sheetIndex,n=this.parent.sheets[r-1],i=n.usedRange.rowIndex,s=0,o=n.usedRange.colIndex,l=0,h=this.parent.sheets.length,d=e.sheetIndex;s<=i+1;s++){if(1!==d&&e.sheetIndex===h&&(r=1),s>i&&l>o&&"Workbook"===e.mode){if(d===++r)return void 0;r>h-1&&(r=0),(n=this.parent.sheets[r])&&(s=0,l=0,o=n.usedRange.colIndex,i=n.usedRange.rowIndex,n=n)}if(!sf.base.isNullOrUndefined(n)&&n.rows[s]){var p=n.rows[s];for(l===o+2&&(l=0);l<=o+1;l++)if(p&&p.cells[l]){var c=n.rows[s].cells[l];if(c){var u=void 0;if(c.format)u=this.parent.getDisplayText(n.rows[s].cells[l]).toString();else u=c.value.toString();if(e.isCSen&&e.isEMatch)u===e.value&&(t=n.name+"!"+a(s,l),e.findCollection.push(t));else if(e.isCSen&&!e.isEMatch){var f=u.indexOf(e.value)>-1;(u===e.value||f)&&(t=n.name+"!"+a(s,l),e.findCollection.push(t))}else if(!e.isCSen&&e.isEMatch){(g=u.toString().toLowerCase())===e.value&&(t=n.name+"!"+a(s,l),e.findCollection.push(t))}else if(!e.isCSen&&!e.isEMatch){var g;f=(g=u.toString().toLowerCase()).indexOf(e.value.toLowerCase())>-1;(g===e.value||u===e.value||f||u===e.value)&&(t=n.name+"!"+a(s,l),e.findCollection.push(t))}}}}}},e.prototype.getModuleName=function(){return"workbookfindAndReplace"},e}(),Oe=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.protectsheetHandler=function(e){var t=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(t,"protectSettings",{selectCells:e.selectCells,formatCells:e.formatCells,formatColumns:e.formatColumns,formatRows:e.formatRows,insertLink:e.insertLink}),this.parent.notify("protectSheet",t.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"}),t.columns.forEach((function(e){e&&sf.base.isUndefined(e.isLocked)&&(e.isLocked=!0)}))},e.prototype.unprotectsheetHandler=function(e){var t=this.parent.getActiveSheet();e.sheet&&(t=this.parent.sheets[e.sheet]),t.protectSettings.formatCells=t.protectSettings.formatColumns=!1,t.protectSettings.formatRows=t.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(t,"isProtected",!1),this.parent.notify("protectSheet",t.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("protectsheetHandler",this.protectsheetHandler,this),this.parent.on("unprotectsheetHandler",this.unprotectsheetHandler,this),this.parent.on("setLockCells",this.lockCells,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("protectsheetHandler",this.protectsheetHandler),this.parent.off("setLockCells",this.lockCells),this.parent.off("protectsheetHandler",this.unprotectsheetHandler))},e.prototype.lockCells=function(e){var n,i=this.parent.getActiveSheet(),a="object"===r(n=e?e.range:i.selectedRange)?n:c(t(n));if(0===a[0]&&a[2]===i.rowCount-1)for(var s=a[1];s<=a[3];s++)Qt(i,s,{isLocked:e.isLocked});for(s=a[0];s<=a[2];s++)for(var o=a[1];o<=a[3];o++)this.parent.getActiveSheet().id===i.id&&this.parent.notify("applyLockCells",{rowIdx:s,colIdx:o,isLocked:e.isLocked})},e.prototype.getModuleName=function(){return"workbookProtectSheet"},e}(),Ne=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=t(e.range)),e.range=c(e.range);var r=e.sheet||this.parent.getActiveSheet();e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type?"Horizontally"===e.type?this.mergeHorizontally(e):"Vertically"===e.type&&this.mergeVertically(e):(this.mergeAll(e),e.refreshRibbon&&this.parent.notify("activeCellChanged",null)),this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"}),this.parent.sheets.indexOf(r)===this.parent.activeSheetIndex&&this.parent.notify("selectRange",{indexes:t(r.selectedRange),skipChecking:!0})},e.prototype.mergeAll=function(e){var t,r,n,i=0;e.range=e.range;var a,s=e.sheet||this.parent.getActiveSheet(),o=lt(e.range[0],e.range[1],s),l=o&&o.style?o.style.borderLeft:null;"none"===l&&(l="none"!==o.style.borderRight?o.style.borderRight:o.style.borderTop?o.style.borderTop:null),"none"===l&&(l="none"!==o.style.borderBottom?o.style.borderBottom:null),sf.base.isNullOrUndefined(o)||sf.base.isNullOrUndefined(l)||(o.style.borderBottom="",o.style.borderLeft="",o.style.borderTop="",o.style.borderRight="");for(var h=e.range[0];h<=e.range[2];h++){r=0,e.isAction&&e.model.push({cells:[]});for(var d=e.range[1];d<=e.range[3];d++){if((t=lt(h,d,s))&&(t.value||t.formula)&&!n&&(n=t.formula||t.value),e.isAction&&e.merge&&(e.model[h-e.range[0]].cells[d-e.range[1]]={},Object.assign(e.model[h-e.range[0]].cells[d-e.range[1]],t)),s.rows[h]&&s.rows[h].cells&&s.rows[h].cells[d]&&(delete s.rows[h].cells[d].rowSpan,delete s.rows[h].cells[d].colSpan,!e.merge&&!e.isAction&&e.model&&e.model[h-e.range[0]]&&e.model[h-e.range[0]].cells[d-e.range[1]]&&e.model[h-e.range[0]].cells[d-e.range[1]]!=={}&&ht(h,d,s,e.model[h-e.range[0]].cells[d-e.range[1]])),e.merge){if(t=new Object,h===e.range[0]&&d===e.range[1]){e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(t.rowSpan=e.range[2]-e.range[0]+1),ht(e.range[0],e.range[1],s,t,!0);continue}h!==e.range[0]&&(t.rowSpan=-i),d!==e.range[1]&&(r++,t.colSpan=-r),s.rows[h]&&s.rows[h].cells&&s.rows[h].cells[d]&&(delete s.rows[h].cells[d].value,delete s.rows[h].cells[d].formula),a=lt(h,d,s)||{},ht(h,d,s,Object.assign(t,a))}e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:h,colIdx:d})}i++}e.merge&&(t=this.getCellValue(e.range[0],e.range[1],n,s),ht(e.range[0],e.range[1],s,t,!0),e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[1]})),sf.base.isNullOrUndefined(l)||this.parent.notify(E,{style:{border:l},range:e.range,onActionUpdate:!0})},e.prototype.mergeHorizontally=function(e){var t,r;e.range=e.range;for(var n,i,a,s=e.sheet||this.parent.getActiveSheet(),o=e.range[0];o<=e.range[2];o++){t=0,e.isAction&&e.model.push({cells:[]});for(var l=e.range[1];l<=e.range[3];l++){if(a=lt(o,l,s),r=new Object,e.isAction&&(e.model[o-e.range[0]].cells[l-e.range[1]]={},Object.assign(e.model[o-e.range[0]].cells[l-e.range[1]],a)),l===e.range[1]){if(o===e.range[0])continue;i=o-1,s.rows[i]&&s.rows[i].cells&&s.rows[i].cells[l]&&delete s.rows[i].cells[l].rowSpan,r=this.getCellValue(i,l,n,s),e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),n=null,ht(i,l,s,r,!0)}else a&&(a.value||a.formula)&&!n&&(n=a.formula||a.value),i=o,s.rows[i]&&s.rows[i].cells&&s.rows[i].cells[l]&&(delete s.rows[i].cells[l].rowSpan,delete s.rows[i].cells[l].value,delete s.rows[i].cells[l].formula),t++,r.colSpan=-t,ht(i,l,s,r,!0);this.parent.notify("applyMerge",{rowIdx:i,colIdx:l})}}s.rows[e.range[2]]&&s.rows[e.range[2]].cells&&s.rows[e.range[2]].cells[e.range[1]]&&delete s.rows[e.range[2]].cells[e.range[1]].rowSpan,r=this.getCellValue(e.range[2],e.range[1],n,s),e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),ht(e.range[2],e.range[1],s,r,!0),this.parent.notify("applyMerge",{rowIdx:e.range[2],colIdx:e.range[1]})},e.prototype.getCellValue=function(e,t,r,n){var i=new Object,a=lt(e,t,n);return!r||a&&(a.value||a.formula)||($e(r)?i.formula=r:i.value=r),i},e.prototype.mergeVertically=function(e){var t=0;e.range=e.range;for(var r,n,i,a,s=e.sheet||this.parent.getActiveSheet(),o=e.range[1];o<=e.range[3];o++)for(var l=e.range[0];l<=e.range[2];l++){if(a=lt(l,o,s),e.isAction&&(void 0===e.model[l-e.range[0]]&&(e.model[l-e.range[0]]={cells:[]}),e.model[l-e.range[0]].cells[o-e.range[1]]={},Object.assign(e.model[l-e.range[0]].cells[o-e.range[1]],a)),l===e.range[0]){if(t=0,o===e.range[1])continue;i=o-1,s.rows[l]&&s.rows[l].cells&&s.rows[l].cells[i]&&delete s.rows[l].cells[i].colSpan,r=this.getCellValue(l,i,n,s),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),n=null,ht(l,i,s,r,!0)}else r=new Object,a&&(a.value||a.formula)&&!n&&(n=a.formula||a.value),t++,i=o,s.rows[l]&&s.rows[l].cells&&s.rows[l].cells[i]&&(delete s.rows[l].cells[i].colSpan,delete s.rows[l].cells[i].value,delete s.rows[l].cells[i].formula),r.rowSpan=-t,ht(l,i,s,r,!0);this.parent.notify("applyMerge",{rowIdx:l,colIdx:i})}s.rows[e.range[0]]&&s.rows[e.range[0]].cells&&s.rows[e.range[0]].cells[e.range[3]]&&delete s.rows[e.range[0]].cells[e.range[3]].colSpan,r=this.getCellValue(e.range[0],e.range[1],n,s),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),ht(e.range[0],e.range[3],s,r,!0),this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[3]})},e.prototype.activeCellRange=function(e){e.range=e.range;var t=this.parent.getActiveSheet(),r=lt(e.range[0],e.range[1],t);r&&(!sf.base.isNullOrUndefined(r.rowSpan)&&r.rowSpan<0&&(e.range[0]+=r.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!sf.base.isNullOrUndefined(r.colSpan)&&r.colSpan<0&&(e.range[1]+=r.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),(r=lt(e.range[0],e.range[1],t))&&(r.rowSpan>1&&(e.range[0]+(r.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(r.rowSpan-1)),r.colSpan>1&&(e.range[1]+(r.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(r.colSpan-1))))},e.prototype.mergedRange=function(e){"string"==typeof e.range&&(e.range=t(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)},e.prototype.forward=function(e){e.range=e.range;var t,r,n=e.sheet||this.parent.getActiveSheet(),i=lt(e.range[0],e.range[1],n),a=t=e.range[0],s=r=e.range[1];if(i&&(!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a=t=e.range[0]+i.rowSpan),!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s=r=e.range[1]+i.colSpan),(i=lt(a,s,n))&&(i.rowSpan>1&&(t+=i.rowSpan-1,a+(i.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=a+(i.rowSpan-1))),i.colSpan>1&&(r+=i.colSpan-1,s+(i.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=s+(i.colSpan-1))))),e.range[0]=a,e.range[1]=s,e.range[0]===a&&e.range[1]===s&&e.range[2]===t&&e.range[3]===r&&(e.isActiveCell=!0),!e.skipChecking){for(var o=e.range[1];o<=e.range[3];o++)(i=lt(e.range[2],o,n))&&(a=e.range[2],s=o,!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan)<e.range[1]&&(e.range[1]=s),!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[0]&&(e.range[0]=a),(i=lt(a,s,n))&&(i.colSpan>1&&s+(i.colSpan-1)>e.range[3]&&(e.range[3]=s,e.range[3]=s+(i.colSpan-1)),i.rowSpan>1&&a+(i.rowSpan-1)>e.range[2]&&(e.range[2]=a,e.range[2]=a+(i.rowSpan-1))));var l,h;for(o=e.range[1];o<=e.range[3];o++)(i=lt(e.range[0],o,n))&&(h=o,l=e.range[0],!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(h+=i.colSpan)<e.range[1]&&(e.range[1]=h),!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(l+=i.rowSpan)<e.range[0]&&(e.range[0]=l));for(o=e.range[0];o<=e.range[2];o++)(i=lt(o,e.range[3],n))&&(a=o,s=e.range[3],!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[0]&&(e.range[0]=a),!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan)<e.range[1]&&(e.range[1]=s),(i=lt(a,s,n))&&(i.rowSpan>1&&a+(i.rowSpan-1)>e.range[2]&&(e.range[2]=a,e.range[2]=a+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>e.range[3]&&(e.range[3]=s,e.range[3]=s+(i.colSpan-1))))}},e.prototype.forwardReverse=function(e){var t=this.parent.getActiveSheet();e.range=e.range;var r=e.range[1],n=lt(e.range[0],e.range[1],t),i=e.range[0];if(n&&(!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(r+=n.colSpan,e.range[3]>=r&&(e.range[3]=r)),!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan)<e.range[0]&&(e.range[0]=i),(n=lt(i,r,t))&&(n.rowSpan>1&&i+(n.rowSpan-1)>=e.range[2]&&(e.range[2]=i+(n.rowSpan-1)),n.colSpan>1&&r+(n.colSpan-1)>=e.range[1]&&(e.range[1]=r+(n.colSpan-1)))),e.range[0]=i,!e.skipChecking){for(var a,s,o,l,h=e.range[3];h<=e.range[1];h++)(n=lt(e.range[2],h,t))&&(s=h,a=e.range[2],!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(a+=n.rowSpan)<e.range[0]&&(e.range[0]=a),!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(s+=n.colSpan)<e.range[3]&&(e.range[3]=s),(n=lt(a,s,t))&&(n.rowSpan>1&&a+(n.rowSpan-1)>e.range[2]&&(e.range[2]=a+(n.rowSpan-1)),n.colSpan>1&&s+(n.colSpan-1)>e.range[1]&&(e.range[1]=s+(n.colSpan-1))));for(h=e.range[3];h<=e.range[1];h++)(n=lt(e.range[0],h,t))&&(s=h,o=e.range[0],!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(o+=n.rowSpan)<e.range[0]&&(e.range[0]=o),!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(s+=n.colSpan),(n=lt(o,s,t))&&(n.rowSpan>1&&o+(n.rowSpan-1)>e.range[2]&&(e.range[2]=o+(n.rowSpan-1)),n.colSpan>1&&s+(n.colSpan-1)>e.range[1]&&(e.range[1]=s,e.range[1]=s+(n.colSpan-1))));for(h=e.range[0];h<=e.range[2];h++)(n=lt(h,e.range[3],t))&&(o=h,l=e.range[3],!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(o+=n.rowSpan)<e.range[0]&&(e.range[0]=o),!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(l+=n.colSpan)<e.range[3]&&(e.range[3]=l),(n=lt(o,l,t))&&(n.rowSpan>1&&o+(n.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(n.rowSpan-1)),n.colSpan>1&&l+(n.colSpan-1)>e.range[1]&&(e.range[1]=l,e.range[1]=l+(n.colSpan-1))))}},e.prototype.reverse=function(e){e.range=e.range;var t=e.range[1],r=e.sheet||this.parent.getActiveSheet(),n=lt(e.range[0],e.range[1],r),i=e.range[0];n&&(!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(t+=n.colSpan),!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan),e.range[2]>=i&&(e.range[2]=i,e.isActiveCell=!0),e.range[3]>=t?(e.range[3]=t,e.range[2]===i&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),(n=lt(i,t,r))&&(n.rowSpan>1&&i+(n.rowSpan-1)>=e.range[0]&&(e.range[0]=i,e.range[0]=i+(n.rowSpan-1)),n.colSpan>1&&t+(n.colSpan-1)>=e.range[1]&&(e.range[1]=t,e.range[1]=t+(n.colSpan-1))));var a=e.range[3];if(!e.skipChecking){for(var s=e.range[3];s<=e.range[1];s++)(n=lt(e.range[2],s,r))&&(a=s,i=e.range[2],!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan)<e.range[2]&&(e.range[2]=i),!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(a+=n.colSpan)<e.range[3]&&(e.range[3]=a),(n=lt(i,a,r))&&(n.rowSpan>1&&i+(n.rowSpan-1)>e.range[0]&&(e.range[0]=i,e.range[0]=i+(n.rowSpan-1)),n.colSpan>1&&a+(n.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(n.colSpan-1))));a=e.range[3];for(s=e.range[3];s<=e.range[1];s++)(n=lt(e.range[0],s,r))&&(a=s,i=e.range[0],!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(a+=n.colSpan),!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan),(n=lt(i,a,r))&&(n.colSpan>1&&a+(n.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(n.colSpan-1)),n.rowSpan>1&&i+(n.rowSpan-1)>e.range[0]&&(e.range[0]=i,e.range[0]=i+(n.rowSpan-1))));var o,l;for(s=e.range[2];s<=e.range[0];s++)(n=lt(s,e.range[3],r))&&(l=s,o=e.range[3],!sf.base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(l+=n.rowSpan)<e.range[2]&&(e.range[2]=l),!sf.base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(o+=n.colSpan)<e.range[3]&&(e.range[3]=o),(n=lt(l,o,r))&&(n.rowSpan>1&&l+(n.rowSpan-1)>e.range[0]&&(e.range[0]=l,e.range[0]=l+(n.rowSpan-1)),n.colSpan>1&&o+(n.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(n.colSpan-1))))}},e.prototype.reverseForward=function(e){e.range=e.range;var t=e.sheet||this.parent.getActiveSheet(),r=e.range[0],n=e.range[1],i=lt(e.range[0],e.range[1],t);if(i&&(!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(r+=i.rowSpan,e.range[2]>=r&&(e.range[2]=r)),!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(n+=i.colSpan),(i=lt(r,n,t))&&(i.rowSpan>1&&r+(i.rowSpan-1)>=e.range[0]&&(e.range[0]=r,e.range[0]=r+(i.rowSpan-1)),i.colSpan>1&&n+(i.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=n+(i.colSpan-1)))),!e.skipChecking){for(var a,s,o,l,h=e.range[3],d=e.range[1];d<=e.range[3];d++)(i=lt(e.range[2],d,t))&&(a=e.range[2],h=d,!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[2]&&(e.range[2]=a),!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(h+=i.colSpan)<e.range[1]&&(e.range[1]=h),(i=lt(a,h,t))&&(i.colSpan>1&&h+(i.colSpan-1)>e.range[3]&&(e.range[3]=h+(i.colSpan-1)),i.rowSpan>1&&i.rowSpan-1+a>e.range[0]&&(e.range[0]=i.rowSpan-1+a)));for(d=e.range[1];d<=e.range[3];d++)(i=lt(e.range[0],d,t))&&(o=d,s=e.range[0],!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan)<e.range[1]&&(e.range[1]=o),!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(s+=i.rowSpan),(i=lt(s,o,t))&&i.rowSpan>1&&s+(i.rowSpan-1)>e.range[0]&&(e.range[0]=s+(i.rowSpan-1)));for(d=e.range[2];d<=e.range[0];d++)(i=lt(d,e.range[3],t))&&(a=d,l=e.range[3],!sf.base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[2]&&(e.range[2]=a),!sf.base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(l+=i.colSpan)<e.range[1]&&(e.range[1]=l),(i=lt(a,l,t))&&(i.rowSpan>1&&i.rowSpan-1+a>e.range[0]&&(e.range[0]=i.rowSpan-1+a),i.colSpan>1&&i.colSpan-1+l>e.range[3]&&(e.range[3]=l,e.range[3]=i.colSpan-1+l)))}},e.prototype.insertHandler=function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)},e.prototype.pasteHandler=function(e){for(var t,r,i,a=this.parent.getActiveSheet(),s=n(a.activeCell),o=e.range[0],l=0;o<=e.range[2];o++,l++)for(var h=e.range[1],d=0;h<=e.range[3];h++,d++){if((t=lt(o,h,e.prevSheet)||{}).rowSpan>1&&(i=lt(s[0]+(t.rowSpan-1),s[1],a)||{},r=lt(s[0]+1,s[1],a)||{},void 0!==i.colSpan&&i.colSpan<0||void 0!==r.colSpan&&r.colSpan<0))return e.cancel=!0,void this.parent.notify("applyMerge",{showDialog:!0});if(t.colSpan>1&&(i=lt(s[0],s[1]+(t.colSpan-1),a)||{},r=lt(s[0],s[1]+1,a)||{},void 0!==i.rowSpan&&i.rowSpan<0||void 0!==r.rowSpan&&r.rowSpan<0))return e.cancel=!0,void this.parent.notify("applyMerge",{showDialog:!0})}},e.prototype.addEventListener=function(){this.parent.on(T,this.merge,this),this.parent.on("mergedRange",this.mergedRange,this),this.parent.on("activeCellMergedRange",this.activeCellRange,this),this.parent.on("insertMerge",this.insertHandler,this),this.parent.on("pasteMerge",this.pasteHandler,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(T,this.merge),this.parent.off("mergedRange",this.mergedRange),this.parent.off("activeCellMergedRange",this.activeCellRange),this.parent.off("insertMerge",this.insertHandler),this.parent.off("pasteMerge",this.pasteHandler))},e.prototype.getModuleName=function(){return"workbookmerge"},e}(),De=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("setCFRule",this.setCFrulHandler,this),this.parent.on("clearCFRule",this.clearRules,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("setCFRule",this.setCFrulHandler),this.parent.off("clearCFRule",this.clearRules))},e.prototype.setCFrulHandler=function(e){var r=e.conditionalFormat,n=r.range,i=this.parent.getAddressInfo(n).sheetIndex,a=kt(this.parent,i);n=n||a.selectedRange,r.range=n;var s,o=t(n);a.conditionalFormats||this.parent.setSheetPropertyOnMute(a,"conditionalFormats",[]),s=a.conditionalFormats.length,a.conditionalFormats[s]=r;for(var l=o[0];l<=o[2];l++){a.rows[l]||qt(a,l,{});for(var h=o[1];h<=o[3];h++)if(a.rows[l].cells&&a.rows[l].cells[h]||ht(l,h,a,{}),i===this.parent.activeSheetIndex){var d=a.rows[l].cells[h];this.parent.notify("cFInitialCheck",{rowIdx:l,colIdx:h,cell:d,conditionalFormat:r})}}},e.prototype.clearRules=function(e){var r,n,i,a,o,l,h,d,p=!!sf.base.isNullOrUndefined(e.isPublic),c=[],u=[],f=!0,g=e.range,m=this.parent.getAddressInfo(g).sheetIndex,v=kt(this.parent,m),y=v.conditionalFormats,C=t(g);if(m===this.parent.activeSheetIndex)for(var b=C[0];b<=C[2];b++)for(var S=C[1];S<=C[3];S++)this.parent.notify("clearCF",{rIdx:b,cIdx:S});if(y){for(var x=y.length-1;x>=0;x--){var w=!1,I="",E=y[x],k=E.range.split(",");if(m===this.parent.activeSheetIndex)for(var A=0;A<k.length;A++){var F=!1,T=t(k[A]);h=T[0],d=T[0],o=T[1],l=T[1],T[0]>=C[0]&&T[2]<=C[2]&&T[1]>=C[1]&&T[3]<=C[3]&&(F=!0);for(var O=T[0];O<=T[2];O++){for(var N=0,D=T[1];D<=T[3];D++)for(var L=C[0];L<=C[2];L++)for(var B=C[1];B<=C[3];B++)if(L===O&&B===D){var H=this.parent.getCellStyleValue(["backgroundColor","color"],[L,B]);this.parent.notify(R,{style:H,rowIdx:L,colIdx:B,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0}),N+=1,w=!0,L===T[0]?B===T[3]?o===T[1]?l===B?l=B:o=B-1:o!==T[1]&&l+1===B?(l=T[1],o-=1):o!==T[1]&&l===T[1]&&(o=C[1]-1):B===T[1]?l===T[1]&&(l=B+1):o===T[1]&&l===T[1]?(o=B,l=B):l=o===T[1]&&l!==T[1]?B+1:B:B===T[1]?l===T[1]&&T[1]!==T[3]&&(l=B+1):B===T[3]?o===T[1]?l===B?l=B:o=B-1:o!==T[1]&&l===T[1]?o=C[1]-1:o!==T[1]&&l+1===B?(l=T[1],o=C[1]-1):d=L:o===T[1]&&l===T[1]?(o=B,l=B):l!==T[1]&&o!==T[1]?l=B:o!==T[1]&&l===T[1]?o=B:l=B+1}N>0&&!F?(f&&(r=h,n=d,i=o,a=l),o===T[1]&&l!==T[1]?l===T[3]?(h!==O&&(I=I+" "+s([h,i,n,T[3]])),o===T[1]&&l===T[3]&&(O===T[2]?T[1]===C[3]&&(I=I+" "+s([O,l,O,T[3]])):(C[2]===T[0]&&l!==T[3]&&(I=I+" "+s([O,l,O,T[3]])),h=O+1,d=O+1,l=T[1]))):a!==l?(I=I+" "+s([h,a,O-1,T[3]]),l===T[3]&&o===T[1]?(h=O+1,d=O+1,l=T[1]):(h=O,d=O),l===T[3]&&o!==T[1]&&(o=T[1])):i!==o?(I=I+" "+s([h,T[1],O-1,i]),h=O+1,d=O+1,o=T[1],l=T[1]):O===T[2]?I=I+" "+s([h,l,O,T[3]]):(d<O||o===T[1]&&l===T[3])&&(d=O):l===T[1]&&o!==T[1]?(a!==l&&(I=I+" "+s([h,a,O-1,T[3]]),h=O,d=O),i!==o&&(I=I+" "+s([h,i,O-1,T[3]]),h=O,d=O),O===T[2]?I=I+" "+s([h,l,O,o]):d=O):l!==T[1]&&o!==T[1]?O===T[2]&&T[2]===C[0]?I=T[0]===T[2]?(I=I+" "+s([h,T[1],d,o-1]))+" "+s([h,l+1,d,T[3]]):(I=(I=I+" "+s([h,T[1],d,T[3]]))+" "+s([T[2],T[1],T[2],o-1]))+" "+s([T[2],l+1,T[2],T[3]]):O===T[2]?I=(I=I+" "+s([h,T[1],O,o-1]))+" "+s([h,l+1,O,T[3]]):(i===T[1]&&a===T[1]&&(I=I+" "+s([h,i,d,T[3]]),h=O),d=O):o===T[1]&&l===T[1]&&(C[2]!==T[0]?(T[2]>=C[2]&&O>C[2]&&(I=I+" "+s([h,o,d,T[3]])),T[1]===T[3]&&O<=T[2]&&r!==T[2]&&O!==r&&(I=I+" "+s([h,o,d,T[3]])),T[1]===T[3]&&(h=O+1,d=O+1)):((O===T[2]||O===T[0]&&T[1]!==T[3])&&(I=I+" "+s([h,o,d,l])),h=O+1,d=O+1),O===T[2]&&T[0]!==T[2]&&T[1]!==T[3]&&(I=I+" "+s([O,o,O,l]))),f||(r=h,n=d<=T[2]?d:T[2],i=o,a=l<=T[3]?l:T[3]),f=!1):F||(f&&(r=h,n=d,i=o,a=l),o===T[1]&&l===T[1]&&(O===T[2]&&(I=I+" "+s([h,o,O,T[3]])),d=O),l!==T[1]&&o!==T[1]&&(I=(I=I+" "+s([h,T[1],O-1,o-1]))+" "+s([h,l+1,O-1,T[3]]),h=O,d=O,o=T[1],l=T[1]),l!==T[1]&&o===T[1]&&(I=I+" "+s([h,l,O-1,T[3]]),h=O,d=O,o=T[1],l=T[1]),o!==T[1]&&l===T[1]&&(I=I+" "+s([h,l,O-1,o]),h=O,d=O,o=T[1],l=T[1]),f||(r=h,n=d<=T[2]?d:T[2],i=o,a=l<=T[3]?l:T[3]),f=!1)}}""===I?(u.push(v.conditionalFormats[x].range),v.conditionalFormats.splice(x,1)):(u.push(v.conditionalFormats[x].range),v.conditionalFormats[x].range=I.trim().replace(" ",",")),w&&!p&&(E.range=I.trim().replace(" ",","),c.push(E))}if(!p){var M={cFormats:c,oldRange:u,selectedRange:g};this.parent.notify(W,{eventArgs:M,action:"clearCF"})}}},e.prototype.getModuleName=function(){return"workbookConditionalFormatting"},e}(),Le=function(){function e(){Pt.Inject(B,Q,$,O,Ie,Ee,Ce,be,Re,Se,ke,Ae,Te,Oe,Fe,Ne,De,xe,we)}return e.prototype.getModuleName=function(){return"workbookBasic"},e.prototype.destroy=function(){},e}(),Be=function(){function e(){Pt.Inject(B,Q,O,Ie,Ee,Ce,$,be,Re,Se,ke,Ae,Te,Oe,Fe,Ne,De,xe,we)}return e.prototype.getModuleName=function(){return"workbook-all"},e.prototype.destroy=function(){},e}();function He(e,t){return void 0===t&&(t=[]),t.push({member:"workbookBasic",args:[]}),t.push({member:"workbookAll",args:[]}),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowDataValidation&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),t}var Me,Pe=(Me=function(e,t){return(Me=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Me(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_e=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("Calibri")],t.prototype,"fontFamily",void 0),_e([sf.base.Property("bottom")],t.prototype,"verticalAlign",void 0),_e([sf.base.Property("left")],t.prototype,"textAlign",void 0),_e([sf.base.Property("0pt")],t.prototype,"textIndent",void 0),_e([sf.base.Property("#000000")],t.prototype,"color",void 0),_e([sf.base.Property("#ffffff")],t.prototype,"backgroundColor",void 0),_e([sf.base.Property("normal")],t.prototype,"fontWeight",void 0),_e([sf.base.Property("normal")],t.prototype,"fontStyle",void 0),_e([sf.base.Property("11pt")],t.prototype,"fontSize",void 0),_e([sf.base.Property("none")],t.prototype,"textDecoration",void 0),_e([sf.base.Property("")],t.prototype,"border",void 0),_e([sf.base.Property("")],t.prototype,"borderTop",void 0),_e([sf.base.Property("")],t.prototype,"borderBottom",void 0),_e([sf.base.Property("")],t.prototype,"borderLeft",void 0),_e([sf.base.Property("")],t.prototype,"borderRight",void 0),t}(sf.base.ChildProperty),Ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property()],t.prototype,"sheetIdx",void 0),_e([sf.base.Property()],t.prototype,"filterRange",void 0),_e([sf.base.Property(!1)],t.prototype,"hasFilter",void 0),_e([sf.base.Property()],t.prototype,"column",void 0),_e([sf.base.Property()],t.prototype,"criteria",void 0),_e([sf.base.Property()],t.prototype,"value",void 0),_e([sf.base.Property()],t.prototype,"dataType",void 0),t}(sf.base.ChildProperty),je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("")],t.prototype,"name",void 0),_e([sf.base.Property("")],t.prototype,"scope",void 0),_e([sf.base.Property("")],t.prototype,"comment",void 0),_e([sf.base.Property("")],t.prototype,"refersTo",void 0),t}(sf.base.ChildProperty),qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property(!1)],t.prototype,"selectCells",void 0),_e([sf.base.Property(!1)],t.prototype,"formatCells",void 0),_e([sf.base.Property(!1)],t.prototype,"formatRows",void 0),_e([sf.base.Property(!1)],t.prototype,"formatColumns",void 0),_e([sf.base.Property(!1)],t.prototype,"insertLink",void 0),t}(sf.base.ChildProperty),ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("")],t.prototype,"address",void 0),t}(sf.base.ChildProperty),We=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("WholeNumber")],t.prototype,"type",void 0),_e([sf.base.Property("Between")],t.prototype,"operator",void 0),_e([sf.base.Property("0")],t.prototype,"value1",void 0),_e([sf.base.Property("0")],t.prototype,"value2",void 0),_e([sf.base.Property(!0)],t.prototype,"ignoreBlank",void 0),_e([sf.base.Property(!0)],t.prototype,"inCellDropDown",void 0),_e([sf.base.Property(!1)],t.prototype,"isHighlighted",void 0),t}(sf.base.ChildProperty),Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("General")],t.prototype,"format",void 0),_e([sf.base.Complex({},Ue)],t.prototype,"style",void 0),_e([sf.base.Property(!0)],t.prototype,"isLocked",void 0),t}(sf.base.ChildProperty),Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("GreaterThan")],t.prototype,"type",void 0),_e([sf.base.Complex({},Ge)],t.prototype,"format",void 0),_e([sf.base.Property("RedFT")],t.prototype,"cFColor",void 0),_e([sf.base.Property("")],t.prototype,"value",void 0),_e([sf.base.Property("")],t.prototype,"range",void 0),t}(sf.base.ChildProperty),Xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("Line")],t.prototype,"type",void 0),_e([sf.base.Property("Material")],t.prototype,"theme",void 0),_e([sf.base.Property(!1)],t.prototype,"isSeriesInRows",void 0),_e([sf.base.Property("")],t.prototype,"range",void 0),_e([sf.base.Property("")],t.prototype,"id",void 0),_e([sf.base.Property(290)],t.prototype,"height",void 0),_e([sf.base.Property(480)],t.prototype,"width",void 0),_e([sf.base.Property(0)],t.prototype,"top",void 0),_e([sf.base.Property(0)],t.prototype,"left",void 0),t}(sf.base.ChildProperty),Ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),_e([sf.base.Property("")],t.prototype,"src",void 0),_e([sf.base.Property("")],t.prototype,"id",void 0),_e([sf.base.Property(300)],t.prototype,"height",void 0),_e([sf.base.Property(400)],t.prototype,"width",void 0),_e([sf.base.Property(0)],t.prototype,"top",void 0),_e([sf.base.Property(0)],t.prototype,"left",void 0),t}(sf.base.ChildProperty);function $e(e){return e&&"="===e[0]&&e.length>1}function Ze(e){var t=e;if((t=t.split("$").join("")).indexOf(":")>-1){var r=t.split(":");if(tt(r[0])&&tt(r[1]))return!0}else if(t.indexOf(":")<0&&tt(t))return!0;return!1}function Je(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function Qe(e,t,r){return e&&t>=e[0]&&t<=e[2]&&r>=e[1]&&r<=e[3]}function et(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function tt(e){for(var t=e,r=0,n=0,i=[89,71,69],a="",s=t.length,o=0;o<s;o++)Je(t[o])&&r++;var l=(a=t.substring(0,r)).length;if(l!==s&&l<4&&1!==s&&isNaN(parseInt(t,10))){for(;n<l;){if(!(a[n]&&a[n].charCodeAt(0)<i[n])){if(!a[n]&&n>0)break;return!1}n++}var h=parseFloat(t.substring(r,s));if(h>0&&h<1048577)return!0}return!1}var rt,nt="spreadsheetLocale",it={SortOutOfRangeError:"Select a cell or range inside the used range and try again."},at=(rt=function(e,t){return(rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}rt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),st=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},ot=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return at(t,e),st([sf.base.Collection([],Ke)],t.prototype,"image",void 0),st([sf.base.Collection([],Xe)],t.prototype,"chart",void 0),st([sf.base.Property("")],t.prototype,"value",void 0),st([sf.base.Property("")],t.prototype,"formula",void 0),st([sf.base.Property(0)],t.prototype,"index",void 0),st([sf.base.Property("General")],t.prototype,"format",void 0),st([sf.base.Complex({},Ue)],t.prototype,"style",void 0),st([sf.base.Property("")],t.prototype,"hyperlink",void 0),st([sf.base.Property(!1)],t.prototype,"wrap",void 0),st([sf.base.Property(!0)],t.prototype,"isLocked",void 0),st([sf.base.Property("")],t.prototype,"validation",void 0),st([sf.base.Property(1)],t.prototype,"colSpan",void 0),st([sf.base.Property(1)],t.prototype,"rowSpan",void 0),t}(sf.base.ChildProperty);function lt(e,t,r,n,i){var a=jt(r,e);if(!a||!a.cells){if(!n)return i?{}:null;a?r.rows[e].cells=[]:r.rows[e]={cells:[]}}return r.rows[e].cells[t]||(i?{}:null)}function ht(e,t,r,n,i){r.rows[e]?r.rows[e].cells||(r.rows[e].cells=[]):r.rows[e]={cells:[]},i&&r.rows[e].cells[t]?sf.base.extend(r.rows[e].cells[t],n,null,!0):r.rows[e].cells[t]=n}function dt(e,t){var r={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},n={};return Object.keys(t?r:e).forEach((function(t){e[t]!==r[t]&&(n[t]=e[t])})),n}function pt(e,t,r){void 0===t&&(t=!0);for(var n=r.getAddressInfo(e),i=n.indices,a=kt(r,n.sheetIndex),s=i[0];s<=i[2];s++)for(var o=i[1];o<=i[3];o++)ht(s,o,a,{wrap:t},!0);r.setProperties({sheets:r.sheets},!0),n.sheetIndex===r.activeSheetIndex&&r.notify("wrapText",{range:i,wrap:t,sheet:a})}function ct(e,t,r,n){return new Promise((function(i,s){var h,d,p,c,u,f,g,m,v;i((p=new Map,c=t.indexOf("!")>-1?xt(e,It(t)):e.activeSheetIndex,u=kt(e,c),f=l(t),g=f[0],m=0,v={sheet:u,indexes:f,promise:new Promise((function(e,t){e(void 0)}))},e.notify("updateSheetFromDataSource",v),v.promise.then((function(){for(;g<=f[2];){var t={};for(d=jt(u,g),h=f[1];h<=f[3];){if(r){p instanceof Map&&(p=[]);var i=o(h+1);t[i]=n?d?ut(e,g,h,c,u):"":d?lt(g,h,u):null,f[3]<h+1&&(t.__rowIndex=(g+1).toString()),p[m.toString()]=t}else{var s={};if(Object.assign(s,d?lt(g,h,u):null),s.colSpan>1&&s.rowSpan>1)for(var l=void 0,v=g,y=g+s.rowSpan;v<y;v++)for(var C=h,b=h+s.colSpan;C<b;C++)v===g&&C===h||(l=new Object,v!==g&&(l.rowSpan=g-v),C!==h&&(l.colSpan=h-C),u.rows[v]&&u.rows[v].cells&&u.rows[v].cells[C]&&(delete u.rows[v].cells[C].value,delete u.rows[v].cells[C].formula),ht(v,C,u,l,!0));else if(s.colSpan>1)for(v=h+1,y=h+s.colSpan;v<y;v++)ht(g,v,u,{colSpan:h-v},!0),u.rows[g]&&u.rows[g].cells&&u.rows[g].cells[v]&&(delete u.rows[g].cells[v].value,delete u.rows[g].cells[v].formula);else if(s.rowSpan>1)for(v=g+1,y=g+s.rowSpan;v<y;v++)ht(v,h,u,{rowSpan:g-v},!0),u.rows[v]&&u.rows[v].cells&&u.rows[v].cells[h]&&(delete u.rows[v].cells[h].value,delete u.rows[v].cells[h].formula);if(!n&&zt(u,g)){g++;continue}if(!n&&rr(u,h)){h++;continue}if(s.style){var S={};Object.assign(S,s.style),s.style=S}var x={cell:s,address:a(g,h)};e.trigger("queryCellInfo",x),p.set(x.address,x.cell)}h++}g++,m++}return p}))))}))}function ut(e,t,r,n,i){var a=lt(t,r,i);if(a){if(a.format){var s={value:e.getDisplayText(a),rowIndex:t,colIndex:r,sheetIndex:n,dateObj:"",isDate:!1,isTime:!1};return e.notify("checkDateFormat",s),s.isDate?s.dateObj:a.value}return a.value}return""}function ft(e,t,r){for(var n,i,a,s=0,o=e.length,l=function(l){if(sf.base.isNullOrUndefined(e[l])||sf.base.isUndefined(e[l].index)||(i=s=e[l].index-l,delete e[l].index),s>0){for(n=0;s--;)t?(r.createSheet(l+n),n++):e.splice(l,0,null);l+=i,o+=i}if(t){e[l].id<1&&(e[l].id=Ft(r.sheets),e[l].properties&&(e[l].properties.id=e[l].id)),e[l].name||r.setSheetPropertyOnMute(e[l],"name","Sheet"+At(r));var h=0;e[l].rows.forEach((function(e){h=Math.max(h,e&&e.cells&&e.cells.length-1||0)})),r.setSheetPropertyOnMute(e[l],"usedRange",{rowIndex:e[l].rows.length-1,colIndex:h})}a=l},h=0;h<o;h++)l(h),h=a}function gt(e,t,r,n){for(var i,a,s=kt(e,r),o=l(t),h=o[0],d=o[2];h<=d;h++)for(i=o[1],a=o[3];i<=a;i++){var p=lt(h,i,s);e.notify("cFDelete",{rowIdx:h,colIdx:i}),!sf.base.isNullOrUndefined(p)&&n&&(delete p.value,sf.base.isNullOrUndefined(p.formula)||delete p.formula)}}var mt,vt=(mt=function(e,t){return(mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}mt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),yt=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vt(t,e),t.prototype.setProperties=function(t,r){var n=this;if(this.parentObj.isComplexArraySetter&&this.controlParent&&this.controlParent.isAngular)if(Object.keys(t).length){void 0===this.parentObj.currRangeIdx?this.parentObj.currRangeIdx=0:this.parentObj.currRangeIdx+=1;var i=this.parentObj.ranges[this.parentObj.currRangeIdx];i&&i.info&&(this.info=i.info),setTimeout((function(){void 0!==n.parentObj.currRangeIdx&&delete n.parentObj.currRangeIdx}))}else if(this.controlParent.tagObjects[0].instance&&this.controlParent.tagObjects[0].instance.hasChanges&&!this.controlParent.tagObjects[0].instance.isInitChanges){var a=this.controlParent.sheets.indexOf(this.parentObj);if(void 0===this.parentObj.changedRangeIdx){for(var s,o=this.controlParent.tagObjects[0].instance.list[a].tagObjects,l=0;l<o.length;l++)if("ranges"===o[l].name){o[l].instance.list.forEach((function(e,t){e.hasChanges&&(s=t)}));break}this.parentObj.changedRangeIdx=s}}e.prototype.setProperties.call(this,t,r)},yt([sf.base.Property(null)],t.prototype,"dataSource",void 0),yt([sf.base.Property("A1")],t.prototype,"startCell",void 0),yt([sf.base.Property(null)],t.prototype,"query",void 0),yt([sf.base.Property(!0)],t.prototype,"showFieldAsHeader",void 0),yt([sf.base.Property("")],t.prototype,"template",void 0),yt([sf.base.Property("A1")],t.prototype,"address",void 0),t}(sf.base.ChildProperty),bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vt(t,e),yt([sf.base.Property(0)],t.prototype,"rowIndex",void 0),yt([sf.base.Property(0)],t.prototype,"colIndex",void 0),t}(sf.base.ChildProperty),St=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vt(t,e),yt([sf.base.Property(null)],t.prototype,"rows",void 0),yt([sf.base.Property([])],t.prototype,"columns",void 0),yt([sf.base.Complex({},qe)],t.prototype,"protectSettings",void 0),yt([sf.base.Collection([],Ct)],t.prototype,"ranges",void 0),yt([sf.base.Collection([],Ye)],t.prototype,"conditionalFormats",void 0),yt([sf.base.Property(0)],t.prototype,"index",void 0),yt([sf.base.Property("")],t.prototype,"name",void 0),yt([sf.base.Property(100)],t.prototype,"rowCount",void 0),yt([sf.base.Property(100)],t.prototype,"colCount",void 0),yt([sf.base.Property("A1:A1")],t.prototype,"selectedRange",void 0),yt([sf.base.Property("A1")],t.prototype,"activeCell",void 0),yt([sf.base.Property({})],t.prototype,"usedRange",void 0),yt([sf.base.Property("A1")],t.prototype,"topLeftCell",void 0),yt([sf.base.Property(!0)],t.prototype,"showHeaders",void 0),yt([sf.base.Property(!0)],t.prototype,"showGridLines",void 0),yt([sf.base.Property(!1)],t.prototype,"isProtected",void 0),yt([sf.base.Property("Visible")],t.prototype,"state",void 0),t}(sf.base.ChildProperty);function xt(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){r=n;break}return r}function wt(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){r=n;break}return r}function It(e){return e.split("!")[0].replace(/\'/gi,"")}function Et(e,t,r){for(var n=r.length,i=0;i<n;i++)if(r[i].sheet.toUpperCase()===t.toUpperCase())return r[i].index;return-1}function Rt(e,t,r){void 0===r&&(r={}),e.setSheetPropertyOnMute(r,"selectedRange",t)}function kt(e,t){return e.sheets[t]}function At(e){var t=[];e.sheets.forEach((function(e){t.push(e.name.toLowerCase())}));for(var r=0;r<t.length;r++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function Ft(e){var t=0;return e.forEach((function(e){t=Math.max(e.id,t)})),t+1}function Tt(e,t){var r=t||e.sheets;r.forEach((function(t){var r;t.id=t.id||0,t.name=t.name||"",t.rowCount=sf.base.isUndefined(t.rowCount)?100:t.rowCount,t.colCount=sf.base.isUndefined(t.colCount)?100:t.colCount,t.topLeftCell=t.topLeftCell||"A1",t.activeCell=t.activeCell||"A1",t.selectedRange=t.selectedRange||"A1:A1",t.usedRange=t.usedRange||{rowIndex:0,colIndex:0},e.setSheetPropertyOnMute(t,"ranges",t.ranges?t.ranges:[]),e.setSheetPropertyOnMute(t,"rows",t.rows||[]),e.setSheetPropertyOnMute(t,"columns",t.columns||[]),t.showHeaders=!!sf.base.isUndefined(t.showHeaders)||t.showHeaders,t.showGridLines=!!sf.base.isUndefined(t.showGridLines)||t.showGridLines,t.state=t.state||"Visible",t.maxHgts=[],t.protectSettings=t.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},t.isProtected=t.isProtected||!1,ft(t.columns),(r=t.rows).forEach((function(e){e&&e.cells&&ft(e.cells)})),ft(r)})),ft(r,!0,e)}function Ot(e,t){return void 0===t&&(t=e.activeSheetIndex),kt(e,t).name}var Nt,Dt,Lt=function(){function e(){this.services={}}return e.prototype.getService=function(e){if(sf.base.isNullOrUndefined(this.services[e]))throw"The service "+e+" is not registered";return this.services[e]},e.prototype.register=function(e,t){sf.base.isNullOrUndefined(this.services[e])&&(this.services[e]=t)},e}(),Bt=(Nt=function(e,t){return(Nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Nt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Ht=function(){return(Ht=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Mt=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Pt=function(e){function t(t){var r=e.call(this,t)||this;return r.isEdit=!1,r.sheetNameCount=1,r.isOpen=!1,r.chartColl=[],r.chartCount=1,n.Inject(B,Q,$,O,Ie,Ee,Ce,be,Re,Se,ke,Te,Fe,Oe,Ne,De,xe,we),r.commonCellStyle={},t&&t.cellStyle&&(r.commonCellStyle=t.cellStyle),"workbook"===r.getModuleName()&&(r.serviceLocator=new Lt,r.initWorkbookServices(),r.dataBind(),r.initEmptySheet()),r}var n;return Bt(t,e),n=t,t.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=dt(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()},t.prototype.initWorkbookServices=function(){this.serviceLocator.register(nt,new sf.base.L10n(this.getModuleName(),it,this.locale))},t.prototype.render=function(){},t.prototype.requiredModules=function(){return He(this)},t.prototype.getPersistData=function(){return this.addOnPersist([])},t.prototype.cellFormat=function(e,t){var r=this.getActiveSheet();t=t||r.selectedRange,this.notify(E,{style:e,range:t,refreshRibbon:t.indexOf(r.activeCell)>-1})},t.prototype.lockCells=function(e,t){var r=this.getActiveSheet();e=e||r.selectedRange,this.notify("setLockCells",{range:e,isLocked:t})},t.prototype.getCellStyleValue=function(e,t){var r=this,n=lt(t[0],t[1],this.getActiveSheet()),i={};return e.forEach((function(e){i[e]=r.cellStyle[e],n&&n.style&&n.style[e]&&(i[e]=n.style[e])})),i},t.prototype.numberFormat=function(e,t){this.notify("applyNumber",{format:e,range:t})},t.prototype.createSheet=function(e,t){var r;void 0===e&&(e=this.sheets.length),void 0===t&&(t=[{}]),(r=this.sheets).splice.apply(r,[e,0].concat(t)),Tt(this,t),this.notify("sheetCreated",{sheetIndex:e||0,sheets:t}),this.notify(k,{action:"registerSheet",sheetIndex:e||0,sheetCount:e+t.length})},t.prototype.removeSheet=function(e){this.sheets.splice(e,1)},t.prototype.destroy=function(){this.notify("workbookDestroyed",null),e.prototype.destroy.call(this)},t.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){switch(n[r]){case"cellStyle":sf.base.merge(this.commonCellStyle,dt(e.cellStyle));break;case"sheets":Tt(this)}}},t.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},t.prototype.hideRow=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)qt(n,i,{hidden:r})},t.prototype.hideColumn=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)Qt(n,i,{hidden:r})},t.prototype.setBorder=function(e,t,r){this.notify(E,{style:e,borderType:r,range:t||this.getActiveSheet().selectedRange})},t.prototype.insertRow=function(e,t,r){this.notify("insertModel",{model:this.getSheetModel(r),start:e,end:t,modelType:"Row"})},t.prototype.insertColumn=function(e,t,r){this.notify("insertModel",{model:this.getSheetModel(r),start:e,end:t,modelType:"Column"})},t.prototype.insertSheet=function(e,t){this.notify("insertModel",{model:this,start:e,end:t,modelType:"Sheet"})},t.prototype.delete=function(e,t,r,n){var i;if(e=e||0,r&&"Sheet"!==r){if(!(i=this.getSheetModel(n)))return}else i=this;this.notify("deleteModel",{model:i,start:e,end:sf.base.isNullOrUndefined(t)?e:t,modelType:r||"Sheet"})},t.prototype.getSheetModel=function(e){if(sf.base.isNullOrUndefined(e))return this.getActiveSheet();var t="string"==typeof e?xt(this,e):e;return sf.base.isNullOrUndefined(t)||t>=this.sheets.length?null:this.sheets[t]},t.prototype.merge=function(e,t){var r=this.getAddressInfo(e).sheetIndex,n=kt(this,r);e=e||n.selectedRange,this.notify(T,{merge:!0,range:e,type:t||"All",sheet:n,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==r})},t.prototype.computeExpression=function(e){var t={action:"computeExpression",formula:e};return this.notify(k,t),t.calcValue},t.prototype.initEmptySheet=function(){this.sheets.length?Tt(this):this.createSheet()},t.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetIndex]},t.prototype.skipHiddenSheets=function(e,t,r){return void 0===r&&(r=0),this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e&&e+1===this.sheets.length?e=t-1:e<t?e--:e++,e=this.skipHiddenSheets(e,t,++r)),r===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e},t.prototype.setUsedRange=function(e,t,r){void 0===r&&(r=this.getActiveSheet()),e>r.usedRange.rowIndex&&(r.usedRange.rowIndex=e,r===this.getActiveSheet()&&this.notify("updateUsedRange",{index:e,update:"row"})),t>r.usedRange.colIndex&&(r.usedRange.colIndex=t,r===this.getActiveSheet()&&this.notify("updateUsedRange",{index:t,update:"col"}))},t.prototype.getData=function(e){return ct(this,e)},t.prototype.getModuleName=function(){return"workbook"},t.prototype.getValueRowCol=function(e,t,r){var n={action:"getSheetInfo",sheetInfo:[]};if(this.notify(k,n),-1===Et(0,"Sheet"+(e+1),n.sheetInfo)){var i={action:"getReferenceError",refError:""};return this.notify(k,i),i.refError}var a=lt(t-1,r-1,kt(this,e=wt(this,e+1)));return a&&a.value||""},t.prototype.setValueRowCol=function(e,t,r,n){e=wt(this,e),this.notify("workbookEditOperation",{action:"updateCellValue",address:[r-1,n-1],value:t,sheetIndex:e,isValueOnly:!0})},t.prototype.open=function(e){this.notify("workbookOpen",e)},t.prototype.openFromJson=function(e){this.isOpen=!0;var t="object"===r(e.file)?JSON.stringify(e.file):e.file;this.notify("workbookOpen",{jsonObject:t})},t.prototype.save=function(e){if(void 0===e&&(e={}),this.allowSave){var t={url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},r=Ht({},t,e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1});this.trigger("beforeSave",r),this.notify(G,{eventArgs:r,action:"beforeSave"}),r.cancel||this.notify("beginSave",{saveSettings:r,isFullPost:r.isFullPost,needBlobData:r.needBlobData,customParams:r.customParams})}},t.prototype.saveAsJson=function(){var e=this;return new Promise((function(t){e.on("onSave",(function(r){r.cancel=!0,e.off("onSave"),t({jsonObject:{Workbook:r.jsonObject}}),e.notify("saveCompleted",r)})),e.save()}))},t.prototype.addHyperlink=function(e,t){var r={hyperlink:e,cell:t};this.notify("setLinkModel",r)},t.prototype.findHandler=function(e){"next"===e.findOpt?this.notify("findNext",e):"prev"===e.findOpt&&this.notify("findPrevious",e)},t.prototype.replaceHandler=function(e){"replace"===e.replaceBy?this.notify("replace",e):this.notify("replaceAll",e)},t.prototype.protectSheet=function(e,t){this.notify("protectsheetHandler",t)},t.prototype.unprotectSheet=function(e){var t={sheet:e};this.notify("unprotectsheetHandler",t)},t.prototype.sort=function(e,t){if(!this.allowSorting)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise((function(e,t){e(void 0)}))};return this.notify("initiateSort",r),r.promise},t.prototype.addDataValidation=function(e,t){var r={range:t=t||this.getActiveSheet().selectedRange,type:e.type,operator:e.operator,value1:e.value1,value2:e.value2,ignoreBlank:e.ignoreBlank,inCellDropDown:e.inCellDropDown,cancel:!1};this.notify(G,{eventArgs:r,action:"validation"}),r.cancel||(t=r.range,e.type=r.type,e.operator=r.operator,e.value1=r.value1,e.value2=r.value2,e.ignoreBlank=r.ignoreBlank,e.inCellDropDown=r.inCellDropDown,this.notify("setValidation",{rules:e,range:t}),delete r.cancel,this.notify(W,{eventArgs:r,action:"validation"}))},t.prototype.removeDataValidation=function(e){this.notify("removeValidation",{range:e})},t.prototype.addInvalidHighlight=function(e){this.notify("addHighlight",{range:e})},t.prototype.removeInvalidHighlight=function(e){this.notify("removeHighlight",{range:e})},t.prototype.conditionalFormat=function(e){e.range=e.range||this.getActiveSheet().selectedRange,this.notify("setCFRule",{conditionalFormat:e})},t.prototype.clearConditionalFormat=function(e){e=e||this.getActiveSheet().selectedRange,this.notify("clearCFRule",{range:e})},t.prototype.updateCell=function(e,t){var r,n=l(t);t.includes("!")?void 0===(r=xt(this,t.split("!")[0]))&&(r=this.activeSheetIndex):r=this.activeSheetIndex,ht(n[0],n[1],this.sheets[r],e,!0),e.value&&this.notify("workbookEditOperation",{action:"updateCellValue",address:n,value:e.value,sheetIndex:r})},t.prototype.wrap=function(e,t){void 0===t&&(t=!0),pt(e,t,this)},t.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(k,t),t.isAdded},t.prototype.removeDefinedName=function(e,t){void 0===t&&(t="");var r={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(k,r),r.isRemoved},t.prototype.clearRange=function(e,t,r){void 0===r&&(r=!0),gt(this,e||this.getActiveSheet().selectedRange,sf.base.isNullOrUndefined(t)?this.activeSheetIndex:t,r)},t.prototype.insertImage=function(e,t){this.notify("setImage",{options:e,range:t||this.getActiveSheet().selectedRange})},t.prototype.insertChart=function(e){this.notify("setChart",{chart:e})},t.prototype.deleteChart=function(e){this.notify("deleteChart",{id:e})},t.prototype.filter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise((function(e,t){e(void 0)}))};return this.notify("initiateFilter",r),r.promise},t.prototype.clearFilter=function(){this.notify("clearAllFilter",null)},t.prototype.addCustomFunction=function(e,t){t=t||("string"==typeof e?e:e.name.replace("bound ",""));var r={action:"addCustomFunction",functionHandler:e,functionName:t};this.notify(k,r)},t.prototype.clear=function(e){this.notify("clear",e)},t.prototype.getDisplayText=function(e){if(!e)return"";if(e.value&&e.format){var t={formattedText:e.value,value:e.value,format:e.format,onLoad:!0};return this.notify("getFormattedCell",t),t.formattedText}return!e.value&&e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address:e.value?e.value.toString():""},t.prototype.getAddressInfo=function(e){return p(this,e)},t.prototype.setSheetPropertyOnMute=function(e,t,r){this.isProtectedOnChange=!0,e[t]=r,this.isProtectedOnChange=!1},Mt([sf.base.Collection([],St)],t.prototype,"sheets",void 0),Mt([sf.base.Property(0)],t.prototype,"activeSheetIndex",void 0),Mt([sf.base.Property("100%")],t.prototype,"height",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowFindAndReplace",void 0),Mt([sf.base.Property()],t.prototype,"filterCollection",void 0),Mt([sf.base.Property("100%")],t.prototype,"width",void 0),Mt([sf.base.Property(!0)],t.prototype,"showRibbon",void 0),Mt([sf.base.Property(!0)],t.prototype,"showFormulaBar",void 0),Mt([sf.base.Property(!0)],t.prototype,"showSheetTabs",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowEditing",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowOpen",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowSave",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowSorting",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowFiltering",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowNumberFormatting",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowCellFormatting",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowHyperlink",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowInsert",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowDelete",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowMerge",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowDataValidation",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowImage",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowChart",void 0),Mt([sf.base.Property(!0)],t.prototype,"allowConditionalFormat",void 0),Mt([sf.base.Complex({},Ue)],t.prototype,"cellStyle",void 0),Mt([sf.base.Property("")],t.prototype,"openUrl",void 0),Mt([sf.base.Property("")],t.prototype,"saveUrl",void 0),Mt([sf.base.Collection([],je)],t.prototype,"definedNames",void 0),Mt([sf.base.Event()],t.prototype,"beforeOpen",void 0),Mt([sf.base.Event()],t.prototype,"openFailure",void 0),Mt([sf.base.Event()],t.prototype,"beforeSave",void 0),Mt([sf.base.Event()],t.prototype,"saveComplete",void 0),Mt([sf.base.Event()],t.prototype,"beforeCellFormat",void 0),Mt([sf.base.Event()],t.prototype,"queryCellInfo",void 0),t=n=Mt([sf.base.NotifyPropertyChanges],t)}(sf.base.Component),_t=(Dt=function(e,t){return(Dt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Dt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Ut=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _t(t,e),Ut([sf.base.Collection([],ot)],t.prototype,"cells",void 0),Ut([sf.base.Property(0)],t.prototype,"index",void 0),Ut([sf.base.Property(20)],t.prototype,"height",void 0),Ut([sf.base.Property(!1)],t.prototype,"customHeight",void 0),Ut([sf.base.Property(!1)],t.prototype,"hidden",void 0),Ut([sf.base.Complex({},Ge)],t.prototype,"format",void 0),t}(sf.base.ChildProperty);function jt(e,t){return e.rows[t]}function qt(e,t,r){e.rows[t]||(e.rows[t]={}),Object.keys(r).forEach((function(n){e.rows[t][n]=r[n]}))}function zt(e,t){return e.rows[t]&&e.rows[t].hidden}function Wt(e,t){return e&&e.rows&&e.rows[t]?e.rows[t].hidden?0:void 0===e.rows[t].height?20:e.rows[t].height:20}function Gt(e,t,r){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=r)}function Yt(e,t,r){void 0===r&&(r=t);var n,i=0;t>r&&(n=t,t=r,r=n);for(var a=t;a<=r;a++)i+=Wt(e,a);return i}var Xt,Kt=(Xt=function(e,t){return(Xt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Xt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),$t=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Kt(t,e),$t([sf.base.Property(0)],t.prototype,"index",void 0),$t([sf.base.Property(64)],t.prototype,"width",void 0),$t([sf.base.Property(!1)],t.prototype,"customWidth",void 0),$t([sf.base.Property(!1)],t.prototype,"hidden",void 0),$t([sf.base.Complex({},Ge)],t.prototype,"format",void 0),$t([sf.base.Property(!0)],t.prototype,"isLocked",void 0),t}(sf.base.ChildProperty);function Jt(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function Qt(e,t,r){var n=Jt(e,t);Object.keys(r).forEach((function(e){n[e]=r[e]}))}function er(e,t,r){return e&&e.columns&&e.columns[t]?!r&&e.columns[t].hidden?0:e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64:64}function tr(e,t,r){void 0===r&&(r=t);var n=0;if(t>r){var i=t;t=r,r=i}for(var a=t;a<=r;a++)n+=er(e,a);return n}function rr(e,t){return e.columns[t]&&e.columns[t].hidden}function nr(e){var t=[];return function(e,t){t.push({member:"basic",args:[]}),t.push({member:"all",args:[]}),e.showRibbon&&t.push({member:"ribbon",args:[e]});e.showFormulaBar&&t.push({member:"formulaBar",args:[e]});e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]});e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]}));e.allowOpen&&t.push({member:"open",args:[e]});e.allowSave&&t.push({member:"save",args:[e]});e.enableContextMenu&&t.push({member:"contextMenu",args:[e]});"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]});e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]});e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]});e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]});e.enableClipboard&&t.push({member:"clipboard",args:[e]});e.allowCellFormatting&&t.push({member:"cellformat",args:[e]});e.allowSorting&&t.push({member:"sort",args:[e]});e.allowResizing&&t.push({member:"resize",args:[e]});t.push({member:"collaborativeEditing",args:[e]}),t.push({member:"protectSheet",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]});e.allowUndoRedo&&t.push({member:"undoredo",args:[e]});e.allowFiltering&&t.push({member:"filter",args:[e]});e.allowWrap&&t.push({member:"wrapText",args:[e]});e.allowInsert&&t.push({member:"insert",args:[e]});e.allowDelete&&t.push({member:"delete",args:[e]});e.allowDataValidation&&t.push({member:"dataValidation",args:[e]});e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]});e.allowMerge&&t.push({member:"merge",args:[e]});e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]});e.allowImage&&t.push({member:"spreadsheetImage",args:[e]});e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}(e,t),He(e,t),t}function ir(e){requestAnimationFrame((function(){e()}))}function ar(e,t){for(;e.firstChild;)e.removeChild(e.firstChild)}function sr(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}var or=null;function lr(){if(null!==or)return or;var e,t=document.createElement("div");return t.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(t),e=t.offsetWidth-t.clientWidth|0,document.body.removeChild(t),or=e}var hr=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"];function dr(e,t){return void 0===t&&(t=hr),pr(e,"previous",t)+pr(e,"next",t)}function pr(e,t,r){for(var n=e[t+"ElementSibling"],i=0;n;)r.some((function(e){return n.classList.contains(e)}))&&(i+=n.offsetHeight),n=n[t+"ElementSibling"];return i}function cr(e,t,r){if(e.scrollSettings.enableVirtualization){var n=e.viewport.topIndex,i=e.viewport.leftIndex,a=n+e.viewport.rowCount+2*e.getThreshold("row"),s=i+e.viewport.colCount+2*e.getThreshold("col"),o=n<=t[0]&&a>=t[2]&&i<=t[1]&&s>=t[3];if(o)return!0;if(r){if(t[0]<n&&t[2]<n||t[0]>a&&t[2]>a)return!1;if(t[0]<n&&t[2]>n&&(t[0]=n,o=!0),t[2]>a&&(t[2]=a,o=!0),t[1]<i&&t[3]<i||t[1]>s&&t[3]>s)return!1;t[1]<i&&t[3]>i&&(t[1]=i,o=!0),t[3]>s&&(t[3]=s,o=!0)}return o}return!0}function ur(e,t,r){var n;void 0===r&&(r={left:{idx:0,size:0},top:{idx:0,size:0}});var i=r.top.size,a=r.left.size;for(n=r.top.idx;n<t[0];n++)i+=Yt(e,n);for(n=r.left.idx;n<t[1];n++)a+=tr(e,n);return{top:i,left:a}}function fr(e,t,r,n,i){var a=c(t),s=ur(r,a,i),o=[Pr(r,0,!0),Pr(r,0,!0,"columns")],l={top:(a[0]===o[0]?s.top:s.top-1)+"px",height:Yt(r,t[0],t[2])+(a[0]===o[0]?0:1)+"px",width:tr(r,t[1],t[3])+(a[1]===o[1]?0:1)+"px"};l[n?"right":"left"]=(a[1]===o[1]?s.left:s.left-1)+"px",e&&gr([{element:e,attrs:l}])}function gr(e){requestAnimationFrame((function(){e.forEach((function(e){sf.base.setStyleAttribute(e.element,e.attrs)}))}))}function mr(){return sf.base.Browser.isPointer?"pointerdown":"mousedown touchstart"}function vr(){return sf.base.Browser.isPointer?"pointermove":"mousemove touchmove"}function yr(){return sf.base.Browser.isPointer?"pointerup":"mouseup touchend"}function Cr(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function br(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function Sr(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function xr(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function wr(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}var Ir={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"};function Er(e,t){Object.keys(t).forEach((function(r){e&&e.setAttribute(Ir[r],t[r])}))}function Rr(e,t){if(e){var r=sf.base.getComponent(e,t);r&&r.destroy()}}function kr(e,t,r,n){var i,a,s,o,l,h,d,p,c,u=n.getActiveSheet();if(r)u.showHeaders&&(i=n.element.getElementsByClassName("e-column-header")[0].getElementsByTagName("th")[e],a=n.element.getElementsByClassName("e-column-header")[0].getElementsByTagName("col")[e]),s=n.element.getElementsByClassName("e-sheet-content")[0].getElementsByTagName("col")[e];else{u.showHeaders&&(i=n.element.getElementsByClassName("e-row-header")[0].getElementsByTagName("tr")[e],(a=n.element.getElementsByClassName("e-row-header")[0].getElementsByTagName("tr")[e]).style.height=parseInt(t,10)>0?t:"2px"),(s=n.element.getElementsByClassName("e-sheet-content")[0].getElementsByTagName("tr")[e]).style.height=parseInt(t,10)>0?t:"0px";var f=void 0;if(u.showHeaders){var g=n.getRowHeaderContent().getElementsByClassName("e-row"),m=[];m[0]=g[e].getElementsByTagName("td")[0].cloneNode(!0),f=Fr(n.getRowHeaderTable(),m,!1,n)+1}for(var v=n.getMainContent().getElementsByClassName("e-row"),y=[],C=0;C<v[e].getElementsByTagName("td").length;C++)y[C]=v[e].getElementsByTagName("td")[C].cloneNode(!0);var b=Fr(n.getContentTable(),y,!1,n)+1,S=f>=b?f:b;parseInt(s.style.height,10)<S||i&&i.classList.contains("e-reach-fntsize")&&parseInt(s.style.height,10)===S?(u.showHeaders&&(i.classList.add("e-reach-fntsize"),a.style.lineHeight=parseInt(t,10)>=4?parseInt(t,10)-4+"px":parseInt(t,10)>0?parseInt(t,10)-1+"px":"0px"),s.style.lineHeight=parseInt(t,10)>0?parseInt(t,10)-1+"px":"0px"):(a&&a.style.removeProperty("line-height"),s.style.removeProperty("line-height"),i&&i.classList.contains("e-reach-fntsize")&&i.classList.remove("e-reach-fntsize"))}if(h=s.previousElementSibling,c=s.nextElementSibling,h&&(u.showHeaders&&(o=i.previousElementSibling,l=a.previousElementSibling),h=s.previousElementSibling),c&&(u.showHeaders&&(d=i.nextElementSibling,p=a.nextElementSibling),c=s.nextElementSibling),parseInt(t,10)<=0&&!s.classList.contains("e-zero")&&!s.classList.contains("e-zero-start")){if(h&&c)if(r?(u.showHeaders&&(a.style.width="2px"),s.style.width="0px"):(u.showHeaders&&(a.style.height="2px"),s.style.height="0px"),h.classList.contains("e-zero-start")?(u.showHeaders&&i.classList.add("e-zero-start"),s.classList.add("e-zero-start")):(u.showHeaders&&i.classList.add("e-zero"),s.classList.add("e-zero")),!d||d.classList.contains("e-zero")||d.classList.contains("e-zero-last")||(u.showHeaders&&i.classList.add("e-zero-last"),s.classList.add("e-zero-last")),h.classList.contains("e-zero-last")&&(u.showHeaders&&o.classList.remove("e-zero-last"),h.classList.remove("e-zero-last")),u.showHeaders&&o.classList.contains("e-zero")?(i.classList.contains("e-zero-end"),Ar(l,-2,r)):u.showHeaders&&Ar(l,-1,r),u.showHeaders&&o.classList.contains("e-zero-start")&&Ar(a,-1,r),u.showHeaders&&d.classList.contains("e-zero"))if(i.classList.contains("e-zero-start"))for(;d;){if(d.classList.contains("e-zero")&&0!==parseInt(p.style.height,10)&&!r||0!==parseInt(p.style.width,10)&&r){r?(a.style.width=parseInt(a.style.width,10)-1+"px",p.style.width=parseInt(p.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",p.style.height=parseInt(p.style.height,10)-1+"px"),d.classList.remove("e-zero"),d.classList.add("e-zero-start");break}var x=void 0;d.classList.remove("e-zero"),d.classList.add("e-zero-start"),r?(x=parseInt(d.getAttribute("aria-colindex"),10)-1,d=n.getColHeaderTable().getElementsByTagName("th")[x+1],p=n.getColHeaderTable().getElementsByTagName("col")[x+1]):(x=parseInt(d.getAttribute("aria-rowindex"),10)-1,d=n.getRowHeaderTable().getElementsByTagName("tr")[x+1],p=n.getRowHeaderTable().getElementsByTagName("tr")[x+1])}else Ar(a,-2,r);else u.showHeaders&&(d.classList.contains("e-zero-end")?r?a.style.width="0px":a.style.height="0px":Ar(p,-1,r));else if(h)r?(u.showHeaders&&(a.style.width="1px"),s.style.width="0px"):(u.showHeaders&&(a.style.height="1px"),s.style.height="0px"),u.showHeaders&&i.classList.add("e-zero-end"),s.classList.add("e-zero-end"),u.showHeaders&&i.classList.add("e-zero-last"),s.classList.add("e-zero-last"),u.showHeaders&&o.classList.contains("e-zero")?Ar(l,-2,r):Ar(l,-1,r);else if(d)if(i.classList.add("e-zero-start"),s.classList.add("e-zero-start"),d.classList.contains("e-zero")||(i.classList.add("e-zero-last"),s.classList.add("e-zero-last")),r?(a.style.width="1px",s.style.width="0px"):(a.style.height="1px",s.style.height="0px"),u.showHeaders&&d.classList.contains("e-zero"))for(;d;){if(d.classList.contains("e-zero")&&0!==parseInt(p.style.width,10)&&r||0!==parseInt(p.style.height,10)&&!r){r?(p.style.width=parseInt(p.style.width,10)-1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(p.style.height=parseInt(p.style.height,10)-1+"px",a.style.height=parseInt(a.style.height,10)-1+"px"),d.classList.add("e-zero-start"),d.classList.remove("e-zero");break}x=void 0;d.classList.add("e-zero-start"),d.classList.remove("e-zero"),r?(x=parseInt(d.getAttribute("aria-colindex"),10)-1,p=n.getColHeaderTable().getElementsByTagName("col")[x+1],d=n.getColHeaderTable().getElementsByTagName("th")[x+1]):(x=parseInt(d.getAttribute("aria-rowindex"),10)-1,p=n.getRowHeaderTable().getElementsByTagName("tr")[x+1],d=n.getRowHeaderTable().getElementsByTagName("tr")[x+1])}else u.showHeaders&&Ar(p,-1,r)}else parseInt(t,10)>0&&(r?(u.showHeaders&&(a.style.width=t),s.style.width=t):(u.showHeaders&&(a.style.height=t),s.style.height=t),u.showHeaders&&o&&d?(o.classList.contains("e-zero")?i.classList.contains("e-zero")?r?(l.style.width=parseInt(l.style.width,10)+2+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(l.style.height=parseInt(l.style.height,10)+2+"px",a.style.height=parseInt(a.style.height,10)-1+"px"):Ar(a,-1,r):i.classList.contains("e-zero")?Ar(l,1,r):i.classList.contains("e-zero-start")&&(r?(l.style.width=parseInt(l.style.width,10)+1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(l.style.height=parseInt(l.style.height,10)+1+"px",a.style.height=parseInt(a.style.height,10)-1+"px")),d.classList.contains("e-zero")?Ar(a,-1,r):(i.classList.contains("e-zero")||i.classList.contains("e-zero-start"))&&Ar(p,1,r),i.classList.contains("e-zero")&&i.classList.remove("e-zero"),i.classList.contains("e-zero-start")&&i.classList.remove("e-zero-start"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"),i.classList.contains("e-zero-last")&&i.classList.remove("e-zero-last"),s.classList.contains("e-zero-last")&&s.classList.remove("e-zero-last"),(o.classList.contains("e-zero")||o.classList.contains("e-zero-start"))&&(o.classList.add("e-zero-last"),h.classList.add("e-zero-last"))):u.showHeaders&&o?(o.classList.contains("e-zero")?i.classList.contains("e-zero")?r?(a.style.width=parseInt(a.style.width,10)-1+"px",l.style.width=parseInt(l.style.width,10)+2+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",l.style.height=parseInt(l.style.height,10)+2+"px"):Ar(a,-1,r):i.classList.contains("e-zero")?Ar(l,1,r):Ar(a,-1,r),i.classList.contains("e-zero")&&i.classList.remove("e-zero"),i.classList.contains("e-zero-end")&&i.classList.remove("e-zero-end"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-end")&&s.classList.remove("e-zero-end")):u.showHeaders&&d&&(d.classList.contains("e-zero")?Ar(a,-1,r):i.classList.contains("e-zero-start")&&(Ar(p,1,r),i.classList.remove("e-zero-start")),i.classList.contains("e-zero")&&i.classList.remove("e-zero"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),i.classList.contains("e-zero-start")&&i.classList.remove("e-zero-start"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start")))}function Ar(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function Fr(e,t,r,n,i,a){var s,o,l=n.createElement("div",{className:n.element.className,styles:"display: block"}),h=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),d=n.createElement("tr");return r?t.forEach((function(e){var t=d.cloneNode();t.appendChild(e),h.appendChild(t)})):(t.forEach((function(e){d.appendChild(e.cloneNode(!0))})),h.appendChild(d)),l.appendChild(h),document.body.appendChild(l),a?(o=parseInt(i,10),s=parseInt(i,10)):(o=h.getBoundingClientRect().height,s=h.getBoundingClientRect().width),document.body.removeChild(l),r?Math.ceil(s):Math.ceil(o)}function Tr(e,r,n){var i=e.eventArgs;switch(e.action){case"sorting":var a={args:{range:e.eventArgs.range,sortOptions:e.eventArgs.sortOptions,cancel:!1},promise:new Promise((function(e,t){e(void 0)}))};r.notify("initiateSort",a),a.promise.then((function(e){r.serviceLocator.getService("cell").refreshRange(l(e.range))}));break;case"cellSave":var s=e.eventArgs,o=i.formula?{formula:s.formula}:{value:s.value};r.updateCell(o,s.address);break;case"cellDelete":r.clearRange(e.eventArgs.address,null,!0),r.serviceLocator.getService("cell").refreshRange(t(e.eventArgs.address));break;case"format":"CellFormat"===i.requestType?r.cellFormat(i.style,i.range):r.numberFormat(i.format,i.range);break;case"clipboard":if(i.copiedInfo.isCut&&!n)return;(i.copiedInfo.isCut?r.cut(i.copiedRange):r.copy(i.copiedRange)).then((function(e){r.paste(i.pastedRange,i.type)}));break;case"gridLines":r.setSheetPropertyOnMute(r.sheets[i.sheetIdx],"showGridLines",i.isShow);break;case"headers":r.setSheetPropertyOnMute(r.sheets[i.sheetIdx],"showHeaders",i.isShow);break;case"resize":case"resizeToFit":i.isCol?void 0===i.hide?r.setColWidth(i.width,i.index,i.sheetIdx):r.hideColumn(i.index,i.index,i.hide):void 0===i.hide?r.setRowHeight(i.height,i.index,i.sheetIdx):r.hideRow(i.index,i.index,i.hide);break;case"renameSheet":r.setSheetPropertyOnMute(r.sheets[i.index-1],"name",i.value);break;case"removeSheet":r.notify("removeSheetTab",{index:i.index,isAction:!0,count:i.sheetCount,clicked:!0});break;case"wrap":pt(e.eventArgs.address,e.eventArgs.wrap,r);break;case"hideShow":i.isCol?r.hideColumn(i.startIndex,i.endIndex,i.hide):r.hideRow(i.startIndex,i.endIndex,i.hide);break;case"replace":r.updateCell({value:i.compareVal},i.address);break;case"filter":r.notify("initiateFilterUI",{predicates:null,range:i.range,sIdx:i.index,isCut:!0});break;case"insert":!1===n?r.delete(e.eventArgs.index,e.eventArgs.index+(e.eventArgs.model.length-1),e.eventArgs.modelType):r.notify("insertModel",{model:"Sheet"===e.eventArgs.modelType?r:r.getActiveSheet(),start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,isAction:!1,checkCount:e.eventArgs.sheetCount,activeSheetIndex:e.eventArgs.activeSheetIndex});break;case"delete":!1===n?r.notify("insertModel",{model:"Sheet"===e.eventArgs.modelType?r:r.getActiveSheet(),start:e.eventArgs.deletedModel,modelType:e.eventArgs.modelType,isAction:!1,columnCellsModel:e.eventArgs.deletedCellsModel}):r.delete(e.eventArgs.startIndex,e.eventArgs.endIndex,e.eventArgs.modelType);break;case"validation":if(n){var h={type:i.type,operator:i.operator,value1:i.value1,value2:i.value2,ignoreBlank:i.ignoreBlank,inCellDropDown:i.inCellDropDown};r.notify("setValidation",{rules:h,range:i.range})}else r.notify("removeValidation",{range:i.range});break;case"merge":e.eventArgs.isAction=!1,r.notify(T,e.eventArgs);break;case"clear":r.notify("clearViewer",{options:e.eventArgs,isPublic:!0});break;case"conditionalFormat":if(n){var d={type:i.type,cFColor:i.cFColor,value:i.value,range:i.range};r.notify("setCFRule",{conditionalFormat:d})}else r.notify("clearCFRule",{range:i.range});break;case"clearCF":n?r.notify("clearCFRule",{range:i.selectedRange}):r.notify("clearCells",{conditionalFormats:i.cFormats,oldRange:i.oldRange,selectedRange:i.selectedRange});break;case"insertImage":n?r.notify("createImageElement",{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,imageId:e.eventArgs.id},range:e.eventArgs.range,isPublic:!1,isUndoRedo:!0}):r.notify("deleteImage",{id:e.eventArgs.id,sheetIdx:e.eventArgs.sheetIndex+1,range:e.eventArgs.range});break;case"imageRefresh":var p=document.getElementById(e.eventArgs.id);n?(e.eventArgs.isUndoRedo=!0,r.notify("refreshImgCellObj",e.eventArgs)):r.notify("refreshImgCellObj",{prevTop:e.eventArgs.currentTop,prevLeft:e.eventArgs.currentLeft,currentTop:e.eventArgs.prevTop,currentLeft:e.eventArgs.prevLeft,id:e.eventArgs.id,currentHeight:e.eventArgs.prevHeight,currentWidth:e.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:e.eventArgs.currentHeight,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0}),p.style.height=n?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",p.style.width=n?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",p.style.top=n?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",p.style.left=n?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px";break;case"insertChart":if(n){var c=[{type:i.type,theme:i.theme,isSeriesInRows:i.isSeriesInRows,range:i.range,id:i.id,height:i.height,width:i.width}];r.notify("setChart",{chart:c,isInitCell:i.isInitCell,isUndoRedo:!1,range:i.posRange})}else r.notify("deleteChart",{id:i.id});break;case"deleteChart":if(n)r.notify("deleteChart",{id:i.id});else{var u=[{type:i.type,theme:i.theme,isSeriesInRows:i.isSeriesInRows,range:i.range,id:i.id,height:i.height,width:i.width}];r.notify("setChart",{chart:u,isInitCell:i.isInitCell,isUndoRedo:!1,range:i.posRange})}break;case"chartRefresh":var f=document.getElementById(e.eventArgs.id);f&&(f.style.height=n?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",f.style.width=n?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",f.style.top=n?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",f.style.left=n?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px"),n?(e.eventArgs.isUndoRedo=!0,r.notify("refreshChartSize",{height:f.style.height,width:f.style.width,overlayEle:f})):r.notify("refreshChartSize",{height:f.style.height,width:f.style.width,overlayEle:f})}}function Or(e,r,n,i){for(var a,s=e.sheets[i].ranges,o=0,l=s.length;o<l;o++)if(s[o].template&&(a=t(s[o].address.length?s[o].address:s[o].startCell))[0]<=r&&a[1]<=n&&a[2]>=r&&a[3]>=n)return!0;return!1}function Nr(e,t,r,i,a,s,o){void 0===o&&(o=!0);var l=Wt(t,i),h=e.element.querySelector(".e-spreadsheet-edit");if(h&&h.innerHTML.indexOf("\n")>-1){var d=n(e.getActiveSheet().activeCell),p=lt(d[0],d[1],t),c=void 0,u=h.innerHTML.split("\n"),f=0,g=u.length;for(c=0;c<g;c++){var m=Br(u[c],er(t,d[1]),p.style,e.cellStyle);0===m&&(m=1),f+=m}r=Dr(e,p.style||e.cellStyle,f)+1}(a||e.getRow(i))&&((a||e.getRow(i)).style.height=r+"px"),(t.showHeaders&&s||e.getRow(i,e.getRowHeaderTable()))&&((s||e.getRow(i,e.getRowHeaderTable())).style.height=r+"px"),Gt(t,i,r),e.setProperties({sheets:e.sheets},!0),o&&e.notify("rowHeightChanged",{rowIdx:i,threshold:r-l})}function Dr(e,t,r){void 0===r&&(r=1);var n=t&&t.fontSize||e.cellStyle.fontSize,i=n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10);return Math.ceil(i*(t&&"Arial Black"===t.fontFamily?1.44:1.24)*r)}function Lr(e,t,r){t||(t=r);var n=document.createElement("canvas").getContext("2d");return n.font=(t.fontStyle||r.fontStyle)+" "+(t.fontWeight||r.fontWeight)+" "+(t.fontSize||r.fontSize)+" "+(t.fontFamily||r.fontFamily),n.measureText(e).width}function Br(e,t,r,n){var i,a=0,s=e.toString().split(" "),o=Lr(" ",r,n),l=0;return t-=5,s.forEach((function(e){var s=0,h=0;i=Lr(e,r,n),(a+i)/t>=1?(a&&l++,i/t>=1?(e.split("").forEach((function(e){h=Lr(e,r,n),(s+=h)>t&&(l++,s=h)})),a=s+o):a=i+o):a+=i+o})),a&&(l+=Math.ceil((a-o)/t)),l}function Hr(e,t,r,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][r]=n}function Mr(e,t){var r=0,n=e.maxHgts[t];return n&&Object.keys(n).forEach((function(e){n[e]>r&&(r=n[e])})),r}function Pr(e,t,r,n){return void 0===n&&(n="rows"),t<0&&(t=-1),e[n][t]&&e[n][t].hidden&&(r?t++:t--,t=Pr(e,t,r,n)),t}function _r(e){if(sf.base.Browser.isIE){var t=window.scrollX,r=window.scrollY;e.focus(),window.scrollTo(t,r)}else e.focus({preventScroll:!0})}var Ur,Vr=function(){function e(e){this.externalMerge=!1,this.parent=e,this.init(),this.addEventListener()}return e.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))},e.prototype.addEventListener=function(){var e=this.getClipboardEle();this.parent.on(V,this.cut,this),this.parent.on("copy",this.copy,this),this.parent.on(j,this.paste,this),this.parent.on("clearCopy",this.clearCopiedInfo,this),this.parent.on("tabSwitch",this.tabSwitchHandler,this),this.parent.on(U,this.cMenuBeforeOpenHandler,this),this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on("contentLoaded",this.initCopyIndicator,this),this.parent.on("rowHeightChanged",this.rowHeightChanged,this),sf.base.EventHandler.add(e,"cut",this.cut,this),sf.base.EventHandler.add(e,"copy",this.copy,this),sf.base.EventHandler.add(e,"paste",this.paste,this)},e.prototype.removeEventListener=function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off(V,this.cut),this.parent.off("copy",this.copy),this.parent.off(j,this.paste),this.parent.off("clearCopy",this.clearCopiedInfo),this.parent.off("tabSwitch",this.tabSwitchHandler),this.parent.off(U,this.cMenuBeforeOpenHandler),this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off("contentLoaded",this.initCopyIndicator),this.parent.off("rowHeightChanged",this.rowHeightChanged)),sf.base.EventHandler.remove(e,"cut",this.cut),sf.base.EventHandler.remove(e,"copy",this.copy),sf.base.EventHandler.remove(e,"paste",this.paste)},e.prototype.ribbonClickHandler=function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({isAction:!0});break;case t+"_copy":this.copy({isAction:!0})}_r(this.parent.element)},e.prototype.tabSwitchHandler=function(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(Mn),i=[],a=[],s=[],o=[],l=n(t.activeCell),h=lt(l[0],l[1],t),d=t.isProtected&&et(h,Jt(t,l[1]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target||(this.parent.enableContextMenuItems([r.getConstant("Paste"),r.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!d)),this.parent.enableContextMenuItems([r.getConstant("Cut")],!d)),"Content"===e.target&&d&&this.parent.enableContextMenuItems([r.getConstant("Cut"),r.getConstant("Filter"),r.getConstant("Sort")],!1),"Content"===e.target&&d&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([r.getConstant("Hyperlink")],!1),"ColumnHeader"===e.target&&t.isProtected&&(s=[r.getConstant("DeleteColumn"),r.getConstant("DeleteColumns"),r.getConstant("InsertColumn"),r.getConstant("InsertColumns")],o=[r.getConstant("HideColumn"),r.getConstant("HideColumns"),r.getConstant("UnHideColumns")],this.parent.enableContextMenuItems(s,!1),this.parent.enableContextMenuItems(o,!!t.protectSettings.formatColumns)),"RowHeader"===e.target&&t.isProtected&&(i=[r.getConstant("DeleteRow"),r.getConstant("DeleteRows"),r.getConstant("InsertRow"),r.getConstant("InsertRows")],a=[r.getConstant("HideRow"),r.getConstant("HideRows"),r.getConstant("UnHideRows")],this.parent.enableContextMenuItems(i,!1),this.parent.enableContextMenuItems(a,!!t.protectSettings.formatRows))},e.prototype.rowHeightChanged=function(e){if(this.copiedInfo&&this.copiedInfo.range[0]>e.rowIdx){var t=this.parent.element.getElementsByClassName("e-copy-indicator")[0];t&&(t.style.top=parseInt(t.style.top,10)+e.threshold+"px")}},e.prototype.cut=function(e){this.setCopiedInfo(e,!0)},e.prototype.copy=function(e){this.copiedSheet=this.parent.getActiveSheet(),this.setCopiedInfo(e,!1)},e.prototype.paste=function(e){if(!this.parent.isEdit){var r;e.isAction=!0;var n,i=e&&e.clipboardData||window.clipboardData,o=this.getCopiedIdx(),l=Object.assign({},this.copiedInfo);if(i||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){var h=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,d=kt(this.parent,h),p=c(e&&e.range||t(d.selectedRange)),u=i&&this.getExternalCells(e);if(!e.isInternal&&u&&u.internal&&(i=!1,!this.copiedInfo))return;if(i&&!u.length)return;var f=0;if(u)for(var g=0;g<u.length;g++)f=u[g].cells.length>f?u[g].cells.length:f;var m=p[0],v=i?[0,0,u.length-1,f-1]:c(this.copiedShapeInfo?t(d.selectedRange):this.copiedInfo.range),y=(p[2]-p[0]+1)%(v[2]-v[0]+1)==0&&(p[3]-p[1]+1)%(v[3]-v[1]+1)==0;r=y?p:[p[0],p[1]].concat([p[0]+v[2]-v[0],p[1]+v[3]-v[1]||p[1]]);var C={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:s(v),pastedRange:s(r),type:e&&e.type||"All",cancel:!1};if(e.isAction&&!this.copiedShapeInfo&&this.copiedInfo&&this.parent.notify(G,{eventArgs:C,action:"clipboard"}),C.cancel)return;var b=void 0,S=void 0,x=void 0,w=[],I=kt(this.parent,i?h:o);m=(p=t(C.pastedRange))[0];var E={range:v=i?[0,0,u.length-1,f-1]:c(this.copiedShapeInfo?t(d.selectedRange):this.copiedInfo.range),prevSheet:I,cancel:!1};if(r=(y=(p[2]-p[0]+1)%(v[2]-v[0]+1)==0&&(p[3]-p[1]+1)%(v[3]-v[1]+1)==0)?p:[p[0],p[1]].concat([p[0]+v[2]-v[0],p[1]+v[3]-v[1]||p[1]]),this.copiedShapeInfo&&!this.copiedInfo){var R=this.copiedShapeInfo.pictureElem;R.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify("setChart",{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,range:e.range||d.selectedRange,isIdAvailabe:!1})):this.parent.notify("createImageElement",{options:{src:R.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,imageId:this.copiedShapeInfo.isCut?R.id:""},range:s([m,p[1],m,p[1]]),isPublic:!1,isUndoRedo:!0});var k=lt(m,p[1],d);if(k&&!sf.base.isNullOrUndefined(k.image)){var A=k.image?k.image.length-1:0,F={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:Ot(this.parent)+"!"+s([m,p[1],m,p[1]]),pastedPictureElement:document.getElementById(k.image[A].id)};this.parent.notify(W,{eventArgs:F,action:"clipboard"})}}else{if(this.parent.notify("pasteMerge",E),E.cancel)return;for(var O=C.type?C.type:e.type,N=[],D=this.isInRange(v,p),L=(g=v[0],0);g<=v[2];g++,L++){D&&(N[p[0]+L]={cells:[]});for(var B=v[1],H=0;B<=v[3];B++,H++){if(D&&(N[p[0]+L].cells[p[1]+H]=lt(p[0]+L,p[1]+H,I)),b=i?u[g].cells[B]:Object.assign({},D&&N[g]&&N[g].cells[B]?N[g].cells[B]:lt(g,B,I)),this.copiedCell=[g,B],b&&e&&e.type||O){switch(O){case"Formats":b={format:b.format,style:b.style};break;case"Values":if((b={value:b.value}).value&&b.value.toString().indexOf("\n")>-1)this.parent.getCell(p[0],p[1]).classList.add("e-alt-unwrap")}S=["Formats","Values"].indexOf(e.type)>-1}if(!this.parent.scrollSettings.isFinite&&(v[2]-v[0]>1048575-p[0]||v[3]-v[1]>16383-p[1])||this.parent.scrollSettings.isFinite&&(v[2]-v[0]>d.rowCount-1-p[0]||v[3]-v[1]>d.colCount-1-p[1]))return void this.showDialog();if(y)for(var M=p[0];M<=p[2];M+=v[2]-v[0]+1)for(var P=p[1];P<=p[3];P+=v[3]-v[1]+1){if(x=lt(M+L,P+H,d)||{},!this.externalMerge&&void 0!==x.colSpan||void 0!==x.rowSpan){var _={range:(E={range:[M+L,P+H,M+L,P+H]}).range,merge:!1,isAction:!1,type:"All"};w.push(_),this.parent.activeSheetIndex===d.index&&this.parent.notify(T,_)}var U=P+H;this.externalMerge&&this.externalMergeRow===M+L?U+=1:this.externalMerge=!1;var V=this.isFormula([M+L,U]);sf.base.isNullOrUndefined(V)||(b.formula=V),this.setCell(M+L,U,d,b,S,!1,P===p[3]);var j=this.parent.activeSheetIndex,q=this.parent.getCell(M+L,U),z=a(M+L,U),Y={address:this.parent.sheets[j].name+"!"+z,requestType:"paste",value:lt(M+L,U,d)?lt(M+L,U,d).value:"",oldValue:x.value,element:q,displayText:this.parent.getDisplayText(b)};this.parent.trigger("cellSave",Y)}else Or(this.parent,g,B,o)||this.setCell(m,p[1]+H,d,b,S,!1,B===v[3]);!i&&this.copiedInfo.isCut&&this.setCell(g,B,I,null,!1,!0,B===v[3])}m++}if(this.parent.notify("refreshRibbonIcons",null),this.parent.setUsedRange(r[2]+1,r[3]),h===this.parent.activeSheetIndex&&(this.parent.serviceLocator.getService("cell").refreshRange(r),this.parent.notify("selectRange",{indexes:r})),!i&&this.copiedInfo.isCut&&(n=this.copiedInfo.isCut,o===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(v),this.clearCopiedInfo(),this.cutInfo=n),(i||D)&&this.copiedInfo&&this.clearCopiedInfo(),(i||e&&e.isAction)&&_r(this.parent.element),e.isAction){var X=l&&l.sId?wt(this.parent,l.sId):this.parent.activeSheetIndex;F={requestType:"paste",copiedInfo:l,mergeCollection:w,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:this.parent.sheets[X].name+"!"+s(l&&l.range?l.range:t(this.parent.sheets[X].selectedRange)),pastedRange:Ot(this.parent)+"!"+s(r),type:O||"All"};this.parent.notify(W,{eventArgs:F,action:"clipboard"})}if(n){this.updateFilter(l,r),Hr(I,v[0],v[1],20);var K=Mr(I,v[0]);Nr(this.parent,I,K,v[0])}}}else this.getClipboardEle().select()}},e.prototype.updateFilter=function(e,r){var n,i;this.parent.notify("getFilteredCollection",null);for(var a=0;a<this.parent.sheets.length;a++)if(this.parent.filterCollection&&this.parent.filterCollection[a]&&this.parent.filterCollection[a].sheetIdx===wt(this.parent,e.sId)){var o=e.range,l=t(this.parent.filterCollection[a].filterRange);o=c(o),l[0]>=o[0]&&l[2]<=o[2]&&(n=!0,i=[Math.abs(o[0]-l[0]),Math.abs(o[1]-l[1]),Math.abs(o[2]-l[2]),Math.abs(o[3]-l[3])])}var h=this.parent.getCell(e.range[0],e.range[1]),d=(h=h.querySelector(".e-filter-icon")?h:this.parent.getCell(e.range[2],e.range[3])).querySelector(".e-sortasc-filter"),p=h.querySelector(".e-sortdesc-filter");if(n)for(var u=0;u<this.parent.filterCollection.length;u++){var f=this.parent.filterCollection[u],g=e&&e.sId?wt(this.parent,e.sId):this.parent.activeSheetIndex;if(f.sheetIdx===g&&this.parent.notify("initiateFilterUI",{predicates:null,range:f.filterRange,sIdx:g,isCut:!0}),f.sheetIdx===g&&g===this.parent.activeSheetIndex&&(i=[r[0]+i[0],r[1]+i[1],Math.abs(r[2]-i[2]),Math.abs(r[3]-i[3])],this.parent.notify("initiateFilterUI",{predicates:null,range:s(i),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var m=this.parent.getCell(r[0],r[1]);d&&m&&m.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),p&&m&&m.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}},e.prototype.isInRange=function(e,t){return Qe(e,t[0],t[1])||Qe(e,t[2],t[3])},e.prototype.isFormula=function(e){var r,i,s;if(sf.base.isNullOrUndefined(this.copiedCell)||(s=sf.base.isNullOrUndefined(this.copiedSheet)?this.parent.getActiveSheet():this.copiedSheet,i=lt(this.copiedCell[0],this.copiedCell[1],s),sf.base.isNullOrUndefined(i)||(r=i.formula?i.formula.toUpperCase():"")),""===r||sf.base.isNullOrUndefined(r))return null;0===r.indexOf("=")&&(r=r.slice(1));var o=r.indexOf("("),l=r.indexOf(")");o>-1&&l>-1&&(r=r.slice(o+1,l));for(var h=[],d=["+","-","*","/"],p=void 0,c=r,u=0;u<d.length;u++)p=c.split(d[u]),c=p.join(",");p=c.split(",");for(var f=0;f<p.length;f++)if(Ze(p[f])){var g=n(p[f]),m=[this.copiedCell[0]-g[0],this.copiedCell[1]-g[1]];h.push(m[0]),h.push(m[1])}var v=[];for(f=0;f<h.length;f++){var y=a(e[0]-h[0+f],e[1]-h[1+f]);v.push(y),f++}for(var C=0;C<v.length;C++){if(Ze(v[C]))((g=t(v[C]))[0]<0||g[1]<0)&&(v[C]="#REF!");else v[C]="#REF!"}r=i.formula.toUpperCase();for(u=0;u<p.length;u++)for(f=0;f<v.length;f++)r=r.replace(p[u].toUpperCase(),v[f].toUpperCase()),u++;return r},e.prototype.setCell=function(e,t,r,n,i,a,s){ht(e,t,r,a?null:n,i),n&&n.formula&&this.parent.notify(k,{action:"refreshCalculate",value:a?"":n.formula,rowIndex:e,colIndex:t,sheetIndex:this.parent.activeSheetIndex,isFormula:!0}),n&&!n.formula&&this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[e,t,e,t],value:n.value}),r.name&&this.parent.getActiveSheet().name&&this.parent.serviceLocator.getService("cell").refresh(e,t,s)},e.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},e.prototype.setCopiedInfo=function(e,r){var n=this;if(!this.parent.isEdit){var i=new sf.data.Deferred;e.promise=i.promise;var a=this.parent.getActiveSheet(),o=e&&e.range||t(a.selectedRange),l={sheet:a,indexes:[0,0,a.rowCount-1,a.colCount-1],promise:new Promise((function(e,t){e(void 0)}))},h=document.getElementsByClassName("e-ss-overlay-active"),d=h.length;!a.isLocalData||e&&e.clipboardData||0!==o[0]||o[2]!==a.rowCount-1||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",l)),l.promise.then((function(){if(d>0){var t={clientY:h[0].offsetTop,isImage:!0};n.parent.notify("getRowIdxFromClientY",t);var l={clientX:h[0].offsetLeft,isImage:!0};n.parent.notify("getColIdxFromClientX",l),n.copiedShapeInfo={sId:e&&e.sId?e.sId:a.id,sheetIdx:a.index,isCut:r,pictureElem:h[0],copiedRange:s([t.clientY,l.clientX,t.clientY,l.clientX]),height:h[0].offsetHeight,width:h[0].offsetWidth,chartInfo:n.getChartElemInfo(h[0],r)},n.hidePaste(!0),r&&(h[0].classList.contains("e-datavisualization-chart")?n.parent.deleteChart(n.copiedShapeInfo.chartInfo.id):n.parent.notify("deleteImage",{id:n.copiedShapeInfo.pictureElem.id,sheetIdx:n.copiedShapeInfo.sId,range:n.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(n.copiedInfo&&n.clearCopiedInfo(),n.copiedInfo={range:o,sId:e&&e.sId?e.sId:a.id,isCut:r},n.hidePaste(!0),n.initCopyIndicator(),sf.base.Browser.isIE||n.getClipboardEle().select(),e&&e.isAction&&document.execCommand(r?"cut":"copy"),n.parent.hideSpinner());sf.base.Browser.isIE&&n.setExternalCells(e),i.resolve()})),e&&e.clipboardData&&(this.setExternalCells(e),_r(this.parent.element))}},e.prototype.getChartElemInfo=function(e,t){var r=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var n=e.getElementsByClassName("e-control")[0].id,i=0;i<r.length;i++){if(r[i].id===n)return r[i]}return null},e.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&sf.base.detach(this.parent.getMainContent().getElementsByClassName("e-copy-indicator")[0]),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())},e.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),fr(e,this.copiedInfo.range,this.parent.getActiveSheet(),!1),this.parent.getMainContent().appendChild(e)}},e.prototype.showDialog=function(){var e=this;this.parent.serviceLocator.getService(Pn).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Mn).getConstant("PasteAlert"),beforeOpen:function(t){var r={dialogName:"PasteDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0)}})},e.prototype.hidePaste=function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify("enableToolbarItems",[{items:[this.parent.element.id+"_paste"],enable:e||!1}])},e.prototype.setExternalCells=function(e){for(var t,r="",n=this.copiedInfo.range,i=this.parent.getActiveSheet(),a='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml"><tbody>',s=n[0];s<=n[2];s++){a+="<tr>";for(var o=n[1];o<=n[3];o++){if(t=lt(s,o,i),a+='<td style="white-space:'+(t&&t.wrap?"normal":"nowrap")+";vertical-align:bottom;",t&&t.style&&Object.keys(t.style).forEach((function(e){var r=e.match(/[A-Z]/);a+=("backgroundColor"===e?"background":r?e.replace(r[0],"-"+r[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?t.style[e].slice(0,7):t.style[e])+";"})),a+='">',t&&t.value){var l={formattedText:t.value,value:t.value,format:t.format,onLoad:!0};t.format&&this.parent.notify("getFormattedCell",l),a+=l.formattedText,r+=l.formattedText}a+="</td>",r+=o===n[3]?"":"\t"}a+="</tr>",r+=s===n[2]?"":"\n"}a+="</tbody></table></body></html>",sf.base.Browser.isIE?window.clipboardData.setData("text",r):(e.clipboardData.setData("text/html",a),e.clipboardData.setData("text/plain",r),e.preventDefault())},e.prototype.getExternalCells=function(e){var t,r,n,i=this,a=[],s=[],o=this.parent.createElement("span");return sf.base.Browser.isIE?r=window.clipboardData.getData("text"):(t=e.clipboardData.getData("text/html"),r=e.clipboardData.getData("text/plain"),o.innerHTML=t),o.querySelector("table")?o.querySelector(".e-spreadsheet")?a={internal:!0}:o.querySelectorAll("tr").forEach((function(e){e.querySelectorAll("td").forEach((function(e,t){n=i.getStyle(e,o),e.textContent=e.textContent.replace(/(\r\n|\n|\r)/gm,"");var r=isNaN(parseInt(e.getAttribute("colspan"),10))?1:parseInt(e.getAttribute("colspan"),10),a=isNaN(parseInt(e.getAttribute("rowspan"),10))?1:parseInt(e.getAttribute("rowspan"),10);s[t]={value:e.textContent?I(e.textContent.trim()):null,style:n,colSpan:r,rowSpan:a},n.whiteSpace&&(s[t].wrap=!0)})),a.push({cells:s}),s=[]})):r&&(t&&[].slice.call(o.children).forEach((function(e){e.getAttribute("style")&&(n=i.getStyle(e,o))})),r.trim().split("\n").forEach((function(e){e.split("\t").forEach((function(e,t){e&&(s[t]={style:n},n&&n.whiteSpace&&(s[t].wrap=!0),$e(e)?s[t].formula=e:s[t].value=I(e.trim()))})),a.push({cells:s}),s=[]}))),setTimeout((function(){i.getClipboardEle().innerHTML=""}),0),a},e.prototype.getStyle=function(e,t){var r=[],n={},i=Object.keys(this.parent.commonCellStyle);if(e.classList.length||e.getAttribute("style")||i.length){if(e.classList.length&&t.querySelector("style").innerHTML.indexOf(e.classList[0])>-1&&r.push(t.querySelector("style").innerHTML.split(e.classList[0])[1].split("{")[1].split("}")[0]),e.getAttribute("style")&&r.push(e.getAttribute("style")),i.length&&t.querySelector("style"))for(var a=t.querySelector("style").innerHTML.split("td")[1].split("{")[1].split("}")[0],s=0;s<i.length;s++){var o=i[s],l=o.match(/[A-Z]/);l&&(o=o.replace(l[0],"-"+l[0].toLowerCase())),a.indexOf(o)>-1&&(n[i[s]]=a.split(o+":")[1].split(";")[0])}r.forEach((function(e){e.split(";").forEach((function(e){var t=e.split(":")[0].trim();if(["font-family","vertical-align","text-align","text-indent","color","background","font-weight","font-style","font-size","text-decoration","border-bottom","border-top","border-right","border-left","border","white-space"].indexOf(t)>-1){var r=(t="background"===t?"backgroundColor":t).match(/-[a-z]/),i=e.split(":")[1];n[r?t.replace(r[0],r[0].charAt(1).toUpperCase()):t]="font-weight"===t&&-1===["bold","normal"].indexOf(i)?i>"599"?"bold":"normal":i}}))}))}return e.innerHTML.indexOf("<s>")>-1&&(n.textDecoration="line-through"),n},e.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},e.prototype.getModuleName=function(){return"clipboard"},e.prototype.destroy=function(){this.removeEventListener();var e=this.getClipboardEle();sf.base.detach(e),this.parent=null},e}(),jr=function(){function e(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.validCharacters=["+","-","*","/",",","(","=","&"],this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.editorElem=null},e.prototype.addEventListener=function(){sf.base.EventHandler.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on(P,this.keyUpHandler,this),this.parent.on(_,this.keyDownHandler,this),this.parent.on(H,this.performEditOperation,this),this.parent.on("initiateCur",this.initiateCurPosition,this),this.parent.on("editValue",this.updateFormulaBarValue,this),this.parent.on("addressHandle",this.addressHandler,this),this.parent.on("initiateEdit",this.initiateRefSelection,this),this.parent.on("forRefSelRender",this.refSelectionRender,this)},e.prototype.removeEventListener=function(){sf.base.EventHandler.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off(P,this.keyUpHandler),this.parent.off(_,this.keyDownHandler),this.parent.off(H,this.performEditOperation),this.parent.off("initiateCur",this.initiateCurPosition),this.parent.off("editValue",this.updateFormulaBarValue),this.parent.off("addressHandle",this.addressHandler),this.parent.off("initiateEdit",this.initiateRefSelection),this.parent.off("forRefSelRender",this.refSelectionRender))},e.prototype.getModuleName=function(){return"edit"},e.prototype.performEditOperation=function(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var t={isEdit:!1};this.parent.notify("isFormulaBarEdit",t),t.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value;break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getPosition":e.position=this.editorElem.getBoundingClientRect();break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}},e.prototype.keyUpHandler=function(e){if(this.isEdit){if(e.altKey&&13===e.keyCode)this.parent.element.querySelector(".e-spreadsheet-edit").focus(),this.altEnter(),this.isAltEnter=!0;else this.isCellEdit&&this.editCellData.value!==this.editorElem.textContent&&16!==e.keyCode&&this.refreshEditor(this.editorElem.textContent,this.isCellEdit);if(($e(this.editCellData.value)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("="))&&16!==e.keyCode){var t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==this.editorElem.textContent&&this.refreshEditor(this.editorElem.textContent,!0);var r=this.editCellData.sheetIndex,n=this.editCellData.value;this.parent.notify("initiateFormulaReference",{range:n,formulaSheetIdx:r})}}},e.prototype.keyDownHandler=function(e){var t=e.target,r=e.keyCode,i=this.parent.getActiveSheet(),a=n(i.activeCell),s=lt(a[0],a[1],i)||{};if(!sf.base.closest(e.target,".e-findtool-dlg")&&!sf.base.closest(e.target,".e-validationerror-dlg"))if(i.isProtected&&!sf.base.closest(e.target,".e-sheet-rename")&&et(s,Jt(i,a[1]))){if((r>=this.keyCodes.FIRSTALPHABET&&r<=this.keyCodes.LASTALPHABET||r>=this.keyCodes.FIRSTNUMBER&&r<=this.keyCodes.LASTNUMBER||r===this.keyCodes.DELETE||r===this.keyCodes.BACKSPACE||r===this.keyCodes.SPACE||r>=this.keyCodes.FIRSTNUMPAD&&r<=this.keyCodes.LASTNUMPAD||r>=this.keyCodes.SYMBOLSETONESTART&&r<=this.keyCodes.SYMBOLSETONEEND||r>=219&&r<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&r===this.keyCodes.F2)&&67!==r&&89!==r&&90!==r){if(i.protectSettings.insertLink&&75===r)return;this.parent.element.querySelector(".e-editAlert-dlg")||this.parent.notify("editAlert",null)}}else if(this.isEdit){var o=$e(this.editCellData.value)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=");if((this.isCellEdit||o&&this.editCellData.value!==this.editorElem.textContent&&16!==e.keyCode)&&this.refreshEditor(this.editorElem.textContent,this.isCellEdit),!e.altKey)switch(r){case this.keyCodes.ENTER:if(sf.base.Browser.isWindows&&e.preventDefault(),this.isAltEnter){var l=this.parent.element.querySelector(".e-spreadsheet-edit").textContent;l&&l.indexOf("\n")>-1&&(pt(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(this.editorElem.textContent,this.isCellEdit),this.isAltEnter=!1)}if(o){var h=this.parent.element.querySelector(".e-formularef-indicator");h&&h.parentElement.removeChild(h),this.editCellData.sheetIndex===i.id-1||this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e)}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,e)}}else if(!this.isEdit&&(t.classList.contains("e-spreadsheet")||sf.base.closest(t,".e-sheet-panel"))){var d=r>=this.keyCodes.FIRSTALPHABET&&r<=this.keyCodes.LASTALPHABET,p=r>=this.keyCodes.FIRSTNUMBER&&r<=this.keyCodes.LASTNUMBER,c=r>=this.keyCodes.FIRSTNUMPAD&&r<=this.keyCodes.LASTNUMPAD,u=r>=this.keyCodes.SYMBOLSETONESTART&&r<=this.keyCodes.SYMBOLSETONEEND;u||(u=r>=this.keyCodes.SYMBOLSETTWOSTART&&r<=this.keyCodes.SYMBOLSETTWOEND);var f=r===this.keyCodes.FIREFOXEQUALPLUS||r===this.keyCodes.FIREFOXMINUS,g=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&r===this.keyCodes.F2,m=r===this.keyCodes.BACKSPACE;if(!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&r===this.keyCodes.SPACE||d||p||c||u||"mozilla"===sf.base.Browser.info.name&&f)||g||m){g&&(this.isNewValueEdit=!1);var v=document.getElementsByClassName("e-ss-overlay-active");v.length>0?this.parent.notify("deleteImage",{id:v[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.startEdit(null,null,!0,!0)}if(r===this.keyCodes.DELETE)i.isProtected&&this.isLockCellDelete()||this.editingHandler("delete")}},e.prototype.isLockCellDelete=function(){for(var e,r=this.parent.getActiveSheet(),n=c(t(r.selectedRange)),i=n[0];i<=n[2];i++)for(var a=n[1];a<=n[3];a++){if(et(lt(i,a,r),Jt(r,a))){e=!0;break}}return e},e.prototype.renderEditor=function(){if(!this.editorElem||!sf.base.select("#"+this.parent.element.id+"_edit",this.parent.element)){var e=void 0;(e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit"})).contentEditable="true",e.spellcheck=!1,this.editorElem=e,this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove(),this.parent.element.querySelector(".e-sheet-content").appendChild(this.editorElem)}this.parent.notify("formulaOperation",{action:"renderAutoComplete"})},e.prototype.refreshEditor=function(e,t,r,n,i){void 0===i&&(i=!0),n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e,r&&(this.editorElem.textContent=e),t&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:e}),i&&this.editCellData.value===this.editorElem.textContent&&this.triggerEvent("cellEditing")&&this.cancelEdit()},e.prototype.startEdit=function(e,r,i,a){void 0===i&&(i=!0),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var s=this.parent.getActiveSheet(),o=n(s.activeCell),l=lt(o[0],o[1],s)||{},h=t(s.activeCell);if(Or(this.parent,h[0],h[1],this.parent.activeSheetIndex)){var d=this.parent.getCell(h[0],h[1]),p=!1,c=d.innerHTML;if(d&&c.indexOf("<")>-1&&c.indexOf(">")>-1&&c.indexOf("input")>-1&&(p=!0),p)return}this.updateEditCellDetail(e,r),this.initiateEditor(i),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify("clearCopy",null),this.parent.notify("enableToolbarItems",[{enable:!1}]),l.formula&&!a&&this.parent.notify("initiateFormulaReference",{range:l.formula,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.setCursorPosition=function(){var e=this.editorElem,t=e.textContent.length;if(t){var r=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}e.focus()},e.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},e.prototype.editingHandler=function(e){var t=document.getElementsByClassName("e-ss-overlay-active"),r=t.length;switch(e){case"delete":if(r>0)t[0].classList.contains("e-datavisualization-chart")?this.parent.notify("deleteChart",{id:t[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify("deleteImage",{id:t[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var n=this.parent.getActiveSheet(),i=n.selectedRange;this.parent.notify(G,{action:"cellDelete",eventArgs:{address:n.name+"!"+i}});var a=l(i);i=s(a=a[0]>a[2]?c(a):a),this.parent.clearRange(i,null,!0),this.parent.serviceLocator.getService("cell").refreshRange(a),this.parent.notify("selectionComplete",{}),this.parent.notify("dataChanged",{address:i,sheetIdx:this.parent.activeSheetIndex,action:"delete"}),this.parent.notify(W,{action:"cellDelete",eventArgs:{address:n.name+"!"+i}})}}},e.prototype.mouseDownHandler=function(e){if(!sf.base.closest(e.target,".e-findtool-dlg")&&this.isEdit){var t=e.target,r=this.parent.getActiveSheet(),i=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=t.classList.contains("e-spreadsheet-edit");var a=$e(this.editCellData.value)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=");if(t.classList.contains("e-cell")||t.classList.contains("e-header-cell")||t.classList.contains("e-selectall")||sf.base.closest(t,".e-toolbar-item.e-active")){if(this.isAltEnter){var s=this.parent.element.querySelector(".e-spreadsheet-edit").textContent;s&&s.indexOf("\n")>-1&&(this.isAltEnter=!1,pt(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(this.editorElem.textContent,this.isCellEdit))}if(a){var o=window.getSelection().focusOffset,l=n(r.activeCell),h=lt(l[0],l[1],r);if(this.editCellData.value===this.editorElem.textContent&&this.editorElem.textContent.indexOf("(")!==this.editorElem.textContent.length-1&&-1!==this.editorElem.textContent.indexOf("("))if(this.editCellData.sheetIndex!==r.id-1){var d=this.parent.element.querySelector(".e-formula-bar");if(","!==this.editorElem.textContent.substring(d.selectionEnd-1,d.selectionEnd)&&!e.shiftKey)return i&&i.parentElement.removeChild(i),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===this.validCharacters.indexOf(this.editorElem.textContent.substring(o-1,o)))return i&&i.parentElement.removeChild(i),void this.endEdit(!1,e);if(!h)return;if(a=!!h.formula&&($e(lt(l[0],l[1],r).formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("="))){var p=window.getSelection().focusOffset;this.editCellData.value.length===p?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||x(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(i&&i.parentElement.removeChild(i),this.endEdit(!1,e)):this.editCellData.value===this.editorElem.textContent&&(","!==(this.editCellData.value+r.selectedRange).substring(p-1,p)||")"!==this.editCellData.value.substring(p))&&(i&&i.parentElement.removeChild(i),this.endEdit(!1,e))}}else this.endEdit(!1,e)}else if(a&&this.editCellData.value===this.editorElem.textContent&&this.editorElem.textContent.indexOf("(")!==this.editorElem.textContent.length-1&&!this.isCellEdit&&this.editCellData.sheetIndex===r.id-1){o=window.getSelection().focusOffset;if(-1===this.validCharacters.indexOf(this.editorElem.textContent.substring(o-1,o)))return i&&i.parentElement.removeChild(i),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}}},e.prototype.dblClickHandler=function(e){var t=e.target,r=this.parent.getActiveSheet(),i=n(r.activeCell),a=lt(i[0],i[1],r)||{};if(!sf.base.closest(t,".e-datavisualization-chart"))if(r.isProtected&&et(a,Jt(r,i[1])))(t.classList.contains("e-active-cell")||t.classList.contains("e-cell"))&&this.parent.notify("editAlert",null);else if(t.className.indexOf("e-ss-overlay")<0&&(t.classList.contains("e-active-cell")||t.classList.contains("e-cell")||sf.base.closest(t,".e-sheet-content")))if(this.isEdit)if($e(this.editCellData.value)){var s=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name===s&&this.endEdit()}else this.endEdit();else this.isNewValueEdit=!1,this.startEdit()},e.prototype.updateEditCellDetail=function(e,r){var n,i;if(this.editCellData.sheetIndex||(n=e&&e.split("!").length>1?xt(this.parent,It(e)):this.parent.activeSheetIndex),this.editCellData.addr?$e(this.editCellData.value)&&(i=kt(this.parent,n),this.isNewValueEdit=!1):(i=kt(this.parent,n),e=e?h(e):i.activeCell),e){var a=t(e),s=a[0],o=a[1],l=this.parent.getCell(s,o),d=ur(i,a);this.editCellData={addr:e,fullAddr:Ot(this.parent,n)+"!"+e,rowIndex:s,colIndex:o,sheetIndex:n,element:l,value:r||"",position:d}}},e.prototype.initiateEditor=function(e){var t=this;this.parent.getData(this.editCellData.fullAddr).then((function(r){r.forEach((function(r,n){var i={cell:r,value:r?r.value:""};t.parent.notify("getFormattedBarText",i);var a=r?i.value:"";r&&r.formula&&(a=r.formula),t.editCellData.oldValue=a,t.editCellData.value?a=t.editCellData.value:t.editCellData.value=a,t.isNewValueEdit?a="":t.isNewValueEdit=!0,sf.base.isUndefined(a)||t.refreshEditor(a,!1,!0,!1,!1),e&&t.setCursorPosition(),t.triggerEvent("cellEdit")&&t.cancelEdit(!0,!1)}))}))},e.prototype.positionEditor=function(e){var t,r=this.editCellData.element,n={isEdit:!1};if(this.parent.notify("isFormulaBarEdit",n),n.isEdit&&sf.base.isNullOrUndefined(r)&&(r=t=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=t),r){r.classList.add("e-ss-edited");var i=lt(this.editCellData.rowIndex,this.editCellData.colIndex,this.parent.getActiveSheet()),a=this.editCellData.position.left+1,s=this.editCellData.position.top+1,o=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex).offsetHeight-3,l=this.editCellData.element.offsetWidth-3,h=this.parent.getMainContent().offsetWidth-a-28,d=i&&i.wrap||r&&e?"height:auto":o+"px;",p="display:block;top:"+s+"px;"+(this.parent.enableRtl?"right:":"left:")+a+"px;min-width:"+l+"px;max-width:"+h+"px;height:"+d+(i&&i.wrap?"width:"+l+"px;":"")+"min-height:"+o+"px;";p+=r.style.cssText,this.editorElem.setAttribute("style",p),this.parent.element.querySelector(".e-active-cell").style.height=this.editCellData.element.offsetHeight+1+"px",r.classList.contains("e-right-align")?this.editorElem.classList.add("e-right-align"):r.classList.contains("e-center-align")&&this.editorElem.classList.add("e-center-align")}},e.prototype.updateEditedValue=function(e){void 0===e&&(e=!0);var r=this.editCellData.oldValue,n=r?r.toString().toUpperCase():"",i=!0,a=this.editCellData.addr,s=t(this.parent.getActiveSheet().activeCell),o=this.parent.getActiveSheet(),l=lt(s[0],s[1],o);if(this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}}),this.parent.allowDataValidation&&l&&l.validation){var h=this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].innerText,d=this.parent.activeSheetIndex,p=void 0;p="string"==typeof a?t(a):a,this.parent.notify("isValidation",{value:h,range:p,sheetIdx:d,isCell:!0}),i=this.parent.allowDataValidation,this.editCellData.value=i?h:this.editCellData.value,this.parent.allowDataValidation=!0}if((r!==this.editCellData.value||n.indexOf("=RAND()")>-1||n.indexOf("RAND()")>-1||n.indexOf("=RANDBETWEEN(")>-1||n.indexOf("RANDBETWEEN(")>-1)&&i){var c=this.parent.getActiveSheet(),u=t(c.activeCell);this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value});var f=lt(u[0],u[1],c,!0),g=this.getRefreshNodeArgs(f);this.editCellData.value=g.value,f&&f.formula&&(this.editCellData.formula=f.formula),f.wrap&&this.parent.notify("wrapText",{range:u,wrap:!0,sheet:c}),e&&this.parent.refreshNode(this.editCellData.element,g)}return this.parent.allowConditionalFormat&&this.parent.notify("checkConditionalFormat",{rowIdx:s[0],colIdx:s[1],cell:l}),i},e.prototype.refreshDependentCellValue=function(e,t,r){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetIndex===r)){var n=this.parent.getCell(e,t);if(n){var i=lt(e,t,kt(this.parent,r)),a=this.getRefreshNodeArgs(i);this.parent.refreshNode(n,a)}}},e.prototype.getRefreshNodeArgs=function(e){var t=(e=e||{})&&e.format?e.format:"",r={value:e.value,format:t,onLoad:!0,formattedText:"",isRightAlign:!1,type:"General"};return this.parent.notify("getFormattedCell",r),r.formattedText=this.parent.allowNumberFormatting?r.formattedText:r.value,{isRightAlign:r.isRightAlign,result:r.formattedText,type:r.type,value:r.value,curSymbol:r.curSymbol}},e.prototype.endEdit=function(e,t){void 0===e&&(e=!1);var r=n(this.parent.getActiveSheet().activeCell),i=this.parent.getCell(r[0],r[1]),a="";(this.editCellData.element.children[0]&&"e-cf-databar"===this.editCellData.element.children[0].className&&(a=i.children[0].querySelector(".e-databar-value").style.fontSize),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1),this.triggerEvent("beforeCellSave"))?t.preventDefault():(this.updateEditedValue()?(this.triggerEvent("cellSave",t),this.resetEditState(),this.focusElement()):t&&t.preventDefault(),""!==a&&(i.children[0].querySelector(".e-databar-value").style.fontSize=a),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"))},e.prototype.cancelEdit=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),t&&this.triggerEvent("cellSave",r),this.resetEditState(),this.focusElement()},e.prototype.focusElement=function(){_r(this.parent.element),this.parent.notify("enableToolbarItems",[{enable:!0}])},e.prototype.triggerEvent=function(e,t){var r=lt(this.editCellData.rowIndex,this.editCellData.colIndex,this.parent.getActiveSheet()),n={element:this.editCellData.element,value:this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(r)};return"cellSave"===e&&(this.editCellData.formula&&(n.formula=this.editCellData.formula),n.originalEvent=t,this.parent.notify("dataChanged",n),this.parent.notify(W,{eventArgs:n,action:"cellSave"})),"cellSave"!==e&&(n.cancel=!1),this.parent.trigger(e,n),n.cancel},e.prototype.altEnter=function(){var e,t,r;this.positionEditor(!0);var n,i=window.getSelection(),a=i.anchorNode,s=document.createRange();0===(n=3===a.nodeType?i.anchorOffset:a.textContent.length)&&a.textContent.length>0&&(n=a.textContent.length),t=(e=a.textContent).slice(0,n),r=e.slice(n)||" ",a.textContent=t+"\n"+r,s=document.createRange(),3===a.nodeType?(s.setStart(a,n+1),s.setEnd(a,n+1)):1===a.nodeType&&(s.setStart(a.firstChild,n+1),s.setEnd(a.firstChild,n+1)),i.removeAllRanges(),i.addRange(s)},e.prototype.resetEditState=function(e){void 0===e&&(e=!0),e&&($e(this.editorElem.textContent)&&this.parent.notify("clearCellRef",null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align"))),this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify("formulaOperation",{action:"endEdit"})},e.prototype.refSelectionRender=function(){this.editorElem&&$e(this.editorElem.textContent)&&this.parent.notify("initiateFormulaReference",{range:this.editorElem.textContent,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.initiateRefSelection=function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),t=this.parent.element.querySelector(".e-formula-bar").value;this.parent.getActiveSheet().name===e&&$e(this.editCellData.value)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify("initiateFormulaReference",{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.parent.element.querySelector(".e-spreadsheet-edit").innerHTML=t,this.initiateCurPosition()):this.initiateCurPosition()},e.prototype.addressHandler=function(e){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,t);var r=e.range,n=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),i=this.editCellData.sheetIndex,a=this.parent.element.querySelector(".e-spreadsheet-edit");if(this.parent.getActiveSheet().name!==n&&(r="'"+this.parent.getActiveSheet().name+"'!"+r),e.isSelect)this.parent.notify("initiateFormulaReference",{range:t.editedValue+r,formulaSheetIdx:i});else{var s=t.editedValue;s.indexOf(")")===s.length-1?a.textContent=s.substring(0,s.length-1)+r+s.substring(s.length-1):a.textContent=s+r}},e.prototype.updateFormulaBarValue=function(){var e=this.editCellData.value,t=this.parent.getActiveSheet().selectedRange;t=f(l(t))?t.split(":")[0]:t;var r=this.parent.element.querySelector(".e-formula-bar");if(e&&$e(e)){var n=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name!==n&&(t="'"+this.parent.getActiveSheet().name+"'!"+t),e.indexOf(")")===e.length-1?r.value=e.substring(0,e.length-1)+t+e.substring(e.length-1):r.value=e+t}},e.prototype.setFormulaBarCurPosition=function(e,t,r){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,r))},e.prototype.initiateCurPosition=function(){var e=this.parent.element.querySelector(".e-spreadsheet-edit");if(e.innerText){var t=document.createRange();e.innerText.indexOf(")")===e.innerText.length-1?(t.setStart(e.childNodes[0],e.innerText.length-1),t.setEnd(e.childNodes[0],e.innerText.length-1)):(t.setStart(e.childNodes[0],e.innerText.length),t.setEnd(e.childNodes[0],e.innerText.length));var r=window.getSelection();r.removeAllRanges(),r.addRange(t)}if(this.editCellData.sheetIndex!==this.parent.getActiveSheet().id-1){var n=this.parent.element.querySelector(".e-formula-bar");if(n.value){var i=n.value.length;n.value.indexOf(")")===i-1?this.setFormulaBarCurPosition(n,i-1,i-1):this.setFormulaBarCurPosition(n,i,i)}}},e}(),qr=function(){function e(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.invalidOperators=["%"],this.formulaRange=[],this.tableRangesFormula={},this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return e.prototype.addEventListener=function(){this.parent.on("contentLoaded",this.init,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on("virtualContentLoaded",this.virtualContentLoadedHandler,this),this.parent.on("cellNavigate",this.cellNavigateHandler,this),this.parent.on("selectRange",this.selectRange,this),this.parent.on("rowHeightChanged",this.rowHeightChanged,this),this.parent.on("colWidthChanged",this.colWidthChanged,this),this.parent.on("protectSelection",this.protectHandler,this),this.parent.on("initiateFormulaReference",this.initiateFormulaSelection,this),this.parent.on("clearCellRef",this.clearBorder,this),this.parent.on("getRowIdxFromClientY",this.getRowIdxFromClientY,this),this.parent.on("getColIdxFromClientX",this.getColIdxFromClientX,this),this.parent.on("focusBorder",this.chartBorderHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("contentLoaded",this.init),this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off("virtualContentLoaded",this.virtualContentLoadedHandler),this.parent.off("cellNavigate",this.cellNavigateHandler),this.parent.off("selectRange",this.selectRange),this.parent.off("rowHeightChanged",this.rowHeightChanged),this.parent.off("colWidthChanged",this.colWidthChanged),this.parent.off("protectSelection",this.protectHandler),this.parent.off("initiateFormulaReference",this.initiateFormulaSelection),this.parent.off("clearCellRef",this.clearBorder),this.parent.off("getRowIdxFromClientY",this.getRowIdxFromClientY),this.parent.off("getColIdxFromClientX",this.getColIdxFromClientX),this.parent.off("focusBorder",this.chartBorderHandler))},e.prototype.rowHeightChanged=function(e){var r=this;ir((function(){var i=r.getActiveCell(),a=n(r.parent.getActiveSheet().activeCell)[0];if(a===e.rowIdx&&i?i.style.height=parseInt(i.style.height,10)+e.threshold+"px":a>e.rowIdx&&i&&(i.style.top=parseInt(i.style.top,10)+e.threshold+"px"),i=r.getSelectionElement()){var s=c(t(r.parent.getActiveSheet().selectedRange)),o=s[0],l=s[2];o<=e.rowIdx&&l>=e.rowIdx&&i?i.style.height=parseInt(i.style.height,10)+e.threshold+"px":o>e.rowIdx&&i&&(i.style.top=parseInt(i.style.top,10)+e.threshold+"px")}}))},e.prototype.colWidthChanged=function(e){var r=this;ir((function(){var i=r.getActiveCell(),a=n(r.parent.getActiveSheet().activeCell)[1];a===e.colIdx&&i?i.style.width=parseInt(i.style.width,10)+e.threshold+"px":a>e.colIdx&&i&&(i.style.left=parseInt(i.style.left,10)+e.threshold+"px"),i=r.getSelectionElement();var s=c(t(r.parent.getActiveSheet().selectedRange)),o=s[1],l=s[3];o<=e.colIdx&&l>=e.colIdx&&i?i.style.width=parseInt(i.style.width,10)+e.threshold+"px":o>e.colIdx&&i&&(i.style.left=parseInt(i.style.left,10)+e.threshold+"px")}))},e.prototype.selectRange=function(e){this.selectRangeByIdx("Single"===this.parent.selectionSettings.mode?e.indexes.slice(0,2).concat(e.indexes.slice(0,2)):e.indexes,null,null,null,null,e.skipChecking)},e.prototype.init=function(){this.parent.getActiveSheet();var e=t(this.parent.getActiveSheet().selectedRange),r=c(e),i=n(this.parent.getActiveSheet().activeCell),a=r[0]<=i[0]&&r[2]>=i[0]&&r[1]<=i[1]&&r[3]>=i[1];this.createSelectionElement(),this.selectRangeByIdx(e,null,null,a,!0)},e.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"}),r=this.parent.createElement("div",{className:"e-active-cell"});e.appendChild(t),e.appendChild(r)},e.prototype.mouseDownHandler=function(e){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,t);var r=t.editedValue&&0===t.editedValue.toString().indexOf("=")||$e(t.editedValue);if(!this.parent.isEdit||r){var i=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else i&&i.classList.remove("e-ss-overlay-active");if(sf.base.closest(e.target,".e-datavisualization-chart"))return;if(this.parent.getActiveSheet().isProtected&&!this.parent.getActiveSheet().protectSettings.selectCells)return;if(!sf.base.closest(e.target,".e-findtool-dlg")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var a=this.parent.getActiveSheet(),s=this.parent.selectionSettings.mode,o=this.getRowIdxFromClientY({clientY:wr(e)}),h=this.getColIdxFromClientX({clientX:xr(e)}),d=n(a.activeCell),p=a.showHeaders&&this.parent.getRowHeaderContent().contains(e.target),c=a.showHeaders&&this.parent.getColumnHeaderContent().contains(e.target);if(3===e.which&&this.isSelected(o,h))return;if("Multiple"===s&&(!Sr(e)&&(!Cr(e)||Cr(e)&&d[0]===o&&d[1]===h)||c||p)&&(document.addEventListener(vr().split(" ")[0],this.mouseMoveEvt),sf.base.Browser.isPointer||document.addEventListener(vr().split(" ")[1],this.mouseMoveEvt,{passive:!1})),Sr(e)||sf.base.EventHandler.add(document,yr(),this.mouseUpHandler,this),Cr(e)&&!c&&!p)return void(this.touchEvt=e);p?(this.isRowSelected=!0,e.shiftKey&&"Single"!==s||(this.startCell=[o,0]),this.selectRangeByIdx([this.startCell[0],0,o,a.colCount-1],e)):c?(this.isColSelected=!0,e.shiftKey&&"Single"!==s||(this.startCell=[0,h]),this.selectRangeByIdx([0,this.startCell[1],a.rowCount-1,h],e)):e.target.classList.contains("e-selectall")?(this.startCell=[0,0],this.selectRangeByIdx([].concat(this.startCell,[a.rowCount-1,a.colCount-1]),e)):e.target.classList.contains("e-sheet-content")||(e.shiftKey&&"Single"!==s||(this.startCell=[o,h]),this.selectRangeByIdx([].concat(this.startCell?this.startCell:n(a.activeCell),[o,h]),e)),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(r&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit){var u=this.parent.getActiveSheet().selectedRange;u=f(l(u))?u.split(":")[0]:u,this.parent.notify("addressHandle",{range:u,isSelect:!1})}},e.prototype.mouseMoveHandler=function(e){var r=this,i=this.parent.getActiveSheet();br(e)&&e.preventDefault();var a={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,a);var s=$e(a.editedValue)||a.editedValue&&0===a.editedValue.toString().indexOf("="),o=this.getScrollContent(),l=o.getBoundingClientRect(),h=xr(e),d=wr(e),p=this.isRowSelected?i.colCount-1:this.getColIdxFromClientX({clientX:Math.min(h,l.right)}),c=this.isColSelected?i.rowCount-1:this.getRowIdxFromClientY({clientY:Math.min(d,l.bottom)}),u=t(i.selectedRange),f={range:[c,p,c,p]};if(this.parent.notify("activeCellMergedRange",f),f.range[2]!==u[2]||f.range[3]!==u[3]){var g=d>l.bottom&&c<i.rowCount,m=d<l.top&&c>=0&&!this.isColSelected,v=h>l.right&&p<i.colCount,y=h<l.left&&p>=0&&!this.isRowSelected;if(this.clearInterval(),s||this.isColSelected||this.isRowSelected||(u=n(i.activeCell)),g||m||v||y?this.scrollInterval=setInterval((function(){if((g||m)&&!r.isColSelected){if((c=r.getRowIdxFromClientY({clientY:g?l.bottom:l.top}))>=i.rowCount)return void r.clearInterval();o.scrollTop+=(g?1:-1)*Wt(i,c)}if((v||y)&&!r.isRowSelected){if((p=r.getColIdxFromClientX({clientX:v?l.right:l.left}))>=i.colCount)return void r.clearInterval();o.scrollLeft+=(v?1:-1)*er(i,p)}r.selectRangeByIdx([].concat(u[0],u[1],[c,p]),e)}),100):this.selectRangeByIdx([].concat(u[0],u[1],[c,p]),e),s&&this.parent.isEdit){var C=this.parent.getActiveSheet().selectedRange;this.parent.notify("addressHandle",{range:C,isSelect:!1})}}},e.prototype.mouseUpHandler=function(e){var t=this.getRowIdxFromClientY({clientY:wr(e)}),r=this.getColIdxFromClientX({clientX:xr(e)});this.clearInterval(),!Sr(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:wr(this.touchEvt)})!==t||this.getColIdxFromClientX({clientX:xr(this.touchEvt)})!==r||this.mouseDownHandler(e),this.parent.trigger("select",{range:this.parent.getActiveSheet().selectedRange}),document.removeEventListener(vr().split(" ")[0],this.mouseMoveEvt),sf.base.Browser.isPointer||document.removeEventListener(vr().split(" ")[1],this.mouseMoveEvt),sf.base.EventHandler.remove(document,yr(),this.mouseUpHandler),this.parent.notify("mouseUpAfterSelection",e);var n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,n),($e(n.editedValue)||n.editedValue&&0===n.editedValue.toString().indexOf("="))&&this.parent.isEdit&&!e.target.classList.contains("e-spreadsheet-edit")&&this.parent.notify("initiateCur",{})},e.prototype.isSelected=function(e,r){var n=c(t(this.parent.getActiveSheet().selectedRange));return n[0]<=e&&e<=n[2]&&n[1]<=r&&r<=n[3]},e.prototype.virtualContentLoadedHandler=function(){var e=this.parent.getActiveSheet(),r=t(e.selectedRange);this.isColSelected&&this.isRowSelected?this.selectRangeByIdx([0,0,e.rowCount-1,e.colCount-1],null,!0):this.isColSelected?this.selectRangeByIdx([0,r[1],e.rowCount-1,r[3]],null,!0):this.isRowSelected?this.selectRangeByIdx([r[0],0,r[2],e.colCount-1],null,!0):this.highlightHdr(r,r[0]>=this.parent.viewport.topIndex||r[2]>=this.parent.viewport.topIndex,r[1]>=this.parent.viewport.leftIndex||r[3]>=this.parent.viewport.leftIndex)},e.prototype.clearInterval=function(){clearInterval(this.scrollInterval),this.scrollInterval=null},e.prototype.getScrollContent=function(){return this.parent.getMainContent()},e.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},e.prototype.cellNavigateHandler=function(e){var t=this.parent.getActiveSheet();t.isProtected&&!t.protectSettings.selectCells||this.selectRangeByIdx(e.range.concat(e.range))},e.prototype.getColIdxFromClientX=function(e){var t,r=0,n=this.parent.getActiveSheet(),i=this.parent.getMainContent().getBoundingClientRect();t=e.isImage?e.clientX:(this.parent.enableRtl?i.right-e.clientX:e.clientX-i.left)+this.getScrollLeft();for(var a=0;;a++)if(t<(r+=tr(n,a)))return e.clientX=a,a},e.prototype.getRowIdxFromClientY=function(e){var t,r=0,n=this.parent.getActiveSheet();t=e.isImage?e.clientY:e.clientY-this.parent.getMainContent().getBoundingClientRect().top+this.parent.getMainContent().scrollTop;for(var i=0;;i++)if(t<(r+=Wt(n,i)))return e.clientY=i,i},e.prototype.initFormulaReferenceIndicator=function(e){if(this.parent.isEdit){var t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),fr(t,e,this.parent.getActiveSheet(),!1),this.parent.getMainContent().appendChild(t)}},e.prototype.selectRangeByIdx=function(e,r,n,i,a,o){var l={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,l);var h,d=$e(l.editedValue)||l.editedValue&&0===l.editedValue.toString().indexOf("="),p=this.getSelectionElement(),c=this.parent.getActiveSheet(),u=this.parent.element.querySelector(".e-formularef-indicator"),g={range:[].slice.call(e),isActiveCell:!1,skipChecking:o};this.isColSelected||this.isRowSelected||this.parent.notify("mergedRange",g),e!==g.range&&(h=!0);var m={range:s(e=g.range),cancel:!1};if(this.parent.trigger("beforeSelect",m),!0!==m.cancel){if(d&&u&&u.parentElement.removeChild(u),f(e)||g.isActiveCell)p&&p.classList.add("e-hide"),d&&r&&!r.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify("addressHandle",{range:s(e).split(":")[0],isSelect:!0}),this.initFormulaReferenceIndicator(e));else if(d&&this.parent.isEdit)r&&!r.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify("addressHandle",{range:s(e),isSelect:!0}),this.initFormulaReferenceIndicator(e));else{p&&p.classList.remove("e-hide");var v=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);h&&v&&(v.left={idx:0,size:0}),fr(p,e,c,this.parent.enableRtl)}var y={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(H,y),d&&a||Rt(this.parent,s(e),c),this.UpdateRowColSelected(e),this.highlightHdr(e),n||r&&("mousemove"===r.type||br(r))||(d?y.sheetIndex===this.parent.getActiveSheet().id-1&&a?(i=!0,this.updateActiveCell(i?t(c.activeCell):e,a)):this.parent.isEdit||this.updateActiveCell(i?t(c.activeCell):e,a):this.updateActiveCell(i?t(c.activeCell):e,a)),sf.base.isNullOrUndefined(r)&&(r={type:"mousedown"}),d&&a||this.parent.notify("selectionComplete",r),this.parent.notify("showAggregate",{}),this.parent.notify("refreshImgElem",{}),this.parent.notify("clearChartBorder",{})}},e.prototype.UpdateRowColSelected=function(e){var t=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===t.colCount-1,this.isColSelected=0===e[0]&&e[2]===t.rowCount-1},e.prototype.updateActiveCell=function(e,r){var n,i,s,o=this.parent.getActiveSheet(),l=t(o.topLeftCell);this.isColSelected?(n=l[0],i=e[1],this.isRowSelected&&(i=l[1])):(n=e[0],i=e[1],this.isRowSelected&&(i=l[1]));var h={range:[n,i].concat([n,i])};if(this.parent.notify("activeCellMergedRange",h),e!==h.range&&(s=!0),e=h.range,o.activeCell!==a(e[0],e[1])||r){if(this.parent.setSheetPropertyOnMute(o,"activeCell",a(e[0],e[1])),this.getActiveCell()){var d=this.getOffset(e[2],e[3]);s&&(d.left={idx:0,size:0}),fr(this.getActiveCell(),e,o,this.parent.enableRtl)}this.parent.notify("activeCellChanged",null)}else fr(this.getActiveCell(),e,o,this.parent.enableRtl)},e.prototype.getOffset=function(e,t){var r={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(r.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(r.top=this.parent.scrollModule.offset.top)),r},e.prototype.getSelectionElement=function(){return this.parent.element.getElementsByClassName("e-selection")[0]},e.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},e.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},e.prototype.highlightHdr=function(e,t,r){if(void 0===t&&(t=!0),void 0===r&&(r=!0),this.parent.getActiveSheet().showHeaders){var n=this.parent.getActiveSheet(),i=[],a=[],s=c(e);s=this.getHdrIndexes(s);var o=this.parent.element.getElementsByClassName("e-select-all-cell")[0];sf.base.removeClass(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),sf.base.removeClass(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight"),o&&sf.base.removeClass([o],["e-prev-highlight-right","e-prev-highlight-bottom"]),t&&(i=[].slice.call(this.parent.getRowHeaderContent().querySelectorAll("td")).slice(s[0],s[2]+1)),r&&(a=[].slice.call(this.parent.getColumnHeaderContent().querySelectorAll("th")).slice(s[1],s[3]+1)),n.isProtected&&!n.protectSettings.selectCells?sf.base.removeClass([].concat(i,a),"e-highlight"):sf.base.addClass([].concat(i,a),"e-highlight"),i.length&&i[0].parentElement.previousElementSibling&&i[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),a.length&&a[0].previousElementSibling&&a[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(n.isProtected&&!n.protectSettings.selectCells?document.getElementById(this.parent.element.id+"_select_all").classList.remove("e-highlight"):document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight")),o&&(0===s[0]&&o.classList.add("e-prev-highlight-bottom"),0===s[1]&&o.classList.add("e-prev-highlight-right"))}},e.prototype.protectHandler=function(){var e=t(this.parent.getActiveSheet().selectedRange),r=c(e),i=n(this.parent.getActiveSheet().activeCell),a=r[0]<=i[0]&&r[2]>=i[0]&&r[1]<=i[1]&&r[3]>=i[1];this.selectRangeByIdx(e,null,null,a)},e.prototype.getHdrIndexes=function(e){if(this.parent.scrollSettings.enableVirtualization){var t=[],r=this.parent.hiddenCount(this.parent.viewport.topIndex,e[0]),n=this.parent.hiddenCount(this.parent.viewport.leftIndex,e[1],"columns");return t[0]=this.isColSelected?e[0]:e[0]-this.parent.viewport.topIndex<0?0:e[0]-r-this.parent.viewport.topIndex,t[1]=this.isRowSelected?e[1]:e[1]-this.parent.viewport.leftIndex<0?0:e[1]-n-this.parent.viewport.leftIndex,t[2]=this.isColSelected?this.parent.viewport.rowCount+2*this.parent.getThreshold("row"):e[2]-this.parent.hiddenCount(e[0],e[2])-r-this.parent.viewport.topIndex,t[3]=this.isRowSelected?this.parent.viewport.colCount+2*this.parent.getThreshold("col"):e[3]-this.parent.hiddenCount(e[1],e[3],"columns")-n-this.parent.viewport.leftIndex,t}return e},e.prototype.initiateFormulaSelection=function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)},e.prototype.processFormulaEditRange=function(e,t){var r,n,i=t,a=0,s=this.parseFormula(e),o=s.length,l=0,h=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];for(this.clearBorder(),n=this.parent.getActiveSheet().id-1;a<o&&(r=s[a],!(this.invalidOperators.indexOf(r)>-1));){if(Ze(r.toUpperCase())){if(r=r.replace(/\$/g,""),a>0&&s[a-1].indexOf("!")===s[a-1].length-1){var d=s[a-1].split("!");i=xt(this.parent,d[0].substring(1,d[0].length-1))}":"===s[a+1]&&s[++a+1]&&Ze(s[a+1].toUpperCase())&&(r=r+":"+s[a+1],a++),n===i&&this.updateFormulaEditRange(r,l,h),i=t,l++}a++}},e.prototype.updateFormulaEditRange=function(e,r,n){var i=t(e);this.formulaRange[r]=e,this.dStartCell={rowIndex:i[0],colIndex:i[1]},this.dEndCell={rowIndex:i[2],colIndex:i[3]},this.focusBorder(this.dStartCell,this.dEndCell,n[r%6])},e.prototype.chartBorderHandler=function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)},e.prototype.focusBorder=function(e,t,r,n){n=!sf.base.isNullOrUndefined(n)&&n;var i=c([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]),a=i[0],s=i[1],o=i[2],l=i[3];a&&this.getEleFromRange([a-1,s,a-1,l]).forEach((function(e){e&&(e.classList.add(r[1]),n||e.classList.add("e-formularef-selection"))})),this.getEleFromRange([a,l,o,l]).forEach((function(e){e&&(e.classList.add(r[0]),n||e.classList.add("e-formularef-selection"))})),this.getEleFromRange([o,s,o,l]).forEach((function(e){e&&(e.classList.add(r[1]),n||e.classList.add("e-formularef-selection"))})),s&&this.getEleFromRange([a,s-1,o,s-1]).forEach((function(e){e&&(e.classList.add(r[0]),n||e.classList.add("e-formularef-selection"))}))},e.prototype.getEleFromRange=function(e,t){this.parent.getActiveSheet().index;this.parent.getActiveSheet();var r,n,i,a,s=e[0],o=e[1],l=e[2],h=e[3],d=[],p=[];if(s>l&&(i=s,s=l,l=i),o>h&&(i=o,o=h,h=i),this.parent.scrollSettings.enableVirtualization)for(r=s;r<=l;r++)if((n=r)>-1){var c=this.parent.getRow(n);c&&(a=c.getElementsByClassName("e-cell"),d=h===o?[a[h]]:this.getRowCells(a,o,h+1),this.merge(p,d))}return p},e.prototype.getRowCells=function(e,t,r){for(var n=[];t<r;t++)e[t]&&n.push(e[t]);return n},e.prototype.merge=function(e,t){e&&t&&Array.prototype.push.apply(e,t)},e.prototype.clearBorder=function(){for(var e=this.parent.element.getElementsByClassName("e-formularef-selection"),t=0;t<e.length;t++)for(var r=e[t],n=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom"],i=0;i<n.length;i++)r.classList.remove(n[i]);for(t=0;t<e.length;t++)r=e[t]},e.prototype.parseFormula=function(e){var t,r,n,i=0,a=[],s=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g);for(n=s.length;i<n;)if(t=s[i]){if(1===t.length)a.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t);else if(r=t[0],t.indexOf("!")>0){this.isUniqueChar(r)&&(a.push(this.getUniqueCharVal(r)),t=t.substr(1));var o=t.indexOf("!")+1;a.push(t.substr(0,o)),a.push(t.substr(o))}else this.isUniqueChar(r)?(a.push(this.getUniqueCharVal(r)),a.push(t.substr(1))):a.push(t);i++}else i++;return a},e.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e.charAt[0]);return t>=129&&t<=142},e.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCOperator:return":";case this.uniqueSOperator:return"-";case this.uniquePOperator:return"+";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueCSeparator:return",";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueLTOperator:return"<";case this.uniqueGTOperator:return">"}return""},e.prototype.markSpecialChar=function(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket)).replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},e.prototype.getModuleName=function(){return"selection"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),zr=function(){function e(e){this.parent=e,this.addEventListener(),this.initProps()}return e.prototype.onContentScroll=function(e){var t,r,n=this.parent.getMainContent(),i=e.scrollLeft||n.scrollLeft,a=e.scrollTop||n.scrollTop,s=this.parent.enableRtl?this.initScrollValue-i:i;if(this.prevScroll.scrollLeft!==s){var o=s>this.prevScroll.scrollLeft;r=this.offset.left.size,this.offset.left=this.getColOffset(s,o,e.skipHidden),this.parent.getActiveSheet().showHeaders&&(this.parent.getColumnHeaderContent().scrollLeft=i),t={cur:this.offset.left,prev:{idx:this.leftIndex,size:r},increase:o,preventScroll:e.preventScroll},this.parent.notify("horizontalScroll",t),this.updateTopLeftCell(o),this.parent.scrollSettings.enableVirtualization||!o||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=t.prev.idx,this.prevScroll.scrollLeft=s}if(this.prevScroll.scrollTop!==a){var l=a>this.prevScroll.scrollTop;r=this.offset.top.size,this.offset.top=this.getRowOffset(a,l),this.parent.getActiveSheet().showHeaders&&(this.parent.getRowHeaderContent().scrollTop=a),t={cur:this.offset.top,prev:{idx:this.topIndex,size:r},increase:l,preventScroll:e.preventScroll},this.parent.notify("verticalScroll",t),this.updateTopLeftCell(l),this.parent.scrollSettings.enableVirtualization||!l||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=t.prev.idx,this.prevScroll.scrollTop=a}var h={isEdit:!1};(this.parent.notify("isFormulaBarEdit",h),h.isEdit)&&this.parent.element.querySelector(".e-formula-bar").focus()},e.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({colIndex:0,direction:"first",refresh:"RowPart"},a(e.rowCount,0)+":"+a(e.rowCount+t-1,e.colCount-1)),e.rowCount+=t)},e.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},a(0,e.colCount)+":"+a(e.rowCount-1,e.colCount+t-1)),e.colCount+=t)},e.prototype.updateTopLeftCell=function(e){var t=this.offset.top.idx,r=this.offset.left.idx;if(!e){var n=this.parent.getActiveSheet();t=Pr(n,t,!0),r=Pr(n,r,!0,"columns")}this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"topLeftCell",a(t,r))},e.prototype.getRowOffset=function(e,t){var r,n=this.offset.top.size,i=this.parent.getActiveSheet(),a=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0;if(this.parent.scrollSettings.isFinite){if(r=i.rowCount,t&&a+this.parent.viewport.rowCount+this.parent.getThreshold("row")>=r)return{idx:this.offset.top.idx,size:this.offset.top.size}}else r=1/0;for(;a<r;)if(t){if((n+=Wt(i,a-1))===e)return{idx:a,size:n};if(n>e)return{idx:a-1,size:n-Wt(i,a-1)};a++}else{if(0===n)return{idx:0,size:0};if((n-=Wt(i,a))===e)return{idx:a,size:n};if(n<e)return(n+=Wt(i,a))>e?{idx:a,size:n-Wt(i,a)<0?0:n-Wt(i,a)}:{idx:a+1,size:n};a--}return{idx:this.offset.top.idx,size:this.offset.top.size}},e.prototype.getColOffset=function(e,t,r){var n,i=this.offset.left.size,a=this.parent.getActiveSheet(),s=t?this.offset.left.idx+1:this.offset.left.idx-1;if(this.parent.scrollSettings.isFinite){if(n=a.colCount,t&&s+this.parent.viewport.colCount+this.parent.getThreshold("col")>=n)return{idx:this.offset.left.idx,size:this.offset.left.size}}else n=1/0;for(;s<n;)if(t){if((i+=er(a,s-1,r))===e)return{idx:s,size:i};if(i>e)return{idx:s-1,size:i-er(a,s-1,r)};s++}else{if(0===i)return{idx:0,size:0};if((i-=er(a,s,r))===e)return{idx:s,size:i};if(i<e)return(i+=er(a,s,r))>e?{idx:s,size:i-er(a,s,r)}:{idx:s+1,size:i};s--}return{idx:this.offset.left.idx,size:this.offset.left.size}},e.prototype.contentLoaded=function(){this.onScroll=this.onContentScroll.bind(this),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getMainContent().scrollLeft)},e.prototype.setScrollEvent=function(e){void 0===e&&(e={set:!0}),e.set?sf.base.EventHandler.add(this.parent.getMainContent(),"scroll",this.onScroll,this):sf.base.EventHandler.remove(this.parent.getMainContent(),"scroll",this.onScroll)},e.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},e.prototype.getThreshold=function(){return"mozilla"===sf.base.Browser.info.name?.5:1},e.prototype.setPadding=function(){if(this.parent.allowScrolling){var e=this.parent.getColumnHeaderContent(),t=this.parent.getRowHeaderContent(),r=lr()-this.getThreshold(),n=this.parent.enableRtl?{padding:"paddingLeft",border:"borderLeftWidth"}:{padding:"paddingRight",border:"borderRightWidth"};r>0&&(e.parentElement.style[n.padding]=r+"px",e.style[n.border]="1px",t.style.marginBottom=r+"px")}},e.prototype.addEventListener=function(){this.parent.on("contentLoaded",this.contentLoaded,this),this.parent.on("onContentScroll",this.onContentScroll,this),this.parent.on("deInitProperties",this.initProps,this),this.parent.on("spreadsheetDestroyed",this.destroy,this),this.parent.on("setScrollEvent",this.setScrollEvent,this)},e.prototype.destroy=function(){sf.base.EventHandler.remove(this.parent.getMainContent(),"scroll",this.onScroll),this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off("contentLoaded",this.contentLoaded),this.parent.off("onContentScroll",this.onContentScroll),this.parent.off("deInitProperties",this.initProps),this.parent.off("spreadsheetDestroyed",this.destroy),this.parent.off("setScrollEvent",this.setScrollEvent)},e}(),Wr=function(){function e(e){this.scroll=[],this.parent=e,this.addEventListener()}return e.prototype.createVirtualElement=function(e){var t=this.parent.getActiveSheet(),r=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(r.querySelector(".e-table")),r.appendChild(this.content);var n,i,a,s,o=r.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"}));this.parent.sheets.length>this.scroll.length&&this.initScroll();var l,h=this.parent.viewport.rowCount+1+2*this.parent.getThreshold("row");t.rowCount>h||t.usedRange.rowIndex>h-1?(!this.parent.scrollSettings.isFinite&&t.rowCount<=t.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(t,"rowCount",t.usedRange.rowIndex+1),this.setScrollCount(t.rowCount,"row"),a=Yt(t,0,this.scroll[this.parent.activeSheetIndex].rowCount-1)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"rowCount",h),this.scroll[this.parent.activeSheetIndex].rowCount=t.rowCount,a=1),h=this.parent.viewport.colCount+1+2*this.parent.getThreshold("col"),t.colCount>h||t.usedRange.colIndex>h-1?(!this.parent.scrollSettings.isFinite&&t.colCount<=t.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(t,"colCount",t.usedRange.colIndex+1),l=tr(t,0,h-1),this.setScrollCount(t.colCount,"col"),s=l+tr(t,h,this.scroll[this.parent.activeSheetIndex].colCount-1)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"colCount",h),l=tr(t,0,t.colCount-1),this.scroll[this.parent.activeSheetIndex].colCount=t.colCount,s=l),e.startColIdx&&(l=tr(t,e.startColIdx,e.startColIdx+h-1)),sf.base.isNullOrUndefined(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),sf.base.isNullOrUndefined(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),sf.base.isNullOrUndefined(this.translateX)&&(this.translateX=0),sf.base.isNullOrUndefined(this.translateY)&&(this.translateY=0),t.showHeaders&&(r=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(r.querySelector(".e-table")),r.appendChild(this.rowHeader),i=r.appendChild(o.cloneNode()),this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",r=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(r.querySelector(".e-table")),r.appendChild(this.colHeader),n=r.appendChild(o.cloneNode()),this.colHeader.style.width=l+"px",i.style.height=a+"px",n.style.width=s+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)"),this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=l+"px",o.style.height=a+"px",o.style.width=s+"px"},e.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},e.prototype.setScrollCount=function(e,t){var r=this.parent.activeSheetIndex;this.scroll[r][t+"Count"]||(this.scroll[r][t+"Count"]=e)},e.prototype.getRowAddress=function(e){return s([e[0],this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])},e.prototype.getColAddress=function(e){return s([this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])},e.prototype.updateScrollCount=function(e,t,r){void 0===r&&(r=e);var n=this.parent.getActiveSheet(),i=e+this.parent.viewport[t+"Count"]+1+r,a=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(i<a){if(n[t+"Count"]===a)return;i=a}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",i)},e.prototype.onVerticalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),a=this.parent.getThreshold("row");if(i>Math.round(a/2)){var s=void 0,o=void 0,l=void 0;if(t<=a&&!e.increase){if(this.translateY&&n>a&&(this.translateY=0,this.parent.viewport.topIndex=n-a,!e.preventScroll)){if(i<this.parent.viewport.rowCount+a){o=this.parent.viewport.topIndex-1,s=this.parent.skipHidden(0,o)[0],this.parent.viewport.topIndex=s;var h=this.hiddenCount(s,o),d=this.skipHiddenIdx(this.parent.viewport.bottomIndex-(o-s+1-h),e.increase);this.parent.viewport.bottomIndex-=o-s+1-h+this.hiddenCount(d,this.parent.viewport.bottomIndex),this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,rowIndex:s,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0},this.getRowAddress([0,this.skipHiddenIdx(o,!1)]))}else this.parent.renderModule.refreshUI({rowIndex:0,colIndex:this.parent.viewport.leftIndex,refresh:"Row",skipUpdateOnFirst:!0});_r(this.parent.element)}this.updateScrollCount(a,"row")}if(n<a&&(i=Math.abs(t-a)),t>a){if(l=this.parent.viewport.topIndex,this.parent.viewport.topIndex=t-a,e.increase&&l>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=l);if(this.translateY=r-this.getThresholdHeight(this.parent.viewport.topIndex,a),!e.preventScroll){if(i<this.parent.viewport.rowCount+a)if(e.increase){if(s=this.parent.viewport.bottomIndex+1,o=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-l),o-=this.hiddenCount(l,this.parent.viewport.topIndex-1),this.parent.viewport.topIndex=this.skipHiddenIdx(this.parent.viewport.topIndex,e.increase),o<=this.parent.viewport.bottomIndex)return;var p=this.parent.skipHidden(s,o);s=p[0],o=this.checkLastIdx(p[1],"row"),this.parent.viewport.bottomIndex=o,this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,rowIndex:s,direction:"first",refresh:"RowPart"},this.getRowAddress([s,o]))}else{o=(s=this.parent.viewport.topIndex)+i-1;h=this.hiddenCount(s,o),d=this.skipHiddenIdx(this.parent.viewport.bottomIndex-(o-s-h),e.increase);this.parent.viewport.bottomIndex-=i-h+this.hiddenCount(d,this.parent.viewport.bottomIndex),s=this.parent.skipHidden(s,o)[0],this.parent.viewport.topIndex=s,this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,rowIndex:s,direction:"last",refresh:"RowPart"},this.getRowAddress([s,o]))}else this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});this.updateScrollCount(t,"row",a),_r(this.parent.element)}}e.prev.idx=t}},e.prototype.skipHiddenIdx=function(e,t,r,n){return void 0===r&&(r="rows"),void 0===n&&(n=this.parent.getActiveSheet()),n[r][e]&&n[r][e].hidden&&(t?e++:e--,e=this.skipHiddenIdx(e,t,r,n)),e},e.prototype.hiddenCount=function(e,t,r){void 0===r&&(r="rows");for(var n=0,i=this.parent.getActiveSheet(),a=e;a<=t;a++)i[r][a]&&i[r][a].hidden&&n++;return n},e.prototype.checkLastIdx=function(e,t){if(this.parent.scrollSettings.isFinite){var r=this.parent.getActiveSheet()[t+"Count"]-1;e>r&&(e=r)}return e},e.prototype.onHorizontalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),a=this.parent.getThreshold("col");if(i>Math.round(a/2)){var s=void 0,o=void 0,l=void 0;if(t<=a&&!e.increase){if(this.translateX&&n>a&&(this.translateX=0,this.parent.viewport.leftIndex=n-a,!e.preventScroll)){if(i<this.parent.viewport.colCount+a){o=this.parent.viewport.leftIndex-1,s=this.parent.skipHidden(0,o,"columns")[0],this.parent.viewport.leftIndex=s;var h=this.hiddenCount(s,o,"columns"),d=this.skipHiddenIdx(this.parent.viewport.rightIndex-(o-s+1-h),e.increase,"columns");this.parent.viewport.rightIndex-=o-s+1-h+this.hiddenCount(d,this.parent.viewport.rightIndex,"columns"),this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:s,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0},this.getColAddress([0,this.skipHiddenIdx(o,!1,"columns")]))}else this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0});_r(this.parent.element)}this.updateScrollCount(a,"col")}if(n<a&&(i=Math.abs(t-a)),t>a){if(l=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=t-a,e.increase&&l>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=l);if(this.translateX=r-this.getThresholdWidth(this.parent.viewport.leftIndex,a),!e.preventScroll){if(i<this.parent.viewport.colCount+a)if(e.increase){if(s=this.parent.viewport.rightIndex+1,o=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-l),o-=this.hiddenCount(l,this.parent.viewport.leftIndex-1,"columns"),this.parent.viewport.leftIndex=this.skipHiddenIdx(this.parent.viewport.leftIndex,e.increase,"columns"),o<=this.parent.viewport.rightIndex)return;var p=this.parent.skipHidden(s,o,"columns");s=p[0],o=this.checkLastIdx(p[1],"col"),this.parent.viewport.rightIndex=o,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:s,direction:"first",refresh:"ColumnPart"},this.getColAddress([s,o]))}else{o=(s=this.parent.viewport.leftIndex)+i-1;h=this.hiddenCount(s,o,"columns"),d=this.skipHiddenIdx(this.parent.viewport.rightIndex-(o-s-h),e.increase,"columns");this.parent.viewport.rightIndex-=i-h+this.hiddenCount(d,this.parent.viewport.rightIndex,"columns"),s=this.parent.skipHidden(s,o,"columns")[0],this.parent.viewport.leftIndex=s,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:s,direction:"last",refresh:"ColumnPart"},this.getColAddress([s,o]))}else this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"});this.updateScrollCount(t,"col",a),_r(this.parent.element)}}e.prev.idx=t}},e.prototype.getThresholdHeight=function(e,t){for(var r=0,n=this.parent.getActiveSheet(),i=e;i<e+t;i++)r+=Wt(n,i);return r},e.prototype.getThresholdWidth=function(e,t){for(var r=0,n=this.parent.getActiveSheet(),i=e;i<e+t;i++)r+=er(n,i);return r},e.prototype.translate=function(e){var t=this.parent.getActiveSheet();if("Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",t.showHeaders&&(this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)")),"Column"===e.refresh||"ColumnPart"===e.refresh){var r=this.parent.enableRtl?-this.translateX:this.translateX;this.content.style.transform="translate("+r+"px, "+this.translateY+"px)",t.showHeaders&&(this.colHeader.style.transform="translate("+r+"px, 0px)")}},e.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var t=tr(this.parent.getActiveSheet(),this.parent.viewport.leftIndex,this.parent.viewport.rightIndex);this.parent.getActiveSheet().showHeaders&&(this.colHeader.style.width=t+"px"),this.content.style.width=t+"px"}},e.prototype.updateUsedRange=function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var r=this.getVTrackHeight("height");e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?r+=Yt(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index):r-=Yt(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1),this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,r,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index>this.scroll[this.parent.activeSheetIndex].colCount){var n=this.getVTrackHeight("width");n+=tr(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index),this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,n,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}},e.prototype.createHeaderElement=function(e){this.rowHeader=this.content.cloneNode(),this.colHeader=this.rowHeader.cloneNode(),this.rowHeader.style.width="",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+(this.parent.enableRtl?-this.translateX:this.translateX)+"px, 0px)",this.rowHeader.appendChild(e.element.querySelector("table")),e.element.appendChild(this.rowHeader);var t=this.parent.getColumnHeaderContent();this.colHeader.appendChild(t.querySelector("table")),t.appendChild(this.colHeader);var r=this.content.nextElementSibling.cloneNode(),n=r.cloneNode();r.style.width="",n.style.height="",e.element.appendChild(r),t.appendChild(n)},e.prototype.getVTrackHeight=function(e){var t=this.content.nextElementSibling.style[e];if(t.includes("e+")){var r=(t=t.split("px")[0]).split("e+");return Number(r[0])*Math.pow(10,Number(r[1]))}return parseInt(t,10)},e.prototype.updateVTrackHeight=function(e){var t=this.parent.viewport.rowCount+1+2*this.parent.getThreshold("row");e.rowIdx>=t&&e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height")},e.prototype.updateVTrackWidth=function(e){if(e.colIdx>=this.parent.viewport.leftIndex&&e.colIdx<=this.parent.viewport.rightIndex){if(this.parent.getActiveSheet().showHeaders){var t=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];t.style.width=parseInt(t.style.width,10)+e.threshold+"px"}var r=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];if(r.style.width=parseInt(r.style.width,10)+e.threshold+"px",this.parent.getActiveSheet().showHeaders){var n=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];n.style.width=parseInt(n.style.width,10)+e.threshold+"px"}var i=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];i.style.width=parseInt(i.style.width,10)+e.threshold+"px"}},e.prototype.updateVTrack=function(e,t,r){this.parent.getActiveSheet().showHeaders&&(e.nextElementSibling.style[r]=t+"px"),this.content.nextElementSibling.style[r]=t+"px"},e.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null},e.prototype.updateScrollProps=function(e){var t=this;void 0===e&&(e={sheetIndex:0,sheets:this.parent.sheets}),0===this.scroll.length?this.initScroll():e.sheets.forEach((function(){t.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})}))},e.prototype.sliceScrollProps=function(e){sf.base.isNullOrUndefined(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)},e.prototype.addEventListener=function(){this.parent.on("beforeContentLoaded",this.createVirtualElement,this),this.parent.on("beforeVirtualContentLoaded",this.translate,this),this.parent.on("virtualContentLoaded",this.updateColumnWidth,this),this.parent.on("updateTableWidth",this.updateColumnWidth,this),this.parent.on("verticalScroll",this.onVerticalScroll,this),this.parent.on("horizontalScroll",this.onHorizontalScroll,this),this.parent.on("updateUsedRange",this.updateUsedRange,this),this.parent.on("rowHeightChanged",this.updateVTrackHeight,this),this.parent.on("colWidthChanged",this.updateVTrackWidth,this),this.parent.on("beforeHeaderLoaded",this.createHeaderElement,this),this.parent.on("deInitProperties",this.deInitProps,this),this.parent.on("sheetsDestroyed",this.sliceScrollProps,this),this.parent.on("sheetCreated",this.updateScrollProps,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},e.prototype.removeEventListener=function(){this.parent.off("beforeContentLoaded",this.createVirtualElement),this.parent.off("beforeVirtualContentLoaded",this.translate),this.parent.off("virtualContentLoaded",this.updateColumnWidth),this.parent.off("updateTableWidth",this.updateColumnWidth),this.parent.off("verticalScroll",this.onVerticalScroll),this.parent.off("horizontalScroll",this.onHorizontalScroll),this.parent.off("updateUsedRange",this.updateUsedRange),this.parent.off("rowHeightChanged",this.updateVTrackHeight),this.parent.off("colWidthChanged",this.updateVTrackWidth),this.parent.off("beforeHeaderLoaded",this.createHeaderElement),this.parent.off("sheetsDestroyed",this.sliceScrollProps),this.parent.off("sheetCreated",this.updateScrollProps),this.parent.off("spreadsheetDestroyed",this.destroy)},e}(),Gr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(_,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(_,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){if(!this.parent.isEdit&&(document.activeElement.classList.contains("e-spreadsheet")||sf.base.closest(document.activeElement,".e-sheet"))){var t=void 0,r=this.parent.enableRtl,i=this.parent.getActiveSheet(),a={e:e,isFilterCell:!1},o=n(this.parent.getActiveSheet().activeCell);if([9,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.shiftKey||!e.altKey||38!==e.keyCode&&40!==e.keyCode||this.parent.notify("filterCellKeyDown",a),!e.shiftKey&&(!r&&37===e.keyCode||r&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(o[1]>0)o[1]-=1,t=!0;else{var l=this.parent.getMainContent();0===o[1]&&l.scrollLeft&&!r&&(l.scrollLeft=0)}else if(!a.isFilterCell&&!e.shiftKey&&38===e.keyCode||e.shiftKey&&13===e.keyCode)if(o[0]>0)o[0]-=1,t=!0;else{l=this.parent.getMainContent();0===o[0]&&l.scrollTop&&(l.scrollTop=0)}else if(!e.shiftKey&&(!r&&39===e.keyCode||r&&37===e.keyCode)||9===e.keyCode){(h=lt(o[0],o[1],i))&&h.colSpan>1&&(o[1]+=h.colSpan-1),o[1]<i.colCount-1&&(o[1]+=1,t=!0)}else if(!a.isFilterCell&&!e.shiftKey&&40===e.keyCode||13===e.keyCode){var h;(h=lt(o[0],o[1],i))&&h.rowSpan>1&&(o[0]+=h.rowSpan-1),o[0]<i.rowCount-1&&(o[0]+=1,t=!0)}t&&(this.scrollNavigation(o,!1),this.parent.setSheetPropertyOnMute(i,"activeCell",s(o)),this.parent.notify("cellNavigate",{range:o}))}e.target.classList.contains("e-sheet-rename")&&(32===e.keyCode?e.stopPropagation():13!==e.keyCode&&27!==e.keyCode||this.parent.notify("renameSheet",e))},e.prototype.scrollNavigation=function(e,t){var r=this.parent.enableRtl?-1:1,i=this.parent.getMainContent(),a=this.parent.getActiveSheet(),s=(n(a.activeCell),n(a.topLeftCell));this.getBottomIdx(s)<=e[0]||t?i.scrollTop+=Wt(a,e[0]):s[0]>e[0]&&(i.scrollTop-=Wt(a,e[0])),this.getRightIdx(s)<=e[1]||t?i.scrollLeft+=er(a,e[1])*r:s[1]>e[1]&&(i.scrollLeft-=er(a,e[1])*r)},e.prototype.getBottomIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=e[0];;n++)if((t+=Wt(r,n))>=this.parent.viewport.height-17)return n},e.prototype.getRightIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=this.parent.getMainContent().offsetWidth,i=e[1];;i++)if((t+=er(r,i))>=n-17)return i},e.prototype.getModuleName=function(){return"keyboardNavigation"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Yr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(_,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(_,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){if(e.ctrlKey||e.metaKey){if(sf.base.closest(e.target,".e-find-dlg")||[79,83,65].indexOf(e.keyCode)>-1&&e.preventDefault(),79===e.keyCode)sf.base.select("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.save();else if(67===e.keyCode)this.parent.notify("copy",{promise:Promise});else if(75===e.keyCode){var t=n(this.parent.getActiveSheet().activeCell),r=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[t[0]],i=void 0;e.preventDefault(),sf.base.isNullOrUndefined(r)||(i=r.cells[t[1]]),sf.base.isNullOrUndefined(i)&&ht(t[0],t[1],this.parent.getActiveSheet(),i,!1),i&&i.hyperlink?this.parent.notify("editHyperlink",null):this.parent.notify("initiateHyperlink",null)}else 90===e.keyCode?this.parent.isEdit||(e.preventDefault(),this.parent.notify("performUndoRedo",{isUndo:!0})):89===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.notify("performUndoRedo",{isUndo:!1})));var a=this.parent.sheets[this.parent.getActiveSheet().id-1],s=n(a.activeCell),o=lt(s[0],s[1],a),l=a.isProtected&&et(o,Jt(a,s[1]));if(!l||!a.isProtected){if(70===e.keyCode){e.preventDefault();var h=document.querySelector(".e-spreadsheet-find-ddb");sf.base.isNullOrUndefined(h)||h.click()}else if(71===e.keyCode)e.preventDefault(),this.parent.notify(Y,null);else if(72===e.keyCode)e.preventDefault(),this.parent.notify(X,null);else if(88===e.keyCode)this.parent.notify(V,{promise:Promise});else if(86===e.keyCode)l||this.parent.notify(j,{isAction:!0});else if(66===e.keyCode){e.preventDefault(),d="bold"===(d=this.parent.getCellStyleValue(["fontWeight"],n(this.parent.getActiveSheet().activeCell)).fontWeight)?"normal":"bold",this.parent.notify(E,{style:{fontWeight:d},onActionUpdate:!0,refreshRibbon:!0})}else if(73===e.keyCode){var d;e.preventDefault(),d="italic"===(d=this.parent.getCellStyleValue(["fontStyle"],n(this.parent.getActiveSheet().activeCell)).fontStyle)?"normal":"italic",this.parent.notify(E,{style:{fontStyle:d},onActionUpdate:!0,refreshRibbon:!0})}else 85===e.keyCode?(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"underline"},refreshRibbon:!0})):53===e.keyCode&&(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"line-through"},refreshRibbon:!0}));e.shiftKey&&76===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.applyFilter()))}}27===e.keyCode&&this.parent.notify("clearCopy",null)},e.prototype.getModuleName=function(){return"keyboardShortcut"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Xr=function(){function e(e){this.checkHeight=!1,this.parent=e,this.row=e.createElement("tr",{className:"e-row"}),this.parent.on("initialLoad",this.addEventListener,this)}return e.prototype.applyCellFormat=function(e){var t=Object.keys(e.style),r=this.parent.getActiveSheet();if(!(e.lastCell&&Mr(r,e.rowIdx)<=20)||t.length){var n=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(n){if(void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var i={};Object.keys(e.style).forEach((function(t){i[t]=e.style[t]})),void 0!==i.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate),delete i.border),void 0!==i.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate),delete i.borderTop),void 0!==i.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first),delete i.borderLeft),Object.keys(i).length&&(void 0!==i.borderBottom&&this.setThickBorderHeight(i.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,i))}else void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style);if(e.isHeightCheckNeeded&&(!r.rows[e.rowIdx]||!r.rows[e.rowIdx].customHeight))if(e.manualUpdate){this.checkHeight||(this.checkHeight=this.isHeightCheckNeeded(e.style,e.onActionUpdate));var a=!1;e.style.fontSize&&(a=!0),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,0,a)}else{var s=lt(e.rowIdx,e.colIdx,r);if(s&&s.wrap||!this.isHeightCheckNeeded(e.style)||Hr(r,e.rowIdx,e.colIdx,Dr(this.parent,e.style)),e.lastCell){var o=Mr(r,e.rowIdx);o>20&&o>Wt(r,e.rowIdx)&&Nr(this.parent,r,o,e.rowIdx,e.row,e.hRow,!1)}}}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate)}},e.prototype.updateRowHeight=function(e,t,r,n,i,a){if(void 0===i&&(i=0),this.checkHeight){var s=0,o=void 0,l=this.parent.getActiveSheet(),h=lt(e,t,l),d=this.parent.getCell(e,t);if(s=Dr(this.parent,h&&h.style||this.parent.cellStyle,h&&h.wrap?Br(this.parent.getDisplayText(h),er(l,t),h.style,this.parent.cellStyle):1),h&&!sf.base.isNullOrUndefined(h.value))if(h.value.toString().indexOf("\n")>-1){var p=void 0,c=h.value.split("\n"),u=0,f=c.length;for(p=0;p<f;p++){var g=Br(c[p],er(l,t),h.style,this.parent.cellStyle);0===g&&(g=1),u+=g}s=Dr(this.parent,h.style||this.parent.cellStyle,u)+1}if(s+i<20&&a&&Mr(l,e)>=20&&(s=20),d&&d.children[0]&&"e-cf-databar"===d.children[0].className&&(d.children[0].style.height="100%",d.children[0].firstElementChild.nextElementSibling.style.height="100%"),Hr(l,e,t,s+i),r){this.checkHeight=!1;var m=this.parent.getRow(e);if(!m)return;var v=Wt(l,e);o=Mr(l,e),(n?o!==v:o>v)&&Nr(this.parent,l,o,e,m)}}},e.prototype.isHeightCheckNeeded=function(e,t){var r=Object.keys(e);return(t?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1},e.prototype.setLeftBorder=function(e,t,r,n,i,a,s){if(!s||!s.includes("Column"))for(var o=0;o<t.rowSpan;o++){for(var l=this.parent.getCell(r+o,n-1,i),h=1;l&&"none"===l.style.display;)l=this.parent.getCell(r+o,n-1-h,i),h++;l?(a&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e):t.style.borderLeft=e}},e.prototype.setTopBorder=function(e,t,r,n,i,a,s,o,l,h){if(!o||!o.includes("Row"))for(var d=0;d<t.colSpan;d++){var p=this.parent.getCell(r-1,n+d,i);if(p){if(zt(this.parent.getActiveSheet(),r-1)){var c=[Number(p.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],c).bottomPriority)return}s&&""!==e&&this.parent.getActiveSheet().topLeftCell.includes(""+(r+1))&&(this.parent.getMainContent().scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,r-1,n+d,p,i,a,s,l,h),p.style.borderBottom="none"===e?p.style.borderBottom:e}else t.style.borderTop=e}},e.prototype.setThickBorderHeight=function(e,t,r,n,i,a,s,o,l){var h=e?this.getBorderSize(e):1,d=this.parent.getActiveSheet();if(h>2&&(!d.rows[t]||!d.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,o,s,h);else{var p=Wt(d,t),c=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,r]),1,3));c>p&&(Nr(this.parent,d,c,t,i,a,!1),this.parent.notify("rowHeightChanged",{rowIdx:t,threshold:c-20}))}!s||!o&&this.checkHeight||!(h<3)||d.rows[t]&&d.rows[t].customHeight||(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,o,s,h))},e.prototype.getBorderSize=function(e){var t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)?parseInt(t,10):1},e.prototype.clearObj=function(e){var r,n,i=e.options,a=i.range?i.range.indexOf("!")>0?i.range.split("!")[1]:i.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,o=i.range&&i.range.indexOf("!")>0?xt(this.parent,i.range.split("!")[0]):this.parent.activeSheetIndex,l=t(a),h=this.parent.sheets[o],d=l[0],p=l[2],c={range:a,type:i.type,requestType:"clear",sheetIndex:o};if(e.isPublic||this.parent.notify(G,{action:"beforeClear",eventArgs:c}),"Clear Formats"===i.type||"Clear All"===i.type)for(this.parent.notify("clearCFRule",{range:a,isPublic:!1});d<=p;d++)for(r=l[1],n=l[3];r<=n;r++){var u=lt(d,r,h),f=this.parent.getCell(d,r);u&&(u.wrap&&this.parent.notify("wrapText",{range:[d,r,d,r],wrap:!1,sheet:h}),u.hyperlink&&(sf.base.removeClass(f.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),"Clear All"===i.type&&this.parent.removeHyperlink(s([d,r,d,r]))))}"Clear Hyperlinks"===i.type&&this.parent.removeHyperlink(a),this.parent.notify("clear",{range:h.name+"!"+a,type:i.type}),this.parent.serviceLocator.getService("cell").refreshRange(t(a)),e.isPublic||(c={range:h.name+"!"+a,type:i.type,sheetIndex:o},this.parent.notify("actionComplete",{eventArgs:c,action:"clear"}))},e.prototype.addEventListener=function(){this.parent.on(R,this.applyCellFormat,this),this.parent.on("clearViewer",this.clearObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initialLoad",this.addEventListener),this.parent.off(R,this.applyCellFormat),this.parent.off("clearViewer",this.clearObj))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.row=null,this.checkHeight=null},e.prototype.getModuleName=function(){return"cellformat"},e}(),Kr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("contentLoaded",this.wireEvents,this),this.parent.on("beforeHeaderLoaded",this.wireEvents,this),this.parent.on(z,this.autoFit,this),this.parent.on("setAutoFit",this.setAutoFitHandler,this)},e.prototype.autoFit=function(e){for(var t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],r=e.startIndex;r<=e.endIndex;r++)this.trgtEle=e.isRow?this.parent.getRow(r,t):this.parent.getCell(null,r,t),this.setAutofit(r,!e.isRow)},e.prototype.wireEvents=function(e){if(this.parent.getActiveSheet().showHeaders){var t=e?e.element:this.parent.getRowHeaderContent(),r=this.parent.getColumnHeaderContent();sf.base.EventHandler.add(r,"dblclick",this.dblClickHandler,this),sf.base.EventHandler.add(t,"dblclick",this.dblClickHandler,this),sf.base.EventHandler.add(r,"mousedown",this.mouseDownHandler,this),sf.base.EventHandler.add(t,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(t,r)}},e.prototype.wireResizeCursorEvent=function(e,t){sf.base.EventHandler.add(e,"mousemove",this.setTarget,this),sf.base.EventHandler.add(t,"mousemove",this.setTarget,this)},e.prototype.unWireResizeCursorEvent=function(){sf.base.EventHandler.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget),sf.base.EventHandler.remove(this.parent.getColumnHeaderContent(),"mousemove",this.setTarget)},e.prototype.unwireEvents=function(){this.parent.getActiveSheet().showHeaders&&(sf.base.EventHandler.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),sf.base.EventHandler.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),sf.base.EventHandler.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),sf.base.EventHandler.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent())},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("contentLoaded",this.wireEvents),this.parent.off("beforeHeaderLoaded",this.wireEvents),this.parent.off(z,this.autoFit),this.parent.off("setAutoFit",this.setAutoFitHandler))},e.prototype.mouseMoveHandler=function(e){var t=this.parent.element.getElementsByClassName("e-sheet-panel")[0],r=this.parent.element.getElementsByClassName("e-colresize-handler")[0],n=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];(r||n)&&(this.isMouseMoved=!0,r?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(r.style.left=e.clientX-this.parent.element.getBoundingClientRect().left+"px"):n&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(n.style.top=e.clientY-t.getBoundingClientRect().top+"px"))},e.prototype.mouseDownHandler=function(e){if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var t=this.trgtEle.offsetHeight,r=e.offsetY;(t>=10&&r<5||t-2<8&&r<Math.ceil((r-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);var n=this.trgtEle,i=n.classList.contains("e-colresize")?"e-colresize-handler":n.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(n,i),this.unWireResizeCursorEvent(),sf.base.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),sf.base.EventHandler.add(document,"mouseup",this.mouseUpHandler,this)},e.prototype.mouseUpHandler=function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],r=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeOn(e),this.isMouseMoved=null;var n=t||r;n&&(this.parent.element.getElementsByClassName("e-sheet-panel")[0].removeChild(n),this.updateCursor(e)),sf.base.EventHandler.remove(document,"mouseup",this.mouseUpHandler),sf.base.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler),this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),this.parent.getColumnHeaderContent())},e.prototype.dblClickHandler=function(e){if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle),this.trgtEle.classList.contains("e-colresize")){var t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,r=er(this.parent.getActiveSheet(),t)+"px";this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(t-1):this.setAutofit(t,!0,r)}else if(this.trgtEle.classList.contains("e-rowresize")){var n=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,i=Wt(this.parent.getActiveSheet(),n)+"px";this.setAutofit(n,!1,i)}},e.prototype.setTarget=function(e){var t,r,n,i,a=e.target,s=this.parent.getActiveSheet();if(s.isProtected&&(!s.protectSettings.formatColumns||!s.protectSettings.formatRows)){if(!s.protectSettings.formatRows&&!s.protectSettings.formatColumns)return;if(s.protectSettings.formatRows&&sf.base.closest(a,".e-colhdr-table"))return;if(s.protectSettings.formatColumns&&sf.base.closest(a,".e-rowhdr-table"))return}if(sf.base.closest(a,".e-header-row")?(n=e.offsetX,r=a.offsetWidth,i="e-colresize",a.previousElementSibling?t=a.previousElementSibling:Number(a.getAttribute("aria-colindex"))>1&&(t=a)):sf.base.closest(a,".e-row")&&(n=e.offsetY,r=a.offsetHeight,i="e-rowresize",a.parentElement.previousElementSibling?t=a.parentElement.previousElementSibling.firstElementChild:Number(a.parentElement.getAttribute("aria-rowindex"))>1&&(t=a)),r-2<8&&n!==Math.ceil((r-2)/2))n<Math.ceil((r-2)/2)?(a.classList.add(i),t.classList.add(i)):n>Math.ceil((r-2)/2)&&a.classList.add(i);else if(r-5<n&&n<=r&&r>=10)a.classList.add(i);else if(n<5&&t&&r>=10)a.classList.add(i),t.classList.add(i);else for(var o="e-colresize"===i?a.parentElement.getElementsByClassName(i):this.parent.getRowHeaderTable().getElementsByClassName(i),l=0;l<o.length;l++)o[l].classList.remove(i)},e.prototype.updateTarget=function(e,r){if(sf.base.closest(r,".e-header-row")){if(r.offsetWidth<10&&e.offsetX<Math.ceil((r.offsetWidth-2)/2)||e.offsetX<5&&r.offsetWidth>=10&&r.classList.contains("e-colresize")){var n=this.parent.getActiveSheet(),i=Number(this.trgtEle.getAttribute("aria-colindex"))-2;r.previousElementSibling&&!rr(n,i)?this.trgtEle=r.previousElementSibling:i>-1&&this.trgtEle.classList.add("e-unhide-column")}}else if(r.offsetHeight<10&&e.offsetY<Math.ceil((r.offsetHeight-2)/2)||e.offsetY<5&&r.offsetHeight>=10&&r.classList.contains("e-rowresize")){n=this.parent.getActiveSheet(),i=Number(r.parentElement.getAttribute("aria-rowindex"))-2;if(r.parentElement.previousElementSibling||zt(n,i))if("dblclick"===e.type&&zt(n,i)){var a=c(t(this.parent.getActiveSheet().selectedRange)),s=void 0;s=i<=a[2]&&i>a[0]?{startIndex:a[0],endIndex:a[2],hide:!1,autoFit:!0}:{startIndex:i,endIndex:i,hide:!1,autoFit:!0},this.parent.notify(q,s)}else zt(n,i)||(this.trgtEle=r.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0])}},e.prototype.setAutoFitHandler=function(e){this.setAutofit(e.idx,e.isCol)},e.prototype.setAutofit=function(e,t,r){var n=0,i=this.parent.getActiveSheet(),a=this.parent.getMainContent(),s=t?er(this.parent.getActiveSheet(),e)+"px":Wt(this.parent.getActiveSheet(),e)+"px",o=[],l=a.getElementsByClassName("e-content-table")[0];if(this.parent.getActiveSheet().showHeaders)(t?this.parent.getColHeaderTable():this.parent.getRowHeaderTable()).getElementsByTagName("tr");var h=!1;if(t){for(var d=i.rows.length,p=0;p<d;p++)if(i.rows[p]&&i.rows[p].cells&&i.rows[p].cells[e]){if(lt(p,e,i).wrap&&(h=!0),(f=this.parent.createElement("td",{className:"e-cell"})).textContent=this.parent.getDisplayText(i.rows[p].cells[e]),i.rows[p].cells[e].style)(g=i.rows[p].cells[e].style).fontFamily&&(f.style.fontFamily=g.fontFamily),g.fontSize&&(f.style.fontSize=g.fontSize);o[n]=f,n++}}else for(var c=i.rows[e]&&i.rows[e].cells?i.rows[e].cells.length:0,u=0;u<c;u++)if(i.rows[e]&&i.rows[e].cells[u]){lt(e,u,i).wrap&&(h=!0);var f,g=i.rows[e].cells[u].style;if((f=this.parent.createElement("td")).textContent=this.parent.getDisplayText(i.rows[e].cells[u]),i.rows[e].cells[u].style){var m=i.rows[e].cells[u].style;m.fontFamily&&(f.style.fontFamily=m.fontFamily),m.fontSize&&(f.style.fontSize=m.fontSize)}o[n]=f,n++}var v=Fr(l,o,t,this.parent,r,h);t&&(v=this.getFloatingElementWidth(v,e));var y=0===v?parseInt(s,10):v,C=parseInt(s,10)>y?-(parseInt(s,10)-y):y-parseInt(s,10);if(t)if(e>=this.parent.viewport.leftIndex&&e<=this.parent.viewport.rightIndex)Jt(i,e).width=y>0?y:0,this.parent.notify("colWidthChanged",{threshold:C,colIdx:e}),this.resizeStart(e,this.parent.getViewportIndex(e,!0),y+"px",t,!0,r);else{var b,S=er(i,e);b=y>0?-(S-y):-S,this.parent.notify("colWidthChanged",{threshold:b,colIdx:e}),Jt(i,e).width=y>0?y:0}else if(!t)if(e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex)Gt(i,e,(y=y>20?y:20)>0?y:0),this.parent.notify("rowHeightChanged",{threshold:C,rowIdx:e}),this.resizeStart(e,this.parent.getViewportIndex(e),y+"px",t,!0,r);else{var x,w=Wt(i,e);x=y>0?-(w-y):-w,this.parent.notify("rowHeightChanged",{threshold:x,rowIdx:e}),Gt(i,e,y>0?y:0)}},e.prototype.createResizeHandler=function(e,t){var r=this.parent.createElement("div",{className:t});e.classList.contains("e-colresize")?(r.style.height=this.parent.getMainContent().clientHeight+e.offsetHeight+"px",r.style.left=this.event.clientX-this.parent.element.getBoundingClientRect().left+"px",r.style.top="0px"):e.classList.contains("e-rowresize")&&(r.style.width=this.parent.getMainContent().clientWidth+e.offsetWidth+"px",r.style.left="0px",r.style.top=this.event.clientY-this.parent.element.getElementsByClassName("e-sheet-panel")[0].getBoundingClientRect().top+"px"),this.parent.element.getElementsByClassName("e-sheet-panel")[0].appendChild(r),this.updateCursor(this.event)},e.prototype.setColWidth=function(e,t,r,n){var i=this.parent.getActiveSheet(),a=r-n;if(a<0&&n<-a&&(a=-n),r>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,r),void this.parent.notify(W,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!1},action:"resize"});this.parent.notify("colWidthChanged",{threshold:a,colIdx:e}),this.resizeStart(e,t,r+"px",!0,!1,n+"px"),Qt(i,e,{width:r,customWidth:!0})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.parent.notify(W,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!0},action:"resize"}))},e.prototype.showHiddenColumns=function(e,r){var i,a,s,o=this.parent.getActiveSheet(),l=t(o.selectedRange);if(e>=l[1]&&e<=l[3]&&l[2]===o.rowCount-1&&n(o.activeCell)[0]===n(o.topLeftCell)[0]?(i=l[1],a=l[3],s=this.parent.getMainContent().querySelector("colgroup")):i=a=e,void 0!==r)for(var h=i;h<=a;h++)Qt(o,h,{width:r,customWidth:!0}),h>=this.parent.viewport.leftIndex&&h<=this.parent.viewport.rightIndex&&!rr(o,h)&&(s.children[this.parent.getViewportIndex(h,!0)].style.width=r+"px");this.trgtEle.classList.remove("e-unhide-column"),this.parent.hideColumn(i,a,!1),void 0===r&&this.autoFit({isRow:!1,startIndex:i,endIndex:a})},e.prototype.setRowHeight=function(e,t,r,n){var i=this.parent.getActiveSheet(),a=parseInt(this.parent.getMainContent().getElementsByTagName("tr")[t].style.height,10),s=r,o=parseInt(s,10)-a;o<0&&a<-o&&(o=-a),this.parent.notify("rowHeightChanged",{threshold:o,rowIdx:e,isCustomHgt:!0}),this.resizeStart(e,t,s,!1,!1,n),qt(i,e,{height:parseInt(s,10)>0?parseInt(s,10):0,customHeight:!0})},e.prototype.resizeOn=function(e){var r,n,i=this;if(this.trgtEle.classList.contains("e-rowresize")){var a=this.parent.getActiveSheet(),s=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&zt(a,s)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var o={startIndex:s,endIndex:s,hide:!1,skipAppend:!0};this.parent.notify(q,o);var l=this.parent.getRowHeaderTable().tBodies[0],h=this.parent.getContentTable().tBodies[0];o.hdrRow.style.display="none",o.row.style.display="none",l.insertBefore(o.hdrRow,l.children[o.insertIdx]),h.insertBefore(o.row,h.children[o.insertIdx]),this.trgtEle=o.hdrRow.firstElementChild,o.hdrRow.nextElementSibling.classList.remove("e-hide-end"),o.mergeCollection.forEach((function(e){i.parent.notify(T,e)}))}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&zt(a,s)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}n=r=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,r=this.parent.getViewportIndex(n);var d=this.parent.getMainContent().getElementsByClassName("e-row")[r].style.height,p=e.clientY-this.event.clientY+parseInt(d,10);if(p<=0)return this.parent.hideRow(n),qt(a,n,{height:0,customHeight:!0}),void this.parent.notify(W,{eventArgs:{index:n,height:"0px",isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:d},action:"resize"});if(this.setRowHeight(n,r,p+"px",d),"none"===this.trgtEle.parentElement.style.display){var u=this.parent.getActiveSheet(),f=c(t(u.selectedRange));if(n<=f[2]&&n>f[0]){p=u.rows[n].height;for(var g=void 0,m=f[0];m<=f[2];m++)m!==n&&(d=Wt(u,m)+"px",qt(u,m,{customHeight:!0,height:p}),zt(u,m)?g||(g=m):(this.parent.getRow(m).style.height=p+"px",u.showHeaders&&(this.parent.getRow(m,this.parent.getRowHeaderTable()).style.height=p+"px")),this.parent.notify(W,{eventArgs:{index:m,height:p+"px",isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:d},action:"resize"}));this.parent.hideRow(f[0],n-1,!1),r+=Math.abs(n-g)}else 0===r||zt(u,n-1)?0!==r&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(u.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[r].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),r=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;var v=void 0;this.trgtEle.classList.contains("e-unhide-column")?(r-=1,v=0):v=er(this.parent.getActiveSheet(),r),this.setColWidth(r,this.parent.getViewportIndex(r,!0),e.clientX-this.event.clientX+v,v)}},e.prototype.setWidthAndHeight=function(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"},e.prototype.resizeStart=function(e,t,r,n,i,a){this.parent.getActiveSheet().showHeaders?kr(t,r,n,this.parent):n?this.parent.element.getElementsByClassName("e-sheet-content")[0].getElementsByTagName("col")[t].style.width=r:this.parent.element.getElementsByClassName("e-sheet-content")[0].getElementsByTagName("tr")[t].style.height=r;var s,o,l=i?"resizeToFit":"resize";n?(s={index:e,width:r,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldWidth:a},o=a!==r):(s={index:e,height:r,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldHeight:a},o=a!==r),o&&this.parent.notify(W,{eventArgs:s,action:l})},e.prototype.updateCursor=function(e){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},e.prototype.getFloatingElementWidth=function(e,t){var r=e,n={filterRange:[],hasFilter:!1};return this.parent.notify("getFilterRange",n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(r=e+22),r},e.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"resize"},e}(),$r=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshClients=function(e){Tr(e,this.parent)},e.prototype.addEventListener=function(){this.parent.on("collaborativeUpdate",this.refreshClients,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("collaborativeUpdate",this.refreshClients)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"collaborativeEditing"},e}(),Zr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.hideShow=function(e){if(e.startIndex>e.endIndex){var t=e.startIndex;e.startIndex=e.endIndex,e.endIndex=t}e.actionUpdate&&this.parent.notify(G,{eventArgs:e,action:"hideShow"}),e.isCol?this.hideCol(e):this.hideRow(e),e.actionUpdate&&this.parent.notify(W,{eventArgs:e,action:"hideShow"})},e.prototype.hideRow=function(e){var t,r,n,i,s=this,o=this.parent.getActiveSheet(),l=0;if(e.hide){for(var h=void 0,d=void 0,p=void 0,c=e.startIndex;c<=e.endIndex;c++)if(!zt(o,c))if(void 0===r&&(o.showHeaders&&(d=this.parent.getRowHeaderTable()),h=this.parent.getContentTable(),r=this.parent.getViewportIndex(c),l=0),qt(o,c,{hidden:!0}),p=h.rows[r]){if(!i)for(var u=0;u<=o.usedRange.colIndex;u++)if(((t=lt(c,u,o)||{}).colSpan||t.rowSpan)&&(e.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){i=!0;break}if(i)continue;if(o.showHeaders&&sf.base.detach(d.rows[r]),sf.base.detach(p),l++,(p=h.rows[r])&&c===e.endIndex){var f=void 0,g=(n=Pr(o,c+1,!0))!==Pr(o,0,!0)&&n===(this.parent.viewport.topIndex>=e.startIndex?e.endIndex+1:this.parent.viewport.topIndex)?"Row":"";for(u=this.parent.viewport.leftIndex;u<=this.parent.viewport.rightIndex;u++){""!==(O=this.parent.getCellStyleValue(["borderTop"],[n,u]).borderTop)&&(f=p.cells[u],this.parent.notify(R,{onActionUpdate:!1,rowIdx:n,colIdx:u,style:{borderTop:O},row:p,pRow:p.previousElementSibling,first:g,cell:f}))}}}else c<=this.parent.viewport.bottomIndex?l++:l--;if(i&&(e.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return this.parent.selectRange(o.selectedRange),void this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});if(!l)return;if(this.parent.selectRange(o.selectedRange),this.parent.scrollSettings.enableVirtualization){this.parent.viewport.topIndex>=e.startIndex&&(this.parent.viewport.topIndex=e.endIndex+1),e.startIndex=this.parent.viewport.bottomIndex+1,e.endIndex=e.startIndex+l-1;var m=this.parent.skipHidden(e.startIndex,e.endIndex);e.startIndex=m[0],e.endIndex=m[1],this.parent.viewport.bottomIndex=e.endIndex,this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"",refresh:"RowPart"},a(e.startIndex,this.parent.viewport.leftIndex)+":"+a(e.endIndex,this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col")))}o.showHeaders&&(0===r?d.rows[0]&&d.rows[0].classList.add("e-hide-end"):(d.rows[r-1]&&d.rows[r-1].classList.add("e-hide-start"),d.rows[r]&&d.rows[r].classList.add("e-hide-end")))}else{for(var v=void 0,y=void 0,C=void 0,b=(p=void 0,void 0),S=void 0,x=void 0,w=void 0,I=e.startIndex-1,E=void 0,k=[],A=(c=e.startIndex,e.endIndex);c<=A;c++)if(zt(o,c))if(void 0===E)if(c>this.parent.viewport.bottomIndex){if(qt(o,c,{hidden:!1}),void 0===w)return}else{void 0===w&&(w=c),qt(o,c,{hidden:!1}),void 0===r&&(v=document.createDocumentFragment(),y=document.createDocumentFragment(),b=this.parent.serviceLocator.getService("row"),o.showHeaders&&(S=this.parent.getRowHeaderTable().tBodies[0]),x=this.parent.getContentTable().tBodies[0],c<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex=c),r=0===c?0:this.parent.getViewportIndex(c)),I++,o.showHeaders&&(C=b.refresh(c,null,null,!0),v.appendChild(C),sf.base.detach(S.lastElementChild)),p=y.appendChild(b.refresh(c,p,C)),sf.base.detach(x.lastElementChild);for(u=this.parent.viewport.leftIndex;u<=this.parent.viewport.rightIndex;u++)if(void 0!==(t=lt(c,u,o)||{}).rowSpan){var F={range:[c,u,c,u],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify("activeCellMergedRange",F),k.length&&F.range[1]===k[k.length-1].range[1]||k.push(F)}}else A=c;else{if(e.startIndex===e.endIndex)return;void 0===r?I++:E=c}if(this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),l=this.parent.hiddenCount(this.parent.viewport.topIndex,e.startIndex)+this.parent.hiddenCount(e.endIndex+1,this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex+=l,e.insertIdx=r,e.row=y.querySelector(".e-row"),e.mergeCollection=k,o.showHeaders&&(e.hdrRow=v.querySelector(".e-row"),0!==r&&!zt(o,I-1)&&S.children[r-1]&&S.children[r-1].classList.remove("e-hide-start"),0!==e.startIndex&&zt(o,e.startIndex-1)&&e.hdrRow.classList.add("e-hide-end"),zt(o,I+1)?v.lastElementChild.classList.add("e-hide-start"):S.children[r]&&S.children[r].classList.remove("e-hide-end")),p&&x.children[r]){n=Pr(o,I+1,!0);for(c=this.parent.viewport.leftIndex;c<=this.parent.viewport.rightIndex;c++){var O;if(""!==(O=this.parent.getCellStyleValue(["borderTop"],[n,c]).borderTop)){this.parent.notify(R,{onActionUpdate:!1,rowIdx:n,colIdx:c,style:{borderTop:O},pRow:p,cell:x.children[r].children[c],first:""});var N=Pr(o,w-1,!1);N>-1?!x.children[r-1]||this.parent.getCellStyleValue(["borderBottom"],[N,c]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[w,c]).borderTop||(x.children[r-1].children[c].style.borderBottom=""):x.children[r].children[c].style.borderTop=""}}}if(e.skipAppend)return;o.showHeaders&&S.insertBefore(v,S.children[r]),x.insertBefore(y,x.children[r]),this.parent.selectRange(o.selectedRange),e.autoFit&&o.showHeaders&&this.parent.notify(z,{startIndex:e.startIndex,endIndex:e.endIndex,isRow:!0}),k.forEach((function(e){s.parent.notify(T,e)})),void 0!==E&&E!==e.endIndex&&(e.startIndex=E,this.hideRow(e))}},e.prototype.hideCol=function(e){for(var t,r=this,i=this.parent.getActiveSheet(),o=[],l=[],h=n(i.topLeftCell),d=e.startIndex;d<=e.endIndex;d++)(e.hide?!rr(i,d):rr(i,d))&&(Qt(i,d,{hidden:e.hide}),this.parent.scrollSettings.enableVirtualization&&(d<this.parent.viewport.leftIndex||d>this.parent.viewport.rightIndex)?d<this.parent.viewport.leftIndex&&l.push(d):(o.push(d),e.hide&&h[1]===d&&(t=!0)));if(l.length||o.length)if(e.hide){if(!o.length)return;if((o.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization)&&this.removeCell(i,o),this.parent.scrollSettings.enableVirtualization){if(o[0]===this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex=Pr(i,o[o.length-1]+1,!0,"columns")),t){var p=0;if(o.slice(0,o.indexOf(h[1])).forEach((function(e){p+=er(i,e,!0)})),p){this.parent.notify("setScrollEvent",{set:!1});var c=this.parent.getMainContent();c.scrollLeft-=p,this.parent.notify("onContentScroll",{scrollLeft:c.scrollLeft,preventScroll:!0,skipHidden:!0}),ir((function(){return r.parent.notify("setScrollEvent",{set:!0})}))}}if(this.parent.scrollSettings.isFinite){var u=Pr(i,i.colCount-1,!1,"columns"),f=this.parent.viewport.leftIndex,g=this.parent.viewport.rightIndex;if(g+o.length>=u){var m=Pr(i,f-(g+o.length-u),!1,"columns");return m>-1&&(this.parent.viewport.leftIndex=m,this.parent.viewport.leftIndex-=this.parent.hiddenCount(g,u)),this.parent.viewport.rightIndex=u,f!==this.parent.viewport.leftIndex||g!==this.parent.viewport.rightIndex?this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Pr(i,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}):this.parent.notify("updateTableWidth",{refresh:"Column"}),void this.parent.selectRange(i.selectedRange)}}if(o.length<=this.parent.getThreshold("col")){var v=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+o.length,"columns");this.parent.viewport.rightIndex=v[1],this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:v[0],direction:"",refresh:"ColumnPart"},""+s([this.parent.viewport.topIndex,v[0],this.parent.viewport.bottomIndex,v[1]]))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Pr(i,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})}this.parent.selectRange(i.selectedRange)}else{if(l.length){if(l.sort((function(e,t){return e-t})),this.parent.scrollSettings.enableVirtualization&&l[0]<this.parent.getThreshold("col")){var y=n(i.topLeftCell)[0]+1;this.parent.setSheetPropertyOnMute(i,"topLeftCell","A"+y),this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Column"}),this.parent.selectRange(i.selectedRange)}else this.parent.goTo(a(this.parent.viewport.topIndex,l[0]));return}o.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization?(this.appendCell(i,o),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Column"})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Pr(i,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}),this.parent.selectRange(i.selectedRange)}},e.prototype.removeCell=function(e,t){var r,n,i,a,s,o,l,h=this,d=0,p=this.parent.getViewportIndex(t[0],!0)+1;this.parent.scrollSettings.enableVirtualization?(r=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(r=0,n=e.rowCount-1);var c,u=this.parent.getContentTable();if(o=u.getElementsByTagName("colgroup")[0],e.showHeaders){var f=this.parent.getColHeaderTable();s=f.getElementsByTagName("colgroup")[0],i=f.rows[0]}for(var g=t.length-1;r<=n;)zt(e,r)?r++:(a=u.rows[d],t.forEach((function(n,u){if(sf.base.detach(a.cells[p]),0===d&&(e.showHeaders&&(sf.base.detach(i.cells[p]),sf.base.detach(s.children[p])),sf.base.detach(o.children[p])),0===u&&void 0!==(l=lt(r,n,e)||{}).colSpan&&(void 0===l.rowSpan||l.colSpan>1)&&h.parent.notify("hiddenMerge",{rowIdx:r,colIdx:n,model:"col",start:t[0],end:t[g]}),u===g){c=Pr(e,n+1,!0,"columns");var f=h.parent.getCellStyleValue(["borderLeft"],[d,c]).borderLeft;""!==f&&h.parent.notify(R,{onActionUpdate:!1,rowIdx:d,colIdx:c,style:{borderLeft:f},row:a,first:""}),void 0!==(l=lt(r,n,e)||{}).colSpan&&(void 0===l.rowSpan||l.colSpan>1)&&h.parent.notify("hiddenMerge",{rowIdx:r,colIdx:n,model:"col",start:t[0],end:t[g],isEnd:!0})}})),r++,d++);p-1>-1&&e.showHeaders&&i.cells[p-1]&&i.cells[p-1].classList.add("e-hide-start"),i.cells[p]&&i.cells[p].classList.add("e-hide-end")},e.prototype.appendCell=function(e,t){var r,n,i,s,o,l,h,d=this,p=0;document.createDocumentFragment(),document.createDocumentFragment(),document.createDocumentFragment();this.parent.scrollSettings.enableVirtualization?(r=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(r=0,n=e.rowCount-1);var c=this.parent.getContentTable(),u=this.parent.getColHeaderTable();l=c.getElementsByTagName("colgroup")[0],e.showHeaders&&(o=u.getElementsByTagName("colgroup")[0],i=u.rows[0]);var f,g=this.parent.serviceLocator.getService("cell");t.sort((function(e,t){return e-t}));for(var m,v,y=[],C=[],b=t.length-1;r<=n;)zt(e,r)?r++:(s=c.rows[p],t.forEach((function(n,c){(0===p&&(C[c]=d.parent.getViewportIndex(n,!0),l.children[C[c]]?(l.insertBefore(d.parent.sheetModule.updateCol(e,n),l.children[C[c]]),e.showHeaders&&(v=i.cells[C[c]],0===c&&t[c]&&!rr(e,t[c]-1)&&v.previousElementSibling.classList.remove("e-hide-start"),i.insertBefore(g.renderColHeader(n),v),c===b&&v.classList.remove("e-hide-end"))):(l.appendChild(d.parent.sheetModule.updateCol(e,n)),e.showHeaders&&i.appendChild(g.renderColHeader(n))),sf.base.detach(l.lastChild),e.showHeaders&&(sf.base.detach(i.lastChild),c===b&&(sf.base.detach(o),u.insertBefore(l.cloneNode(!0),u.tHead[0])))),sf.base.detach(s.lastChild),v=s.cells[C[c]],m=g.render({rowIdx:r,colIdx:n,cell:lt(r,n,e),address:a(r,n),lastCell:n===b,isHeightCheckNeeded:!0,first:n!==Pr(e,0,!0,"columns")&&n===d.parent.viewport.leftIndex?"Column":"",checkNextBorder:c===b?"Column":""}),v?s.insertBefore(m,v):s.appendChild(m),0===c&&m.previousSibling)&&(""!==d.parent.getCellStyleValue(["borderLeft"],[p,Pr(e,t[t.length-1]+1,!0,"columns")]).borderLeft&&(h=Pr(e,t[0]-1,!1,"columns"))>-1&&!d.parent.getCellStyleValue(["borderRight"],[p,h]).borderRight&&!d.parent.getCellStyleValue(["borderLeft"],[p,t[0]]).borderLeft&&(m.previousSibling.style.borderRight=""));if(void 0!==(f=lt(p,n,e)||{}).colSpan&&(void 0===f.rowSpan||f.colSpan>1)){var S={range:[p,n,p,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};d.parent.notify("activeCellMergedRange",S),y.length&&S.range[1]===y[y.length-1].range[1]||y.push(S)}})),r++,p++);y.forEach((function(e){d.parent.notify(T,e)})),this.parent.viewport.rightIndex=Pr(e,this.parent.viewport.rightIndex-t.length,!1,"columns")},e.prototype.addEventListener=function(){this.parent.on(q,this.hideShow,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(q,this.hideShow),this.parent.off("spreadsheetDestroyed",this.destroy)},e}(),Jr=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("initiateHyperlink",this.initiateHyperlinkHandler,this),this.parent.on("editHyperlink",this.editHyperlinkHandler,this),this.parent.on("removeHyperlink",this.removeHyperlinkHandler,this),this.parent.on("openHyperlink",this.openHyperlinkHandler,this),this.parent.on(M,this.hyperlinkClickHandler,this),this.parent.on("createHyperlinkElement",this.createHyperlinkElementHandler,this),this.parent.on(P,this.keyUpHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiateHyperlink",this.initiateHyperlinkHandler),this.parent.off("editHyperlink",this.editHyperlinkHandler),this.parent.off("removeHyperlink",this.removeHyperlinkHandler),this.parent.off("openHyperlink",this.openHyperlinkHandler),this.parent.off(M,this.hyperlinkClickHandler),this.parent.off("createHyperlinkElement",this.createHyperlinkElementHandler),this.parent.off(P,this.keyUpHandler))},e.prototype.getModuleName=function(){return"spreadsheetHyperlink"},e.prototype.keyUpHandler=function(e){var t=e.target;if(sf.base.closest(t,".e-document")){var r=document.querySelector(".e-hyp-text"),n=this.parent.element.querySelector(".e-hyperlink-alert-span"),i=(sf.base.closest(t,".e-hyperlink-dlg")||sf.base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;r&&r.value&&(Ze(r.value.toUpperCase())?n&&(n.remove(),i.removeAttribute("disabled")):(this.showDialog(),i.setAttribute("disabled","true")))}if(t.classList.contains("e-text")&&sf.base.closest(t,".e-cont")&&sf.base.closest(t,".e-webpage")&&sf.base.closest(t,".e-webpage").getElementsByClassName("e-cont")[1]===t.parentElement){i=(sf.base.closest(t,".e-hyperlink-dlg")||sf.base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;if(""!==t.value)i.removeAttribute("disabled");else!!sf.base.closest(t,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||i.setAttribute("disabled","true")}},e.prototype.initiateHyperlinkHandler=function(){var e=this,t=this.parent.serviceLocator.getService(Mn),r=this.parent.getActiveSheet();if(!r.isProtected||r.protectSettings.insertLink){if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n=this.parent.serviceLocator.getService(Pn);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:t.getConstant("InsertLink"),beforeOpen:function(t){var r={dialogName:"InsertLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),n.dialogInstance.content=e.hyperlinkContent(),n.dialogInstance.dataBind(),_r(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(n),n.hide()}}]})}}else this.parent.notify("editAlert",null)},e.prototype.dlgClickHandler=function(e){var t,r,n=this.parent,i=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(i)if(i.querySelector(".e-webpage")){t=i.getElementsByClassName("e-cont")[0].querySelector(".e-text").value;var a={address:r=i.getElementsByClassName("e-cont")[1].querySelector(".e-text").value};this.parent.insertHyperlink(a,this.parent.getActiveSheet().activeCell,t,!1)}else{t=i.getElementsByClassName("e-cont")[0].querySelector(".e-text").value,r=i.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var s=i.getElementsByClassName("e-cont")[2];if(s.getElementsByClassName("e-list-item")[0].querySelector(".e-active")){for(var o=i.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,l=n.sheets,h=0;h<l.length;h++)l[h].name;a={address:r=o+"!"+r.toUpperCase()};this.parent.insertHyperlink(a,this.parent.getActiveSheet().activeCell,t,!1)}else if(s.querySelector(".e-active")){var d=i.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent;for(h=0;h<this.parent.definedNames.length;h++)if(this.parent.definedNames[h].name===d){a={address:this.parent.definedNames[h].name};this.parent.insertHyperlink(a,this.parent.getActiveSheet().activeCell,t,!1)}}}},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(Mn),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span",innerHTML:e.getConstant("HyperlinkAlert")});this.parent.element.querySelector(".e-hyperlink-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.editHyperlinkHandler=function(){var e=this,t=this.parent.serviceLocator.getService(Mn),r=this.parent.serviceLocator.getService(Pn);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:t.getConstant("EditLink"),beforeOpen:function(t){var n={dialogName:"EditLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.hyperEditContent(),r.dialogInstance.dataBind(),_r(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Update"),isPrimary:!0},click:function(){e.dlgClickHandler(r),r.hide()}}]})},e.prototype.openHyperlinkHandler=function(){var e=n(this.parent.getActiveSheet().activeCell),t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)},e.prototype.removeHyperlinkHandler=function(e){this.parent.removeHyperlink(e)},e.prototype.hlOpenHandler=function(e){var n=this;if(e.classList.contains("e-hyperlink")){var i=["",""],o=void 0,l=!0;e.style.color="#551A8B";var h,d,p=this.parent.getActiveSheet(),c=parseInt(e.parentElement.getAttribute("aria-colindex"),10)-1,u=parseInt(e.parentElement.parentElement.getAttribute("aria-rowindex"),10)-1,f=p.rows[u].cells[c].hyperlink,g=void 0;if(h={hyperlink:f,cell:this.parent.getActiveSheet().activeCell,target:"_blank",cancel:!1},this.parent.trigger("beforeHyperlinkClick",h),h.cancel)return;d={hyperlink:f=h.hyperlink,cell:this.parent.getActiveSheet().activeCell},"string"==typeof f&&(g=f),"object"===r(f)&&(g=f.address);var m=g;if(-1===g.indexOf("http://")&&-1===g.indexOf("https://")&&-1===g.indexOf("ftp://")){if(!sf.base.isNullOrUndefined(g)){if(this.parent.definedNames)for(var v=0;v<this.parent.definedNames.length;v++)if(this.parent.definedNames[v].name===g){g=(g=this.parent.definedNames[v].refersTo).slice(1);break}var y;-1!==g.indexOf("!")?-1!==(i=g.split("!"))[0].indexOf(" ")&&(i[0]=i[0].slice(1,i[0].length-1)):(i[0]=this.parent.getActiveSheet().name,i[1]=g),i[1];for(v=0;v<this.parent.sheets.length;v++)this.parent.sheets[v].name===i[0]&&(y=v);if(p=this.parent.sheets[y],-1!==i[1].indexOf(":")){var C=i[1].indexOf(":"),b=i[1].substr(0,C),S=i[1].substr(C+1,i[1].length);b=b.replace("$",""),(S=S.replace("$","")).match(/\D/g)&&!S.match(/[0-9]/g)&&b.match(/\D/g)&&!b.match(/[0-9]/g)?(b+"1:"+S+p.rowCount,b+="1",S+=p.rowCount,i[1]=b+":"+S):!S.match(/\D/g)&&S.match(/[0-9]/g)&&!b.match(/\D/g)&&b.match(/[0-9]/g)&&(a(parseInt(b,10)-1,0)+":"+a(parseInt(S,10)-1,p.colCount-1),o=[parseInt(b,10)-1,0,parseInt(S,10)-1,p.colCount-1],l=!1)}var x=void 0,w=this.parent.definedNames;if(!sf.base.isNullOrUndefined(w))for(v=0;v<w.length;v++)if(w[v].name===m){x=!0;break}if((Ze(i[1])||x)&&(o=l?t(i[1]):o,this.parent.scrollSettings.enableVirtualization&&(o[0]=o[0]>=this.parent.viewport.topIndex?o[0]-this.parent.viewport.topIndex:o[0],o[1]=o[1]>=this.parent.viewport.leftIndex?o[1]-this.parent.viewport.leftIndex:o[1]),!sf.base.isNullOrUndefined(p))){var I=s(o);if(p===this.parent.getActiveSheet())ir((function(){n.parent.goTo(I)}));else{if(I.indexOf(":")>=0){var E=I.split(":");I=E[0]===E[1]?E[0]:I}ir((function(){n.parent.goTo(n.parent.sheets[y].name+"!"+I)}))}}}}else e.setAttribute("target",h.target);this.parent.trigger("afterHyperlinkClick",d)}},e.prototype.hyperlinkClickHandler=function(e){var t=e.target;if(sf.base.closest(t,".e-link-dialog")&&sf.base.closest(t,".e-toolbar-item")){var r=(h=sf.base.closest(t,".e-hyperlink-dlg")||sf.base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,n=h.querySelector(".e-document"),i=h.querySelector(".e-webpage"),a=i?i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,s=n?n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:a;if(sf.base.closest(t,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var o=n.querySelectorAll(".e-cont")[2].querySelector(".e-active");n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=a,sf.base.closest(o,".e-list-item").classList.contains("e-level-2")&&r.hasAttribute("disabled")?r.removeAttribute("disabled"):sf.base.closest(o,".e-list-item").classList.contains("e-level-1")&&!r.hasAttribute("disabled")&&r.setAttribute("disabled","true")}else{var l=!i.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=s,l&&!r.hasAttribute("disabled")?r.setAttribute("disabled","true"):!l&&r.hasAttribute("disabled")&&r.removeAttribute("disabled")}}if(sf.base.closest(t,".e-list-item")&&t.classList.contains("e-fullrow")){var h,d=this.parent.element.getElementsByClassName("e-link-dialog")[0].getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0].getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];r=(h=sf.base.closest(t,".e-hyperlink-dlg")||sf.base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;sf.base.closest(t,".e-list-item").classList.contains("e-level-2")?("defName"===sf.base.closest(t,".e-list-item").getAttribute("data-uid")?d.classList.contains("e-disabled")||d.hasAttribute("readonly")||(d.setAttribute("readonly","true"),d.classList.add("e-disabled"),d.setAttribute("disabled","true")):"sheet"===sf.base.closest(t,".e-list-item").getAttribute("data-uid")&&d.classList.contains("e-disabled")&&d.hasAttribute("readonly")&&(d.removeAttribute("readonly"),d.classList.remove("e-disabled"),d.removeAttribute("disabled")),r.hasAttribute("disabled")&&r.removeAttribute("disabled")):sf.base.closest(t,".e-list-item").classList.contains("e-level-1")&&r.setAttribute("disabled","true")}else this.hlOpenHandler(t)},e.prototype.createHyperlinkElementHandler=function(e){var t=e.cell,n=e.td,i=(e.rowIdx,e.colIdx,this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"}));if(sf.base.isNullOrUndefined(t.hyperlink))n.querySelector("a")&&t.hyperlink&&"string"==typeof t.hyperlink&&n.querySelector("a").setAttribute("href",t.hyperlink);else{var a=t.hyperlink;"string"==typeof a?(-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&-1===a.indexOf("ftp://")&&-1!==a.indexOf("www.")&&(a="http://"+a),0===a.indexOf("http://")||0===a.indexOf("https://")||0===a.indexOf("ftp://")?(i.setAttribute("href",a),i.setAttribute("target","_blank")):(a.includes("=")||a.includes("!"))&&i.setAttribute("ref",a),i.innerText=""!==n.innerText?n.innerText:a,n.textContent="",n.innerText="",n.appendChild(i)):"object"===r(a)&&(0===a.address.indexOf("http://")||0===a.address.indexOf("https://")||0===a.address.indexOf("ftp://")?(i.setAttribute("href",a.address),i.setAttribute("target","_blank")):(a.address.includes("=")||a.address.includes("!"))&&i.setAttribute("ref",a.address),"Accounting"===D(t.format)?i.innerHTML=n.innerHTML:i.innerText=""!==n.innerText?n.innerText:a.address,n.textContent="",n.innerText="",n.appendChild(i))}},e.prototype.hyperEditContent=function(){var e=!0,n=this.hyperlinkContent(),i=t(this.parent.getActiveSheet().activeCell),a=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[i[0]].cells[i[1]];this.parent.scrollSettings.enableVirtualization&&(i[0]=i[0]-this.parent.viewport.topIndex,i[1]=i[1]-this.parent.viewport.leftIndex);var s,o=this.parent.getDisplayText(a),l=a.hyperlink;"string"==typeof l?(s=l,o=o||s,-1===s.indexOf("http://")&&-1===s.indexOf("https://")&&-1===s.indexOf("ftp://")&&(e=!1)):"object"===r(l)&&(s=l.address,o=o||s,-1===s.indexOf("http://")&&-1===s.indexOf("https://")&&-1===s.indexOf("ftp://")&&(e=!1));var h=n.querySelector(".e-content");if(e){var d=h.querySelector(".e-webpage");if(d.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o),"string"==typeof l)d.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",l);else d.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",l.address)}else{var p=void 0,c=h.querySelector(".e-document");c.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o);var u=void 0,f=(this.parent.getActiveSheet(),void 0);if(this.parent.definedNames)for(var g=0;g<this.parent.definedNames.length;g++)if(this.parent.definedNames[g].name===s){p=!0;break}if(p){var m=void 0;(m=c.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0]).setAttribute("readonly","true"),m.classList.add("e-disabled"),m.setAttribute("disabled","true");var v=c.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1];for(g=0;g<v.getElementsByTagName("li").length;g++)v.getElementsByTagName("li")[g].innerText===s&&v.getElementsByTagName("li")[g].classList.add("e-active")}else{s&&-1!==s.indexOf("!")&&(u=s.split("!"),f=parseInt(u[0].replace(/\D/g,""),10)-1,this.parent.sheets[f]);var y=u[0];c.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",u[1]);for(v=c.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0],g=0;g<v.getElementsByTagName("li").length;g++)if(v.getElementsByTagName("li")[g].innerText===y){if(v.getElementsByTagName("li")[g].classList.contains("e-active"))break;v.getElementsByTagName("li")[g].classList.add("e-active")}else v.getElementsByTagName("li")[g].classList.contains("e-active")&&v.getElementsByTagName("li")[g].classList.remove("e-active")}}return n},e.prototype.hyperlinkContent=function(){var e,n,i=this.parent.serviceLocator.getService(Mn),a=0,s=0,o=!0,l=!0,h=t(this.parent.getActiveSheet().activeCell),d=this.parent.getActiveSheet(),p=lt(h[0],h[1],d),c=!0;if(p){c=!!(p.value&&"string"==typeof p.value&&null!==p.value.match("[A-Za-z]+")||""===p.value||sf.base.isNullOrUndefined(p.value));var u=p.hyperlink;if("string"==typeof u)-1===(f=u).indexOf("http://")&&-1===f.indexOf("https://")&&-1===f.indexOf("ftp://")&&(n=u,o=!1);else if("object"===r(u)){var f;-1===(f=u.address).indexOf("http://")&&-1===f.indexOf("https://")&&-1===f.indexOf("ftp://")&&(n=u.address,o=!1)}if(s=o?0:1,this.parent.definedNames)for(var g=0;g<this.parent.definedNames.length;g++)if(this.parent.definedNames[g].name===n){e=!0,l=!1;break}}var m=this.parent.createElement("div",{className:"e-link-dialog"}),v=this.parent.createElement("div",{className:"e-webpage"}),y=this.parent.createElement("div",{className:"e-document"});new sf.navigations.Tab({selectedItem:s,items:[{header:{text:i.getConstant("WebPage")},content:v},{header:{text:i.getConstant("ThisDocument")},content:y}]}).appendTo(m),o?m.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 0; right: 136px"):m.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 136px; right: 0");var C=this.parent.createElement("div",{className:"e-cont"}),b=this.parent.createElement("div",{className:"e-cont"}),S=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("DisplayText")}),x=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("Url")}),w=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});c||(w.classList.add("e-disabled"),w.setAttribute("readonly","true"),w.setAttribute("disabled","true")),p&&sf.base.isNullOrUndefined(p.hyperlink)&&w.setAttribute("value",this.parent.getDisplayText(p));var I=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});w.setAttribute("placeholder",i.getConstant("EnterTheTextToDisplay")),I.setAttribute("placeholder",i.getConstant("EnterTheUrl")),C.appendChild(w),C.insertBefore(S,w),b.appendChild(I),b.insertBefore(x,I),v.appendChild(b),v.insertBefore(C,b);for(var E=[],R=[],k=this.parent.sheets;a<this.parent.sheets.length;a++){var A=this.parent.sheets[a].name;k[a]===this.parent.getActiveSheet()?E.push({nodeId:"sheet",nodeText:-1!==A.indexOf(" ")?"'"+A+"'":A,selected:!0}):E.push({nodeId:"sheet",nodeText:-1!==A.indexOf(" ")?"'"+A+"'":A})}for(a=0;a<this.parent.definedNames.length;a++)R.push({nodeId:"defName",nodeText:this.parent.definedNames[a].name});var F=[{nodeId:"01",nodeText:i.getConstant("CellReference"),expanded:l,nodeChild:E},{nodeId:"02",nodeText:i.getConstant("DefinedNames"),expanded:e,nodeChild:R}],T=new sf.navigations.TreeView({fields:{dataSource:F,id:"nodeId",text:"nodeText",child:"nodeChild"}}),O=this.parent.createElement("div",{className:"e-cont"}),N=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("CellReference")}),D=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});D.setAttribute("value","A1"),O.appendChild(D),O.insertBefore(N,D);var L=this.parent.createElement("div",{className:"e-cont"}),B=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("DisplayText")}),H=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});c||(H.classList.add("e-disabled"),H.setAttribute("readonly","true"),H.setAttribute("disabled","true")),p&&sf.base.isNullOrUndefined(p.hyperlink)&&H.setAttribute("value",this.parent.getDisplayText(p)),H.setAttribute("placeholder",i.getConstant("EnterTheTextToDisplay")),L.appendChild(H),L.insertBefore(B,H);var M=this.parent.createElement("div",{className:"e-cont"}),P=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("Sheet")}),_=this.parent.createElement("div",{className:"e-refcont"});return M.appendChild(_),M.insertBefore(P,_),y.appendChild(O),y.insertBefore(L,O),T.appendTo(_),y.appendChild(M),m},e}(),Qr=function(){function e(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}return e.prototype.setActionData=function(e){var r,n,i=this.parent.getActiveSheet(),a=[],s=e.args,o=s.eventArgs;switch(s.action){case"format":r=t(s.eventArgs.range);break;case"clipboard":var l=o.copiedInfo;r=t(h(o.pastedRange)),l.isCut&&(a=this.getCellDetails(l.range,kt(this.parent,wt(this.parent,l.sId))));break;case"beforeSort":(r=t(s.eventArgs.range))[0]===r[2]&&r[2]-r[0]==0&&(r[0]=0,r[1]=0,r[2]=i.usedRange.rowIndex,r[3]=i.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":r=t(o.address);break;case"beforeWrap":case"beforeReplace":r=this.parent.getAddressInfo(o.address).indices;break;case"beforeClear":case"beforeInsertImage":case"beforeInsertChart":case"filter":r=t(o.range)}n=this.getCellDetails(r,i),this.beforeActionData={cellDetails:n,cutCellDetails:a}},e.prototype.getBeforeActionData=function(e){e.beforeDetails=this.beforeActionData},e.prototype.performUndoRedo=function(e){var t=e.isUndo?this.undoCollection.pop():this.redoCollection.pop();if(this.isUndo=e.isUndo,t){switch(t.action){case"cellSave":case"format":case"sorting":case"wrap":case"cellDelete":t=this.performOperation(t);break;case"clipboard":t=this.undoForClipboard(t);break;case"resize":t=this.undoForResize(t);break;case"hideShow":t.eventArgs.hide=!t.eventArgs.hide,Tr(t,this.parent);break;case"replace":t=this.performOperation(t);break;case"insert":case"filter":case"delete":case"validation":Tr(t,this.parent,!e.isUndo);break;case"merge":t.eventArgs.merge=!t.eventArgs.merge,Tr(t,this.parent);break;case"clear":t=this.performOperation(t);break;case"conditionalFormat":case"clearCF":case"insertImage":case"imageRefresh":Tr(t,this.parent,!e.isUndo);break;case"insertChart":case"deleteChart":case"chartRefresh":Tr(t,this.parent,!e.isUndo)}e.isUndo?this.redoCollection.push(t):this.undoCollection.push(t),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons();var r=Object.assign({},t.eventArgs);r.requestType=e.isUndo?"undo":"redo",delete r.beforeActionData,e.isPublic||this.parent.notify(W,{eventArgs:r,action:"undoRedo"})}},e.prototype.updateUndoRedoCollection=function(e){var t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);var r=e.args.action;if(-1!==t.indexOf(r)||e.isPublic){var n=e.args.eventArgs;if("clipboard"===r||"sorting"===r||"format"===r||"cellSave"===r||"wrap"===r||"replace"===r||"validation"===r||"clear"===r||"conditionalFormat"===r||"clearCF"===r||"insertImage"===r||"imageRefresh"===r||"insertChart"===r||"chartRefresh"===r||"filter"===r||"cellDelete"===r){var i={beforeDetails:{cellDetails:[]}};this.parent.notify("getBeforeActionData",i),n.beforeActionData=i.beforeDetails}this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}},e.prototype.clearUndoRedoCollection=function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()},e.prototype.updateUndoRedoIcons=function(){var e=this.parent.serviceLocator.getService(Mn);this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])},e.prototype.undoForClipboard=function(e){var r,n=this,i=e.eventArgs,a=i.pastedRange.split("!"),o=t(a[1]),l=xt(this.parent,a[0]),h=kt(this.parent,l),d=i.copiedInfo,p=i.beforeActionData,u=this.checkRefreshNeeded(l);if("imagePaste"===e.eventArgs.requestType){var f=i.copiedShapeInfo;this.isUndo?(r=f.pictureElem,f.isCut?(this.parent.notify("deleteImage",{id:r.id,sheetIdx:i.pasteSheetIndex+1}),this.parent.notify("createImageElement",{options:{data:r.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:f.height,width:f.width,imageId:r.id},range:f.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify("deleteImage",{id:i.pastedPictureElement.id,sheetIdx:i.pasteSheetIndex+1})):f.isCut?(r=f.pictureElem,this.parent.notify("deleteImage",{id:r.id,sheetIdx:f.sId}),this.parent.notify("createImageElement",{options:{data:r.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:f.height,width:f.width,imageId:r.id},range:f.pastedRange,isPublic:!1,isUndoRedo:!0})):(r=i.pastedPictureElement,this.parent.notify("createImageElement",{options:{data:r.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:r.offsetHeight,width:r.offsetWidth,imageId:r.id},range:f.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{if(this.isUndo){if(d.isCut){var g=p.cutCellDetails;this.updateCellDetails(g,kt(this.parent,wt(this.parent,d.sId)),c(d.range),u),this.parent.notify("getFilteredCollection",null);for(var m=0;m<this.parent.sheets.length;m++){var v=wt(this.parent,d.sId);if(this.parent.filterCollection&&this.parent.filterCollection[m]&&this.parent.filterCollection[m].sheetIdx===i.pasteSheetIndex){var y=this.parent.filterCollection[m],C=t(y.filterRange),b=c(o);if(C[0]>=b[0]&&C[2]<=b[2]){this.parent.notify("initiateFilterUI",{predicates:null,range:y.filterRange,sIdx:i.pasteSheetIndex,isCut:!0});var S=[Math.abs(b[0]-C[0]),Math.abs(b[1]-C[1]),Math.abs(b[2]-C[2]),Math.abs(b[3]-C[3])],x=c(d.range);S=[x[0]+S[0],x[1]+S[1],Math.abs(x[2]-S[2]),Math.abs(x[3]-S[3])],this.parent.notify("initiateFilterUI",{predicates:null,range:s(S),sIdx:v,isCut:!0})}}}}this.updateCellDetails(p.cellDetails,h,o,u),Hr(h,o[0],o[1],20);var w=Mr(h,o[0]);Nr(this.parent,h,w,o[0]),i.mergeCollection.forEach((function(e){e.merge=!e.merge,n.parent.notify(T,e),e.merge=!e.merge}))}else Tr(e,this.parent,d.isCut);u&&this.parent.notify("selectRange",{indexes:o})}return e},e.prototype.undoForResize=function(e){var t=e.eventArgs;if(void 0===t.hide)if(t.isCol){var r=t.oldWidth;t.oldWidth=t.width,t.width=r}else{r=t.oldHeight;t.oldHeight=t.height,t.height=r}else t.hide=!t.hide;return Tr(e,this.parent),e},e.prototype.performOperation=function(e){var r=e.eventArgs,n="cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action?r.address.split("!"):r.range.split("!"),i=t(n[1]),a=i,s=xt(this.parent,n[0]),o=kt(this.parent,s),l=r.beforeActionData,h=this.checkRefreshNeeded(s);if(this.isUndo){this.updateCellDetails(l.cellDetails,o,i,h,e),Hr(o,i[0],i[1],20);var d=Mr(o,i[0]);Nr(this.parent,o,d,i[0])}else{var p=e.eventArgs,c=t(o.activeCell),u=this.parent.getCellStyleValue(["textDecoration"],c).textDecoration;if(p&&p.style&&p.style.textDecoration){var f=p.style.textDecoration,g=f,m=void 0,v=!1;"underline"===u?g="underline"===f?"none":"underline line-through":"line-through"===u?g="line-through"===f?"none":"underline line-through":"underline line-through"===u&&(g="underline"===f?"line-through":"underline",v=!0),"none"===g&&(v=!0),p.style.textDecoration=g,e.eventArgs=p,this.parent.notify(E,{style:{textDecoration:g},range:c,refreshRibbon:!0,onActionUpdate:!0});for(var y=a[0];y<=a[2];y++)for(var C=a[1];C<=a[3];C++)if(y!==c[0]||C!==c[1]){if(m={},"none"===(u=this.parent.getCellStyleValue(["textDecoration"],[y,C]).textDecoration)){if(v)continue;m.textDecoration=f}else if("underline"===u||"line-through"===u)if(v){if(f!==u)continue;m.textDecoration="none"}else m.textDecoration=f!==u?"underline line-through":f;else if("underline line-through"===u){if(!v)continue;m.textDecoration="underline"===f?"line-through":"underline"}this.parent.notify(E,{style:{textDecoration:m.textDecoration},range:[y,C,y,C],refreshRibbon:!0,onActionUpdate:!0})}p.style.textDecoration=f,e.eventArgs=p}else Tr(e,this.parent)}return h&&this.parent.notify("selectRange",{indexes:i}),e},e.prototype.getCellDetails=function(e,t){for(var r,n=[],i=(e=c(e))[0];i<=e[2];i++)for(var a=e[1];a<=e[3];a++)r=lt(i,a,t),n.push({rowIndex:i,colIndex:a,format:r?r.format:null,style:r&&r.style?Object.assign({},r.style):null,value:r?r.value:"",formula:r?r.formula:"",wrap:r&&r.wrap,rowSpan:r&&r.rowSpan,colSpan:r&&r.colSpan,hyperlink:r&&r.hyperlink,image:r&&r.image&&r.chart});return n},e.prototype.updateCellDetails=function(e,t,r,n,i){for(var a,o=e.length,l=0;l<o;l++)ht(e[l].rowIndex,e[l].colIndex,t,{value:e[l].value,format:e[l].format,style:e[l].style&&Object.assign({},e[l].style),formula:e[l].formula,wrap:e[l].wrap,rowSpan:e[l].rowSpan,colSpan:e[l].colSpan,hyperlink:e[l].hyperlink}),e[l].formula&&this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[e[l].rowIndex,e[l].colIndex,e[l].rowIndex,e[l].colIndex],value:e[l].formula}),i&&"wrap"===i.action&&i.eventArgs.wrap&&this.parent.notify("wrapText",{range:[e[l].rowIndex,e[l].colIndex,e[l].rowIndex,e[l].colIndex],wrap:!1,sheet:t}),i&&e[l].hyperlink&&"clear"===i.action&&(i.eventArgs.range=t.name+"!"+s([e[l].rowIndex,e[l].colIndex,e[l].rowIndex,e[l].colIndex]),a=this.parent.getCell(e[l].rowIndex,e[l].colIndex),"Clear All"===i.eventArgs.type||"Clear Hyperlinks"===i.eventArgs.type?this.parent.addHyperlink(e[l].hyperlink,i.eventArgs.range):"Clear Formats"===i.eventArgs.type&&sf.base.addClass(a.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"));n&&this.parent.serviceLocator.getService("cell").refreshRange(r)},e.prototype.checkRefreshNeeded=function(e){var t=!0;return e!==this.parent.activeSheetIndex&&(this.parent.activeSheetIndex=e,this.parent.dataBind(),t=!1),t},e.prototype.addEventListener=function(){this.parent.on("performUndoRedo",this.performUndoRedo,this),this.parent.on("updateUndoRedoCollection",this.updateUndoRedoCollection,this),this.parent.on("setActionData",this.setActionData,this),this.parent.on("getBeforeActionData",this.getBeforeActionData,this),this.parent.on("clearUndoRedoCollection",this.clearUndoRedoCollection,this),this.parent.on("setUndoRedo",this.updateUndoRedoIcons,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("performUndoRedo",this.performUndoRedo),this.parent.off("updateUndoRedoCollection",this.updateUndoRedoCollection),this.parent.off("setActionData",this.setActionData),this.parent.off("getBeforeActionData",this.getBeforeActionData),this.parent.off("clearUndoRedoCollection",this.clearUndoRedoCollection),this.parent.off("setUndoRedo",this.updateUndoRedoIcons))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"undoredo"},e}(),en=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on("wrapText",this.wrapTextHandler,this),this.parent.on("rowHeightChanged",this.rowHeightChangedHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off("wrapText",this.wrapTextHandler),this.parent.off("rowHeightChanged",this.rowHeightChangedHandler))},e.prototype.wrapTextHandler=function(e){if(cr(this.parent,e.range,!0))for(var t=void 0,r=void 0,n=void 0,i=void 0,a=void 0,s=void 0,o=e.range[0];o<=e.range[2];o++){a=0,i=jt(e.sheet,o).customHeight;for(var l=e.range[1];l<=e.range[3];l++)if((t=e.initial?e.td:this.parent.getCell(o,l))&&(e.wrap?t.classList.add(Hn):t.classList.remove(Hn),i&&(0!==t.children.length&&t.querySelector(".e-wrap-content")||(t.innerHTML=this.parent.createElement("span",{className:"e-wrap-content",innerHTML:t.innerHTML}).outerHTML))),sf.base.Browser.isIE&&t.classList.add("e-ie-wrap"),!i){r=lt(o,l,e.sheet),n=tr(e.sheet,l,r.colSpan>1?l+r.colSpan-1:l);var h=this.parent.getDisplayText(r);if(h.indexOf("\n")<0){var d=this.parent.element.querySelector(".e-spreadsheet-edit");d&&d.textContent.indexOf("\n")>-1&&(h=d.textContent)}if(h)if(e.wrap){t&&t.classList.contains("e-alt-unwrap")&&t.classList.remove("e-alt-unwrap");var p=void 0,c=0,u=void 0;if(h.indexOf("\n")>-1){var f=h.split("\n"),g=f.length;for(u=0;u<g;u++)0===(p=Br(f[u],n,r.style,this.parent.cellStyle))&&(p=1),c+=p;p=c}else p=Br(h,n,r.style,this.parent.cellStyle);s=Dr(this.parent,r.style||this.parent.cellStyle,p)+1,a=Math.max(a,s),Hr(e.sheet,o,l,s)}else h.indexOf("\n")>-1&&t.classList.add("e-alt-unwrap"),s=Dr(this.parent,r.style||this.parent.cellStyle,1),Hr(e.sheet,o,l,s),a=Math.max(Mr(e.sheet,o),20);else e.wrap||(Hr(e.sheet,o,l,20),a=20);l===e.range[3]&&(e.wrap&&a>20&&Mr(e.sheet,o)<=a||!e.wrap&&Mr(e.sheet,o)<Wt(e.sheet,o)&&Wt(e.sheet,o)>20)&&Nr(this.parent,e.sheet,a,o,e.row,e.hRow)}}},e.prototype.ribbonClickHandler=function(e){var t=sf.base.closest(e.originalEvent.target,".e-btn");if(t&&t.id===this.parent.element.id+"_wrap"){var r=t.classList.contains("e-active"),n=d(this.parent.getActiveSheet()),i={address:n,wrap:r,cancel:!1};this.parent.notify(G,{action:"beforeWrap",eventArgs:i}),i.cancel||(pt(this.parent.getActiveSheet().selectedRange,r,this.parent),this.parent.notify(W,{action:"wrap",eventArgs:{address:n,wrap:r}}))}},e.prototype.getTextWidth=function(e,t){void 0===t&&(t=this.parent.cellStyle);var r=this.parent.cellStyle,n=document.createElement("canvas").getContext("2d");return n.font=(t.fontStyle||r.fontStyle)+" "+(t.fontWeight||r.fontWeight)+" "+(t.fontSize||r.fontSize)+" "+(t.fontFamily||r.fontFamily),n.measureText(e).width},e.prototype.rowHeightChangedHandler=function(e){if(e.isCustomHgt)for(var t=this.parent.getActiveSheet(),r=this.parent.viewport.leftIndex,n=r+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),i=r;i<n;i++){var a=lt(e.rowIdx,i,t);if(a&&a.wrap){var s=this.parent.getCell(e.rowIdx,i);0!==s.children.length&&s.querySelector(".e-wrap-content")||(s.innerHTML=this.parent.createElement("span",{className:"e-wrap-content",innerHTML:s.innerHTML}).outerHTML)}}},e.prototype.getModuleName=function(){return"wrapText"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),tn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insert=function(e){var t;switch(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(G,{eventArgs:e,action:"insert"}),e.modelType){case"Sheet":this.parent.notify("insertSheetTab",{startIdx:e.index,endIdx:e.index+(e.model.length-1),preventUpdate:!t}),this.parent.renderModule.refreshSheet(),_r(this.parent.element);break;case"Row":(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.bottomIndex)&&(this.parent.scrollSettings.enableVirtualization?(e.index<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex+=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===Pr(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:e.index,colIndex:0,refresh:"Row"}),this.parent.notify("dataChanged",e),this.parent.selectRange(this.parent.getActiveSheet().selectedRange));break;case"Column":(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.rightIndex)&&(this.parent.scrollSettings.enableVirtualization?(e.index<this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex+=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Pr(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:0,colIndex:e.index,refresh:"Column"}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange))}this.refreshImgElement(e.model.length,this.parent.activeSheetIndex,e.modelType,e.index),t&&this.parent.notify(W,{eventArgs:e,action:"insert"})},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,a=this.parent.sheets[t],s=[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],o=0;o<=s[2];o++)for(var l=s[1];l<=s[3];l++)(i=lt(o,l,a))&&i.image&&i.image.length>0&&("Row"===r&&o>=n||"Column"===r&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:o,colIdx:l,sheetIdx:t,type:r,count:e,status:"insert"})},e.prototype.addEventListener=function(){this.parent.on("insert",this.insert,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("insert",this.insert)},e.prototype.getModuleName=function(){return"insert"},e}(),rn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.delete=function(e){var t;if(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(G,{eventArgs:e,action:"delete"}),"Sheet"===e.modelType){var r=e.activeSheetIndex>=e.startIndex&&e.activeSheetIndex<=e.endIndex;r&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(e.startIndex<this.parent.sheets.length?e.startIndex:e.startIndex?e.startIndex-1:0)},!0),this.parent.notify("refreshSheetTabs",null),r&&this.parent.renderModule.refreshSheet(),_r(this.parent.element)}else"Row"===e.modelType?((!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.bottomIndex)&&(this.parent.scrollSettings.enableVirtualization?(e.startIndex<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex-=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===Pr(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:this.parent.viewport.leftIndex})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Row",rowIndex:e.startIndex,colIndex:0})),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):((!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.rightIndex)&&(this.parent.scrollSettings.enableVirtualization?(e.startIndex<this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex-=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Pr(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,refresh:"Column",colIndex:this.parent.viewport.leftIndex})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Column",rowIndex:0,colIndex:e.startIndex})),this.parent.selectRange(this.parent.getActiveSheet().selectedRange));this.refreshImgElement(e.deletedModel.length,this.parent.activeSheetIndex,e.modelType,e.startIndex),t&&this.parent.notify(W,{eventArgs:e,action:"delete"}),"Row"===e.modelType&&this.parent.notify("dataChanged",e)},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,a=this.parent.sheets[t],s=[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],o=0;o<=s[2];o++)for(var l=s[1];l<=s[3];l++)(i=lt(o,l,a))&&i.image&&i.image.length>0&&("Row"===r&&o>=n||"Column"===r&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:o,colIdx:l,sheetIdx:t,type:r,count:e,status:"delete"})},e.prototype.addEventListener=function(){this.parent.on("delete",this.delete,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("delete",this.delete)},e.prototype.getModuleName=function(){return"delete"},e}(),nn=function(){function e(e){this.data=[],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener();var e=sf.base.select("#"+this.parent.element.id+"_datavalidation-popup");e&&e.remove(),this.parent=null},e.prototype.addEventListener=function(){sf.base.EventHandler.add(this.parent.element,"dblclick",this.listOpen,this),sf.base.EventHandler.add(document,"mousedown",this.mouseDownHandler,this),this.parent.on("initiatedatavalidation",this.initiateDataValidationHandler,this),this.parent.on("invalidData",this.invalidDataHandler,this),this.parent.on("isValidation",this.checkDataValidation,this),this.parent.on("activeCellChanged",this.listHandler,this),this.parent.on(P,this.keyUpHandler,this),this.parent.on("removeDataValidation",this.removeValidationHandler,this)},e.prototype.removeEventListener=function(){sf.base.EventHandler.remove(this.parent.element,"dblclick",this.listOpen),sf.base.EventHandler.remove(document,"mousedown",this.mouseDownHandler),this.parent.isDestroyed||(this.parent.off("initiatedatavalidation",this.initiateDataValidationHandler),this.parent.off("invalidData",this.invalidDataHandler),this.parent.off("isValidation",this.checkDataValidation),this.parent.off("activeCellChanged",this.listHandler),this.parent.off(P,this.keyUpHandler),this.parent.off("removeDataValidation",this.removeValidationHandler))},e.prototype.removeValidationHandler=function(e){this.parent.removeDataValidation(this.parent.getActiveSheet().selectedRange)},e.prototype.mouseDownHandler=function(e){var t=e.target,r=sf.base.closest(t,".e-ddl");r&&"listValid_popup"===r.getAttribute("id")&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:t.innerText})},e.prototype.keyUpHandler=function(e){var t=e.target,r=this.parent.element.querySelector(".e-datavalidation-dlg");if(sf.base.closest(t,".e-values")&&r&&13!==e.keyCode){var n=r.querySelector(".e-values"),i=n.querySelector(".e-dlg-error"),a=r.querySelector(".e-footer-content").querySelector(".e-primary");a.hasAttribute("disabled")&&a.removeAttribute("disabled"),i&&n.removeChild(i)}},e.prototype.listOpen=function(e){var t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.listObj.showPopup()},e.prototype.invalidDataHandler=function(e){e.isRemoveHighlight?this.parent.removeInvalidHighlight():this.parent.addInvalidHighlight()},e.prototype.listHandler=function(){var e=this;if(this.parent.allowDataValidation){var t,r=this.parent.getActiveSheet(),i=(this.parent.getMainContent(),n(r.activeCell)),a=lt(i[0],i[1],r);if(!(t=this.parent.getCell(i[0],i[1])))return;if(document.getElementsByClassName("e-validation-list")[0]&&(sf.base.remove(document.getElementsByClassName("e-validation-list")[0]),this.data=[]),a&&a.validation&&"List"===a.validation.type&&(a.validation.ignoreBlank=!!sf.base.isNullOrUndefined(a.validation.ignoreBlank)||a.validation.ignoreBlank,a.validation.inCellDropDown=!!sf.base.isNullOrUndefined(a.validation.inCellDropDown)||a.validation.inCellDropDown,a.validation.inCellDropDown)){var s=this.parent.createElement("div",{className:"e-validation-list"}),o=this.parent.createElement("input",{id:"listValid"});s.appendChild(o),a.validation.inCellDropDown||(s.style.display="none"),t.insertBefore(s,t.firstChild),this.listObj=new sf.dropdowns.DropDownList({index:0,dataSource:this.data,fields:{text:"text",value:"id"},width:"0px",popupWidth:"200px",popupHeight:"200px",beforeOpen:function(){e.listObj.popupWidth=t.offsetWidth-1,e.data=[],e.updateDataSource(e.listObj,a)},change:function(){e.listValueChange(e.listObj.text)},open:function(e){e.popup.offsetX=4-(t.offsetWidth-20),e.popup.offsetY=-13}}),this.listObj.appendTo("#listValid")}}},e.prototype.updateDataSource=function(e,r){var n=0,i=r.validation.value1;if(-1!==i.indexOf("=")){var a=i.indexOf("!")>-1?kt(this.parent,xt(this.parent,i.split("=")[1].split("!")[0])):this.parent.getActiveSheet(),s=i.indexOf("!")>-1?i.split("!")[1]:i.split("=")[1],o=void 0,l=s.split(":");if(l[0].match(/[a-z]+$/gi)&&l[1].match(/[a-z]+$/gi)||l[0].match(/^[0-9]/g)&&l[1].match(/^[0-9]/g)){var h=this.parent.getIndexes(s);o=h.isCol?[0,h.startIdx,a.usedRange.rowIndex,h.startIdx]:[h.startIdx,0,h.startIdx,a.usedRange.colIndex]}else o=t(s);for(var d=o[0];d<=o[2];d++){a.rows[d]||qt(a,d,{});for(var p=o[1];p<=o[3];p++){a.rows[d].cells||ht(d,p,a,{}),n+=1,r=a.rows[d].cells[p];var c=this.parent.getDisplayText(r)?this.parent.getDisplayText(r):"";this.data.push({text:c,id:"list-"+n})}}}else for(var u=i.split(","),f=0;f<u.length;f++)n+=1,this.data.push({text:u[f],id:"list-"+n});e.dataSource=this.data},e.prototype.listValueChange=function(e){var t=this.parent.getActiveSheet(),r=l(t.activeCell),n=Object.assign({},lt(r[0],r[1],t));t.isProtected&&et(n,Jt(t,r[1]))?this.parent.notify("editAlert",null):(this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:t.activeCell,value:e}),this.parent.serviceLocator.getService("cell").refreshRange(r),this.parent.trigger("cellSave",{value:e,oldValue:n&&n.value,address:t.name+"!"+t.activeCell,displayText:this.parent.getDisplayText(lt(r[0],r[1],t))}))},e.prototype.initiateDataValidationHandler=function(){for(var e,r,n,i,a,s=this,o=this.parent.serviceLocator.getService(Mn),l=!0,h=!0,d=!0,p=this.parent.getActiveSheet(),c=t(p.selectedRange),u=c[0];u<=c[2];u++)if(p.rows[u])for(var f=c[1];f<=c[3];f++)p.rows[u].cells&&p.rows[u].cells[f]&&(a=p.rows[u].cells[f]).validation&&(d=!1,e=a.validation.type,r=a.validation.operator,n=a.validation.value1,i=a.validation.value2,l=sf.base.isNullOrUndefined(a.validation.ignoreBlank)?l:a.validation.ignoreBlank,h=sf.base.isNullOrUndefined(a.validation.inCellDropDown)?h:a.validation.inCellDropDown);if(!this.parent.element.querySelector(".e-datavalidation-dlg")){var g=this.parent.serviceLocator.getService(Pn);g.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:o.getConstant("DataValidation"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(t){var a={dialogName:"ValidationDialog",element:t.element,target:t.target,cancel:t.cancel};s.parent.trigger("dialogBeforeOpen",a),a.cancel&&(t.cancel=!0),g.dialogInstance.content=s.dataValidationContent(d,e,r,n,i,l,h),g.dialogInstance.dataBind(),_r(s.parent.element)},buttons:[{buttonModel:{content:o.getConstant("CLEARALL"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){g.dialogInstance.content=s.dataValidationContent(!0,e,r,n,i,l,h),g.dialogInstance.dataBind(),_r(s.parent.element)}},{buttonModel:{content:o.getConstant("APPLY"),isPrimary:!0},click:function(){s.dlgClickHandler(g)}}]}),g.dialogInstance.refresh()}},e.prototype.dataValidationContent=function(e,t,r,n,i,a,s){var o=this,l=this.parent.serviceLocator.getService(Mn),h=e?"0":n,d=e?"0":i,p=this.parent.createElement("div",{className:"e-validation-dlg"}),c=this.parent.createElement("div",{className:"e-cellrange"}),u=this.parent.createElement("div",{className:"e-allowdata"}),f=this.parent.createElement("div",{className:"e-values"}),g=this.parent.createElement("div",{className:"e-ignoreblank"});p.appendChild(c),p.appendChild(u),p.appendChild(f),p.appendChild(g);var m=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("CellRange")}),v=this.parent.createElement("input",{className:"e-input",attrs:{value:this.parent.getActiveSheet().selectedRange}});c.appendChild(m),c.appendChild(v);var y=this.parent.createElement("div",{className:"e-allow"}),C=this.parent.createElement("div",{className:"e-data"});u.appendChild(y),u.appendChild(C);var b=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("Allow")});this.typeData=[{text:l.getConstant("WholeNumber"),id:"type-1"},{text:l.getConstant("Decimal"),id:"type-2"},{text:l.getConstant("Date"),id:"type-3"},{text:l.getConstant("Time"),id:"type-4"},{text:l.getConstant("TextLength"),id:"type-5"},{text:l.getConstant("List"),id:"type-6"}],this.operatorData=[{text:l.getConstant("Between"),id:"operator-1"},{text:l.getConstant("NotBetween"),id:"operator-2"},{text:l.getConstant("EqualTo"),id:"operator-3"},{text:l.getConstant("NotEqualTo"),id:"operator-4"},{text:l.getConstant("Greaterthan"),id:"operator-5"},{text:l.getConstant("Lessthan"),id:"operator-6"},{text:l.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:l.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var S=this.parent.createElement("input",{className:"e-select"}),x=0;if(!e)for(var w=0;w<this.typeData.length;w++)if(t===this.typeData[w].text.replace(" ","")){x=w;break}if(e||"List"!==t){var I=0,E=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("Data")}),R=this.parent.createElement("input",{className:"e-select"});if(!e)for(w=0;w<this.operatorData.length;w++)if(r===this.FormattedValue(this.operatorData[w].text)){I=w;break}C.appendChild(E),C.appendChild(R),this.dataList=new sf.dropdowns.DropDownList({dataSource:this.operatorData,index:I,popupHeight:"200px",change:function(){o.userInput(A,o.dataList)}}),this.dataList.appendTo(R)}else{var k=this.parent.createElement("input",{className:"e-checkbox"});C.appendChild(k),new sf.buttons.CheckBox({label:l.getConstant("InCellDropDown"),checked:s}).appendTo(k)}y.appendChild(b),y.appendChild(S);var A=new sf.dropdowns.DropDownList({dataSource:this.typeData,index:x,popupHeight:"200px",change:function(){o.userInput(A,o.dataList)}});if(A.appendTo(S),e||"List"!==A.value&&("Between"===this.dataList.value||"Not between"===this.dataList.value)){var F=this.parent.createElement("div",{className:"e-minimum"}),T=this.parent.createElement("div",{className:"e-maximum"});f.appendChild(F),f.appendChild(T);var O=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("Minimum")}),N=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("Maximum")}),D=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:h}}),L=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:d}});F.appendChild(O),F.appendChild(D),T.appendChild(N),T.appendChild(L),new sf.inputs.NumericTextBox({value:0}).appendTo("#minvalue"),new sf.inputs.NumericTextBox({value:0}).appendTo("#maxvalue")}else if(e&&" List"!==t){B=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("Value")}),H=this.parent.createElement("input",{className:"e-input",attrs:{value:h}});f.appendChild(B),f.appendChild(H)}else{var B=this.parent.createElement("span",{className:"e-header",innerHTML:l.getConstant("Sources")}),H=this.parent.createElement("input",{className:"e-input",attrs:{value:h}});f.appendChild(B),f.appendChild(H)}var M=a,P=this.parent.createElement("input",{className:"e-checkbox"});return g.appendChild(P),new sf.buttons.CheckBox({label:l.getConstant("IgnoreBlank"),checked:M}).appendTo(P),p},e.prototype.userInput=function(e,t){var r=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=r.querySelector(".e-allowdata"),i=r.querySelector(".e-values"),a=this.parent.serviceLocator.getService(Mn),s=n.querySelector(".e-data");for(s.querySelector(".e-valid-input");i.lastChild;)i.removeChild(i.lastChild);if("List"===e.value){for(;s.lastChild;)s.removeChild(s.lastChild);var o=this.parent.createElement("input",{className:"e-checkbox"});s.appendChild(o),new sf.buttons.CheckBox({label:a.getConstant("InCellDropDown"),checked:!0}).appendTo(o)}else if(s.getElementsByClassName("e-checkbox-wrapper")[0]){for(;s.lastChild;)s.removeChild(s.lastChild);var l=this.parent.createElement("span",{className:"e-header",innerHTML:"Data"}),h=this.parent.createElement("input",{className:"e-select"});s.appendChild(l),s.appendChild(h),t.appendTo(h)}if("List"===e.value||"Between"!==t.value&&"Not between"!==t.value){var d="List"===e.value?a.getConstant("Sources"):a.getConstant("Value"),p=this.parent.createElement("span",{className:"e-header",innerHTML:d}),c="List"===e.value?this.parent.createElement("input",{className:"e-input",attrs:{placeholder:"Enter value"}}):this.parent.createElement("input",{className:"e-input",attrs:{value:"0"}});i.appendChild(p),i.appendChild(c)}else{var u=this.parent.createElement("div",{className:"e-minimum"}),f=this.parent.createElement("div",{className:"e-maximum"});i.appendChild(u),i.appendChild(f);var g=this.parent.createElement("span",{className:"e-header",innerHTML:a.getConstant("Minimum")}),m=this.parent.createElement("span",{className:"e-header",innerHTML:a.getConstant("Maximum")}),v=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),y=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});new sf.inputs.NumericTextBox({value:0}).appendTo("min"),new sf.inputs.NumericTextBox({value:0}).appendTo("max"),u.appendChild(g),u.appendChild(v),f.appendChild(m),f.appendChild(y)}},e.prototype.dlgClickHandler=function(e){var t,r,i=this.parent.serviceLocator.getService(Mn),a=!0,s=this.parent.element.querySelector(".e-datavalidation-dlg"),o=s.querySelector(".e-footer-content"),l=s.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],h=l.getElementsByClassName("e-allowdata")[0],d=h.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],p=h.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],c=l.getElementsByClassName("e-values")[0],u=c.getElementsByTagName("input")[0].value,f=c.getElementsByTagName("input")[1]?c.getElementsByTagName("input")[1].value:"",g="true"===l.querySelector(".e-ignoreblank").querySelector(".e-checkbox-wrapper").getAttribute("aria-checked"),m=h.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!h.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,v=l.querySelector(".e-cellrange").getElementsByTagName("input")[0].value,y=d.value;p&&(r=p.value,r=this.FormattedValue(r)),y&&(y=y.replace(" ",""));var C=[],b=[];if(""!==u&&b.push(u),""!==f&&b.push(f),"List"===y)if(-1!==u.indexOf("=")){if(-1!==u.indexOf(":")){var S=u.indexOf("!")>-1?u.split("!")[1]:u.split("=")[1],x=!(u.indexOf("!")>-1)||xt(this.parent,u.split("=")[1].split("!")[0])>-1;C=S.split(":");var w=!!S.match(/[a-z]/gi)&&C[0].replace(/[0-9]/g,"")===C[1].replace(/[0-9]/g,""),I=!!S.match(/\d/g)&&C[0].replace(/\D/g,"")===C[1].replace(/\D/g,"");(a=!!x&&(!!w||!!I))||(t=i.getConstant("DialogError"))}}else u.length>256&&(a=!1,t=i.getConstant("ListLengthError"));if("List"!==y||a){var E=this.parent.getActiveSheet(),R=y,k=this.isDialogValidator(b,R,r);if(t=k.errorMsg,a=k.isValidate){var A=n(this.parent.getActiveSheet().activeCell);if(E&&E.rows[A[0]]&&E.rows[A[0]].cells[A[1]]&&E.rows[A[0]].cells[A[1]].validation&&"List"===E.rows[A[0]].cells[A[1]].validation.type){var F=this.parent.getMainContent().getElementsByTagName("tr")[A[0]].getElementsByClassName("e-cell")[A[1]];F&&F.getElementsByClassName("e-validation-list")[0]&&(F.removeChild(F.getElementsByClassName("e-validation-list")[0]),this.listObj.destroy())}var T={type:y,operator:r,value1:u,value2:f,ignoreBlank:g,inCellDropDown:m};this.parent.addDataValidation(T,v),"List"===y&&a&&this.listHandler(),document.getElementsByClassName("e-validationerror-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide())}}if(!a){var O=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid",innerHTML:t});c.appendChild(O),o.querySelector(".e-primary").setAttribute("disabled","true")}},e.prototype.FormattedValue=function(e){switch(e){case"Between":e="Between";break;case"Not between":e="NotBetween";break;case"Equal to":e="EqualTo";break;case"Not equal to":e="NotEqualTo";break;case"Greater than":e="GreaterThan";break;case"Less than":e="LessThan";break;case"Greater than or equal to":e="GreaterThanOrEqualTo";break;case"Less than or equal to":e="LessThanOrEqualTo";break;default:e="Between"}return e},e.prototype.isDialogValidator=function(e,t,r){var n,i=this.parent.serviceLocator.getService(Mn),a=0;if("List"===t?!(e.length>0):"Between"===r||"NotBetween"===r?2!==e.length:!(e.length>0))n={isValidate:!1,errorMsg:i.getConstant("EmptyError")};else{for(var s=0;s<e.length&&(n=this.formatValidation(e[s],t)).isValidate;s++)a+=1;n.isValidate=a===e.length}return{isValidate:n.isValidate,errorMsg:n.errorMsg}},e.prototype.isValidationHandler=function(e){var t,r,n=this.parent.serviceLocator.getService(Mn);e.value=e.value?e.value:"";var i=e.value,a=this.parent.sheets[e.sheetIdx],s=lt(e.range[0],e.range[1],a),o=e.value,l=s.validation.value1,h=s.validation.value2,d=s.validation.operator,p=s.validation.type,c=!!sf.base.isNullOrUndefined(s.validation.ignoreBlank)||s.validation.ignoreBlank,u=this.formatValidation(e.value,p);if(t=u.isValidate,u.errorMsg,t){if(t=!1,"Date"===p||"Time"===p)for(var f=0;f<=3;f++){e.value=0===f?e.value:1===f?s.validation.value1:s.validation.value2;var g={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};""!==e.value&&this.parent.notify("checkDateFormat",g);var m=g.updatedVal;0===f?o="Date"===p?e.value:m.slice(m.indexOf(".")+1,m.length):1===f?l="Date"===p?m:m.slice(m.indexOf(".")+1,m.length):h="Date"===p?m:m.slice(m.indexOf(".")+1,m.length)}else"TextLength"===s.validation.type&&(o=e.value.toString().length.toString());if("List"===p)if(-1!==l.indexOf("="))for(f=0;f<this.data.length;f++)e.value===this.data[f].text&&(t=!0);else{var v=l.split(",");for(f=0;f<v.length;f++)e.value===v[f]&&(t=!0)}else switch("Decimal"===p?(o=parseFloat(o.toString()),l=parseFloat(l.toString()),h=h?parseFloat(h.toString()):null):(o=parseInt(o.toString(),10),l=parseInt(l.toString(),10),h=h?parseInt(h.toString(),10):null),d){case"EqualTo":t=o===l||!(!c||""!==i);break;case"NotEqualTo":t=o!==l||!(!c||""!==i);break;case"Between":t=o>=l&&o<=h||!(!c||""!==i);break;case"NotBetween":t=!(o>=l&&o<=h);break;case"GreaterThan":t=o>l||!(!c||""!==i);break;case"LessThan":t=o<l||!(!c||""!==i);break;case"GreaterThanOrEqualTo":t=o>=l||!(!c||""!==i);break;case"LessThanOrEqualTo":t=o<=l||!(!c||""!==i)}}if(r=n.getConstant("ValidationError"),t){var y=this.parent.getCellStyleValue(["backgroundColor","color"],[e.range[0],e.range[1]]);this.parent.notify(R,{style:y,rowIdx:e.range[0],colIdx:e.range[1],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})}return{isValidate:t,errorMsg:r}},e.prototype.checkDataValidation=function(e){var t=this.isValidationHandler({value:e.value,range:e.range,sheetIdx:e.sheetIdx});!t.isValidate&&e.isCell&&this.validationErrorHandler(t.errorMsg),this.parent.allowDataValidation=t.isValidate},e.prototype.formatValidation=function(e,t){var r,n,i,a=this.parent.element.getElementsByClassName("e-sheet-panel")[0],s=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),o=this.parent.createElement("input",{id:"e-validation",innerHTML:e});switch(o.setAttribute("name","validation"),o.setAttribute("type","text"),o.setAttribute("value",e),s.appendChild(o),a.appendChild(s),t){case"Date":i={rules:{validation:{date:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"Decimal":i={rules:{validation:{number:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"WholeNumber":i={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}}}return r=new sf.inputs.FormValidator("#formId",i).validate(),a.removeChild(a.getElementsByClassName("form-horizontal")[0]),{isValidate:r,errorMsg:n}},e.prototype.validationErrorHandler=function(e){var t=this,r=document.getElementsByClassName("e-spreadsheet-edit")[0],n=this.parent.serviceLocator.getService(Mn);if(!this.parent.element.querySelector(".e-validationerror-dlg")){var i=this.parent.serviceLocator.getService(Pn),a={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validationerror-dlg",target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(n){var a={dialogName:"ValidationErrorDialog",element:n.element,target:n.target,cancel:n.cancel,content:e};t.parent.trigger("dialogBeforeOpen",a),a.cancel&&(t.errorDlgHandler(i,"Cancel"),n.cancel=!0),r.focus(),i.dialogInstance.content=a.content,i.dialogInstance.dataBind()},buttons:[{buttonModel:{content:n.getConstant("Retry"),isPrimary:!0},click:function(){t.errorDlgHandler(i,"Retry")}},{buttonModel:{content:n.getConstant("Cancel")},click:function(){t.errorDlgHandler(i,"Cancel")}}]};i.show(a,!1)}},e.prototype.errorDlgHandler=function(e,t){if("Retry"===t){var r=document.getElementsByClassName("e-spreadsheet-edit")[0];this.parent.getMainContent();if(e.hide(),r.innerText){var i=document.createRange();i.setStart(r.childNodes[0],0),i.setEnd(r.childNodes[0],r.innerText.length);var a=window.getSelection();a.removeAllRanges(),a.addRange(i),this.listObj&&this.listObj.showPopup()}}else{var s=n(this.parent.getActiveSheet().activeCell),o=this.parent.getDisplayText(this.parent.getActiveSheet().rows[s[0]].cells[s[1]]);this.parent.notify(H,{action:"cancelEdit",value:o,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}},e.prototype.getModuleName=function(){return"dataValidation"},e}(),an=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("applyProtect",this.protect,this),this.parent.on("protectSheet",this.protectSheetHandler,this),this.parent.on("editAlert",this.editProtectedAlert,this),this.parent.on("applyLockCells",this.lockCellsHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applyProtect",this.protect),this.parent.off("protectSheet",this.protectSheetHandler),this.parent.off("editAlert",this.editProtectedAlert),this.parent.off("applyLockCells",this.lockCellsHandler))},e.prototype.protect=function(e){this.parent.notify("clearCopy",null),e.isActive?(this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1),this.parent.notify("updateToggleItem",{props:"Protect"}),this.parent.notify("protectSheet",{isActive:e.isActive}),this.parent.notify("protectSelection",null)):this.createDialogue()},e.prototype.createDialogue=function(){var e=this,t=this.parent.serviceLocator.getService(Mn),r=[{text:t.getConstant("SelectCells"),id:"1"},{text:t.getConstant("FormatCells"),id:"2"},{text:t.getConstant("FormatRows"),id:"3"},{text:t.getConstant("FormatColumns"),id:"4"},{text:t.getConstant("InsertLinks"),id:"5"}];this.optionList=new sf.lists.ListView({width:"250px",dataSource:r,showCheckBox:!0,select:this.dialogOpen.bind(this)});var n=this.parent.createElement("div",{className:"e-protect-content",innerHTML:t.getConstant("ProtectAllowUser")});this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var i=new sf.buttons.CheckBox({checked:!0,label:t.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),a=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),s=this.parent.createElement("div",{className:"e-header-content",innerHTML:t.getConstant("ProtectSheet")}),o=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}});this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:s.outerHTML,content:o.outerHTML+n.outerHTML+a.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(t){var r={dialogName:"ProtectSheetDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),_r(e.parent.element)},open:function(){e.okBtnFocus()},beforeClose:function(){var t=document.getElementById(e.parent.element.id+"_protect_check");sf.base.EventHandler.remove(t,"focus",e.okBtnFocus),sf.base.EventHandler.remove(i.element,"click",e.checkBoxClickHandler),_r(e.parent.element)},buttons:[{click:this.selectOption.bind(this,this.dialog,this),buttonModel:{content:t.getConstant("Ok"),isPrimary:!0}}]}),i.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"}]),sf.base.EventHandler.add(i.element,"click",this.checkBoxClickHandler,this)},e.prototype.okBtnFocus=function(){var e=this;document.getElementById(this.parent.element.id+"_protect_check").addEventListener("focus",(function(){e.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()}))},e.prototype.checkBoxClickHandler=function(){!1===document.getElementById(this.parent.element.id+"_protect_check").checked?this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!0:(this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!1,this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus())},e.prototype.dialogOpen=function(){this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()},e.prototype.selectOption=function(){var e=this.parent.serviceLocator.getService(Mn),t=this.optionList.getSelectedItems();this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!0);var r={selectCells:t.text.indexOf(e.getConstant("SelectCells"))>-1,formatCells:t.text.indexOf(e.getConstant("FormatCells"))>-1,formatRows:t.text.indexOf(e.getConstant("FormatRows"))>-1,formatColumns:t.text.indexOf(e.getConstant("FormatColumns"))>-1,insertLink:t.text.indexOf(e.getConstant("InsertLinks"))>-1};this.parent.protectSheet(null,r),this.parent.notify("protectSelection",null),this.parent.notify("clearUndoRedoCollection",null),this.dialog.hide()},e.prototype.protectSheetHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.element.id,n=[r+"_undo",r+"_redo",r+"_cut",r+"_copy",r+"_paste",r+"_number_format",r+"_font_name",r+"_font_size",r+"_bold",r+"_italic",r+"_line-through",r+"_underline",r+"_font_color_picker",r+"_fill_color_picker",r+"_borders",r+"_merge_cells",r+"_text_align",r+"_vertical_align",r+"_wrap",r+"_sorting",r+"_clear",r+"_conditionalformatting"],i=[r+"_cut",r+"_copy",r+"_number_format",r+"_font_name",r+"_font_size",r+"_bold",r+"_italic",r+"_line-through",r+"_underline",r+"_font_color_picker",r+"_fill_color_picker",r+"_borders",r+"_text_align",r+"_vertical_align",r+"_wrap",r+"_sorting",r+"_clear",r+"_conditionalformatting"],a=[r+"_insert_function"],s=[r+"_hyperlink",r+"_",r+"_chart"],o=[r+"_"],l=[r+"_find"],h=[r+"_datavalidation"],d=[r+"_chart"],p=document.getElementById(this.parent.element.id+"_sheet_panel");p&&(t.isProtected&&t.protectSettings.selectCells?p.classList.remove("e-protected"):p.classList.add("e-protected"),t.isProtected||p.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify("protectCellFormat",{disableHomeBtnId:n,enableHomeBtnId:i,enableFrmlaBtnId:a,enableInsertBtnId:s,findBtnId:l,dataValidationBtnId:h,imageBtnId:o,chartBtnId:d}),this.parent.notify("enableFormulaInput",null),this.parent.notify("updateToggleItem",{props:"Protect"})},e.prototype.editProtectedAlert=function(){var e=this,t=this.parent.serviceLocator.getService(Mn);this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({content:t.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(t){var r={dialogName:"EditAlertDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),_r(e.parent.element)},close:function(){return _r(e.parent.element)}})},e.prototype.lockCellsHandler=function(e){var t=this.parent.getActiveSheet(),r={isLocked:!!e.isLocked&&e.isLocked};ht(e.rowIdx,e.colIdx,t,r,!0)},e.prototype.getModuleName=function(){return"protectSheet"},e}(),sn=function(){function e(e){this.shortValue="",this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(X,this.renderFindDlg,this),this.parent.on(Y,this.renderGotoDlg,this),this.parent.on(A,this.gotoHandler,this),this.parent.on("findHandler",this.findHandler,this),this.parent.on(K,this.replaceHandler,this),this.parent.on(F,this.showDialog,this),this.parent.on("replaceAllDialog",this.replaceAllDialog,this),this.parent.on("findUndoRedo",this.findUndoRedo,this),this.parent.on("findKeyUp",this.findKeyUp,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(X,this.renderFindDlg),this.parent.off(Y,this.renderGotoDlg),this.parent.off(A,this.gotoHandler),this.parent.off("findHandler",this.findHandler),this.parent.off(K,this.replaceHandler),this.parent.off(F,this.showDialog),this.parent.off("replaceAllDialog",this.replaceAllDialog),this.parent.off("findUndoRedo",this.findUndoRedo),this.parent.off("findKeyUp",this.findKeyUp))},e.prototype.findUndoRedo=function(e){var t={address:e.address,compareVal:e.compareVal,cancel:!1};if("before"===e.undoRedoOpt)this.parent.notify(G,{action:"beforeReplace",eventArgs:t});else if("after"===e.undoRedoOpt){if(!t.cancel){var r={address:e.address,compareVal:e.compareVal};this.parent.notify(W,{action:"replace",eventArgs:r})}}else if("beforeReplaceAll"===e.undoRedoOpt){if(!t.cancel){var n={replaceValue:e.replaceValue,addressCollection:e.Collection};this.parent.notify(G,{action:"beforeReplaceAll",eventArgs:n})}}else if("afterReplaceAll"===e.undoRedoOpt&&!t.cancel){var i={replaceValue:e.replaceValue,addressCollection:e.Collection};this.parent.notify(W,{action:"replaceAll",eventArgs:i})}},e.prototype.renderFindDlg=function(){var e=this,t=this.parent.serviceLocator.getService(Mn),r=this.parent.serviceLocator.getService(Pn);if(sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var n={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",allowDragging:!0,header:t.getConstant("FindAndReplace"),closeOnEscape:!1,beforeOpen:function(t){var n={dialogName:"FindAndReplaceDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.findandreplaceContent(),r.dialogInstance.dataBind(),_r(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("prev")}},{buttonModel:{content:t.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("next")}},{buttonModel:{content:t.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("replace")}},{buttonModel:{content:t.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("replaceAll")}}],open:function(){if(e.parent.element.querySelector(".e-text-findNext").value){var t=e.parent.element.querySelector(".e-btn-findPrevious");sf.base.getComponent(t,"btn").disabled=!1,sf.base.getComponent(e.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}},close:function(){r.hide()}};r.show(n,!1)}else r.hide()},e.prototype.dialogMessage=function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()},e.prototype.renderGotoDlg=function(){var e=this,t=this.parent.serviceLocator.getService(Mn),r=this.parent.serviceLocator.getService(Pn);if(sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var n={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",allowDragging:!0,header:t.getConstant("GotoHeader"),beforeOpen:function(t){var n={dialogName:"GoToDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.GotoContent(),r.dialogInstance.dataBind(),_r(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){e.gotoHandler()}}],close:function(){r.hide()},open:function(){e.textFocus()}};r.show(n,!1)}else r.hide()},e.prototype.textFocus=function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",(function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()}))},e.prototype.findDlgClick=function(e){"prev"===e||"next"===e?this.findHandler({findOption:e}):this.replaceHandler({findDlgArgs:e})},e.prototype.findHandler=function(e){var t=this.parent.element.querySelector(".e-text-findNext");t||(t=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert();var r=t.value;if(""!==t.value){var n=this.parent.activeSheetIndex,i=this.parent.element.querySelector(".e-findnreplace-checkcase"),a=void 0;if(i)a=sf.base.getComponent(i,"checkbox").checked;else a=!1;var s=this.parent.element.querySelector(".e-findnreplace-checkmatch"),o=void 0;if(s)o=sf.base.getComponent(s,"checkbox").checked;else o=!1;var l=this.parent.element.querySelector(".e-findnreplace-searchby"),h=void 0;if(l)h=sf.base.getComponent(l,"dropdownlist").value.toString();else h="By Row";var d=this.parent.element.querySelector(".e-findnreplace-searchwithin"),p=void 0;if(d)p=sf.base.getComponent(d,"dropdownlist").value.toString();else p="Sheet";var c={value:r,sheetIndex:n,findOpt:e.findOption,mode:p,isCSen:a,isEMatch:o,searchBy:h};"next"===e.findOption||"prev"===e.findOption?this.parent.find(c):"count"===e.countArgs.countOpt&&(this.parent.notify("count",c),e.countArgs.findCount=c.findCount)}},e.prototype.replaceHandler=function(e){var t=this.parent.activeSheetIndex,r=this.parent.element.querySelector(".e-text-findNext"),n=this.parent.element.querySelector(".e-text-replaceInp"),i=this.parent.element.querySelector(".e-findnreplace-checkcase"),a=sf.base.getComponent(i,"checkbox"),s=this.parent.element.querySelector(".e-findnreplace-checkmatch"),o=sf.base.getComponent(s,"checkbox"),l=this.parent.element.querySelector(".e-findnreplace-searchby"),h=sf.base.getComponent(l,"dropdownlist"),d=this.parent.element.querySelector(".e-findnreplace-searchwithin"),p=sf.base.getComponent(d,"dropdownlist"),c={value:r.value,mode:p.value.toString(),isCSen:a.checked,isEMatch:o.checked,searchBy:h.value.toString(),findOpt:"next",replaceValue:n.value,replaceBy:e.findDlgArgs?e.findDlgArgs:e.replaceMode,sheetIndex:t};this.parent.replace(c)},e.prototype.gotoHandler=function(e){if(e)this.parent.goTo(e.address);else{var t=this.parent.element.querySelector(".e-text-goto").value,r=t.split("");if(""===t||isNaN(parseInt(r[1],10)))return void this.gotoAlert();var n=t.toString().toUpperCase();this.parent.goTo(n)}},e.prototype.gotoAlert=function(){var e=this.parent.serviceLocator.getService(Mn),t=this.parent.createElement("span",{className:"e-goto-alert-span",innerHTML:e.getConstant("InsertingEmptyValue")});this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.serviceLocator.getService(Mn),t=this.parent.createElement("span",{className:"e-find-alert-span",innerHTML:e.getConstant("NoElements")});this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.replaceAllDialog=function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var t=this.parent.serviceLocator.getService(Mn),r=this.parent.createElement("span",{className:"e-replace-alert-span",innerHTML:e.count+t.getConstant("ReplaceAllEnd")+e.replaceValue});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(r)},e.prototype.findKeyUp=function(e){var t=this.parent.element.querySelector(".e-text-findNext").value;if(sf.base.isNullOrUndefined(t)||""===t)sf.base.getComponent(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,sf.base.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var r=this.parent.element.querySelector(".e-btn-findPrevious");sf.base.getComponent(r,"btn").disabled=!1,sf.base.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}var n=this.parent.element.querySelector(".e-text-findNext").value,i=this.parent.element.querySelector(".e-text-replaceInp").value;sf.base.isNullOrUndefined(n)||sf.base.isNullOrUndefined(i)||""===n||""===i?(sf.base.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,sf.base.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0,this.dialogMessage()):!1===this.parent.getActiveSheet().isProtected&&(sf.base.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,sf.base.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)},e.prototype.findandreplaceContent=function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),r=this.parent.createElement("div",{className:"e-findCheck"}),n=this.parent.serviceLocator.getService(Mn);e.appendChild(t);var i=this.parent.createElement("div",{className:"e-cont"}),a=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("FindWhat")}),s=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});i.appendChild(s),i.insertBefore(a,s),t.appendChild(i);var o=new sf.inputs.TextBox({width:"70%"});o.createElement=this.parent.createElement,o.appendTo(s);var l=this.parent.createElement("div",{className:"e-cont"}),h=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("ReplaceWith")}),d=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});l.appendChild(d),l.insertBefore(h,d),t.appendChild(l);var p=new sf.inputs.TextBox({width:"70%"});p.createElement=this.parent.createElement,p.appendTo(d);var c=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],u=new sf.dropdowns.DropDownList({dataSource:c,cssClass:"e-searchby",fields:{value:"Id",text:"Within"},width:"50%",index:0}),f=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:n.getConstant("SearchBy")}}),g=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchWithin")});t.appendChild(g),t.appendChild(f),u.createElement=this.parent.createElement,u.appendTo(f);var m=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],v=new sf.dropdowns.DropDownList({dataSource:m,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0}),y=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:n.getConstant("SearchBy")}}),C=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchBy")});t.appendChild(C),t.appendChild(y),v.createElement=this.parent.createElement,v.appendTo(y);var b=new sf.buttons.CheckBox({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),S=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});r.appendChild(S),b.createElement=this.parent.createElement,b.appendTo(S);var x=new sf.buttons.CheckBox({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"}),w=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return r.appendChild(w),x.createElement=this.parent.createElement,x.appendTo(w),t.appendChild(r),e},e.prototype.GotoContent=function(){var e=this.parent.serviceLocator.getService(Mn),t=this.parent.createElement("div",{className:"e-link-dialog"}),r=this.parent.createElement("div",{className:"e-goto"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-cont"}),i=this.parent.createElement("p",{className:"e-header",innerHTML:e.getConstant("Reference")}),a=new sf.inputs.TextBox({placeholder:e.getConstant("EntercellAddress")}),s=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(s),n.insertBefore(i,s),r.appendChild(n),a.createElement=this.parent.createElement,a.appendTo(s),t},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"findAndReplace"},e}(),on=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){var t=this;e.showDialog?this.parent.serviceLocator.getService(Pn).show({target:this.parent.element,height:180,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Mn).getConstant("PasteMergeAlert"),beforeOpen:function(e){var r={dialogName:"MergeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),_r(t.parent.element)}}):this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element)},e.prototype.hideHandler=function(e){var t,r=this.parent.getActiveSheet(),n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify("activeCellMergedRange",n),n.range=n.range;var i=lt(n.range[0],n.range[1],r)||{},a="row"===e.model?n.range[0]:n.range[1];if(t=a+((i[e.model+"Span"]||1)-1),!(!e.isEnd&&(e.start===a||rr(r,a))||e.isEnd&&e.start>a&&!rr(r,a))&&i[e.model+"Span"]>1&&t>=e.start)if("row"===e.model?zt(r,a):rr(r,a)){if(e.end<t&&(t-e.end>1||i.rowSpan>1)){var s=this.parent.getCell(e.rowIdx,e.end+1);if(s&&(t-e.end>1&&(s.colSpan=t-e.end),s.style.display=""),i.rowSpan>1){var o=i.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(i.rowSpan-1));o>1&&(s.rowSpan=o)}}}else this.merge({rowIdx:n.range[0],colIdx:n.range[1]})},e.prototype.checkPrevMerge=function(e){var t,r,n,i=this.parent.getActiveSheet();e.isRow?e.rowIdx-1>-1&&zt(i,e.rowIdx-1)&&(void 0===(t=lt(e.rowIdx-1,e.colIdx,i)||{}).rowSpan&&void 0===t.colSpan||!(void 0===t.colSpan||t.colSpan>1||e.colIdx-1>-1&&rr(i,e.colIdx-1))||(r={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify("activeCellMergedRange",r),r.range=r.range,zt(i,r.range[0])&&r.range[2]>=e.rowIdx&&(t=lt(r.range[0],r.range[1],i)||{}).rowSpan>1&&((n=r.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(r.range[2]-e.rowIdx)))>1&&(e.td.rowSpan=n,e.td.style.display=""),t.colSpan>1&&!(e.colIdx-1>-1&&rr(i,e.colIdx-1))&&(n=t.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display="")))):e.colIdx-1>-1&&rr(i,e.colIdx-1)&&(void 0===(t=lt(e.rowIdx,e.colIdx-1,i)||{}).colSpan&&void 0===t.rowSpan||!(void 0===t.rowSpan||t.rowSpan>1||e.rowIdx-1>-1&&zt(i,e.rowIdx-1))||(r={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify("activeCellMergedRange",r),r.range=r.range,rr(i,r.range[1])&&r.range[3]>=e.colIdx&&(t=lt(r.range[0],r.range[1],i)||{}).colSpan>1&&((n=r.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display=""),t.rowSpan>1&&!(e.rowIdx-1>-1&&zt(i,e.rowIdx-1))&&(n=t.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(t.rowSpan-1)))>1&&(e.td.rowSpan=n,e.td.style.display=""))))},e.prototype.checkMerge=function(e){var t=this.parent.getActiveSheet(),r=lt(e.rowIdx,e.colIdx,t)||{};if(e.isRow){if(void 0===r.colSpan||rr(t,e.colIdx-1)){if((n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=n.range,this.parent.notify("activeCellMergedRange",n),rr(t,e.colIdx-1)&&!rr(t,n.range[1]))return;r=lt(n.range[0],n.range[1],t),(i=n.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,n.range[2]))>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.rowSpan=i,e.td.style.display="")}}else if(void 0===r.rowSpan||zt(t,e.rowIdx-1)){var n,i;if((n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=n.range,this.parent.notify("activeCellMergedRange",n),zt(t,e.rowIdx-1)&&!zt(t,n.range[0]))return;r=lt(n.range[0],n.range[1],t),(i=n.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,n.range[3],"columns"))>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.colSpan=i,e.td.style.display="")}},e.prototype.addEventListener=function(){this.parent.on("applyMerge",this.merge,this),this.parent.on("hiddenMerge",this.hideHandler,this),this.parent.on("checkPrevMerge",this.checkPrevMerge,this),this.parent.on("checkMerge",this.checkMerge,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applyMerge",this.merge),this.parent.off("hiddenMerge",this.hideHandler),this.parent.off("checkPrevMerge",this.checkPrevMerge),this.parent.off("checkMerge",this.checkMerge))},e.prototype.getModuleName=function(){return"merge"},e}(),ln=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener()},e.prototype.addEventListener=function(){this.parent.on("cFRender",this.cFInitialRender,this),this.parent.on("cFInitialCheck",this.cFInitialCheckHandler,this),this.parent.on("checkConditionalFormat",this.checkConditionalFormatHandler,this),this.parent.on("initiateConditionalFormat",this.initiateCFHandler,this),this.parent.on("setCF",this.setCFHandler,this),this.parent.on("cFDelete",this.cFDeleteHandler,this),this.parent.on("clearCF",this.clearCFHandler,this),this.parent.on("clearCells",this.addClearCFHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("cFRender",this.cFInitialRender),this.parent.off("cFInitialCheck",this.cFInitialCheckHandler),this.parent.off("checkConditionalFormat",this.checkConditionalFormatHandler),this.parent.off("initiateConditionalFormat",this.initiateCFHandler),this.parent.off("setCF",this.setCFHandler),this.parent.off("cFDelete",this.cFDeleteHandler),this.parent.off("clearCF",this.clearCFHandler))},e.prototype.setCF=function(e){e.range=e.range||this.parent.getActiveSheet().selectedRange;var t={range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,cancel:!1};this.parent.notify(G,{eventArgs:t,action:"conditionalFormat"}),t.cancel||(e.type=t.type,e.cFColor=t.cFColor,e.value=t.value,e.range=t.range,this.parent.notify("setCFRule",{conditionalFormat:e}),delete t.cancel,this.parent.notify(W,{eventArgs:t,action:"conditionalFormat"}))},e.prototype.addClearCFHandler=function(e){for(var r=this.parent.getActiveSheet(),n=e.conditionalFormats,i=e.oldRange,a=e.selectedRange,s=r.conditionalFormats,o=0;o<n.length;o++){for(var l=!1,h=0;h<s.length;h++)if(s[h].type===n[o].type&&s[h].range===n[o].range){l=!0,s[h].range=i[o],r.conditionalFormats[h].range=i[o];for(var d=t(a),p=i[o].split(","),c=0;c<p.length;c++)for(var u=t(p[c]),f=u[0];f<=u[2];f++)for(var g=u[1];g<=u[3];g++)for(var m=d[0];m<=d[2];m++)for(var v=d[1];v<=d[3];v++)if(m===f&&v===g){var y=this.parent.getCell(f,g),C=r.rows[f]&&r.rows[f].cells[g]?r.rows[f].cells[g]:null;C&&this.cFInitialCheckHandler({rowIdx:f,colIdx:g,cell:C,td:y,conditionalFormat:s[h]})}}if(!l){var b=n[o];b.range=i[o],this.parent.notify("setCFRule",{conditionalFormat:b})}}},e.prototype.cFDeleteHandler=function(e){var t=this.parent.getCell(e.rowIdx,e.colIdx);t&&(t.querySelector(".e-cf-databar")&&t.removeChild(t.querySelector(".e-cf-databar")),t.querySelector(".e-iconsetspan")&&t.removeChild(t.querySelector(".e-iconsetspan")))},e.prototype.clearCFHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.getCell(e.rIdx,e.cIdx),n=lt(e.rIdx,e.cIdx,t);if(r){if(r.classList.remove("e-redft"),r.classList.remove("e-yellowft"),r.classList.remove("e-greenft"),r.classList.remove("e-redf"),r.classList.remove("e-redt"),r.classList.remove("e-iconset"),r.style){if(r.style.backgroundColor){r.style.backgroundColor="";var i=this.parent.getCellStyleValue(["backgroundColor"],[e.rIdx,e.cIdx]);this.parent.notify(R,{style:i,rowIdx:e.rIdx,colIdx:e.cIdx})}if(r.style.color){r.style.color="";i=this.parent.getCellStyleValue(["color"],[e.rIdx,e.cIdx]);this.parent.notify(R,{style:i,rowIdx:e.rIdx,colIdx:e.cIdx})}}r.querySelector(".e-cf-databar")&&(r.removeChild(r.querySelector(".e-cf-databar")),r.textContent=this.parent.getDisplayText(n)),r.querySelector(".e-iconsetspan")&&(r.removeChild(r.querySelector(".e-iconsetspan")),r.textContent=this.parent.getDisplayText(n))}},e.prototype.setCFHandler=function(e){("cf_databars"===e.action||"cf_colorscales"===e.action||"cf_iconsets"===e.action)&&this.setCF({type:e.id})},e.prototype.initiateCFHandler=function(e){var t=this,r=this.parent.serviceLocator.getService(Mn),n=this.parent.serviceLocator.getService(Pn);n.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){n.dialogInstance.content=t.cFDlgContent(e.action),n.dialogInstance.dataBind(),_r(t.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){t.dlgClickHandler(e.action),n.hide()}}]}),n.dialogInstance.refresh()},e.prototype.dlgClickHandler=function(e){var t="",r="",n=this.parent.element.querySelector(".e-conditionalformatting-dlg").getElementsByClassName("e-dlg-content")[0].querySelector(".e-cf-dlg"),i=n.querySelector(".e-cfmain");if(i){var a=i.getElementsByTagName("input")[0];a&&a.parentElement.classList.contains("e-cfmain")&&(t=i.getElementsByTagName("input")[0].value),r=i.getElementsByTagName("input")[1]?n.querySelector(".e-cfmain").getElementsByTagName("input")[1].value:""}var s=this.getCFColor(n.querySelector(".e-cfsub").getElementsByTagName("input")[0].value),o="Duplicate Values..."===e?n.querySelector(".e-cfmain").getElementsByTagName("input")[0].value:this.getType(e);""!==t&&""!==r?this.setCF({type:o,cFColor:s,value:t+","+r}):""!==t?this.setCF({type:o,cFColor:s,value:t}):this.setCF({type:o,cFColor:s,value:r})},e.prototype.getType=function(e){var t=this.parent.serviceLocator.getService(Mn),r="";switch(e){case t.getConstant("GreaterThan")+"...":r="GreaterThan";break;case t.getConstant("LessThan")+"...":r="LessThan";break;case t.getConstant("Between")+"...":r="Between";break;case t.getConstant("CFEqualTo")+"...":r="EqualTo";break;case t.getConstant("TextThatContains")+"...":r="ContainsText";break;case t.getConstant("ADateOccuring")+"...":r="DateOccur";break;case t.getConstant("Top10Items")+"...":r="Top10Items";break;case t.getConstant("Bottom10Items")+"...":r="Bottom10Items";break;case t.getConstant("Top10")+" %...":r="Top10Percentage";break;case t.getConstant("Bottom10")+" %...":r="Bottom10Percentage";break;case t.getConstant("AboveAverage")+"...":r="AboveAverage";break;case t.getConstant("BelowAverage")+"...":r="BelowAverage"}return r},e.prototype.getCFColor=function(e){var t=this.parent.serviceLocator.getService(Mn),r="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):r="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):r="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):r="GreenFT";break;case t.getConstant("RedFill"):r="RedF";break;case t.getConstant("RedText"):r="RedT"}return r},e.prototype.cFDlgContent=function(e){var t=this.getDlgText(e),r=this.parent.serviceLocator.getService(Mn),n=this.parent.createElement("div",{className:"e-cf-dlg"}),i=this.parent.createElement("div",{className:"e-cfmain"}),a=this.parent.createElement("div",{className:"e-cfsub"}),s=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:t}),o=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text"}}),l=this.parent.createElement("input",{className:"e-select"}),h=this.parent.createElement("span",{className:"e-header",innerHTML:r.getConstant("With")}),d=this.parent.createElement("input",{className:"e-select"});if(n.appendChild(i),n.appendChild(a),i.appendChild(s),e!==r.getConstant("DuplicateValues")+"..."){if(e!==r.getConstant("AboveAverage")+"..."&&e!==r.getConstant("BelowAverage")+"...")if(i.appendChild(o),e===r.getConstant("Top10Items")+"..."||e===r.getConstant("Top10")+" %..."||e===r.getConstant("Bottom10Items")+"..."||e===r.getConstant("Bottom10")+" %...")new sf.inputs.NumericTextBox({value:10}).appendTo(o)}else{i.appendChild(l);var p=[{text:r.getConstant("Duplicate"),id:"duplicate"},{text:r.getConstant("Unique"),id:"unique"}];new sf.dropdowns.DropDownList({dataSource:p,index:0,popupHeight:"200px"}).appendTo(l)}if(e===r.getConstant("Between")+"..."){var c=this.parent.createElement("span",{className:"e-header e-header-2",innerHTML:r.getConstant("And")}),u=this.parent.createElement("input",{className:"e-input"});i.appendChild(c),i.appendChild(u)}a.appendChild(h),a.appendChild(d);var f=[{text:r.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:r.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:r.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:r.getConstant("RedFill"),id:"redf"},{text:r.getConstant("RedText"),id:"redt"}];return new sf.dropdowns.DropDownList({dataSource:f,index:0,popupHeight:"200px"}).appendTo(d),n},e.prototype.checkCellHandler=function(e,r,n){for(var i=!1,a=n.range.trim().split(","),s=0;s<a.length;s++){var o=a[s],l=t(o=o.indexOf(":")>-1?o:o+":"+o);if(e>=l[0]&&e<=l[2]&&r>=l[1]&&r<=l[3]){i=!0;break}}return i},e.prototype.getDlgText=function(e){var t=this.parent.serviceLocator.getService(Mn),r="";switch(e){case t.getConstant("GreaterThan")+"...":r=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":r=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":r=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":r=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":r=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":r=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":r=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":r=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":r=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":r=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":r=t.getConstant("FormatCellsBelow")}return r},e.prototype.cFInitialRender=function(e){var t=this.parent.getActiveSheet().conditionalFormats;if(t)for(var r=0;r<t.length;r++){this.checkCellHandler(e.rowIdx,e.colIdx,t[r])&&this.cFInitialCheckHandler({rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,conditionalFormat:t[r]})}},e.prototype.cFInitialCheckHandler=function(e){this.parent.getActiveSheet();var t,r=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],n=e.cell.value||"",i=e.conditionalFormat,a=e.td||this.parent.getCell(e.rowIdx,e.colIdx);if(a&&(i.type=i.type||"GreaterThan",i.cFColor=i.cFColor||i.format?i.cFColor:"RedFT",this.cFRCheck(i,n,a,e.rowIdx,e.colIdx,!0))){for(var s=0;s<r.length;s++)if(a.classList.contains(r[s])){a.classList.remove(r[s]);break}i.format&&i.format.style&&(t=i.format.style);var o={};i.cFColor?(a.classList.add("e-"+i.cFColor.toLowerCase()),o=this.setFormat(o,i)):o=t,o.backgroundColor&&a.style.setProperty("background-color",o.backgroundColor),o.color&&a.style.setProperty("color",o.color),o.fontWeight&&a.style.setProperty("font-weight",o.fontWeight),o.fontStyle&&a.style.setProperty("font-style",o.fontStyle),o.textDecoration&&a.style.setProperty("text-decoration",o.textDecoration)}},e.prototype.checkConditionalFormatHandler=function(e){var r,n,i=!1,a=!1,s=this.parent.getActiveSheet(),o=e.cell,l=s.conditionalFormats,h=(this.parent.getMainContent(),o?sf.base.isNullOrUndefined(o.value)?"":o.value:""),d=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"];if(n=this.parent.getCell(e.rowIdx,e.colIdx),l&&!(l.length<1))for(var p=l.length-1;p>=0;p--){for(var c=l[p].range.trim().split(","),u=0;u<c.length;u++){if(r=t(g=(g=c[u]).indexOf(":")>-1?g:g+":"+g),e.rowIdx>=r[0]&&e.colIdx>=r[1]&&e.rowIdx<=r[2]&&e.colIdx<=r[3]){a=!0;break}}if(a){if("GreaterThanLessThanEqualToBetweenContainsTextDateOccur".includes(s.conditionalFormats[p].type)){var f=lt(e.rowIdx,e.colIdx,s)&&lt(e.rowIdx,e.colIdx,s).value?lt(e.rowIdx,e.colIdx,s).value:"";i=(!sf.base.isNullOrUndefined(f)||""!==f)&&this.cFRCheck(s.conditionalFormats[p],f,n),this.setColor(n,e.rowIdx,e.colIdx,p,i)}else if("Top10ItemsBottom10ItemsTop10%Bottom10%AboveAverageBelowAverageDuplicateUnique".includes(s.conditionalFormats[p].type))for(u=0;u<c.length;u++)for(var g,m=(r=t(g=(g=c[u]).indexOf(":")>-1?g:g+":"+g))[0];m<=r[2];m++){s.rows[m]||qt(s,m,{});for(var v=r[1];v<=r[3];v++){s.rows[m].cells&&s.rows[m].cells[v]||ht(m,v,s,{});f=lt(m,v,s)&&lt(m,v,s).value?lt(m,v,s).value:"";i=this.cFRCheck(s.conditionalFormats[p],f,n,m,v,!1),n=this.parent.getCell(m,v),this.setColor(n,m,v,p,i)}}else if("BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleColorScaleGYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScaleThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(s.conditionalFormats[p].type)){for(var y=0;y<d.length;y++)n.classList.contains(d[y])&&n.classList.remove(d[y]);i=this.cFRCheck(s.conditionalFormats[p],h,n,e.rowIdx,e.colIdx,!1)}a=!1}if(i)break}},e.prototype.setColor=function(e,t,r,n,i){var a=this.parent.getActiveSheet().conditionalFormats,s=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],o=!1;if(a[n].cFColor)e&&e.classList.contains("e-"+a[n].cFColor.toLowerCase())&&(o=!0);else if(a[n].format.style.backgroundColor&&e.style.backgroundColor){var l=this.hexToRgb(a[n].format.style.backgroundColor);"rgb("+l.r+", "+l.g+", "+l.b+")"===e.style.backgroundColor&&(o=!0)}if(i){if(o)for(var h=0;h<s.length;h++)if(e.classList.contains(s[h])){e.classList.remove(s[h]);break}var d={};a[n].cFColor?(e.classList.add("e-"+a[n].cFColor.toLowerCase()),d=this.setFormat(d,a[n])):d=a[n].format.style,this.parent.notify(R,{style:d,rowIdx:t,colIdx:r,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0})}else{if(o){for(h=0;h<s.length;h++)if(e.classList.contains(s[h])){e.classList.remove(s[h]);break}e.removeAttribute("style")}var p=lt(t,r,this.parent.getActiveSheet());d=p.style?p.style:{};this.parent.notify(R,{style:d,rowIdx:t,colIdx:r})}},e.prototype.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},e.prototype.cFRCheck=function(e,t,r,n,i,a){var s="",o="",l=t.toString();if(e.value){var h=e.value.split(",");if(h.length>1)if(h[0].split("(").length>1){for(var d="",p=0;p<h.length;p++)(d+=h[p]+",").split("(").length===d.split(")").length&&""===s&&(s=d.substring(0,d.length-1),d="");o=d.substring(0,d.length-1)}else{s=h[0];for(p=1;p<h.length;p++)o+=p+1===h.length?h[p]:h[p]+","}else s=e.value}var c=!1,u=e.type;switch("BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleDataBar".includes(u)&&(u="DataBar"),"GYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScale".includes(u)&&(u="ColorScale"),"ThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(u)&&(u="IconSet"),u){case"GreaterThan":c=this.isGreaterThanLessThan(e,l,s,!0);break;case"LessThan":c=this.isGreaterThanLessThan(e,l,s,!1);break;case"Between":c=this.isBetWeen(e,l,s,o);break;case"EqualTo":c=this.isEqualTo(e,l,s);break;case"ContainsText":c=this.isContainsText(l,s);break;case"DateOccur":var f={value:s,rowIndex:0,colIndex:0,sheetIndex:0,updatedVal:""};this.parent.notify("checkDateFormat",f),l===f.updatedVal&&(c=!0);break;case"Unique":case"Duplicate":c=this.isDuplicateUnique(l,e,!1);break;case"Top10Items":c=this.isTopBottomTenValue(l,s,e,!0);break;case"Bottom10Items":c=this.isTopBottomTenValue(l,s,e,!1);break;case"Top10Percentage":c=this.isTopBottomTenPercentage(l,s,e,!0);break;case"Bottom10Percentage":c=this.isTopBottomTenPercentage(l,s,e,!1);break;case"AboveAverage":c=this.isAboveBelowAverage(l,s,e,!0);break;case"BelowAverage":c=this.isAboveBelowAverage(l,s,e,!1);break;case"DataBar":case"ColorScale":case"IconSet":this.isDataBarColorScalesIconSets(u,l,e,r,n,i,a)}return c},e.prototype.isDataBarColorScalesIconSets=function(e,r,n,i,a,s,o){var l=this.parent.getActiveSheet();if(o)"DataBar"===e?this.applyDataBars(r,n,i,a,s):"ColorScale"===e?this.applyColorScale(r,n,i,a,s,o):this.applyIconSet(r,n,i,a,s,o);else{i=null;for(var h=n.range.split(","),d=0;d<h.length;d++)for(var p=t(h[d]),c=p[0];c<=p[2];c++)for(var u=p[1];u<=p[3];u++)if(lt(c,u,l)){var f=lt(c,u,l).value;i=this.parent.getCell(c,u),"DataBar"===e?this.applyDataBars(f,n,i,c,u):"ColorScale"===e?this.applyColorScale(f,n,i,c,u,o):this.applyIconSet(f,n,i,c,u,o)}}},e.prototype.applyIconSet=function(e,r,n,i,a,s){var o,l,h=parseInt(e,10),d=this.getIconList(r.type).split(","),p=[],c=this.parent.getActiveSheet(),u=c.rows[i]&&c.rows[i].cells[a]?c.rows[i].cells[a]:null;if(u){for(var f,g=n||this.parent.getMainContent().getElementsByClassName("e-row")[i].getElementsByClassName("e-cell")[a],m=r.range.split(","),v=0;v<m.length;v++){var y=t(m[v]);p=this.getNumericArray(y,p)}if(o=(p=p.sort((function(e,t){return e-t})))[0],l=p[p.length-1],3===d.length){var C=o+.33*(l-o);f="e-"+(h>=o+.67*(l-o)?d[0].trim():h>=C?d[1].trim():d[2].trim())}else if(4===d.length){var b=o+.25*(l-o),S=o+.5*(l-o);f="e-"+(h>=(x=o+.75*(l-o))?d[0].trim():h>=S?d[1].trim():h>=b?d[2].trim():d[3].trim())}else if(5===d.length){b=o+.2*(l-o),S=o+.4*(l-o);var x=o+.6*(l-o);f="e-"+(h>=o+.8*(l-o)?d[0].trim():h>=x?d[1].trim():h>=S?d[2].trim():h>=b?d[3].trim():d[4].trim())}if(!sf.base.isNullOrUndefined(u)){var w=this.parent.createElement("span",{className:"e-icon"});w.classList.add("e-iconsetspan"),w.classList.add(f),this.applyIconSetIcon({rowIndex:i,colIndex:a},w,g)}}},e.prototype.applyIconSetIcon=function(e,t,r){var n=this.parent.getActiveSheet(),i=lt(e.rowIndex,e.colIndex,n).value,a=r;n.index;a.classList.contains("e-iconset")&&a.querySelector(".e-iconsetspan")&&a.removeChild(a.querySelector(".e-iconsetspan")),x(i)&&(a.insertBefore(t,a.childNodes[0]),a.classList.add("e-iconset"))},e.prototype.getIconList=function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-1,4rating-2,4rating-3,4rating-4";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-1,5rating-2,5rating-3,5rating-4,5rating-5";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"},e.prototype.applyColorScale=function(e,r,n,i,a,s){var o,l=this.parent.getActiveSheet(),h=parseInt(e,10),d=[],p=this.getColor(r.type),c=l.rows[i]&&l.rows[i].cells[a]?l.rows[i].cells[a]:null;if(c){for(var u=r.range.split(","),f=n||this.parent.getMainContent().getElementsByClassName("e-row")[i].getElementsByClassName("e-cell")[a],g=0;g<u.length;g++){var m=t(u[g]);d=this.getNumericArray(m,d)}d=d.sort((function(e,t){return e-t})).reverse();for(var v=0;v<d.length;v++)if(d[v]===h){o=v;break}var y=0===o?p[0]:o===d.length-1?p[p.length-1]:3===d.length&&1===o?p[1]:this.getGradient(o,p[0],p[1],p[2],d.length);if(!sf.base.isNullOrUndefined(c)){var C={};sf.base.isNullOrUndefined(o)?(C=this.parent.getCellStyleValue(["backgroundColor"],[i,a]),f.style.backgroundColor=C.backgroundColor):(C={backgroundColor:y},f.style.backgroundColor=y)}}},e.prototype.applyDataBars=function(e,r,n,i,a){var s,o,l,h=this.parent.getActiveSheet(),d={},p={},c=r.type,u=h.rows[i]&&h.rows[i].cells[a]?h.rows[i].cells[a]:null;if(u){var f,g=[],m=this.parent.getMainContent().getElementsByClassName("e-row")[i],v=n||this.parent.getMainContent().getElementsByClassName("e-row")[i].getElementsByClassName("e-cell")[a],y=m&&m.style?parseInt(m.style.height,10):20,C=[],b=[],S=0;s=parseInt(e,10);for(var w=r.range.split(","),I=0;I<w.length;I++){var E=t(w[I]);g=this.getNumericArray(E,g)}for(var R=0;R<g.length;R++)g[R]>0?C.push(g[R]):b.push(g[R]);if(c="BlueDataBar"===c?"B":"GreenDataBar"===c?"G":"RedDataBar"===c?"R":"OrangeDataBar"===c?"O":"LightBlueDataBar"===c?"LB":"PurpleDataBar"===c?"P":"",o=this.getColor(c)[0],l=this.getColor("R")[0],C=C.sort((function(e,t){return e-t})).reverse(),(b=b.sort((function(e,t){return e-t}))).length&&C.length)f=C[0]+Math.abs(b[0]),S=Math.abs(b[0]/f*100);else{if(!b.length&&!C.length)return;f=b.length?b[0]:C[0]}if(v&&(sf.base.isNullOrUndefined(s)||""===e)&&v.getElementsByClassName("e-cf-databar")[0]&&v.removeChild(v.getElementsByClassName("e-cf-databar")[0]),x(s)){var k=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),A=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),F=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),T=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"}),O=void 0;d=A.style,p=F.style,k.appendChild(T),k.insertBefore(F,T),k.insertBefore(A,F),v.querySelector(".e-iconsetspan")&&(O=v.querySelector(".e-iconsetspan")),v.textContent="",v.appendChild(k),O&&v.insertBefore(O,v.firstElementChild),T.innerHTML=this.parent.getDisplayText(u),k.style.height=y-1+"px",T.style.fontSize="11pt",b.length?C.length?s>-1?(d.width=S+"%",d.height=y-3+"px",d.backgroundColor="transparent",d.left="0px",p.width=Math.ceil(Math.abs(s/f*100))+"%",p.height=y-3+"px",p.backgroundColor=c=o,p.left=S+"%"):s<0&&(d.width=Math.ceil(Math.abs(s/f*100))+"%",d.height=y-3+"px",d.backgroundColor=l,d.width===S+"%"?d.left="0px":d.right=100-S+"%"):(p.width=Math.ceil(Math.abs(s/f*100))+"%",p.height=y-3+"px",p.backgroundColor=c=l,p.left="0px"):(p.width=Math.ceil(Math.abs(s/f*100))+"%",p.height=y-3+"px",p.backgroundColor=c=o,p.left="0px")}}},e.prototype.getNumericArray=function(e,t){for(var r=this.parent.getActiveSheet(),n=e[0];n<=e[2];n++)for(var i=e[1];i<=e[3];i++){var a=lt(n,i,r)&&lt(n,i,r).value?lt(n,i,r).value:"";if(sf.base.isNullOrUndefined(a)||x(a)||S(a)){var s=parseInt(a,10);sf.base.isNullOrUndefined(a)||""===a||t.push(s)}}return t},e.prototype.getColor=function(e){if("LB"===e)return["#008aef"];for(var t=e.split(""),r=[],n=0;n<t.length;n++)switch(t[n]){case"G":r.push("#63be7b");break;case"Y":r.push("#ffeb84");break;case"R":r.push("#f8696b");break;case"W":r.push("#ffffff");break;case"B":r.push("#5a8ac6");break;case"O":r.push("#ffb628");break;case"LB":r.push("#008aef");break;case"P":r.push("#d6007b")}return r},e.prototype.getGradient=function(e,t,r,n,i){if(sf.base.isNullOrUndefined(n))return this.getLinear(t,r,e/i);var a=i/2;return e>=a?this.getLinear(r,n,Math.abs((e-a)/a)):this.getLinear(t,r,e/a)},e.prototype.getLinear=function(e,t,r){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],r)+this.byteLinear(e[3]+e[4],t[3]+t[4],r)+this.byteLinear(e[5]+e[6],t[5]+t[6],r)},e.prototype.byteLinear=function(e,t,r){var n=parseInt(e,16)*(1-r)+parseInt(t,16)*r|0;return Math.abs(n).toString(16)},e.prototype.isGreaterThanLessThan=function(e,t,r,n){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g),a=!1;if(x(t))if(x(r))a=n?parseFloat(t)>parseFloat(r.replace(i,"")):parseFloat(t)<parseFloat(r.replace(i,""));else{var s={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",s),s.isDate||s.isTime?(a=n?t>s.updatedVal:t<s.updatedVal,e.value=s.updatedVal.toString()):a=n?t.toLowerCase()>r.toLowerCase():t.toLowerCase()<r.toLowerCase()}else""!==t||n||(a=!0);return a},e.prototype.isBetWeen=function(e,t,r,n){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g),a=!1;if(r=r.replace(i,""),n=n.replace(i,""),x(t))if(x(r))a=parseFloat(t)>=parseFloat(r)&&parseFloat(t)<=parseFloat(n);else if(r&&n){var s={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1},o={value:n,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",s),this.parent.notify("checkDateFormat",o),(s.isDate||s.isTime)&&(o.isDate||o.isTime)?(a=t>=s.updatedVal&&t<=o.updatedVal,e.value=s.updatedVal.toString()+","+o.updatedVal.toString()):a=t.toLowerCase()>=r.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return a},e.prototype.isEqualTo=function(e,t,r){var n=new RegExp(/[^.-a-zA-Z 0-9]+/g),i=!1;if(x(t))if(x(r))i=parseFloat(t)===parseFloat(r.replace(n,""));else{var a={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",a),a.isTime||a.isDate?(i=t===a.updatedVal,e.value=a.updatedVal.toString()):i=t.toLowerCase()===r.toLowerCase()}return i},e.prototype.isContainsText=function(e,t){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g),n=!1;return sf.base.isNullOrUndefined(e)||!e.length?n=!1:x(t.replace(r,""))?(t=t.replace(r,""),S(e)&&(e=b(e).toString()),n=e.indexOf(t)>-1):S(t)?(S(e)&&(e=b(e).toString()),n=e.indexOf(b(t).toString())>-1):n=e.toLowerCase().indexOf(t.toLowerCase())>-1,n},e.prototype.isTopBottomTenValue=function(e,r,n,i){var a=this.parent.getActiveSheet(),s=new RegExp(/[^.-a-zA-Z 0-9]+/g),o=parseInt(e,10),l=parseInt(r,10),h=!1;if(x(r)){x(e)?(o=parseFloat(e),l=parseFloat(r.replace(s,""))):S(e)&&(o=b(e),l=parseFloat(r));for(var d=[],p=void 0,c=n.range.split(","),u=0;u<c.length;u++)for(var f=t(c[u]),g=f[0];g<=f[2];g++)for(var m=f[1];m<=f[3];m++)(p=lt(g,m,a)&&lt(g,m,a).value?lt(g,m,a).value:"")&&x(p)&&(p=parseFloat(p),d.push(p));h=(d=(d=i?d.sort((function(e,t){return e-t})).reverse():d.sort((function(e,t){return e-t}))).slice(0,l)).indexOf(o)>-1}return h},e.prototype.isTopBottomTenPercentage=function(e,r,n,i){var a=this.parent.getActiveSheet(),s=new RegExp(/[^.-a-zA-Z 0-9]+/g),o=parseInt(e,10),l=parseInt(r,10),h=!1;if(x(r)){x(e)?(o=parseFloat(e),l=parseFloat(r.replace(s,""))):S(e)&&(o=b(e),l=parseFloat(r));for(var d=[],p=void 0,c=0,u=void 0,f=n.range.split(","),g=0;g<f.length;g++)for(var m=t(f[g]),v=m[0];v<=m[2];v++)for(var y=m[1];y<=m[3];y++)(p=lt(v,y,a)&&lt(v,y,a).value?lt(v,y,a).value:"")&&x(p)&&(p=parseFloat(p),d.push(p)),c++;u=l/(100/c),u=Math.ceil(u),h=(d=(d=i?d.sort((function(e,t){return e-t})).reverse():d.sort((function(e,t){return e-t}))).slice(0,u||1)).indexOf(o)>-1}return h},e.prototype.isAboveBelowAverage=function(e,r,n,i){for(var a,s=this.parent.getActiveSheet(),o=parseFloat(e),l=n.range.split(","),h=[],d=0,p=0;p<l.length;p++)for(var c=t(l[p]),u=c[0];u<=c[2];u++)for(var f=c[1];f<=c[3];f++)(a=lt(u,f,s)&&lt(u,f,s).value?lt(u,f,s).value:"")&&x(a)&&(a=parseFloat(a),h.push(a));for(var g=0;g<h.length;g++)d+=h[g];return d/=h.length,i?o>d:o<d},e.prototype.isDuplicateUnique=function(e,r,n){var i,a=r.type,s=0,o=this.parent.getActiveSheet(),l=e,h=r.range.split(",");if(sf.base.isNullOrUndefined(l)||""===l)return!1;for(var d=0;d<h.length;d++)for(var p=t(h[d]),c=p[0];c<=p[2];c++)for(var u=p[1];u<=p[3];u++)if((i=lt(c,u,o)&&lt(c,u,o).value?lt(c,u,o).value.toString():"")&&""!==i&&2===(s=l.toLowerCase()===i.toLowerCase()?s+1:s))return"Duplicate"===a;return"Duplicate"!==a},e.prototype.setFormat=function(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e},e.prototype.getModuleName=function(){return"conditionalFormatting"},e}(),hn=(Ur=function(e,t){return(Ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Ur(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),dn=function(){return(dn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},pn=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},cn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hn(t,e),pn([sf.base.Property("")],t.prototype,"text",void 0),pn([sf.base.Property("")],t.prototype,"iconCss",void 0),pn([sf.base.Property("left")],t.prototype,"iconPosition",void 0),t}(sf.base.ChildProperty),un=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hn(t,e),pn([sf.base.Complex({},cn)],t.prototype,"header",void 0),pn([sf.base.Collection([],sf.navigations.Item)],t.prototype,"content",void 0),pn([sf.base.Property("")],t.prototype,"cssClass",void 0),pn([sf.base.Property(!1)],t.prototype,"disabled",void 0),t}(sf.base.ChildProperty),fn=function(e){function t(t,r){return e.call(this,t)||this}return hn(t,e),t.prototype.preRender=function(){},t.prototype.render=function(){this.element.id||(this.element.id=sf.base.getUniqueID("ribbon")),this.renderRibbon()},t.prototype.destroy=function(){var t=this.element.querySelector(".e-drop-icon");if(t&&t.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var r=document.getElementById(this.element.id+"_menu");r&&sf.base.getComponent(r,"menu").destroy()}this.toolbarObj.destroy(),this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,e.prototype.destroy.call(this)},t.prototype.getTabItems=function(){var e=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach((function(r){t.push({header:r.header,content:e.toolbarObj.element})})),t},t.prototype.initMenu=function(e){var t=this,r=this.createElement("ul",{id:this.element.id+"_menu"});this.element.appendChild(r);var n=new sf.navigations.Menu({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:function(r){r.parentItem.text===e[0].text&&(n.showItemOnClick=!1),t.trigger("beforeOpen",r)},select:function(e){t.trigger("fileMenuItemSelect",e)},beforeClose:function(r){"mouseover"!==r.event.type||sf.base.closest(r.event.target,".e-menu-popup")?(t.trigger("beforeClose",r),r.parentItem&&r.parentItem.text!==e[0].text||requestAnimationFrame((function(){return n.setProperties({showItemOnClick:!0},!0)}))):r.cancel=!0},beforeItemRender:function(e){t.trigger("beforeFileMenuItemRender",e)}});return n.createElement=this.createElement,n.appendTo(r),r.parentElement},t.prototype.renderRibbon=function(){var e=this,t=this.createElement("div"),r=this.createElement("div");this.toolbarObj=new sf.navigations.Toolbar({items:this.items[this.selectedTab].content,clicked:function(t){return e.trigger("clicked",t)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(r),this.tabObj=new sf.navigations.Tab({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(t){if(e.menuItems.length&&0===t.selectingIndex)t.cancel=!0;else{if(t.selectingIndex===e.getIndex(e.selectedTab))return;e.updateToolbar(e.getIndex(t.selectingIndex,!0)),e.toolbarObj.dataBind(),e.element.classList.contains("e-collapsed")&&sf.base.EventHandler.remove(t.selectedItem,"click",e.ribbonExpandCollapse);var r=void 0;e.menuItems.length?((r=dn({},t)).selectingIndex-=1,r.selectedIndex-=1):r=t,e.trigger("selecting",r)}},selected:function(t){t.selectedIndex!==e.getIndex(e.selectedTab)&&(e.setProperties({selectedTab:e.getIndex(t.selectedIndex,!0)},!0),e.element.classList.contains("e-collapsed")&&(e.element.classList.remove("e-collapsed"),e.trigger("expandCollapse",{element:e.toolbarObj.element,expanded:!0})))},created:function(){e.toolbarObj.refreshOverflow()}}),this.element.appendChild(t),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(t);var n=this.createElement("span",{className:"e-drop-icon e-icons"});n.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(n)},t.prototype.ribbonExpandCollapse=function(e){var t,r={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(t=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),t.classList.add("e-active"),sf.base.EventHandler.remove(t,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",r)):(t=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),r.expanded=!1,t.classList.remove("e-active"),sf.base.EventHandler.add(t,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",r))},t.prototype.getIndex=function(e,t){return this.menuItems.length?t?e-1:e+1:e},t.prototype.updateToolbar=function(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()},t.prototype.enableMenuItems=function(e,t,r){void 0===t&&(t=!0),this.menuItems.length&&sf.base.getComponent(document.getElementById(this.element.id+"_menu"),"menu").enableItems(e,t,r)},t.prototype.hideMenuItems=function(e,t,r){if(void 0===t&&(t=!0),this.menuItems.length){var n=sf.base.getComponent(document.getElementById(this.element.id+"_menu"),"menu");t?n.hideItems(e,r):n.showItems(e,r)}},t.prototype.addMenuItems=function(e,t,r,n){if(void 0===r&&(r=!0),this.menuItems.length){var i=sf.base.getComponent(document.getElementById(this.element.id+"_menu"),"menu");r?i.insertAfter(e.reverse(),t,n):i.insertBefore(e,t,n)}},t.prototype.hideTabs=function(e,t){var r,n,i,a,s=this;if(void 0===t&&(t=!0),t||(a=this.isAllHidden()),e.forEach((function(e){(r=s.getTabIndex(e,-1))>-1&&(t?s.items[r].cssClass.includes(" e-hide")||(s.items[r].cssClass=s.items[r].cssClass+" e-hide",s.tabObj.items[s.getIndex(r)].cssClass=s.items[r].cssClass,void 0===n&&r===s.selectedTab&&(n=!0),i=!0):s.items[r].cssClass.includes(" e-hide")&&(s.items[r].cssClass=s.items[r].cssClass.replace(" e-hide",""),s.tabObj.items[s.getIndex(r)].cssClass=s.items[r].cssClass,void 0===n&&r===s.selectedTab&&(n=!0),i=!0))})),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(a=this.isAllHidden())&&(n=!1),!t&&a&&(n=!n),i&&a&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),n)for(var o=0;o<this.items.length;o++)if(!this.items[o].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(o),this.tabObj.dataBind();break}},t.prototype.isAllHidden=function(){for(var e=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e},t.prototype.enableTabs=function(e,t){var r=this;void 0===t&&(t=!0),e.forEach((function(e){var n=r.getTabIndex(e,-1);n>-1&&(r.items[n].disabled=!t,n=r.getIndex(n),r.tabObj.enableTab(n,t))})),this.setProperties({items:this.items},!0)},t.prototype.addTabs=function(e,t){var r=this,n=this.getTabIndex(t);e.forEach((function(e){e=new un(r.items[0],"items",e,!0),r.items.splice(n,0,e),r.tabObj.addTab([{header:e.header,content:r.toolbarObj.element}],r.getIndex(n)),n++})),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)},t.prototype.getTabIndex=function(e,t){if(void 0===t&&(t=this.items.length),e)for(var r=0;r<this.items.length;r++)if(this.items[r].header.text===e){t=r;break}return t},t.prototype.addToolbarItems=function(e,t,r){var n=this,i=this.getTabIndex(e);sf.base.isNullOrUndefined(r)&&(r=this.items[i].content.length),t.forEach((function(e){e=new sf.navigations.Item(n.items[i].content[0],"content",e,!0),n.items[i].content.splice(r,0,e),r++})),this.setProperties({items:this.items},!0),i===this.selectedTab&&t.length&&this.updateToolbar(i)},t.prototype.enableItems=function(e,t,r){if(void 0===r&&(r=!0),t){var n=this.getTabIndex(e,-1);if(n<0)return;for(var i=0;i<t.length;i++){if("string"==typeof t[i])for(var a=0;a<this.items[n].content.length;a++)if(this.items[n].content[a].id===t[i]){t[i]=a;break}if("string"==typeof t[i])return;this.items[n].content[t[i]].disabled=!r}n===this.selectedTab&&this.updateToolbar(n)}else this.toolbarObj.disable(!r)},t.prototype.hideToolbarItems=function(e,t,r){var n,i=this;void 0===r&&(r=!0);for(var a=0;a<this.items.length;a++)if(this.items[a].header.text===e){n=a,t.forEach((function(e){i.items[n].content[e]&&(r?i.items[n].content[e].cssClass.includes(" e-hide")||(i.items[n].content[e].cssClass=i.items[n].content[e].cssClass+" e-hide"):i.items[n].content[e].cssClass.includes(" e-hide")&&(i.items[n].content[e].cssClass=i.items[n].content[e].cssClass.replace(" e-hide","")))}));break}this.setProperties({items:this.items},!0),void 0!==n&&n===this.selectedTab&&this.updateToolbar(n)},t.prototype.getModuleName=function(){return"ribbon"},t.prototype.getPersistData=function(){return this.addOnPersist([])},t.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){switch(n[r]){case"selectedTab":this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}}},pn([sf.base.Property("")],t.prototype,"cssClass",void 0),pn([sf.base.Property(!0)],t.prototype,"menuType",void 0),pn([sf.base.Collection([],sf.navigations.MenuItem)],t.prototype,"menuItems",void 0),pn([sf.base.Property(0)],t.prototype,"selectedTab",void 0),pn([sf.base.Collection([],un)],t.prototype,"items",void 0),pn([sf.base.Event()],t.prototype,"selecting",void 0),pn([sf.base.Event()],t.prototype,"fileMenuItemSelect",void 0),pn([sf.base.Event()],t.prototype,"beforeFileMenuItemRender",void 0),pn([sf.base.Event()],t.prototype,"beforeOpen",void 0),pn([sf.base.Event()],t.prototype,"beforeClose",void 0),pn([sf.base.Event()],t.prototype,"selectFormat",void 0),pn([sf.base.Event()],t.prototype,"clicked",void 0),pn([sf.base.Event()],t.prototype,"created",void 0),pn([sf.base.Event()],t.prototype,"expandCollapse",void 0),t=pn([sf.base.NotifyPropertyChanges],t)}(sf.base.Component),gn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("input",{attrs:{type:"color"}});this.fontColorPicker=new sf.inputs.ColorPicker({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:Un,enableOpacity:!1,beforeClose:function(t){return e.beforeCloseHandler(e.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(t){return e.beforeModeSwitch(e.fontColorPicker,t)},change:function(t){var r={style:{color:e.fontColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(E,r),r.cancel?e.fontColorPicker.setProperties({value:e.fontColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.color,e.fontColorPicker.element),_r(e.parent.element)},created:function(){return e.wireFocusEvent(e.fontColorPicker.element,"#000000")}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(r),this.fontColorPicker.appendTo(r),r.parentElement.id=t+"_font_color_picker",sf.base.addClass([r.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),r=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new sf.inputs.ColorPicker({value:"#ffff00ff",mode:"Palette",presetColors:Vn,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:function(t){return e.beforeCloseHandler(e.filColorPicker)},beforeModeSwitch:function(t){return e.beforeModeSwitch(e.filColorPicker,t)},change:function(t){var r={style:{backgroundColor:e.filColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(E,r),r.cancel?e.filColorPicker.setProperties({value:e.filColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.backgroundColor,e.filColorPicker.element),_r(e.parent.element)},created:function(){return e.wireFocusEvent(e.filColorPicker.element,"#ffff00")}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(r),this.filColorPicker.appendTo(r),r.parentElement.id=t+"_fill_color_picker",sf.base.addClass([r.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},e.prototype.updateSelectedColor=function(e,t){t.nextElementSibling.querySelector(".e-selected-color").style.borderBottomColor=e},e.prototype.wireFocusEvent=function(e,t){var r=this;this.updateSelectedColor(t,e),(e=e.parentElement.querySelector(".e-split-colorpicker")).addEventListener("focus",(function(){_r(r.parent.element)}))},e.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(Mn).getConstant("MoreColors")},e.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0)},e.prototype.beforeModeSwitch=function(e,t){var r=this.parent.serviceLocator.getService(Mn);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=r.getConstant("Apply"),t.element.querySelector(".e-cancel").title=r.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("MoreColors"))},e.prototype.destroy=function(){this.parent&&(this.removeEventListener(),this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)},e.prototype.addEventListener=function(){this.parent.on("beforeRibbonCreate",this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.off("beforeRibbonCreate",this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.on("spreadsheetDestroyed",this.destroy,this)},e}(),mn=function(){function e(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.findValue="",this.parent=e,this.addEventListener(),new gn(e)}return e.prototype.getModuleName=function(){return"ribbon"},e.prototype.initRibbon=function(e){this.parent.showRibbon||!this.ribbon?(this.parent.notify("beforeRibbonCreate",{}),this.parent.isMobileView()?this.createMobileView():this.createRibbon(e)):this.destroy()},e.prototype.getRibbonMenuItems=function(){var e=this.parent.serviceLocator.getService(Mn),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:t+"_File",items:[{text:e.getConstant("New"),id:t+"_New",iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:t+"_Open",iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:t+"_Save_As",items:[{text:e.getConstant("ExcelXlsx"),id:t+"_Xlsx",iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:t+"_Xls",iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:t+"_Csv",iconCss:"e-csv e-icons"}]}]}]},e.prototype.getRibbonItems=function(){var e=this,t=this.parent.element.id,r=this.parent.serviceLocator.getService(Mn),n=[{header:{text:r.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:r.getConstant("Undo")+" (Ctrl+Z)",id:t+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:r.getConstant("Redo")+" (Ctrl+Y)",id:t+"_redo",disabled:!0},{type:"Separator",id:t+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:r.getConstant("Cut")+" (Ctrl+X)",id:t+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:r.getConstant("Copy")+" (Ctrl+C)",id:t+"_copy"},{tooltipText:r.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(t),id:t+"_paste",disabled:!0},{type:"Separator",id:t+"_separator_2"},{template:this.getNumFormatDDB(t),tooltipText:r.getConstant("NumberFormat"),id:t+"_number_format"},{type:"Separator",id:t+"_separator_3"},{template:this.getFontNameDDB(t),tooltipText:r.getConstant("Font"),id:t+"_font_name"},{type:"Separator",id:t+"_separator_4"},{template:this.getFontSizeDDB(t),tooltipText:r.getConstant("FontSize"),id:t+"_font_size"},{type:"Separator",id:t+"_separator_5"},{template:this.getBtn(t,"bold"),tooltipText:r.getConstant("Bold")+" (Ctrl+B)",id:t+"_bold"},{template:this.getBtn(t,"italic"),tooltipText:r.getConstant("Italic")+" (Ctrl+I)",id:t+"_italic"},{template:this.getBtn(t,"line-through"),tooltipText:r.getConstant("Strikethrough")+" (Ctrl+5)",id:t+"_line-through"},{template:this.getBtn(t,"underline"),tooltipText:r.getConstant("Underline")+" (Ctrl+U)",id:t+"_underline"},{template:document.getElementById(t+"_font_color_picker"),tooltipText:r.getConstant("TextColor"),id:t+"_font_color_picker"},{type:"Separator",id:t+"_separator_6"},{template:document.getElementById(t+"_fill_color_picker"),tooltipText:r.getConstant("FillColor"),id:t+"_fill_color_picker"},{template:this.getBordersDBB(t),tooltipText:r.getConstant("Borders"),id:t+"_borders"},{template:this.getMergeSplitBtn(t),tooltipText:r.getConstant("MergeCells"),id:t+"_merge_cells",disabled:!0},{type:"Separator",id:t+"_separator_7"},{template:this.getTextAlignDDB(t),tooltipText:r.getConstant("HorizontalAlignment"),id:t+"_text_align"},{template:this.getVerticalAlignDDB(t),tooltipText:r.getConstant("VerticalAlignment"),id:t+"_vertical_align"},{template:this.getBtn(t,"wrap",!1),tooltipText:""+r.getConstant("WrapText"),id:t+"_wrap"}]},{header:{text:r.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:r.getConstant("Link"),id:t+"_hyperlink",tooltipText:r.getConstant("Link"),click:function(){e.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:r.getConstant("Image"),id:t+"_",tooltipText:r.getConstant("Image"),click:function(){sf.base.select("#"+t+"_imageUpload",e.parent.element).click()}}]},{header:{text:r.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:r.getConstant("InsertFunction"),text:r.getConstant("InsertFunction"),id:t+"_insert_function"}]},{header:{text:r.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:r.getConstant("ProtectSheet"),id:t+"_protect",tooltipText:r.getConstant("ProtectSheet")},{type:"Separator",id:t+"_separator_8"},{template:this.datavalidationDDB(t),tooltipText:r.getConstant("DataValidation"),id:t+"_datavalidation"}]},{header:{text:r.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:t+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:t+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:t+"_gridlines",tooltipText:this.getLocaleText("GridLines")}]}];return this.parent.allowConditionalFormat&&n.find((function(e){return e.header&&e.header.text===r.getConstant("Home")})).content.push({type:"Separator",id:t+"_separator_10"},{template:this.getCFDBB(t),tooltipText:r.getConstant("ConditionalFormatting"),id:t+"_conditionalformatting"}),this.parent.allowChart&&n.find((function(e){return e.header&&e.header.text===r.getConstant("Insert")})).content.push({type:"Separator",id:t+"_separator_11"},{template:this.getChartDBB(t),text:r.getConstant("Chart"),tooltipText:r.getConstant("Chart"),id:t+"_chart"}),this.parent.allowCellFormatting&&n.find((function(e){return e.header&&e.header.text===r.getConstant("Home")})).content.push({type:"Separator",id:t+"_separator_12"},{template:this.getClearDDB(t),tooltipText:r.getConstant("Clear"),id:t+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&n.find((function(e){return e.header&&e.header.text===r.getConstant("Home")})).content.push({template:this.getSortFilterDDB(t),tooltipText:r.getConstant("SortAndFilter"),id:t+"_sorting"}),this.parent.allowFindAndReplace&&n.find((function(e){return e.header&&e.header.text===r.getConstant("Home")})).content.push({template:this.getFindDDb(t),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:r.getConstant("FindReplaceTooltip"),id:t+"_find"}),n},e.prototype.getPasteBtn=function(e){var t=this,r=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste"})),n=this.parent.serviceLocator.getService(Mn);return this.pasteSplitBtn=new sf.splitbuttons.SplitButton({iconCss:"e-icons e-paste-icon",items:[{text:n.getConstant("All"),id:"All"},{text:n.getConstant("Values"),id:"Values"},{text:n.getConstant("Formats"),id:"Formats"}],select:function(e){t.parent.notify(j,{type:e.item.id,isAction:!0,isInternal:!0})},click:function(){t.parent.notify(j,{isAction:!0,isInternal:!0})},close:function(){_r(t.parent.element)}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(r),r.parentElement},e.prototype.getHyperlinkDlg=function(){var e,r=t(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[r[0]];sf.base.isNullOrUndefined(n)||(e=n.cells[r[1]]),sf.base.isNullOrUndefined(e)&&ht(r[0],r[1],this.parent.getActiveSheet(),e,!1),e&&e.hyperlink?this.parent.notify("editHyperlink",null):this.parent.notify("initiateHyperlink",null)},e.prototype.getLocaleText=function(e,t){var r,n=this.parent.serviceLocator.getService(Mn);return this.parent.getActiveSheet()["show"+e]?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Hide"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Show"+e)),r},e.prototype.getLocaleProtectText=function(e,t){var r,n=this.parent.serviceLocator.getService(Mn);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Protect"+e)),r},e.prototype.createRibbon=function(e){var t=this.parent.createElement("div",{id:this.parent.element.id+"_ribbon"});if(this.ribbon=new fn({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e&&e.uiUpdate){var r=this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel");this.parent.element.insertBefore(t,r)}else this.parent.element.appendChild(t);this.ribbon.appendTo(t)},e.prototype.tabSelecting=function(e){e.selectingIndex!==this.ribbon.selectedTab&&(this.refreshRibbonContent(e.selectingIndex),this.parent.notify("tabSwitch",{activeTab:e.selectingIndex}))},e.prototype.beforeRenderHandler=function(e){var t=this.parent.serviceLocator.getService(Mn);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled")},e.prototype.getNumFormatDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_number_format"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new sf.splitbuttons.DropDownButton({items:this.getNumFormatDdbItems(e),content:"",select:function(e){return t.numDDBSelect(e)},open:function(e){return t.numDDBOpen(e)},beforeItemRender:function(e){return t.previewNumFormat(e)},close:function(){return _r(t.parent.element)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(r),r},e.prototype.getFontSizeDDB=function(e){var t=this;return this.fontSizeDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-font-size-ddb",content:"11",items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){var r={style:{fontSize:e.item.text+"pt"},onActionUpdate:!0};t.parent.notify(E,r),r.cancel||(t.fontSizeDdb.content=r.style.fontSize.split("pt")[0],t.fontSizeDdb.dataBind())},close:function(){return _r(t.parent.element)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size"})),this.fontSizeDdb.element},e.prototype.getChartDBB=function(e){var t=this,r=this.parent.serviceLocator.getService(Mn);this.chartMenu=new sf.navigations.Menu({cssClass:"e-chart-menu",items:[{iconCss:"e-icons e-column",text:r.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:r.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:r.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:r.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:r.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:r.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===r.getConstant("Column")?(e.element.firstChild.appendChild(n),e.element.parentElement.classList.add("e-column-chart")):e.parentItem.text===r.getConstant("Bar")?(e.element.firstChild.appendChild(u),e.element.parentElement.classList.add("e-bar-chart")):e.parentItem.text===r.getConstant("Area")?(e.element.firstChild.appendChild(w),e.element.parentElement.classList.add("e-area-chart")):e.parentItem.text===r.getConstant("Line")?(e.element.firstChild.appendChild(F),e.element.parentElement.classList.add("e-line-chart")):e.parentItem.text===r.getConstant("PieAndDoughnut")?(e.element.firstChild.appendChild(B),e.element.parentElement.classList.add("e-pie-doughnut-chart")):e.parentItem.text===r.getConstant("Radar")?(e.element.firstChild.appendChild(U),e.element.parentElement.classList.add("e-radar-chart")):e.parentItem.text===r.getConstant("Scatter")&&(e.element.firstChild.appendChild(W),e.element.parentElement.classList.add("e-scatter-chart"))},select:this.chartSelected.bind(this)}),this.chartMenu.createElement=this.parent.createElement;var n=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),i=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text",innerHTML:r.getConstant("Column")}),a=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),s=(this.parent.createElement("div",{id:"column2_text",className:"e-column2-text"}),this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"}));n.appendChild(i),n.appendChild(a);var o=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons"}),l=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons"}),h=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons"}),d=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),p=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),c=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});o.title=r.getConstant("ClusteredColumn"),l.title=r.getConstant("StackedColumn"),h.title=r.getConstant("StackedColumn100"),c.title=r.getConstant("OrangeDataBar"),p.title=r.getConstant("LightblueDataBar"),d.title=r.getConstant("PurpleDataBar"),a.appendChild(o),a.appendChild(l),a.appendChild(h),s.appendChild(d),s.appendChild(p),s.appendChild(c);var u=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),f=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text",innerHTML:r.getConstant("Bar")}),g=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),m=(this.parent.createElement("div",{id:"bar2_text",className:"e-bar2-text"}),this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"}));u.appendChild(f),u.appendChild(g);var v=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons"}),y=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons"}),C=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons"}),b=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),S=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),x=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});v.title=r.getConstant("ClusteredBar"),y.title=r.getConstant("StackedBar"),C.title=r.getConstant("StackedBar100"),x.title=r.getConstant("OrangeDataBar"),S.title=r.getConstant("LightblueDataBar"),b.title=r.getConstant("PurpleDataBar"),g.appendChild(v),g.appendChild(y),g.appendChild(C),m.appendChild(b),m.appendChild(S),m.appendChild(x);var w=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),I=this.parent.createElement("div",{id:"area_text",className:"e-area-text",innerHTML:r.getConstant("Area")}),E=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});w.appendChild(I),w.appendChild(E);var R=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons"}),k=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons"}),A=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons"});R.title=r.getConstant("Area"),k.title=r.getConstant("StackedArea"),A.title=r.getConstant("StackedArea100"),E.appendChild(R),E.appendChild(k),E.appendChild(A);var F=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),T=this.parent.createElement("div",{id:"line_text",className:"e-line-text",innerHTML:r.getConstant("Line")}),O=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"});F.appendChild(T),F.appendChild(O);var N=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons"}),D=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons"}),L=this.parent.createElement("span",{id:"stackedline100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons"});N.title=r.getConstant("Line"),D.title=r.getConstant("StackedLine"),L.title=r.getConstant("StackedLine100"),O.appendChild(N),O.appendChild(D),O.appendChild(L);var B=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),H=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text",innerHTML:r.getConstant("Pie")}),M=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});B.appendChild(H),B.appendChild(M);var P=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons"}),_=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons"});P.title=r.getConstant("Pie"),_.title=r.getConstant("Doughnut"),M.appendChild(P),M.appendChild(_);var U=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),V=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text",innerHTML:"Radar"}),j=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});U.appendChild(V),U.appendChild(j);var q=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons"}),z=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons"});q.title=r.getConstant("BlueDataBar"),z.title=r.getConstant("GreenDataBar"),j.appendChild(q),j.appendChild(z);var W=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),G=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text",innerHTML:r.getConstant("Scatter")}),Y=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});W.appendChild(G),W.appendChild(Y);var X=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons"});X.title=r.getConstant("Scatter"),Y.appendChild(X);var K=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_chart_menu",styles:"display: none;"}));this.chartMenu.appendTo(K),K.classList.add("e-ul"),this.chartDdb=new sf.splitbuttons.DropDownButton({iconCss:"e-icons e-chart-icon",cssClass:"e-chart-ddb",target:this.chartMenu.element.parentElement,created:function(){t.chartMenu.element.style.display=""},beforeClose:function(e){e.event&&sf.base.closest(e.event.target,".e-chart-ddb")&&(e.cancel=!0)},close:function(){return _r(t.parent.element)}}),this.chartDdb.createElement=this.parent.createElement;var $=this.parent.createElement("button",{id:e+"_chart-btn"});return $.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:"Chart"})),this.chartDdb.appendTo($),this.chartDdb.element},e.prototype.getCFDBB=function(e){var t=this,r=this.parent.serviceLocator.getService(Mn);this.cFMenu=new sf.navigations.Menu({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:r.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan",text:r.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan",text:r.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between",text:r.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto",text:r.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textthatcontains",text:r.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring",text:r.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues",text:r.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:r.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items",text:r.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10",text:r.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items",text:r.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10",text:r.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage",text:r.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage",text:r.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:r.getConstant("DataBars"),items:[{id:"cf_databars"}]},{iconCss:"e-icons e-colorscales",text:r.getConstant("ColorScales"),items:[{id:"cf_colorscales"}]},{iconCss:"e-icons e-iconsets",text:r.getConstant("IconSets"),items:[{id:"cf_iconsets"}]},{iconCss:"e-icons e-clearrules",text:r.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:r.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:r.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===r.getConstant("DataBars")?(e.element.firstChild.appendChild(n),e.element.parentElement.classList.add("e-databars")):e.parentItem.text===r.getConstant("ColorScales")?(e.element.firstChild.appendChild(c),e.element.parentElement.classList.add("e-colorscales")):e.parentItem.text===r.getConstant("IconSets")&&(e.element.firstChild.appendChild(A),e.element.parentElement.classList.add("e-iconsets"))},select:this.cFSelected.bind(this)});var n=this.parent.createElement("div",{id:"db",className:"e-db"}),i=this.parent.createElement("div",{id:"db1",className:"e-db1"}),a=this.parent.createElement("div",{id:"db2",className:"e-db2"});n.appendChild(i),n.appendChild(a);var s=this.parent.createElement("span",{id:"BlueDataBar",className:"e-bdatabar e-databar-icon"}),o=this.parent.createElement("span",{id:"GreenDataBar",className:"e-gdatabar e-databar-icon"}),l=this.parent.createElement("span",{id:"RedDataBar",className:"e-rdatabar e-databar-icon"}),h=this.parent.createElement("span",{id:"OrangeDataBar",className:"e-odatabar e-databar-icon"}),d=this.parent.createElement("span",{id:"LightBlueDataBar",className:"e-lbdatabar e-databar-icon"}),p=this.parent.createElement("span",{id:"PurpleDataBar",className:"e-pdatabar e-databar-icon"});s.title=r.getConstant("BlueDataBar"),o.title=r.getConstant("GreenDataBar"),l.title=r.getConstant("RedDataBar"),h.title=r.getConstant("OrangeDataBar"),d.title=r.getConstant("LightblueDataBar"),p.title=r.getConstant("PurpleDataBar"),i.appendChild(s),i.appendChild(o),i.appendChild(l),a.appendChild(h),a.appendChild(d),a.appendChild(p),this.cFMenu.createElement=this.parent.createElement;var c=this.parent.createElement("div",{id:"db",className:"e-cs"}),u=this.parent.createElement("div",{id:"cs1",className:"e-cs1"}),f=this.parent.createElement("div",{id:"cs2",className:"e-cs2"}),g=this.parent.createElement("div",{id:"cs3",className:"e-cs3"});c.appendChild(u),c.appendChild(f),c.appendChild(g);var m=this.parent.createElement("span",{id:"GYRColorScale",className:"e-gyr e-colorscale-icon"}),v=this.parent.createElement("span",{id:"RYGColorScale",className:"e-ryg e-colorscale-icon"}),y=this.parent.createElement("span",{id:"GWRColorScale",className:"e-gwr e-colorscale-icon"}),C=this.parent.createElement("span",{id:"RWGColorScale",className:"e-rwg e-colorscale-icon"}),b=this.parent.createElement("span",{id:"BWRColorScale",className:"e-bwr e-colorscale-icon"}),S=this.parent.createElement("span",{id:"RWBColorScale",className:"e-rwb e-colorscale-icon"}),x=this.parent.createElement("span",{id:"WRColorScale",className:"e-wr e-colorscale-icon"}),w=this.parent.createElement("span",{id:"RWColorScale",className:"e-rw e-colorscale-icon"}),I=this.parent.createElement("span",{id:"GWColorScale",className:"e-gw e-colorscale-icon"}),E=this.parent.createElement("span",{id:"WGColorScale",className:"e-wg e-colorscale-icon"}),R=this.parent.createElement("span",{id:"GYColorScale",className:"e-gy e-colorscale-icon"}),k=this.parent.createElement("span",{id:"YGColorScale",className:"e-yg e-colorscale-icon"});m.title=r.getConstant("GYRColorScale"),v.title=r.getConstant("RYGColorScale"),y.title=r.getConstant("GWRColorScale"),C.title=r.getConstant("RWGColorScale"),b.title=r.getConstant("BWRColorScale"),S.title=r.getConstant("RWBColorScale"),x.title=r.getConstant("WRColorScale"),w.title=r.getConstant("RWColorScale"),I.title=r.getConstant("GWColorScale"),E.title=r.getConstant("WGColorScale"),R.title=r.getConstant("GYColorScale"),k.title=r.getConstant("YGColorScale"),u.appendChild(m),u.appendChild(v),u.appendChild(y),u.appendChild(C),f.appendChild(b),f.appendChild(S),f.appendChild(x),f.appendChild(w),g.appendChild(I),g.appendChild(E),g.appendChild(R),g.appendChild(k);var A=this.parent.createElement("div",{id:"is",className:"e-is"}),F=this.parent.createElement("div",{id:"is1",className:"e-is1",innerHTML:"Directional"}),T=this.parent.createElement("div",{id:"is2",className:"e-is2"}),O=this.parent.createElement("div",{id:"is3",className:"e-is3",innerHTML:"Shapes"}),N=this.parent.createElement("div",{id:"is4",className:"e-is4"}),D=this.parent.createElement("div",{id:"is5",className:"e-is5",innerHTML:"Indicators"}),L=this.parent.createElement("div",{id:"is6",className:"e-is6"}),B=this.parent.createElement("div",{id:"is7",className:"e-is7",innerHTML:"Ratings"}),H=this.parent.createElement("div",{id:"is8",className:"e-is8"});F.title=r.getConstant("GYColorScale"),T.title=r.getConstant("YGColorScale"),O.title=r.getConstant("GYColorScale"),N.title=r.getConstant("YGColorScale"),D.title=r.getConstant("GYColorScale"),L.title=r.getConstant("YGColorScale"),B.title=r.getConstant("GYColorScale"),H.title=r.getConstant("YGColorScale"),A.appendChild(F),A.appendChild(T),A.appendChild(O),A.appendChild(N),A.appendChild(D),A.appendChild(L),A.appendChild(B),A.appendChild(H);var M=this.parent.createElement("div",{id:"ThreeArrows",className:"e-3arrows e-is-wrapper"}),P=this.parent.createElement("div",{id:"ThreeArrowsGray",className:"e-3arrowsgray e-is-wrapper"}),_=this.parent.createElement("div",{id:"ThreeTriangles",className:"e-3triangles e-is-wrapper"}),U=this.parent.createElement("div",{id:"FourArrowsGray",className:"e-4arrowsgray e-is-wrapper"}),V=this.parent.createElement("div",{id:"FourArrows",className:"e-4arrows e-is-wrapper"}),j=this.parent.createElement("div",{id:"FiveArrowsGray",className:"e-5arrowsgray e-is-wrapper"}),q=this.parent.createElement("div",{id:"FiveArrows",className:"e-5arrows e-is-wrapper"});M.title=r.getConstant("ThreeArrowsColor"),P.title=r.getConstant("ThreeArrowsGray"),_.title=r.getConstant("ThreeTriangles"),U.title=r.getConstant("FourArrowsColor"),V.title=r.getConstant("FourArrowsGray"),j.title=r.getConstant("FiveArrowsColor"),q.title=r.getConstant("FiveArrowsGray"),T.appendChild(M),T.appendChild(P),T.appendChild(_),T.appendChild(U),T.appendChild(V),T.appendChild(j),T.appendChild(q);var z=this.parent.createElement("div",{id:"ThreeTrafficLights1",className:"e-3trafficlights e-is-wrapper"}),W=this.parent.createElement("div",{id:"ThreeTrafficLights2",className:"e-3rafficlights2 e-is-wrapper"}),G=this.parent.createElement("div",{id:"ThreeSigns",className:"e-3signs e-is-wrapper"}),Y=this.parent.createElement("div",{id:"FourTrafficLights",className:"e-4trafficlights e-is-wrapper"}),X=this.parent.createElement("div",{id:"FourRedToBlack",className:"e-4redtoblack e-is-wrapper"});z.title=r.getConstant("ThreeTrafficLights1"),W.title=r.getConstant("ThreeTrafficLights2"),G.title=r.getConstant("ThreeSigns"),Y.title=r.getConstant("FourTrafficLights"),X.title=r.getConstant("RedToBlack"),N.appendChild(z),N.appendChild(W),N.appendChild(G),N.appendChild(Y),N.appendChild(X);var K=this.parent.createElement("div",{id:"ThreeSymbols",className:"e-3symbols e-is-wrapper"}),$=this.parent.createElement("div",{id:"ThreeSymbols2",className:"e-3symbols2 e-is-wrapper"}),Z=this.parent.createElement("div",{id:"ThreeFlags",className:"e-3flags e-is-wrapper"});K.title=r.getConstant("ThreeSymbols1"),$.title=r.getConstant("ThreeSymbols2"),Z.title=r.getConstant("ThreeFlags"),L.appendChild(K),L.appendChild($),L.appendChild(Z);var J=this.parent.createElement("div",{id:"ThreeStars",className:"e-3stars e-is-wrapper"}),Q=this.parent.createElement("div",{id:"FourRating",className:"e-4rating e-is-wrapper"}),ee=this.parent.createElement("div",{id:"FiveQuarters",className:"e-5quarters e-is-wrapper"}),te=this.parent.createElement("div",{id:"FiveRating",className:"e-5rating e-is-wrapper"}),re=this.parent.createElement("div",{id:"FiveBoxes",className:"e-5boxes e-is-wrapper"});J.title=r.getConstant("ThreeStars"),Q.title=r.getConstant("FourRatings"),ee.title=r.getConstant("FiveQuarters"),te.title=r.getConstant("FiveRatings"),re.title=r.getConstant("FiveBoxes"),H.appendChild(J),H.appendChild(Q),H.appendChild(ee),H.appendChild(te),H.appendChild(re),M.appendChild(this.createElement("span","e-3arrows-1 e-iconsetspan")),M.appendChild(this.createElement("span","e-3arrows-2 e-iconsetspan")),M.appendChild(this.createElement("span","e-3arrows-3 e-iconsetspan")),P.appendChild(this.createElement("span","e-3arrowsgray-1 e-iconsetspan")),P.appendChild(this.createElement("span","e-3arrowsgray-2 e-iconsetspan")),P.appendChild(this.createElement("span","e-3arrowsgray-3 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-1 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-2 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-3 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrowsgray-1 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrowsgray-2 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrowsgray-3 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrowsgray-4 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-1 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-2 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-3 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-4 e-iconsetspan")),j.appendChild(this.createElement("span","e-5arrowsgray-1 e-iconsetspan")),j.appendChild(this.createElement("span","e-5arrowsgray-2 e-iconsetspan")),j.appendChild(this.createElement("span","e-5arrowsgray-3 e-iconsetspan")),j.appendChild(this.createElement("span","e-5arrowsgray-4 e-iconsetspan")),j.appendChild(this.createElement("span","e-5arrowsgray-5 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-1 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-2 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-3 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-4 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-5 e-iconsetspan")),z.appendChild(this.createElement("span","e-3trafficlights-1 e-iconsetspan")),z.appendChild(this.createElement("span","e-3trafficlights-2 e-iconsetspan")),z.appendChild(this.createElement("span","e-3trafficlights-3 e-iconsetspan")),W.appendChild(this.createElement("span","e-3rafficlights2-1 e-iconsetspan")),W.appendChild(this.createElement("span","e-3rafficlights2-2 e-iconsetspan")),W.appendChild(this.createElement("span","e-3rafficlights2-3 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-1 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-2 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-1 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-2 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-4 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-1 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-2 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-3 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-4 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols-1 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols-2 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols-3 e-iconsetspan")),$.appendChild(this.createElement("span","e-3symbols2-1 e-iconsetspan")),$.appendChild(this.createElement("span","e-3symbols2-2 e-iconsetspan")),$.appendChild(this.createElement("span","e-3symbols2-3 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3flags-1 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3flags-2 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3flags-3 e-iconsetspan")),J.appendChild(this.createElement("span","e-3stars-1 e-iconsetspan")),J.appendChild(this.createElement("span","e-3stars-2 e-iconsetspan")),J.appendChild(this.createElement("span","e-3stars-3 e-iconsetspan")),Q.appendChild(this.createElement("span","e-4rating-1 e-iconsetspan")),Q.appendChild(this.createElement("span","e-4rating-2 e-iconsetspan")),Q.appendChild(this.createElement("span","e-4rating-3 e-iconsetspan")),Q.appendChild(this.createElement("span","e-4rating-4 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-1 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-2 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-3 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-4 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-5 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-1 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-2 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-3 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-4 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-5 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-1 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-2 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-3 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-4 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-5 e-iconsetspan"));var ne=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_cf_menu",styles:"display: none;"}));return this.cFMenu.appendTo(ne),ne.classList.add("e-ul"),this.cFDdb=new sf.splitbuttons.DropDownButton({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:this.cFMenu.element.parentElement,created:function(){t.cFMenu.element.style.display=""},beforeClose:function(e){e.event&&sf.base.closest(e.event.target,".e-cf-ddb")&&(e.cancel=!0)},close:function(){return _r(t.parent.element)}}),this.cFDdb.createElement=this.parent.createElement,this.cFDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting"})),this.cFDdb.element},e.prototype.createElement=function(e,t,r){return this.parent.createElement(e,{className:t})},e.prototype.getBordersDBB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Mn);this.bordersMenu=new sf.navigations.Menu({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:n.getConstant("TopBorders")},{iconCss:"e-icons e-left-borders",text:n.getConstant("LeftBorders")},{iconCss:"e-icons e-right-borders",text:n.getConstant("RightBorders")},{iconCss:"e-icons e-bottom-borders",text:n.getConstant("BottomBorders")},{iconCss:"e-icons e-all-borders",text:n.getConstant("AllBorders")},{iconCss:"e-icons e-horizontal-borders",text:n.getConstant("HorizontalBorders")},{iconCss:"e-icons e-vertical-borders",text:n.getConstant("VerticalBorders")},{iconCss:"e-icons e-outside-borders",text:n.getConstant("OutsideBorders")},{iconCss:"e-icons e-inside-borders",text:n.getConstant("InsideBorders")},{iconCss:"e-icons e-no-borders",text:n.getConstant("NoBorders")},{separator:!0},{text:n.getConstant("BorderColor"),items:[{id:e+"_border_colors"}]},{text:n.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:e+"_1px"},{id:e+"_2px"},{id:e+"_3px"},{id:e+"_dashed"},{id:e+"_dotted"},{id:e+"_double"}]}],orientation:"Vertical",beforeOpen:function(e){"Border Color"===e.parentItem.text?(r.colorPicker.refresh(),t=r.colorPicker.element.parentElement,e.element.firstElementChild.appendChild(t),t.style.display="inline-block",e.element.parentElement.classList.add("e-border-color")):e.element.classList.add("e-border-style")},beforeClose:function(e){"Border Color"===e.parentItem.text&&(!sf.base.closest(e.event.target,".e-border-colorpicker")||sf.base.closest(e.event.target,".e-apply")||sf.base.closest(e.event.target,".e-cancel")?(r.colorPicker=sf.base.getComponent(a,"colorpicker"),"Picker"===r.colorPicker.mode&&(r.colorPicker.mode="Palette",r.colorPicker.dataBind()),t.style.display="",r.parent.element.appendChild(t)):e.cancel=!0)},onOpen:function(e){"Border Color"===e.parentItem.text&&(e.element.parentElement.style.overflow="visible")},select:this.borderSelected.bind(this)}),this.bordersMenu.createElement=this.parent.createElement;var i=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_borders_menu",styles:"display: none;"}));this.bordersMenu.appendTo(i),i.classList.add("e-ul");var a=this.parent.createElement("input",{id:e+"_cell_border_color",attrs:{type:"color"}});return this.parent.element.appendChild(a),this.colorPicker=new sf.inputs.ColorPicker({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,change:function(e){var t=r.border.split(" ");t[2]=e.currentValue.hex,r.border=t.join(" ")},created:function(){t=r.colorPicker.element.parentElement}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(a),this.bordersDdb=new sf.splitbuttons.DropDownButton({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:this.bordersMenu.element.parentElement,created:function(){r.bordersMenu.element.style.display=""},beforeOpen:function(e){return r.tBarDdbBeforeOpen(e.element.firstElementChild,r.bordersMenu.items,1)},beforeClose:function(e){e.event&&sf.base.closest(e.event.target,".e-borders-menu")&&(e.cancel=!0)},close:function(){return _r(r.parent.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders"})),this.bordersDdb.element},e.prototype.chartSelected=function(e){var t=e.element.id;if("column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(t)){var r=e.event.target.id;this.parent.notify("insertChart",{action:t,id:r})}},e.prototype.cFSelected=function(e){var t=e.element.id;if("cf_greaterthancf_lessthancf_betweencf_eqaultocf_textthatcontainscf_adateoccuringcf_duplicatevaluescf_top10itemscf_top10cf_bottom10itemscf_bottom10cf_aboveaveragecf_belowaverage".includes(t))this.parent.notify("initiateConditionalFormat",{action:e.item.text});else if("cf_databarscf_colorscales".includes(t)){var r=e.event.target.id;this.parent.notify("setCF",{action:t,id:r})}else if("cf_iconsets"===e.element.id){var n=e.event.target,i=""===n.id?n.parentElement.id:n.id;this.parent.notify("setCF",{action:t,id:i})}if("cf_cr_cells"===t)this.parent.notify("clearCFRule",{range:this.parent.getActiveSheet().selectedRange,isPublic:!1});else if("cf_cr_sheet"===t){var a=this.parent.getActiveSheet(),o=s([0,0,a.rowCount-1,a.colCount-1]);this.parent.conditionalFormat=null,this.parent.notify("clearCFRule",{range:o,isPublic:!1})}},e.prototype.borderSelected=function(e){if(!e.item.items.length&&e.item.id!==this.parent.element.id+"_border_colors"){if(!e.item.text){var t=this.parent.element.id,r=this.border.split(" "),n="solid"===r[1]?t+"_"+r[0]:t+"_"+r[1];if(n===e.item.id)return;return e.item.id===t+"_1px"||e.item.id===t+"_2px"||e.item.id===t+"_3px"?(r[0]=e.item.id.split(t+"_")[1],r[1]="solid"):(r[1]=e.item.id.split(t+"_")[1],r[0]="double"===r[1]?"3px":"1px"),this.border=r.join(" "),this.bordersMenu.items[12].items.forEach((function(t){t.id===n&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")})),void this.bordersMenu.setProperties({items:this.bordersMenu.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.text){case"Top Borders":this.parent.notify(E,{style:{borderTop:this.border},onActionUpdate:!0});break;case"Left Borders":this.parent.notify(E,{style:{borderLeft:this.border},onActionUpdate:!0});break;case"Right Borders":this.parent.notify(E,{style:{borderRight:this.border},onActionUpdate:!0});break;case"Bottom Borders":this.parent.notify(E,{style:{borderBottom:this.border},onActionUpdate:!0});break;case"All Borders":this.parent.notify(E,{style:{border:this.border},onActionUpdate:!0});break;case"Horizontal Borders":this.parent.notify(E,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case"Vertical Borders":this.parent.notify(E,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case"Outside Borders":this.parent.notify(E,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case"Inside Borders":this.parent.notify(E,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case"No Borders":this.parent.notify(E,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}},e.prototype.getFontNameDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_font_name"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-font-family",items:this.getFontFamilyItems(),select:function(e){var r={style:{fontFamily:e.item.text},onActionUpdate:!0};t.parent.notify(E,r),r.cancel||t.refreshFontNameSelection(r.style.fontFamily)},close:function(){return _r(t.parent.element)},beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(r),r},e.prototype.getBtn=function(e,t,r){void 0===r&&(r=!0);var n=new sf.buttons.Button({iconCss:"e-icons e-"+t+"-icon",isToggle:!0});return n.createElement=this.parent.createElement,n.appendTo(this.parent.createElement("button",{id:e+"_"+t})),r&&n.element.addEventListener("click",this.toggleBtnClicked.bind(this)),n.element},e.prototype.datavalidationDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Mn);return this.datavalidationDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",items:[{text:r.getConstant("DataValidation")},{text:r.getConstant("HighlightInvalidData")},{text:r.getConstant("ClearHighlight")},{text:r.getConstant("ClearValidation")}],beforeOpen:function(e){t.refreshSelected(t.datavalidationDdb,e.element,"iconCss")},select:function(e){switch(e.item.text){case r.getConstant("DataValidation"):t.parent.notify("initiatedatavalidation",null);break;case r.getConstant("HighlightInvalidData"):t.parent.notify("invalidData",{isRemoveHighlight:!1});break;case r.getConstant("ClearHighlight"):t.parent.notify("invalidData",{isRemoveHighlight:!0});break;case r.getConstant("ClearValidation"):t.parent.notify("removeDataValidation",null);break;default:var n=e.item.text===r.getConstant("SortAscending")?"Ascending":"Descending";t.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:n}}})}},close:function(){return _r(t.parent.element)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation"})),this.datavalidationDdb.element},e.prototype.getTextAlignDDB=function(e){var t=this;return this.textAlignDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss")},select:function(e){var r={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(E,r),r.cancel||(t.textAlignDdb.iconCss="e-icons e-"+r.style.textAlign+"-icon",t.textAlignDdb.dataBind())},close:function(){return _r(t.parent.element)}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align"})),this.textAlignDdb.element},e.prototype.getVerticalAlignDDB=function(e){var t=this;return this.verticalAlignDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss")},select:function(e){var r={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(E,r),r.cancel||(t.verticalAlignDdb.iconCss="e-icons e-"+r.style.verticalAlign+"-icon",t.verticalAlignDdb.dataBind())},close:function(){return _r(t.parent.element)}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align"})),this.verticalAlignDdb.element},e.prototype.getMergeSplitBtn=function(e){var t=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge"}));var r=this.parent.serviceLocator.getService(Mn);return this.mergeSplitBtn=new sf.splitbuttons.SplitButton({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",items:[{text:r.getConstant("MergeAll"),id:e+"_merge_all"},{text:r.getConstant("MergeHorizontally"),id:e+"_merge_horizontally"},{text:r.getConstant("MergeVertically"),id:e+"_merge_vertically"},{separator:!0,id:e+"_merge_separator"},{text:r.getConstant("Unmerge"),id:e+"_unmerge"}],select:this.mergeSelectHandler.bind(this),close:function(){return _r(t.parent.element)},click:function(e){e.element.classList.contains("e-active")?(t.toggleActiveState(!1),t.unMerge()):(t.toggleActiveState(!0),t.merge(t.parent.element.id+"_merge_all"))},created:function(){t.mergeSplitBtn.element.title=r.getConstant("MergeCells"),t.mergeSplitBtn.element.nextElementSibling.title=r.getConstant("SelectMergeType")}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement},e.prototype.mergeSelectHandler=function(e){e.item.id===this.parent.element.id+"_unmerge"?this.unMerge():this.merge(e.item.id)},e.prototype.unMerge=function(){this.parent.showSpinner(),this.parent.notify(T,{merge:!1,range:this.parent.getActiveSheet().selectedRange,isAction:!0,refreshRibbon:!0,type:"All"}),this.parent.hideSpinner()},e.prototype.merge=function(e){for(var r,n,i=this,a=this.parent.getActiveSheet(),s=t(a.selectedRange),o=s[0];o<=s[2];o++)for(var l=s[1];l<=s[3];l++)o===s[0]&&l===s[1]&&e.includes("merge_all")||o===s[0]&&e.includes("merge_vertically")||l===s[1]&&e.includes("_merge_horizontally")||((r=lt(o,l,a)||{}).value||r.formula)&&(n=!0);if(n){var h=this.parent.serviceLocator.getService(Pn);h.show({target:this.parent.element,height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Mn).getConstant("MergeCellsAlert"),beforeOpen:function(e){var t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};i.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),_r(i.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Mn).getConstant("Ok"),isPrimary:!0},click:function(){h.hide(),i.performMerge(e)}}]})}else this.performMerge(e)},e.prototype.performMerge=function(e){var t=this.parent.element.id;switch(this.parent.showSpinner(),e){case t+"_merge_all":this.parent.notify(T,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case t+"_merge_horizontally":this.parent.notify(T,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case t+"_merge_vertically":this.parent.notify(T,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()},e.prototype.getSortFilterDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Mn);return this.sortingDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:r.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:r.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:r.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],beforeItemRender:function(r){var n={isFiltered:!1,isClearAll:!0};t.parent.notify("getFilteredColumn",n),r.item.id!==e+"_clearfilter"&&r.item.id!==e+"_reapplyfilter"||(n.isFiltered?r.element.classList.remove("e-disabled"):r.element.classList.add("e-disabled"))},beforeOpen:function(e){t.refreshSelected(t.sortingDdb,e.element,"iconCss")},select:function(e){switch(e.item.text){case r.getConstant("Filter"):t.parent.applyFilter();break;case r.getConstant("ClearAllFilter"):t.parent.clearFilter();break;case r.getConstant("ReapplyFilter"):t.parent.notify("reapplyFilter",null);break;case r.getConstant("CustomSort")+"...":t.parent.notify("initiateCustomSort",null);break;default:var n=e.item.text===r.getConstant("SortAscending")?"Ascending":"Descending";t.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:n}}})}},close:function(){return _r(t.parent.element)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting"})),this.sortingDdb.element},e.prototype.getFindDDb=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_findbtn"});return this.findDdb=new sf.buttons.Button({cssClass:"e-spreadsheet-find-ddb e-caret-hide",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(r),r.onclick=function(){t.findToolDlg()},this.findDdb.element},e.prototype.findToolDlg=function(){var e,t=this;if(sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-findtool-dlg"))){var r,n=this.parent.createElement("div",{className:"e-input-group"}),i=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text",value:this.findValue}});i.setAttribute("placeholder","FindValue");var a=this.parent.createElement("span",{className:"e-input-group-icon"});i.onkeyup=function(){e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),a.textContent=e.findCount;var n=document.querySelector(".e-text-findNext-short").value,i=document.querySelector(".e-findRib-next"),s=document.querySelector(".e-findRib-prev");sf.base.isNullOrUndefined(n)||""===n||"0 of 0"===e.findCount?(r.enableItems(i,!1),r.enableItems(s,!1),a.textContent="0 of 0"):sf.base.isNullOrUndefined(n)&&"0 of 0"===e.findCount||(r.enableItems(i,!0),r.enableItems(s,!0))},i.onkeydown=function(r){e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e});var n=e.findCount;t.findOnKeyDown(r,n)},n.appendChild(i),n.appendChild(a);var s=[{type:"Input",template:n},{prefixIcon:"e-icons e-prev-icon",tooltipText:"Find Previous",type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:"Find Next",type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:"More Options",type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:"Close",type:"Button",cssClass:"e-findRib-close"}];r=new sf.navigations.Toolbar({clicked:function(r){"e-findRib-next"===r.item.cssClass?(t.parent.notify("findHandler",{findOption:"next"}),e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),a.textContent=e.findCount):"e-findRib-prev"===r.item.cssClass?(t.parent.notify("findHandler",{findOption:"prev"}),e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),a.textContent=e.findCount):"e-findRib-more"===r.item.cssClass&&(t.parent.notify(X,null),t.findDialog.hide())},width:"auto",height:"auto",items:s,cssClass:"e-find-toolObj"});var o=this.parent.createElement("div",{className:"e-find-toolbar"}),l=this.parent.createElement("div",{className:"e-dlg-div"});this.findDialog=new sf.popups.Dialog({isModal:!1,showCloseIcon:!1,cssClass:"e-findtool-dlg",content:o,visible:!1,allowDragging:!0,target:this.parent.element.querySelector(".e-main-panel"),beforeOpen:function(){sf.base.EventHandler.add(document,"click",t.closeDialog,t)},open:function(){t.textFocus(r.element)},beforeClose:function(){t.findValue=t.parent.element.querySelector(".e-text-findNext-short").value,r.destroy();var e=document.querySelector(".e-find-toolbar");sf.base.EventHandler.remove(e,"focus",t.textFocus),sf.base.EventHandler.remove(document,"click",t.closeDialog),_r(t.parent.element)},created:function(){r.createElement=t.parent.createElement,r.appendTo(o),t.findDialog.width=getComputedStyle(document.querySelector(".e-findtool-dlg")).width;var e=t.parent.element.querySelector(".e-main-panel").getBoundingClientRect(),n=t.findDialog.width,i=e.width-parseInt(n.toString(),10)-14,a=t.parent.sheets[t.parent.activeSheetIndex].showHeaders?31:0;t.findDialog.position={X:i,Y:a},t.findDialog.dataBind(),t.findDialog.show()}}),this.findDialog.createElement=this.parent.createElement,this.findDialog.appendTo(l)}else sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-findtool-dlg"))||(this.findDialog.hide(),sf.base.detach(this.parent.element.querySelector(".e-findtool-dlg")),this.findDialog=null,_r(this.parent.element))},e.prototype.findOnKeyDown=function(e,t){if(document.querySelector(".e-text-findNext-short").value&&"0 of 0"!==t)if(e.shiftKey){if(13===e.keyCode){this.parent.notify("findHandler",{findOption:"prev"})}}else if(13===e.keyCode){this.parent.notify("findHandler",{findOption:"next"})}},e.prototype.closeDialog=function(e){!sf.base.closest(e.target,".e-findRib-close")&&sf.base.closest(e.target,".e-spreadsheet")||sf.base.isNullOrUndefined(this.findDialog)||(this.findDialog.hide(),sf.base.detach(this.parent.element.querySelector(".e-findtool-dlg")),this.findDialog=null)},e.prototype.textFocus=function(e){document.querySelector(".e-find-toolbar").addEventListener("focus",(function(){var e=document.querySelector(".e-text-findNext-short");e.focus(),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)}))},e.prototype.getClearDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Mn);return this.clearDdb=new sf.splitbuttons.DropDownButton({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:r.getConstant("ClearAll")},{text:r.getConstant("ClearFormats")},{text:r.getConstant("ClearContents")},{text:r.getConstant("ClearHyperlinks")}],select:function(e){t.parent.notify("clearViewer",{options:{type:e.item.text}})},close:function(){return _r(t.parent.element)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear"})),this.clearDdb.element},e.prototype.ribbonCreated=function(){this.ribbon.element.querySelector(".e-drop-icon").title=this.parent.serviceLocator.getService(Mn).getConstant("CollapseToolbar")},e.prototype.alignItemRender=function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];t=t[0].toUpperCase()+t.slice(1,t.length),e.element.title=this.parent.serviceLocator.getService(Mn).getConstant("Align"+t)},e.prototype.toggleBtnClicked=function(e){var t,r,i,a,s,o=sf.base.closest(e.target,".e-btn"),l=this.parent.element.id,h=o.id,d=E;switch(h){case l+"_bold":r={fontWeight:"normal"},i={fontWeight:"bold"},s="fontWeight";break;case l+"_italic":r={fontStyle:"normal"},i={fontStyle:"italic"},s="fontStyle";break;case l+"_line-through":d="textDecorationUpdate",i=r={textDecoration:"line-through"},s="textDecoration";break;case l+"_underline":d="textDecorationUpdate",i=r={textDecoration:"underline"},s="textDecoration"}o.classList.contains("e-active")?(t=i[s],a={style:i,onActionUpdate:!0},this.parent.notify(d,a),a.cancel&&o.classList.remove("e-active")):(t=r[s],a={style:r,onActionUpdate:!0},this.parent.notify(d,a),a.cancel&&o.classList.add("e-active")),a.cancel||t===a.style[s]||this.refreshToggleBtn(n(this.parent.getActiveSheet().activeCell)),_r(this.parent.element)},e.prototype.getCellStyleValue=function(e,t){var r=lt(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[e];return r&&r.style&&r.style[e]&&(n=r.style[e]),n},e.prototype.refreshSelected=function(e,t,r,n){void 0===n&&(n=r);for(var i=0;i<e.items.length;i++)if(e.items[i][n]===e[r]){t.children[i].classList.add("e-selected");break}},e.prototype.expandCollapseHandler=function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),r=this.parent.serviceLocator.getService(Mn);e.expanded?t.title=r.getConstant("CollapseToolbar"):t.title=r.getConstant("ExpandToolbar"),this.parent.setPanelSize()},e.prototype.getNumFormatDdbItems=function(e){var t=this.parent.serviceLocator.getService(Mn);return[{id:e+"item1",text:t.getConstant("General")},{id:e+"item2",text:t.getConstant("Number")},{id:e+"item3",text:t.getConstant("Currency")},{id:e+"item4",text:t.getConstant("Accounting")},{id:e+"item5",text:t.getConstant("ShortDate")},{id:e+"item6",text:t.getConstant("LongDate")},{id:e+"item7",text:t.getConstant("Time")},{id:e+"item8",text:t.getConstant("Percentage")},{id:e+"item9",text:t.getConstant("Fraction")},{id:e+"item10",text:t.getConstant("Scientific")},{id:e+"item11",text:t.getConstant("Text")}]},e.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},e.prototype.numDDBSelect=function(e){var t={format:N(e.item.text),range:this.parent.getActiveSheet().selectedRange,cancel:!1,requestType:"NumberFormat"},r={range:this.parent.getActiveSheet().name+"!"+t.range,format:t.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",t),this.parent.notify(G,{eventArgs:t,action:"format"}),t.cancel||(this.parent.notify("applyNumber",t),this.parent.notify("selectionComplete",{type:"mousedown"}),this.refreshNumFormatSelection(e.item.text),this.parent.notify(W,{eventArgs:r,action:"format"}))},e.prototype.tBarDdbBeforeOpen=function(e,t,r){void 0===r&&(r=0);var n=this.parent.viewport.height,i=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-r)+2*parseInt(getComputedStyle(e).paddingTop,10);if(r){var a=getComputedStyle(e.querySelector(".e-separator"));i+=r*(parseInt(a.borderBottomWidth,10)+2*parseInt(a.marginTop,10))}i>n?(e.style.height=n+"px",e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY="")},e.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),r=0,n=t.length;r<n;r++)this.numPopupWidth<t[r].offsetWidth&&(this.numPopupWidth=t[r].offsetWidth);var i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=i+"px"},e.prototype.previewNumFormat=function(e){var t=n(this.parent.getActiveSheet().activeCell),r=lt(t[0],t[1],this.parent.getActiveSheet()),i={type:e.item.text,formattedText:"",value:r&&r.value?r.value:"",format:N(e.item.text),sheetIndex:this.parent.activeSheetIndex,onLoad:!0},a=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="",this.parent.notify("getFormattedCell",i);var s=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:i.formattedText.toString()});a.appendChild(s),e.element.appendChild(a)},e.prototype.refreshRibbonContent=function(e){if(this.ribbon){sf.base.isNullOrUndefined(e)&&(e=this.ribbon.selectedTab);var t=this.parent.serviceLocator.getService(Mn),r=this.parent.getActiveSheet();switch(this.ribbon.items[e].header.text){case t.getConstant("Home"):this.refreshHomeTabContent(n(r.activeCell));break;case t.getConstant("Insert"):case t.getConstant("Formulas"):break;case t.getConstant("Data"):this.refreshDataTabContent(e);break;case t.getConstant("View"):this.refreshViewTabContent(e)}}},e.prototype.refreshHomeTabContent=function(e){sf.base.isNullOrUndefined(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=sf.base.getComponent(document.getElementById(this.parent.element.id+"_number_format"),sf.splitbuttons.DropDownButton));var r=this.parent.getActiveSheet(),i=n(this.parent.getActiveSheet().activeCell),a=this.parent.serviceLocator.getService(Mn),s=lt(i[0],i[1],this.parent.getActiveSheet())||{},o=D(s.format?s.format:"General");if(this.numFormatDDB&&(r.isProtected&&!r.protectSettings.formatCells?(o="General",this.refreshNumFormatSelection(o)):this.refreshNumFormatSelection(a.getConstant(o))),this.fontNameDdb&&(r.isProtected&&!r.protectSettings.formatCells?this.refreshFontNameSelection("Calibri"):this.refreshFontNameSelection(this.getCellStyleValue("fontFamily",e))),this.fontSizeDdb){var l=this.getCellStyleValue("fontSize",e);r.isProtected&&!r.protectSettings.formatCells?this.fontSizeDdb.content="11":(l=l.includes("pt")?l.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=l,this.fontSizeDdb.dataBind())}if(this.textAlignDdb){var h=this.getCellStyleValue("textAlign",e);if(r.isProtected&&!r.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else void 0===s.value||"left"!==h||"Accounting"!==o&&!x(s.value)||(h="right"),(l="e-icons e-"+h.toLowerCase()+"-icon")!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=l,this.textAlignDdb.dataBind())}if(this.verticalAlignDdb){l="e-icons e-"+this.getCellStyleValue("verticalAlign",e).toLowerCase()+"-icon";r.isProtected&&!r.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":l!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=l,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(e),!r.isProtected&&(s.rowSpan>1||s.colSpan>1))this.enableToolbarItems([{tab:a.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!0);else{var d=t(r.selectedRange);this.enableToolbarItems([{tab:a.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:d[0]!==d[2]||d[1]!==d[3]}]),this.toggleActiveState(!1)}},e.prototype.toggleActiveState=function(e){var t=this.parent.serviceLocator.getService(Mn);this.parent.getActiveSheet().isProtected||(e?(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):(this.mergeSplitBtn.element.classList.contains("e-active")&&this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))},e.prototype.refreshToggleBtn=function(e){var t,r,n,i=this,a=this.parent.getActiveSheet(),s=this.parent.element.id,o=lt(e[0],e[1],a),l=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach((function(h,d){(t=document.getElementById(s+"_"+h))&&(a.isProtected&&!a.protectSettings.formatCells?t.classList.remove("e-active"):"wrap"===h?n=o&&o.wrap:(r=i.getCellStyleValue(l[d],e).toLowerCase(),n=r.indexOf(h)>-1),n?t.classList.add("e-active"):t.classList.contains("e-active")&&t.classList.remove("e-active"))}))},e.prototype.refreshFontNameSelection=function(e){if(e!==this.fontNameDdb.items[this.fontNameIndex].text){this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",this.fontNameDdb.items[this.fontNameIndex].iconCss="",this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}}},e.prototype.refreshNumFormatSelection=function(e){this.parent.serviceLocator.getService(Mn);for(var t=0;t<this.numFormatDDB.items.length;t++)""!==this.numFormatDDB.items[t].iconCss&&(this.numFormatDDB.items[t].iconCss=""),this.numFormatDDB.items[t].text===e&&(this.numFormatDDB.items[t].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0)},e.prototype.fileMenuItemSelect=function(e){var t=this,r=sf.base.extend({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",r);var n=this.parent.element.id;if(!r.cancel)switch(e.item.id){case n+"_Open":sf.base.select("#"+n+"_fileUpload",this.parent.element).click();break;case n+"_Xlsx":case n+"_Xls":case n+"_Csv":this.parent.save({saveType:e.item.id.split(n+"_")[1]});break;case n+"_New":var i=this.parent.serviceLocator.getService(Pn);i.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Mn).getConstant("DestroyAlert"),beforeOpen:function(e){var r={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),_r(t.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Mn).getConstant("Ok"),isPrimary:!0},click:function(){t.parent.sheets.length=0,t.parent.createSheet(),i.hide(),t.parent.activeSheetIndex=t.parent.sheets.length-1,t.parent.notify("refreshSheetTabs",{}),t.parent.notify("sheetsDestroyed",{}),t.parent.renderModule.refreshSheet()}}]})}},e.prototype.toolbarClicked=function(e){if("spreadsheet_find"!==e.item.id){var t=this.parent.element.id,r=this.parent.getActiveSheet();switch(e.item.id){case t+"_headers":var n={isShow:!r.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1};if(this.parent.notify(W,{eventArgs:n,action:"headers"}),n.cancel)return;this.parent.setSheetPropertyOnMute(r,"showHeaders",!r.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab}),_r(this.parent.element);break;case t+"_gridlines":var i={isShow:!r.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1};if(this.parent.notify(W,{eventArgs:i,action:"gridLines"}),i.cancel)return;this.parent.setSheetPropertyOnMute(r,"showGridLines",!r.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab}),_r(this.parent.element);break;case t+"_protect":this.parent.setSheetPropertyOnMute(r,"isProtected",!r.isProtected);var a=!1;a=!r.isProtected,this.parent.notify("applyProtect",{isActive:a,id:t+"_protect"});break;case t+"_undo":this.parent.notify("performUndoRedo",{isUndo:!0});break;case t+"_redo":this.parent.notify("performUndoRedo",{isUndo:!1})}this.parent.notify("ribboClick",e)}},e.prototype.toggleRibbonItems=function(e){var t=this.parent.serviceLocator.getService(Mn).getConstant("View"),r=this.parent.serviceLocator.getService(Mn).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===t){if(sf.base.isNullOrUndefined(e.activeTab))for(var n=0,i=this.ribbon.items.length;n<i;n++)if(this.ribbon.items[n].header.text===t){e.activeTab=n;break}var a=this.getLocaleText(e.props,!0),s=this.parent.element.id+"_"+e.props.toLowerCase(),o=this.ribbon.items[e.activeTab].content.length;for(n=void 0;n<o;n++)"Separator"!==this.ribbon.items[e.activeTab].content[n].type&&this.ribbon.items[e.activeTab].content[n].id===s&&(this.ribbon.items[e.activeTab].content[n].text=a,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===t&&this.updateToggleText(e.props.toLowerCase(),a)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===r){if(sf.base.isNullOrUndefined(e.activeTab)){n=0;for(var l=this.ribbon.items.length;n<l;n++)if(this.ribbon.items[n].header.text===r){e.activeTab=n;break}}for(a=this.getLocaleProtectText("Sheet",!0),s=this.parent.element.id+"_"+e.props.toLowerCase(),o=this.ribbon.items[e.activeTab].content.length,n=void 0;n<o;n++)"Separator"!==this.ribbon.items[e.activeTab].content[n].type&&this.ribbon.items[e.activeTab].content[n].id===s&&(this.ribbon.items[e.activeTab].content[n].text=a,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===r&&this.updateToggleText(e.props.toLowerCase(),a)}},e.prototype.enableFileMenuItems=function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)},e.prototype.hideRibbonTabs=function(e){this.ribbon.hideTabs(e.tabs,e.hide)},e.prototype.addRibbonTabs=function(e){this.ribbon.addTabs(e.items,e.insertBefore),sf.base.select(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder(sf.base.selectAll(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])},e.prototype.updateToggleText=function(e,t){var r=this;ir((function(){sf.base.select("#"+r.parent.element.id+"_"+e+" .e-tbar-btn-text",r.ribbon.element).textContent=t}))},e.prototype.refreshViewTabContent=function(e){for(var t,r=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id===r+"_headers"){if(this.updateViewTabContent(e,"Headers",n),t)break;t=!0}if(this.ribbon.items[e].content[n].id===r+"_gridlines"){if(this.updateViewTabContent(e,"GridLines",n),t)break;t=!0}}},e.prototype.updateViewTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Mn);n["show"+t]?this.ribbon.items[e].content[r].text===i.getConstant("Show"+t)&&this.updateShowHideBtn("Hide",t,r,e):this.ribbon.items[e].content[r].text===i.getConstant("Hide"+t)&&this.updateShowHideBtn("Show",t,r,e)},e.prototype.updateShowHideBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Mn).getConstant(e+t);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText(t.toLowerCase(),i)},e.prototype.refreshDataTabContent=function(e){for(var t,r=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type&&this.ribbon.items[e].content[n].id===r+"_protect"){if(this.updateDataTabContent(e,"Sheet",n),t)break;t=!0}},e.prototype.updateDataTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Mn);n.isProtected?this.ribbon.items[e].content[r].text===i.getConstant("Protect"+t)&&(this.ribbon.items[e].content[r].cssClass="e-active",this.updateProtectBtn("Unprotect",t,r,e)):this.updateProtectBtn("Protect",t,r,e)},e.prototype.updateProtectBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Mn).getConstant(e+t);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",i)},e.prototype.addToolbarItems=function(e){this.ribbon.addToolbarItems(e.tab,e.items,e.index)},e.prototype.enableToolbarItems=function(e){var t=this;e.forEach((function(e){t.ribbon.enableItems(e.tab||t.ribbon.items[t.ribbon.selectedTab].header.text,e.items,e.enable)}))},e.prototype.createMobileView=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("div",{className:"e-header-toolbar"}),n=this.parent.createElement("ul");r.appendChild(n);var i=new sf.navigations.Toolbar({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:n,align:"Right",id:t+"file_menu"}],clicked:function(r){switch(r.item.id){case t+"focused_tick":e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()}},created:function(){var t=new sf.navigations.Menu({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(n)}});i.createElement=this.parent.createElement,i.appendTo(r),this.parent.element.insertBefore(r,this.parent.element.firstElementChild),this.renderMobileToolbar()},e.prototype.renderMobileToolbar=function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),r=this.parent.createElement("div"),n=this.parent.createElement("button");t.appendChild(r),t.appendChild(n),t.style.display="block",this.parent.element.appendChild(t);var i=new sf.splitbuttons.DropDownButton({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],select:function(t){t.item.text!==i.content&&(a.element.style.display="none",i.content=t.item.text,i.dataBind(),a.items=e.ribbon.items[i.items.indexOf(t.item)+1].content,a.width="calc(100% - "+n.getBoundingClientRect().width+"px)",a.element.style.display="",a.dataBind(),a.items[0].text=t.item.text,a.dataBind())},open:function(e){var t=e.element.parentElement,r=t.getBoundingClientRect(),n=sf.popups.calculatePosition(i.element,"right","bottom");t.style.left=n.left-r.width+"px",t.style.top=n.top-r.height+"px";for(var a=0;a<i.items.length;a++)if(i.content===i.items[a].text){e.element.children[a].classList.add("e-selected");break}},close:function(){return _r(e.parent.element)}});i.createElement=this.parent.createElement,i.appendTo(n);var a=new sf.navigations.Toolbar({width:"calc(100% - "+n.getBoundingClientRect().width+"px)",items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});a.createElement=this.parent.createElement,a.appendTo(r),t.style.display=""},e.prototype.fileMenuBeforeOpen=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Mn),i=[".xlsx",".xls",".csv"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach((function(e,n){t=r.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="",t.appendChild(r.parent.createElement("span",{className:"e-extension",innerHTML:i[n]})),e.appendChild(t)})),this.parent.trigger("fileMenuBeforeOpen",e)},e.prototype.enableRibbonTabs=function(e){this.ribbon.enableTabs(e.tabs,e.enable)},e.prototype.fileMenuBeforeClose=function(e){this.parent.trigger("fileMenuBeforeClose",e)},e.prototype.hideFileMenuItems=function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)},e.prototype.addFileMenuItems=function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)},e.prototype.hideToolbarItems=function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)},e.prototype.protectSheetHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(Mn);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]),this.parent.notify("setUndoRedo",null)):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),t.isProtected&&t.protectSettings.insertLink||!t.isProtected?this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),t.isProtected&&t.protectSettings.selectCells||!t.isProtected?this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!1}]),t.isProtected?(this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:!0}]))},e.prototype.updateMergeItem=function(e){if("mousemove"===e.type||"pointermove"===e.type||e.shiftKey&&"mousedown"===e.type){var r=t(this.parent.getActiveSheet().selectedRange);r[1]===r[3]&&r[0]===r[2]||this.parent.getActiveSheet().isProtected||(this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(Mn).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!1))}},e.prototype.addEventListener=function(){this.parent.on("ribbon",this.initRibbon,this),this.parent.on("enableToolbarItems",this.enableToolbarItems,this),this.parent.on("activeCellChanged",this.refreshRibbonContent,this),this.parent.on("updateToggleItem",this.toggleRibbonItems,this),this.parent.on("enableFileMenuItems",this.enableFileMenuItems,this),this.parent.on("hideRibbonTabs",this.hideRibbonTabs,this),this.parent.on("addRibbonTabs",this.addRibbonTabs,this),this.parent.on("addToolbarItems",this.addToolbarItems,this),this.parent.on("hideFileMenuItems",this.hideFileMenuItems,this),this.parent.on("addFileMenuItems",this.addFileMenuItems,this),this.parent.on("hideToolbarItems",this.hideToolbarItems,this),this.parent.on("enableRibbonTabs",this.enableRibbonTabs,this),this.parent.on("protectCellFormat",this.protectSheetHandler,this),this.parent.on("selectionComplete",this.updateMergeItem,this),this.parent.on("refreshRibbonIcons",this.refreshRibbonContent,this)},e.prototype.destroy=function(){var e=this.parent.element,t=this.ribbon.element,r=e.id;["bold","italic","line-through","underline"].forEach((function(t){Rr(sf.base.select("#"+r+"_"+t,e),sf.buttons.Button)})),this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker.destroy(),this.colorPicker=null,this.bordersMenu.destroy(),this.bordersMenu=null,this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb.destroy(),this.findDdb=null,this.chartDdb.destroy(),this.chartDdb=null,this.chartMenu.destroy(),this.chartMenu=null,this.parent.notify("destroyRibbonComponents",null),this.ribbon.destroy(),t&&sf.base.detach(t),this.ribbon=null,this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("ribbon",this.initRibbon),this.parent.off("enableToolbarItems",this.enableToolbarItems),this.parent.off("activeCellChanged",this.refreshRibbonContent),this.parent.off("updateToggleItem",this.toggleRibbonItems),this.parent.off("enableFileMenuItems",this.enableFileMenuItems),this.parent.off("hideRibbonTabs",this.hideRibbonTabs),this.parent.off("addRibbonTabs",this.addRibbonTabs),this.parent.off("addToolbarItems",this.addToolbarItems),this.parent.off("hideFileMenuItems",this.hideFileMenuItems),this.parent.off("addFileMenuItems",this.addFileMenuItems),this.parent.off("hideToolbarItems",this.hideToolbarItems),this.parent.off("enableRibbonTabs",this.enableRibbonTabs),this.parent.off("protectCellFormat",this.protectSheetHandler),this.parent.off("selectionComplete",this.updateMergeItem),this.parent.off("refreshRibbonIcons",this.refreshRibbonContent))},e}(),vn=function(){function e(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formulaBar"},e.prototype.createFormulaBar=function(e){if(this.parent.showFormulaBar||!this.insertFnRipple){var t=this.parent.serviceLocator.getService(Mn),r=this.parent.element.id,n=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var i=this.parent.createElement("input",{id:r+"_name_box",attrs:{type:"text"}});n.appendChild(i),this.comboBoxInstance=new sf.dropdowns.ComboBox({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:function(e){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(i),this.comboBoxInstance.element.parentElement.title=t.getConstant("NameBox")}n.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:t.getConstant("InsertFunction")}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=sf.base.rippleEffect(n,{selector:".e-insert-function"}),n.appendChild(this.parent.createElement("div",{className:"e-separator"}));var a=n.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:r+"_formula_input",attrs:{title:t.getConstant("FormulaBar"),spellcheck:"false"}}));a.rows=1,this.parent.isMobileView()?(a.placeholder=t.getConstant("MobileFormulaBarPlaceHolder"),sf.base.EventHandler.add(a,"focus",this.textAreaFocusIn,this),sf.base.EventHandler.add(a,"blur",this.textAreaFocusOut,this)):n.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:t.getConstant("ExpandFormulaBar")}})),e&&e.uiUpdate?this.parent.element.insertBefore(n,document.getElementById(r+"_sheet_panel")):this.parent.element.appendChild(n)}else this.destroy()},e.prototype.textAreaFocusIn=function(e){var t=this.parent.element.querySelector(".e-formula-bar-panel"),r=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit"});r.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),t.classList.add("e-focused"),t.appendChild(r)},e.prototype.textAreaFocusOut=function(e){var t=this.parent.element.querySelector(".e-formula-bar-panel");t.classList.remove("e-focused"),sf.base.detach(t.querySelector(".e-formula-submit"))},e.prototype.keyDownHandler=function(e){var t=e.target;if(this.parent.isEdit&&!this.parent.getActiveSheet().isProtected){if(($e(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&16===e.keyCode)return;t.classList.contains("e-formula-bar")&&this.parent.notify(H,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,r),r.editedValue!==t.value&&16!==e.keyCode&&this.parent.notify(H,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},e.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()},e.prototype.nameBoxBlur=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())},e.prototype.nameBoxSelect=function(e){if(e.isInteracted){var t=e.itemData.refersTo.substr(1),r=xt(this.parent,It(t)),n=h(t),i=kt(this.parent,r);if(-1!==n.indexOf(":")){var s=n.indexOf(":"),o=n.substr(0,s),l=n.substr(s+1,n.length);o=o.replace("$",""),(l=l.replace("$","")).match(/\D/g)&&!l.match(/[0-9]/g)&&o.match(/\D/g)&&!o.match(/[0-9]/g)?n=(o+="1")+":"+(l+=i.rowCount):!l.match(/\D/g)&&l.match(/[0-9]/g)&&!o.match(/\D/g)&&o.match(/[0-9]/g)&&(n=(o=a(parseInt(o,10)-1,0))+":"+(l=a(parseInt(l,10)-1,i.colCount-1)))}r===this.parent.activeSheetIndex?(this.parent.selectRange(n),_r(this.parent.element)):(Rt(this.parent,n,i),this.parent.activeSheetIndex=r)}},e.prototype.formulaBarUpdateHandler=function(e){var r,n=this,i=this.parent.getActiveSheet().selectedRange.split(":"),a=new sf.base.Internationalization;if("mousemove"===e.type||"pointermove"===e.type){var s=t(i[0]),o=t(i[1]);r=Math.abs(s[0]-o[0])+1+"R x "+(Math.abs(s[1]-o[1])+1)+"C",this.parent.isEdit&&this.parent.notify("editValue",null)}else{r=i[0],this.parent.getData(Ot(this.parent)+"!"+r).then((function(e){var i,s="";e.forEach((function(e,o){var l=e&&e.format?D(e.format):"General";e&&(sf.base.isNullOrUndefined(e.value)||(i=C(Number(e.value)),s="Invalid Date"===i.toString()||"ShortDate"!==l&&"LongDate"!==l?"Invalid Date"!==i.toString()&&"Time"===l?a.formatDate(i,{type:"dateTime",skeleton:"yMd"})+" "+a.formatDate(i,{type:"dateTime",skeleton:"hms"}):e.value:a.formatDate(i,{type:"date",skeleton:"yMd"})),e.formula&&(s=e.formula));var h={action:"getCurrentEditValue",editedValue:""};n.parent.notify(H,h);var d=h.editedValue&&0===h.editedValue.toString().indexOf("=")||$e(h.editedValue),p=document.getElementById(n.parent.element.id+"_formula_input"),c=t(r),u=n.parent.getCell(c[0],c[1]);e&&!e.formula&&u?p.value=u.textContent:p.value=s,sf.base.isNullOrUndefined(s)||d||n.parent.notify(H,{action:"refreshEditor",value:p.value,refreshEditorElem:!0}),n.parent.isEdit&&n.parent.notify("editValue",null)}))}))}this.updateComboBoxValue(r)},e.prototype.UpdateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},e.prototype.updateComboBoxValue=function(e){var t=this.parent.getActiveSheet(),r={action:"getNameFromRange",range:Ot(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify("formulaOperation",r),r.definedName&&(e=r.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},e.prototype.disabletextarea=function(){var e=this.getFormulaBar();this.parent.getActiveSheet().isProtected?e.disabled=!0:e.disabled=!1},e.prototype.formulaBarScrollEdit=function(){var e=t(this.parent.getActiveSheet().selectedRange),r=n(this.parent.getActiveSheet().topLeftCell);e[0]<r[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(H,{action:"startEdit",refreshCurPos:!1})},e.prototype.formulaBarClickHandler=function(e){var t=this,r=e.target;if(r.classList.contains("e-drop-icon")&&sf.base.closest(r,".e-formula-bar-panel"))this.toggleFormulaBar(r);else if(r.classList.contains("e-formula-bar"))this.parent.isEdit||this.parent.getActiveSheet().isProtected?this.parent.getActiveSheet().isProtected&&this.parent.notify("editAlert",null):this.formulaBarScrollEdit();else if(r.parentElement&&r.parentElement.classList.contains("e-name-box"))if(r.classList.contains("e-ddl-icon")){var n={action:"getNames",names:[]};this.parent.notify("formulaOperation",n),this.comboBoxInstance.dataSource=n.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!sf.base.isNullOrUndefined(r.offsetParent)&&(r.offsetParent.classList.contains("e-insert-function")||r.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.offsetParent.id||this.parent.element.id+"_insert_function"===r.id||r.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.parentElement.id)){if(this.parent.getActiveSheet().isProtected)return void this.parent.notify("editAlert",null);var i=!this.parent.isEdit,a={action:"getCurrentEditValue",editedValue:""};if(!i){n={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify("formulaOperation",n),i=n.isFormulaEdit,this.parent.notify(H,a)}if(i||""===a.editedValue){""===a.editedValue&&this.parent.notify(H,{action:"refreshEditor",value:"="});var s=this.parent.serviceLocator.getService(Mn),o=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),l=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:s.getConstant("PickACategory")}),h=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),d=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),p=this.parent.createElement("div",{className:"e-description-content",innerHTML:s.getConstant("Description")}),c=this.parent.createElement("div",{className:"e-header-content",innerHTML:s.getConstant("InsertFunction")}),u={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(k,u),this.categoryCollection=u.categoryCollection,this.categoryList=new sf.dropdowns.DropDownList({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});var f={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(k,f),this.formulaCollection=f.formulaCollection,this.formulaList=new sf.lists.ListView({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:c.outerHTML,content:l.outerHTML+h.outerHTML+d.outerHTML+p.outerHTML+o.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(e){var r={dialogName:"InsertFunctionDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),_r(t.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:s.getConstant("Ok"),isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),sf.base.EventHandler.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this)}}},e.prototype.toggleFormulaBar=function(e){var t=e.parentElement,r=this.parent.serviceLocator.getService(Mn);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=r.getConstant("ExpandFormulaBar")):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=r.getConstant("CollapseFormulaBar")),this.parent.setPanelSize()},e.prototype.dialogOpen=function(){this.focusOkButton()},e.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,e),"="===e.editedValue.toString().trim()&&this.parent.notify(H,{action:"refreshEditor",value:""})},e.prototype.dialogBeforeClose=function(){sf.base.EventHandler.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementById("_dialog-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")},e.prototype.selectFormula=function(e,t){var r=t.formulaList.getSelectedItems().text,n=kt(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(H,{action:"refreshEditor",value:r+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(H,{action:"startEdit",value:"="+r+"(",address:n.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+r+"("})),e.hide()},e.prototype.listSelected=function(){this.updateFormulaDescription()},e.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},e.prototype.dropDownSelect=function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(k,t),this.formulaCollection=t.formulaCollection;else{var r={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(k,r),this.formulaCollection=r.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},e.prototype.focusOkButton=function(){document.getElementById("_dialog-content").nextElementSibling.firstElementChild.focus()},e.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list").children[0].children[0].firstElementChild;this.formulaList.selectItem(e)},e.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,t={action:"getFormulaDescription",description:"",selectedList:e};this.parent.notify(k,t),this.focusOkButton(),e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,document.getElementById(this.parent.element.id+"_description_content").innerHTML=this.parent.serviceLocator.getService(Mn).getConstant(e)},e.prototype.formulaClickHandler=function(e){var t=e.target,r=kt(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(H,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(H,{action:"startEdit",value:"="+t.innerText+"(",address:r.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())},e.prototype.addEventListener=function(){this.parent.on("formulaBar",this.createFormulaBar,this),this.parent.on(M,this.formulaBarClickHandler,this),this.parent.on(_,this.keyDownHandler,this),this.parent.on(P,this.keyUpHandler,this),this.parent.on("selectionComplete",this.formulaBarUpdateHandler,this),this.parent.on("mouseUpAfterSelection",this.UpdateValueAfterMouseUp,this),this.parent.on("formulaBarOperation",this.editOperationHandler,this),this.parent.on("enableFormulaInput",this.disabletextarea,this),this.parent.on("isFormulaBarEdit",this.isFormulaBarEdit,this)},e.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&sf.base.detach(e)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("formulaBar",this.createFormulaBar),this.parent.off(M,this.formulaBarClickHandler),this.parent.off(_,this.keyDownHandler),this.parent.off(P,this.keyUpHandler),this.parent.off("selectionComplete",this.formulaBarUpdateHandler),this.parent.off("mouseUpAfterSelection",this.UpdateValueAfterMouseUp),this.parent.off("formulaBarOperation",this.editOperationHandler),this.parent.off("enableFormulaInput",this.disabletextarea),this.parent.off("isFormulaBarEdit",this.isFormulaBarEdit))},e.prototype.editOperationHandler=function(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=sf.base.isUndefined(e.value)?"":e.value;break;case"getPosition":e.position=this.getFormulaBar().getBoundingClientRect()}},e.prototype.isFormulaBarEdit=function(e){this.parent.isEdit&&this.isGoto?e.isEdit=!0:e.isEdit=!1},e.prototype.getFormulaBar=function(){return sf.base.select("#"+this.parent.element.id+"_formula_input",this.parent.element)},e}(),yn=function(){function e(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.keyCodes={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formula"},e.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&this.autocompleteInstance.element.remove()),this.autocompleteInstance=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on("formulaOperation",this.performFormulaOperation,this),this.parent.on(P,this.keyUpHandler,this),this.parent.on(_,this.keyDownHandler,this),this.parent.on(M,this.formulaClick,this),this.parent.on("refreshFormulaDatasource",this.refreshFormulaDatasource,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("formulaOperation",this.performFormulaOperation),this.parent.off(P,this.keyUpHandler),this.parent.off(_,this.keyDownHandler),this.parent.off(M,this.formulaClick),this.parent.off("refreshFormulaDatasource",this.refreshFormulaDatasource))},e.prototype.performFormulaOperation=function(e){var t=this;switch(e.action){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=Ot(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":var r=this.parent.serviceLocator.getService(Mn);this.parent.serviceLocator.getService(Pn).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("CircularReference"),beforeOpen:function(e){var r={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),e.argValue="0"}},e.prototype.renderAutoComplete=function(){if(!sf.base.select("#"+this.parent.element.id+"_ac",this.parent.element)){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var t={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(k,t);var r={dataSource:t.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new sf.dropdowns.AutoComplete(r,e),this.autocompleteInstance.createElement=this.parent.createElement}},e.prototype.onSuggestionOpen=function(e){var t=this;this.isPopupOpened=!0;var r=this.getPopupPosition();e.popup.offsetX=r.left,e.popup.offsetY=r.top+r.height,e.popup.refreshPosition(),e.popup.element.firstChild.style.maxHeight="180px",new Promise((function(e,t){setTimeout((function(){e()}),100)})).then((function(){t.triggerKeyDownEvent(t.keyCodes.DOWN)}))},e.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},e.prototype.onSelect=function(e){var t="="+e.itemData.value+"(";if(this.isSubFormula){var r=this.getEditingValue(),n=r.lastIndexOf(this.getArgumentSeparator());(n>-1||(n=r.lastIndexOf("("))>-1)&&(t=r.slice(0,n+1)),t+=e.itemData.value+"("}this.parent.notify(H,{action:"refreshEditor",value:t,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar})},e.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},e.prototype.refreshFormulaDatasource=function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(k,e),this.autocompleteInstance.dataSource=e.formulaCollection},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=$e(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==this.keyCodes.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()},e.prototype.keyDownHandler=function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case this.keyCodes.UP:case this.keyCodes.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case this.keyCodes.TAB:e.preventDefault(),this.triggerKeyDownEvent(this.keyCodes.ENTER)}}else{var r=e.target;if(r.id===this.parent.element.id+"_name_box")switch(t){case this.keyCodes.ENTER:this.addDefinedName({name:r.value}),_r(this.parent.element);break;case this.keyCodes.ESC:_r(this.parent.element)}}},e.prototype.formulaClick=function(e){if(this.parent.isEdit){var t=e.target;this.isFormulaBar=t.classList.contains("e-formula-bar")}},e.prototype.refreshFormulaSuggestion=function(e,t){if(t.length>0){var r=this.autocompleteInstance.element,n=e.keyCode,i=this.isPopupOpened;this.isNavigationKey(n)||(r.value=t,r.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("keyup")),i&&this.triggerKeyDownEvent(this.keyCodes.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},e.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=sf.base.select("#"+this.parent.element.id+"_ac_popup");e&&sf.base.detach(e),this.isPopupOpened=!1}},e.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},e.prototype.getSuggestionKeyFromFormula=function(e){var t="";if(e=e.substr(1)){var r=e.lastIndexOf("("),n=(e=e.substr(r+1)).split(this.getArgumentSeparator());1===n.length?(t=n[0],this.isSubFormula=r>-1):(t=n[n.length-1],this.isSubFormula=!0);var i=t.match(/\w/);(!i||i&&0!==i.index)&&(t="")}return t},e.prototype.getPopupPosition=function(){var e={position:null};return this.isFormulaBar?(e.action="getPosition",this.parent.notify("formulaBarOperation",e)):(e.action="getPosition",this.parent.notify(H,e)),e.position},e.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(H,e),e.editedValue},e.prototype.isNavigationKey=function(e){return e===this.keyCodes.UP||e===this.keyCodes.DOWN||e===this.keyCodes.LEFT||e===this.keyCodes.RIGHT},e.prototype.triggerKeyDownEvent=function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var r=new Event("keydown");r.keyCode=e,r.which=e,r.altKey=!1,r.shiftKey=!1,r.ctrlKey=!1,t.dispatchEvent(r)},e.prototype.getArgumentSeparator=function(){if(this.argumentSeparator)return this.argumentSeparator;var e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(k,e),this.argumentSeparator=e.argumentSeparator,e.argumentSeparator},e.prototype.getNames=function(e){return this.parent.definedNames.filter((function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e}))},e.prototype.getNameFromRange=function(e){var t=e.slice(0,e.indexOf(":")),r=e.slice(e.indexOf("!")+1).split(":"),n=r.length>1&&r[0]===r[1],i=this.parent.definedNames.filter((function(r,i){return!(!n||r.refersTo!=="="+t)||r.refersTo==="="+e}));return i&&i[0]},e.prototype.addDefinedName=function(e){var t=this,r=e.name,i=!1;if(!e.refersTo){var a=kt(this.parent,this.parent.activeSheetIndex),s=Ot(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s;var o=a.selectedRange;if(!sf.base.isNullOrUndefined(o)){var l=o.indexOf(":"),h=o.substr(0,l),d=o.substr(l+1,o.length);parseInt(d.replace(/\D/g,""),10)===a.rowCount&&1===parseInt(h.replace(/\D/g,""),10)?(d=d.replace(/[0-9]/g,""),o="$"+(h=h.replace(/[0-9]/g,""))+":$"+d):n(d)[1]===a.colCount-1&&0===n(h)[1]?(d=d.replace(/\D/g,""),o="$"+(h=h.replace(/\D/g,""))+":$"+d):o=h===d?h:o}e.refersTo=s+"!"+o,e.scope="Workbook"}if(r.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(r)){var p={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(k,p),i=p.isAdded,p.isAdded||this.parent.serviceLocator.getService(Pn).show({content:this.parent.serviceLocator.getService(Mn).getConstant("DefineNameExists"),width:"300",beforeOpen:function(e){var r={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(Pn).show({content:this.parent.serviceLocator.getService(Mn).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(e){var r={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}});return i},e}(),Cn=function(){function e(e){this.aggregateContent="",this.isSelectCancel=!1,this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"sheetTabs"},e.prototype.createSheetTabs=function(){var e=this;if(this.parent.showSheetTabs||!this.tabInstance){var t=this.parent.serviceLocator.getService(Mn),r=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),n=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:t.getConstant("AddSheet")}});n.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),n.addEventListener("click",this.addSheetTab.bind(this)),n.disabled=!this.parent.allowInsert,r.appendChild(n),this.addBtnRipple=sf.base.rippleEffect(r,{selector:".e-add-sheet-tab"});var i=this.parent.createElement("button",{attrs:{title:t.getConstant("ListAllSheets")}});r.appendChild(i),this.parent.element.appendChild(r);var a=this.getSheetTabItems();this.dropDownInstance=new sf.splitbuttons.DropDownButton({iconCss:"e-icons",items:a.ddbItems,beforeItemRender:function(t){var r=e.parent.sheets[e.dropDownInstance.items.indexOf(t.item)];"Hidden"===r.state?t.element.classList.add("e-hide"):"VeryHidden"===r.state&&(t.element.style.display="none")},select:function(t){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(t.item)})},beforeOpen:function(t){return e.beforeOpenHandler(e.dropDownInstance,t.element)},open:function(t){return e.openHandler(e.dropDownInstance,t.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return _r(e.parent.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(i);var s=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new sf.navigations.Tab({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:a.tabItems,scrollStep:250,selecting:function(t){var r={currentSheetIndex:t.selectingIndex,previousSheetIndex:t.selectedIndex,cancel:!1};e.isSelectCancel||e.parent.notify(G,{eventArgs:r,action:"gotoSheet"}),e.isSelectCancel=r.cancel},selected:function(t){if(t.selectedIndex!==t.previousIndex)if(e.parent.isEdit&&e.parent.endEdit(),e.isSelectCancel)e.tabInstance.selectedItem=t.previousIndex,e.tabInstance.dataBind(),_r(e.parent.element);else{e.parent.activeSheetIndex=t.selectedIndex,e.parent.dataBind(),e.updateDropDownItems(t.selectedIndex,t.previousIndex),_r(e.parent.element);var r={previousSheetIndex:t.previousIndex,currentSheetIndex:t.selectedIndex};e.parent.notify(W,{eventArgs:r,action:"gotoSheet"});var n={action:"registerGridInCalc",sheetID:(t.selectedIndex+1).toString()};e.parent.notify(k,n)}},created:function(){var t=e.tabInstance.element.querySelector(".e-toolbar-items");t.classList.add("e-sheet-tabs-items"),sf.base.EventHandler.add(t,"dblclick",e.renameSheetTab,e)}}),r.appendChild(s),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(s),sf.base.EventHandler.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var o=a.tabItems.length,l=0;l<o;l++){var h={action:"addSheet",sheetName:"Sheet"+(l+1),index:l+1,visibleName:Ot(this.parent,l)};this.parent.notify(k,h)}this.parent.notify(k,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null)}else this.destroy()},e.prototype.updateDropDownItems=function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},e.prototype.beforeOpenHandler=function(e,t){var r=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>r&&(t.style.height=r+"px",t.style.overflowY="auto"),t.parentElement.style.visibility="hidden"},e.prototype.openHandler=function(e,t,r){var n,i=t.parentElement;if(-1===sf.popups.isCollide(i).indexOf("bottom")){n="auto"===t.style.overflowY?this.parent.viewport.height:i.getBoundingClientRect().height;var a=sf.popups.calculatePosition(e.element,r,"top");"right"===r&&(a.left-=i.getBoundingClientRect().width),i.style.left=a.left+"px",i.style.top=a.top-n+"px"}i.style.visibility=""},e.prototype.getSheetTabItems=function(){var e,t=this,r=[],n=[];return this.parent.sheets.forEach((function(i,a){e=Ot(t.parent,a),r.push({header:{text:e},cssClass:"Visible"===i.state?"":"e-hide"}),n.push({text:e,iconCss:a===t.parent.activeSheetIndex?"e-selected-icon e-icons":""})})),{tabItems:r,ddbItems:n}},e.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()},e.prototype.addSheetTab=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(H,e);var t=e.editedValue;!!($e(t)||t&&""!==t)&&t.indexOf("=");this.parent.notify("insertModel",{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),_r(this.parent.element)},e.prototype.insertSheetTab=function(e){e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var t=e.startIdx;t<=e.endIdx;t++){var r=this.parent.sheets[t].name;this.dropDownInstance.items.splice(t,0,{text:r}),this.tabInstance.addTab([{header:{text:r},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem&&this.refreshSheetTab():this.updateSheetTab({idx:e.startIdx})},e.prototype.updateSheetTab=function(e){"activeSheetChanged"===e.name?e.idx=this.parent.skipHiddenSheets(e.idx):"Hidden"===this.parent.sheets[e.idx].state&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[e.idx],"state","Visible"),this.tabInstance.items[e.idx].cssClass="",this.tabInstance.items=this.tabInstance.items,this.tabInstance.dataBind()),this.tabInstance.selectedItem=e.idx,this.tabInstance.dataBind(),this.parent.notify("protectSheet",null)},e.prototype.switchSheetTab=function(e){var t=sf.base.closest(e.event.target,".e-toolbar-item");if(t){for(var r=t.querySelector(".e-tab-text").textContent,n=0,i=this.tabInstance.items.length;n<i;n++)if(this.tabInstance.items[n].header.text===r){this.parent.activeSheetIndex!==n&&this.updateSheetTab({idx:n});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id===this.parent.element.id+"_cmenu_insert_sheet"&&(1===this.skipHiddenSheets()&&(e.element.children[1].classList.add("e-disabled"),e.element.children[3].classList.add("e-disabled")),this.parent.allowInsert||e.element.children[0].classList.add("e-disabled"),this.parent.allowDelete||e.element.children[1].classList.add("e-disabled"))}},e.prototype.skipHiddenSheets=function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach((function(t){"Visible"!==t.state&&--e})),e},e.prototype.renameSheetTab=function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var t=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,r={eventArgs:{name:t,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};this.parent.trigger("actionBegin",r);var n=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+e.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:t,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(n),sf.base.EventHandler.add(document,"mousedown touchstart",this.renameInputFocusOut,this),sf.base.EventHandler.add(n,"input",this.updateWidth,this),n.focus(),n.setSelectionRange(0,t.length),sf.base.EventHandler.remove(sf.base.closest(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},e.prototype.updateWidth=function(e){var t=e.target,r=t.value.length,n=t.value.split(" ");if(n.length){var i=n.length-1;r-=i,r+=.5*i}t.style.width=r+"ch"},e.prototype.renameInputFocusOut=function(e){var t=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!t.classList.contains("e-sheet-rename")&&!sf.base.closest(t,".e-dlg-container")){if(t=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(t),void _r(this.parent.element);var r=t.value,n=this.parent.serviceLocator.getService(Mn);if(r){var i=this.tabInstance.selectedItem;if(r.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(t,n.getConstant("SheetRenameInvalidAlert"));else{if(this.tabInstance.items[i].header.text!==r)for(var a=0,s=this.parent.sheets.length;a<s;a++)if(a!==this.parent.activeSheetIndex&&this.parent.sheets[a].name.toLowerCase()===r.toLowerCase())return void this.showRenameDialog(t,n.getConstant("SheetRenameAlreadyExistsAlert"));var o=this.removeRenameInput(t);this.tabInstance.items[i].header.text!==r&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[i],"name",r),this.updateSheetName({value:r,idx:i,items:o})),("keydown"===e.type||sf.base.closest(e.target,".e-spreadsheet"))&&_r(this.parent.element)}}else this.showRenameDialog(t,n.getConstant("SheetRenameEmptyAlert"));var l=this.parent.getActiveSheet().id,h={action:"renameUpdation",value:r,sheetId:l};this.parent.notify(k,h);var d={index:l,value:r};this.parent.notify(W,{eventArgs:d,action:"renameSheet"})}},e.prototype.updateSheetName=function(e){this.tabInstance.items[e.idx].header.text=e.value,this.dropDownInstance.items[e.idx].text=e.value,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.value.indexOf("  ")>-1?(this.tabInstance.setProperties({items:this.tabInstance.items},!0),e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent=e.value):(this.tabInstance.items=this.tabInstance.items,this.tabInstance.dataBind())},e.prototype.hideSheet=function(){this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"state","Hidden"),this.tabInstance.items[this.parent.activeSheetIndex].cssClass="e-hide",this.tabInstance.items=this.tabInstance.items,this.tabInstance.dataBind(),this.tabInstance.selectedItem=this.parent.skipHiddenSheets(this.parent.activeSheetIndex===this.parent.sheets.length-1?this.parent.activeSheetIndex-1:this.parent.activeSheetIndex+1),this.tabInstance.dataBind()},e.prototype.removeRenameInput=function(e){var t=e.parentElement.querySelector(".e-tab-text"),r=sf.base.closest(e,".e-toolbar-items");return sf.base.EventHandler.add(r,"dblclick",this.renameSheetTab,this),sf.base.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut),sf.base.EventHandler.remove(e,"input",this.updateWidth),sf.base.remove(e),t.style.display="",r},e.prototype.showRenameDialog=function(e,t){var r=this;this.parent.serviceLocator.getService(Pn).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(t){var n={dialogName:"SheetRenameDialog",element:t.element,target:t.target,cancel:t.cancel};r.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),e.focus()},close:function(){return e.setSelectionRange(0,e.value.length)}})},e.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},e.prototype.removeSheetTab=function(e){var t=this;if(!e.count||e.count!==this.parent.sheets.length){var r=this.parent.serviceLocator.getService(Mn);if(this.skipHiddenSheets()>1){var n=e.sheetName?kt(this.parent,xt(this.parent,e.sheetName)):this.parent.getActiveSheet(),i=e.index||xt(this.parent,n.name),a={index:i,sheetCount:this.parent.sheets.length,sheetName:n.name};if(!(!n.rows||!n.rows.length)&&(1!==n.rows.length||!(!n.rows[0].cells||!n.rows[0].cells.length))){var s=this.parent.serviceLocator.getService(Pn);e.clicked?this.forceDelete(i):s.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("DeleteSheetAlert"),beforeOpen:function(e){var r={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),_r(t.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){s.hide(),t.forceDelete(i),t.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(a.sheetCount=t.parent.sheets.length,t.parent.notify(W,{eventArgs:a,action:"removeSheet"}))}}]})}else{var o={action:"deleteSheetTab",sheetName:"",index:i+1};this.parent.notify(k,o),this.destroySheet(i),this.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(a.sheetCount=this.parent.sheets.length,this.parent.notify(W,{eventArgs:a,action:"removeSheet"}))}}else this.parent.serviceLocator.getService(Pn).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(e){var r={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),_r(t.parent.element)}})}},e.prototype.forceDelete=function(e){var t={action:"deleteSheetTab",sheetName:"",index:e+1};this.parent.notify(k,t),this.destroySheet(e)},e.prototype.destroySheet=function(e){var t=e||this.parent.activeSheetIndex;this.parent.removeSheet(t),this.parent.notify("sheetsDestroyed",{sheetIndex:t}),this.dropDownInstance.items.splice(t,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(t);var r=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=r,this.parent.setProperties({activeSheetIndex:r},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=r,this.tabInstance.dataBind(),this.updateDropDownItems(r),this.parent.notify("protectSheet",null),_r(this.parent.element)},e.prototype.showAggregate=function(){var e=this;if(!f(t(this.parent.getActiveSheet().selectedRange))){var r={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify("aggregateComputation",r),r.Count>1){this.aggregateContent=r.countOnly?"Count":this.selaggregateCnt,r.countOnly&&(this.aggregateContent="Count",delete r.Sum,delete r.Avg,delete r.Min,delete r.Max);var n=r.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete r.countOnly;var i=this.aggregateContent,a=i+": "+r[i];if(this.aggregateDropDown)this.updateAggregateContent(a,r);else{var s=this.parent.createElement("button");document.getElementById(this.parent.element.id+"_sheet_tab_panel").appendChild(s),this.aggregateDropDown=new sf.splitbuttons.DropDownButton({content:a,items:this.getAggregateItems(r),select:function(t){return e.updateAggregateContent(t.item.text,r,!0)},beforeOpen:function(t){return e.beforeOpenHandler(e.aggregateDropDown,t.element)},open:function(t){return e.openHandler(e.aggregateDropDown,t.element,"right")},close:function(){return _r(e.parent.element)},cssClass:n}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(s)}}else this.removeAggregate()}},e.prototype.getAggregateItems=function(e){var t,r,n=this,i=[];return Object.keys(e).forEach((function(a){"aggregateComputation"!==e[a]&&(t=a+": "+e[a],r=a===n.aggregateContent?"e-selected-icon e-icons":"",i.push({text:t,iconCss:r}))})),i},e.prototype.updateAggregateContent=function(e,t,r){this.aggregateContent=e.split(": ")[0],r&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)},e.prototype.removeAggregate=function(){sf.base.isNullOrUndefined(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),sf.base.remove(this.aggregateDropDown.element),this.aggregateDropDown=null)},e.prototype.addEventListener=function(){this.parent.on("sheetTabs",this.createSheetTabs,this),this.parent.on("refreshSheetTabs",this.refreshSheetTab,this),this.parent.on("insertSheetTab",this.insertSheetTab,this),this.parent.on("removeSheetTab",this.removeSheetTab,this),this.parent.on("renameSheetTab",this.renameSheetTab,this),this.parent.on(U,this.switchSheetTab,this),this.parent.on("activeSheetChanged",this.updateSheetTab,this),this.parent.on("renameSheet",this.renameInputFocusOut,this),this.parent.on("activeCellChanged",this.removeAggregate,this),this.parent.on("verticalScroll",this.focusRenameInput,this),this.parent.on("horizontalScroll",this.focusRenameInput,this),this.parent.on("sheetNameUpdate",this.updateSheetName,this),this.parent.on("hideSheet",this.hideSheet,this),this.parent.on("showAggregate",this.showAggregate,this)},e.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.aggregateDropDown=null,this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,sf.base.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&sf.base.remove(e),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("sheetTabs",this.createSheetTabs),this.parent.off("refreshSheetTabs",this.refreshSheetTab),this.parent.off("insertSheetTab",this.insertSheetTab),this.parent.off("removeSheetTab",this.removeSheetTab),this.parent.off("renameSheetTab",this.renameSheetTab),this.parent.off(U,this.switchSheetTab),this.parent.off("activeSheetChanged",this.updateSheetTab),this.parent.off("renameSheet",this.renameInputFocusOut),this.parent.off("activeCellChanged",this.removeAggregate),this.parent.off("verticalScroll",this.focusRenameInput),this.parent.off("horizontalScroll",this.focusRenameInput),this.parent.off("sheetNameUpdate",this.updateSheetName),this.parent.off("hideSheet",this.hideSheet),this.parent.off("showAggregate",this.showAggregate))},e}(),bn=function(){function e(e){this.parent=e,this.addEventListener(),this.renderFileUpload()}return e.prototype.addEventListener=function(){this.parent.on("openSuccess",this.openSuccess,this),this.parent.on("openFailure",this.openFailed,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("openSuccess",this.openSuccess),this.parent.off("openFailure",this.openFailed))},e.prototype.renderFileUpload=function(){var e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.fileSelect.bind(this),t.onerror=this.openFailed.bind(this),t.style.display="none"},e.prototype.fileSelect=function(e){var t=e.target.files[0];if(!(t&&t.length<1)){var r={file:t};this.parent.open(r),document.getElementById(this.parent.element.id+"_fileUpload").value=""}},e.prototype.openSuccess=function(e){var t=this;if(["UnsupportedFile","InvalidUrl"].indexOf(e.data)>-1)return this.parent.serviceLocator.getService(Pn).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),void this.parent.hideSpinner();this.parent.element&&(this.parent.trigger("openComplete",{response:e}),this.parent.notify(W,{response:e,action:"import"}),this.parent.renderModule.refreshSheet(),this.parent.notify("refreshSheetTabs",this),this.parent.hideSpinner())},e.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"open"},e}(),Sn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("beginSave",this.initiateSave,this),this.parent.on("saveCompleted",this.saveCompleted,this),this.parent.on("saveError",this.showErrorDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("beginSave",this.initiateSave),this.parent.off("saveCompleted",this.saveCompleted),this.parent.off("saveError",this.showErrorDialog))},e.prototype.getModuleName=function(){return"save"},e.prototype.initiateSave=function(e){this.parent.showSpinner()},e.prototype.saveCompleted=function(e){this.parent.hideSpinner()},e.prototype.showErrorDialog=function(e){var t=this;this.parent.serviceLocator.getService(Pn).show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return _r(t.parent.element)}})},e}(),xn=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.initContextMenu(),this.addEventListener()},e.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new sf.navigations.ContextMenu({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this)},e)},e.prototype.beforeCloseHandler=function(e){this.parent.trigger("contextMenuBeforeClose",e)},e.prototype.selectHandler=function(e){var r=sf.base.extend({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",r);var i=this.parent.element.id+"_cmenu";if(!r.cancel){this.parent.serviceLocator.getService(Mn);var a=void 0;switch(e.item.id){case i+"_cut":this.parent.notify(V,{isAction:!0,promise:Promise});break;case i+"_copy":this.parent.notify("copy",{isAction:!0,promise:Promise});break;case i+"_paste":this.parent.notify(j,{isAction:!0,isInternal:!0});break;case i+"_pastevalues":this.parent.notify(j,{type:"Values",isAction:!0,isInternal:!0});break;case i+"_pasteformats":this.parent.notify(j,{type:"Formats",isAction:!0,isInternal:!0});break;case i+"_rename":this.parent.notify("renameSheetTab",{});break;case i+"_delete_sheet":this.parent.notify("removeSheetTab",{});break;case i+"_insert_sheet":this.parent.notify("insertModel",{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0});break;case i+"_hide_sheet":this.parent.notify("hideSheet",null);break;case i+"_ascending":this.parent.notify("applySort",null);break;case i+"_descending":this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:"Descending"}}});break;case i+"_customsort":this.parent.notify("initiateCustomSort",null);break;case i+"_filtercellvalue":this.parent.notify("filterByCellValue",null);break;case i+"_clearfilter":var s=o(n(this.parent.getActiveSheet().activeCell)[1]+1);this.parent.notify("clearFilter",{field:s});break;case i+"_reapplyfilter":this.parent.notify("reapplyFilter",null);break;case i+"_hide_row":a=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(q,{startIndex:a[0],endIndex:a[2],hide:!0,isCol:!1,actionUpdate:!0}),_r(this.parent.element);break;case i+"_unhide_row":a=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(q,{startIndex:a[0],endIndex:a[2],hide:!1,isCol:!1,actionUpdate:!0}),_r(this.parent.element);break;case i+"_hide_column":a=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(q,{startIndex:a[1],endIndex:a[3],hide:!0,isCol:!0,actionUpdate:!0}),_r(this.parent.element);break;case i+"_unhide_column":a=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(q,{startIndex:a[1],endIndex:a[3],hide:!1,isCol:!0,actionUpdate:!0}),_r(this.parent.element);break;case i+"_insert_row_above":case i+"_delete_row":a=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(i.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:a[0],end:a[2],modelType:"Row",isAction:!0,insertType:"above"}),_r(this.parent.element);break;case i+"_insert_row_below":a=c(t(this.parent.getActiveSheet().selectedRange)),this.parent.notify("insertModel",{model:this.parent.getActiveSheet(),start:a[2]+1,end:a[2]+1+(a[2]-a[0]),modelType:"Row",isAction:!0,insertType:"below"}),_r(this.parent.element);break;case i+"_insert_column_before":case i+"_delete_column":a=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(i.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:a[1],end:a[3],modelType:"Column",isAction:!0}),_r(this.parent.element);break;case i+"_insert_column_after":a=c(t(this.parent.getActiveSheet().selectedRange)),this.parent.notify("insertModel",{model:this.parent.getActiveSheet(),start:a[3]+1,end:a[3]+1+(a[3]-a[1]),modelType:"Column",isAction:!0}),_r(this.parent.element);break;case i+"_hyperlink":this.parent.notify("initiateHyperlink",null);break;case i+"_editHyperlink":this.parent.notify("editHyperlink",null);break;case i+"_openHyperlink":this.parent.notify("openHyperlink",null);break;case i+"_removeHyperlink":this.parent.removeHyperlink(this.parent.getActiveSheet().selectedRange);break;case i+"_protect":var l=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(l,"isProtected",!l.isProtected);var h=void 0;h=!l.isProtected,this.parent.notify("applyProtect",{isActive:h})}}},e.prototype.getInsertModel=function(e,t){for(var r=[],n=e;n<=t;n++)n===e?r.push({index:n}):r.push({});return r},e.prototype.beforeOpenHandler=function(e){var t,r=this.getTarget(e.event.target);if(e.element.classList.contains("e-contextmenu")?(t=this.getDataSource(r),this.contextMenuInstance.items=t,this.contextMenuInstance.dataBind()):t=e.items,("ColumnHeader"===r||"RowHeader"===r)&&e.element&&e.element.childElementCount>0){var n="ColumnHeader"===r?e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_row"),i="ColumnHeader"===r?e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&n.classList.contains("e-disabled")?n.classList.remove("e-disabled"):this.parent.allowInsert||n.classList.contains("e-disabled")||n.classList.add("e-disabled"),this.parent.allowDelete&&i.classList.contains("e-disabled")?i.classList.remove("e-disabled"):this.parent.allowDelete||i.classList.contains("e-disabled")||i.classList.add("e-disabled")}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(U,sf.base.extend(e,{target:r,items:t}))},e.prototype.getTarget=function(e){return sf.base.closest(e,".e-sheet-content")?"Content":sf.base.closest(e,".e-column-header")?"ColumnHeader":sf.base.closest(e,".e-row-header")?"RowHeader":sf.base.closest(e,".e-sheet-tabs-items")?"Footer":sf.base.closest(e,".e-selectall-container")?"SelectAll":""},e.prototype.getDataSource=function(e){var r=this.parent.serviceLocator.getService(Mn),n=[],i=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(n,r,i),n.push({separator:!0}),this.setFilterItems(n,i),this.setSortItems(n,i),n.push({separator:!0}),this.setHyperLink(n,i);else if("RowHeader"===e){this.setClipboardData(n,r,i);var a=t(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(n,r,"Row",i,[a[0],a[2]],["Above","Below"]),this.setHideShowItems(n,r,"Row",i,[a[0],a[2]])}else if("ColumnHeader"===e){this.setClipboardData(n,r,i);a=t(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(n,r,"Column",i,[a[1],a[3]],["Before","After"]),this.setHideShowItems(n,r,"Column",i,[a[1],a[3]])}else"SelectAll"===e?(this.setClipboardData(n,r,i),this.setFilterItems(n,i),this.setSortItems(n,i)):"Footer"===e&&(n.push({text:r.getConstant("Insert"),id:i+"_insert_sheet"}),n.push({text:r.getConstant("Delete"),iconCss:"e-icons e-delete",id:i+"_delete_sheet"}),n.push({text:r.getConstant("Rename"),id:i+"_rename"}),n.push({text:r.getConstant("Hide"),id:i+"_hide_sheet"}),this.setProtectSheetItems(n,i));return n},e.prototype.setProtectSheetItems=function(e,t){var r=this.parent.serviceLocator.getService(Mn);this.parent.getActiveSheet().isProtected?e.push({text:r.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:r.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})},e.prototype.setFilterItems=function(e,t){if(this.parent.allowFiltering){var r=this.parent.serviceLocator.getService(Mn),n={clearFilterText:null,isFiltered:!1};this.parent.notify("getFilteredColumn",n),e.push({text:r.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:r.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:r.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}},e.prototype.setSortItems=function(e,t){var r=this.parent.serviceLocator.getService(Mn);this.parent.allowSorting&&e.push({text:r.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})},e.prototype.setHyperLink=function(e,t){var r=this.parent.getActiveSheet();if(this.parent.allowHyperlink){var n=this.parent.serviceLocator.getService(Mn);!document.activeElement.getElementsByClassName("e-hyperlink")[0]&&!document.activeElement.classList.contains("e-hyperlink")||r.isProtected&&!r.protectSettings.insertLink?e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:t+"_hyperlink"}):e.push({text:n.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:t+"_editHyperlink"},{text:n.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:t+"_openHyperlink"},{text:n.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:t+"_removeHyperlink"})}},e.prototype.setClipboardData=function(e,t,r){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:r+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:r+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:r+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:r+"_pastespecial",items:[{text:t.getConstant("Values"),id:r+"_pastevalues"},{text:t.getConstant("Formats"),id:r+"_pasteformats"}]}))},e.prototype.setInsertDeleteItems=function(e,t,r,n,i,a){e.push({separator:!0}),["Insert","Delete"].forEach((function(s){i[0]===i[1]?e.push({text:t.getConstant(""+s+r),id:n+"_"+s.toLowerCase()+"_"+r.toLowerCase()}):e.push({text:t.getConstant(""+s+r+"s"),id:n+"_"+s.toLowerCase()+"_"+r.toLowerCase()}),"Insert"===s&&(e[e.length-1].items=[],a.forEach((function(r){e[e.length-1].items.push({text:t.getConstant(r),id:e[e.length-1].id+"_"+r.toLowerCase()})})))}))},e.prototype.setHideShowItems=function(e,t,r,n,i){i[0]===i[1]?e.push({text:t.getConstant("Hide"+r),id:n+"_hide_"+r.toLowerCase()}):e.push({text:t.getConstant("Hide"+r+"s"),id:n+"_hide_"+r.toLowerCase()}),this.parent.hiddenCount(i[0],i[1],r.toLowerCase()+"s")&&e.push({text:t.getConstant("UnHide"+r+"s"),id:n+"_unhide_"+r.toLowerCase()})},e.prototype.addEventListener=function(){this.parent.on("addContextMenuItems",this.addItemsHandler,this),this.parent.on("removeContextMenuItems",this.removeItemsHandler,this),this.parent.on("enableContextMenuItems",this.enableItemsHandler,this)},e.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},e.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},e.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("addContextMenuItems",this.addItemsHandler),this.parent.off("removeContextMenuItems",this.removeItemsHandler),this.parent.off("enableContextMenuItems",this.enableItemsHandler))},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&sf.base.detach(e),this.parent=null},e}(),wn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshCellElement=function(e){var t=this.parent.getCell(e.rowIndex,e.colIndex);sf.base.isNullOrUndefined(t)||this.parent.refreshNode(t,e)},e.prototype.addEventListener=function(){this.parent.on("refreshCellElem",this.refreshCellElement,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("refreshCellElem",this.refreshCellElement)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"numberFormat"},e}(),In=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("applySort",this.applySortHandler,this),this.parent.on("sortComplete",this.sortCompleteHandler,this),this.parent.on("initiateCustomSort",this.initiateCustomSortHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applySort",this.applySortHandler),this.parent.off("sortComplete",this.sortCompleteHandler),this.parent.off("initiateCustomSort",this.initiateCustomSortHandler))},e.prototype.getModuleName=function(){return"sort"},e.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),t=c(l(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)},e.prototype.sortRangeAlertHandler=function(e){var t=this;this.parent.serviceLocator.getService(Pn).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(e){var r={dialogName:"SortRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()},e.prototype.initiateCustomSortHandler=function(){var e=this,t=this.parent.serviceLocator.getService(Mn);if(this.isValidSortRange()){var r=this.parent.serviceLocator.getService(Pn);r.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:t.getConstant("CustomSort"),beforeOpen:function(t){var n={dialogName:"CustomSortDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.customSortContent(),r.dialogInstance.dataBind(),_r(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){var t=r.dialogInstance.content,n=t.getElementsByClassName("e-list-sort e-listview e-lib")[0],i=sf.base.getComponent(n,"listview").dataSource;e.clearError();var a=t.getElementsByClassName("e-sort-error")[0];if(a.style.display="block",!e.validateError(i,t,a)){r.hide();var s=t.getElementsByClassName("e-sort-checkheader")[0],o=sf.base.getComponent(s,"checkbox"),l=sf.base.getComponent(t.getElementsByClassName("e-sort-checkcase")[0],"checkbox"),h=o.checked;e.applySortHandler({sortOptions:{sortDescriptors:i,containsHeader:h,caseSensitive:l.checked}})}}}]})}else this.sortRangeAlertHandler({error:t.getConstant("SortOutOfRangeError")})},e.prototype.validateError=function(e,t,r){var n=this.parent.serviceLocator.getService(Mn);if(e.some((function(e){return""===e.field.toString()})))return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),(function(e){var t=!sf.base.getComponent(e,"dropdownlist").value;return t&&e.parentElement.classList.add("e-error"),t})),r.innerText=n.getConstant("SortEmptyFieldError"),!0;var i=new Set,a="",s=e.some((function(e){return a=e.field.toString(),i.size===i.add(e.field).size})),o="";if(s){var l=0;return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),(function(e){var t=sf.base.getComponent(e,"dropdownlist");return t.value===a&&(e.parentElement.classList.add("e-error"),o=t.text,l++),2===l})),r.innerHTML="<strong>"+o+"</strong>"+n.getConstant("SortDuplicateFieldError"),!0}return!1},e.prototype.customSortContent=function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),t=this.getFields(),r=sf.base.getUniqueID("customSort"),n=this.getCustomListview(r);this.setHeaderTab(e,n,t);var i=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(i);var a=this.parent.createElement("div",{className:"e-list-sort",styles:""});i.appendChild(a),n.createElement=this.parent.createElement,n.appendTo(a),this.renderListItem(r,n,!0,t);var s=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(s),e},e.prototype.getFields=function(){var e=this.parent.getActiveSheet(),t=c(l(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]==0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;var r={filterRange:[],hasFilter:!1};this.parent.notify("getFilterRange",r),r.hasFilter&&r.filterRange&&(t[0]=r.filterRange[0])}var n,i=[];for(t[1];t[1]<=t[3];t[1]++){var a=lt(t[0],t[1],e);if(a&&a.value){var s={formattedText:a.value,value:a.value,format:a.format,onLoad:!0};a.format&&this.parent.notify("getFormattedCell",s),n=s.formattedText}else n="Column "+o(t[1]+1);i.push({text:n,value:"Column "+o(t[1]+1)})}return i},e.prototype.setHeaderTab=function(e,t,r){var n=this,i=this.parent.serviceLocator.getService(Mn),a=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(a);var s=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:i.getConstant("AddColumn")}),o=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");o.insertBefore(s,o.firstElementChild),s.addEventListener("click",(function(){if(t){var e=sf.base.getUniqueID("customSort");t.addItem([{id:e,text:i.getConstant("ThenBy"),field:"",order:"ascending"}]),n.renderListItem(e,t,l.checked,r,!0)}}));var l=new sf.buttons.CheckBox({label:i.getConstant("ContainsHeader"),checked:!0,change:function(t){var n=t.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),(function(e){var t=sf.base.getComponent(e,"dropdownlist");t.dataSource=null,t.dataSource=r,t.fields=n,t.dataBind()}))},cssClass:"e-sort-headercheckbox"}),h=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});a.appendChild(h),l.createElement=this.parent.createElement,l.appendTo(h);var d=new sf.buttons.CheckBox({label:i.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),p=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});a.appendChild(p),d.createElement=this.parent.createElement,d.appendTo(p)},e.prototype.getCustomListview=function(e){var t=[{id:e,text:this.parent.serviceLocator.getService(Mn).getConstant("SortBy"),field:"",order:"ascending"}];return sf.base.enableRipple(!1),new sf.lists.ListView({dataSource:t,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})},e.prototype.deleteHandler=function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",(function(){e&&t.removeItem(e)}))},e.prototype.renderListItem=function(e,t,r,n,i){var a=this,s=this.parent.serviceLocator.getService(Mn),o=t.element.querySelector("li[data-uid="+e+"]"),l=r?{text:"text",value:"value"}:{text:"value"},h=o.getElementsByClassName("e-sort-field")[0],d=new sf.dropdowns.DropDownList({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:l,placeholder:s.getConstant("SelectAColumn"),change:function(r){r.value&&(Array.prototype.some.call(t.dataSource,(function(t){return t.id===e&&(t.field=r.value.toString().replace("Column ","")),t.id===e})),a.clearError())}});d.createElement=this.parent.createElement,d.appendTo(h),i||(d.index=0);var p=o.getElementsByClassName("e-sort-order")[0],c="ascending"===p.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),u=new sf.buttons.RadioButton({label:s.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:c,cssClass:"e-sort-radiobutton",change:function(r){a.setRadioBtnValue(t,e,r.value)}}),f=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});p.appendChild(f),u.createElement=this.parent.createElement,u.appendTo(f);var g=new sf.buttons.RadioButton({label:s.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!c,cssClass:"e-sort-radiobutton",change:function(r){a.setRadioBtnValue(t,e,r.value)}}),m=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});p.appendChild(m),g.createElement=this.parent.createElement,g.appendTo(m),this.deleteHandler(o,t)},e.prototype.setRadioBtnValue=function(e,t,r){r&&Array.prototype.some.call(e.dataSource,(function(e){return e.id===t&&(e.order=r),e.id===t}))},e.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),(function(e){e.classList.remove("e-error")})))},e.prototype.applySortHandler=function(e){var t=this,r=this.parent.getActiveSheet(),n={range:e&&e.range||r.selectedRange,sortOptions:e&&e.sortOptions||{sortDescriptors:{}},cancel:!1};if(this.parent.trigger("beforeSort",n),!n.cancel){this.parent.notify(G,{eventArgs:n,action:"beforeSort"}),this.parent.showSpinner();var i=c(l(n.range)),a={filterRange:[],hasFilter:!1};i[0]===i[2]&&i[2]-i[0]==0&&(this.parent.notify("getFilterRange",a),a.hasFilter&&Qe(a.filterRange,i[0],i[1])&&(i[0]=a.filterRange[0],i[1]=0,i[2]=r.usedRange.rowIndex,i[3]=r.usedRange.colIndex,n.sortOptions.containsHeader=!0)),this.parent.sort(n.sortOptions,s(i)).then((function(e){return t.parent.trigger("sortComplete",e),t.parent.notify(W,{eventArgs:e,action:"sorting"}),Promise.resolve(e)})).catch((function(e){return t.sortRangeAlertHandler({error:e}),Promise.reject(e)}))}},e.prototype.sortCompleteHandler=function(e){var t=l(e.range);this.parent.serviceLocator.getService("cell").refreshRange(t),this.parent.hideSpinner()},e}(),En=function(){function e(e){this.parent=e,this.filterCollection=new Map,this.filterClassList=new Map,this.filterRange=new Map,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.filterRange=null,this.filterCollection=null,this.filterClassList=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on("filterRangeAlert",this.filterRangeAlertHandler,this),this.parent.on("initiateFilterUI",this.initiateFilterUIHandler,this),this.parent.on("mouseDown",this.filterMouseDownHandler,this),this.parent.on("renderFilterCell",this.renderFilterCellHandler,this),this.parent.on("clearAllFilter",this.clearAllFilterHandler,this),this.parent.on(sf.grids.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler,this),this.parent.on(sf.grids.beforeCustomFilterOpen,this.beforeCustomFilterOpenHandler,this),this.parent.on("reapplyFilter",this.reapplyFilterHandler,this),this.parent.on("filterByCellValue",this.filterByCellValueHandler,this),this.parent.on("clearFilter",this.clearFilterHandler,this),this.parent.on("getFilteredColumn",this.getFilteredColumnHandler,this),this.parent.on(U,this.cMenuBeforeOpenHandler,this),this.parent.on(sf.grids.filterCboxValue,this.filterCboxValueHandler,this),this.parent.on("getFilterRange",this.getFilterRangeHandler,this),this.parent.on("filterCellKeyDown",this.filterCellKeyDownHandler,this),this.parent.on("getFilteredCollection",this.getFilteredCollection,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("filterRangeAlert",this.filterRangeAlertHandler),this.parent.off("initiateFilterUI",this.initiateFilterUIHandler),this.parent.off("mouseDown",this.filterMouseDownHandler),this.parent.off("renderFilterCell",this.renderFilterCellHandler),this.parent.off("clearAllFilter",this.clearAllFilterHandler),this.parent.off(sf.grids.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler),this.parent.off(sf.grids.beforeCustomFilterOpen,this.beforeCustomFilterOpenHandler),this.parent.off("reapplyFilter",this.reapplyFilterHandler),this.parent.off("filterByCellValue",this.filterByCellValueHandler),this.parent.off("clearFilter",this.clearFilterHandler),this.parent.off("getFilteredColumn",this.getFilteredColumnHandler),this.parent.off(U,this.cMenuBeforeOpenHandler),this.parent.on(sf.grids.filterCboxValue,this.filterCboxValueHandler),this.parent.off("getFilterRange",this.getFilterRangeHandler),this.parent.off("filterCellKeyDown",this.filterCellKeyDownHandler),this.parent.off("getFilteredCollection",this.getFilteredCollection))},e.prototype.getModuleName=function(){return"filter"},e.prototype.isInValidFilterRange=function(e,t){var r=c(l(t||e.selectedRange));return r[0]>e.usedRange.rowIndex||r[1]>e.usedRange.colIndex},e.prototype.filterRangeAlertHandler=function(e){var t=this;this.parent.serviceLocator.getService(Pn).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(e){var r={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()},e.prototype.beforeFilterMenuOpenHandler=function(e){var t=this.parent.serviceLocator.getService(Mn);e.element.classList.add("e-spreadsheet-contextmenu");var r=e.element.querySelector("ul");this.addMenuItem(r,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(r,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(r)},e.prototype.addMenuItem=function(e,t,r,n){var i=this.parent.createElement("li",{className:r+" e-menu-item"});i.innerHTML=t,i.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),i.firstChild),e.insertBefore(i,e.firstChild)},e.prototype.initiateFilterUIHandler=function(e){var r=this,n=e?e.predicates:null,i=e.sIdx;if(i||0===i||(i=this.parent.activeSheetIndex),!(this.filterRange.size>0&&this.filterRange.has(i))||(this.removeFilter(i),n)){var a=kt(this.parent,i);if(this.isInValidFilterRange(a,e.range)){var o=this.parent.serviceLocator.getService(Mn);this.filterRangeAlertHandler({error:o.getConstant("FilterOutOfRangeError")})}else{var l=a.selectedRange,h=t(l);h[0]===h[2]&&h[1]===h[3]&&(h[0]=0,h[1]=1,h[2]=a.usedRange.rowIndex,h[3]=a.usedRange.colIndex,l=s(h));var d={range:e.range?e.range:l,filterOptions:{predicates:e.predicates},cancel:!1};if(e.isCut||this.parent.notify(G,{action:"filter",eventArgs:d}),this.processRange(a,i,e?e.range:null),n){var p=this.filterRange.get(i).slice();p[0]=p[0]+1,p[2]=a.usedRange.rowIndex,ct(this.parent,a.name+"!"+s(p),!0,!0).then((function(t){r.filterSuccessHandler(new sf.data.DataManager(t),{action:"filtering",filterCollection:n,field:n[0].field,sIdx:e.sIdx}),n.forEach((function(e){r.filterClassList.get(i)[e.field]&&r.filterClassList.get(i)[e.field].indexOf(" e-filtered")<0&&(r.filterClassList.get(i)[e.field]+=" e-filtered")})),r.refreshFilterRange(null,!1,e.sIdx)}))}e.isCut||this.parent.notify(W,{action:"filter",eventArgs:d})}}},e.prototype.processRange=function(e,t,r){var n=c(l(r||e.selectedRange));n[0]===n[2]&&n[1]===n[3]&&(n[0]=0,n[1]=0,n[2]=e.usedRange.rowIndex,n[3]=e.usedRange.colIndex),this.filterRange.set(t,n),this.filterCollection.set(t,[]),this.filterClassList.set(t,{}),this.refreshFilterRange(n,!1,t)},e.prototype.removeFilter=function(e){this.filterCollection.get(e).length&&this.parent.clearFilter();var t=this.filterRange.get(e).slice();this.filterRange.delete(e),this.filterCollection.delete(e),this.filterClassList.delete(e),this.refreshFilterRange(t,!0,e)},e.prototype.filterByCellValueHandler=function(){var e=this,t=this.parent.activeSheetIndex,r=this.parent.getActiveSheet();if(this.isInValidFilterRange(r)){var i=this.parent.serviceLocator.getService(Mn);this.filterRangeAlertHandler({error:i.getConstant("FilterOutOfRangeError")})}else{var a=n(r.activeCell);this.isFilterRange(t,a[0],a[1])||this.processRange(r,t);var l=this.filterRange.get(t).slice();l[0]=l[0]+1,l[2]=r.usedRange.rowIndex;var h=o(a[1]+1),d=this.getColumnType(r,a[1]+1,l),p=[{field:h,operator:"date"===d||"datetime"===d||"boolean"===d?"equal":"contains",value:lt(a[0],a[1],r).value,matchCase:!1,type:d}];ct(this.parent,r.name+"!"+s(l),!0,!0).then((function(t){e.filterSuccessHandler(new sf.data.DataManager(t),{action:"filtering",filterCollection:p,field:h})}))}},e.prototype.renderFilterCellHandler=function(e){var t=e.sIdx|this.parent.activeSheetIndex;if(this.filterRange.has(t)&&this.isFilterCell(t,e.rowIndex,e.colIndex)){if(!e.td)return;var r=o(e.colIndex+1);if(this.filterClassList.has(t)&&!this.filterClassList.get(t)[r]&&(this.filterClassList.get(t)[r]=""),e.td.querySelector(".e-filter-btn")){var n=e.td.querySelector(".e-filter-iconbtn");(a=sf.base.getComponent(n,"btn")).iconCss="e-icons e-filter-icon"+this.filterClassList.get(t)[r]}else{var i=this.parent.createElement("div",{className:"e-filter-btn"}),a=new sf.buttons.Button({iconCss:"e-icons e-filter-icon"+this.filterClassList.get(t)[r],cssClass:"e-filter-iconbtn"});e.td.insertBefore(i,e.td.firstChild),a.createElement=this.parent.createElement,a.appendTo(i)}}},e.prototype.refreshFilterRange=function(e,t,r){var n=r;n||0===n||(n=this.parent.activeSheetIndex);for(var i=e||this.filterRange.get(n).slice(),a=i[1];a<=i[3];a++){var s=this.parent.getCell(i[0],a);if(t){if(s&&s.hasChildNodes()){var o=s.querySelector(".e-filter-btn");o&&s.removeChild(o)}}else this.renderFilterCellHandler({td:s,rowIndex:i[0],colIndex:a,sIdx:n})}},e.prototype.isFilterCell=function(e,t,r){var n=this.filterRange.get(e);return n&&n[0]===t&&n[1]<=r&&n[3]>=r},e.prototype.isFilterRange=function(e,t,r){var n=this.filterRange.get(e);return n&&n[0]<=t&&n[2]>=t&&n[1]<=r&&n[3]>=r},e.prototype.getFilteredColumnHandler=function(e){var t=this.parent.activeSheetIndex,r=this.parent.serviceLocator.getService(Mn);if(e.clearFilterText=r.getConstant("ClearFilter"),this.filterRange.has(t)){var i=this.filterCollection.get(t);if(e.isClearAll)return void(e.isFiltered=i&&i.length>0);var a=this.filterRange.get(t).slice(),s=this.parent.getActiveSheet(),l=n(s.activeCell);if(this.isFilterRange(t,l[0],l[1])){e.field=o(l[1]+1);var h=lt(a[0],l[1],s),d=this.parent.getDisplayText(h);e.clearFilterText=r.getConstant("ClearFilterFrom")+'"'+(d?d.toString():"Column "+e.field)+'"',i.some((function(t){return e.isFiltered=t.field===e.field,e.isFiltered}))}}},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){var r={isFiltered:!1};this.getFilteredColumnHandler(r),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!r.isFiltered,!0)}},e.prototype.closeDialog=function(){var e=this.parent.element.querySelector(".e-filter-popup"),t=sf.base.getComponent(e,"dialog");t&&t.hide()},e.prototype.isPopupOpened=function(){var e=this.parent.element.querySelector(".e-filter-popup");return e&&"none"!==e.style.display},e.prototype.filterCellKeyDownHandler=function(e){var t=this.parent.activeSheetIndex,r=this.parent.getActiveSheet(),i=n(r.activeCell);if(this.isFilterCell(t,i[0],i[1])){e.isFilterCell=!0;var a=ur(r,i),s=this.parent.getCell(i[0],i[1]);this.isPopupOpened()&&this.closeDialog(),this.openDialog(s,a.left,a.top)}else e.isFilterCell=!1},e.prototype.filterMouseDownHandler=function(e){var t=e.target;if(t.classList.contains("e-filter-icon")){if(this.isPopupOpened())return void this.closeDialog();this.openDialog(t,e.x,e.y)}else this.isPopupOpened()&&(t.classList.contains("e-searchinput")||t.classList.contains("e-searchclear")||!t.offsetParent||t.offsetParent.classList.contains("e-filter-popup")?this.selectSortItemHandler(t):this.closeDialog())},e.prototype.openDialog=function(e,t,r){var n=this,i=sf.grids.parentsUntil(e,"e-cell"),a=parseInt(i.getAttribute("aria-colindex"),10),l=o(a);this.parent.showSpinner();var h=this.parent.activeSheetIndex,d=this.filterRange.get(h).slice(),p=this.parent.getActiveSheet(),c=lt(d[0],a-1,p),u=this.parent.getDisplayText(c);d[0]=d[0]+1,d[2]=p.usedRange.rowIndex,ct(this.parent,p.name+"!"+s(d),!0,!0).then((function(i){var s;i.some((function(e,t){return e&&(s=new sf.data.DataManager(i.slice(t))),!!e}));var o={type:n.getColumnType(p,a,d),field:l,displayName:u||"Column "+l,dataSource:s,height:n.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:n.filterCollection.get(h),column:{field:l,filter:{}},handler:n.filterSuccessHandler.bind(n,new sf.data.DataManager(i)),target:e,position:{X:t,Y:r},localeObj:n.parent.serviceLocator.getService(Mn)};new sf.grids.ExcelFilterBase(n.parent,n.getLocalizedCustomOperators()).openDialog(o),n.parent.hideSpinner()}))},e.prototype.filterCboxValueHandler=function(e){if(e.column&&e.data){var t=e.column.field;if(e.value){var r=n(t+e.data.dataObj.__rowIndex),i=lt(r[0],r[1],this.parent.getActiveSheet());i&&i.format&&(e.value=this.parent.getDisplayText(i))}}},e.prototype.selectSortItemHandler=function(e){var t=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if(t){var r=this.parent.getActiveSheet(),n=this.parent.activeSheetIndex,i=this.filterRange.get(n).slice();i[0]=i[0]+1,i[2]=r.usedRange.rowIndex,this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}},range:s(i)});for(var a=o(l(r.activeCell)[1]+1),h=0,d=Object.keys(this.filterClassList.get(n));h<d.length;h++){var p=d[h],c=this.filterClassList.get(n)[p].replace(/\se-sortasc-filter|\se-sortdesc-filter/gi,"");p===a&&(c+="Ascending"===t?" e-sortasc-filter":" e-sortdesc-filter"),this.filterClassList.get(n)[p]=c}this.refreshFilterRange(),this.closeDialog()}},e.prototype.filterSuccessHandler=function(e,t){var r=t.sIdx;r||0===r||(r=this.parent.activeSheetIndex);for(var n=this.filterCollection.get(r),i=new sf.data.DataManager(n),a=new sf.data.Query,o=i.executeLocal(a.where("field","equal",t.field)),l=0;l<o.length;l++){for(var h=-1,d=0;d<n.length;d++)if(n[d].field===o[l].field){h=d;break}-1!==h&&n.splice(h,1)}"filtering"===t.action?(n=n.concat(t.filterCollection)).length&&this.filterClassList.get(r)[t.field].indexOf(" e-filtered")<0&&(this.filterClassList.get(r)[t.field]+=" e-filtered"):this.filterClassList.get(r)[t.field]=this.filterClassList.get(r)[t.field].replace(" e-filtered",""),this.filterCollection.set(r,n);var p={datasource:e,predicates:this.getPredicates(r)};this.filterRange.get(r)[2]=kt(this.parent,r).usedRange.rowIndex,this.applyFilter(p,s(this.filterRange.get(r)))},e.prototype.applyFilter=function(e,t){var r=this,n={range:t,filterOptions:e,cancel:!1};this.parent.trigger("beforeFilter",n),n.cancel||(this.parent.showSpinner(),this.parent.filter(e,t).then((function(e){return r.refreshFilterRange(),r.parent.hideSpinner(),r.parent.trigger("filterComplete",e),Promise.resolve(e)})).catch((function(e){return r.filterRangeAlertHandler({error:e}),Promise.reject(e)})))},e.prototype.getPredicates=function(e){for(var t=[],r=sf.grids.CheckBoxFilterBase.getPredicate(this.filterCollection.get(e)),n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];t.push(r[a])}return t},e.prototype.getColumnType=function(e,t,r){for(var n=0,i=0,a=0,s=r[0];s<=e.usedRange.rowIndex;s++){var o=lt(s,t-1,e);if(o)if(o.format)switch(D(o.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":n++;break;case"shortdate":case"longdate":a++;break;case"time":n++;break;default:i++}else"string"==typeof o.value?i++:n++;else i++}return n>i&&n>a&&n>0?"number":i>n&&i>a&&i>0?"string":a>n&&a>i&&a>0?"date":"datetime"},e.prototype.beforeCustomFilterOpenHandler=function(){this.closeDialog()},e.prototype.clearAllFilterHandler=function(){if(this.filterRange.has(this.parent.activeSheetIndex)){this.filterCollection.set(this.parent.activeSheetIndex,[]);for(var e=0,t=Object.keys(this.filterClassList.get(this.parent.activeSheetIndex));e<t.length;e++){var r=t[e];this.filterClassList.get(this.parent.activeSheetIndex)[r]=""}this.refreshFilterRange()}},e.prototype.clearFilterHandler=function(e){this.filterSuccessHandler(null,{action:"clear-filter",filterCollection:[],field:e.field})},e.prototype.reapplyFilterHandler=function(){var e=this.parent.activeSheetIndex;this.filterRange.has(e)&&this.applyFilter({predicates:this.getPredicates(e)},s(this.filterRange.get(e)))},e.prototype.getFilterRangeHandler=function(e){var t=e.sheetIdx;this.filterRange&&this.filterRange.has(t)?(e.hasFilter=!0,e.filterRange=this.filterRange.get(t)):(e.hasFilter=!1,e.filterRange=null)},e.prototype.getLocalizedCustomOperators=function(){var e=this.parent.serviceLocator.getService(Mn),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}},e.prototype.getFilteredCollection=function(){for(var e,t=this.parent.sheets.length,r=[],i=0;i<t;i++){var a={sheetIdx:i,filterRange:void 0,hasFilter:void 0};if(this.getFilterRangeHandler(a),a.hasFilter){for(var o=[],l=[],h=[],d=[],p=this.filterCollection.get(a.sheetIdx),c=0;c<p.length;c++)if(p[c].field&&p[c].operator){var u=n(p[c].field+"1")[1];o.push(u),l.push(p[c].operator),h.push(p[c].value),d.push(p[c].type)}var f=s(a.filterRange);e={sheetIdx:a.sheetIdx,filterRange:f,hasFilter:a.hasFilter,column:o,criteria:l,value:h,dataType:d},r.push(e)}}e&&(this.parent.filterCollection=r)},e}(),Rn=function(){function e(e){this.pictureCount=1,this.parent=e,this.addEventListener(),this.renderImageUpload()}return e.prototype.addEventListener=function(){this.parent.on("insertImage",this.insertImage,this),this.parent.on("refreshImgElem",this.refreshImgElem,this),this.parent.on("refreshImgCellObj",this.refreshImgCellObj,this),this.parent.on("createImageElement",this.createImageElement,this),this.parent.on("deleteImage",this.deleteImage,this),this.parent.on("refreshImagePosition",this.refreshInsDelImagePosition,this)},e.prototype.renderImageUpload=function(){var e=this.parent.element.id+"_imageUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.imageSelect.bind(this),t.style.display="none"},e.prototype.imageSelect=function(e){var t=e.target.files[0];if(!(t&&t.length<1)){var r={file:t};0===r.file.type.indexOf("image")?this.insertImage(r):this.parent.serviceLocator.getService(Pn).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),document.getElementById(this.parent.element.id+"_imageUpload").value=""}},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("insertImage",this.insertImage),this.parent.off("refreshImgCellObj",this.refreshImgCellObj),this.parent.off("createImageElement",this.createImageElement),this.parent.off("deleteImage",this.deleteImage),this.parent.off("refreshImagePosition",this.refreshInsDelImagePosition))},e.prototype.insertImage=function(e,t){var r=this;this.binaryStringVal(e).then((function(e){return r.createImageElement({options:{src:e},range:t,isPublic:!0})}))},e.prototype.binaryStringVal=function(e){return new Promise((function(t,r){var n=new FileReader;n.readAsDataURL(e.file),n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)}}))},e.prototype.createImageElement=function(e){var r=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,n=e.range&&e.range.indexOf("!")>0?xt(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,i=this.parent.serviceLocator.getService(_n),a=e.options.imageId?e.options.imageId:this.parent.element.id+"_overlay_picture_"+this.pictureCount,s=t(r),o=n?this.parent.sheets[n]:this.parent.getActiveSheet();if(!document.getElementById(a)){var l={requestType:"beforeInsertImage",range:o.name+"!"+r,imageData:e.options.src,sheetIndex:n};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:l,action:"beforeInsertImage"}),!l.cancel){var h=i.insertOverlayElement(a,r,n);h.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(h.style.height=e.options.height+"px",h.style.width=e.options.width+"px",h.style.top=e.options.top+"px",h.style.left=e.options.left+"px"),e.options.imageId||this.pictureCount++;var d={src:e.options.src,id:a,height:parseFloat(h.style.height.replace("px","")),width:parseFloat(h.style.width.replace("px","")),top:parseFloat(h.style.top.replace("px","")),left:parseFloat(h.style.left.replace("px",""))};this.parent.setUsedRange(s[0],s[1]),(e.isPublic||e.isUndoRedo)&&this.parent.notify("setImage",{options:[d],range:o.name+"!"+r});var p=lt(s[0],s[1],o);p.image[p.image.length-1].id||(p.image[p.image.length-1].id=d.id),l={requestType:"insertImage",range:o.name+"!"+r,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:a,sheetIndex:n},!e.isUndoRedo&&e.isPublic&&this.parent.notify("actionComplete",{eventArgs:l,action:"insertImage"})}}},e.prototype.refreshImgElem=function(){var e=document.getElementsByClassName("e-ss-overlay-active")[0];e&&sf.base.removeClass([e],"e-ss-overlay-active")},e.prototype.refreshInsDelImagePosition=function(e){for(var t,r,n,i=e.count,a=e.sheetIdx,s=this.parent.sheets[a],o=lt(e.rowIdx,e.colIdx,s),l=o.image.length,h=0;h<l;h++)t=document.getElementById(o.image[h].id),r="Row"===e.type?"insert"===e.status?o.image[h].top+20*i:o.image[h].top-20*i:o.image[h].top,n="Column"===e.type?"insert"===e.status?o.image[h].left+64*i:o.image[h].left-64*i:o.image[h].left,o.image[h].top=r,o.image[h].left=n,t.style.top=r+"px",t.style.left=n+"px"},e.prototype.refreshImgCellObj=function(e){var t={clientY:e.prevTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",t);var r={clientY:e.currentTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",r);var n={clientX:e.prevLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",n);var i={clientX:e.currentLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",i);var a,s,o=this.parent.sheets[this.parent.activeSheetIndex],l=lt(t.clientY,n.clientX,o),h=lt(r.clientY,i.clientX,o),d=l?l.image:[],p=d&&d.length?d.length:0;if(l&&l.image&&d.length>0){for(var c=0;c<p;c++)d[c].id===e.id&&((a=d[c]).height=e.currentHeight,a.width=e.currentWidth,a.top=e.currentTop,a.left=e.currentLeft,d.splice(c,1));if(h&&h.image&&(s=h.image,a&&s.push(a)),ht(r.clientY,i.clientX,o,s?{image:s}:{image:[a]},!0),"imageRefresh"===e.requestType&&!e.isUndoRedo){var u={requestType:"imageRefresh",currentRowIdx:r.clientY,currentColIdx:i.clientX,prevRowIdx:t.clientY,prevColIdx:n.clientX,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:u,action:"imageRefresh"})}}},e.prototype.deleteImage=function(e){var r,n,i,a,s,o=document.getElementById(e.id);if(o){var l={clientY:o.offsetTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",l);var h={clientX:o.offsetLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",h),document.getElementById(e.id).remove(),n=l.clientY,i=h.clientX,r=this.parent.sheets[this.parent.activeSheetIndex]}else{var d=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,p=e.range&&e.range.indexOf("!")>0?xt(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,c=t(d);n=c[0],i=c[1],r=this.parent.sheets[p]}s=(a=lt(n,i,r).image).length;for(var u=0;u<s;u++)a[u].id===e.id&&a.splice(u,1);ht(n,i,r,{image:a},!0)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"spreadsheetImage"},e}();sf.charts.Chart.Inject(sf.charts.ColumnSeries,sf.charts.LineSeries,sf.charts.BarSeries,sf.charts.AreaSeries,sf.charts.StackingColumnSeries,sf.charts.StackingLineSeries,sf.charts.StackingBarSeries,sf.charts.ScatterSeries),sf.charts.Chart.Inject(sf.charts.StackingAreaSeries,sf.charts.Category,sf.charts.Legend,sf.popups.Tooltip),sf.charts.AccumulationChart.Inject(sf.charts.PieSeries,sf.charts.AccumulationTooltip,sf.charts.AccumulationDataLabel,sf.charts.AccumulationLegend);var kn,An,Fn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("initiateChart",this.initiateChartHandler,this),this.parent.on("refreshChartCellObj",this.refreshChartCellObj,this),this.parent.on("updateChart",this.updateChartHandler,this),this.parent.on("deleteChart",this.deleteChart,this),this.parent.on("clearChartBorder",this.clearBorder,this),this.parent.on("insertChart",this.insertChartHandler,this),this.parent.on("chartRangeSelection",this.chartRangeHandler,this)},e.prototype.insertChartHandler=function(e){var t="Column";switch(e.id){case"clusteredColumn":t="Column";break;case"stackedColumn":t="StackingColumn";break;case"stackedColumn100":t="StackingColumn100";break;case"clusteredBar":t="Bar";break;case"stackedBar":t="StackingBar";break;case"stackedBar100":t="StackingBar100";break;case"area":t="Area";break;case"stackedArea":t="StackingArea";break;case"stackedArea100":t="StackingArea100";break;case"line":t="Line";break;case"stackedLine":t="StackingLine";break;case"stackedLine100":t="StackingLine100";break;case"pie":t="Pie";break;case"doughnut":t="Doughnut";break;case"scatter":t="Scatter"}var r=[{type:t}];this.parent.notify("setChart",{chart:r})},e.prototype.chartRangeHandler=function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var t=e.getElementsByClassName("e-control")[0].id,r=this.parent.chartColl,n=r.length,i=0;i<n;i++){var a=document.getElementById(r[i].id);e&&a&&r[i].id===t&&this.parent.notify("initiateChart",{option:r[i],chartCount:this.parent.chartCount,isRefresh:!0})}},e.prototype.getPropertyValue=function(e,t,r){var n=this.parent.sheets;if(n[r]&&n[r].rows[e]&&n[r].rows[e].cells[t]){var i=lt(e,t,this.parent.sheets[r]),a="";if(i.format){var s={type:D(i.format),value:i&&i.value,format:i&&i.format?i.format:"General",formattedText:i&&i.value,onLoad:!0,isRightAlign:!1,cell:i,rowIdx:e.toString(),colIdx:t.toString()};if(i)if(this.parent.notify("getFormattedCell",s),"number"==typeof s.value){var o=new RegExp("[!@#$%^&()+=';,{}|\":<>~_-]","g");s.formattedText=s.formattedText.toString().replace(o,""),a=parseInt(s.formattedText.toString(),10)}else a=s.formattedText.toString()}else a=this.parent.sheets[r].rows[e].cells[t].value;return a=sf.base.isNullOrUndefined(a)?"":a}return""},e.prototype.updateChartHandler=function(e){var t=this.initiateChartHandler({option:e.chart,isRefresh:!0}),r=this.parent.element.querySelector("."+e.chart.id);r&&(sf.base.getComponent(r,"chart").series=t)},e.prototype.refreshChartCellObj=function(e){var t={clientY:e.currentTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",t);var r={clientY:e.prevTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",r);var n={clientX:e.currentLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",n);var i={clientX:e.prevLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",i);var a,s,o=this.parent.sheets[this.parent.activeSheetIndex],l=lt(r.clientY,i.clientX,o),h=lt(t.clientY,n.clientX,o),d=l?l.chart:[],p=d&&d.length?d.length:0;if(l&&l.chart){for(var c=0;c<p;c++){var u=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active")[0],f=document.getElementById(d[c].id);sf.base.closest(f,"."+u.classList[1])===u&&((a=d[c]).height=e.currentHeight,a.width=e.currentWidth,a.top=e.currentTop,a.left=e.currentLeft,d.splice(c,1))}if(h&&h.chart&&(s=h.chart,a&&s.push(a)),ht(t.clientY,n.clientX,o,s?{chart:s}:{chart:[a]},!0),"chartRefresh"===e.requestType&&!e.isUndoRedo){var g={requestType:"chartRefresh",currentRowIdx:t.clientY,currentColIdx:n.clientX,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:r.clientY,prevColIdx:i.clientX,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:g,action:"chartRefresh"})}}},e.prototype.processChartRange=function(e,t,r){var n,i,a,s,o,l,h=e[0],d=e[1],p=!1,c=e[2],u=e[3],f=h===c,g=d===u;return s=this.getPropertyValue(h,u,t),o=this.getPropertyValue(c,d,t),l=this.getPropertyValue(h,d,t),x(o)&&l||(p=!0),sf.base.isNullOrUndefined(l)&&!f&&!g||"Scatter"===r.type&&e[3]-e[1]==1?(n=[h+1,d,c,d],i=[h+1,d+1,c,u],a=[h,d+1,h,u]):sf.base.isNullOrUndefined(o)||!p||f||g?(i=[h,d,c,u],sf.base.isNullOrUndefined(s)||x(s)||S(s)?sf.base.isNullOrUndefined(l)&&(f||g)&&(a=[h,d,h,u],f?(i[1]=i[1]+1,a[3]=a[1]):i[0]=i[0]+1):(a=[h,d,h,u],i[0]=i[0]+1)):sf.base.isNullOrUndefined(s)||x(s)&&l?(n=[h,d,c,d],i=[h,d+1,c,u]):(n=[h+1,d,c,d],i=[h+1,d+1,c,u],a=[h,d+1,h,u]),{xRange:n,yRange:i,lRange:a}},e.prototype.toIntrnlRange=function(e,r){return e?"string"==typeof e&&(e=t[e]):e=t[this.parent.sheets[r].selectedRange],e},e.prototype.getRangeData=function(e){e.sheetIdx=sf.base.isNullOrUndefined(e.sheetIdx)?this.parent.getActiveSheet().index:e.sheetIdx;var t,r,n,i,a=this.parent.sheets[e.sheetIdx];e.range=this.toIntrnlRange(e.range,e.sheetIdx);var s=[];return!1,r=e.range[0],n=e.range[2],i=e.range[3],zt(a,r)||(t=e.range[1],this.pushRowData(e,r,t,n,i,s,[],!0,e.isYvalue)),s},e.prototype.pushRowData=function(e,t,r,n,i,a,s,o,l){for(var h=r;t<=n;){for(r=h;r<=i;){var d="",p=lt(t,r,this.parent.getActiveSheet());if(p&&p.format&&!l){var c={value:p&&p.value,format:p&&p.format?p.format:"General",formattedText:p&&p.value,onLoad:!0,type:p&&D(p.format),rowIdx:t.toString(),colIdx:r.toString(),isRightAlign:!1,cell:p};this.parent.notify("getFormattedCell",c),d=c.formattedText.toString()}else d=this.parent.getValueRowCol(e.sheetIdx,t+1,r+1);a.push({value:d}),r++}t++}s.push(t)},e.prototype.toArrayData=function(e){for(var t,r=0,n=[],i=e.length;r<i;)t=e[r],Object.keys(t).length?"value"in t&&n.push(t.value):n.push(""),r++;return n},e.prototype.getVirtualXValues=function(e){for(var t=1,r=[];t<e;)r.push(t.toString()),t++;return r},e.prototype.processChartSeries=function(e,t,r,n,i){e=e||{};var a,s,o,l,h,d,p,c,u,f,g="",m={},v=0,y=0,C=[];l=this.getRangeData({range:n,sheetIdx:t,skipFormula:!0,isYvalue:!0});var S,w=n[2]-n[0]+1,I=n[3]-n[1]+1;for(e.isSeriesInRows?(o=i?this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(I+1),r&&(h=this.toArrayData(this.getRangeData({range:r,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),d=w):(o=r?this.toArrayData(this.getRangeData({range:r,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(w+1),i&&(h=this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),d=I),s=o.length,u=e.isSeriesInRows?1:d;v<d;){for(c=0,p=[],y=e.isSeriesInRows?y:v;c<s;)l[y]&&(x(a=l[y].value)?a=Number(a):(f=b(a),a=isNaN(f)?0:f),p.push({x:o[c],y:a})),y+=u,c++;if(g=h&&h.length>0?h[v]:"series"+v,e.type)if("Line"===(E=e.type)||"StackingLine"===E||"StackingLine100"===E)m={dataSource:p,type:e.type,xName:"x",yName:"y",name:g.toString(),marker:{visible:!0,width:10,height:10}};else if("Scatter"===E)m={dataSource:p,type:e.type,xName:"x",yName:"y",name:g.toString(),marker:{visible:!1,width:12,height:12,shape:"Circle"}};else if("Pie"===E||"Doughnut"===E){m={dataSource:p,dataLabel:{visible:!0,position:"Inside",name:"text",font:{fontWeight:"600"}},radius:"100%",xName:"x",yName:"y",startAngle:0,endAngle:360,innerRadius:"Pie"===e.type?"0%":"40%",explode:!0,explodeOffset:"10%",explodeIndex:0,name:"Browser"}}else m={dataSource:p,type:e.type,xName:"x",yName:"y",name:g.toString()};C.push(m),v++}if(e.type){var E=e.type;S={series:C,xRange:e.isSeriesInRows?i:r,yRange:n,lRange:e.isSeriesInRows?r:i}}return S},e.prototype.primaryYAxisFormat=function(e){if(sf.base.isNullOrUndefined(e))return"{value}";var t,r=lt(e[0],e[1],this.parent.getActiveSheet());if(r&&r.format){if("Accounting"===(t=D(r.format)))return"${value}";if("Currency"===t)return"${value}";if("Percentage"===t)return"{value}%"}return"{value}"},e.prototype.focusChartRange=function(e,t,r){var n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder(),r&&this.parent.notify("focusBorder",{startcell:{rowIndex:r[0],colIndex:r[1]},endcell:{rowIndex:r[2],colIndex:r[3]},classes:[n[0],n[1]]}),e&&this.parent.notify("focusBorder",{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[n[2],n[3]]}),this.parent.notify("focusBorder",{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[n[4],n[5]]})},e.prototype.clearBorder=function(){for(var e=this.parent.getMainContent(),t=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],r=0;r<t.length;r++)for(var n=e.querySelectorAll("."+t[r]),i=0;i<n.length;i++){n[i].classList.remove(t[r])}},e.prototype.initiateChartHandler=function(e){var r;r=!!sf.base.isNullOrUndefined(e.isInitCell)||!e.isInitCell;this.parent.serviceLocator.getService(Mn);e.isUndoRedo=!!sf.base.isNullOrUndefined(e.isUndoRedo)||e.isUndoRedo,e.isRefresh=!sf.base.isNullOrUndefined(e.isRefresh)&&e.isRefresh;var n,i,a,s,o,l=this.parent.getActiveSheet(),h=e.option.range?e.option.range.indexOf("!")>0?e.option.range.split("!")[1]:e.option.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,d=t(h),p={};if(this.parent.allowChart||!l.isProtected){var c,u,f=e.option.range&&e.option.range.indexOf("!")>0?xt(this.parent,e.option.range.split("!")[0]):this.parent.activeSheetIndex,g={sheetIndex:f,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:e.option,range:h,operation:"create"};if(h=g.range,p=(p=g.options)||{},d.length>0)d[2]-d[0]<d[3]-d[1]&&(n=!0);p.isSeriesInRows=!!n||!!p.isSeriesInRows&&p.isSeriesInRows,e.dataSheetIdx=sf.base.isNullOrUndefined(e.dataSheetIdx)?f:e.dataSheetIdx,i=(u=this.processChartRange(d,e.dataSheetIdx,p)).xRange,a=u.yRange,s=u.lRange,f===this.parent.activeSheetIndex&&r&&this.focusChartRange(i,a,s),c=this.processChartSeries(p,e.dataSheetIdx,i,a,s);var m={lineStyle:{width:0},majorTickLines:{width:0},majorGridLines:{width:1},minorGridLines:{width:1},minorTickLines:{width:0},labelFormat:this.primaryYAxisFormat(a)};if(e.isRefresh)return c.series;if(e.isUndoRedo){if(o={type:e.option.type,theme:e.option.theme,isSeriesInRows:e.option.isSeriesInRows,range:e.option.range,height:e.option.height,width:e.option.width,id:e.option.id,posRange:e.range,isInitCell:e.isInitCell,cancel:!1},this.parent.notify(G,{eventArgs:o,action:"beforeInsertChart"}),o.cancel)return[];e.option.type=o.type,e.option.theme=o.theme,e.option.isSeriesInRows=o.isSeriesInRows,e.option.range=o.range,e.option.id=o.id,e.option.height=o.height,e.option.width=o.width}var v=e.option.id+"_overlay",y=e.isPaste?this.parent.getActiveSheet().index:e.option.range&&e.option.range.indexOf("!")>0?xt(this.parent,e.option.range.split("!")[0]):this.parent.activeSheetIndex,C=this.parent.serviceLocator.getService(_n),b=!sf.base.isNullOrUndefined(e.isInitCell)&&e.isInitCell?e.range:h,S=C.insertOverlayElement(v,b,y);S.classList.add("e-datavisualization-chart"),S.style.width=e.option.width+"px",S.style.height=e.option.height+"px",S.style.top=sf.base.isNullOrUndefined(e.option.top)?S.style.top:e.option.top+"px",S.style.left=sf.base.isNullOrUndefined(e.option.left)?S.style.left:e.option.left+"px",e.option.top=parseInt(S.style.top.replace("px",""),10),e.option.left=parseInt(S.style.left.replace("px",""),10);var x=this.parent.createElement("div",{id:e.option.id,className:e.option.id});"Pie"!==e.option.type&&"Doughnut"!==e.option.type?(this.chart=new sf.charts.Chart({primaryXAxis:{majorGridLines:{width:0},minorGridLines:{width:0},majorTickLines:{width:0},minorTickLines:{width:0},lineStyle:{width:0},valueType:"Category"},primaryYAxis:m,chartArea:{border:{width:0}},series:c.series,tooltip:{enable:!0},width:S.style.width,height:S.style.height,load:function(t){var r=e.option.theme;r=r||"Material",t.chart.theme=(r.charAt(0).toUpperCase()+r.slice(1)).replace(/-dark/i,"Dark").replace(/contrast/i,"Contrast")},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(x)):(this.chart=new sf.charts.AccumulationChart({series:c.series,width:S.style.width,height:S.style.height,center:{x:"50%",y:"50%"},enableSmartLabels:!0,enableAnimation:!0,legendSettings:{visible:!0,position:"Bottom"},load:function(e){var t=location.hash.split("/")[1];t=t||"Material",e.accumulation.theme=(t.charAt(0).toUpperCase()+t.slice(1)).replace(/-dark/i,"Dark").replace(/contrast/i,"Contrast")},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(x)),S.appendChild(x),e.isUndoRedo&&this.parent.notify(W,{eventArgs:o,action:"insertChart"})}},e.prototype.deleteChart=function(e){this.clearBorder();var r,n=null;if(sf.base.isNullOrUndefined(e.id)?(n=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=n?n.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",n=document.getElementById(e.id)),!sf.base.isNullOrUndefined(e.id)&&!sf.base.isNullOrUndefined(n)){var i,s,o,l,h;e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";for(var d,p=!1,c=0;c<this.parent.chartColl.length;c++)if(this.parent.chartColl[c].id===e.id.split("_overlay")[0]){d=this.parent.chartColl[c];break}var u={id:d.id,range:d.range,type:d.type,theme:d.theme,height:d.height,width:d.width,isSeriesInRows:d.isSeriesInRows,isInitCell:!0,posRange:null,cancel:!1};if(n){this.parent.notify("deleteChartColl",{id:e.id});var f={clientY:n.offsetTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",f);var g={clientX:n.offsetLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",g),p=!0,i=f.clientY,s=g.clientX,r=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify("deleteChartColl",{id:e.id});var m=e.range&&e.range.indexOf("!")>0?xt(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,v=t(e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange);i=v[0],s=v[1],r=this.parent.sheets[m]}(o=lt(i,s,r))&&(l=o.chart),h=l?l.length:h;for(c=0;c<h;c++){var y=document.getElementById(e.id),C=document.getElementById(l[c].id);sf.base.closest(C,"."+y.classList[1])===y&&l.splice(c,1)}p&&document.getElementById(e.id).remove(),ht(i,s,r,{chart:l},!0),u.posRange=a(i,s),this.parent.notify(W,{eventArgs:u,action:"deleteChart"})}},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiateChart",this.initiateChartHandler),this.parent.off("refreshChartCellObj",this.refreshChartCellObj),this.parent.off("updateChart",this.updateChartHandler),this.parent.off("deleteChart",this.deleteChart),this.parent.off("clearChartBorder",this.clearBorder),this.parent.off("insertChart",this.insertChartHandler),this.parent.off("chartRangeSelection",this.chartRangeHandler))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null;var e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&sf.base.detach(e),this.chart=null},e.prototype.getModuleName=function(){return"spreadsheetChart"},e}(),Tn=function(){function e(){Jn.Inject(mn,vn,Cn,qr,jr,Gr,Yr,Vr,B,bn,xn,Sn,wn,Xr,yn,In,$r,Qr,Kr,En,Jr,en,tn,rn,an,nn,sn,on,ln,Rn,Fn)}return e.prototype.getModuleName=function(){return"basic"},e.prototype.destroy=function(){},e}(),On=function(){function e(){Jn.Inject(mn,vn,Cn,qr,jr,Gr,Yr,Vr,B,bn,Sn,wn,Xr,yn,In,Kr,$r,Qr,En,Jr,en,tn,rn,nn,an,sn,on,Rn,ln,Fn)}return e.prototype.getModuleName=function(){return"all"},e.prototype.destroy=function(){},e}(),Nn=(kn=function(e,t){return(kn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}kn(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Dn=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Nn(t,e),Dn([sf.base.Property(!1)],t.prototype,"isFinite",void 0),Dn([sf.base.Property(!0)],t.prototype,"enableVirtualization",void 0),t}(sf.base.ChildProperty),Bn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Nn(t,e),Dn([sf.base.Property("Multiple")],t.prototype,"mode",void 0),t}(sf.base.ChildProperty),Hn="e-wraptext",Mn="spreadsheetLocale",Pn="dialog",_n="shape",Un={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},Vn={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},jn={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case   ",MatchExactCellElements:"Match exact cell contents",Replace:"Replace...",Find:"Find and Replace...",Goto:"Goto...",EntercellAddress:"Enter cell address",GotoSpecial:"GotoSpecial...",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",GotoSpecialHeader:"Go To Special",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",SpreadsheetHyperlink:"SpreadsheetHyperlink",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",PasteMergeAlert:'We can"t do that to a merge cell.',Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",Rename:"Rename",Hide:"Hide",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",HideGridLines:"Hide Gridlines",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnHideRows:"UnHide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnHideColumns:"UnHide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"Ok",Close:"Close",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",TODAY:"Returns the current date as date value.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",SLOPE:"Returns the slope of the line from linear regression of the data points.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",ShowRowsWhere:"Show rows where:",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",EndsWith:"Ends With",StartsWith:"Starts With",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",LockCells:"Lock Cells",SelectCells:"Select cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CLEARALL:"CLEAR ALL",APPLY:"APPLY",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not between",EqualTo:"Equal to",NotEqualTo:"Not equal to",Greaterthan:"Greater than",Lessthan:"Less than",GreaterThanOrEqualTo:"Greater than or equal to",LessThanOrEqualTo:"Less than or equal to",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Retry:"Retry",EnterValue:"Enter value",DialogError:"The list source must be a reference to single row or column.",ListLengthError:"The list values allows only upto 256 charcters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"WEB PAGE",ThisDocument:"THIS DOCUMENT",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightblueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLine100:"100% Stacked Line"},qn=function(){function e(e){this.freezePane=!1,this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}return e.prototype.refreshSelectALLContent=function(){var e;if(this.freezePane){var t=this.getSelectAllTable().querySelector("thead"),r=this.rowRenderer.render();t.appendChild(r),e=this.parent.createElement("th",{className:"e-select-all-cell"}),r.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall e-icons",id:this.parent.element.id+"_select_all"}))},e.prototype.updateLeftColGroup=function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var r=t.querySelector("table");this.detachColGroup(r);var n=this.parent.createElement("colgroup"),i=this.colGroupWidth+"px",a=this.col.cloneNode();a.style.width=i,n.appendChild(a),r.insertBefore(n,r.querySelector("tbody")),t.style.width=i,this.freezePane?(r=this.getSelectAllTable(),this.detachColGroup(r),r.insertBefore(n.cloneNode(!0),r.querySelector("thead"))):this.getSelectAllContent().style.width=i,this.parent.getActiveSheet().showHeaders&&(this.getColHeaderPanel().style.width="calc(100% - "+i+")",this.getContentPanel().style.width="calc(100% - "+i+")")},e.prototype.detachColGroup=function(e){var t=e.querySelector("colgroup");t&&sf.base.detach(t)},e.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});var e=this.parent.getActiveSheet(),t=this.parent.element.id;e.showHeaders?(this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:t+"_row_header"})),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding()):this.updateHideHeaders();var r=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-sheet-content",id:t+"_main_content"}));e.showGridLines||r.classList.add("e-hide-gridlines"),this.parent.allowScrolling||(r.style.overflow="hidden")},e.prototype.initHeaderPanel=function(){var e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"}))},e.prototype.createTable=function(){this.parent.getActiveSheet().showHeaders&&this.createHeaderTable(),this.updateTable("tbody","content",this.contentPanel.lastElementChild)},e.prototype.createHeaderTable=function(e){void 0===e&&(e=this.contentPanel.querySelector(".e-row-header")),this.freezePane&&this.updateTable("thead","selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable("thead","colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable("tbody","rowhdr",e),this.updateLeftColGroup(null,e)},e.prototype.updateTable=function(e,t,r){var n=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});n.classList.add("e-"+t+"-table"),r.appendChild(n),n.appendChild(this.parent.createElement(e))},e.prototype.renderTable=function(e){var r,n,i,a=this,s=this.parent.getActiveSheet(),o=document.createDocumentFragment();this.createTable();var l,h,d,p=this.parent.createElement("colgroup"),c=this.contentPanel.querySelector(".e-sheet-content tbody");s.showHeaders&&(o.appendChild(this.headerPanel),this.refreshSelectALLContent(),l=this.contentPanel.querySelector(".e-row-header tbody"),h=this.headerPanel.querySelector(".e-column-header thead"),this.getColHeaderTable().insertBefore(p,h),d=this.rowRenderer.render(),h.appendChild(d)),o.appendChild(this.contentPanel),this.parent.notify("beforeContentLoaded",{startColIdx:e.indexes[1]});var u=s.colCount.toString(),f=s.colCount.toString(),g=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";s.showHeaders&&(this.parent.getColHeaderTable().setAttribute("aria-colcount",u),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",f)),sf.base.attributes(this.parent.getContentTable(),{"aria-rowcount":f,"aria-colcount":u}),e.cells.forEach((function(o,h){(r=t(h))[1]===e.indexes[1]&&(s.showHeaders&&(i=a.rowRenderer.render(r[0],!0),l.appendChild(i),i.appendChild(a.cellRenderer.renderRowHeader(r[0]))),n=a.rowRenderer.render(r[0]),c.appendChild(n)),n.appendChild(a.cellRenderer.render({colIdx:r[1],rowIdx:r[0],cell:o,address:h,lastCell:r[1]===e.indexes[3],isHeightCheckNeeded:!0,row:n,hRow:i,pRow:n.previousSibling,pHRow:s.showHeaders?i.previousSibling:null,first:g?g.includes("Row")?r[0]===e.indexes[0]?"Row":g.includes("Column")&&r[1]===e.indexes[1]?"Column":"":r[1]===e.indexes[1]?"Column":"":""})),r[0]===e.indexes[0]&&(a.updateCol(s,r[1],p),s.showHeaders&&d.appendChild(a.cellRenderer.renderColHeader(r[1])))})),this.parent.isReact&&this.parent.renderReactTemplates(),c.parentElement.insertBefore(p.cloneNode(!0),c),ir((function(){var t=a.parent.getMainContent();if(document.getElementById(a.parent.element.id+"_sheet").appendChild(o),e.top&&(t.scrollTop=e.top,s.showHeaders&&(a.parent.getRowHeaderContent().scrollTop=e.top)),e.left&&(t.scrollLeft=e.left,s.showHeaders&&(a.parent.getColumnHeaderContent().scrollLeft=e.left)),a.parent.notify("contentLoaded",null),a.parent.notify(H,{action:"renderEditor"}),e.initLoad||a.parent.isOpen||a.parent.hideSpinner(),Er(a.parent.getMainContent(),{busy:!1}),a.parent.trigger("dataBound",{}),a.parent.isEdit&&a.parent.notify("initiateEdit",null),e.initLoad){var r=!0;if(a.parent.scrollSettings.enableVirtualization)for(var n=0;n<s.ranges.length;n++)if(s.ranges[n].info.count-1>a.parent.viewport.bottomIndex){r=!1;break}r&&a.triggerCreatedEvent()}}))},e.prototype.triggerCreatedEvent=function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?this.parent.created.observers=this.parent.createdHandler.observers:this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger("created",null))},e.prototype.refreshColumnContent=function(e){var r,n,i,a,s=this,o=0,l=this.parent.getActiveSheet(),h=document.createDocumentFragment(),d=document.createDocumentFragment(),p=this.parent.element.querySelector(".e-sheet-content tbody");p=h.appendChild(p.cloneNode(!0));var c,u,f=this.parent.element.querySelector(".e-sheet-content colgroup");f=f.cloneNode(),l.showHeaders&&(d.appendChild(f),u=this.parent.element.querySelector(".e-column-header thead"),u=d.appendChild(u.cloneNode(!0)),(c=u.querySelector("tr")).innerHTML=""),e.cells.forEach((function(i,h){if((r=t(h))[0]===e.indexes[0]&&(s.updateCol(l,r[1],f),l.showHeaders&&c.appendChild(s.cellRenderer.renderColHeader(r[1]))),r[1]===e.indexes[1]){if(!(n=p.children[o]))return;n.innerHTML="",o++}a=n.appendChild(s.cellRenderer.render({colIdx:r[1],rowIdx:r[0],cell:i,address:h,row:n,pRow:n.previousSibling,first:e.skipUpdateOnFirst||r[1]!==e.indexes[1]?s.parent.scrollSettings.enableVirtualization&&r[0]===e.indexes[0]&&s.parent.viewport.topIndex!==Pr(l,0,!0)?"Row":"":"Column"})),s.checkColMerge(r,e.indexes,a,i)})),h.insertBefore(f.cloneNode(!0),p),ir((function(){l.showHeaders&&(ar(i=s.getColHeaderTable()),i.appendChild(d)),ar(i=s.getContentTable()),i.appendChild(h),s.parent.notify("virtualContentLoaded",{refresh:"Column"}),s.parent.isEdit&&s.parent.notify("forRefSelRender",{}),s.parent.allowChart&&s.parent.notify("chartRangeSelection",null),s.parent.isOpen||s.parent.hideSpinner(),Er(s.parent.getMainContent(),{busy:!1})}))},e.prototype.refreshRowContent=function(e){var r,n,i,a,s,o,l=this,h=this.colGroupWidth,d=this.parent.getActiveSheet(),p=document.createDocumentFragment(),c=this.parent.createElement("tbody");d.showHeaders&&(a=document.createDocumentFragment(),s=c.cloneNode(),a.appendChild(s)),p.appendChild(c),e.cells.forEach((function(a,p){(r=t(p))[1]===e.indexes[1]&&(d.showHeaders&&(i=l.rowRenderer.render(r[0],!0),s.appendChild(i),i.appendChild(l.cellRenderer.renderRowHeader(r[0])),h=sr(r[0]+1)),n=l.rowRenderer.render(r[0]),c.appendChild(n)),o=n.appendChild(l.cellRenderer.render({rowIdx:r[0],colIdx:r[1],cell:a,address:p,lastCell:r[1]===e.indexes[3],row:n,hRow:i,pRow:n.previousSibling,pHRow:d.showHeaders?i.previousSibling:null,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||r[0]!==e.indexes[0]?l.parent.scrollSettings.enableVirtualization&&r[1]===e.indexes[1]&&l.parent.viewport.leftIndex!==Pr(d,0,!0,"columns")?"Column":"":"Row"})),l.checkRowMerge(r,e.indexes,o,a)})),this.colGroupWidth!==h&&this.updateLeftColGroup(h),d.showHeaders&&this.contentPanel.querySelector(".e-row-header tbody")&&(sf.base.detach(this.contentPanel.querySelector(".e-row-header tbody")),this.getRowHeaderTable().appendChild(a)),this.contentPanel.querySelector(".e-sheet-content tbody")&&(sf.base.detach(this.contentPanel.querySelector(".e-sheet-content tbody")),this.getContentTable().appendChild(p)),this.parent.notify("virtualContentLoaded",{refresh:"Row"}),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.isOpen||this.parent.hideSpinner(),Er(this.parent.getMainContent(),{busy:!1})},e.prototype.updateCol=function(e,t,r){var n=this.col.cloneNode();return n.style.width=sf.base.formatUnit(er(e,t)),r?r.appendChild(n):n},e.prototype.updateColContent=function(e){var r=this;ir((function(){var n,i,a,s,o,l,h,d,p=0,c=r.parent.getActiveSheet();c.showHeaders&&(l=r.parent.element.querySelector(".e-column-header .e-header-row"),d=l.firstElementChild);var u,f=r.parent.element.querySelector(".e-sheet-content colgroup"),g=f.firstElementChild,m=r.parent.element.querySelector(".e-sheet-content tbody");e.cells.forEach((function(a,v){if(!u){if(n=t(v),"first"===e.direction&&n[1]===e.indexes[1]&&r.checkColMerge([n[0],r.parent.viewport.leftIndex],e.indexes,(m.rows[p]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],lt(n[0],r.parent.viewport.leftIndex,c)||{}),n[0]===e.indexes[0]&&("last"===e.direction?((h=r.col.cloneNode()).style.width=sf.base.formatUnit(er(c,n[1])),f.insertBefore(h,g),c.showHeaders&&l.insertBefore(r.cellRenderer.renderColHeader(n[1]),d)):(r.updateCol(c,n[1],f),c.showHeaders&&l.appendChild(r.cellRenderer.renderColHeader(n[1]))),r.parent.scrollSettings.enableVirtualization&&e.direction&&(sf.base.detach(f[e.direction+"ElementChild"]),c.showHeaders&&sf.base.detach(l[e.direction+"ElementChild"]))),n[1]===e.indexes[1]){if(i=m.children[p],p++,!i)return void(u=!0);s=i.firstElementChild}o=r.cellRenderer.render({colIdx:n[1],rowIdx:n[0],cell:a,address:v,lastCell:n[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||n[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&n[3]===e.indexes[3]?"Column":""}),"last"===e.direction?(r.checkColMerge(n,e.indexes,o,a,(m.rows[p-1]||{cells:[]}).cells[0]),i.insertBefore(o,s)):i.appendChild(o),r.parent.scrollSettings.enableVirtualization&&e.direction&&sf.base.detach(i[e.direction+"ElementChild"])}})),c.showHeaders&&(a=r.getColHeaderTable(),sf.base.detach(a.querySelector("colgroup")),a.insertBefore(f.cloneNode(!0),a.querySelector("thead"))),r.parent.scrollSettings.enableVirtualization&&r.parent.notify("virtualContentLoaded",{refresh:"Column"}),r.parent.allowChart&&r.parent.notify("chartRangeSelection",null),r.parent.isEdit&&r.parent.notify("forRefSelRender",{}),r.parent.isOpen||r.parent.hideSpinner(),Er(r.parent.getMainContent(),{busy:!1})}))},e.prototype.updateRowContent=function(e){var r,n,i,a,s,o,l=this,h=this.colGroupWidth,d=this.parent.getActiveSheet(),p=0,c=this.parent.getMainContent().querySelector("tbody");d.showHeaders&&(s=document.createDocumentFragment(),a=this.parent.getRowHeaderContent().querySelector("tbody"));var u=document.createDocumentFragment();this.parent.showSpinner(),e.cells.forEach((function(f,g){o=t(g),"first"===e.direction&&o[0]===e.indexes[0]&&l.checkRowMerge([l.parent.viewport.topIndex,o[1]],e.indexes,(c.rows[e.indexes[2]-e.indexes[0]+1]||{cells:[]}).cells[p],lt(l.parent.viewport.topIndex,o[1],d)||{}),o[1]===e.indexes[1]&&(d.showHeaders&&(n=l.rowRenderer.render(o[0],!0),s.appendChild(n),n.appendChild(l.cellRenderer.renderRowHeader(o[0])),h=sr(o[0]+1),l.parent.scrollSettings.enableVirtualization&&e.direction&&sf.base.detach(a[e.direction+"ElementChild"])),r=l.rowRenderer.render(o[0]),u.appendChild(r),l.parent.scrollSettings.enableVirtualization&&e.direction&&sf.base.detach(c[e.direction+"ElementChild"])),i=r.appendChild(l.cellRenderer.render({colIdx:o[1],rowIdx:o[2],cell:f,address:g,lastCell:o[1]===e.indexes[3],row:r,pHRow:d.showHeaders?n.previousSibling:null,checkNextBorder:"last"===e.direction&&o[2]===e.indexes[2]?"Row":"",pRow:r.previousSibling,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:n,first:"last"!==e.direction||e.skipUpdateOnFirst||o[0]!==e.indexes[0]?"":"Row"})),"last"===e.direction&&l.checkRowMerge(o,e.indexes,i,f,c.rows[0].cells[p]),p++})),this.colGroupWidth!==h&&this.updateLeftColGroup(h),"last"===e.direction?(d.showHeaders&&a.insertBefore(s,a.firstElementChild),c.insertBefore(u,c.firstElementChild)):(d.showHeaders&&a.appendChild(s),c.appendChild(u)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Row"}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isOpen||this.parent.hideSpinner(),Er(this.parent.getMainContent(),{busy:!1})},e.prototype.checkRowMerge=function(e,t,r,n,i){if(this.parent.scrollSettings.enableVirtualization&&r&&(!sf.base.isNullOrUndefined(n.rowSpan)||!sf.base.isNullOrUndefined(n.colSpan)))if(e[0]===this.parent.viewport.topIndex)n.rowSpan<0&&(this.parent.notify("checkMerge",{td:r,rowIdx:e[0],colIdx:e[1],isRow:!0}),this.parent.viewport.topIndex>=t[0]&&this.refreshPrevMerge(t[0]+1,e[1])),i&&(i.colSpan||i.rowSpan)&&this.cellRenderer.refresh(e[0]+(t[2]-t[0])+1,e[1],null,i);else if(n.rowSpan>1){var a=t[2]+1;e[0]+n.rowSpan-1>a&&e[0]<a&&this.refreshPrevMerge(a,e[1],this.parent.viewport.topIndex)}},e.prototype.refreshPrevMerge=function(e,t,r){var n=this.parent.getCell(e,t,this.parent.getRow(r||0));n&&n.rowSpan>1&&this.cellRenderer.refresh(e,t,null,n)},e.prototype.checkColMerge=function(e,t,r,n,i){!this.parent.scrollSettings.enableVirtualization||!r||e[1]!==this.parent.viewport.leftIndex||sf.base.isNullOrUndefined(n.rowSpan)&&sf.base.isNullOrUndefined(n.colSpan)||(n.colSpan<0&&this.parent.notify("checkMerge",{td:r,colIdx:e[1],rowIdx:e[0]}),i&&(i.colSpan||i.rowSpan)&&this.cellRenderer.refresh(e[0],e[1]+(t[3]-t[1])+1,null,i))},e.prototype.showHideHeaders=function(){var e=this,t=this.parent.getActiveSheet();if(t.showHeaders)if(this.parent.scrollSettings.enableVirtualization){var r=[this.parent.viewport.topIndex,this.parent.viewport.leftIndex,this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex];this.renderHeaders([r[0],r[2]],[r[1],r[3]])}else this.renderHeaders([0,t.rowCount-1],[0,t.colCount-1]),"A1"!==t.topLeftCell&&this.parent.goTo(t.topLeftCell);else ir((function(){sf.base.detach(e.headerPanel),sf.base.detach(e.getRowHeaderPanel()),e.getContentPanel().style.width="",e.updateHideHeaders()}))},e.prototype.renderHeaders=function(e,t){var r=this,n=this.parent.getActiveSheet();this.initHeaderPanel();var i=document.createDocumentFragment(),a=document.createDocumentFragment();i.appendChild(this.headerPanel);var s=a.appendChild(this.parent.createElement("div",{className:"e-row-header",id:this.parent.element.id+"_row_header"}));this.createHeaderTable(s),this.parent.notify("beforeHeaderLoaded",{element:s}),this.refreshSelectALLContent();var o,l=s.querySelector("tbody"),h=this.headerPanel.querySelector(".e-column-header thead"),d=this.rowRenderer.render();h.appendChild(d);for(var p=t[0];p<=t[1];p++)rr(n,p)||d.appendChild(this.cellRenderer.renderColHeader(p));var c=sr(e[1]);this.colGroupWidth!==c&&this.updateLeftColGroup(c,s);for(p=e[0];p<=e[1];p++)zt(n,p)||((o=this.rowRenderer.render(p,!0)).appendChild(this.cellRenderer.renderRowHeader(p)),l.appendChild(o));ir((function(){r.getColHeaderTable().insertBefore(r.getContentTable().querySelector("colgroup").cloneNode(!0),h);var e=document.getElementById(r.parent.element.id+"_sheet");e.classList.remove("e-hide-headers"),e.insertBefore(i,r.contentPanel);var t=r.getContentPanel();r.contentPanel.insertBefore(a,t),r.parent.scrollModule.setPadding(),s.scrollTop=t.scrollTop,r.getColHeaderPanel().scrollLeft=t.scrollLeft}))},e.prototype.updateHideHeaders=function(){document.getElementById(this.parent.element.id+"_sheet").classList.add("e-hide-headers"),this.headerPanel=null},e.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},e.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},e.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},e.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},e.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},e.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},e.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},e.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]},e.prototype.addEventListener=function(){this.parent.on("created",this.triggerCreatedEvent,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off("created",this.triggerCreatedEvent),this.parent.off("spreadsheetDestroyed",this.destroy)},e}(),zn=function(){function e(e){this.parent=e,this.element=this.parent.createElement("tr",{attrs:{role:"row"}}),this.cellRenderer=e.serviceLocator.getService("cell")}return e.prototype.render=function(e,t,r){var n=this.element.cloneNode();if(void 0===e)return n.classList.add("e-header-row"),n;n.classList.add("e-row");var i=this.parent.getActiveSheet();return sf.base.attributes(n,{"aria-rowindex":(e+1).toString()}),n.style.height=Wt(i,e)+"px",t&&!r&&(zt(i,e+1)&&!zt(i,e-1)&&n.classList.add("e-hide-start"),0!==e&&zt(i,e-1)&&!zt(i,e+1)&&n.classList.add("e-hide-end")),n},e.prototype.refresh=function(e,t,r,n){var i,s=this.parent.getActiveSheet();if(n)(i=this.render(e,!0,!0)).appendChild(this.cellRenderer.renderRowHeader(e));else{i=this.render(e);for(var o=this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),l=this.parent.viewport.leftIndex;l<=o;l++)i.appendChild(this.cellRenderer.render({colIdx:l,rowIdx:e,cell:lt(e,l,s),address:a(e,l),lastCell:l===o,row:i,hRow:r,isHeightCheckNeeded:!0,pRow:t,first:e===this.parent.viewport.topIndex&&Pr(s,e,!0)!==Pr(s,0,!0)?"Row":""}))}return i},e}(),Wn=function(){function e(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on("updateView",this.updateView,this)}return e.prototype.renderColHeader=function(e){var t=this.th.cloneNode();sf.base.attributes(t,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"}),t.innerHTML=o(e+1);var r=this.parent.getActiveSheet();return rr(r,e+1)&&t.classList.add("e-hide-start"),0!==e&&rr(r,e-1)&&t.classList.add("e-hide-end"),t},e.prototype.renderRowHeader=function(e){var t=this.element.cloneNode();return sf.base.addClass([t],"e-header-cell"),sf.base.attributes(t,{role:"rowheader",tabindex:"-1"}),t.innerHTML=(e+1).toString(),t},e.prototype.render=function(e){e.td=this.element.cloneNode(),e.td.className="e-cell",sf.base.attributes(e.td,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"});this.parent.getActiveSheet();if(this.checkMerged(e))return e.td;var t=this.processTemplates(e.cell,e.rowIdx,e.colIdx);"string"==typeof t?e.td.innerHTML=t:e.td.appendChild(t),e.isRefresh=!1,this.update(e),e.cell&&e.td&&(this.parent.notify("cFRender",{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,isChecked:!1}),e.td&&e.td.children[0]&&"e-cf-databar"===e.td.children[0].className&&(e.cell.style&&e.cell.style.fontSize&&(e.td.children[0].querySelector(".e-databar-value").style.fontSize=e.cell.style.fontSize),e.td.children[0].style.height="100%",e.td.children[0].firstElementChild.nextElementSibling.style.height="100%")),Or(this.parent,e.rowIdx,e.colIdx,this.parent.activeSheetIndex)||this.parent.notify("renderFilterCell",{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx});var r={cell:e.cell,element:e.td,address:e.address};this.parent.trigger("beforeCellRender",r),this.updateRowHeight({rowIdx:e.rowIdx,cell:r.element,lastCell:e.lastCell,rowHgt:20,row:e.row,hRow:e.hRow});var n=e.td.classList.contains("e-wraptext"),i=e.td.innerHTML;i.indexOf("\n")>-1&&!n&&(i.split("\n").length>1&&this.parent.notify("wrapText",{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,initial:!0,sheet:this.parent.getActiveSheet(),td:e.td,row:e.row,hRow:e.hRow}));return r.element},e.prototype.update=function(e){if(!e.isRefresh||(e.td.rowSpan&&e.td.removeAttribute("rowSpan"),e.td.colSpan&&e.td.removeAttribute("colSpan"),!this.checkMerged(e))){if(e.cell&&e.cell.formula&&!e.cell.value){var t=$e(e.cell.formula),r={action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:t};this.parent.notify(k,r),e.cell.value=lt(e.rowIdx,e.colIdx,this.parent.getActiveSheet()).value}var n={type:e.cell&&D(e.cell.format),value:e.cell&&e.cell.value,format:e.cell&&e.cell.format?e.cell.format:"General",formattedText:e.cell&&e.cell.value,onLoad:!0,isRightAlign:!1,cell:e.cell,rowIdx:e.rowIdx.toString(),colIdx:e.colIdx.toString()};e.cell&&this.parent.notify("getFormattedCell",n),sf.base.isNullOrUndefined(e.td)||this.parent.refreshNode(e.td,{type:n.type,result:n.formattedText,curSymbol:sf.base.getNumberDependable(this.parent.locale,"USD"),isRightAlign:n.isRightAlign,value:n.value||""});var i={};if(e.cell){if(e.cell.style&&(i=e.cell.style.properties?dt(e.cell.style,!0):e.cell.style),e.cell.chart&&e.cell.chart.length>0&&this.parent.notify("setChart",{chart:e.cell.chart,isInitCell:!0,range:a(e.rowIdx,e.colIdx)}),e.cell.hyperlink&&this.parent.notify("createHyperlinkElement",{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}),e.cell.wrap&&this.parent.notify("wrapText",{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,sheet:this.parent.getActiveSheet(),initial:!0,td:e.td,row:e.row,hRow:e.hRow}),e.cell.rowSpan>1){var o=e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));o>1&&(e.td.rowSpan=o)}if(e.cell.colSpan>1){var l=e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");l>1&&(e.td.colSpan=l)}if(e.cell.image)for(var h=0;h<e.cell.image.length;h++)this.parent.notify("createImageElement",{options:{src:e.cell.image[h].src,imageId:e.cell.image[h].id,height:e.cell.image[h].height,width:e.cell.image[h].width,top:e.cell.image[h].top,left:e.cell.image[h].left},range:s([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})}if(e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),this.parent.allowConditionalFormat&&e.lastCell&&this.parent.notify("checkConditionalFormat",{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell}),this.parent.allowChart&&e.lastCell&&this.parent.notify("refreshChart",{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex}),(Object.keys(i).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&this.parent.notify(R,{style:sf.base.extend({},this.parent.commonCellStyle,i),rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td,first:e.first,row:e.row,lastCell:e.lastCell,hRow:e.hRow,pRow:e.pRow,isHeightCheckNeeded:e.isHeightCheckNeeded,manualUpdate:e.manualUpdate}),"Row"===e.checkNextBorder){var d=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""===d||e.cell&&e.cell.style&&e.cell.style.bottomPriority||this.parent.notify(R,{style:{borderBottom:d},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if("Column"===e.checkNextBorder){var p=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""===p||e.cell&&e.cell.style&&(e.cell.style.borderRight||e.cell.style.border)||this.parent.notify(R,{style:{borderRight:p},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if(e.cell&&e.cell.hyperlink&&!Or(this.parent,e.rowIdx,e.colIdx,this.parent.activeSheetIndex)){var c=void 0;"string"==typeof e.cell.hyperlink?0!==(c=e.cell.hyperlink).indexOf("http://")&&0!==c.indexOf("https://")&&0!==c.indexOf("ftp://")&&(e.cell.hyperlink=0===c.toLowerCase().indexOf("www.")?"http://"+c:c):0!==(c=e.cell.hyperlink.address).indexOf("http://")&&0!==c.indexOf("https://")&&0!==c.indexOf("ftp://")&&(e.cell.hyperlink.address=0===c.toLowerCase().indexOf("www.")?"http://"+c:c),this.parent.notify("createHyperlinkElement",{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx})}}},e.prototype.checkMerged=function(e){return!(!e.cell||!(e.cell.colSpan<0||e.cell.rowSpan<0))&&(e.td.style.display="none",e.cell.colSpan<0&&this.parent.notify("checkPrevMerge",e),e.cell.rowSpan<0&&(e.isRow=!0,this.parent.notify("checkPrevMerge",e)),!0)},e.prototype.processTemplates=function(e,r,n){for(var i,a=this.parent.getActiveSheet(),s=a.ranges,o=0,l=s.length;o<l;o++)if(s[o].template&&(i=t(s[o].address.length?s[o].address:s[o].startCell))[0]<=r&&i[1]<=n&&i[2]>=r&&i[3]>=n){if(e)return this.compileCellTemplate(s[o].template);if(!lt(r,n,a,!0))return this.compileCellTemplate(s[o].template)}return""},e.prototype.compileCellTemplate=function(e){if("string"==typeof e){var t=void 0;return t=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,sf.base.compile(t)({},null,null,"",!0)[0].outerHTML}return sf.base.compile(e)({},this.parent,"ranges","")[0]},e.prototype.updateRowHeight=function(e){if(e.cell&&e.cell.children.length){var t=e.cell.cloneNode(!0);this.tableRow.appendChild(t)}if(e.lastCell&&this.tableRow.childElementCount){var r=this.parent.getActiveSheet(),n=e.row||this.parent.getRow(e.rowIdx),i=Wt(r,e.rowIdx),a=this.getRowHeightOnInit();a>i&&(n.style.height=a+"px",r.showHeaders&&((e.hRow||this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())).style.height=a+"px"),Gt(r,e.rowIdx,a)),this.tableRow.innerHTML=""}},e.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=Math.round(this.tableRow.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t},e.prototype.removeStyle=function(e,t,r){var n;if(e.style.length){var i=(n=this.parent.getCellStyleValue(["borderLeft","border"],[t,r+1])).borderLeft||n.border,a=(n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,r])).borderTop||n.border;i||a?[].slice.call(e.style).forEach((function(t){(!i||t.indexOf("border-right")>-1||a)&&(!a||t.indexOf("border-bottom")>-1||i)||e.style.removeProperty(t)})):e.removeAttribute("style")}var s=this.parent.getCell(t-1,r);if(s&&s.style.borderBottom){var o=Number(s.parentElement.getAttribute("aria-rowindex"))-1;(n=this.parent.getCellStyleValue(["borderBottom","border"],[o,r])).borderBottom||n.border||(s.style.borderBottom="")}var l=e.previousElementSibling;l&&l.style.borderRight&&(r=Number(l.getAttribute("aria-colindex"))-1,(n=this.parent.getCellStyleValue(["borderRight","border"],[t,r])).borderRight||n.border||(l.style.borderRight=""))},e.prototype.refreshRange=function(e){var t=this.parent.getActiveSheet(),r=e.slice();if(cr(this.parent,r,!0))for(var n=r[0];n<=r[2];n++)if(!zt(t,n))for(var i=r[1];i<=r[3];i++){var a=this.parent.getCell(n,i);a&&(this.update({rowIdx:n,colIdx:i,td:a,cell:lt(n,i,t),lastCell:i===r[3],isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:""}),this.parent.notify("renderFilterCell",{td:a,rowIndex:n,colIndex:i}))}},e.prototype.refresh=function(e,t,r,n){var i=this.parent.getActiveSheet();if((n||!zt(i,e)&&!rr(i,t))&&(n||!this.parent.scrollSettings.enableVirtualization||e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex&&t>=this.parent.viewport.leftIndex&&t<=this.parent.viewport.rightIndex)){var a=n||this.parent.getCell(e,t);this.update({rowIdx:e,colIdx:t,td:a,cell:lt(e,t,i),lastCell:r,isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:""}),this.parent.notify("renderFilterCell",{td:a,rowIndex:e,colIndex:t})}},e.prototype.updateView=function(e){this.refreshRange(e.indexes)},e}(),Gn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){this.parent.activeSheetIndex=this.parent.skipHiddenSheets(this.parent.activeSheetIndex),this.parent.isMobileView()||(this.parent.notify("ribbon",null),this.parent.notify("formulaBar",null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});if(this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.showSheetTabs)this.parent.notify("sheetTabs",null);else{var t={action:"addSheet",sheetName:"Sheet1",index:1,visibleName:Ot(this.parent,0)};this.parent.notify(k,t),this.parent.notify(k,{action:"initiateDefinedNames"})}this.parent.isMobileView()&&(this.parent.notify("formulaBar",null),this.parent.notify("ribbon",null)),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell(!0)},e.prototype.checkTopLeftCell=function(e){var t=this.parent.getActiveSheet();if(this.parent.scrollSettings.enableVirtualization&&"A1"!==t.topLeftCell){var r=n(t.topLeftCell),i=r[0]?Yt(t,0,r[0]-1):0,a=r[1]?tr(t,0,r[1]-1):0;this.parent.notify("onContentScroll",{scrollLeft:a,scrollTop:i,preventScroll:!0});var s=this.parent.getThreshold("row"),o=r[0]>s?r[0]-s:0;s=this.parent.getThreshold("col");var l=r[1]>s?r[1]-s:0;this.refreshUI({rowIndex:o,colIndex:l,refresh:"All",top:i,left:a})}else this.refreshUI({rowIndex:0,colIndex:0,refresh:"All"},null,e)},e.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet"})),this.parent.serviceLocator.getService("sheet").renderPanel()},e.prototype.refreshUI=function(e,t,r){var i=this,s=this.parent.serviceLocator.getService("sheet"),o=this.parent.getActiveSheet(),l=Ot(this.parent);if(this.parent.showSpinner(),!t)if(this.parent.scrollSettings.enableVirtualization){var h=e.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),d=o.rowCount-1;this.parent.scrollSettings.isFinite&&h>d&&(h=d);var p=e.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col");d=o.colCount-1,this.parent.scrollSettings.isFinite&&p>d&&(p=d);var c=this.parent.skipHidden(e.rowIndex,h),u=e.rowIndex;if(e.rowIndex!==c[0])(f=n(o.topLeftCell))[0]===e.rowIndex&&this.parent.setSheetPropertyOnMute(o,"topLeftCell",a(c[0],f[1])),e.rowIndex=c[0];h=c[1],c=this.parent.skipHidden(e.colIndex,p,"columns");var f,g=e.colIndex;if(e.colIndex!==c[0])(f=n(o.topLeftCell))[1]===e.colIndex&&this.parent.setSheetPropertyOnMute(o,"topLeftCell",a(f[0],c[0])),e.colIndex=c[0];p=c[1],this.parent.viewport.topIndex=e.rowIndex,this.parent.viewport.bottomIndex=h,this.parent.viewport.leftIndex=e.colIndex,this.parent.viewport.rightIndex=p,t=a(u,g)+":"+a(h,p)}else t="A1:"+a(o.rowCount-1,o.colCount-1);"All"===e.refresh&&this.parent.trigger("beforeDataBound",{}),Er(this.parent.getMainContent(),{busy:!0});var m=this.parent.sheets.length;this.parent.getData(l+"!"+t).then((function(a){if(!(m<i.parent.sheets.length)){var l=i.parent.sheets.indexOf(o);if(-1!==l&&l===i.parent.activeSheetIndex){var h=[e.rowIndex,e.colIndex].concat(n(t.split(":")[1]));switch(e.refresh){case"All":s.renderTable({cells:a,indexes:h,top:e.top,left:e.left,initLoad:r});break;case"Row":s.refreshRowContent({cells:a,indexes:h,skipUpdateOnFirst:e.skipUpdateOnFirst});var d={isEdit:!1};i.parent.notify("isFormulaBarEdit",d),d.isEdit&&i.parent.notify(H,{action:"startEdit",refreshCurPos:!1});break;case"Column":s.refreshColumnContent({cells:a,indexes:h,skipUpdateOnFirst:e.skipUpdateOnFirst});break;case"RowPart":s.updateRowContent({cells:a,indexes:h,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst});break;case"ColumnPart":s.updateColContent({cells:a,indexes:h,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst})}i.parent.isReact&&i.parent.renderReactTemplates()}else l>-1&&i.checkTopLeftCell()}})),this.parent.notify("beforeVirtualContentLoaded",{refresh:e.refresh})},e.prototype.removeSheet=function(){sf.base.remove(document.getElementById(this.parent.element.id+"_sheet"))},e.prototype.refreshSheet=function(){this.removeSheet(),this.renderSheet(),this.parent.notify("deInitProperties",{}),this.checkTopLeftCell()},e.prototype.setSheetPanelSize=function(){var e,t=document.getElementById(this.parent.element.id+"_sheet_panel"),r=this.parent.element.getBoundingClientRect();"auto"===this.parent.height?(t.style.height="260px",e=230):(e=r.height-dr(t),t.style.height=e+"px",e-=32),this.parent.viewport.height=e,this.parent.viewport.width=r.width-32,this.parent.viewport.rowCount=this.roundValue(e,20),this.parent.viewport.colCount=this.roundValue(r.width,64)},e.prototype.roundValue=function(e,t){var r=e/t,n=Math.round(r);return Math.abs(r-n)<.5?n:n-1},e.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("cell",new Wn(this.parent)),this.parent.serviceLocator.register("row",new zn(this.parent)),this.parent.serviceLocator.register("sheet",new qn(this.parent))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("initialLoad",this.instantiateRenderer,this),this.parent.on("dataRefresh",this.refreshSheet,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.off("initialLoad",this.instantiateRenderer),this.parent.off("dataRefresh",this.refreshSheet),this.parent.off("spreadsheetDestroyed",this.destroy)},e}(),Yn=function(){function e(e){this.parent=e}return e.prototype.show=function(e,t){var r,n=this;t=!!sf.base.isNullOrUndefined(t);var i=e.close||null,a={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=function(){n.dialogInstance.destroy(),sf.base.remove(n.dialogInstance.element),n.dialogInstance=null,i&&i()},sf.base.extend(a,e),t&&(r=this.parent.serviceLocator.getService(Mn).getConstant(a.buttons.length?"Cancel":"Ok"),a.buttons.push({buttonModel:{content:r,isPrimary:0===a.buttons.length},click:this.hide.bind(this)}));var s=this.parent.createElement("div");document.body.appendChild(s),this.dialogInstance=new sf.popups.Dialog(a),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(s),this.dialogInstance.refreshPosition()},e.prototype.hide=function(){this.dialogInstance&&this.dialogInstance.hide()},e.prototype.destroy=function(){this.parent=null},e}(),Xn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.initializeActionBegin=function(){var e=this,t=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"begin",eventType:"format"})};var r=this.parent.beforeOpen;this.parent.beforeOpen=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"begin",eventType:"beforeOpen"})};var n=this.parent.beforeSave;this.parent.beforeSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:n,actionType:"begin",eventType:"beforeSave"})};var i=this.parent.beforeSort;this.parent.beforeSort=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"begin",eventType:"beforeSort"})}},e.prototype.initializeActionComplete=function(){var e=this,t=this.parent.sortComplete;this.parent.sortComplete=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"complete",eventType:"sorting"})};var r=this.parent.cellSave;this.parent.cellSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"complete",eventType:"cellSave"})}},e.prototype.actionEventHandler=function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})},e.prototype.actionBeginHandler=function(e){this.parent.trigger("actionBegin",{action:e.action,args:e}),"clipboard"!==e.action&&"beforeSort"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"filter"!==e.action&&"cellDelete"!==e.action||this.parent.notify("setActionData",{args:e})},e.prototype.actionCompleteHandler=function(e){this.parent.trigger("actionComplete",e),"undoRedo"!==e.action&&"gotoSheet"!==e.action&&this.parent.notify("updateUndoRedoCollection",{args:e})},e.prototype.addEventListener=function(){this.parent.on(W,this.actionCompleteHandler,this),this.parent.on(G,this.actionBeginHandler,this)},e.prototype.removeEventListener=function(){this.parent.off(W,this.actionCompleteHandler),this.parent.off(G,this.actionBeginHandler)},e}(),Kn=function(){function e(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e}return e.prototype.insertOverlayElement=function(e,r,n){var i=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay"},styles:"width: "+this.minWidth+";  height: "+this.minHeight}),a=t(r),s=ur(this.parent.sheets[n],a);return i.style.top=s.top+"px",i.style.left=s.left+"px",this.parent.getMainContent().appendChild(i),this.renderResizeHandles(i),this.addEventListener(i),this.originalWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px","")),i},e.prototype.addEventListener=function(e){var t=e;sf.base.EventHandler.add(t,"mousedown",this.overlayClickHandler,this),sf.base.EventHandler.add(t,"mousemove",this.overlayMouseMoveHandler,this),sf.base.EventHandler.add(this.parent.getMainContent(),"mousemove",this.overlayMouseMoveHandler,this),sf.base.EventHandler.add(document,"mouseup",this.overlayMouseUpHandler,this)},e.prototype.overlayMouseMoveHandler=function(e){var t=e.target,r=document.getElementsByClassName("e-ss-overlay-active")[0];if(this.isOverlayClicked&&this.isResizerClicked)switch(this.resizer){case"e-ss-overlay-t":var n=Math.max(this.originalMouseY-e.clientY+this.originalHeight,20),i=e.clientY-(this.originalMouseY-this.originalResizeTop);n>180&&i>-1&&(r.style.height=n+"px",r.style.top=i+"px",this.resizedReorderTop=i,this.currenHeight=n,this.parent.notify("refreshChartSize",{height:r.style.height,width:r.style.width,overlayEle:r}));break;case"e-ss-overlay-r":var a=this.originalWidth+(e.pageX-this.originalMouseX);a>180&&(r.style.width=a+"px",this.currentWidth=a,this.parent.notify("refreshChartSize",{height:r.style.height,width:r.style.width,overlayEle:r}));break;case"e-ss-overlay-b":var s=this.originalHeight+(e.pageY-this.originalMouseY);s>180&&(r.style.height=s+"px",this.currenHeight=s,this.parent.notify("refreshChartSize",{height:r.style.height,width:r.style.width,overlayEle:r}));break;case"e-ss-overlay-l":var o=Math.max(this.originalMouseX-e.clientX+this.originalWidth,20),l=e.clientX-(this.originalMouseX-this.originalResizeLeft);o>180&&l>-1&&(r.style.width=o+"px",r.style.left=l+"px",this.resizedReorderLeft=l,this.currentWidth=o,this.parent.notify("refreshChartSize",{height:r.style.height,width:r.style.width,overlayEle:r}))}else if(this.isOverlayClicked)if(sf.base.closest(t,".e-sheet-content")&&!t.classList.contains("e-sheet-content")||t.classList.contains("e-cell")){var h=e.clientX,d=e.clientY,p=h-this.diffX,c=d-this.diffY;p>-1&&(r.style.left=p+"px"),c>-1&&(r.style.top=c+"px"),this.resizedReorderLeft=p,this.resizedReorderTop=c}else this.overlayMouseUpHandler(e,!0)},e.prototype.overlayMouseUpHandler=function(e,t){if(!this.parent.getActiveSheet().isProtected){this.isResizerClicked=!1;var r=e.target,n=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");r.classList.contains("e-ss-overlay")||(r=sf.base.closest(e.target,".e-datavisualization-chart")?sf.base.closest(e.target,".e-datavisualization-chart"):r);var i={prevTop:this.originalReorderTop,prevLeft:this.originalReorderLeft,currentTop:this.resizedReorderTop?this.resizedReorderTop:this.originalReorderTop,currentLeft:this.resizedReorderLeft?this.resizedReorderLeft:this.originalReorderLeft,id:r.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};(this.isOverlayClicked||t)&&(this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(i.id=r.id,n&&n[0]?(i.requestType="chartRefresh",this.parent.notify("refreshChartCellObj",i)):this.parent.notify("refreshImgCellObj",i),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(i.id=r.id.indexOf("overlay")>0?r.id:r.parentElement?r.parentElement.id:"",n&&n[0]?(i.requestType="chartRefresh",this.parent.notify("refreshChartCellObj",i)):this.parent.notify("refreshImgCellObj",i),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)),this.isOverlayClicked=!1}},e.prototype.overlayClickHandler=function(e){if(!this.parent.getActiveSheet().isProtected){this.isOverlayClicked=!0;var t=e.target,r=e.target;t.classList.contains("e-ss-overlay")||(r=t.parentElement,sf.base.closest(e.target,".e-datavisualization-chart")&&(r=sf.base.closest(e.target,".e-datavisualization-chart"),this.currentWidth=parseFloat(getComputedStyle(r,null).getPropertyValue("width").replace("px","")),this.currenHeight=parseFloat(getComputedStyle(r,null).getPropertyValue("height").replace("px","")))),this.originalReorderLeft=parseInt(r.style.left,10),this.originalReorderTop=parseInt(r.style.top,10),this.resizedReorderLeft=parseInt(r.style.left,10),this.resizedReorderTop=parseInt(r.style.top,10),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=e.clientX,this.originalMouseY=e.clientY,this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var n=document.getElementsByClassName("e-ss-overlay-active")[0];n&&sf.base.removeClass([n],"e-ss-overlay-active"),document.getElementById(r.id).classList.add("e-ss-overlay-active"),t.classList.contains("e-ss-resizer")&&(this.resizer=t.classList[0],this.originalWidth=parseFloat(getComputedStyle(r,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(r,null).getPropertyValue("height").replace("px","")),this.isResizerClicked=!0),r.classList.contains("e-datavisualization-chart")&&this.parent.notify("focusChartBorder",{id:r.id})}},e.prototype.renderResizeHandles=function(e){for(var t,r=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],n=0,i=e;r.length>n;)t=this.parent.createElement("div",{attrs:{class:r[n]+" e-ss-resizer"},styles:"width: 8px; height: 8px; border-radius: 4px;"}),i.appendChild(t),n++},e.prototype.removeEventListener=function(){var e=document.getElementById(this.parent.element.id+"_overlay");sf.base.EventHandler.remove(e,"mousedown",this.overlayClickHandler),sf.base.EventHandler.remove(e,"mousemove",this.overlayMouseMoveHandler),sf.base.EventHandler.remove(this.parent.getMainContent(),"mousemove",this.overlayMouseMoveHandler),sf.base.EventHandler.remove(document,"mouseup",this.overlayMouseUpHandler)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),$n=(An=function(e,t){return(An=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}An(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Zn=function(e,t,n,i){var a,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},Jn=function(e){function r(t,r){var n=e.call(this,t)||this;return n.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0},n.needsID=!0,s.Inject(mn,vn,Cn,qr,jr,Gr,Yr,Vr,B,bn,xn,Sn,wn,Xr,yn,en,Ee,$,Q,Ie,O,Ce,In,be,Kr,Qr,Se,En,Jr,Re,tn,rn,ke,Ae,nn,Fe,an,Oe,sn,Te,on,Ne,Rn,ln,xe,De,Fn,we),r&&n.appendTo(r),n}var s;return $n(r,e),s=r,r.prototype.getCell=function(e,t,r){return t=this.getViewportIndex(t,!0),r||(r=this.getRow(e)),r?r.cells[t]:r},r.prototype.getRow=function(e,t){return e=this.getViewportIndex(e),(t=t||this.getContentTable())?t.rows[e]:null},r.prototype.hiddenCount=function(e,t,r){void 0===r&&(r="rows");for(var n=this.getActiveSheet(),i=0,a=e;a<=t;a++)n[r][a]&&n[r][a].hidden&&i++;return i},r.prototype.getViewportIndex=function(e,t){return this.scrollSettings.enableVirtualization&&(t?(e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex):(e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex)),e},r.prototype.preRender=function(){e.prototype.preRender.call(this),this.serviceLocator=new Lt,this.initServices()},r.prototype.initServices=function(){this.serviceLocator.register(Mn,new sf.base.L10n(this.getModuleName(),jn,this.locale)),this.serviceLocator.register(Pn,new Yn(this)),this.serviceLocator.register("actionEvents",new Xn(this)),this.serviceLocator.register(_n,new Kn(this))},r.prototype.render=function(){e.prototype.render.call(this),this.element.setAttribute("tabindex","0"),Er(this.element,{role:"grid"}),this.renderModule=new Gn(this),this.notify("initialLoad",null),this.renderSpreadsheet(),this.wireEvents(),this.created&&(this.created.observers?this.created.observers.length>0&&(this.createdHandler={observers:this.created.observers},this.created.observers=[]):(this.createdHandler=this.created,this.setProperties({created:void 0},!0)))},r.prototype.renderSpreadsheet=function(){this.cssClass&&sf.base.addClass([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),sf.popups.createSpinner({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new zr(this)),this.scrollSettings.enableVirtualization&&new Wr(this),this.renderModule.render(),new Zr(this)},r.prototype.showSpinner=function(){sf.popups.showSpinner(this.element)},r.prototype.hideSpinner=function(){sf.popups.hideSpinner(this.element)},r.prototype.protectSheet=function(t,r){"string"==typeof t&&(t=xt(this,t)),t&&(this.setSheetPropertyOnMute(this.sheets[t],"isProtected",!0),this.setSheetPropertyOnMute(this.sheets[t],"protectSettings",r)),t=this.getActiveSheet().index,this.setSheetPropertyOnMute(this.getActiveSheet(),"isProtected",!0),e.prototype.protectSheet.call(this,t,r)},r.prototype.unprotectSheet=function(t){"string"==typeof t&&(t=xt(this,t)),t?this.sheets[t].isProtected=!1:this.getActiveSheet().isProtected=!1,e.prototype.unprotectSheet.call(this,t)},r.prototype.find=function(t){e.prototype.findHandler.call(this,t)},r.prototype.replace=function(t){t={value:t.value,mode:t.mode?t.mode:"Sheet",isCSen:!!t.isCSen&&t.isCSen,isEMatch:!!t.isEMatch&&t.isEMatch,searchBy:t.searchBy?t.searchBy:"By Row",replaceValue:t.replaceValue,replaceBy:t.replaceBy,sheetIndex:t.sheetIndex?t.sheetIndex:this.activeSheetIndex,findOpt:t.findOpt?t.findOpt:""},e.prototype.replaceHandler.call(this,t)},r.prototype.findAll=function(e,t,r,n,i){var a=[],s={value:e,mode:t=t||"Sheet",sheetIndex:i=i||this.activeSheetIndex,isCSen:r=r||!1,isEMatch:n=n||!1,findCollection:a};return this.notify("findAllValues",s),a},r.prototype.goTo=function(e){if(e.includes("!")){var r=e.split("!"),i=xt(this,r[0]);if(void 0===i)return;if(i!==this.activeSheetIndex){var s=r[1].split(":")[0];this.setSheetPropertyOnMute(this.sheets[i],"activeCell",s),this.setSheetPropertyOnMute(this.sheets[i],"selectedRange",r[1]);var o=n(s);return o[0]<this.viewport.rowCount&&(o[0]=0),o[1]<this.viewport.colCount&&(o[1]=0),this.setSheetPropertyOnMute(this.sheets[i],"topLeftCell",a(o[0],o[1])),this.activeSheetIndex=i,void this.dataBind()}}var l=t(e),h=this.getActiveSheet(),d=l[0]>=this.viewport.topIndex&&l[0]<this.viewport.bottomIndex&&l[1]>=this.viewport.leftIndex&&l[1]<this.viewport.rightIndex;if(d){this.selectRange(e);var p=n(h.topLeftCell);if(p[2]=p[0]+this.viewport.rowCount,p[3]=p[1]+this.viewport.colCount,l[0]>=p[0]&&l[0]<p[2]&&l[1]>=p[1]&&l[1]<p[3])return}var c,u,f,g,m,v,y,C=this.getMainContent();0===l[0]?g=Yt(h,0):(g=Yt(h,0,l[0]-1),this.scrollSettings.enableVirtualization&&(y=g+this.getContentTable().getBoundingClientRect().height)>(v=parseInt(C.querySelector(".e-virtualtrack").style.height,10))&&(y+=10,(c=C.querySelector(".e-virtualtrack")).style.height=y+"px",h.showHeaders&&((f=this.getRowHeaderContent().querySelector(".e-virtualtrack")).style.height=y+"px"),ir((function(){c.style.height=v+"px",h.showHeaders&&(f.style.height=v+"px")})))),C.scrollTop=g,0===l[1]?g=tr(h,0):(g=tr(h,0,l[1]-1),this.scrollSettings.enableVirtualization&&(y=g+this.getContentTable().getBoundingClientRect().width)>(m=parseInt(C.querySelector(".e-virtualtrack").style.width,10))&&(y+=10,(c=C.querySelector(".e-virtualtrack")).style.width=y+"px",h.showHeaders&&((u=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width=y+"px"),ir((function(){c.style.width=m+"px",h.showHeaders&&(u.style.width=m+"px")})))),C.scrollLeft=g,d||this.selectRange(e)},r.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet()},r.prototype.cut=function(e){var t=new Promise((function(e,t){e(void 0)}));return this.notify(V,e?{range:l(e),sId:this.sheets[xt(this,It(e))].id,promise:t}:{promise:t}),t},r.prototype.copy=function(e){var t=this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell;e=sf.base.isNullOrUndefined(e)?t:e;var r=new Promise((function(e,t){e(void 0)}));return this.notify("copy",e?{range:l(e),sId:this.sheets[xt(this,It(e))].id,promise:r}:{promise:r}),r},r.prototype.paste=function(e,t){this.notify(j,{range:l(e),sIdx:xt(this,It(e)),type:t,isAction:!1,isInternal:!0})},r.prototype.updateAction=function(e){Tr(e,this)},r.prototype.setHeight=function(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=sf.base.formatUnit(this.height)},r.prototype.setWidth=function(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=sf.base.formatUnit(this.width)},r.prototype.setColWidth=function(e,t,r){void 0===e&&(e=64),void 0===t&&(t=0);var i=this.getThreshold("col"),a=this.viewport.leftIndex+this.viewport.colCount+2*i,s=sf.base.isNullOrUndefined(r)?this.getActiveSheet():this.sheets[r];if(s){var o=t,l="number"==typeof e?e+"px":e;if(t=sf.base.isNullOrUndefined(t)?n(s.activeCell)[1]:t,s===this.getActiveSheet())if(t>=this.viewport.leftIndex&&t<=a){this.scrollSettings.enableVirtualization&&(t-=this.viewport.leftIndex);var h=void 0;h=s.showHeaders?this.getColumnHeaderContent().getElementsByClassName("e-header-cell")[t]:this.getContentTable().getElementsByClassName("e-row")[0].getElementsByClassName("e-cell")[t];var d=parseInt(this.getMainContent().getElementsByTagName("col")[t].style.width,10);(u=parseInt(l,10)-d)<0&&d<-u&&(n(s.activeCell),u=-d);var p=parseInt(h.getAttribute("aria-colindex"),10)-1;this.getActiveSheet()===s&&(this.notify("colWidthChanged",{threshold:u,colIdx:p}),kr(t,l,!0,this))}else{var c=er(s,t),u=void 0;u=parseInt(l,10)>0?-(c-parseInt(l,10)):-c,this.notify("colWidthChanged",{threshold:u,colIdx:t})}Jt(s,o).width=parseInt(l,10)>0?parseInt(l,10):0,s.columns[o].customWidth=!0}},r.prototype.setRowHeight=function(e,t,r,i){void 0===e&&(e=20),void 0===t&&(t=0);var a=sf.base.isNullOrUndefined(r)?this.getActiveSheet():this.sheets[r-1];if(a){var s=t,o="number"==typeof e?e+"px":e;if(t=sf.base.isNullOrUndefined(t)?n(a.activeCell)[0]:t,a===this.getActiveSheet())if(t<=this.viewport.bottomIndex&&t>=this.viewport.topIndex){this.scrollSettings.enableVirtualization&&(t-=this.viewport.topIndex);var l=void 0;l=a.showHeaders?this.getRowHeaderContent().getElementsByClassName("e-header-cell")[t].parentElement:this.getContentTable().getElementsByClassName("e-row")[t];var h=parseInt(this.getMainContent().getElementsByTagName("tr")[t].style.height,10);(c=parseInt(o,10)-h)<0&&h<-c&&(c=-h);var d=parseInt(l.getAttribute("aria-rowindex"),10)-1;this.getActiveSheet()===a&&(this.notify("rowHeightChanged",{threshold:c,rowIdx:d}),sf.base.isNullOrUndefined(i)&&(i=!1),i||(kr(t,o,!1,this),i=!1))}else{var p=Wt(a,t),c=void 0;c=parseInt(o,10)>0?-(p-parseInt(o,10)):-p,this.notify("rowHeightChanged",{threshold:c,rowIdx:t})}Gt(a,s,parseInt(o,10)>0?parseInt(o,10):0),a.rows[s].customHeight=!0}},r.prototype.autoFit=function(e){var t=this.getIndexes(e),r=t.startIdx,n=t.endIdx,a=t.isCol,s=a?i("XFD"):1048576;if(r<=s)for(n>s&&(n=s);r<=n;r++)this.notify("setAutoFit",{idx:r,isCol:a})},r.prototype.getIndexes=function(e){var t,r,n,a,s;if(-1!==e.indexOf(":")){var o=e.split(":");n=o[0],a=o[1]}else n=e,a=e;if(!sf.base.isNullOrUndefined(n)){var l=this.getAddress(n);n=l.address,t=l.isCol}if(!sf.base.isNullOrUndefined(a)){var h=this.getAddress(a);a=h.address,r=h.isCol}return{startIdx:(s=!0===t&&!0===r)?i(n.toUpperCase()):parseInt(n,10),endIdx:s?i(a.toUpperCase()):parseInt(a,10),isCol:s}},r.prototype.getAddress=function(e){var t;return e.substring(0,1).match(/\D/g)?(t=!0,{address:e=e.replace(/[0-9]/g,""),isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:{address:e=(parseInt(e,10)-1).toString(),isCol:t}},r.prototype.addHyperlink=function(e,t){this.insertHyperlink(e,t,"",!0)},r.prototype.removeHyperlink=function(e){var r,n,i=this.getActiveSheet();if(e&&-1!==e.indexOf("!")){r=e.split("!");for(var a=this.sheets,s=0;s<a.length;s++)a[s].name===r[0]&&(n=s);i=this.sheets[n],e=r[1]}for(var o,l=t(e||this.getActiveSheet().activeCell),h=l[0];h<=l[2];h++)for(var d=l[1];d<=l[3];d++)if(i&&i.rows[h]&&i.rows[h].cells[d]&&(o=i.rows[h].cells[d])&&("string"==typeof o.hyperlink?o.value=o.value?o.value:o.hyperlink:o.value=o.value?o.value:o.hyperlink.address,delete o.hyperlink,i===this.getActiveSheet())){var p=void 0,c=void 0;this.scrollSettings.enableVirtualization&&(p=h-this.viewport.topIndex,c=d-this.viewport.leftIndex);var u=this.element.getElementsByClassName("e-sheet-content")[0].getElementsByClassName("e-row")[p].getElementsByClassName("e-cell")[c];u.getElementsByClassName("e-hyperlink")[0]&&(u.innerText=u.getElementsByClassName("e-hyperlink")[0].innerHTML)}},r.prototype.insertHyperlink=function(r,n,i,a){if(this.allowHyperlink){var s=void 0,o=void 0,l=void 0,h=this.getActiveSheet(),d={hyperlink:r,cell:n=n||this.getActiveSheet().activeCell,cancel:!1},p={hyperlink:r,cell:n};if(a||this.trigger("beforeHyperlinkCreate",d),!d.cancel){if(r=d.hyperlink,n=d.cell,e.prototype.addHyperlink.call(this,r,n),n&&-1!==n.indexOf("!")){s=n.split("!");for(var c=this.sheets,u=0;u<c.length;u++)c[u].name===s[0]&&(o=u);h=this.sheets[o],n=s[1]}if(!h)return;l=t(n=n||this.getActiveSheet().activeCell),"string"==typeof r?r:r.address;var f=h.rows[l[0]].cells[l[1]];sf.base.isNullOrUndefined(f.value)||f.value,a||this.trigger("afterHyperlinkCreate",p),h===this.getActiveSheet()&&this.serviceLocator.getService("cell").refreshRange(l)}}},r.prototype.addDataValidation=function(t,r){e.prototype.addDataValidation.call(this,t,r)},r.prototype.removeDataValidation=function(t){e.prototype.removeDataValidation.call(this,t)},r.prototype.addInvalidHighlight=function(t){e.prototype.addInvalidHighlight.call(this,t)},r.prototype.removeInvalidHighlight=function(t){e.prototype.removeInvalidHighlight.call(this,t)},r.prototype.conditionalFormat=function(t){e.prototype.conditionalFormat.call(this,t)},r.prototype.clearConditionalFormat=function(t){t=t||this.getActiveSheet().selectedRange,e.prototype.clearConditionalFormat.call(this,t)},r.prototype.setPanelSize=function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height-dr(e)+"px"}},r.prototype.open=function(t){this.isOpen=!0,e.prototype.open.call(this,t),this.isOpen&&this.showSpinner()},r.prototype.hideRow=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0),this.renderModule?this.notify(q,{startIndex:t,endIndex:r,hide:n}):e.prototype.hideRow.call(this,t,r,n)},r.prototype.hideColumn=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0),this.renderModule?this.notify(q,{startIndex:t,endIndex:r,hide:n,isCol:!0}):e.prototype.hideColumn.call(this,t,r,n)},r.prototype.clear=function(e){this.notify("clearViewer",{options:e,isPublic:!0})},r.prototype.refresh=function(t){this.isReact&&this.clearTemplate(),t?this.notify("blankWorkbook",{}):e.prototype.refresh.call(this)},r.prototype.insertImage=function(e,t){var r;for(r=0;r<e.length;r++)this.notify("createImageElement",{options:e[r],range:t||this.getActiveSheet().selectedRange,isPublic:!0})},r.prototype.deleteImage=function(e,t){this.notify("deleteImage",{id:e,range:t||this.getActiveSheet().selectedRange})},r.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},r.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},r.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},r.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},r.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},r.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},r.prototype.getThreshold=function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t},r.prototype.isMobileView=function(){return(this.cssClass.indexOf("e-mobile-view")>-1||sf.base.Browser.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},r.prototype.getValueRowCol=function(t,r,n){return e.prototype.getValueRowCol.call(this,t,r,n)},r.prototype.updateCell=function(t,r){r=r||this.getActiveSheet().activeCell,e.prototype.updateCell.call(this,t,r),this.serviceLocator.getService("cell").refreshRange(l(r)),this.notify("activeCellChanged",null)},r.prototype.sort=function(t,r){var n=this;return this.allowSorting?e.prototype.sort.call(this,t,r).then((function(e){return n.notify("sortComplete",e),Promise.resolve(e)})):Promise.reject()},r.prototype.setValueRowCol=function(t,r,n,i){if("circular reference: "===r){var a={action:"isCircularReference",argValue:r};this.notify("formulaOperation",a),r=a.argValue}e.prototype.setValueRowCol.call(this,t,r,n,i),t=wt(this,t),this.notify(H,{action:"refreshDependentCellValue",rowIdx:n,colIdx:i,sheetIdx:t})},r.prototype.getModuleName=function(){return"spreadsheet"},r.prototype.refreshNode=function(e,t){var r;if(e){var n=sf.base.select("#"+this.element.id+"_currency",e),i="e-right-align";if(t){if(t.result=sf.base.isNullOrUndefined(t.result)?"":t.result.toString(),n&&sf.base.detach(n),"Accounting"===t.type&&x(t.value))return e.querySelector("a")?e.querySelector("a").textContent=t.result.split(t.curSymbol).join(""):e.innerHTML="",e.appendChild(this.createElement("span",{id:this.element.id+"_currency",innerHTML:""+t.curSymbol,styles:"float: left"})),e.querySelector("a")||(e.innerHTML+=t.result.split(t.curSymbol).join("")),void e.classList.add(i);!t.result||"true"!==t.result.toLowerCase()&&"false"!==t.result.toLowerCase()||(t.result=t.result.toUpperCase(),i="e-center-align",t.isRightAlign=!0),r=t.result,t.isRightAlign?e.classList.add(i):e.classList.remove(i)}if(r=sf.base.isNullOrUndefined(r)?"":r,!sf.base.isNullOrUndefined(e)){var a=e.lastChild;e.querySelector(".e-hyperlink")&&(a=e.querySelector(".e-hyperlink").lastChild),e.querySelector(".e-wrap-content")&&(a=e.querySelector(".e-wrap-content").lastChild),!a||3!==a.nodeType&&1!==a.nodeType?e.appendChild(document.createTextNode(r)):a.nodeValue=r}}},r.prototype.calculateHeight=function(e,t,r){void 0===t&&(t=1),void 0===r&&(r=1);var n=e&&e.fontSize||this.cellStyle.fontSize,i="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*i*t+r*i},r.prototype.skipHidden=function(e,t,r){void 0===r&&(r="rows");var n,i=this.getActiveSheet();this.scrollSettings.isFinite&&(n=("rows"===r?i.rowCount:i.colCount)-1);for(var a=e;a<=t;a++)if(i[r][a]&&i[r][a].hidden&&(e===a&&e++,t++,n&&t>n)){t=n;break}return[e,t]},r.prototype.updateActiveBorder=function(e,t){void 0===t&&(t=".e-ribbon");var r=sf.base.select(t+" .e-tab-header .e-indicator",this.element);r.style.display="none",sf.base.setStyleAttribute(r,{left:"",right:""}),sf.base.setStyleAttribute(r,{left:e.offsetLeft+"px",right:e.parentElement.offsetWidth-(e.offsetLeft+e.offsetWidth)+"px"}),r.style.display=""},r.prototype.undo=function(){this.notify("performUndoRedo",{isUndo:!0,isPublic:!0})},r.prototype.redo=function(){this.notify("performUndoRedo",{isUndo:!1,isPublic:!0})},r.prototype.updateUndoRedoCollection=function(e){this.notify("updateUndoRedoCollection",{args:e,isPublic:!0})},r.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify("formulaOperation",t),t.isAdded},r.prototype.removeDefinedName=function(t,r){return e.prototype.removeDefinedName.call(this,t,r)},r.prototype.mouseClickHandler=function(e){this.notify(M,e)},r.prototype.mouseDownHandler=function(e){this.notify("mouseDown",e)},r.prototype.keyUpHandler=function(e){sf.base.closest(e.target,".e-find-dlg")?this.notify("findKeyUp",e):this.notify(P,e)},r.prototype.keyDownHandler=function(e){sf.base.closest(e.target,".e-findtool-dlg")||this.notify(_,e)},r.prototype.wireEvents=function(){sf.base.EventHandler.add(this.element,"click",this.mouseClickHandler,this),sf.base.EventHandler.add(this.element,mr(),this.mouseDownHandler,this),sf.base.EventHandler.add(this.element,"keyup",this.keyUpHandler,this),sf.base.EventHandler.add(this.element,"keydown",this.keyDownHandler,this),sf.base.EventHandler.add(this.element,"noderefresh",this.refreshNode,this)},r.prototype.destroy=function(){this.isReact&&this.clearTemplate(),this.unwireEvents(),this.notify("spreadsheetDestroyed",null),e.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width")},r.prototype.unwireEvents=function(){sf.base.EventHandler.remove(this.element,"click",this.mouseClickHandler),sf.base.EventHandler.remove(this.element,mr(),this.mouseDownHandler),sf.base.EventHandler.remove(this.element,"keyup",this.keyUpHandler),sf.base.EventHandler.remove(this.element,"keydown",this.keyDownHandler),sf.base.EventHandler.remove(this.element,"noderefresh",this.refreshNode)},r.prototype.addContextMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify("addContextMenuItems",{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.removeContextMenuItems=function(e,t){this.notify("removeContextMenuItems",{items:e,isUniqueId:t})},r.prototype.enableContextMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify("enableContextMenuItems",{items:e,enable:t,isUniqueId:r})},r.prototype.enableFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify("enableFileMenuItems",{items:e,enable:t,isUniqueId:r})},r.prototype.hideFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify("hideFileMenuItems",{items:e,hide:t,isUniqueId:r})},r.prototype.addFileMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify("addFileMenuItems",{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.hideRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify("hideRibbonTabs",{tabs:e,hide:t})},r.prototype.enableRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify("enableRibbonTabs",{tabs:e,enable:t})},r.prototype.addRibbonTabs=function(e,t){this.notify("addRibbonTabs",{items:e,insertBefore:t})},r.prototype.enableToolbarItems=function(e,t,r){this.notify("enableToolbarItems",[{tab:e,items:t,enable:void 0===r||r}])},r.prototype.hideToolbarItems=function(e,t,r){void 0===r&&(r=!0),this.notify("hideToolbarItems",{tab:e,indexes:t,hide:r})},r.prototype.addToolbarItems=function(e,t,r){this.notify("addToolbarItems",{tab:e,items:t,index:r})},r.prototype.selectRange=function(e){this.notify("selectRange",{indexes:t(e)})},r.prototype.startEdit=function(){this.notify(H,{action:"startEdit",isNewValueEdit:!1})},r.prototype.closeEdit=function(){this.notify(H,{action:"cancelEdit"})},r.prototype.endEdit=function(){this.notify(H,{action:"endEdit"})},r.prototype.onPropertyChanged=function(t,r){var n=this;e.prototype.onPropertyChanged.call(this,t,r);for(var i=0,a=Object.keys(t);i<a.length;i++){switch(a[i]){case"enableRtl":t.enableRtl?document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl"):document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl");break;case"cssClass":r.cssClass&&sf.base.removeClass([this.element],r.cssClass.split(" ")),t.cssClass&&sf.base.addClass([this.element],t.cssClass.split(" "));break;case"activeSheetIndex":this.renderModule.refreshSheet(),this.notify("activeSheetChanged",{idx:t.activeSheetIndex});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify("ribbon",{uiUpdate:!0});break;case"showFormulaBar":this.notify("formulaBar",{uiUpdate:!0});break;case"showSheetTabs":this.notify("sheetTabs",null);break;case"cellStyle":this.renderModule.refreshSheet();break;case"allowEditing":this.allowEditing&&this.notify(H,{action:"renderEditor"});break;case"allowInsert":var s=this.element.getElementsByClassName("e-add-sheet-tab")[0];s&&(s.disabled=!this.allowInsert,this.allowInsert?s.classList.contains("e-disabled")&&s.classList.remove("e-disabled"):s.classList.contains("e-disabled")||s.classList.add("e-disabled"));break;case"sheets":Object.keys(t.sheets).forEach((function(e,r){var i=t.sheets[e];if(i.ranges&&Object.keys(i.ranges).length){var a,s=Object.keys(i.ranges);s.forEach((function(e,t){i.ranges[e].info||(a=t)})),s.forEach((function(t,r){i.ranges[t].dataSource&&(sf.base.isUndefined(a)||!sf.base.isUndefined(a)&&a===r)&&n.notify("dataSourceChanged",{sheetIdx:e,rangeIdx:t,isLastRange:s.length-1===r})}))}else 0===r&&n.renderModule.refreshSheet(),n.showSheetTabs&&i.name&&n.notify("sheetNameUpdate",{items:n.element.querySelector(".e-sheet-tabs-items").children[e],value:i.name,idx:e})}));break;case"locale":this.refresh()}}},r.prototype.requiredModules=function(){return nr(this)},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},r.prototype.filter=function(t,r){return this.allowFiltering?(r=r||this.getActiveSheet().selectedRange,e.prototype.filter.call(this,t,r)):Promise.reject()},r.prototype.clearFilter=function(t){t?this.notify("clearFilter",{field:t}):e.prototype.clearFilter.call(this)},r.prototype.applyFilter=function(e,t){this.notify("initiateFilterUI",{predicates:e,range:t})},r.prototype.addCustomFunction=function(t,r){e.prototype.addCustomFunction.call(this,t,r),this.notify("refreshFormulaDatasource",null)},Zn([sf.base.Property("")],r.prototype,"cssClass",void 0),Zn([sf.base.Property(!0)],r.prototype,"allowScrolling",void 0),Zn([sf.base.Property(!0)],r.prototype,"allowResizing",void 0),Zn([sf.base.Property(!0)],r.prototype,"enableClipboard",void 0),Zn([sf.base.Property(!0)],r.prototype,"enableContextMenu",void 0),Zn([sf.base.Property(!0)],r.prototype,"enableKeyboardNavigation",void 0),Zn([sf.base.Property(!0)],r.prototype,"enableKeyboardShortcut",void 0),Zn([sf.base.Property(!0)],r.prototype,"allowUndoRedo",void 0),Zn([sf.base.Property(!0)],r.prototype,"allowWrap",void 0),Zn([sf.base.Complex({},Bn)],r.prototype,"selectionSettings",void 0),Zn([sf.base.Complex({},Ln)],r.prototype,"scrollSettings",void 0),Zn([sf.base.Event()],r.prototype,"beforeCellRender",void 0),Zn([sf.base.Event()],r.prototype,"beforeSelect",void 0),Zn([sf.base.Event()],r.prototype,"select",void 0),Zn([sf.base.Event()],r.prototype,"contextMenuBeforeOpen",void 0),Zn([sf.base.Event()],r.prototype,"fileMenuBeforeOpen",void 0),Zn([sf.base.Event()],r.prototype,"contextMenuBeforeClose",void 0),Zn([sf.base.Event()],r.prototype,"dialogBeforeOpen",void 0),Zn([sf.base.Event()],r.prototype,"fileMenuBeforeClose",void 0),Zn([sf.base.Event()],r.prototype,"contextMenuItemSelect",void 0),Zn([sf.base.Event()],r.prototype,"fileMenuItemSelect",void 0),Zn([sf.base.Event()],r.prototype,"beforeDataBound",void 0),Zn([sf.base.Event()],r.prototype,"dataBound",void 0),Zn([sf.base.Event()],r.prototype,"dataSourceChanged",void 0),Zn([sf.base.Event()],r.prototype,"cellEdit",void 0),Zn([sf.base.Event()],r.prototype,"cellEditing",void 0),Zn([sf.base.Event()],r.prototype,"cellSave",void 0),Zn([sf.base.Event()],r.prototype,"beforeCellSave",void 0),Zn([sf.base.Event()],r.prototype,"created",void 0),Zn([sf.base.Event()],r.prototype,"beforeSort",void 0),Zn([sf.base.Event()],r.prototype,"beforeHyperlinkCreate",void 0),Zn([sf.base.Event()],r.prototype,"afterHyperlinkCreate",void 0),Zn([sf.base.Event()],r.prototype,"beforeHyperlinkClick",void 0),Zn([sf.base.Event()],r.prototype,"afterHyperlinkClick",void 0),Zn([sf.base.Event()],r.prototype,"actionBegin",void 0),Zn([sf.base.Event()],r.prototype,"actionComplete",void 0),Zn([sf.base.Event()],r.prototype,"openComplete",void 0),Zn([sf.base.Event()],r.prototype,"sortComplete",void 0),r=s=Zn([sf.base.NotifyPropertyChanges],r)}(Pt);return Jn.Inject(Vr,jr,Gr,Yr,$r,qr,xn,vn,mn,Sn,bn,Cn,B,On,Tn,Xr,wn,yn),e.Workbook=Pt,e.Range=Ct,e.UsedRange=bt,e.Sheet=St,e.getSheetIndex=xt,e.getSheetIndexFromId=wt,e.getSheetNameFromAddress=It,e.getSheetIndexByName=Et,e.updateSelectedRange=Rt,e.getSelectedRange=function(e){return e&&e.selectedRange||"A1"},e.getSheet=kt,e.getSheetNameCount=At,e.getMaxSheetId=Ft,e.initSheet=Tt,e.getSheetName=Ot,e.Row=Vt,e.getRow=jt,e.setRow=qt,e.isHiddenRow=zt,e.getRowHeight=Wt,e.setRowHeight=Gt,e.getRowsHeight=Yt,e.Column=Zt,e.getColumn=Jt,e.setColumn=Qt,e.getColumnWidth=er,e.getColumnsWidth=tr,e.isHiddenCol=rr,e.Cell=ot,e.getCell=lt,e.setCell=ht,e.skipDefaultValue=dt,e.wrap=pt,e.getData=ct,e.getModel=function(e,t){var r,n,i;if(sf.base.isUndefined(e[t])||!e[t]||e[t].index!==t)for(var a=0;a<=t;a++)if(e&&e[a]){if((r=e[a].index-a)>0){for(e.forEach((function(e,t){e&&e.index&&(i=e.index,n=1),e&&!e.index&&0!==t&&(e.index=i+n),n++}));r--;)e.splice(a,0,null);a+=r}}else e?e[a]=null:e=[];return e[t]},e.processIdx=ft,e.clearRange=gt,e.getRangeIndexes=t,e.getCellIndexes=n,e.getColIndex=i,e.getCellAddress=a,e.getRangeAddress=s,e.getColumnHeaderText=o,e.getIndexesFromAddress=l,e.getRangeFromAddress=h,e.getAddressFromSelectedRange=d,e.getAddressInfo=p,e.getSwapRange=c,e.isSingleCell=f,e.executeTaskAsync=g,e.WorkbookBasicModule=Le,e.WorkbookAllModule=Be,e.getWorkbookRequiredModules=He,e.CellStyle=Ue,e.FilterCollection=Ve,e.DefineName=je,e.ProtectSettings=qe,e.Hyperlink=ze,e.Validation=We,e.Format=Ge,e.ConditionalFormat=Ye,e.Chart=Xe,e.Image=Ke,e.workbookDestroyed="workbookDestroyed",e.updateSheetFromDataSource="updateSheetFromDataSource",e.dataSourceChanged="dataSourceChanged",e.dataChanged="dataChanged",e.workbookOpen="workbookOpen",e.beginSave="beginSave",e.getFilteredCollection="getFilteredCollection",e.saveCompleted="saveCompleted",e.applyNumberFormatting="applyNumber",e.getFormattedCellObject="getFormattedCell",e.refreshCellElement="refreshCellElem",e.setCellFormat=E,e.findAllValues="findAllValues",e.textDecorationUpdate="textDecorationUpdate",e.applyCellFormat=R,e.updateUsedRange="updateUsedRange",e.workbookFormulaOperation=k,e.workbookEditOperation="workbookEditOperation",e.checkDateFormat="checkDateFormat",e.getFormattedBarText="getFormattedBarText",e.activeCellChanged="activeCellChanged",e.openSuccess="openSuccess",e.openFailure="openFailure",e.sheetCreated="sheetCreated",e.sheetsDestroyed="sheetsDestroyed",e.aggregateComputation="aggregateComputation",e.beforeSort="beforeSort",e.initiateSort="initiateSort",e.sortComplete="sortComplete",e.sortRangeAlert="sortRangeAlert",e.initiatelink="initiatelink",e.beforeHyperlinkCreate="beforeHyperlinkCreate",e.afterHyperlinkCreate="afterHyperlinkCreate",e.beforeHyperlinkClick="beforeHyperlinkClick",e.afterHyperlinkClick="afterHyperlinkClick",e.addHyperlink="addHyperlink",e.setLinkModel="setLinkModel",e.beforeFilter="beforeFilter",e.initiateFilter="initiateFilter",e.filterComplete="filterComplete",e.filterRangeAlert="filterRangeAlert",e.clearAllFilter="clearAllFilter",e.wrapEvent="wrapText",e.onSave="onSave",e.insert="insert",e.deleteAction="delete",e.insertModel="insertModel",e.deleteModel="deleteModel",e.isValidation="isValidation",e.setValidation="setValidation",e.addHighlight="addHighlight",e.dataValidate="dataValidate",e.findNext="findNext",e.findPrevious="findPrevious",e.goto=A,e.findWorkbookHandler="findHandler",e.replaceHandler="replace",e.replaceAllHandler="replaceAll",e.showDialog=F,e.findUndoRedo="findUndoRedo",e.findKeyUp="findKeyUp",e.removeValidation="removeValidation",e.removeHighlight="removeHighlight",e.queryCellInfo="queryCellInfo",e.count="count",e.findCount="findCount",e.protectSheetWorkBook="protectSheet",e.updateToggle="updateToggleItem",e.protectsheetHandler="protectsheetHandler",e.replaceAllDialog="replaceAllDialog",e.unprotectsheetHandler="unprotectsheetHandler",e.workBookeditAlert="editAlert",e.setLockCells="setLockCells",e.applyLockCells="applyLockCells",e.setMerge=T,e.applyMerge="applyMerge",e.mergedRange="mergedRange",e.activeCellMergedRange="activeCellMergedRange",e.insertMerge="insertMerge",e.pasteMerge="pasteMerge",e.setCFRule="setCFRule",e.cFInitialCheck="cFInitialCheck",e.clearCFRule="clearCFRule",e.initiateClearCFRule="initiateClearCFRule",e.cFRender="cFRender",e.cFDelete="cFDelete",e.clear="clear",e.clearCF="clearCF",e.clearCells="clearCells",e.setImage="setImage",e.setChart="setChart",e.initiateChart="initiateChart",e.refreshRibbonIcons="refreshRibbonIcons",e.refreshChart="refreshChart",e.refreshChartSize="refreshChartSize",e.updateChart="updateChart",e.deleteChartColl="deleteChartColl",e.initiateChartModel="initiateChartModel",e.focusChartBorder="focusChartBorder",e.saveError="saveError",e.checkIsFormula=$e,e.isCellReference=Ze,e.isChar=Je,e.inRange=Qe,e.isLocked=et,e.isValidCellReference=tt,e.toFraction=v,e.getGcd=y,e.intToDate=C,e.dateToInt=b,e.isDateTime=S,e.isNumber=x,e.toDate=w,e.parseIntValue=I,e.workbookLocale=nt,e.localeData=it,e.DataBind=B,e.WorkbookOpen=$,e.WorkbookSave=Q,e.WorkbookFormula=Ce,e.WorkbookNumberFormat=O,e.getFormatFromType=N,e.getTypeFromFormat=D,e.WorkbookSort=be,e.WorkbookFilter=Se,e.WorkbookImage=xe,e.WorkbookChart=we,e.WorkbookCellFormat=Ie,e.WorkbookEdit=Ee,e.WorkbookHyperlink=Re,e.WorkbookInsert=ke,e.WorkbookDelete=Ae,e.WorkbookDataValidation=Fe,e.WorkbookFindAndReplace=Te,e.WorkbookProtectSheet=Oe,e.WorkbookMerge=Ne,e.WorkbookConditionalFormat=De,e.getRequiredModules=nr,e.ribbon="ribbon",e.formulaBar="formulaBar",e.sheetTabs="sheetTabs",e.refreshSheetTabs="refreshSheetTabs",e.isFormulaBarEdit="isFormulaBarEdit",e.dataRefresh="dataRefresh",e.initialLoad="initialLoad",e.contentLoaded="contentLoaded",e.mouseDown="mouseDown",e.spreadsheetDestroyed="spreadsheetDestroyed",e.editOperation=H,e.formulaOperation="formulaOperation",e.formulaBarOperation="formulaBarOperation",e.click=M,e.keyUp=P,e.keyDown=_,e.formulaKeyUp="formulaKeyUp",e.formulaBarUpdate="formulaBarUpdate",e.onVerticalScroll="verticalScroll",e.onHorizontalScroll="horizontalScroll",e.beforeContentLoaded="beforeContentLoaded",e.beforeVirtualContentLoaded="beforeVirtualContentLoaded",e.virtualContentLoaded="virtualContentLoaded",e.contextMenuOpen="contextMenuOpen",e.cellNavigate="cellNavigate",e.mouseUpAfterSelection="mouseUpAfterSelection",e.selectionComplete="selectionComplete",e.cMenuBeforeOpen=U,e.insertSheetTab="insertSheetTab",e.removeSheetTab="removeSheetTab",e.renameSheetTab="renameSheetTab",e.ribbonClick="ribboClick",e.refreshRibbon="ribbonRefresh",e.enableToolbarItems="enableToolbarItems",e.tabSwitch="tabSwitch",e.selectRange="selectRange",e.cut=V,e.copy="copy",e.paste=j,e.clearCopy="clearCopy",e.dataBound="dataBound",e.beforeDataBound="beforeDataBound",e.addContextMenuItems="addContextMenuItems",e.removeContextMenuItems="removeContextMenuItems",e.enableContextMenuItems="enableContextMenuItems",e.enableFileMenuItems="enableFileMenuItems",e.hideFileMenuItems="hideFileMenuItems",e.addFileMenuItems="addFileMenuItems",e.hideRibbonTabs="hideRibbonTabs",e.enableRibbonTabs="enableRibbonTabs",e.addRibbonTabs="addRibbonTabs",e.addToolbarItems="addToolbarItems",e.hideToolbarItems="hideToolbarItems",e.beforeRibbonCreate="beforeRibbonCreate",e.rowHeightChanged="rowHeightChanged",e.colWidthChanged="colWidthChanged",e.beforeHeaderLoaded="beforeHeaderLoaded",e.onContentScroll="onContentScroll",e.deInitProperties="deInitProperties",e.activeSheetChanged="activeSheetChanged",e.renameSheet="renameSheet",e.initiateCustomSort="initiateCustomSort",e.applySort="applySort",e.collaborativeUpdate="collaborativeUpdate",e.hideShow=q,e.autoFit=z,e.updateToggleItem="updateToggleItem",e.initiateHyperlink="initiateHyperlink",e.editHyperlink="editHyperlink",e.openHyperlink="openHyperlink",e.removeHyperlink="removeHyperlink",e.createHyperlinkElement="createHyperlinkElement",e.sheetNameUpdate="sheetNameUpdate",e.hideSheet="hideSheet",e.performUndoRedo="performUndoRedo",e.updateUndoRedoCollection="updateUndoRedoCollection",e.setActionData="setActionData",e.getBeforeActionData="getBeforeActionData",e.clearUndoRedoCollection="clearUndoRedoCollection",e.initiateFilterUI="initiateFilterUI",e.renderFilterCell="renderFilterCell",e.reapplyFilter="reapplyFilter",e.filterByCellValue="filterByCellValue",e.clearFilter="clearFilter",e.getFilteredColumn="getFilteredColumn",e.completeAction=W,e.beginAction=G,e.filterCellKeyDown="filterCellKeyDown",e.getFilterRange="getFilterRange",e.setAutoFit="setAutoFit",e.refreshFormulaDatasource="refreshFormulaDatasource",e.setScrollEvent="setScrollEvent",e.initiateDataValidation="initiatedatavalidation",e.validationError="validationError",e.startEdit="startEdit",e.invalidData="invalidData",e.clearInvalid="clearInvalid",e.protectSheet="protectSheet",e.applyProtect="applyProtect",e.unprotectSheet="unprotectSheet",e.protectCellFormat="protectCellFormat",e.gotoDlg=Y,e.findDlg=X,e.findHandler="findHandler",e.replace=K,e.created="created",e.editAlert="editAlert",e.setUndoRedo="setUndoRedo",e.enableFormulaInput="enableFormulaInput",e.protectSelection="protectSelection",e.hiddenMerge="hiddenMerge",e.checkPrevMerge="checkPrevMerge",e.checkMerge="checkMerge",e.removeDataValidation="removeDataValidation",e.showAggregate="showAggregate",e.initiateConditionalFormat="initiateConditionalFormat",e.checkConditionalFormat="checkConditionalFormat",e.setCF="setCF",e.clearViewer="clearViewer",e.initiateFormulaReference="initiateFormulaReference",e.initiateCur="initiateCur",e.clearCellRef="clearCellRef",e.editValue="editValue",e.addressHandle="addressHandle",e.initiateEdit="initiateEdit",e.forRefSelRender="forRefSelRender",e.blankWorkbook="blankWorkbook",e.insertImage="insertImage",e.refreshImgElem="refreshImgElem",e.refreshImgCellObj="refreshImgCellObj",e.getRowIdxFromClientY="getRowIdxFromClientY",e.getColIdxFromClientX="getColIdxFromClientX",e.createImageElement="createImageElement",e.deleteImage="deleteImage",e.deleteChart="deleteChart",e.refreshChartCellObj="refreshChartCellObj",e.refreshImagePosition="refreshImagePosition",e.updateTableWidth="updateTableWidth",e.focusBorder="focusBorder",e.clearChartBorder="clearChartBorder",e.insertChart="insertChart",e.chartRangeSelection="chartRangeSelection",e.isReact="isReact",e.renderReactTemplates="renderReactTemplates",e.clearTemplate="clearTemplate",e.getUpdateUsingRaf=ir,e.removeAllChildren=ar,e.getColGroupWidth=sr,e.getScrollBarWidth=lr,e.getSiblingsHeight=dr,e.inView=cr,e.getCellPosition=ur,e.locateElem=fr,e.setStyleAttribute=gr,e.getStartEvent=mr,e.getMoveEvent=vr,e.getEndEvent=yr,e.isTouchStart=Cr,e.isTouchMove=br,e.isTouchEnd=Sr,e.getClientX=xr,e.getClientY=wr,e.setAriaOptions=Er,e.destroyComponent=Rr,e.setResize=kr,e.setWidthAndHeight=Ar,e.findMaxValue=Fr,e.updateAction=Tr,e.hasTemplate=Or,e.setRowEleHeight=Nr,e.getTextHeight=Dr,e.getTextWidth=Lr,e.getLines=Br,e.setMaxHgt=Hr,e.getMaxHgt=Mr,e.skipHiddenIdx=Pr,e.focus=_r,e.BasicModule=Tn,e.AllModule=On,e.ScrollSettings=Ln,e.SelectionSettings=Bn,e.DISABLED="e-disabled",e.WRAPTEXT=Hn,e.locale=Mn,e.dialog=Pn,e.actionEvents="actionEvents",e.overlay=_n,e.fontColor=Un,e.fillColor=Vn,e.defaultLocale=jn,e.Spreadsheet=Jn,e.Clipboard=Vr,e.Edit=jr,e.Selection=qr,e.Scroll=zr,e.VirtualScroll=Wr,e.KeyboardNavigation=Gr,e.KeyboardShortcut=Yr,e.CellFormat=Xr,e.Resize=Kr,e.CollaborativeEditing=$r,e.ShowHide=Zr,e.SpreadsheetHyperlink=Jr,e.UndoRedo=Qr,e.WrapText=en,e.Insert=tn,e.Delete=rn,e.DataValidation=nn,e.ProtectSheet=an,e.FindAndReplace=sn,e.Merge=on,e.ConditionalFormatting=ln,e.Ribbon=mn,e.FormulaBar=vn,e.Formula=yn,e.SheetTabs=Cn,e.Open=bn,e.Save=Sn,e.ContextMenu=xn,e.NumberFormat=wn,e.Sort=In,e.Filter=En,e.SpreadsheetImage=Rn,e.SpreadsheetChart=Fn,e.Render=Gn,e.SheetRender=qn,e.RowRenderer=zn,e.CellRenderer=Wn,e.Calculate=ue,e.FormulaError=fe,e.FormulaInfo=ge,e.CalcSheetFamilyItem=me,e.getAlphalabel=ve,e.ValueChangedArgs=ye,e.Parser=de,e.CalculateCommon=ee,e.isUndefined=function(e){return void 0===e},e.getSkeletonVal=te,e.getModules=re,e.getValue=ne,e.setValue=ie,e.ModuleLoader=oe,e.BasicFormulas=he,e},sf.spreadsheet=sf.spreadsheet({})}});